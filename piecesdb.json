{"assets":[{"title":"Connect to pieces OS - (PNG Image)","id":"b8390705-e0ae-4f22-9cf3-277f94eb98ad","type":"IMAGE","raw":"    import requests\n\n    def connect_to_pieces_os(port):\n        endpoint = f\"http://localhost:{port}/connect\"\n        seeded_application = {\n            'application': {\n                      \"'name': 'OPEN_SOURCE',\n                      'version': '0.0.1\"',\n                    ‘platform’: 'MACOS',\n\n            response   requests.    (endpoint, json=seeded_ application)\n\n            if not response.\n                raise Exception(f\"HTTP error! status: {response.\n\n            context = response.    ()\n            return context\n\n        except Exception as error:\n            print('Error:', error)\n            ralse error\n\n \n","language":"py","time":"14 days ago","created":"2025-05-06T04:35:52.444Z","annotations":[],"updated":"2025-05-06T04:36:15.164Z"},{"title":"Exponential Backoff Retry Function in TypeScript","id":"f2f47e24-5369-4d29-aa44-1ea47dbad7d8","type":"CODE","raw":"/**\n * Executes a function with exponential backoff retry logic\n * \n * @param fn - The async function to execute\n * @param options - Configuration options\n * @returns The result of the function\n * @throws The last error encountered after max retries\n */\nexport async function withBackoff<T>(\n  fn: () => Promise<T>,\n  options: {\n    maxRetries?: number;       // Maximum number of retry attempts\n    initialDelay?: number;     // Starting delay in milliseconds\n    maxDelay?: number;         // Maximum delay cap in milliseconds\n    factor?: number;           // Exponential factor\n    jitter?: boolean;          // Add randomness to delay\n    onRetry?: (error: Error, attempt: number, delay: number) => void;  // Called before each retry\n  } = {}\n): Promise<T> {\n  const {\n    maxRetries = 3,\n    initialDelay = 100,\n    maxDelay = 10000,\n    factor = 2,\n    jitter = true,\n    onRetry = () => {}\n  } = options;\n  \n  let attempt = 0;\n  let lastError: Error;\n\n  while (attempt <= maxRetries) {\n    try {\n      return await fn();\n    } catch (error) {\n      lastError = error instanceof Error ? error : new Error(String(error));\n      \n      if (attempt >= maxRetries) {\n        break;\n      }\n      \n      // Calculate delay with exponential backoff\n      let delay = initialDelay * Math.pow(factor, attempt);\n      \n      // Apply maximum delay cap\n      delay = Math.min(delay, maxDelay);\n      \n      // Add jitter if enabled (up to 25% variance)\n      if (jitter) {\n        delay = delay * (0.75 + Math.random() * 0.5);\n      }\n      \n      // Call the onRetry callback\n      onRetry(lastError, attempt + 1, delay);\n      \n      // Wait for the calculated delay\n      await new Promise(resolve => setTimeout(resolve, delay));\n      \n      attempt++;\n    }\n  }\n  \n  throw lastError!;\n}\n\n/* Usage examples:\n\n// Simple usage\ntry {\n  const data = await withBackoff(() => fetchData(url));\n  console.log(data);\n} catch (error) {\n  console.error(\"Failed after multiple retries:\", error);\n}\n\n// Advanced configuration\nconst result = await withBackoff(\n  () => apiRequest(),\n  {\n    maxRetries: 5,\n    initialDelay: 200,\n    maxDelay: 30000,\n    factor: 3,\n    jitter: true,\n    onRetry: (error, attempt, delay) => {\n      console.log(`Retry ${attempt} after ${delay}ms due to ${error.message}`);\n    }\n  }\n);\n*/\n","language":"ts","time":"14 days ago","created":"2025-05-06T04:35:54.044Z","annotations":[],"updated":"2025-05-06T04:36:05.843Z"},{"title":"Welcome to your Personal Pieces Drive","id":"82e9a4c0-b327-47b2-a615-22cfed644081","type":"TEXT","raw":"Welcome to your Personal Pieces Drive 😃\n\nThis is an example text snippet saved in your Drive. In your Drive you can:\n1. Save valuable or re-usable code or text snippets\n2. Share snippets with friends or colleagues\n3. Extract code or text from screenshots\n4. Discover code snippets from your local repositories\n\nTo save a snippet, copy some code from one of your repos, then paste into Pieces 👍\n\nFor more information, visit our docs at docs.pieces.app 📖","language":"text","time":"14 days ago","created":"2025-05-06T04:35:56.693Z","annotations":[],"updated":"2025-05-06T04:36:10.713Z"},{"title":"Code Snippet: Free Demo Contact Us","id":"659d995d-c72c-4625-9985-01e943b21e10","type":"CODE","raw":"Free Demo\nContact Us\nSupport Center\nBlog\nWelcome: \nMichael Osborne\n  |  \nSign out\n  \n\nSALES & KNOWLEDGE\nMARKETING\nCUSTOMER ACQUISITIONS\nSUPPORT\nMY CHECK POINT\n\nSupport Center\n/\nSearch Results\n/\nSecureknowledge Details\n\nMy Favorites\nSolution ID: sk183425\nTechnical Level:\nAdvanced\nIL\nUS\n\nEdit\n\nEmail\n\nPrint\n\nSubscribe\n\nThreat Emulation Fails to Process Large Files (>100MB) and Blocks Them Despite Fail-Open Configuration on Quantum Security Gateways (R81.20 JHF Take 89, GAIA 3.10)\nProduct\nQuantum Security Gateways, Quantum Security Management\nVersion\nR81.20\nOS\nGaia Embedded\nLast Modified\n2025-05-06\nFor internal users only\nTask number(s): TM-82403\nSymptoms\nThreat Emulation sometimes completes file analysis but does not reply to the sender, causing the sender to time out.\n\nSender receives error message: _\"Virus detection was not performed due to communication problem.\"_\n\nSome files are blocked or not scanned, even though they are delivered to the sandbox for analysis.\n\nInconsistent responses between appliances: - One returns _\"204 Not Modified\"_ (file allowed) - Another returns _\"403 Forbidden\"_ (file blocked)\n\nIssue occurs with large archive files, especially when extracted files exceed 100MB.\n\nThreat Emulation is configured to fail-open, but files above a certain size are still blocked.\n\nCause\nThreat Emulation has a hard-coded maximum file size limit of 100MB for local emulation. When an archive contains extracted files larger than this limit, Threat Emulation cannot process them and, by default, does not reply to the sender. This results in a timeout and the file being blocked.\n\nAlthough the `archive_tool`'s `extracted_file_max_size` was increased, the absolute Threat Emulation limit of 100MB could not be bypassed. The system was not set to fail-open for this specific error, so files exceeding the limit were not allowed through as intended.\nSolution\nConfigure the Error Manager to allow Threat Emulation to process files which are larger than 100MB:\n\nConnect to the Security Management Server through SSH.\nRun this command to set the Error Manager to fail-open when the file size limit is reached:\ntecli adv error set file_max_size fail_open\nNOTE\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\nArticle Properties\nOriginator\nManjot Kaur\nTechnical Resource\nItay Golan\nAccess Level\nAdvanced\nStatus\nApproved by TAC\nSR #\n6-0004241749\nDate Created\n2025-05-05\nLast Modified\n2025-05-06\nEditor\nManjot Kaur\nLast Approver\nRonit Segal\nWas this page helpful?\nYes\nNo\nHaven't found what you're looking for?\nOur customer support team is only a click away and ready to help you 24 hours a day.\nOpen a Service Request\nFollow Us\nYOU DESERVE THE BEST SECURITY™\n©1994-2025 Check Point Software Technologies Ltd. All rights reserved.\nCopyright | Privacy Policy | User Agreement","language":"md","time":"14 days ago","created":"2025-05-06T22:30:54.548Z","annotations":[],"updated":"2025-05-06T22:31:02.467Z"},{"title":"Free Demo Contact Us","id":"e389516e-f9df-440e-915b-fd982ff6fc8d","type":"CODE","raw":"Free Demo\nContact Us\nSupport Center\nBlog\nWelcome: \nMichael Osborne\n  |  \nSign out\n  \n\nSALES & KNOWLEDGE\nMARKETING\nCUSTOMER ACQUISITIONS\nSUPPORT\nMY CHECK POINT\n\nSupport Center\n/\nSearch Results\n/\nSecureknowledge Details\n\nMy Favorites\nSolution ID: sk65133\nTechnical Level:\nAdvanced\nIL\nUS\n\nEdit\n\nEmail\n\nPrint\n\nSubscribe\n\nConnections Table Format\nProduct\nIPSec VPN, Quantum Security Gateways\nVersion\nR80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\nOS\nGaia\nLast Modified\n2025-05-06\nFor internal users only\nJira: FMW-3904\nSolution\nConnections Table (id 8158) Format:\n\nCheck Point kernel tables contain various information about the current connections, about the hosts, about the users, etc.\n\nTo work with kernel tables, use the following command:\n\n[Expert@HostName]# fw tab -t {<TABLE_NAME> | <TABLE_ID>} [<flags>]\n\nRefer to the Command Line Interface Reference Guide > Chapter \"Security Gateway Commands\" > Section \"fw\" > Section \"fw tab\".\n\n'Connections' kernel table contains the specific information about the current connections (source, destination, protocol, timeout, etc etc etc).\n\nExample:\n\n[Expert@HostName]# fw tab -t connections\n\nor\n\n[Expert@HostName]# fw tab -t 8158\n\n.................................\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\n.................................\n\nThe information in the Connections table is stored in the following form:\n\n<direction,5-tuple-key;r_ctype,r_cflags,rule,service_id,handler,uuid1,uuid2,uuid3,uuid4,ifncin,ifncout,ifnsin,ifnsout,bits1,bits2,connection_module_kbufs@ttl/timeout>\n\nNotes:\n\nall values are in Hexadecimal format\nvalues are represented by a set of 8 hexadecimal digits, and left-most zeros are omitted\nin templates below, each Hexadecimal digit is shown as 'x'\nDetailed explanation about each parameter:\n\n<DIRECTION,5-tuple-key;r_ctype,r_cflags,rule,service_id,handler,uuid1,uuid2,uuid3,uuid4,ifncin,ifncout,ifnsin,ifnsout,bits1,bits2,connection_module_kbufs@ttl/timeout>\n\n(example: <0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>)\nMeaning\n\nDirection of the connection\n\nValues\n\nThe direction of the connection is set by the first packet of the connection even though the connection may be bi-directional in reality.\n\n0 = inbound\n1 = outbound\n<direction,5-TUPLE KEY;r_ctype,r_cflags,rule,service_id,handler,uuid1,uuid2,uuid3,uuid4,ifncin,ifncout,ifnsin,ifnsout,bits1,bits2,connection_module_kbufs@ttl/timeout>\n\n(example: <0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>)\nMeaning\n\nConnection key\n\nValues\n\nFor TCP/UDP:\n\nSource_IP,Source_Port,Destination_IP,Destination_Port,Protocol_Number\nFor ICMP Request/Reply (sk26874):\n\nif \"fw_allow_simultaneous_ping=0\", then Source_IP,ICMP_Identifier,Destination_IP,0,Protocol_Number\nif \"fw_allow_simultaneous_ping=1\", then Source_IP,ICMP_Sequence_Number,Destination_IP,0,Protocol_Number\nFor other IP protocols:\n\nSource_IP,0,Destination_IP,0,Protocol_Number\n<direction,5-tuple-key;R_CTYPE,r_cflags,rule,service_id,handler,uuid1,uuid2,uuid3,uuid4,ifncin,ifncout,ifnsin,ifnsout,bits1,bits2,connection_module_kbufs@ttl/timeout>\n\n(example: <0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>)\nMeaning\n\nConnection type\n\nValues\n\nSet of 8 hexadecimal digits (xxxxxxxx) that represent IP compression, TCP state, VPN information and VPN mode\n\n1st and 2nd hex digits (from the left) = IP compression values\nAB0xxxxx\nA=0 + B=0 = No IP compression\n3rd hex digit (from the left) = always \"0\" (zero)\n\nxx0xxxxx\nNote for versions R80.10 and higher:\n\nThe value \"xx2xxxxx\" is used temporarily during the ClusterXL Flush-and-Ack (FnA, or F&A) operation.\nThis bit is used to \"freeze\" the connection during FnA, so that new packets will not pass and change the connection's state during the cluster delta synchronization.\nAfter the connection is synchronized, this bit is cleared (set to 0).\n\n4th hex digit (from the left) = Type of connection\n\nxx01xxxx = Client-to-Server connection\nxx02xxxx = Server-to-Client connection\nxx04xxxx = Reversed connection (the first packet is in the Server-to-Client direction)\n5th hex digit (from the left) = State of a TCP connection\n\nxx0x0xxx = None (or start of a session with TCP \"SYN_SENT\", depending on flags)\nxx0x1xxx = Source sent TCP [FIN]\nxx0x2xxx = Destination sent TCP [FIN]\nxx0x3xxx = Closed (end-session timeout)\nxx0x4xxx = TCP established\nxx0x7xxx = Closed (end-session timeout)\nxx0x8xxx = TCP [SYN-ACK] received - start of a session\nxx0xBxxx = Closed (end-session timeout)\nxx0xCxxx = TCP established\nxx0xDxxx = Half-closed (only one side sent TCP [FIN])\nxx0xExxx = Destination sent TCP [FIN]\nxx0xFxxx = TCP closed\nNote: The connection state is accumulative. For example, a TCP connection that was closed by both sides, but did not yet time out from the Connections table, will have this digit value: [SYN-ACK] + Established + Destination [FIN] + Source [FIN] = 8 + 4 + 2 + 1 = F hex.\n\n6th hex digit (from the left) = State of a TCP connection\nxx0xx0xx = None (or start of a session with TCP \"SYN_SENT\", depending on flags)\nxx0xx1xx = Source sent TCP [FIN]\nxx0xx2xx = Destination sent TCP [FIN]\nxx0xx3xx = Closed (end-session timeout)\nxx0xx4xx = TCP established\nxx0xx7xx = Closed (end-session timeout)\nxx0xx8xx = TCP [SYN-ACK] received - start of a session\nxx0xxBxx = Closed (end-session timeout)\nxx0xxCxx = TCP established\nxx0xxDxx = Half-closed (only one side sent TCP [FIN])\nxx0xxExx = Destination sent TCP [FIN]\nxx0xxFxx = TCP closed\nNote: The connection state is accumulative. For example, a TCP connection that was closed by both sides, but did not yet time out from the Connections table, will have this digit value: [SYN-ACK] + Established + Destination [FIN] + Source [FIN] = 8 + 4 + 2 + 1 = F hex.\n\n7th hex digit (from the left) = Extranet manager information\n\nShould be interpreted as four binary digits of the form CDEFbin, and should be divided into 2 parts: CDbin and EFbin - xx0xxx(CDEFbin)x\n(CDbin) - Contains information about the source of the connection. Takes the values 00, 01, or 10.\n(EFbin) - Contains information about the destination of the connection. Takes the values 00, 01, or 10.\nxx0xxx(0000bin)x = xx0xxx0x hex = source and destination objects are of type 'any' (local or extranet)\nxx0xxx(0001bin)x = xx0xxx1x hex = source object is of type 'any' (local or extranet) ; destination object is of 'local' type\nxx0xxx(0010bin)x = xx0xxx2x hex = source object is of type 'any' (local or extranet) ; destination object is of 'extranet' type\nxx0xxx(0100bin)x = xx0xxx4x hex = source object is of 'local' type ; destination object is of type 'any' (local or extranet)\nxx0xxx(0101bin)x = xx0xxx5x hex = source and destination objects are of type 'local'\nxx0xxx(0110bin)x = xx0xxx6x hex = source object is of 'local' type ; destination object is of 'extranet' type\nxx0xxx(1000bin)x = xx0xxx8x hex = source object is of 'extranet' type ; destination object is of type 'any' (local or extranet)\nxx0xxx(1001bin)x = xx0xxx9x hex = source object is of 'extranet' type ; destination object is of 'local' type\nxx0xxx(1010bin)x = xx0xxxAx hex = source and destination objects are of type 'extranet'\n8th hex digit (from the left) = VPN type\n\nShould be interpreted as four binary digits of the form GHIJbin, and should be divided into 2 parts: Gbin and HIJbin - xx0xxxx(GHIJbin)\n(Gbin) equals 1 = means the connection is between two Security Gateways in a VPN community\n(HIJbin) = VPN encryption\nNote: Exact digit may change between Check Point software versions. For clarifications, contact Check Point Support.\nxx0xxxx(0000bin) = xx0xxxx0 hex = Connection type is not known yet.\nxx0xxxx(0001bin) = xx0xxxx1 hex = Connection is not inside a VPN community. Connection is not encrypted.\nxx0xxxx(0010bin) = xx0xxxx2 hex = Initial type for a connection that was matched by an \"Encrypt\" rule in the Traditional VPN Mode. This type is what tells the VPN policy chain (inbound or outbound) to encrypt the connection. Not relevant for the Simplified VPN Mode.\nxx0xxxx(0011bin) = xx0xxxx3 hex = Connection's destination will be encrypted, but the first outgoing packet has not been seen (encrypted) yet. This type is set when handling the first inbound packet of the connection whose destination will be encrypted. Used only in the Simplified VPN Mode.\nxx0xxxx(0100bin) = xx0xxxx4 hex = Currently is used only for VoIP. When a new data connection is determined to be a VoIP data connection, its type is set to 4. Then, in the inbound or outbound VPN policy chain, the connection's type is set to 6 (\"CONN_ENCRYPTED\").\nxx0xxxx(0101bin) = xx0xxxx5 hex = Same as xx0xxxx2 hex, but for connections matched by a \"Client Encrypt\" rule.\nxx0xxxx(0110bin) = xx0xxxx6 hex = Connection is encrypted.\nxx0xxxx(0111bin) = xx0xxxx7 hex = Same as xx0xxxx3 hex, but for reversed connections (the first packet is in the Server-to-Client direction).\nxx0xxxx(1001bin) = xx0xxxx9 hex = Connection is inside a VPN community. Connection is not encrypted.\nxx0xxxx(1010bin) = xx0xxxxA hex = Connection is inside a VPN community. Connection should be encrypted.\nxx0xxxx(1011bin) = xx0xxxxB hex = Connection is inside a VPN community. The Client of the connection is in the encryption domain.\nxx0xxxx(1100bin) = xx0xxxxC hex = Connection is inside a VPN community. The Server of the connection is in the encryption domain.\nxx0xxxx(1101bin) = xx0xxxxD hex = Connection is inside a VPN community. Connection should be encrypted, and the VPN peer is a Remote Access VPN client.\n<direction,5-tuple-key;r_ctype,R_CFLAGS,rule,service_id,handler,uuid1,uuid2,uuid3,uuid4,ifncin,ifncout,ifnsin,ifnsout,bits1,bits2,connection_module_kbufs@ttl/timeout>\n\n(example: <0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>)\nMeaning\n\nConnection flags\n\nValues\n\nSet of 8 hexadecimal digits (xxxxxxxx) that represent connection flags.\n\nThe final connection flag value is accumulative:\n\n00000001 = One-way connection, Client-to-Server.\n00000002 = One-way connection, Server-to-Client.\n00000003 = One-way connection, direction is still unknown.\n00000004 = Obsolete.\n00000008 = Obsolete.\n00000010 = Data connection is still to be opened - the source port is still unknown.\n00000020 = Data connection.\n00000040 = Data connection - the real direction is reversed.\n00000080 = Security Gateway logged the connection.\n00000100 = Connection from a previous policy, not yet recovered (old).\n00000200 = Recovered connection from a previous policy (not used yet).\n00000400 = Connection from or to a Security Server.\n00000800 = Connection should survive the policy reload, so it will not go through the policy matching again.\n00001000 = Packet from a data connection should refresh the control connection.\n00002000 = Packet was already seen on the Server side.\n00004000 = Replies are allowed for the connection (UDP/IP) - not unidirectional.\n00008000 = Replies are allowed from any port for the connection.\n00010000 = Connection requires SCV (sk30559).\n00020000 = Pending a log about this connection.\n00040000 = Connection started with TCP [SYN] (SYN_SENT). TCP [SYN-ACK] or TCP [SYN-RST] are only allowed as a response.\n00080000 = RTP-based connection.\n00100000 = Is the connection truly one-way?\n00200000 = Is Early NAT required for this connection?\n00400000 = Checking the redirect for a VoIP connection.\n00800000 = Is this connection in the Wire mode?\n01000000 = Transport Expert API - TCP handshake enforcement is disabled for this connection.\n02000000 = Checks existence of a parent connection for pending data connections.\n04000000 = Connection should be removed from the Connections table after a reply.\n08000000 = Encountered TCP [SYN] on an already established connection (maybe this connection is being reused).\n10000000 = All packets of this connection should be rejected.\n20000000 = The entry should be deleted from the Connection table after the packet leaves the Security Gateway.\n40000000 = SecureXL in a Cluster with asymmetric routing detected only TCP [SYN] and TCP [ACK] packets of a TCP handshake.\n80000000 = In a Cluster environment, connection should be dropped while waiting for Flush-and-Ack to finish.\n<direction,5-tuple-key;r_ctype,r_cflags,RULE,service_id,handler,uuid1,uuid2,uuid3,uuid4,ifncin,ifncout,ifnsin,ifnsout,bits1,bits2,connection_module_kbufs@ttl/timeout>\n\n(example: <0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>)\nMeaning\n\nRule number in the Access Control policy, to which the connection was matched\n\nValues\n\nConvert the Hexadecimal number to the Decimal number\n\n<direction,5-tuple-key;r_ctype,r_cflags,rule,SERVICE_ID,handler,uuid1,uuid2,uuid3,uuid4,ifncin,ifncout,ifnsin,ifnsout,bits1,bits2,connection_module_kbufs@ttl/timeout>\n\n(example: <0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>)\nMeaning\n\nIn versions NGX R60 and above = Service_ID\nIn versions NG R55 and lower = The connection's timeout\nValues\n\nFor versions NGX R60 and above, to find Service_Name based on Service_ID, convert the Service_ID from Hex to Dec format, and refer to the \"service_list\" section in the relevant $FWDIR/conf/<Policy_Name>.pf file on the Management Server:\n\n    :spii_multi_sets (\n      : (services\n        :service_list (\n\nRelevant lines have the following format:\n\n: (\"Service_ID,0,Service_Name,srv_name\")\n\nExamples:\n\n: (\"442,0,http,srv_name\")\n\n: (\"446,0,icmp-proto,srv_name\")\n\n: (\"489,0,ospf,srv_name\")\n\n: (\"535,0,ssh_version_2,srv_name\")\n\n: (\"540,0,telnet,srv_name\")\n\n: (\"554,0,vrrp,srv_name\")\n\n<direction,5-tuple-key;r_ctype,r_cflags,rule,service_id,HANDLER,uuid1,uuid2,uuid3,uuid4,ifncin,ifncout,ifnsin,ifnsout,bits1,bits2,connection_module_kbufs@ttl/timeout>\n\n(example: <0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>)\nMeaning\n\nAn index of an INSPECT handler function that is executed on every packet that belong to the connection\n\nValues\n\n0 value means no handler\nnon-0 value means connection can not be accelerated by SecureXL device\nNote: In versions NGX R60 and higher - handlers can be registered via SPII, in which case, this field is zeroed, although an INSPECT handler exists\n\n<direction,5-tuple-key;r_ctype,r_cflags,rule,service_id,handler,UUID1,UUID2,UUID3,UUID4,ifncin,ifncout,ifnsin,ifnsout,bits1,bits2,connection_module_kbufs@ttl/timeout>\n\n(example: <0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>)\nMeaning\n\nUnique 128-bit connection identifier.\nUsed for log unification (connection key is not enough due to reuse of connection ports)\nUsed as a key for other kernel tables\nNote: Must not change throughout the connection lifetime.\n\nValues\n\nuuid1,uuid2,uuid3,uuid4 = TimeStamp,Connection_Counter,Machine_IP,7b6\n\nTimeStamp = In the UNIX time format [use either this, or this on-line converter]\nConnection_Counter = The ordinal number (example: 32nd) of connection that was opened during that second - refer to TimeStamp\nMachine_IP = Should be read from right-to-left by octets, e.g., value 20c7a8c0 means that real IP is c0-a8-c7-02 = 192.168.199.2\n<direction,5-tuple-key;r_ctype,r_cflags,rule,service_id,handler,uuid1,uuid2,uuid3,uuid4,IFNCIN,IFNCOUT,IFNSIN,IFNSOUT,bits1,bits2,connection_module_kbufs@ttl/timeout>\n\nExample:\n\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>)\n\nMeaning\n\nAnti-Spoofing cache\n\nExplanation:\n\nAnti-Spoofing verifies that the Source IP of each packet matches the interface, on which it was encountered.\n\nOn internal interfaces we only allow packets whose Source IPs are within their user-defined topology\nOn external interface we allow all Source IPs except for ones the belong to internal networks\nAnti-Spoofing validation is relatively expensive for a per-packet operation. In order to improve performance, the Connections Table caches the interfaces, on which the connection’s packets were encountered:\nA packet that matches the Anti-Spoofing cache passes quickly\nOtherwise, the standard Anti-Spoofing operation is performed (packet is not necessarily invalid, routing changes might cause cache invalidation)\nValues\n\nif = Stands for interface\nn = Number of the interface in the Check Point kernel (refer to the output of the \"fw ctl iflist\" command)\nc = Client side\ns = Server side\nin = Inbound\nout = Outbound\n<direction,5-tuple-key;r_ctype,r_cflags,rule,service_id,handler,uuid1,uuid2,uuid3,uuid4,ifncin,ifncout,ifnsin,ifnsout,BITS1,BITS2,connection_module_kbufs@ttl/timeout>\n\n(example: <0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>)\nMeaning\n\nSet of per-connection bits\n\nValues\n\nDefined in groups in the $FWDIR/lib/fwconn.h file\n\nNote: In versions NGX R60 and higher - ClusterXL Sticky Decision Function (SDF) uses the last 17 bits of the first field as a hash that maps to the cluster member that handles the connection.\n\n<direction,5-tuple-key;r_ctype,r_cflags,rule,service_id,handler,uuid1,uuid2,uuid3,uuid4,ifncin,ifncout,ifnsin,ifnsout,bits1,bits2,CONNECTION_MODULE_KBUFS@ttl/timeout>\n\n(example: <0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>)\nMeaning\n\nConnection modules' kernel buffers\n\nValues\n\nIndex numbers start from 0 (zero) and increase from left-to-right.\n\nCheck the indices that contain non-0 values.\n\nTo find the respective Connection Modules, refer to the output of this command:\n\nfw ctl conn -a\n<direction,5-tuple-key;r_ctype,r_cflags,rule,service_id,handler,uuid1,uuid2,uuid3,uuid4,ifncin,ifncout,ifnsin,ifnsout,bits1,bits2,connection_module_kbufs@TTL/TIMEOUT>\n\n(example: <0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>)\nMeaning\n\nTime to Live / Timeout\n\nValues\n\nTime to Live = 0 is the standard, meaning TTL should be set to the entire timeout and not part of it.\nTimeout = Connection's timeout (in seconds).\nExample of the \"fw ctl conn -a\" output:\n\n[Expert@HostName]# fw ctl conn -a\nInstalled connections modules:\nNo. Name             Used  Newconn  Packet   End      Reload   Dup Type Dup Handler\nConnectivity level 0:\n0:  Accounting       yes   0:  Accounting       00000000 00000000 00000000 00000000 Special  f22a81b0\n1:  Authentication   yes   1:  Authentication   f23d4d90 00000000 00000000 00000000 Special  f23d54b0\n2:  CPAS             yes   2:  CPAS             00000000 00000000 00000000 00000000 None\n3:  FG-1             no    3:  FG-1             00000000 00000000 00000000 00000000 None\n4:  ISP-Redundancy   no    4:  ISP-Redundancy   00000000 00000000 00000000 00000000 None\n5:  IcmpTunnel       no    5:  IcmpTunnel       00000000 00000000 00000000 00000000 None\n6:  NAC              no    6:  NAC              00000000 00000000 00000000 00000000 None\n7:  NAT              no    7:  NAT              00000000 00000000 00000000 00000000 None\n8:  PSL              yes   8:  PSL              00000000 00000000 f2428f10 f242acb0 None\n9:  RTM              no    9:  RTM              00000000 00000000 00000000 00000000 None\n10:  RTM2             no    10:  RTM2             00000000 00000000 00000000 00000000 None\n11:  SPII             yes   11:  SPII             f23ea660 00000000 00000000 00000000 None\n12:  SeqVerifier      yes   12:  SeqVerifier      f22e2d00 00000000 00000000 f22e1620 Special  f22e2cb0\n13:  SynDoSDefender   no    13:  SynDoSDefender   00000000 00000000 00000000 00000000 None\n14:  VPN              no    14:  VPN              00000000 00000000 00000000 00000000 None\nConnectivity level 1:\n0:  Accounting       no    0:  Accounting       00000000 00000000 00000000 00000000 None\n1:  Authentication   no    1:  Authentication   00000000 00000000 00000000 00000000 None\n2:  CPAS             no    2:  CPAS             00000000 00000000 00000000 00000000 None\n3:  FG-1             no    3:  FG-1             00000000 00000000 00000000 00000000 None\n4:  ISP-Redundancy   no    4:  ISP-Redundancy   00000000 00000000 00000000 00000000 None\n5:  IcmpTunnel       no    5:  IcmpTunnel       00000000 00000000 00000000 00000000 None\n6:  NAC              no    6:  NAC              00000000 00000000 00000000 00000000 None\n7:  NAT              no    7:  NAT              00000000 00000000 00000000 00000000 None\n8:  PSL              no    8:  PSL              00000000 00000000 00000000 00000000 None\n9:  RTM              no    9:  RTM              00000000 00000000 00000000 00000000 None\n10:  RTM2             no    10:  RTM2             00000000 00000000 00000000 00000000 None\n11:  SPII             no    11:  SPII             00000000 00000000 00000000 00000000 None\n12:  SeqVerifier      no    12:  SeqVerifier      00000000 00000000 00000000 00000000 None\n13:  SynDoSDefender   no    13:  SynDoSDefender   00000000 00000000 00000000 00000000 None\n14:  VPN              no    14:  VPN              00000000 00000000 00000000 00000000 None\n[Expert@Power-1-9070-MemberA]# \n \n\nExample:\n\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\n\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\nConnection key\n\nfrom 162.82.74.162:1864 to 69.90.236.25:80, TCP protocol\n\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\nConnection type\n\n1st and 2nd hex digits (from the left) = IP compression values:\n\n00 0 1c001 = No IP compression.\n\n3rd hex digit (from the left) = Always 0 (zero)\n\n00 0 1c001\n\n4th hex digit (from the left) = Type of connection:\n\n00 0 1c001 = Client-to-Server connection.\n\n5th hex digit (from the left) = State of a TCP connection:\n\n00 0 1c001 = TCP [SYN-ACK] received.\n\n6th hex digit (from the left) = State of a TCP connection:\n\n00 0 1c001 = None (or TCP \"SYN_SENT\", depending on flags).\n\n7th hex digit (from the left) = Extranet manager information:\n\n00 0 1c001 = Source and destination objects are of type 'any' (local or extranet).\n\n8th hex digit (from the left) = VPN type:\n\n00 0 1c001 = Connection is not inside a VPN community. Connection is not encrypted.\n\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\nConnection flags\n\n00000080 = Security Gateway logged the connection\n00002000 = Packet was already seen on the server side\n00004000 = Replies are allowed for the connection (UDP/IP) - not unidirectional\n00040000 = Connection started with TCP [SYN] (\"SYN_SENT\")\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\nRule number\n\n20ehex = 526dec\n\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\nService_ID\n\n1e1hex = 481dec\n\nBased on the \"service_list\" section in the relevant $FWDIR/conf/<Policy_Name>.pf file on Security Management Server, we find that:\n\n: (\"481,0,http,srv_name\")\n\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\nINSPECT handler\n\n0 means no handler\n\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\nUUID = uuid1,uuid2,uuid3,uuid4\n\n42b04f5e,31,20c7a8c0,7b6 = TimeStamp = 15-Jun-2005 15:55:10 GMT\n42b04f5e,31,20c7a8c0,7b6 = Connection_Counter = 32nd connection during that second\n42b04f5e,31,20c7a8c0,7b6 = Machine_IP c0-a8-c7-02 = 192.168.199.2\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\nAnti-Spoofing cache\n\n1,1,2,2 = packet passed:\n\nThrough the interface ifn=1 on the Client side\nThrough the interface ifn=2 on the Server side\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\nPer-connection bits\n\nb341 = hash value mapped to this cluster member\n\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\nConnection module kernel buffers\n\nTotally, there are 14 Connection Modules.\n\n0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0 = indices 6 and 10 are occupied\n\n<0,a2524aa2,748,455aec19,50,6;1c001,46080,20e,1e1,0,42b04f5e,31,2ca8c0,7b6,1,1,2,2,b341,0,0,0,0,0,0,86dbb006,0,0,0,dfb31006,0,0,0@0/25>\nTime to Live / Timeout\n\nTime to Live (TTL) = 0\n\nTimeout = 25\n\n \n\n \n\nSymbolic links\n\nAnother feature that was introduced in NG version, is Symbolic Links in the Connections Table.\n\nSymbolic Link allows Check Point kernel to anticipate the possible subsequent connections for the new session.\n\nSymbolic Link in the Connections Table looks like this:\n\n<Symbolic_Link_Key> -> <Connection_Key> (Type_of_Symbolic_Link)\n\nWhere:\n\n<Symbolic_Link_Key>\n\nPoints to a real entry\n\n<Direction_1, Source_IP_1, Source_Port_1, Destination_IP_1, Destination_Port_1, Protocol_Number>\n\n<Connection_Key>\n\nStores connection-related information\n\n<Direction_2, Source_IP_2, Source_Port_2, Destination_IP_2, Destination_Port_2, Protocol_Number>\n\nType_of_Symbolic_Link\n\nSet of 8 hexadecimal digits (xxxxxxxx):\n\n00000001 = Client side\n00000002 = Server side\n00000004 = Reversed ((he first packet is in the Server-to-Client direction)\n00000008 = Partial UDP - we do not know, which port the reply will come from\n00000010 = Hardware accelerator link\n00000020 = Proxied, and Server is on the Security Gateway\n00000040 = Hardware accelerator link\nNote: The 'Type' value is accumulative.\n\nExample:\n\n<00000000, d496c1dc, 00000801, d4968d33, 000003fc, 00000011> -> <00000001, d4968d33, 000003fc, d496c1dc, 00000801, 00000011> (00000006)\n\nMost connections that pass through the FireWall, will cause the following four entries to be created in the Connections Table:\n\n<0, Client_IP, Client_Port, Server_IP, Server_Port, Protocol_Number> = Client side, inbound\n<1, Client_IP, Client_Port, Server_IP, Server_Port, Protocol_Number> = Server side, outbound\n<0, Server_IP, Server_Port, Client_IP, Client_Port, Protocol_Number> = Server side, inbound\n<1, Server_IP, Server_Port, Client_IP, Client_Port, Protocol_Number> = Client side, outbound\nClarification about flow of connections through the FireWall:\n\nClient ===> [Client side, inbound, dir 0] (FireWall) [Server side, outbound, dir 1] ===> Server\nClient <=== [Client side, outbound, dir 1] (FireWall) [Server side, inbound, dir 0] <=== Server\nThe first entry will be a 'real' one and will contain more values after the key.\n\nThe next three entries will be links to the first one.\n\nThis way, no matter what direction or side a packet comes from, there is an appropriate connection entry for it that contains all the information needed to process the packet.\n\n \n\n \n\nThe \"fw tab\" command has the flag \"-f\" (introduced in the NG version) that prints out the contents of tables in a formatted view (fw tab -f -t {<Table_Name> | <Table_ID>}).\n\nIn formatted view, titles are placed before the keys and values, so it is clear, which numbers belong to what.\n\nIt is much easier to read and very user friendly.\n\nIts only disadvantage is that it currently displays the type and flags of an entry as a decimal number without giving them any real meaning (this will be improved in future releases).\n\nIts main advantage is that it knows how to resolve some of the Kernel Buffer (kbuf) IDs at the end of an entry's values to actual, usable information that may help in troubleshooting.\n\nFor example, most of the NAT information about a connection is kept in a Kernel Buffer (kbuf).\n\nThe Kernel Buffer (kbuf) ID is one of the values of the connection entry, but does not mean anything as a number.\n\nThe formatted printout will resolve the Kernel Buffer (kbuf) ID to give address information about the NATed connection.\n\nSupport is working on resolving all types of Kernel Buffers, so in the future the formatted output should replace the regular one.\n\n \n\nNotes:\n\n(1) It is possible to control the number of printed connections:\n\nIn versions R75.47 and lower (although supported in all versions), we recommend to use the kernel parameter \"print_conns\":\n\nTo limit the number of printed connections, assign an integer value up to 231-1.\nTo print all connections, assign a 0 (zero) value.\nRun these commands:\n\n[Expert@HostName]# fw ctl set int print_conns {<LIMIT> | 0}\n[Expert@HostName]# fw tab -t connections\nIn versions R76 and higher, we recommend to use the flag \"-m <LIMIT>\":\n\nRun this command (\"LIMIT\" is an integer value up to 231-1):\n\n[Expert@HostName]# fw tab -t connections -m <LIMIT>\n\n \n\n(2) It is possible to print the number of connections in each category by using the kernel parameter \"print_conns_states\":\n\nTCP (start session, established, half-closed, closed)\nUDP\nICMP\nOther\nRun these commands:\n\n[Expert@HostName]# fw ctl set int print_conns_states 1\n[Expert@HostName]# fw tab -t connections\n(3) Use the \"fw ctl conntab\" command if you want to see the simplified information about the current connections in the connections kernel table.\n\n \n\nRelated documentation:\n\nCommand Line Interface Reference Guide > Chapter \"Security Gateway Commands\" > Section \"fw\" > Section \"fw tab\".\n \n\nRelated solutions:\n\nsk85780 - How to use the 'connstat' utility\nsk103876 - How to manually delete an entry from the Connections Table\nsk110672 - When a TCP connection ends, its entry in the Connections Table appears with a timeout value of \"TCP start timeout\" instead of expected \"TCP end timeout\"\nArticle Properties\nOriginator\nDanny Lieblich\nTechnical Resource\nGuy Kabiri\nAccess Level\nAdvanced\nStatus\nApproved\nDate Created\n2011-08-07\nLast Modified\n2025-05-06\nEditor\nGil Frantsus\nLast Approver\nSergei Shir\nComments\nInternal only\nThis SK is managed by the Knowledge Management Group. To update this SK, submit the feedback (using the field at the bottom of this SK).\n\nFor any technical answer, contact the people listed in the fields \"Originator\" and \"Technical Resource\" field.\n\nFor R82.10, there are plans to change the structure of the Connections Table\n\n \n\nNote about R_CTYPE - 8th hex digit, which means 'VPN type':\n\nExact digit might change between Check Point software versions.\nSome of the information might be outdated.\nFor clarifications, contact VPN RnD.\n\nWas this page helpful?\nYes\nNo\nHaven't found what you're looking for?\nOur customer support team is only a click away and ready to help you 24 hours a day.\nOpen a Service Request\nFollow Us\nYOU DESERVE THE BEST SECURITY™\n©1994-2025 Check Point Software Technologies Ltd. All rights reserved.\nCopyright | Privacy Policy | User Agreement","language":"sql","time":"14 days ago","created":"2025-05-06T22:31:17.345Z","annotations":[],"updated":"2025-05-06T22:31:18.664Z"},{"title":"Configuring Network Address Translation (NAT) on Check Point Security Gateways","id":"be5939b1-50c4-4535-abc0-d6c11fbea3f9","type":"CODE","raw":"ProductQuantum Security Gateways\n\nVersionR77.30 (EOS)\n\nLast Modified2021-02-11\n\n## Solution\n\n**For R80.x, refer to the \"Configuring the NAT Policy\" section of the [Security Management R80.40 Administration Guide](https://sc1.checkpoint.com/documents/R80.40/WebAdminGuides/EN/CP_R80.40_SecurityManagement_AdminGuide/Default.htm)**\n\nDefining Network Address Translation (NAT) via the network object automatically adds Rules to the Network Translation Rule Base. The Translation method can be either \"Hide\" or \"Static\".\n\nThe Global Properties section for NAT contains an option called \"Automatic ARP configuration\". Automatic ARP configuration ensures that ARP requests for a translated (NATed) machine, network or address range are answered by the Security Gateway. You no longer have to manually add a route on a Security Gateway to ensure proper routing of Static NAT devices. In addition, there is no longer a need for Manual ARP configuration via the`$FWDIR/conf/local.arp` file on the Security Gateway (details are in [sk30197](primus://skcenter.checkpoint.comsk30197)).  \n \n\n**Configuring Hide NAT**\n\nIn Hide NAT, a single public address is used to represent multiple computers on the internal network with private addresses (many-to-one relation). Hide NAT allows connections to be initiated only from the protected side of the Security Gateway that is protecting this object (Check Point, or Externally Managed Gateway or Host, Gateway node, or Host node).\n\nEnabling Hide NAT on the network object will add the appropriate rule to the NAT Rule Base. Perform the following steps to enable Hide NAT for your internal network:\n\n1.  Login to SmartDashboard.\n2.  Create the network object for the internal network.\n3.  Define the following fields:  \n    -   Name\n    -   Network Address\n    -   Net Mask\n    -   Comments\n    -   Color\n4.  Select the NAT tab, and enable the option \"Add Automatic Address Translation rules\".\n5.  Select the Translation method \"Hide\".\n6.  Select \"Hide behind gateway\". This NAT configuration hides the real address behind the IP address of the Security Gateway interface, through which the packet is routed out.\n7.  Click 'OK'.\n8.  Install the Security Policy onto the Gateway that will perform the NAT.\n\n**Configuring Static NAT**\n\nIn Static NAT, each private address is translated to a corresponding public address (one-to-one relation). Static NAT allows machines on both sides of the Security Gateway, protecting this object (Check Point, or Externally Managed Gateway or Host, Gateway node, or Host node), to initiate connections, so that, for example, internal servers can be made available externally.\n\nStatic NAT is used for Web, e-mail, and other application servers that require routable public IP addresses. These servers will be routable to the Internet, but will also retain their internal IP addresses for internal access.\n\nPerform the following steps to enable Static NAT for your Web or email server:\n\n1.  Login to SmartDashboard.\n2.  Create a Host Node object for the server.\n3.  Define the following fields:  \n    -   Name\n    -   Real IP address\n    -   Comment\n    -   Color\n4.  Select the NAT tab, and enable \"Add Automatic Address Translation rules\".\n5.  Select the Translation method \"Static\".\n6.  Enter the desired public IP address in the \"Translate to IP address\" field. The Translate to IP Address value for Static NAT is a virtual IP address, which is a public (routable) IP address that does not belong to any real machine.\n7.  Click 'OK'.\n8.  Install the Security Policy onto the Gateway that will perform the NAT.\n\n  \nFor more detailed information, refer to [Firewall R77 Administration Guide](https://sc1.checkpoint.com/documents/R77/CP_R77_Firewall_WebAdmin/html_frameset.htm)\n\n## Article Properties\n\nOriginatorNancy Hines\n\nTechnical ResourceYosi Havilo\n\nAccess LevelGeneral\n\nStatusApproved\n\nDate Created2005-02-24\n\nLast Modified2021-02-11\n\nEditorDavid Kornfield\n\nLast ApproverRonen Zel","language":"md","time":"14 days ago","created":"2025-05-06T22:33:26.088Z","annotations":[],"updated":"2025-05-06T22:33:33.664Z"},{"title":"Threat Emulation - Cluster and Intermittent Alert","id":"ea02343d-0c2c-45f4-a87e-be217b0249d6","type":"TEXT","raw":"---\ncreated: 2025-04-29T19:02:58 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk183398\nauthor: \n---\n\n# sk183398 - \"Threat Emulation - Communication Error: Could Not Connect to Cloud\" Intermittent Alert on Standby Cluster Member\n\n> ## Excerpt\n> Applies to: ClusterXL, Threat Emulation\n\n---\nProductClusterXL, Threat Emulation\n\nVersionR81.20\n\nOSGaia\n\nLast Modified2025-04-29\n\n#### For internal users only\n\n## Symptoms\n\n-   \"_Threat Emulation - Communication Error: Could Not Connect to Cloud_\" intermittent alerts appearing on the cluster standby member.\n    \n-   The alert resolves itself without manual intervention.\n    \n-   When the Security Gateways are rebooted and cluster roles swap, the issue appears on the new standby member.\n    \n-   The active cluster member operates normally without any Threat Emulation communication errors.\n    \n\n## Cause\n\nThis issue occurs because the standby cluster member does not handle outbound connections to the Threat Emulation cloud services correctly. By default, the standby member routes traffic through the active member, but due to asymmetric routing, some reply packets from the Threat Emulation cloud are sent directly to the standby member. This creates asymmetric connections. Although the firewall kernel can handle these connections, some features, like Threat Emulation, may not function correctly in this state.\n\nIn one case, packet captures showed that the active member used its physical IP address instead of the VIP (Virtual IP). As a result, the cloud service sent reply packets directly to the standby member's physical IP address, bypassing the active member.\n\n## Solution\n\nModify the cluster configuration to allow the standby member to handle outbound traffic independently. Run these commands to change the kernel parameters on both cluster members:  \n`fw ctl set -f int fwha_silent_standby_mode 0`  \n`fw ctl set -f int fwha_cluster_hide_active_only 0`  \nThe \"-f\" flag ensures these changes persist across reboots, so no additional configuration file changes are needed.\n\nThese changes configure the standby member to handle its own outbound connections rather than routing through the active member, eliminating the asymmetric routing issue that was causing the Threat Emulation communication errors.\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorEden Bobovnik\n\nTechnical ResourceBashar Shabaita\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2025-04-28\n\nLast Modified2025-04-29\n\nEditorEden Bobovnik\n\nLast ApproverRonit Segal\n\n## Comments\n\n#### Internal only\n\nThis issue is primarily related to connection handling in the cluster and how Threat Emulation communicates with the cloud. By default, the standby member tries to communicate via the active member, but when asymmetric routing occurs, the TLS session can fail with decrypt errors (alert code 21).\n\nThe solution modifies the cluster's behavior by:\n\nDisabling silent standby mode (fwha\\_silent\\_standby\\_mode=0), which allows the standby member to communicate directly.  \nSetting fwha\\_cluster\\_hide\\_active\\_only=0, which controls how VIPs are handled.  \nTroubleshooting for similar issues should include:\n\nChecking for NO-NAT rules that might be affecting traffic to Threat Emulation servers  \nPacket captures on both cluster members' interfaces (external and sync)  \nKernel debug logs with cluster and forward flags enabled  \nVerification of TLS connectivity from the standby member  \nThis solution is specific to scenarios where asymmetric routing causes TLS session failures with cloud services, particularly when connection reuse is attempted.\n","language":"md","time":"14 days ago","created":"2025-05-06T22:33:39.591Z","annotations":[],"updated":"2025-05-06T22:33:45.861Z"},{"title":"Code Snippet: Quantum and VSK","id":"7c3ab97e-fe9c-45e8-99d6-162c5b2960af","type":"TEXT","raw":"# QUANTUM \r\n\r\n20 November 2022\r\n\r\n## VSK\r\n\r\n## R81.20\r\n\r\n## Administration Guide\r\n\r\n## CHECK POINT\r\n\r\n# Check Point Copyright Notice \r\n\r\n(c) 2022 Check Point Software Technologies Ltd.\r\n\r\nAll rights reserved. This product and related documentation are protected by copyright and distributed under licensing restricting their use, copying, distribution, and decompilation. No part of this product or related documentation may be reproduced in any form or by any means without prior written authorization of Check Point. While every precaution has been taken in the preparation of this book, Check Point assumes no responsibility for errors or omissions. This publication and features described herein are subject to change without notice.\r\n\r\n## RESTRICTED RIGHTS LEGEND:\r\n\r\nUse, duplication, or disclosure by the government is subject to restrictions as set forth in subparagraph (c) (1)(ii) of the Rights in Technical Data and Computer Software clause at DFARS 252.227-7013 and FAR 52.227-19.\r\n\r\n## TRADEMARKS:\r\n\r\nRefer to the Copyright page for a list of our trademarks.\r\nRefer to the Third Party copyright notices for a list of relevant copyrights and third-party licenses.\r\n\r\n# Important Information \r\n\r\n## Latest Software\r\n\r\nWe recommend that you install the most recent software release to stay up-to-date with the latest functional improvements, stability fixes, security enhancements and protection against new and evolving attacks.\r\n\r\n## Certifications\r\n\r\nFor third party independent certification of Check Point products, see the Check Point Certifications page.\r\n\r\n## Check Point R81.20\r\n\r\nFor more about this release, see the R81.20 home page.\r\n\r\n## Latest Version of this Document in English\r\n\r\nOpen the latest version of this document in a Web browser.\r\nDownload the latest version of this document in PDF format.\r\n\r\n## Feedback\r\n\r\nCheck Point is engaged in a continuous effort to improve its documentation.\r\nPlease help us by sending your comments.\r\n\r\nRevision History\r\n\r\n| Date | Description |\r\n| :-- | :-- |\r\n| 20 November 2022 | First release of this document |\r\n\r\n# Table of Contents \r\n\r\nIntroduction ..... 15\r\nExample Physical Network Topology ..... 15\r\nExample VSX Virtual Network Topology ..... 16\r\nVSX Architecture and Concepts ..... 17\r\nManagement Server Connections ..... 18\r\nVSX Management Interface ..... 23\r\nDedicated Management Interface (DMI) ..... 23\r\nNon-Dedicated Management Interface (Non-DMI) ..... 23\r\nVirtual Devices ..... 24\r\nInterfaces ..... 26\r\nInterface Types ..... 26\r\nPhysical Interfaces ..... 27\r\nVLAN Interfaces ..... 27\r\nWarp Links ..... 27\r\nUnnumbered Interfaces ..... 28\r\nVSX Management Overview ..... 30\r\nSecurity Management Server Model ..... 30\r\nMulti-Domain Security Management Model ..... 30\r\nManagement Model Comparison ..... 32\r\nVSX Traffic Flow ..... 33\r\nOverview ..... 33\r\nContext Determination ..... 33\r\nDirect Connection to a Physical Interface ..... 33\r\nConnection through a Virtual Switch ..... 35\r\nConnection through a Virtual Router ..... 36\r\nSecurity Enforcement ..... 37\r\nForwarding to Destination ..... 37\r\nVSX Routing Concepts ..... 38\r\nRouting Overview ..... 38\r\nRouting Between Virtual Systems ..... 38\r\nRoute Propagation ..... 40\r\nOverlapping IP Address Space ..... 40\r\nMore for Virtual Switch Route Propagation ..... 42\r\n\r\nNAT ..... 42\r\nDynamic Routing ..... 42\r\nVSX Clusters ..... 43\r\nHigh Availability ..... 43\r\nVirtual System Load Sharing (VSLS) ..... 43\r\nDeploying VSX - Internal Network Deployment Strategies ..... 44\r\nSecurity Gateway Deployment on a Physical Network ..... 45\r\nVSX Virtual System Deployment Strategies ..... 46\r\nPhysical Internal Interface for Each Virtual System ..... 46\r\nVirtual Systems with Internal VLAN Interfaces ..... 47\r\nInternal Virtual Router with Source-Based Routing ..... 48\r\nVirtual Systems in Bridge Mode ..... 50\r\nDeploying VSX - Organizational Deployment Strategies ..... 51\r\nEnterprise Deployments ..... 51\r\nCore Network Security ..... 51\r\nDynamic Routing ..... 53\r\nPerimeter Security ..... 53\r\nManaged Service Providers Using Multi-Domain Server ..... 55\r\nData Centers ..... 57\r\nData Centers in an Enterprise ..... 59\r\nConfiguring VSX ..... 61\r\nOverview ..... 61\r\nRules and Security Policies ..... 61\r\nConfiguring VSX Gateways ..... 62\r\nCreating a New VSX Gateway ..... 62\r\nWizard Step 1: Defining VSX Gateway General Properties ..... 63\r\nWizard Step 2: Establishing SIC Trust ..... 63\r\nInitializing SIC Trust ..... 63\r\nTroubleshooting SIC Trust Initialization Problems ..... 63\r\nWizard Step 3: Defining Physical Interfaces ..... 63\r\nWizard Step 4: Virtual Network Device Configuration ..... 64\r\nWizard Step 5: VSX Gateway Management ..... 64\r\nCompleting the VSX Wizard ..... 65\r\nConfiguring the Security Policy ..... 65\r\nWorking with VSX Gateways ..... 66\r\n\r\nChanging VSX Gateway Definitions ..... 66\r\nVSX Gateway - General Properties ..... 66\r\nSecure Internal Communication (SIC) ..... 66\r\nCheck Point Software Blades ..... 67\r\nVSX Gateway - Physical Interfaces ..... 67\r\nVSX Gateway - Topology ..... 67\r\nInterfaces ..... 67\r\nRoutes ..... 68\r\nTopology Calculation ..... 69\r\nDeleting a VSX Gateway ..... 69\r\nBacking up and Restoring VSX Gateway ..... 69\r\nWorking with Virtual Systems ..... 70\r\nIntroduction ..... 70\r\nCreating a New Virtual System ..... 71\r\nModifying a Virtual System ..... 73\r\nConfiguring Bridge Interfaces in Regular Virtual Systems ..... 76\r\nDeleting a Virtual System ..... 78\r\nConfiguring DNS Servers on a Virtual System ..... 78\r\nConfiguring DHCP Server on a Virtual System ..... 84\r\nWorking with Virtual Switches ..... 85\r\nIntroduction ..... 85\r\nCreating a New Virtual Switch ..... 86\r\nModifying a Virtual Switch ..... 86\r\nVirtual Switch - General Properties ..... 87\r\nVirtual Switch - Topology ..... 87\r\nDeleting a Virtual Switch ..... 87\r\nWorking with Virtual Routers ..... 88\r\nIntroduction ..... 88\r\nCreating a New Virtual Router ..... 90\r\nModifying a Virtual Router Definition ..... 90\r\nVirtual Router - General Properties ..... 91\r\nVirtual Router - Topology ..... 91\r\nDeleting a Virtual Router ..... 91\r\nVirtual Routers in Virtual System Load Sharing Mode ..... 91\r\nWorking with Source-Based Routing ..... 92\r\n\r\nIntroduction ..... 92\r\nDefining Source-Based Routing Rules ..... 93\r\nCoreXL for Virtual Systems ..... 94\r\nIntroduction ..... 94\r\nConfiguring CoreXL on a VSX Gateway ..... 94\r\nConfiguring CoreXL on Virtual Systems ..... 95\r\nDynamic Routing for Virtual Devices ..... 96\r\nWorking with Interface Definitions ..... 97\r\nAdding a New Interface ..... 97\r\nChanging an Interface Definition ..... 99\r\nDeleting an Interface ..... 100\r\nWorking with Authentication ..... 101\r\nAuthentication Schemes ..... 101\r\nConfiguring SecurID Authentication ..... 102\r\nConfiguring RADIUS or TACACS Authentication ..... 102\r\nTracking the Status of VSX Objects ..... 105\r\nWorking with Network Address Translation (NAT) ..... 106\r\nConfiguring Application Control or URL Filtering on VSX ..... 109\r\nConfiguring Threat Prevention on VSX ..... 110\r\nLicensing VSX ..... 114\r\nVSX Licenses ..... 114\r\nUpgrading Licenses ..... 114\r\nThe Trial Period ..... 114\r\nUsing VSX with Multi-Domain Server ..... 115\r\nVSX Provisioning ..... 117\r\nDefining Multi-Domain Servers ..... 118\r\nWorking with Virtual Devices ..... 119\r\nAdding a Virtual System to a Domain Management Server ..... 119\r\nAdding Virtual Routers and Virtual Switches to a Domain Management Server ..... 119\r\nConfiguring VSX Clusters ..... 120\r\nVSX Cluster Overview ..... 120\r\nPhysical Clusters ..... 121\r\nVSX Clusters ..... 121\r\nPlanning a VSX Cluster Deployment ..... 123\r\nVSX Cluster Architecture ..... 123\r\n\r\nSynchronization Network ..... 123\r\nInternal Communication Network ..... 124\r\nVirtual IP Addresses ..... 124\r\nWorking with VSX Clusters ..... 125\r\nConfiguration Overview ..... 125\r\nCreating VSX Clusters ..... 125\r\nDefining Cluster General Properties ..... 125\r\nAdding VSX Cluster Member ..... 126\r\nDefining Cluster Interfaces ..... 126\r\nConfiguring VSX Cluster Members ..... 126\r\nCluster Management ..... 127\r\nCompleting the Wizard ..... 128\r\nModifying a VSX Cluster Definition ..... 129\r\nGeneral Properties ..... 129\r\nVSX Cluster Members ..... 129\r\nGateway VSX Cluster Member List ..... 130\r\nWhere Used ..... 130\r\nInternal IP Address and Net Mask ..... 130\r\nClusterXL ..... 130\r\nPhysical Interfaces ..... 131\r\nSynchronization ..... 131\r\nTopology ..... 131\r\nInterfaces ..... 131\r\nRoutes ..... 132\r\nCalculating Topology Automatically Based on Routing Information ..... 133\r\nVPN Domain ..... 133\r\nNAT ..... 133\r\nVSX Bridge Configuration ..... 134\r\nChanging the Cluster Management IP and/or Subnet ..... 134\r\nChanging the Internal Communication Network IP ..... 134\r\nWorking with VSX Cluster Members ..... 135\r\nAdding a New VSX Cluster Member ..... 135\r\nDeleting a VSX Cluster Member ..... 137\r\nChanging the VSX Cluster Type ..... 138\r\nConverting from High Availability to VSLS ..... 138\r\n\r\nConfiguring Virtual System Load Sharing ..... 140\r\nIntroduction ..... 140\r\nRequirements ..... 142\r\nVirtual System Priority ..... 142\r\nVirtual System Weight ..... 143\r\nVirtual System States ..... 143\r\nNormalized VSLS Deployment Scenario ..... 144\r\nVSX Cluster Member Failure Scenario ..... 145\r\nVirtual System Failure Scenario ..... 146\r\nFailure Recovery ..... 147\r\nConfiguring a VSX Cluster in VSLS Mode ..... 148\r\nViewing VSLS Status ..... 151\r\nDistributing Virtual Systems Between VSX Cluster Members ..... 152\r\nExporting and Importing VSLS Configuration ..... 154\r\nVirtual Routers in VSLS Mode ..... 157\r\nDescription of Virtual Router Groups ..... 157\r\nViewing the existing Virtual Router Groups on a Management Server ..... 157\r\nViewing the existing Virtual Router Groups on VSX Cluster Members ..... 159\r\nVSLS Weights in Virtual Router Groups ..... 159\r\nDistributing Virtual Systems that belong to a Virtual Router Group between VSX Cluster Members ..... 160\r\nVSX Cluster in the High Availability Mode ..... 161\r\nVirtual Switches in a High Availability VSX Cluster ..... 161\r\nAdvanced Clustering Configuration ..... 163\r\nMonitoring all VLANs in VSX Cluster ..... 163\r\nConfiguring CoreXL in a VSLS VSX Cluster ..... 163\r\nWorking with Link Aggregation ..... 164\r\nLink Aggregation Overview ..... 164\r\nHow Link Aggregation Works ..... 165\r\nLink Aggregation High Availability ..... 165\r\nLink Aggregation Load Sharing ..... 166\r\nBond Interface Limitations ..... 167\r\nConfiguring Bond High Availability Mode ..... 168\r\nConfiguring the High Availability Bond ..... 168\r\nUpdating the Interface Topology ..... 168\r\nReconfiguring the Bond ..... 169\r\n\r\nReconfiguring Topology with 'vsx_util change_interfaces' ..... 170\r\nConfiguring Bond Load Sharing Mode ..... 171\r\nConfiguring the Load Sharing Bond ..... 171\r\nSetting Critical Required Interfaces ..... 172\r\nAffinities of Bond Subordinate Interfaces to CPU Cores ..... 172\r\nBond Failover ..... 174\r\nLink State Initiated Failover ..... 174\r\nFailover Initiated by Cluster Control Protocol (CCP) ..... 174\r\nFailover Support for VLANs ..... 174\r\nConfiguring Cisco Switches for Link Aggregation Load Sharing Mode ..... 176\r\nFor 802.3ad (LACP) ..... 176\r\nFor XOR ..... 176\r\nTroubleshooting Bonded Interfaces ..... 177\r\nTroubleshooting Workflow ..... 177\r\nConnectivity Delays on Switches ..... 178\r\nWarning Regarding Use of PortFast ..... 178\r\nOptimizing VSX ..... 179\r\nMonitoring Memory Resources (vsx mstat) ..... 180\r\nMonitoring CPU Resources ..... 181\r\nSNMP Monitoring ..... 182\r\nSupported SNMP Versions ..... 182\r\nSupported SNMP Modes ..... 182\r\nSNMP Default Mode ..... 182\r\nSNMP VS Mode ..... 183\r\nSNMP VS in the \"vs-direct-access\" Mode ..... 184\r\nConfiguring SNMP Modes ..... 185\r\nExample SNMP queries for Virtual Systems ..... 187\r\nThe VSX SNMP Tree ..... 190\r\nConfiguring Jumbo Frames ..... 191\r\nJumbo Frames on a Virtual Switch ..... 191\r\nJumbo Frames on a Virtual Router ..... 191\r\nJumbo Frames on a Virtual System in Bridge Mode ..... 192\r\nBridge Mode ..... 193\r\nActive/Active Bridge Mode (Spanning Tree Protocol) ..... 193\r\nActive/Standby Bridge Mode ..... 194\r\n\r\nVLAN Shared Interface Deployment ..... 194\r\nVirtual System in Bridge Mode ..... 196\r\nCore Network Security ..... 196\r\nConfiguring Virtual Systems for the Active/Standby Bridge Mode ..... 197\r\nMulti Bridge Interfaces ..... 198\r\nVSX Cluster in Bridge Mode ..... 201\r\nEnabling Active/Standby Bridge Mode on a New VSX Cluster ..... 201\r\nEnabling Active/Standby Bridge Mode on an Existing VSX Cluster ..... 202\r\nEnabling Active/Active Bridge Mode on an Existing VSX Cluster ..... 203\r\nVSX Diagnostics and Troubleshooting ..... 204\r\nGeneral Troubleshooting Steps ..... 205\r\nTroubleshooting Specific Problems ..... 206\r\nCommand Line Reference ..... 210\r\nSyntax Legend ..... 211\r\ncpconfig ..... 212\r\ncpview ..... 215\r\nOverview of CPView ..... 215\r\nCPView User Interface ..... 215\r\nUsing CPView ..... 216\r\nvsenv ..... 217\r\nvsx ..... 218\r\nvsx fetch ..... 221\r\nvsx fetch_all_cluster_policies ..... 223\r\nvsx fetchvs ..... 224\r\nvsx get ..... 225\r\nvsx mstat ..... 226\r\nvsx showncs ..... 230\r\nvsx sicreset ..... 231\r\nvsx stat ..... 232\r\nvsx unloadall ..... 234\r\nvsx vspurge ..... 235\r\nvsx_util ..... 236\r\nvsx_util add_member ..... 240\r\nvsx_util change_interfaces ..... 242\r\nvsx_util change_mgmt_ip ..... 245\r\n\r\nvsx_util change_mgmt_subnet ..... 246\r\nvsx_util change_private_net ..... 247\r\nvsx_util convert_cluster ..... 248\r\nvsx_util downgrade ..... 249\r\nvsx_util reconfigure ..... 250\r\nvsx_util remove_member ..... 254\r\nvsx_util show_interfaces ..... 255\r\nvsx_util upgrade ..... 259\r\nvsx_util view_vs_conf ..... 260\r\nvsx_util vsls ..... 264\r\nvsx_provisioning_tool ..... 265\r\nTransactions ..... 268\r\nvsx_provisioning_tool Commands ..... 269\r\nExplicit Transaction Commands ..... 270\r\nAdding a VSX Gateway ..... 271\r\nAdding a VSX Cluster ..... 273\r\nAdding a Virtual Device ..... 275\r\nDeleting a Virtual Device ..... 278\r\nModifying Settings of a Virtual Device ..... 279\r\nAdding a Physical or VLAN Interface to a Virtual Device ..... 281\r\nAdding a Bridge Interface to a Virtual System ..... 284\r\nAdding a VPN Tunnel Interface to a Virtual Device ..... 286\r\nRemoving an Interface from a Virtual Device ..... 288\r\nModifying Settings of an Interface ..... 290\r\nConfiguring a Physical Interface as VLAN Trunk ..... 293\r\nAdding a Route ..... 294\r\nRemoving a Route ..... 296\r\nShowing Virtual Device Data ..... 297\r\nScript Examples ..... 298\r\nExample 1 ..... 298\r\nExample 2 ..... 299\r\nExample 3 ..... 299\r\nConfiguration Examples ..... 300\r\nExample 1: VSX Gateway managed by Security Management Server ..... 301\r\nTopology ..... 301\r\n\r\nAction Plan ..... 302\r\nExample 2: VSX Cluster managed by Multi-Domain Server ..... 311\r\nTopology ..... 312\r\nAction Plan ..... 314\r\nWorking with Kernel Parameters ..... 328\r\nKernel Debug on Security Gateway ..... 329\r\nGlossary ..... 330\r\n\r\n# Introduction \r\n\r\nThe VSX Administration Guide describes the Virtual System eXtension product that runs several virtual firewalls on the same hardware.\r\n\r\nEach Virtual System works as a Security Gateway, typically protecting a specified network. When packets arrive at the VSX Gateway, it sends traffic to the Virtual System protecting the destination network. The Virtual System inspects all traffic and allows or rejects it according to rules defined in the security policy.\r\n\r\nIn order to better understand how virtual networks work, it is important to compare physical network environments with their virtual (VSX) counterparts. While physical networks consist of many hardware components, VSX virtual networks reside on a single configurable VSX Gateway or cluster that defines and protects multiple independent networks, together with their virtual components.\r\n\r\n## Example Physical Network Topology\r\n\r\nIn a typical deployment with multiple Security Gateways, each protects a separate network.\r\nEach physical Security Gateway has interfaces to the perimeter router and to the network it protects.\r\n![[CP_R81.20_VSX_AdminGuide_img_1.jpeg]]\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 1 | Internet |\r\n| 2 | Router |\r\n| 3 | Security Gateways |\r\n| 4 | Network |\r\n\r\n# Example VSX Virtual Network Topology \r\n\r\nDeploy one VSX Gateway with four Virtual Systems to protect multiple networks.\r\n![[CP_R81.20_VSX_AdminGuide_img_2.jpeg]]\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 1 | Internet |\r\n| 2 | Router |\r\n| 3 | VSX Gateway. |\r\n|  | Each Virtual System in a VSX environment is a Security Gateway, with the same security and <br> networking functionality as a physical gateway. <br> Each handles packet traffic to and from the one network it protects. |\r\n| 4 | Warp Links. <br> Virtual interfaces and network cables connect the Virtual Systems and the Virtual Switch. |\r\n| 5 | Virtual Switch. <br> Connects all the Virtual Systems to the Internet router. |\r\n| 6 | Networks |\r\n\r\n# VSX Architecture and Concepts \r\n\r\nA VSX Gateway is a physical machine that hosts virtual networks of Virtual Devices, with the functionality of their physical network counterparts such as: Security Gateways, routers and switches.\r\n\r\nA VSX Gateway handles these tasks:\r\n\r\n- Communicates with the Management Server to deploy, configure, and manage all Virtual Devices.\r\n- Manages state synchronization for High Availability and for Load Sharing in cluster deployments.\r\n\r\n# Management Server Connections \r\n\r\nA Management Server (Security Management Server or Multi-Domain Server) connects to the VSX Gateway and provides provisioning and configuration services for Virtual Devices located on the VSX Gateway.\r\n\r\nYou can connect the Management Server to the VSX Gateway using one of the scenarios below.\r\n\r\n## Notes:\r\n\r\n- It is not supported to manage a VSX Gateway / VSX Cluster in these cases:\r\n- When the Management Server is behind NAT\r\n- When the VSX Gateway / VSX Cluster is behind NAT\r\n- It is not supported to manage a VSX Gateway / VSX Cluster when the management traffic passes through a Virtual System on the same VSX Gateway / VSX Cluster.\r\nOnly VS0 can communicate directly with the Management Server.\r\n- From R81, configuration with a Non-Dedicated Management Interface (Non-DMI, shared interface) is deprecated and not supported.\r\n\r\n\r\n## Local Management Connection\r\n\r\nThe Management Server connects directly to the VSX Gateway using a dedicated VSX management interface.\r\n\r\nWhen using a local Management Server (Security Management Server or Multi-Domain Server), all management traffic is handled by a Dedicated Management Interface (DMI) that connects the VSX Gateway to the Management Server. The IP address of this dedicated management interface can be either private or public.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_3.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 2 | Network 2 |  | 7 | Router |\r\n| 3 | Network 3 |  | 8 | Internet |\r\n| 4 | Network 4 |  | 9 | Management Server |\r\n| 5 | Switch |  | 10 | SmartConsole |\r\n\r\n# Remote Management Connection \r\n\r\nThe Management Server connects to the VSX Gateway by means of a router connected to a VSX management interface.\r\n\r\nThis method ensures segregation of management traffic from all other traffic.\r\nWhen using a remote Management Server (Security Management Server or Multi-Domain Server), management traffic travels via an internal or external network to a VSX Gateway to the management interface.\r\n\r\nThis architecture segregates management traffic from all other traffic passing through the VSX Gateway.\r\nCheck Point recommends that remote management connections use a dedicated management interface (DMI) that connects directly to a router or switch that leads to the external network or the Internet.\r\n![[CP_R81.20_VSX_AdminGuide_img_4.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 2 | Management Server |  | 10 | Warp Link |\r\n| 3 | Management traffic |  | 11 | Virtual System 1 |\r\n| 4 | Internet |  | 12 | Virtual System 2 |\r\n| 5 | Router |  | 13 | Switch |\r\n| 6 | Dedicated management interface (eth0) |  | 14 | Network 1 |\r\n| 7 | External interface |  | 15 | Network 2 |\r\n| 8 | VSX Gateway |  |  |  |\r\n\r\nWhen management traffic passes through a Virtual Router or Virtual Switch, you must ensure that the associated Warp Link IP address originates from the remote network.\r\n\r\nFurthermore, if the remote management connection arrives via the Internet, you must assign a routable, public IP address.\r\n\r\n# VSX Management Interface \r\n\r\n## Dedicated Management Interface (DMI)\r\n\r\nUses a separate interface on a VSX Gateway / VSX Cluster Members that is restricted to management traffic, such as provisioning, logging and monitoring.\r\n\r\nNote - Dedicated Management Interface (DMI) management is not supported through a physical interface (on the VSX Gateway / VSX Cluster Members) that has one or more VLAN interfaces configured.\r\n\r\nBest Practice - Use a DMI for management to segregate management traffic from routine \"production\" traffic enhanced performance, especially for end users.\r\n\r\n## Non-Dedicated Management Interface (Non-DMI)\r\n\r\nNote - From R81, configuration with a Non-Dedicated Management Interface (Non-DMI, shared interface) is deprecated and not supported.\r\n\r\n# Virtual Devices \r\n\r\nThis section describes virtual network components and their characteristics:\r\n\r\n## Virtual Systems\r\n\r\nA Virtual System is a virtual security and routing domain that provides the functionality of a Security Gateway with full Firewall and VPN facilities.\r\n\r\nMultiple Virtual Systems can run concurrently on a single VSX Gateway.\r\nEach Virtual System functions independently.\r\nEach Virtual System maintains its own Software Blades, interfaces, IP addresses, routing table, ARP table, and dynamic routing configuration. Each Virtual System also maintains its own:\r\n\r\n- State Tables: Each Virtual System has its own kernel tables with configuration and runtime data, such as active connections and IPsec tunnel information.\r\n- Security and VPN policies: Each Virtual System enforces its own security and VPN Policies (including INSPECT code). Policies are retrieved from the Management Server and stored separately on the local disk and in the kernel. In a Multi-Domain Server environment, each Domain database is maintained separately on the Management Server and on the VSX Gateway.\r\n- Configuration Parameters: Each Virtual System maintains its own configuration, such as IPS settings and TCP/UDP time-outs. Different Virtual Systems can run in Layer 2 or Layer 3 mode and co-exist on the same VSX Gateway.\r\n- Logging Configuration: Each Virtual System maintains its own logs and runs logging according to its own rules and configuration.\r\n\r\n\r\n## Virtual Routers\r\n\r\nA Virtual Router is an independent routing domain within a VSX Gateway that performs the functionality of physical routers.\r\n\r\nVirtual Routers are useful for connecting multiple Virtual Systems to a shared interface, such as the interface leading to the Internet, and for routing traffic from one Virtual System to another. Virtual Routers support dynamic routing.\r\n\r\nVirtual Routers perform the following routing functions:\r\n\r\n- Packets arriving at the VSX Gateway through a shared interface to the designated Virtual System based on the source or destination IP address.\r\n- Traffic arriving from Virtual Systems directed to a shared interface or to other Virtual Systems.\r\n- Traffic to and from shared network resources such as a DMZ.\r\n\r\nAs with physical routers, each Virtual Router maintains a routing table with a list of route entries describing known networks and directions on how to reach them.\r\n\r\nDepending on the deployment requirements, multiple Virtual Routers can be configured.\r\nTo protect themselves, Virtual Routers inspect all traffic destined to, or emanating from themselves (for example, an ICMP ping to the Virtual Router IP address) based on the security policy. Traffic that is not sent to, or coming from the Virtual Router is not inspected by the Virtual Router policy and is sent to its destination.\r\n\r\n# Virtual Switches \r\n\r\nBy providing Layer 2 connectivity, a Virtual Switch connects Virtual Systems and facilitates sharing a common physical interface without segmenting the existing IP network. As with a physical switch, each Virtual Switch maintains a forwarding table with a list of MAC addresses and their associated ports.\r\n\r\nIn contrast to a Virtual Router, when sharing a physical interface via a Virtual Switch there is no need:\r\n\r\n- To allocate an additional subnet for IP addresses of Virtual Systems connected to the switch.\r\n- To manually configure the routing on the routers adjacent to the shared interface.\r\n\r\nYou can create multiple Virtual Switches in a virtual network topology.\r\nNote - When sharing a physical interface via a Virtual Switch, the IP addresses for Virtual Systems connected to a Virtual Switch should be allocated from the same subnet as the shared interface. If the only function the Virtual Switch performs is to connect Virtual Systems, then the Virtual Switch can be defined without interfaces (unless Virtual System Load Sharing is enabled).\r\n\r\n# Interfaces \r\n\r\nThis section describes the various types of interfaces and how they are used in a VSX configuration.\r\n\r\n## Interface Types\r\n\r\nThe principal interface types are:\r\n\r\n- Physical Interface\r\n- VLAN interface\r\n- Warp Link (including unnumbered interfaces)\r\n![[CP_R81.20_VSX_AdminGuide_img_5.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 8 | Management Server |\r\n| 2 | Router |  | 9 | Virtual Switch |\r\n| 3 | Physical interface |  | 10 | Warp interface |\r\n| 4 | VLAN Switch |  | 11 | Virtual System 1 |\r\n| 5 | Network 1 |  | 12 | Virtual System 2 |\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 6 | Network 2 |  | 13 | VLAN Interface |\r\n| 7 | VSX Gateway |  | 14 | VLAN Trunk |\r\n\r\nNotes:\r\n\r\n- Warp Links connect the Virtual Switch to each Virtual System.\r\n- A Physical Interface connects the Virtual Switch to an external router leading to the Internet.\r\n- VLAN Interfaces connect the Virtual Systems to the VLAN Switch, via A VLAN trunk.\r\n- The VLAN switch connects to the protected networks.\r\n\r\n\r\n# Physical Interfaces \r\n\r\nPhysical interfaces connect a VSX Gateway to Management Server and to internal and external networks.\r\nThere are different types of physical interfaces used in a VSX Gateway:\r\n\r\n- Dedicated Management Interface: Connects the VSX Gateway to the Management Server when it is locally managed.\r\n\r\nIf the VSX Gateway is remotely managed, the management connection arrives through the external or internal interface.\r\n\r\n- External interface: Connects the VSX Gateway to the Internet or other untrusted networks.\r\n- Internal Interface: Connects the VSX Gateway to a protected network.\r\n- Synchronization Interface: Connects one VSX Cluster Member to other VSX Cluster Members for state synchronization.\r\n\r\nYou can install and configure more physical interfaces to a Virtual Device as required.\r\nA VSX Gateway can theoretically contain as many physical interfaces as permitted by VSX Gateway hardware and memory constraints.\r\n\r\n## VLAN Interfaces\r\n\r\nVirtual Systems typically connect to protected VLAN networks using IEEE 802.1q compliant VLAN Interfaces.\r\n\r\nThe networks are connected to ports on an 802.1q-compliant switch that trunks all traffic via a single physical interface to the VSX Gateway.\r\n\r\nVSX uses VLAN tags to direct the Ethernet frames to the specific Virtual System handling each network.\r\nVSX assigns a virtual VLAN interface to each VLAN tag on a specific physical interface.\r\nFor example: VLAN tag 100 on eth3 will be assigned a virtual interface named eth3.100.\r\n\r\n## Warp Links\r\n\r\nA Warp Link is a virtual point-to-point connection between a Virtual System and a Virtual Router or Virtual Switch.\r\n\r\nEach side of a Warp Link represents a virtual interface with the appropriate Virtual Device.\r\nVSX automatically assigns a name to each virtual interface when administrators create the link.\r\n\r\nWarp Interfaces on the Virtual System side are assigned the prefix wrp and those on the Virtual Router / Virtual Switch side are assigned the prefix wrpj.\r\n\r\nIn both cases, VSX appends a unique number to the prefix to form the interface name.\r\nWhen connected to a Virtual Switch, VSX also assigns a unique MAC address to each Warp Link.\r\n\r\n# Unnumbered Interfaces \r\n\r\nVSX lets you reduce the number of IP addresses required for a VSX network deployment when using one or more Virtual Routers.\r\n\r\nA Warp Link connected to a Virtual Router can \"borrow\" an existing IP address from another interface, instead of assigning a dedicated address to the interface leading to a Virtual Router.\r\n\r\nThis capability is known as an Unnumbered Interface.\r\n![[CP_R81.20_VSX_AdminGuide_img_6.jpeg]]\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 1 | VSX Gateway |\r\n| 2 | The external interface serves as the next hop from the Virtual Router |\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 3 | External |\r\n| 4 | Virtual Router |\r\n| 5 | Unnumbered External Interfaces IP \"borrowed\" from internal interfaces |\r\n| 6 | Internal Interfaces with predefined IP addresses |\r\n| 7 | Internal |\r\n\r\nIn this example, the external interfaces for each Virtual System are unnumbered and borrow the IP address of the internal interfaces.\r\n\r\nUnnumbered interfaces act as the next hop from the Virtual Router.\r\n\r\n# Unnumbered Interface Limitations \r\n\r\nThe following limitations apply to Unnumbered Interfaces:\r\n\r\n- Unnumbered interfaces must connect to a Virtual Router.\r\n- You can only \"borrow\" an individual interface IP address once.\r\n- In order to use VPN or Hide NAT, the borrowed address must be routable.\r\n\r\n# VSX Management Overview \r\n\r\nVSX supports two Check Point management models: Security Management Server and Multi-Domain Server.\r\n\r\nBoth models provide central configuration, management and monitoring for multiple VSX Gateways and Virtual Systems.\r\n\r\nThe choice of management model depends on several factors, including:\r\n\r\n- The scale of the current deployment and anticipated expansion\r\n- Administrative requirements\r\n- Physical and operational requirements\r\n- Licensing restrictions\r\n\r\nYou can use either management model to manage a \"physical\" Security Gateway together with a VSX Gateway and Virtual Systems.\r\n\r\nYou can also manage VPN communities and remote connections with either model.\r\n\r\nNote - According to the Check Point EULA (End User License Agreement), a Security Gateway can only manage security policies for Virtual Systems belonging to a single legal entity. In order to manage Virtual Systems belonging to multiple legal entities, you need to deploy a Multi-Domain Security Management solution with a separate Domain Management Server for each legal entity. For more information regarding Licensing, refer to your Check Point Reseller.\r\n\r\n## Security Management Server Model\r\n\r\nThe Security Management Server model is for enterprise deployments with many Virtual Systems, but one domain.\r\n\r\nSmartConsole connects to the VSX Gateway, which contains the Virtual Systems, and directly manages each Virtual System.\r\n\r\n## Multi-Domain Security Management Model\r\n\r\nWith Multi-Domain Security Management, you centrally manage multiple networks, typically of different Domains, divisions, or branches.\r\n\r\nThe Multi-Domain Server is the central management node that controls the policy databases for each of these networks.\r\n\r\nEach Domain network is managed by a Domain Management Server, which provides the full functionality of a Security Management Server and can host multiple Virtual Systems, virtual and physical devices.\r\n\r\nThe Domain Management Server that manages a VSX Gateway or VSX Cluster is the Main Domain Management Server.\r\n\r\nA VSX Gateway or VSX Cluster can host Virtual Systems that are managed by different Domain Management Servers.\r\n\r\nThe Domain Management Server that manages a VSX Virtual System or VSX Virtual Router is the Target Domain Management Server.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_7.jpeg]]\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 1 | SmartConsole |\r\n| 2 | Multi-Domain Server |\r\n| 3 | Domain Management Server |\r\n| 4 | Main Domain Management Server |\r\n| 5 | VSX Gateway |\r\n| 6 | Virtual Systems in Domain Management Servers |\r\n\r\nFrom a SmartConsole connected to a Multi-Domain Server, provision and configure Domains and Domain Management Servers.\r\n\r\nEach Domain Management Server uses its own SmartConsole instance to provision and configure its Virtual Systems, Virtual Devices, and policies.\r\n\r\n# Management Model Comparison \r\n\r\nThe following table summarizes the capabilities and differences between the two management models.\r\nThe capacity figures shown for Multi-Domain Server represent estimated, practical limits that will sustain acceptable performance levels under normal conditions.\r\n\r\nActual performance is dependent on many factors, including deployed hardware, network topology, traffic load and security requirements.\r\n\r\n| Feature | Security Management Server | Multi-Domain Server (Practical Limit) |\r\n| :-- | :-- | :-- |\r\n| Management Domains | 1 | 250 |\r\n| Concurrent Administrators | 1 | 250 |\r\n| Object Databases | 1 | 250 |\r\n| Policies | 250 | 250 |\r\n| Certificate Authorities | 1 | 250 |\r\n| Virtual Systems | 25 (recommended) | 250 |\r\n\r\n## Management Server Communication - SIC\r\n\r\nAll communication between the Management Server and the VSX Gateway is accomplished by means of Secure Internal Communication (SIC), a certificate based channel that authenticates communication between Check Point components.\r\n\r\nThe Management Server uses SIC for provisioning Virtual Devices, policy installation, logging, and status monitoring.\r\n\r\nSIC trust is initially established using a one-time password during configuration of the VSX Gateway or VSX Cluster Members.\r\n\r\nFor Multi-Domain Security Management deployments, SIC trust is established between the Domain Management Server associated with the VSX Gateway or VSX Cluster (Main Domain Management Server).\r\n\r\nThe Virtual Devices establish trust in a different manner than their physical counterparts.\r\nWhen you create a Virtual Device, VSX automatically establishes SIC trust using the secure communication channel defined between the Management Server and the VSX Gateway.\r\n\r\nThe VSX Gateway uses its management interface for Secure Internal Communication between the Management Server and all Virtual Devices.\r\n\r\n# VSX Traffic Flow \r\n\r\nIn This Section:\r\n\r\nOverview ..... 33\r\nContext Determination ..... 33\r\nDirect Connection to a Physical Interface ..... 33\r\nConnection through a Virtual Switch ..... 35\r\nConnection through a Virtual Router ..... 36\r\nSecurity Enforcement ..... 37\r\nForwarding to Destination ..... 37\r\n\r\n## Overview\r\n\r\nA VSX Gateway processes traffic according to the following steps:\r\n\r\n- Context determination\r\n- Security enforcement\r\n- Forwarding to destination\r\n\r\n\r\n## Context Determination\r\n\r\nVSX incorporates VRF (Virtual Routing and Forwarding) technology that allows creation of multiple, independent routing domains on a single VSX Gateway or VSX Cluster. The independence of these routing domains makes possible the use of Virtual Devices with overlapping IP addresses. Each routing domain is known as a context.\r\n\r\nWhen traffic arrives at a VSX Gateway, a process known as Context Determination directs traffic to the appropriate Virtual System, Virtual Router or Virtual Switch. The context determination process depends on the virtual network topology and the connectivity of the Virtual Devices.\r\n\r\nThe basic Virtual System connection scenarios are:\r\n\r\n- Virtual System directly connected to a physical or VLAN interface\r\n- Virtual System connected through a Virtual Switch\r\n- Virtual System connected through a Virtual Router\r\n\r\n\r\n## Direct Connection to a Physical Interface\r\n\r\nWhen traffic arrives at an interface (either physical or VLAN) that directly connects to a Virtual System, the connection itself determines the context and traffic passes directly to the appropriate Virtual System via that interface.\r\n\r\nThis diagram shows traffic from a physical VLAN switch that is sent to an interface on the VSX Gateway.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_8.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 8 | Virtual System 2 |\r\n| 2 | Router |  | 9 | VLAN Switch |\r\n| 3 | VSX Gateway |  | 10 | VLAN 100 |\r\n| 4 | Virtual Switch |  | 11 | VLAN 200 |\r\n| 5 | Virtual System 1 |  | ---- | VLAN Interface |\r\n| 6 | eth1.100 |  | -- | VLAN Trunk |\r\n| 7 | eth1.200 |  |  | Warp Link |\r\n\r\nVSX automatically directs traffic arriving via VLAN Interface eth1.200 to Virtual System 2 according to the context defined by the VLAN ID.\r\n\r\n# Connection through a Virtual Switch \r\n\r\nTraffic arriving via a Virtual Switch passes to the appropriate Virtual System based on the destination MAC address, as defined in the Virtual Switch forwarding table.\r\n\r\nTraffic arrives at the Virtual System via the Warp Link associated with the designated MAC address.\r\n![[CP_R81.20_VSX_AdminGuide_img_9.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 8 | MAC 00:12:C!:Ce:00:03 |\r\n| 2 | Router |  | 9 | VLAN Switch |\r\n| 3 | VSX Gateway |  | 10 | VLAN 100 |\r\n| 4 | Virtual Switch |  | 11 | VLAN 200 |\r\n| 5 | MAC 00:12:C!:Ce:00:01 |  | ---- | VLAN Interface |\r\n| 6 | Virtual System 1 |  | - | VLAN Trunk |\r\n| 7 | Virtual System 2 |  |  | Warp Link |\r\n\r\nIf the destination MAC address does not exist in the Virtual Switch forwarding table, the traffic is broadcast over all defined Warp Links.\r\n\r\nThe Virtual Switch scenario is common for inbound traffic from external networks or the Internet.\r\n\r\n# Connection through a Virtual Router \r\n\r\nTraffic arriving via a Virtual Router passes to the appropriate Virtual System based on entries in the Virtual Router routing table.\r\n\r\nRouting may be destination-based, source-based or both. Traffic arrives to the designated Virtual System via its Warp Link.\r\n![[CP_R81.20_VSX_AdminGuide_img_10.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 8 | 172.69 .22 .30 |\r\n| 2 | Router |  | 9 | VLAN Switch |\r\n| 3 | VSX Gateway |  | 10 | VLAN 100 |\r\n| 4 | Virtual Router |  | 11 | VLAN 200 |\r\n| 5 | 172.23 .10 .11 |  | ---- | VLAN Interface |\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 6 | Virtual System 1 |  |  | VLAN Trunk |\r\n| 7 | Virtual System 2 |  |  | Warp Link |\r\n\r\n# Security Enforcement \r\n\r\nSince each Virtual System functions as an independent Security Gateway, it maintains its own, unique security policy to protect the network behind it. The designated Virtual System inspects all traffic and allows or blocks it based on the rules contained in the security policy.\r\n\r\n## Forwarding to Destination\r\n\r\nEach Virtual System maintains its own unique configuration and rules for processing and forwarding traffic to its final destination. This configuration also includes definitions and rules for NAT, VPN, and other advanced features.\r\n\r\n# VSX Routing Concepts \r\n\r\nIn This Section:\r\nRouting Overview ..... 38\r\nRouting Between Virtual Systems ..... 38\r\nRoute Propagation ..... 40\r\nOverlapping IP Address Space ..... 40\r\nMore for Virtual Switch Route Propagation ..... 42\r\nNAT ..... 42\r\nDynamic Routing ..... 42\r\n\r\n## Routing Overview\r\n\r\nThe traffic routing features in VSX network topologies are analogous to those available for physical networks.\r\n\r\nThis section discusses several routing features and strategies as they apply to a VSX environment.\r\n\r\n## Routing Between Virtual Systems\r\n\r\nVirtual Routers and Virtual Switches can be used to send traffic between networks located behind Virtual Systems, much in the same way as their physical counterparts.\r\n\r\nThe figure below shows an example of how Virtual Systems, connected to a Virtual Switch and a physical VLAN switch, communicate with each other.\r\n\r\nIn this example, a host in VLAN 100 sends data to a server located in VLAN 200.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_11.jpeg]]\r\n\r\n| Item | Description | Item | Description |\r\n| :-- | :-- | :-- | :-- |\r\n| 1 | VLAN 100 | 7 | VLAN 200 |\r\n| 2 | VLAN Switch | 8 | VSX Gateway |\r\n| 3 | VLAN Trunk | ---- | VLAN Interface |\r\n| 4 | Virtual System 1 | ---- | VLAN Trunk |\r\n| 5 | Virtual Switch |  | Warp Link |\r\n| 6 | Virtual System 2 |  |  |\r\n\r\n1. Traffic from the VLAN 100 host arrives at the VLAN switch, which inserts a VLAN tag and sends it to the VSX Gateway by way of a VLAN trunk.\r\n2. Based on its VLAN tag, the VSX Gateway assigns the traffic to the Virtual System named VS1.\r\n3. VS1 inspects the traffic according to its security policy and sends the traffic on to the Virtual Switch. Based on its routing configuration, VS1 sends the traffic to VS2 by way of the Virtual Switch.\r\n4. VS2 inspects the traffic according to its security policy, inserts a VLAN tag, and sends it to back the VLAN switch.\r\n5. The VLAN switch sends the traffic to the server located on VLAN 200.\r\n\r\n# Route Propagation \r\n\r\nWhen a Virtual System is connected to a Virtual Router or to a Virtual Switch, you can choose to propagate its routing information to adjacent Virtual Devices.\r\n\r\nThis feature enables network nodes located behind neighboring Virtual Systems to communicate without the need for manual configuration.\r\n\r\nRoute propagation works by automatically updating Virtual Device routing tables with routes leading to the appropriate Virtual Systems.\r\n\r\n## Route Propagation using a Virtual Router\r\n\r\nWhen Virtual Systems are connected to a Virtual Router, VSX propagates routes by automatically adding entries to the routing table contained in the Virtual Router.\r\n\r\nEach entry contains a route pointing to the destination subnet using the Virtual System router-side Warp Interface (wr p) as the next hop.\r\n\r\n## Route Propagation using a Virtual Switch\r\n\r\nWhen Virtual Systems are connected to a Virtual Switch, VSX propagates routes by automatically adding entries to the routing table in each Virtual System.\r\n\r\nEach entry contains a route pointing to the destination subnet using the Virtual System Warp Interface (wr p) IP address.\r\n\r\n## Overlapping IP Address Space\r\n\r\nVSX facilitates connectivity when multiple network segments share the same IP address range (IP address space).\r\n\r\nThis scenario occurs when a single VSX Gateway protects several independent networks that assign IP addresses to endpoints from the same pool of IP addresses.\r\n\r\nThus, it is feasible that more than one endpoint in a VSX environment will have the identical IP address, provided that each is located behind different Virtual System.\r\n\r\nOverlapping IP address space in VSX environments is possible because each Virtual System maintains its own unique state and routing tables.\r\n\r\nThese tables can contain identical entries, but within different, segregated contexts.\r\nVirtual Systems use NAT to facilitate mapping internal IP addresses to one or more external IP addresses.\r\nThe below figure demonstrates how traffic passes from the Internet to an internal network with overlapping IP address ranges, using NAT at each Virtual System.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_12.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 6 | Virtual System 2 |\r\n| 2 | Router |  | 7 | Switch |\r\n| 3 | Virtual Switch |  | 8 | Network 1 |\r\n| 4 | VSX Gateway |  | 9 | Network 2 |\r\n| 5 | Virtual System 1 |  |  | Warp Link |\r\n\r\nIn this case, Network 1 and Network 2 share the same network address pool, which might result in identical overlapping IP addresses.\r\n\r\nTo prevent this, packets originating from or targeted to these networks are processed by their respective Virtual System using NAT to translate the original/overlapping addresses to unique routable addresses.\r\n\r\n# More for Virtual Switch Route Propagation \r\n\r\nYou are not required to manually define the topology, because this is done automatically.\r\nBut there are required manual steps in the VSX objects.\r\n\r\nTo update the topology map for each Virtual System after you enable route propagation:\r\n\r\n1. For each Virtual System object that is connected to the Virtual Switch:\r\na. Edit the object properties.\r\n\r\nMake sure Anti-Spoofing and VPN features are set correctly.\r\nb. Save the object.\r\n2. Install the security policy for the affected Virtual Systems.\r\n\r\n## NAT\r\n\r\nVirtual Systems support Network Address Translation (NAT), much in the same manner as a physical Security Gateway.\r\n\r\nWhen a Virtual System, using either Static or Hide NAT, connects to a Virtual Router, you must propagate the affected routes to the Virtual Router.\r\n\r\nTo do so, you need to first define NAT addresses for Virtual Systems connected to a Virtual Router.\r\n\r\n## Dynamic Routing\r\n\r\nThe Virtual Devices can communicate and distribute routes using dynamic routing.\r\nEach Virtual Device has its own routing daemon.\r\nVirtual Systems support:\r\n\r\n- OSPF\r\n- RIP\r\n- BGP\r\n- PIM\r\n\r\nVirtual Routers support:\r\n\r\n- OSPF\r\n\r\n# VSX Clusters \r\n\r\nA VSX Cluster has two or more identical, interconnected VSX Gateways for continuous data synchronization and transparent failover.\r\n\r\nVirtual System Load Sharing (VSLS) enhances throughput by distributing Virtual Systems, with their traffic load, among multiple, redundant machines.\r\n\r\nFor more about Check Point ClusterXL features and functionality see the R81.20 ClusterXL Administration Guide.\r\n\r\n## High Availability\r\n\r\nVSX supports High Availability and transparent failover for VSX Gateways and for Virtual Systems.\r\nIf the Active VSX Cluster Member fails, all sessions continue to run, securely and without interruption, on a Standby VSX Cluster Member.\r\n\r\nUsers stay connected and do not notice the failover. They are not required to authenticate again on failover.\r\nUse Selective Sync to activate, delay, or disable VSX Cluster Member synchronization.\r\n\r\n## Virtual System Load Sharing (VSLS)\r\n\r\nLoad Sharing offers significant performance advantages while providing failover for individual Virtual Systems.\r\n\r\nUsing multiple Gateways instead of a single gateway significantly increases performance for CPU intensive applications such as VPNs, Security Servers, Policy Servers, and Active Directory (LDAP).\r\n\r\nBy distributing Virtual System instances between different VSX Cluster Members, the performance load is efficiently spread amongst the VSX Cluster Members.\r\n\r\nFor example, Active Virtual System 1 runs on VSX Cluster Member A, while Active Virtual System 2 runs on VSX Cluster Member B.\r\n\r\nStandby and Backup Virtual System instances are likewise distributed amongst VSX Cluster Members to maximize throughput, even in a failover scenario.\r\n\r\nVSLS provides an excellent scalability solution, allowing administrators to add additional VSX Cluster Members to an existing VSLS cluster as traffic loads and performance requirements increase.\r\n\r\n# Deploying VSX - Internal Network Deployment Strategies \r\n\r\nIn This Section:\r\n\r\n| Security Gateway Deployment on a Physical Network ..................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................\r\n\r\n# Security Gateway Deployment on a Physical Network \r\n\r\nIn large physical network deployments, multiple Check Point security products, such as Security Gateways, are deployed to protect network segments.\r\n![[CP_R81.20_VSX_AdminGuide_img_13.jpeg]]\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 1 | Internet |\r\n| 2 | Router |\r\n| 3 | Security Gateways |\r\n| 4 | Network 1 |\r\n| 5 | Network 2 |\r\n\r\nEach Security Gateway physically connects to its own internal protected network and to a router for access to other internal networks and the Internet.\r\n\r\n# VSX Virtual System Deployment Strategies \r\n\r\nIn a VSX environment, Virtual Systems protect internal networks.\r\nThis section shows sample VSX deployments with Virtual Systems to protect internal networks.\r\nEach example highlights different VSX features.\r\nIn a real-world deployment, you can combine features to create a powerful cyber security solution for complex enterprise environments.\r\n\r\n## Physical Internal Interface for Each Virtual System\r\n\r\nIn a basic VSX configuration, Virtual Systems connect directly to protected internal networks through physical interfaces on the VSX Gateway.\r\n\r\nA Virtual Switch connects between internal networks, and to the Internet.\r\nThis deployment is suitable for protecting a small, fixed quantity of internal networks.\r\nThe main disadvantage of this deployment is that each protected network requires its own dedicated physical interface on the VSX Gateway.\r\n\r\nObviously, this deployment is not suitable for networks that require many Virtual Systems.\r\n![[CP_R81.20_VSX_AdminGuide_img_14.jpeg]]\r\n\r\n| Item | Description | Item | Description |\r\n| :-- | :-- | :-- | :-- |\r\n| 1 | Internet | 6 | Virtual System 2 |\r\n| 2 | Router | 7 | Switch |\r\n| 3 | Virtual Switch | 8 | Network 1 |\r\n| 4 | VSX Gateway | 9 | Network 2 |\r\n| 5 | Virtual System 1 | $\\ldots \\ldots \\ldots$ | Warp Link |\r\n\r\n# Virtual Systems with Internal VLAN Interfaces \r\n\r\nIn this deployment example, Virtual Systems connect to internal protected networks through VLAN interfaces.\r\n\r\nThe VSX Gateway connects to a VLAN switch with an 802.1q VLAN trunk, which is an aggregate of all VLANs passing through it.\r\n\r\nThis deployment option is appropriate for environments where many Virtual Systems protect many internal networks with one VSX Gateway or cluster.\r\n\r\nVLANs provide scalability and granularity, to provision more Virtual Systems and protected networks quickly, without changing the existing IP address structure.\r\n![[CP_R81.20_VSX_AdminGuide_img_15.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 8 | Management Server |\r\n| 2 | Router |  | 9 | Virtual Switch |\r\n| 3 | Physical interface |  | 10 | Warp interface |\r\n| 4 | VLAN Switch |  | 11 | Virtual System 1 |\r\n| 5 | Network 1 |  | 12 | Virtual System 2 |\r\n| 6 | Network 2 |  | 13 | VLAN Interface |\r\n| 7 | VSX Gateway |  | 14 | VLAN Trunk |\r\n\r\n# Internal Virtual Router with Source-Based Routing \r\n\r\nThis deployment scenario enables Virtual Systems to connect to protected networks using a single physical interface without VLAN technology.\r\n\r\nThe Virtual Router uses source-based routing rules to forward traffic to the appropriate Virtual System based on its source IP address.\r\n\r\nIn a VSX deployment with each Virtual System connected to a single Virtual Router: You can configure the Virtual Router to use source-based routing rules, to forward traffic to the appropriate Virtual System, based on the source IP address.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_16.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 7 | Virtual Router |\r\n| 2 | Router |  | 8 | Router |\r\n| 3 | Virtual Switch |  | 9 | Network 1 |\r\n| 4 | VSX Gateway |  | 10 | Network 2 |\r\n| 5 | VS 1 |  | $\\ldots \\ldots \\ldots .$. | Warp link |\r\n| 6 | VS 2 |  |  |  |\r\n\r\nNotes to this scenario:\r\n\r\n- Each Virtual System uses a public IP address to connect to the Virtual Switch.\r\n- Each local network connected to a Virtual Router uses private IP addresses.\r\n- This deployment does not support overlapping IP addresses.\r\n- Anti-Spoofing protection does function for packets originating from the shared internal interface.\r\n\r\nWe recommend that you configure the internal physical router to perform Anti-Spoofing protection.\r\n\r\n# Virtual Systems in Bridge Mode \r\n\r\nA Virtual System in bridge mode implements native Layer 2 bridging instead of IP routing and can co-exist with Layer 3 Virtual Systems on the same VSX Gateway.\r\n\r\nThis allows network administrators to easily and transparently deploy a Virtual System in an existing network topology without reconfiguring the existing IP routing scheme.\r\n\r\nBridge Mode deployments are particularly suitable for large-scale clustered environments.\r\nSee \"Bridge Mode\" on page 193.\r\n\r\n# Deploying VSX - Organizational Deployment Strategies \r\n\r\nIn This Section:\r\n\r\n| Enterprise Deployments | 51 |\r\n| :-- | --: |\r\n| Managed Service Providers Using Multi-Domain Server | 55 |\r\n| Data Centers | 57 |\r\n\r\nThis section presents deployment scenarios for different types of large organizations and illustrates how VSX provides security both internally and at the perimeter.\r\n\r\nThe discussion covers the following types of organizations:\r\n\r\n- Large Enterprises\r\n- Managed Service Providers\r\n- Data Centers\r\n\r\n\r\n## Enterprise Deployments\r\n\r\nLarge enterprise network environments typically have a variety of diverse networks, distributed over multiple locations around the world. These networks often have different security and access requirements for various departments and branches. The ability to centrally manage cyber security, and to maintain throughput, is a critical requirement.\r\n\r\n## Core Network Security\r\n\r\nMany Enterprise environments are based on core networks. Situated adjacent to core network backbone switches, VSX protects the internal network by providing security at Layer 2, Layer 3 or both. VSX communicates with the core network using the existing infrastructure. With Virtual Systems in the Bridge Mode, VSX can protect departmental networks, while simultaneously preventing network segmentation. In this case, switches are located at the entrance to each department's network.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_17.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 8 | LAN Switches |\r\n| 2 | Core Network Backbone switch |  | 9 | Sales |\r\n| 3 | VSX Cluster |  | 10 | Finance |\r\n| 4 | Router |  | - | Sync Network |\r\n| 5 | VLAN |  | - | Physical Interface |\r\n| 6 | Member 1 |  |  | VLAN Trunk |\r\n| 7 | Member 2 |  |  |  |\r\n\r\nVSX ensures connectivity between the core network and the Internet or external networks, while providing perimeter security.\r\n\r\nSecurity can be configured on a per VLAN basis.\r\n\r\n# Dynamic Routing \r\n\r\nIn an enterprise network with dynamic routing protocols (OSPF/BGP), VSX secures the DMZ services, VPN peers, Domains and partner networks.\r\n\r\nIn this example, BGP neighbor updates in the routed core network are selectively redistributed to application networks.\r\n\r\nOSPF provides connectivity between Virtual Routers, Virtual Systems, the core network and application networks.\r\n![[CP_R81.20_VSX_AdminGuide_img_18.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 6 | Partner Network |\r\n| 2 | Virtual Routers |  | 7 | BGP |\r\n| 3 | OSPF |  | 8 | OSPF 802.1q |\r\n| 4 | Virtual Systems |  | 9 | BGP in Routed Core |\r\n| 5 | Extranet |  | 10 | DMZ |\r\n\r\n## Perimeter Security\r\n\r\nFor example, security is enforced on each VLAN. The OSPF and BGP Dynamic routing protocols provide connectivity to multiple security zones along the perimeter.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_19.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Partner Access |  | 6 | BGP |\r\n| 2 | Customers |  | 7 | VSX Cluster |\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 3 | IPsec tunnel |  | 8 | 802.1q VLAN Trunk |\r\n| 4 | Internet |  | 9 | Internal Network |\r\n| 5 | Partner |  | 10 | DMZ |\r\n\r\n# Notes to this scenario: \r\n\r\n- Partners access network resources remotely via Virtual Systems\r\n- Each Virtual System has its own security policy based on its requirements\r\n- Logs and audit information for each partner are collected separately, and saved to a private database\r\n- Applications and services are segregated by private Virtual Systems\r\n- Multiple Virtual Routers / Virtual Switches are used to control the access paths\r\n\r\n\r\n## Managed Service Providers Using Multi-Domain Server\r\n\r\nManaged service providers give connectivity and security services for Domain networks.\r\nSome of these Domains require remote access capabilities.\r\nIn this service oriented environment, VSX and Multi-Domain Server provide central management and make connectivity and security easier, without affecting the existing IP topology.\r\n\r\nIn this scenario, a VSX Cluster is in a Point of Presence (POP) deployment for a service provider.\r\nVSX consolidates hardware for the service provider and ensures privacy and secure connectivity solutions (VPN) for users.\r\n\r\nThis scenario is appropriate for High Availability and Virtual System Load Sharing cluster modes.\r\nVSX and Multi-Domain Server provide a centralized, granular provisioning system for a number of Domains.\r\nApplications and services are separated by discrete Virtual Systems.\r\nAccess to these services and applications is based on need.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_20.jpeg]]\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 1 | Internet. Routers are between the VSX Cluster Members and the Internet. |\r\n| 2 | VSX Cluster. One VSX Cluster Member handles the Local Exchange, and another VSX <br> Cluster Member handles server traffic of different Domains. |\r\n| 3 | Core IP VPN Network. |\r\n| 4 | Multi-Domain Server at the Network Operation Center monitors POP and connects to VSX <br> Gateway. <br> The Multi-Domain Log Server in the NOC collects data for each Domain and stores the logs in <br> separate private databases. |\r\n| 5 | Multi-Domain Server at the NOC and the VSX Gateway make the Local Exchange. |\r\n| 6 | Domain A web servers. |\r\n| 7 | Domain B DMZ. |\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 8 | Domain C mail servers. |\r\n| 9 | PE Router. |\r\n| 10,11, | Domain A, B, and C. |\r\n| 12 | Each Domain manages its own security and cannot define Virtual Systems or other network <br> components. |\r\n| 13 | Domains have secure VPN connectivity. <br> Remote access |\r\n\r\n# Data Centers \r\n\r\nData center providers supply external hosting services for Domain servers and databases.\r\nThe service typically includes infrastructure, connectivity, and security for multiple Domains.\r\nFor example, you can have a scenario such as:\r\n\r\n- Multiple Domain networks sharing a common physical infrastructure.\r\n- Backbone that provides connectivity between each Domain and the data center.\r\n- Domain A connects to its web hosting servers.\r\n- Domain B connects to its mail servers.\r\n- Domain C connects to its database servers.\r\n\r\nFor cyber security and management, the data center provider deploys a VSX Gateway with one Virtual System for each Domain.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_21.jpeg]]\r\n\r\n| Item | Description | Item | Description |\r\n| :-- | :-- | :-- | :-- |\r\n| 1 | Remote Users | 10 | Virtual System for Customer A |\r\n| 2 | Internet | 11 | Virtual System for Customer C |\r\n| 3 | Remote network behind VPN- <br> 1 Edge | 12 | Customer C |\r\n| 4 | Customer B | 13 | Data Center |\r\n| 5 | Customer A | 14 | Customer A web servers each with <br> separate VLAN ID |\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 6 | MPLS Backbone |  | 15 | Customer B mail servers |\r\n| 7 | 802.1 q |  | 16 | Customer A Extranet |\r\n| 8 | VSX Gateway |  | 17 | Customer C databases |\r\n| 9 | Virtual System for Customer A |  |  |  |\r\n\r\nThis scenario offers a cost effective scalability solution for network expansion by means of remote connectivity.\r\n\r\nIn this example, a VPN connection between a Domain Virtual System and a Check Point appliance that protects a remote network, integrates that network in the MPLS core.\r\n\r\nA Virtual System can give access to remote users who connect intermittently.\r\n\r\n# Data Centers in an Enterprise \r\n\r\nThis example scenario illustrates how VSX provides security management for enterprise data centers.\r\nBy assigning Layer 2 connections to Virtual Systems, VSX reduces the number of physically managed devices within a data center while providing the same high level of security.\r\n\r\nFor example, a VSX Gateway allows authorized users to access data center resources.\r\nThe objective here is to protect shared resources with differing access permissions and security requirements, while implementing network granularity.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_22.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 7 | VLAN Trunk |\r\n| 2 | VSX Gateway |  | 8 | Web Servers VLAN 02 |\r\n| 3 | VLAN 02 |  | 9 | Data Bases VLAN 03 |\r\n| 4 | VLAN 03 |  | 10 | Application A VLAN 04 |\r\n| 5 | VLAN 04 |  | 11 | Application B VLAN 05 |\r\n| 6 | VLAN 05 |  |  |  |\r\n\r\nFor example, one Virtual System protects databases against SQL vulnerabilities.\r\nAnother Virtual System protects Web Servers using IPS.\r\nWhen new applications and services are added to the enterprise data center, new Virtual Systems are easily created to secure them according to their specific requirements.\r\n\r\n# Configuring VSX \r\n\r\n## Overview\r\n\r\nThis chapter explains how to use SmartConsole provision, configure and manage Virtual Devices in a VSX environment.\r\n\r\nIf you define or configure VSX objects in a Multi-Domain Server deployment: connect with SmartConsole to the Domain Management Server that manages the Virtual Devices. For procedures, see \"Using VSX with Multi-Domain Server\" on page 115.\r\n\r\nTo configure Virtual Devices, make sure:\r\n\r\n- The Management Servers (Security Management Server or Multi-Domain Server) are configured and running.\r\n- SmartConsole is installed on the appropriate computer.\r\n\r\nThis chapter assumes that you are familiar with SmartConsole and how to configure standard Security Gateway objects and Security Policies.\r\n\r\nMany Virtual Device and policy operations are the same as physical Security Gateways and these standard procedures are not in this Administration Guide.\r\n\r\n## Rules and Security Policies\r\n\r\nYou use the same procedures to define and install Security Policies on a VSX Gateway or Virtual System as for a physical Security Gateway.\r\n\r\nThis statement also applies to the use of IPv6 in Security Policies. These procedures are not included in this Administration Guide.\r\n\r\n# Configuring VSX Gateways \r\n\r\nIn This Section:\r\n\r\n| Creating a New VSX Gateway | .62 |\r\n| :--: | :--: |\r\n| Wizard Step 1: Defining VSX Gateway General Properties | .63 |\r\n| Wizard Step 2: Establishing SIC Trust | .63 |\r\n| Wizard Step 3: Defining Physical Interfaces | .63 |\r\n| Wizard Step 4: Virtual Network Device Configuration | .64 |\r\n| Wizard Step 5: VSX Gateway Management | .64 |\r\n| Completing the VSX Wizard | .65 |\r\n| Configuring the Security Policy | .65 |\r\n\r\n## Creating a New VSX Gateway\r\n\r\n## Notes:\r\n\r\n- It is not supported to convert an existing Security Gateway to a VSX Gateway.\r\n- It is not supported to convert an existing VSX Gateway to a Security Gateway.\r\n\r\nThis section explains how to create a new VSX Gateway using the VSX Gateway Wizard.\r\nAfter you complete the VSX Gateway Wizard, you can change the VSX Gateway definition from SmartConsole.\r\n\r\nFor example, you can add or delete interfaces, or configure existing interfaces to support VLANs.\r\n\r\nTo start the VSX Gateway wizard:\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Main Domain Management Server that manages the VSX Gateway.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. At the top, click New > VSX > Gateway.\r\n\r\nThe General Properties page of the VSX Gateway Wizard opens.\r\n\r\n# Wizard Step 1: Defining VSX Gateway General Properties \r\n\r\nConfigure these parameters on the General Properties page:\r\n\r\n- VSX Gateway Name: Unique, alphanumeric name for the VSX Gateway. The name cannot contain spaces or special characters except the underscore.\r\n- VSX Gateway Addresses: Management interface addresses.\r\n\r\nNote - If you define an IPv6 IP address you must also define an IPv4 address.\r\n\r\n- VSX Gateway Version: Select the VSX version installed on the VSX Gateway from the drop-down list.\r\n\r\n\r\n## Wizard Step 2: Establishing SIC Trust\r\n\r\nInitialize SIC trust between the VSX Gateway and the Management Server.\r\nThey cannot communicate without Trust.\r\n\r\n## Initializing SIC Trust\r\n\r\nWhen you create a VSX Gateway, you must enter the same Activation Key you entered during the First Time Configuration Wizard.\r\n\r\nEnter and confirm the activation key and then click Initialize.\r\nIf you enter the correct activation key, the Trust State changes to Trust established.\r\n\r\n## Troubleshooting SIC Trust Initialization Problems\r\n\r\nIf SIC trust was not successfully established, click Check SIC Status to see the reason for the failure.\r\nThe most common issues are an incorrect activation key and connectivity problems between the Management Server and the VSX Gateway.\r\n\r\nTroubleshooting to resolve SIC initialization problems:\r\n\r\n- Re-enter and re-confirm the activation key.\r\n- Make sure that the IP address defined in General Properties is correct.\r\n- Ping the Management Server to test the connectivity. Resolve connectivity issues.\r\n- From the VSX Gateway command line, use the cpconfig command to re-initialize SIC.\r\n\r\nAfter this process completes, click Reset in the wizard and then re-enter the activation key.\r\nFor more about resolving SIC initialization, see the R81.20 Security Management Administration Guide.\r\n\r\n## Wizard Step 3: Defining Physical Interfaces\r\n\r\nIn the VSX Gateway Interfaces window, define physical interfaces as VLAN trunks.\r\nThe window shows the interfaces currently defined on the VSX Gateway.\r\nTo define an interface as a VLAN trunk, select VLAN Trunk for the interface.\r\n\r\n# Wizard Step 4: Virtual Network Device Configuration \r\n\r\nNote - Configuration with a Non-Dedicated Management Interface (Non-DMI, shared interface) is deprecated and not supported.\r\n\r\nIf you chose the Custom Configuration option, the Virtual Network Device Configuration window opens. In this window, define a Virtual Device with an interface shared with the VSX Gateway.\r\n\r\nIf you do not want to define a Virtual Device at this time, click Next to continue.\r\n\r\nTo define a Virtual Device with a shared interface:\r\n\r\n1. Select Create a Virtual Device.\r\n2. Select the Virtual Network Device type (Virtual Router or Virtual Switch).\r\n3. Select the Shared physical interface to define a non-DMI VSX Gateway.\r\n\r\nDo not select the management interface if you want to define a Dedicated Management Interface (DMI) VSX Gateway.\r\n\r\nIf you do not define a shared Virtual Device, a DMI VSX Gateway is created by default.\r\n\r\nImportant - This setting cannot be changed after you complete the VSX Gateway Wizard. If you define a non-DMI VSX Gateway, you cannot change it to a DMI VSX Gateway later.\r\n4. Define the IP address and Net Mask for a Virtual Router.\r\n\r\nThese options are not available for a Virtual Switch.\r\n5. Optional: Define a Default Gateway for a Virtual Router (DMI only).\r\n\r\n## Wizard Step 5: VSX Gateway Management\r\n\r\nIn the VSX Gateway Management window, define security policy rules that protect the VSX Gateway. This policy is installed automatically on the new VSX Gateway.\r\n\r\nNote - This policy applies only to traffic destined for the VSX Gateway. Traffic destined for Virtual Systems, other Virtual Devices, external networks, and internal networks is not affected by this policy.\r\n\r\nThe security policy consists of predefined rules for these services:\r\n\r\n- UDP - SNMP requests\r\n- TCP - SSH traffic\r\n- ICMP - ICMP Echo (ping)\r\n- TCP - HTTPS traffic\r\n\r\n# Completing the VSX Wizard \r\n\r\nClick Next to continue and then click Finish to complete the VSX Gateway wizard.\r\nThis may take several minutes to complete.\r\nA message shows successful or unsuccessful completion of the process.\r\nIf the process ends unsuccessfully, click View Report to see the error messages.\r\nSee \"VSX Diagnostics and Troubleshooting\" on page 204.\r\n\r\n## Configuring the Security Policy\r\n\r\n1. Allow: Select to pass traffic on the selected services.\r\n\r\nClear this option to block traffic on this service.\r\nBy default, all services are blocked.\r\nFor example, to be able to ping the VSX Gateway from the Management Server, allow ICMP traffic.\r\n2. Source: Click the arrow and select a Source Object from the list.\r\n\r\nThe default value is *Any.\r\nClick New Source Object to define a new source.\r\n\r\n# Working with VSX Gateways \r\n\r\nIn This Section:\r\n\r\nChanging VSX Gateway Definitions ..... 66\r\nDeleting a VSX Gateway ..... 69\r\nBacking up and Restoring VSX Gateway ..... 69\r\n\r\nA VSX Gateway is a physical machine that serves as a container for Virtual Systems and other virtual network components.\r\n\r\nThis section has step-by-step procedures for creating and configuring standalone VSX Gateways.\r\n\r\n## Changing VSX Gateway Definitions\r\n\r\nAfter you create a VSX Gateway, you can modify the topology, other parameters, and advanced configurations in the VSX Gateway Properties window.\r\n\r\nTo open this window, double-click on the VSX Gateway object in SmartConsole.\r\nThe VSX Gateway Properties window opens.\r\n\r\n## VSX Gateway - General Properties\r\n\r\nIn the General Properties page, check and re-establish SIC trust, and activate Check Point products for this VSX Gateway.\r\n\r\nYou can change these properties:\r\n\r\n- Comment - Free text description for the Object List and elsewhere.\r\n- Color - Color of the object icon as it appears in the Object Tree.\r\n- Secure Internal Communication - Check and re-establish SIC trust.\r\n- Check Point Products - Select Check Point products for this VSX Gateway.\r\n\r\n\r\n## Secure Internal Communication (SIC)\r\n\r\nYou can test and reset SIC trust and also see the VSX Gateway Relative Distinguished Name.\r\n\r\n## To initialize SIC trust:\r\n\r\n1. In Gateways \\& Servers view or Object Explorer, double-click the VSX Gateway.\r\n\r\nYou can also search for the VSX Gateway in the Object Explorer.\r\n2. In the VSX Gateway Properties window, click Communication.\r\n3. In the Trusted Communication window, enter and confirm the SIC Activation Key.\r\n4. Click Initialize.\r\n\r\nNote - If you cannot establish trust, click Test SIC Status to see the reason for the failure. The most common issues are an incorrect activation key and connectivity problems between the Management Server and the VSX Gateway.\r\n\r\nTo reset SIC trust with the VSX Gateway:\r\n\r\n1. From the VSX Gateway CLI, use the cpconfig utility to re-initialize the SIC.\r\n2. In the Communication window, click Reset.\r\n3. Click Yes in the confirmation window.\r\n4. Enter and confirm the SIC authentication password.\r\n5. Click Initialize.\r\n6. Install the applicable policy (<Name of VSX Gateway Object>_VSX) on the VSX Gateway object only.\r\n7. On the VSX Gateway CLI, run: cpstop; cpstart\r\n\r\n# Check Point Software Blades \r\n\r\nSelect the Check Point Software Blades to install on this VSX Gateway from the list. The items you see are available for the product version and your license agreement.\r\n\r\n## VSX Gateway - Physical Interfaces\r\n\r\nThe Physical Interfaces page lets you add or delete a physical interface on the VSX Gateway, and to define a VLAN trunk.\r\n\r\n- To add a new physical interface, click Add and enter the interface name in the appropriate field.\r\n- To remove a physical interface, select the interface and click Remove.\r\n- To define an interface as a VLAN trunk, select VLAN Trunk for the interface.\r\n\r\n\r\n## VSX Gateway - Topology\r\n\r\nThe Topology page contains definitions for interfaces and routes between interfaces and Virtual Devices.\r\n\r\n## Interfaces\r\n\r\nThe Interfaces section defines interfaces and links to devices. You can add new interfaces, and delete or modify existing interfaces.\r\n\r\nTo add an interface:\r\n\r\n1. Click New and select one of these options:\r\n\r\n- Regular - Create a new interface\r\n- Leads to Virtual Router\r\n- Leads to Virtual Switch\r\n\r\nThe Interface Properties window opens.\r\nClick Actions > Copy to Clipboard to copy the Interfaces table in CSV format.\r\n2. Define the appropriate properties. See \"Working with Interface Definitions\" on page 97.\r\n3. Click OK.\r\n\r\n# Routes \r\n\r\nThe Routes section of the Topology window defines routes between network devices, network addresses, and Virtual Devices. Some routes are defined automatically based on the interface definitions. You can add, change, and delete routes.\r\n\r\nTo add a default route to the routing table:\r\n\r\n1. Click Add Default Route.\r\n\r\nThe Default Gateway window opens.\r\n2. Enter the default route IP address or select the default Virtual Router.\r\n3. Click OK.\r\n\r\nThe default route is added to the routing table.\r\n4. Select the default route and click Edit.\r\n\r\nThe Route Configuration window opens.\r\n5. Configure the settings for the default route.\r\n6. Click OK.\r\n\r\nTo add a new route to the routing table:\r\n\r\n1. Click Add.\r\n\r\nThe Route Configuration window opens.\r\n2. Configure the Destination IP address and netmask.\r\n3. Configure the next hop IP address or Virtual Router.\r\n4. Optional: Select Propagate route to adjacent Virtual Devices to \"advertise\" the route to neighboring Virtual Devices, and enable connectivity between them.\r\n5. Click OK.\r\n\r\nTo change a route:\r\n\r\n1. Select the route.\r\n2. Click Edit.\r\n\r\nThe Route Configuration window opens.\r\n3. Change the settings.\r\n4. Click OK.\r\n\r\nTo delete a route:\r\n\r\n1. Select the route.\r\n2. Click Remove.\r\n\r\nA confirmation window opens.\r\n3. Click OK.\r\n\r\nTopology Calculation\r\nSelect the Calculating topology automatically based on routing information option to let VSX automatically calculate the network topology based on interface and routing definitions. When enabled, VSX creates automatic links, or connectivity cloud objects linked to existing internal or external networks.\r\n\r\n- This option is not available in Bridge Mode.\r\n- We recommend that you do not use this option with dynamic routing configurations.\r\n\r\nNote - If you wish to enable Anti-Spoofing protection when there are no routes pointing to internal networks, disable the Calculating topology automatically based on routing information option. Modify the appropriate interface definitions to enable Anti-Spoofing.\r\n\r\n# Deleting a VSX Gateway \r\n\r\nWhen you delete a VSX Gateway object, the operation automatically deletes all Virtual Systems and other Virtual Devices associated with that VSX Gateway from the management database.\r\n\r\nTo delete a VSX Gateway:\r\n\r\n1. From the Gateways \\& Servers view or Object Explorer tree, right-click the VSX Gateway object on the Object Tree and select Delete.\r\n2. In the window that opens, click Yes.\r\n\r\n## Backing up and Restoring VSX Gateway\r\n\r\nIn the event of a catastrophic VSX Gateway failure, you can restore the VSX Gateway configuration and its Virtual Device configuration.\r\n\r\nFollow the instructions in the sk100395: How to backup and restore VSX Gateway.\r\n\r\n# Working with Virtual Systems \r\n\r\nIn This Section:\r\n\r\n| Introduction | .70 |\r\n| :--: | :--: |\r\n| Creating a New Virtual System | 71 |\r\n| Modifying a Virtual System | 73 |\r\n| Configuring Bridge Interfaces in Regular Virtual Systems | 76 |\r\n| Deleting a Virtual System | 78 |\r\n| Configuring DNS Servers on a Virtual System | 78 |\r\n| Configuring DHCP Server on a Virtual System | 84 |\r\n\r\nThis section presents procedures for creating and configuring Virtual Systems.\r\n\r\n## Introduction\r\n\r\nThe Virtual System definition process varies somewhat according to the template selected when creating the VSX Gateway.\r\n\r\nA typical Virtual System contains two interfaces:\r\n\r\n- External interface leading to external networks, a DMZ, or the Internet\r\n- Internal interface leading to internal networks or servers, often by means of a VLAN trunk\r\n\r\nVSX supports up to 128 interfaces for each Virtual Device and a total of up to 4096 interfaces per VSX Gateway or cluster.\r\n\r\nThe supported interfaces include VLANs and Warp Links.\r\n\r\nNote - By default, a Virtual System supports up to 64 interfaces. For more about how to increase the number of supported interfaces, see sk99121.\r\n\r\nYou can add as many interfaces to a Virtual System as required, according to system resources.\r\nHere is an example of a typical VSX Gateway deployment with two Virtual Systems, each with two interfaces.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_23.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 8 | Virtual System 2 |\r\n| 2 | Router |  | 9 | VLAN Switch |\r\n| 3 | VSX Gateway |  | 10 | Network 1 |\r\n| 4 | Virtual Switch |  | 11 | Network 2 |\r\n| 5 | External Interface |  | ---- | VLAN Interface |\r\n| 6 | Virtual System 1 |  | - | VLAN Trunk |\r\n| 7 | Internal Interface |  | $\\ldots \\ldots \\ldots .$. | Warp Link |\r\n\r\n# Creating a New Virtual System \r\n\r\nYou use the Virtual Systems Wizard to create a new Virtual System. Modify the initial definition and configure advanced options after you complete the wizard.\r\n\r\n# To start the Virtual System wizard: \r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the new Virtual System.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. Create a new Virtual System object in one of these ways:\r\n\r\n- From the top toolbar, click the New ( ${ }^{(4)}$ ) > VSX > New Virtual System.\r\n- In the top left corner, click Objects menu > More object types > Network Object > Gateways and Servers > VSX > New Virtual System.\r\n- In the top right corner, click Objects Pane > New > More > Network Object > Gateways and Servers > VSX > Virtual System.\r\n\r\nThe Virtual System Wizard opens.\r\n4. Configure the applicable settings in the wizard as described below.\r\n5. Install the applicable Access Control Policy on the new Virtual System object.\r\n\r\n## Wizard - Defining General Properties\r\n\r\nThe General Properties wizard page defines the Virtual System object and the hosting VSX Gateway.\r\nThese are the parameters in this page:\r\n\r\n- Name: Unique, alphanumeric for the Virtual System. The name cannot contain spaces or special characters except the underscore.\r\n- VSX Gateway / Cluster: Select the VSX Gateway that is hosting the Virtual System.\r\n- Bridge Mode: Select this option to create a Virtual System in the Bridge Mode.\r\n\r\n\r\n## Wizard - Defining Network Configuration\r\n\r\nIn the Virtual System Network Configuration page, define internal and external interfaces and the IP address topology behind the internal interface.\r\n\r\n## Non-Bridge Mode\r\n\r\nImportant - From R81.10, it is possible:\r\n\r\n- To add bridge interfaces to regular Virtual Systems in SmartConsole.\r\n- To configure regular Virtual Systems without an IP address that contain only bridge interfaces.\r\n\r\nSee \"Configuring Bridge Interfaces in Regular Virtual Systems\" on page 76.\r\n\r\nTo configure the external and internal interfaces:\r\n\r\n1. In the Interfaces section, configure the applicable interfaces.\r\n\r\nYou can add interfaces, delete, and change interfaces.\r\nTo add an interface, click Add, select an interface type from the list and configure its properties.\r\n2. Select the Main IP Address from the list.\r\n\r\nThis IP address is usually assigned to the external interface and specifies the Virtual System address used with NAT or VPN connections.\r\n\r\nTo make an external IP address routable, select the external interface IP address as the main IP address.\r\n3. Define network routing for your deployment.\r\n\r\nSome routes are automatically defined by the interface definitions.\r\nFor example, you define a default gateway route leading to an external Virtual Router or to the Virtual System external interface.\r\n\r\nTo manually add a default route to the Routes table, click Add Default Routes.\r\nEnter the default route IP address, or select the default Virtual Router.\r\nThe Route Configuration window opens.\r\n4. Complete the definition.\r\n\r\n# Bridge Mode \r\n\r\nInterfaces: To configure the external and internal interfaces, define interfaces and links to devices in the Interfaces section. You can add, change, and remove interfaces. To add an interface, click Add. The Interface Properties window opens. Select an interface from the list and define is properties.\r\n\r\n## Wizard - Completing the Definition\r\n\r\nClick Next and then click Finish to create the Virtual System.\r\nNote that this may take several minutes to complete.\r\nA message appears indicating successful or unsuccessful completion of the process.\r\nIf the process ends unsuccessfully, click View Report to view the error messages.\r\nFor further assistance, see \"VSX Diagnostics and Troubleshooting\" on page 204.\r\nAfter you create a Virtual System using the Virtual System Wizard, you can modify the topology and all other parameters (except the name of the Virtual System) using the Virtual System Properties window.\r\n\r\n## Modifying a Virtual System\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server used to manage the Virtual System.\r\n2. From the Gateways \\& Servers view or Object Explorer, double-click the Virtual System object.\r\n3. Configure the applicable settings as described below.\r\n4. Click OK to push the VSX Configuration.\r\n5. Install the applicable Access Control Policy on the new Virtual System object.\r\n\r\n## General Properties\r\n\r\nThe General Properties page lets you specify the main IP address and to enable various Check Point products for a Virtual System.\r\n\r\n# Topology \r\n\r\nThe Topology page contains definitions for Virtual System interfaces, routes and Warp Links. Based on these interface settings, VSX automatically creates routes to Virtual Devices and the VSX Gateway.\r\n\r\nNote - If you modify the topology for a specific Virtual System in a cluster environment, the cluster topology is not updated until you install a policy on that Virtual System.\r\n\r\n- Interfaces: The Interfaces section defines interfaces and links to devices. You can add new interfaces as well as delete and modify existing interfaces.\r\n\r\nTo add an interface, click New and select one of these options:\r\n\r\n- Regular - To select a physical interface\r\n- Leads to Virtual Router - To attach this Virtual System to a Virtual Router\r\n- Leads to Virtual Switch - To attach this Virtual System to a Virtual Switch\r\n- Bridge - From R81.10, it is possible to add bridge interfaces to regular Virtual Systems in SmartConsole. See \"Configuring Bridge Interfaces in Regular Virtual Systems\" on page 76.\r\n\r\nThe Interface Properties window opens. Select the interface from the list and define the appropriate properties. The section\"Working with Interface Definitions\" on page 97 and the SmartConsole online help provide explanations of the various properties and options.\r\n\r\nClick Actions > Copy to Clipboard to copy the Interfaces table in CSV format.\r\n\r\n- Routes: To add a default route to the Routes table, click Add Default Routes and either enter an IP address or select a Virtual Router. The Route Configuration window opens. Click Help for details regarding the various properties and options. You can also add, change and remove routes (see \"Working with VSX Gateways\" on page 66).\r\n- Calculate topology automatically based on routing information: Enable this option to allow VSX to automatically calculate the network topology based on interface and routing definitions (enabled by default). VSX creates automatic links, or connectivity cloud objects linked to existing internal or external networks.\r\n- When this option is enabled, you cannot configure the topology using Topology tab in the Interface Properties window. These options are not available on the tab.\r\n- This option is not available in the Bridge Mode.\r\n- When employing dynamic routing, it is recommended to disable this option.\r\n- VPN Domain: The VPN Domain defines the set of hosts located behind a given Virtual System that communicate via a VPN tunnel with peer Virtual Systems. These options are only available if you selected VPN in the Check Point Products section on the General Properties page.\r\n\r\nWhen including a Virtual Device as part of a VPN connection, you must specify a VPN Domain. The domain definition specifies Virtual System interfaces that are included in the VPN.\r\n\r\nYou can define a VPN Domain by enabling the applicable option:\r\n\r\n- All IP Addresses behind gateway based on topology information: Includes all hosts not located behind an external VSX Gateway interface.\r\n- Manually Defined: Includes all hosts in the selected network or group.\r\n\r\n\r\n## NAT > Advanced\r\n\r\nOn the NAT > Advanced page, you configure NAT rules for packets originating from a Virtual System.\r\n\r\nTo enable and configure NAT for a Virtual System:\r\n\r\n1. Select Add Automatic Address Translation.\r\n2. Select a translation method:\r\n\r\n- Hide: Hide NAT only allows connections originating from the internal network. Internal hosts can access internal destinations, the Internet and other external networks. External sources cannot initiate a connection to internal network addresses.\r\n- Static: Static NAT translates each private address to a corresponding public address.\r\n\r\n3. If you select Hide, select one of these options:\r\n\r\n- Hide behind Gateway hides the real IP address behind the Virtual System external interface IP address,\r\nor\r\n- Hide behind IP Address hides the real address behind a virtual IP address, which is a routable, public IP address that does not belongs to any real machine.\r\n\r\n4. If you selected Static NAT, enter the static IP address in the appropriate field.\r\n5. Select the VSX Gateway from the Install on Gateway list.\r\n\r\nIn addition, see \"Working with Network Address Translation (NAT)\" on page 106.\r\n\r\n# Configuring Bridge Interfaces in Regular Virtual Systems \r\n\r\n## To add a new bridge interface\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the Virtual System.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. Open the Virtual System object.\r\n4. From the left tree, click Topology.\r\n5. In the Interfaces section, click New and select Bridge.\r\n6. On the General tab, in the Interface field, select the first subordinate interface (for example, eth2).\r\n\r\nOn other tabs, configure the applicable settings and click OK.\r\n7. In the Interfaces section, click New and select Bridge.\r\n8. On the General tab, in the Interface field, select the second subordinate interface (for example, eth3).\r\n\r\nOn other tabs, configure the applicable settings and click OK.\r\n9. Click OK to push the VSX Configuration.\r\n10. Install the applicable Access Control Policy on the Virtual System object.\r\n\r\nImportant:\r\n\r\n- A bridge interface contains only two subordinate interfaces.\r\n- In each bridge interface you must configure these Topology settings:\r\n- One subordinate interface must have the configuration External (leads out to the Internet)\r\n- One subordinate interface must have the configuration Internal (leads to the local network) and Not Defined\r\n- When a Virtual System contains only two interfaces configured as bridge subordinate interfaces, the Virtual System attaches them automatically to create a Layer 2 bridge interface.\r\nThis configuration supports bridge subordinate interfaces (one or two) that are VLAN interfaces.\r\n- To configure more than one bridge interface in a Virtual System, these conditions apply:\r\n\r\n1. All bridge subordinate interfaces must be VLAN interfaces with VLAN tags that the Virtual System can pair.\r\nThe Virtual System attaches the bridge subordinate interfaces automatically based on their VLAN tags to create a bridge interface. Examples:\r\n\r\n- eth1.111 and eth2.111\r\n- eth1.222 and eth2.222\r\n\r\n2. The VLAN subordinate interfaces in all bridge interfaces in the Virtual System must belong to the same two physical VLAN trunks.\r\nEach bridge must contain VLAN interfaces with the same VLAN tag, but a different VLAN Trunk.\r\n\r\n- You cannot configure a regular Virtual System with bridge in a VSX Cluster in the Active/Active Bridge Mode.\r\n\r\n# To edit bridge subordinate interfaces \r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the Virtual System.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. Open the Virtual System object.\r\n4. From the left tree, click Topology.\r\n5. In the Interfaces section, select the bridge subordinate interface and click Edit.\r\n6. Configure the applicable bridge interface settings.\r\n7. Click OK to close the Interface Properties window.\r\n8. Click OK to push the VSX Configuration.\r\n9. Install the applicable Access Control Policy on the Virtual System object.\r\n\r\n## To delete a bridge interface\r\n\r\n1. Determine the applicable bridge subordinate interfaces:\r\na. Connect to the command line on the VSX Gateway (each VSX Cluster Member).\r\nb. Log in to Gaia Clish.\r\nc. Go to the context of the Virtual System:\r\nset virtual-system<VSID>\r\nd. Examine the bridge interfaces:\r\nshow bridging groups\r\n2. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the Virtual System.\r\n3. From the left navigation panel, click Gateways \\& Servers.\r\n4. Open the Virtual System object.\r\n5. From the left tree, click Topology.\r\n6. In the Interfaces section:\r\na. Select the first bridge subordinate interface > click Delete > click OK to confirm.\r\nb. Select the second bridge subordinate interface > click Delete > click OK to confirm.\r\n7. Click OK to push the VSX Configuration.\r\n8. Install the applicable Access Control Policy on the Virtual System object.\r\n\r\n# Deleting a Virtual System \r\n\r\nTo delete a Virtual System:\r\n\r\n1. From the Gateways \\& Servers view or Object Explorer tree, right-click the Virtual System object and select Delete.\r\n2. In the window that opens, click Yes.\r\n\r\n## Configuring DNS Servers on a Virtual System\r\n\r\nGaia uses the Domain Name Service (DNS) to translate host names into IP addresses.\r\nTo enable DNS lookups, you must enter the primary DNS server for your system. You can also enter secondary and tertiary DNS servers.\r\n\r\nWhen the system resolves host names, it consults the primary name server. If a failure or time-out occurs, the system consults the secondary name server, and if necessary, the tertiary.\r\n\r\nYou can also define a DNS Suffix, which is a search for host-name lookup.\r\nFrom R81, you can configure each Virtual System:\r\n\r\n## - To use specific DNS Servers for all DNS queries\r\n\r\nA Virtual System uses the specific configured DNS servers for all DNS queries.\r\n\r\n## - To use specific DNS Servers for DNS queries sent for specific Domains\r\n\r\nA Virtual System uses the configured DNS Forwarding Domain.\r\nThe DNS Forwarding Domain determines the Domain Suffix and the DNS Servers for this Domain Suffix:\r\n\r\n- For all DNS queries that end with the Forwarding Domain Suffix, a Virtual System uses the specific DNS servers configured for this Forwarding Domain Suffix.\r\n- For all other DNS queries, a Virtual System uses other specific DNS servers configured in the Virtual System.\r\n\r\nNote - If a Domain in a DNS query contains a shorter Domain as its suffix, then for all DNS queries that end with the longer Domain's suffix a Virtual System uses the DNS servers configured to the longest Domain's match. For example, if you configured the Domain Suffixes \"com\" and \" checkpoint.com\" and their corresponding DNS servers, then for a DNS query with the suffix \"support. checkpoint.com\", a Virtual System uses the DNS server configured for the Domain Suffix \"checkpoint.com\" and not the DNS server configured for the Domain Suffix \"com\".\r\n\r\n## - To work as a DNS Relay\r\n\r\nA Virtual System listens to DNS queries on specific interfaces and forwards them through all other interfaces (all these interfaces belong to the same Virtual System).\r\n\r\n# Important: \r\n\r\n- You can configure one or all of the above specific DNS settings on a Virtual System.\r\nTo configure and use any of the above specific DNS settings, you must enable the entire feature on the VSX Gateway (each VSX Cluster Member).\r\n- By default, this feature is disabled:\r\n\r\nAll Virtual Systems you create use the global DNS settings configured on the VSX Gateway or VSX Cluster Member.\r\n\r\n- When you enable this feature:\r\na. The default DNS settings in the context of VS0 become the same as the global DNS settings configured on the VSX Gateway or VSX Cluster Member.\r\nb. The default DNS settings in the context of every new Virtual System become the same as the DNS settings in the context of VS0.\r\n- When you disable this feature:\r\n\r\nThe global DNS settings on the VSX Gateway or VSX Cluster Member become the same as the DNS settings in the context of VS0.\r\n\r\n- You must configure all DNS settings in Gaia Clish on the VSX Gateway (each VSX Cluster Member).\r\n- In a VSX Cluster, you must configure all the VSX Cluster Members in the same way.\r\n- Some programs that use POSIX sockets to resolve hostnames (for example, ping and ssh) fail to do so when they resolve names without \".\" in them. These programs rely on the DNS search suffix.\r\n- For Software Blades that require contracts or updates to function, you must configure the DNS servers in the context of the VSX Gateway or VSX Cluster Member itself (context of VS0). For additional information, see sk106496.\r\n\r\n\r\n## Enabling or disabling the feature\r\n\r\n1. Connect to the command line on the VSX Gateway (each VSX Cluster Member).\r\n2. Log in to Gaia Clish.\r\n3. Enable (\"per-vs\") or disable (\"default\") the feature:\r\n\r\nNote - You can run this command in the context of any Virtual Device.\r\nset dns mode \\{per-vs | default\\}\r\n4. Show the status of the feature:\r\nshow dns mode\r\n5. Save the changes:\r\nsave config\r\n\r\n## Configuring specific DNS settings for all DNS queries\r\n\r\n1. Connect to the command line on the VSX Gateway (each VSX Cluster Member).\r\n2. Log in to Gaia Clish.\r\n3. Enable the feature:\r\n\r\nset dns mode per-vs\r\nshow dns mode\r\n4. Go to the context of the applicable Virtual System:\r\nset virtual-system <VSID>\r\n5. Configure the DNS Servers and the DNS Suffix:\r\n```\r\nset dns\r\n    primary <IPv4 or IPv6 Address>\r\n    secondary <IPv4 or IPv6 Address>\r\n    tertiary <IPv4 or IPv6 Address>\r\n    suffix <Name for Local Domain>\r\n```\r\n\r\n6. Show the configured settings:\r\n```\r\nshow dns\r\n```\r\n\r\n7. Save the changes:\r\nsave config\r\nTo delete the configured settings\r\n```\r\nset virtual-system <VSID>\r\ndelete dns\r\n    primary\r\n    secondary\r\n    tertiary\r\n    suffix\r\nsave config\r\n```\r\n\r\n\r\n# Example \r\n\r\n```\r\nset dns mode per-vs\r\nset virtual-system 1\r\nset dns primary 192.168.10.21\r\nset dns secondary 192.168.10.22\r\nset dns tertiary 192.168.10.23\r\nset dns suffix mycompany.com\r\nshow dns\r\nsave config\r\n```\r\n\r\n\r\n## Configuring specific DNS settings for specific Domains\r\n\r\n1. Connect to the command line on the VSX Gateway (each VSX Cluster Member).\r\n2. Log in to Gaia Clish.\r\n3. Enable the feature:\r\n```\r\nset dns mode per-vs\r\nshow dns mode\r\n```\r\n\r\n4. Go to the context of the applicable Virtual System:\r\n\r\n# set virtual-system <VSID> \r\n\r\n5. Configure the DNS Servers and the DNS Suffix for all DNS queries:\r\n```\r\nset dns\r\n    primary <IPv4 or IPv6 Address>\r\n    secondary <IPv4 or IPv6 Address>\r\n    tertiary <IPv4 or IPv6 Address>\r\n    suffix <Name for Local Domain>\r\n```\r\n\r\n6. Show the configured settings for all DNS queries:\r\nshow dns\r\n7. Configure the Forwarding Domain Suffix:\r\nadd dns proxy forwarding-domain <Domain Suffix>\r\n8. Configure the DNS Servers for the specific Forwarding Domain Suffix:\r\n```\r\nset dns proxy forwarding-domain <Domain Suffix>\r\n    primary <IPv4 or IPv6 Address>\r\n    secondary <IPv4 or IPv6 Address>\r\n    tertiary <IPv4 or IPv6 Address>\r\n```\r\n\r\n9. Show the configured Forwarding Domain Suffixes:\r\nshow dns proxy forwarding-domains\r\n10. Show the configured settings for the specific Forwarding Domain Suffix:\r\n```\r\nshow dns proxy forwarding-domain <Domain Suffix>\r\n    primary\r\n    secondary\r\n    tertiary\r\n```\r\n\r\n11. Save the changes:\r\nsave config\r\n\r\n## To delete the configured settings\r\n\r\n```\r\nset virtual-system <VSID>\r\ndelete dns\r\n    primary\r\n    secondary\r\n    tertiary\r\n    suffix\r\nsave config\r\nset virtual-system <VSID>\r\ndelete dns proxy forwarding-domain <Domain Suffix>\r\nsave config\r\n```\r\n\r\n```\r\nset virtual-system <VSID>\r\ndelete dns proxy forwarding-domain <Domain Suffix>\r\n        primary\r\n        secondary\r\n        tertiary\r\nsave config\r\n```\r\n\r\n\r\n# Example \r\n\r\n```\r\nset dns mode per-vs\r\nset virtual-system 1\r\nset dns primary 192.168.10.21\r\nset dns secondary 192.168.10.22\r\nset dns tertiary 192.168.10.23\r\nset dns suffix mycompany.com\r\nshow dns\r\nadd dns proxy forwarding-domain anothercompany.com\r\nset dns proxy forwarding-domain anothercompany.com primary 172.16.30.41\r\nset dns proxy forwarding-domain anothercompany.com secondary 172.16.30.42\r\nset dns proxy forwarding-domain anothercompany.com tertiary 172.16.30.43\r\nshow dns proxy forwarding-domains\r\nshow dns proxy forwarding-domain anothercompany.com primary\r\nshow dns proxy forwarding-domain anothercompany.com secondary\r\nshow dns proxy forwarding-domain anothercompany.com tertiary\r\nsave config\r\n```\r\n\r\n\r\n## Configuring a Virtual System to work as a DNS Relay\r\n\r\n1. Connect to the command line on the VSX Gateway (each VSX Cluster Member).\r\n2. Log in to Gaia Clish.\r\n3. Enable the feature:\r\n```\r\nset dns mode per-vs\r\nshow dns mode\r\n```\r\n\r\n4. Go to the context of the applicable Virtual System:\r\n```\r\nset virtual-system <VSID>\r\n```\r\n\r\n5. Configure the DNS Servers and the DNS Suffix for all DNS queries:\r\n```\r\nset dns\r\n    primary <IPv4 or IPv6 Address>\r\n    secondary <IPv4 or IPv6 Address>\r\n    tertiary <IPv4 or IPv6 Address>\r\n    suffix <Name for Local Domain>\r\n```\r\n\r\n6. Show the configured settings:\r\n```\r\nshow dns\r\n    primary\r\n    secondary\r\n    tertiary\r\n    suffix\r\n```\r\n\r\n7. Configure the interfaces, on which the Virtual System must listen to DNS queries:\r\n\r\nadd dns proxy listening-interface <Name of Virtual System Interface>\r\n8. Show the configured listening interfaces:\r\nshow dns proxy listening-interfaces\r\n9. Save the changes:\r\nsave config\r\n\r\n# To delete the configured settings \r\n\r\n```\r\nset virtual-system <VSID>\r\ndelete dns\r\n    primary\r\n    secondary\r\n    tertiary\r\n    suffix\r\nsave config\r\nset virtual-system <VSID>\r\ndelete dns proxy listening-interface <Name of Virtual System Interface>\r\nsave config\r\n```\r\n\r\n\r\n## Example\r\n\r\n```\r\nset dns mode per-vs\r\nset virtual-system 1\r\nset dns primary 192.168.10.21\r\nset dns secondary 192.168.10.22\r\nset dns tertiary 192.168.10.23\r\nset dns suffix mycompany.com\r\nshow dns\r\nadd dns proxy listening-interface wrpl28\r\nshow dns proxy listening-interfaces\r\nsave config\r\n```\r\n\r\n\r\n## CLI Parameters\r\n\r\n| Parameter | Description |\r\n| :--: | :--: |\r\n| mode \\{per-vs | Enables (\"per-vs\") or disables (\"default\") the feature. |\r\n| ```    default\\``` |  |\r\n| primary <IPv4 or <br> IPv6 Address> | Specifies the IPv4 or IPv6 address of the primary DNS server, which <br> resolve host names. <br> This must be a host that runs a DNS server. |\r\n| secondary <IPv4 or <br> IPv6 Address> | Specifies the IPv4 or IPv6 address of the secondary DNS server, which <br> resolves host names if the primary server does not respond. <br> This must be a host that runs a DNS server. |\r\n| tertiary <IPv4 or <br> IPv6 Address> | Specifies the IPv4 or IPv6 address of the tertiary DNS server, which <br> resolves host names if the primary and secondary servers do not <br> respond. <br> This must be a host that runs a DNS server. |\r\n\r\n## Parameter\r\n\r\nsuffix <Name for Local Domain>\r\n\r\nforwarding-domain <Domain Suffix>\r\n\r\n## Description\r\n\r\nSpecifies the name that is put at the end of all DNS searches if they fail. By default, it must be the local domain name.\r\nA valid domain name suffix is made up of subdomain strings separated by periods.\r\nSubdomain strings must begin with an alphabetic letter and can consist only of alphanumeric characters and hyphens.\r\nThe domain name syntax is described in RFC 1035 (modified slightly in RFC 1223).\r\n\r\nNote - Domain names that are also valid numeric IP addresses (for example: 10.19.76.100), although syntactically correct, are not permitted.\r\n\r\nExample:\r\nYou configured the DNS Suffix \"example.com\" and you try to ping the host \"foo\" (with the command \"ping foo\"). If Gaia cannot resolve \"foo\", then Gaia tries to resolve \"foo.example.com\".\r\n\r\nSpecifics the Forwarding Domain Suffix.\r\nThe DNS Forwarding Domain determines the Domain Suffix and the DNS Servers for this Domain Suffix:\r\n\r\n- For all DNS queries that end with the Forwarding Domain Suffix, a Virtual System uses the specific DNS servers configured for this Forwarding Domain Suffix.\r\n- For all other DNS queries, a Virtual System uses other specific DNS servers configured in the Virtual System.\r\n\r\nSpecifies the name of a Virtual System interface, on which the Virtual System must listen to DNS queries.\r\n\r\n# Configuring DHCP Server on a Virtual System \r\n\r\n1. Connect to the command line on the VSX Gateway / each VSX Cluster Member.\r\n2. Log in to Gaia Clish.\r\n3. Go to the context of the applicable Virtual System:\r\n```\r\nset virtual-system <VS ID>\r\n```\r\n\r\n4. Configure the required DHCP Server settings as described in the R81.20 Gaia Administration Guide > Chapter \"Network Management\" > Section \"DHCP Server\" > Section \"Configuring a DHCP Server in Gaia Clish\".\r\n\r\n# Working with Virtual Switches \r\n\r\nIn This Section:\r\n\r\n| Introduction | 85 |\r\n| :-- | :-- |\r\n| Creating a New Virtual Switch | 86 |\r\n| Modifying a Virtual Switch | 86 |\r\n| Deleting a Virtual Switch | 87 |\r\n\r\nThis section describes how to define and configure a Virtual Switch.\r\n\r\n## Introduction\r\n\r\nVirtual Switches provide level-2 connectivity between Virtual Systems and internal or external networks.\r\nAs with physical switches, each Virtual Switch maintains a forwarding table containing entries that describe known networks and directions for reaching them.\r\n\r\nYou can define Virtual Switches for external and internal communications.\r\n![[CP_R81.20_VSX_AdminGuide_img_24.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 6 | Virtual Systems |\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 2 | Router |  | ---- | VLAN Interface |\r\n| 3 | VSX Gateway |  | - | VLAN Trunk |\r\n| 4 | VLAN Switch |  |  | Warp Link |\r\n| 5 | Virtual Switch |  |  |  |\r\n\r\nThe figure shows a typical deployment using a Virtual Switch for external connections and a VLAN trunk leading to the internal, protected network.\r\n\r\n# Creating a New Virtual Switch \r\n\r\nUse the Virtual Switch Wizard to create a new Virtual Switch. You can modify the initial definition and configure advanced options after completing the wizard.\r\n\r\nTo create a new Virtual Switch:\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the new Virtual System.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. Create a new Virtual Switch object in one of these ways:\r\n\r\n- From the top toolbar, click the New ( ${ }^{(4)}$ ) > VSX > New Virtual Switch.\r\n- In the top left corner, click Objects menu > More object types > Network Object > Gateways and Servers > VSX > New Virtual Switch.\r\n- In the top right corner, click Objects Pane > New > More > Network Object > Gateways and Servers > VSX > Virtual Switch.\r\n\r\nThe Virtual Switch Wizard opens.\r\n4. In the Name field, enter the name for the new Virtual Switch.\r\n5. In the VSX Gateway / Cluster field, select the applicable VSX Gateway or VSX Cluster.\r\n6. Click Next.\r\n7. In the Interfaces section, click Add to add the interface, to which the Virtual Switch connects.\r\n8. Click Next.\r\n9. Click Finish.\r\n\r\n## Modifying a Virtual Switch\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the Virtual Switch.\r\n2. From the Gateways \\& Servers view or Object Explorer, double-click the Virtual Switch object.\r\n\r\n# Virtual Switch - General Properties \r\n\r\nThe General Properties page allows you to add comments and change the icon color as displayed in SmartConsole.\r\n\r\n## Virtual Switch - Topology\r\n\r\nThe Topology page defines Virtual Switch interfaces. You can only modify the single defined interface. You cannot change the settings for Warp interfaces in this window.\r\n\r\nTo add an interface:\r\n\r\n1. Click New.\r\n\r\nThe Interface Properties window opens.\r\n2. Select an interface from the list and define the IP address, net mask and other properties.\r\n3. Optional: Click Actions > Copy to Clipboard to copy the Interfaces table in CSV format.\r\n\r\n## Deleting a Virtual Switch\r\n\r\nTo delete a Virtual Switch:\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the new Virtual Switch.\r\n2. From the Gateways \\& Servers view or Object Explorer, double-click the Virtual Switch object.\r\n3. From the left tree, click Topology.\r\n4. In the Interfaces section, remove all interfaces.\r\n5. Click OK.\r\n6. Right-click the Virtual Switch object and select Delete.\r\n7. Click Yes in the confirmation box.\r\n8. Publish the SmartConsole session.\r\n\r\n# Working with Virtual Routers \r\n\r\nIn This Section:\r\n\r\n| Introduction | 88 |\r\n| :-- | --: |\r\n| Creating a New Virtual Router | 90 |\r\n| Modifying a Virtual Router Definition | 90 |\r\n| Deleting a Virtual Router | 91 |\r\n| Virtual Routers in Virtual System Load Sharing Mode | 91 |\r\n\r\nThis section describes how to define and configure a Virtual Router.\r\n\r\n## Introduction\r\n\r\nAs with physical routers, each Virtual Router maintains a routing table containing entries that describe known networks and directions on how to reach them.\r\n\r\nYou can define Virtual Routers for both external and internal communications.\r\nA Virtual Router that connects to external networks, including a DMZ and the Internet, are referred to as an external Virtual Router.\r\n\r\nA Virtual Router that connects to internal, protected networks is known as an internal Virtual Router.\r\n![[CP_R81.20_VSX_AdminGuide_img_25.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 6 | External Virtual Router |\r\n| 2 | Router |  | 7 | Virtual Systems |\r\n| 3 | Security Management Server |  | ---- | VLAN Interface |\r\n| 4 | VSX Gateway |  | ---- | VLAN Trunk |\r\n| 5 | VLAN switch |  | -------- | Warp Link |\r\n\r\nAn external Virtual Router functions as the external gateway for Virtual Systems, allowing them to share a single secure physical interface leading to external networks and the Internet.\r\n![[CP_R81.20_VSX_AdminGuide_img_26.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 7 | Unnumbered |\r\n| 2 | Router |  | 8 | Virtual Systems |\r\n| 3 | Security Management Server |  | 9 | Internal Virtual Router |\r\n| 4 | VSX Gateway |  | ---- | VLAN Interface |\r\n| 5 | Switch |  | ---- | VLAN Truck |\r\n| 6 | External Virtual Router |  |  | Warp link |\r\n\r\nIn this scenario, VSX creates Warp interfaces between the Virtual Systems and both Virtual Routers. Note that the external Virtual System interfaces are defined as unnumbered interfaces.\r\n\r\nAn internal Virtual Router typically connects with one interface leading to internal networks through a switch with additional Warp Links leading to other Virtual Systems located in the VSX Gateway.\r\n\r\nAfter you create a new Virtual Router, add new interfaces to the Virtual Systems to connect to the Virtual Router.\r\n\r\n# Creating a New Virtual Router \r\n\r\nUse the Virtual Router Wizard to create a new Virtual Router. You can modify the initial definition and configure advanced options after you complete the wizard.\r\n\r\nOn interfaces and routes, you can select the Propagate route to adjacent Virtual Devices option to broadcast the IP address to neighboring Virtual Devices. This option enables connectivity with these Virtual Devices.\r\n\r\nTo create a Virtual Router:\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the new Virtual System.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. Create a new Virtual Router object in one of these ways:\r\n\r\n- From the top toolbar, click the New ( $\\left.{ }^{( }\\right)>$VSX $>$ New Virtual Router.\r\n- In the top left corner, click Objects menu > More object types > Network Object > Gateways and Servers > VSX > New Virtual Router.\r\n- In the top right corner, click Objects Pane > New > More > Network Object > Gateways and Servers > VSX > Virtual Router.\r\n\r\nThe Virtual Router Wizard opens.\r\n4. In the Name field, enter the name for the new Virtual Router.\r\n5. In the VSX Gateway / Cluster field, select the applicable VSX Gateway or VSX Cluster.\r\n6. Click Next.\r\n7. In the Interfaces section, click Add to add the interface, to which the Virtual Router connects.\r\n8. In the Routes section, click Add to add the applicable network routes.\r\n9. Optional: Click Add Default Route and configure the default route.\r\n10. Click Next.\r\n11. Click Finish.\r\n\r\n## Modifying a Virtual Router Definition\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the Virtual Router.\r\n2. From the Gateways \\& Servers view or Object Explorer, double-click the Virtual Router object.\r\n\r\n# Virtual Router - General Properties \r\n\r\nThe General Properties page enables you change the Virtual Router IP address as well as to add comments and change the icon color as displayed in SmartConsole.\r\n\r\n## Virtual Router - Topology\r\n\r\nThe Virtual Router Network Configuration page defines the network topology for the Virtual Router. For an external interface, you define one or more shared external interfaces and a default gateway.\r\n\r\nTopology is defined by these properties:\r\n\r\n- Interfaces: Add new interfaces, or modify or delete existing interfaces.\r\n\r\nTo add an interface, click New. The Interface Properties window opens. Select an interface from the list and define the IP address, net mask and other properties (see \"Working with Interface Definitions\" on page 97).\r\n\r\n- Routes: Add network routes between this Virtual Router, Virtual Systems, external network devices and network addresses. Some Warp Link routes are defined automatically and cannot be modified or deleted. You can manually add new routes as well as delete and modify non-Warp Link routes.\r\n- Add Default Route: Define the default route as an IP address or Virtual System.\r\n- Advanced Routing: Configure source-based routing rules. See \"Working with Source-Based Routing\" on page 92.\r\n\r\n\r\n## Deleting a Virtual Router\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the new Virtual Router.\r\n2. From the Gateways \\& Servers view or Object Explorer, double-click the Virtual Router object.\r\n3. From the left tree, click Topology.\r\n4. In the Interfaces section, remove all interfaces.\r\n5. Click OK.\r\n6. Right-click the Virtual Router object and select Delete.\r\n7. Click Yes in the confirmation box.\r\n8. Publish the SmartConsole session.\r\n\r\n## Virtual Routers in Virtual System Load Sharing Mode\r\n\r\nFrom R81, you can configure Virtual Routers in VSLS mode.\r\nSee \"Configuring Virtual System Load Sharing\" on page 140.\r\n\r\n# Working with Source-Based Routing \r\n\r\n## Introduction\r\n\r\nSource-based routing directs traffic to a specific destination based on the source IP address or a combination of the source and destination IP addresses.\r\n\r\nRules defining Source-based routing take precedence over ordinary destination-based routing rules.\r\nThis section describes how to configure sourced-based routing rules when working in a VSX environment.\r\nThe procedures for defining source-based rules are the same for Virtual Routers in both VSX Gateways and VSX Clusters.\r\n![[CP_R81.20_VSX_AdminGuide_img_27.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 8 | Wrp Unnumbered interface |\r\n| 2 | Router |  | 9 | Virtual Systems |\r\n| 3 | Security Management Server |  | 10 | Internal Virtual Router |\r\n| 4 | VSX Gateway |  | ----- | VLAN Interface |\r\n| 5 | Switch |  | ----- | VLAN Truck |\r\n| 6 | External Virtual Router |  | ----- | Warp link |\r\n| 7 | wrpj |  |  |  |\r\n\r\n# Defining Source-Based Routing Rules \r\n\r\nDefine Source-based Routing rules in the Topology page of the Virtual Router definition window.\r\n\r\nTo define source-based routing rules:\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the Virtual Router.\r\n2. From the Gateways \\& Servers view or Object Explorer, right-click the Virtual Router object and select Edit.\r\n\r\nThe General Properties window opens.\r\n3. From the left navigation tree, select Topology.\r\n4. Click Advanced Routing.\r\n\r\nThe Advanced Routing Rules window opens.\r\n5. Click Add to define a new rule. or select an existing rule and click Edit to change it.\r\n\r\nThe Add/Edit Route Rule window opens.\r\n6. Define these settings:\r\n\r\n- Source IP Address and Net Mask\r\n- Destination IP Address and Net Mask\r\n- Next Hop Gateway\r\n\r\n7. Click OK.\r\n\r\n# CoreXL for Virtual Systems \r\n\r\n## Introduction\r\n\r\nCoreXL creates multiple Firewall instances that are, in reality, independent firewalls. You can use CoreXL to increase the performance of the VSX Gateway with multiple CPU cores. You can also assign each CoreXL Firewall instance to a group of CPU cores with the fw ct1 affinity command.\r\n\r\nYou configure CoreXL Firewall instances differently for the VSX Gateway (VS0) than for other Virtual Systems.\r\n\r\n- VSX Gateway - Use the CLI to configure the number of CoreXL Firewall instances.\r\n- Other Virtual Systems - Use SmartConsole to configure the number of CoreXL Firewall instances.\r\n\r\nYou can configure several CoreXL Firewall instances for each Virtual System. When you change the number of CoreXL Firewall instances on a Virtual System, there is some downtime for that Virtual System.\r\n\r\n## Important:\r\n\r\n- Each CoreXL Firewall instance you create uses additional system memory. A Virtual System with five CoreXL Firewall instances would use approximately the same amount of memory as five separate Virtual Systems.\r\n- The number of IPv6 instances cannot exceed the number of IPv4 CoreXL Firewall instances. For more about IPv6 CoreXL Firewall instances and VSX, see sk97997.\r\n\r\nFor more about configuring CoreXL, see the R81.20 Performance Tuning Administration Guide.\r\n\r\n## Configuring CoreXL on a VSX Gateway\r\n\r\nImportant - Enabling CoreXL on VS 0 is not recommended because of increased memory overhead and potential performance degradation. Most VSX deployments and use cases do not require more than a single firewall instance for VS0 as its main purpose is managing the VSX Gateway.\r\n\r\nUse the cpconfig command to configure CoreXL on the VSX Gateway (VS0).\r\nThe number of instances for the VSX Gateway is limited to the physical number of cores on the server or appliance.\r\n\r\nTo configure the number of instances on the VSX Gateway:\r\n\r\n1. From the CLI, run cpconfig.\r\n2. Select Configure Check Point CoreXL.\r\n3. Make sure that CoreXL is enabled.\r\n4. Configure the number of CoreXL Firewall instances for the VSX Gateway.\r\n5. Exit the cpconfig menu.\r\n\r\nNote - It is not necessary to reboot the VSX Gateway after you configure CoreXL.\r\n\r\n# Configuring CoreXL on Virtual Systems \r\n\r\nUse SmartConsole to configure the number of CoreXL Firewall instances on the Virtual Systems.\r\n\r\n- In 32-bit VSX, you can assign up to 10 CoreXL Firewall instances on a Virtual System.\r\n- In 64-bit VSX, you can assign up to 32 CoreXL Firewall instances on a Virtual System.\r\n\r\nThe number of CoreXL Firewall instances is not limited by the physical CPU cores on the VSX Gateway.\r\nYou can assign the number of IPv6 CoreXL Firewall instances. It must be less or equal to the number of IPv4 CoreXL Firewall instances. The number of IPv6 CoreXL Firewall instances may be zero. IPv6 CoreXL Firewall instances are only enabled, if an IPv6 address is configured for that Virtual System.\r\n\r\n## Notes:\r\n\r\n- We recommend that you use the number of CoreXL Firewall instances for each Virtual System according to the expected network traffic on the Virtual System. Configuring unnecessary CoreXL Firewall instances can have a negative impact on performance.\r\n- We recommend that you do not configure more CoreXL Firewall instances than the total number of physical CPU cores on the VSX Gateway.\r\n\r\n\r\n## To configure CoreXL on a Virtual System:\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the Virtual System.\r\n2. From the Gateways \\& Servers view or Object Explorer, double-click the Virtual System object.\r\n\r\nThe Virtual System General Properties window opens.\r\n3. From the left navigation tree, select CoreXL.\r\n4. Select the number of CoreXL Firewall instances for the Virtual System.\r\n5. Click OK.\r\n6. Install the Access Control Policy on the Virtual System object.\r\n\r\n# Dynamic Routing for Virtual Devices \r\n\r\nThis section presents procedures for configuring dynamic routing for Virtual Systems and Virtual Routers. The Virtual Devices can use dynamic routing protocols to communicate and distribute routes amongst themselves and with external routers and other devices. VSX uses the Gaia routing daemon (routed).\r\n\r\nYou can configure dynamic routing for each of these Virtual Devices:\r\n\r\n- Virtual System\r\n- Virtual Router\r\n\r\nEach of these Virtual Devices has its own dynamic routing instance and configuration file. Use the same procedures to configure the dynamic routing protocols for Warp Links as regular interfaces. You can also configure dynamic routing separately on each VSX Cluster Member.\r\n\r\nImportant - You cannot use the CLI to configure static routes for VSX. You can only configure them in SmartConsole in the applicable VSX object.\r\n\r\nFor more about configuring dynamic routing, see the R81.20 Gaia Advanced Routing Administration Guide.\r\n\r\nTo configure dynamic routing for a Virtual Device:\r\n\r\n1. Connect to the command line on the VSX Gateway or each VSX Cluster Member.\r\n2. Log in to Gaia Clish.\r\n3. Change the context to the Virtual Device:\r\nset virtual-system <VSID>\r\n4. Run the applicable commands to configure the dynamic routing daemon for the Virtual Device.\r\n5. Save the changes:\r\nsave config\r\n\r\n# Working with Interface Definitions \r\n\r\nAll VSX Gateways and Virtual Routers and Virtual Switches contain at least one interface definition.\r\nTypically, you define the interfaces during the process of configuring the topology for a given object.\r\nWarp interfaces, however, are created automatically based on Virtual Device definitions and their topology.\r\nYou cannot modify or delete a Warp interface.\r\n\r\n## Adding a New Interface\r\n\r\nThe procedure and options for defining an interface vary according to the object and the network topology.\r\nSome properties and pages are not available for certain interface definitions.\r\n\r\n## To add a new interface:\r\n\r\n1. Open the Virtual Device object.\r\n2. From the navigation tree, click Topology.\r\n3. From the Interfaces section, click New and select one of these options:\r\n\r\n- Regular\r\n- Leads to Virtual Router\r\n- Leads to Virtual Switch\r\n\r\nThe Interface Properties window for the selected option opens.\r\n4. Configure the applicable settings (see below).\r\n5. Click OK.\r\n6. Install the applicable Access Control Policy.\r\n\r\n## Configuring Connection Properties - General\r\n\r\nThe General tab defines the network connections associated with an interface.\r\nOne or more of these properties show, depending on the context.\r\n\r\n- Interface: Select a physical interface from the list (physical interfaces only).\r\n- VLAN Tag: VLAN tag associated with the defined interface.\r\n- IP Address and Net Mask: IP address and net mask of the device associated with the interface.\r\n- Propagate route to adjacent Virtual Devices: Enable to \"advertise\" the associated device to neighboring devices, thereby enabling connectivity between them. See \"VSX Routing Concepts\" on page 38.\r\n- MTU: Maximum transmission unit size in bytes (default $=1,500$ ).\r\n\r\n\r\n## Configuring Connections Leading to Virtual Routers and Virtual Switches\r\n\r\nThe General tab for interface connections leading to Virtual Routers or Virtual Switches contains connection properties specific to those Virtual Devices.\r\n\r\n- Leads to: Select a Virtual Router or Virtual Switch.\r\n- Enter the dedicated Virtual SystemIP address for this interface.\r\n- The Net Mask property is always defined as 255.255.255.255 for IPv4 and /128 for IPv6.\r\n- Propagate route to adjacent Virtual Devices: Enable to \"advertise\" the associated device to neighboring devices, thereby enabling connectivity between them. See \"VSX Routing Concepts\" on page 38.\r\n- MTU: Maximum transmission unit size in bytes (default $=1,500$ ). The minimum and maximum MTU values are:\r\n- IPv6 MTU: 1280 - 16000\r\n- IPv4 MTU: 68 - 16000\r\n\r\n\r\n# Configuring Interface Topology \r\n\r\nFor some interface types, you can change some or all of these topology properties:\r\n\r\n- External: The interface leads to external networks or to the Internet.\r\n- Internal: The interface leads to internal networks or a DMZ:\r\n- Not Defined: All IP addresses behind this interface are considered a part of the internal network that connects to this interface.\r\n- Network defined by the interface IP and Net Mask: Only the network that directly connects to this internal interface.\r\n- Network defined by routes: The Virtual System dynamically calculates the topology for this interface.\r\n\r\nNote - To see this option, you must clear the option Calculate topology automatically based on routing information in the Virtual System object.\r\n\r\n- Specific: A specific object (a Host, a Network, a Network Group, an Address Range).\r\n- Interface leads to DMZ: Defines an interface as leading to a DMZ, which isolates a vulnerable, externally accessible resource from the rest of a protected, internal network.\r\n\r\n\r\n## Configuring Anti-Spoofing\r\n\r\nAttackers can gain access to protected networks by falsifying or \"spoofing\" a trusted source IP address with high access privileges. It is important to configure Anti-Spoofing protection for VSX Gateways and Virtual Systems, including internal interfaces. You can configure Anti-Spoofing for an interface, provided that the topology for the interface is properly defined.\r\n\r\nIf you are using dynamic routing, disable the Calculate topology automatically based on routing information option, and manually configure the topology of the Virtual System.\r\n\r\nTo enable Anti-Spoofing for an interface:\r\n\r\n1. From the Topology tab in the Interface Properties window, select Perform Anti-Spoofing based on interface topology.\r\n2. Configure the tracking options.\r\n\r\n# Configuring Multicast Restrictions \r\n\r\nIP multicast applications send one copy of each datagram (IP packet) and address it to a group of computers that wish to receive it. Multicast restrictions allow you to define rules that block outbound datagrams from specific multicast groups (IP address ranges). You can define multicast access restrictions for physical and Warp interfaces in a VSX environment.\r\n\r\n|  | From | To |\r\n| :-- | :-- | :-- |\r\n| IPv4 (defined in RFC <br> 1112) | 224.0 .0 .0 | 239.255 .255 .255 |\r\n| IPv6 | ff00:: | ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff |\r\n\r\nTo enable multicast restrictions:\r\n\r\n1. From the Multicast Restrictions tab in the Interface Properties window, select Drop multicast packets by the following conditions.\r\n2. Select a restriction type:\r\n\r\n- Drop multicast packets whose destination is in the list\r\n- Drop all multicast packets except those whose destination is in the list\r\n\r\n2. Click Add.\r\n\r\nThe Add Object window opens.\r\n3. Click New > Multicast Address Range.\r\n\r\nThe Multicast Address Range Properties window opens.\r\n4. Configure these settings:\r\n\r\n- Name\r\n- Type\r\n- If you selected IP Address Range, enter the First and Last IP addresses.\r\n\r\n5. Click OK.\r\n6. From the Interface Properties window, select a tracking option.\r\n7. Click OK and close the General Properties window.\r\n8. Add a rule to the Access Control Policy that allows traffic for the specified multicast groups.\r\n\r\n## Changing an Interface Definition\r\n\r\nThis section presents procedures for modifying existing interface definitions and related features.\r\nInterfaces definitions are always associated with a VSX Gateway or a Virtual System definition.\r\n\r\nTo change an existing interface definition:\r\n\r\n1. Double-click the interface in the Interfaces section.\r\n2. In the Interface Properties window, define the interface properties.\r\n\r\n3. Click OK.\r\n4. Install the applicable Access Control Policy.\r\n\r\n# Deleting an Interface \r\n\r\nTo delete an interface:\r\n\r\n1. From the Topology page, select the interface and click Delete.\r\n2. Click OK.\r\n3. Install the applicable Access Control Policy.\r\n\r\n# Working with Authentication \r\n\r\n## Authentication Schemes\r\n\r\nAuthentication schemes employ user names and passwords to identify valid users.\r\nSome schemes are maintained locally, storing user names and passwords on the VSX Gateway, while others store authentication information on an external authentication server.\r\n\r\nSome schemes, such as SecurID, are based on providing a one-time password.\r\nFor more information, see the R81.20 Security Management Administration Guide > Section Configuring Authentication Methods for Users.\r\n\r\n## Check Point Password\r\n\r\nCheck Point password is a static password that is configured in SmartConsole. For administrators, the password is stored in the local database on the Security Management Server. For users, it is stored on the local database on the Security Gateway. No additional software is required.\r\n\r\n## Operating System Password\r\n\r\nOS Password is stored on the operating system of the computer on which the Security Gateway(for users) or Security Management Server (for administrators) is installed. You can also use passwords that are stored in a Windows domain. No additional software is required.\r\n\r\n## RADIUS\r\n\r\nRemote Authentication Dial-In User Service (RADIUS) is an external authentication method that provides security and scalability by separating the authentication function from the access server.\r\n\r\nUsing RADIUS, the Security Gateway forwards authentication requests by remote users to the RADIUS server. For administrators, the Security Management Server forwards the authentication requests. The RADIUS server, which stores user account information, does the authentication.\r\n\r\nThe RADIUS protocol uses UDP to communicate with the gateway or the Security Management Server.\r\nRADIUS servers and RADIUS server group objects are defined in SmartConsole.\r\n\r\n## TACACS\r\n\r\nTerminal Access Controller Access Control System (TACACS) provides access control for routers, network access servers and other networked devices through one or more centralized servers.\r\n\r\nTACACS is an external authentication method that provides verification services. Using TACACS, the Security Gateway forwards authentication requests by remote users to the TACACS server. For administrators, it is the Security Management Server that forwards the requests. The TACACS server, which stores user account information, authenticates users. The system supports physical card key devices or token cards and Kerberos secret key authentication. TACACS encrypts the user name, password, authentication services and accounting information of all authentication requests to ensure secure communication.\r\n\r\n# SecurID \r\n\r\nSecurID requires users to both possess a token authenticator and to supply a PIN or password. Token authenticators generate one-time passwords that are synchronized to an RSA Authentication Manager (AM) and may come in the form of hardware or software. Hardware tokens are key-ring or credit cardsized devices, while software tokens reside on the PC or device from which the user wants to authenticate. All tokens generate a random, one-time use access code that changes approximately every minute. When a user attempts to authenticate to a protected resource, the one-time use code must be validated by the AM.\r\n\r\nUsing SecurID, the Security Gateway forwards authentication requests by remote users to the AM. For administrators, it is the Security Management Server that forwards the requests. The AM manages the database of RSA users and their assigned hard or soft tokens. The Security Gateway or the Security Management Server act as an AM agent and direct all access requests to the RSA AM for authentication. For additional information on agent configuration, refer to RSA Authentication Manager documentation.\r\n\r\nThere are no specific parameters required for the SecurID authentication method. Authentication requests can be sent over SDK-supported API or through REST API.\r\n\r\nThere are no specific parameters required for the SecurID authentication method.\r\n\r\n## Configuring SecurID Authentication\r\n\r\nSee the R81.20 Security Management Administration Guide > Chapter Managing User and Administrator Accounts > Section Managing User Accounts > Section SecurID Authentication for Security Gateway.\r\n\r\n## Configuring RADIUS or TACACS Authentication\r\n\r\nThese are the options to enable connectivity between Virtual Systems and a RADIUS or TACACS/TACACS+ server:\r\n\r\n- Shared configuration: All authentication servers are accessible by all Virtual Systems through the VSX Gateway. This is the default option.\r\n- Private configuration: Authentication servers are accessed directly by the Virtual System and use the Virtual System cluster IP address as the source address.\r\n\r\nFor Multi-Domain Server configurations, make sure that you configure the SecurID or Remote Authentication settings of the Domain Management Server that manages the Virtual Systems.\r\n\r\n## Configuring Shared Authentication\r\n\r\nConfigure shared authentication so that all the Virtual Systems on the VSX Gateway authenticate to the remote RADIUS or TACACS/TACACS+ server.\r\n\r\nTo configure shared authentication for RADIUS or TACACS/TACACS+:\r\n\r\n1. Configure shared authentication on the Virtual Systems.\r\na. Connect with SmartConsole to the Management Server.\r\nb. From the left navigation panel, click Gateways \\& Servers.\r\nc. Double-click the Virtual System object.\r\n\r\nThe Virtual Systems General Properties window opens.\r\nd. From the navigation tree, select Other > Authentication.\r\n\r\ne. Make sure that RADIUS or TACACS and Shared are selected.\r\nf. Click OK.\r\ng. Install the policy on the Virtual Systems.\r\n\r\nRepeat these Steps for each Virtual System.\r\n2. For a VSX Cluster:\r\n\r\nOn the Management Server that manages this VSX Cluster, make sure that Hide NAT is disabled.\r\nOn Multi-Domain Server, work in the context of the Target Domain Management Server that manages the Virtual System.\r\na. Edit the applicable table.def file. See sk98339.\r\nb. Make sure that the no_hide_services_ports parameter contains the UDP ports for RADIUS or TACACS, or the TCP ports for TACACS+.\r\n\r\nThe default ports are:\r\n\r\n- RADIUS - 1645\r\n- TACACS/TACACS+ - 49\r\n\r\nSample RADIUS parameter with Hide NAT disabled:\r\n\r\n```\r\nno_hide_services_ports = { <49, 6>, <49, 17>, <500, 17>, <259,\r\n17>, <1701, 17>, <123, 17>, <1645, 17> };\r\n```\r\n\r\nc. Save the changes in the file and exit the editor.\r\nd. In SmartConsole, install the policy on the Virtual Systems.\r\n\r\n# Configuring Private Authentication \r\n\r\nFor private configurations, the active and standby Virtual Systems use the same encryption key to authenticate to the remote RADIUS or TACACS/TACACS+ server.\r\n\r\nFor High Availability configurations, make sure that the Active and Standby Virtual Systems on each VSX Cluster Member use the same VIP address.\r\n\r\n## To configure private authentication:\r\n\r\n1. Configure private authentication on the VSX Gateway and the Virtual Systems.\r\na. Connect with SmartConsole to the Management Server.\r\nb. From the left navigation panel, click Gateways \\& Servers.\r\nc. Double-click the VSX Gateway object.\r\n\r\nThe General Properties view opens.\r\nd. From the navigation tree, select Other > Legacy Authentication.\r\ne. Make sure that RADIUS or TACACS are selected.\r\nf. Click OK.\r\ng. From SmartConsole, install the Access Control Policy on the Virtual System.\r\n\r\nRepeat these steps for each Virtual System.\r\n\r\n2. For VSX Cluster:\r\n\r\nOn the Management Server that manages this VSX Cluster, make sure that Hide NAT is enabled.\r\nFor Multi-Domain Server, use the Domain Management Server that manages the Virtual System.\r\na. Edit the applicable table.def file (see sk98339) in a plain-text editor.\r\nb. Make sure that the no_hide_services_ports parameter DOES NOT contain the UDP ports for RADIUS or TACACS, or the TCP ports for TACACS+.\r\n\r\nThe default ports are:\r\n\r\n- RADIUS - 1645\r\n- TACACS/TACACS+ - 49\r\n\r\nSample parameter with Hide NAT enabled:\r\n\r\n```\r\nno_hide_services_ports = { <500, 17>, <259, 17>, <1701, 17>,\r\n<123, 17> };\r\n```\r\n\r\nc. Save the changes in the file and exit the editor.\r\nd. From SmartConsole, install the Access Control Policy on each Virtual System.\r\n\r\n# Tracking the Status of VSX Objects \r\n\r\nUse the SmartConsole Logs \\& Monitor features to show the status of all Security Gateways, VSX Gateways and other Virtual Devices.\r\n\r\nThe Overall status of a Virtual Device is the most serious status of its Software Blades.\r\nFor example, if all the Software Blades statuses are OK except for the SmartEvent blade, which has a Problem status, then the Overall status will be Problem.\r\n\r\n| Status icon | Description |\r\n| :--: | :--: |\r\n| - OK | The VSX Gateway and all its Software Blades are working properly. |\r\n| - Attention | At least one Software Blade has a minor issue, but the VSX Gateway works. |\r\n| - Problem | At least one Software Blade reported a malfunction, or an enabled Software Blade is not installed. |\r\n| \\& Waiting | SmartView Monitor is waiting for the Security Management Server to send data from Security Gateways. |\r\n| - Disconnected | Cannot reach the Security Gateway. |\r\n| - Untrusted | Cannot make Secure Internal Communication between the Security Management Server and the VSX Gateway. |\r\n\r\n# Working with Network Address Translation (NAT) \r\n\r\nThis section describes the process for using Network Address Translation (NAT) in a VSX deployment. The procedures described in this section assume that the reader is familiar with NAT concepts and their implementation in Check Point products.\r\n\r\nFor more about NAT, see the R81.20 Security Management Administration Guide - Section Configuring NAT Policy.\r\n\r\nVSX supports NAT for Virtual Systems much in the same manner as a physical Security Gateway. When a NAT enabled (Static or Hide) Virtual System connects to a Virtual Router, the translated routes are automatically forwarded to the appropriate Virtual Router.\r\n\r\nConfigure NAT using the NAT page in the Virtual System window. Hide or Static NAT addresses configured in this manner are automatically forwarded to the Virtual Router to which the Virtual System is connected. Alternatively, you can manually add NAT routes on the Topology page in the Virtual Router window.\r\n\r\nTo configure NAT for a Virtual System on a VSX Gateway:\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| 1 | Connect with SmartConsole to the Security Management Server / Target Domain Management Server that manages this Virtual System. |\r\n| 2 | From the left navigation panel, click Gateways \\& Servers. |\r\n| 3 | Open the Virtual System object. |\r\n| 4 | From the navigation tree, click NAT > Advanced. <br> The Advanced page opens. |\r\n| 5 | Select Add Automatic Address Translation. |\r\n| 6 | Select the Translation method. <br> - Hide - Hide NAT only allows connections originating from the internal network. Internal hosts can access internal destinations, the Internet and other external networks. External sources cannot initiate a connection to internal network addresses. Select one of these options: <br> - Hide behind Gateway - Hides the real address behind the VSX Gateway external interface address. This is equivalent to hiding behind the address $0.0 .0 .0$ for IPv4, or : : for IPv6. <br> - Hide behind IP Address - Hides the real address behind a virtual IP address, which is a routable, public IP address that does not belongs to any real machine. <br> - Static - Static NAT translates each private address to a corresponding public address. Enter the static IP address. |\r\n| 7 | From the Install on Gateway list, select the VSX Gateway. |\r\n| 8 | Click OK. |\r\n\r\n| Step | Instructions |\r\n| :-- | :-- |\r\n| 9 | Install the Access Control Policy on this Virtual System. |\r\n\r\n# To configure NAT for a Virtual System on a VSX Cluster: \r\n\r\nUse case - Perform Hide NAT on traffic a Virtual System itself generates in a VSX Cluster, so that the Virtual System could connect to external resources (for example, update Anti-Bot signatures from the Check Point cloud).\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| 1 | Connect to the command line on each VSX Cluster Member. |\r\n| 2 | Log in to the Expert mode. |\r\n| 3 | Switch to the context of the applicable Virtual System: [Expert@HostName:0]\\# vsenv <VSID> |\r\n| 4 | Get the Funny IP address of the applicable Virtual System interface, through which the applicable traffic goes out. <br> Note - Funny IP address is the IP address that belongs to cluster's internal communications network (open the VSX Cluster object properties and go to the \"Cluster Members\" pane). Run one of these commands: <br> - [Expert@HostName: <VSID>]\\# fw getifs <br> - [Expert@HostName: <VSID>]\\# \\ifconfig <br> Write down the Funny IP address. |\r\n| 5 | Connect with SmartConsole to the Security Management Server / Target Domain Management Server that manages this Virtual System. |\r\n| 6 | From the left navigation panel, click Gateways \\& Servers. |\r\n| 7 | Create a new Node Host object and assign to it the Funny IP address you wrote down in Step 4. |\r\n| 8 | Create a new Node Host object and assign to it the NATed IP address. |\r\n| 9 | From the left navigation panel, click Security Policies. |\r\n\r\n| Stop | Instructions |\r\n| :--: | :--: |\r\n| 10 | In the Access Control > NAT policy, create the applicable NAT rule to hide the traffic from the Virtual System behind the NATed IP address: <br> - Original Source - Must be a Node Host object with the Funny IP address of the Virtual System <br> - Original Destination - * Any <br> - Original Services -* Any <br> - Translated Source - Must be a Node Host object with the NATed IP address of the Virtual System <br> - Translated Destination - = Original <br> - Translated Services - = Original <br> - Install On - * Policy Targets, or the Virtual System object <br> - Comment - Applicable text (for example, \"Manual NAT rule for VSXcluster3-VS2 Funny IP\") |\r\n| 11 | Install the Access Control Policy on this Virtual System. |\r\n\r\n# Configuring Application Control or URL Filtering on VSX \r\n\r\nThis section contains the instructions to enable Application Control and URL Filtering Software Blades on Virtual Systems.\r\n\r\nFor more information, see sk106496 and sk79700.\r\n\r\n## Important:\r\n\r\n- Make sure the routing, DNS, and proxy settings for the VSX Gateway or VSX Cluster Members (VSO) are configured correctly.\r\n- Do not enable these Software Blades in the VSX Gateway or VSX Cluster object.\r\n- Make the VSX Gateway or VSX Cluster Members can connect to the Internet. Virtual Systems get updates through the VSX Gateway or VSX Cluster Members (VSO).\r\n\r\nTo enable Application Control and URL Filtering on Virtual Systems:\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| 1 | If applicable, configure proxy settings for the VSX Gateway or VSX Cluster (VSO), or the Virtual Systems (or both) in SmartConsole: <br> a. From the left navigation panel, click Gateways \\& Servers. <br> b. Double-click the VSX Gateway object (or the applicable Virtual System object). <br> c. From the navigation tree, click Topology > Proxy. <br> d. Configure the proxy settings. <br> e. Click OK |\r\n| 2 | Enable Application Control or URL Filtering on the applicable Virtual Systems: <br> a. Double-click the applicable Virtual System object. <br> b. From the navigation tree, click General Properties. <br> c. On the Network Security tab, select any or all of these Software Blades: <br> - Application Control <br> - URL Filtering <br> d. From the navigation tree, click and configure the Software Blades you enabled. <br> e. Click OK |\r\n| 3 | Configure the Access Control policies for the applicable Virtual Systems. |\r\n| 4 | Install the Access Control policies on the applicable Virtual Systems. |\r\n\r\nFor more about Application \\& URL Filtering, see the R81.20 Security Management Administration Guide.\r\nFor more information about these Software Blades on VSX Gateway, see sk106496 and sk79700.\r\n\r\n# Configuring Threat Prevention on VSX \r\n\r\nThis section contains the instructions to enable Threat Prevention Software Blades on VSX Virtual Systems.\r\nFor more information, see sk106496 and sk79700.\r\n\r\n## To enable Anti-Bot, Anti-Virus, or IPS on Virtual Systems\r\n\r\nImportant:\r\n\r\n- Make sure the routing, DNS, and proxy settings for the VSX Gateway or VSX Cluster Members (VSO) are configured correctly.\r\n- You must enable and configure the Software Blades in these objects:\r\n- VSX Gateway or VSX Cluster (because VSO handles contract validation for all Virtual Systems).\r\n- Applicable Virtual Systems.\r\n- Make sure the VSX Gateway or VSX Cluster and the applicable Virtual Systems can connect to the Internet.\r\nVirtual Systems get updates through the VSX Gateway or VSX Cluster (VSO). If the VSX Gateway or VSX Cluster fails to connect, each Virtual System uses its proxy settings to get the updates from the Internet.\r\n\r\n\r\n## Step\r\n\r\n1\r\n\r\n## Instructions\r\n\r\nIf applicable, configure proxy settings for the VSX Gateway or VSX Cluster (VSO) or the Virtual Systems (or both) in SmartConsole:\r\na. From the left navigation panel, click Gateways \\& Servers.\r\nb. Double-click the VSX Gateway or VSX Cluster object (or the applicable Virtual System object).\r\nc. From the navigation tree, click Topology > Proxy.\r\nd. Configure the proxy settings.\r\ne. Click OK\r\n\r\nEnable the Software Blade on the VSX Gateway or VSX Cluster (VSO):\r\n\r\n1. Double-click the applicable VSX Gateway or VSX Cluster object.\r\n2. From the navigation tree, click General Properties.\r\n3. On the Threat Prevention tab, select any or all of these Software Blades:\r\n\r\n- Anti-Bot\r\n- Anti-Virus\r\n- IPS\r\n\r\nWhen you enable these Software Blades, the First Time Activation window opens.\r\nYou must select:\r\n\r\n- According to the policy\r\n- Detect only\r\n\r\n4. From the navigation tree, click and configure the Software Blades you enabled.\r\n5. Click OK.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| 3 | Enable the Software Blade on the applicable Virtual Systems: <br> 1. Expand the VSX Gateway or VSX Cluster object and double-click the applicable Virtual System object. <br> 2. From the navigation tree, click General Properties. <br> 3. On the Threat Prevention tab, select any or all of these Software Blades (the same you selected in the VSX Gateway or VSX Cluster object): <br> - Anti-Bot <br> - Anti-Virus <br> - IPS <br> When you enable these Software Blades, the First Time Activation window opens. You must select: <br> - According to the policy <br> - Detect only <br> 4. From the navigation tree, click and configure the Software Blades you enabled. <br> 5. Click OK. |\r\n| 4 | Configure the Threat Prevention policies for: <br> - The VSX Gateway or VSX Cluster (VS0). <br> - The applicable Virtual Systems. |\r\n| 5 | Install the default VSX policy on the VSX Gateway or VSX Cluster. This policy is called: <br> <Name of VSX Gateway or VSX Cluster Object>_VSX |\r\n| 6 | Install the Threat Prevention policy: <br> - On the VSX Gateway or VSX Cluster (VS0). <br> - On the applicable Virtual Systems (and Access Control Policy, if needed). |\r\n\r\n# To enable Threat Emulation on Virtual Systems \r\n\r\nImportant:\r\n\r\n- Make sure the routing, DNS, and proxy settings for the VSX Gateway or VSX Cluster Members (VS0) are configured correctly.\r\n- Do not enable the Threat Emulation Software Blade in the VSX Gateway or VSX Cluster object, because it does not participate in the Threat Emulation process.\r\n\r\n\r\n## Step\r\n\r\nInstructions\r\n\r\n1\r\n\r\nIf applicable, configure proxy settings for the VSX Gateway or VSX Cluster (VS0), or the Virtual Systems (or both) in SmartConsole:\r\na. From the left navigation panel, click Gateways \\& Servers.\r\nb. Double-click the VSX Gateway or VSX Cluster object (or the applicable Virtual System object).\r\nc. From the navigation tree, click Topology > Proxy.\r\nd. Configure the proxy settings.\r\ne. Click OK\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| 2 | Enable Threat Emulation on the applicable Virtual Systems: <br> a. Expand the VSX Gateway or VSX Cluster object and double-click the applicable Virtual System object. <br> b. From the navigation tree, click General Properties. <br> c. On the Custom Threat Prevention tab, select SandBlast Threat Emulation. <br> The Threat Emulation First Time Activation Wizard opens. <br> d. Configure the Emulation Location and click Next. <br> e. Configure the settings on the Activate Threat Extraction page and click Next. <br> f. In the Summary window, click Finish. <br> g. From the navigation tree, click and configure the Software Blades you enabled. <br> h. Click OK. |\r\n| 3 | Configure the Threat Prevention policies for the applicable Virtual Systems. |\r\n| 4 | Install the Threat Prevention policy on the applicable Virtual Systems (and Access Control Policy, if needed). |\r\n\r\n# To enable Threat Extraction on Virtual Systems \r\n\r\nImportant:\r\n\r\n- Make sure the routing, DNS, and proxy settings for the VSX Gateway or VSX Cluster Members (VS0) are configured correctly.\r\n- Enable the Threat Extraction Software Blade in the VSX Gateway or VSX Cluster object.\r\n\r\n\r\n## Step\r\n\r\nInstructions\r\n1\r\nIf applicable, configure proxy settings for the VSX Gateway or VSX Cluster (VS0) or the Virtual Systems (or both) in SmartConsole:\r\n\r\n1. From the left navigation panel, click Gateways \\& Servers.\r\n2. Double-click the VSX Gateway or VSX Cluster object (or the applicable Virtual System object).\r\n3. From the navigation tree, click Topology > Proxy.\r\n4. Configure the proxy settings.\r\n5. Click OK\r\n\r\n2 Enable Threat Extraction on the applicable Virtual Systems:\r\n\r\n1. Expand the VSX Gateway or VSX Cluster object and double-click the applicable Virtual System object.\r\n2. From the navigation tree, click General Properties.\r\n3. On the Threat Prevention tab, select SandBlast Threat Extraction.\r\n4. Click OK.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| 3 | Optional: When you enable Threat Extraction, support for web traffic over the HTTP and HTTPS protocol is enabled automatically. For Threat Extraction to scan e-mail attachments as well, configure the Security Gateway as a Mail Transfer Agent (MTA) (see the R81.20 Threat Prevention Administration Guide > Chapter Mail Transfer Agent. |\r\n| 4 | Configure the Threat Prevention policies for: <br> - The VSX Gateway or VSX Cluster (VS0). <br> - The applicable Virtual Systems. |\r\n| 5 | Install the default VSX policy on the VSX Gateway or VSX Cluster. This policy is called: <br> <Name of VSX Gateway or VSX Cluster Object>_VSX |\r\n| 6 | Install the Threat Prevention policy: <br> - On the VSX Gateway or VSX Cluster (VS0). <br> - On the applicable Virtual Systems (and Access Control Policy, if needed). |\r\n\r\n# Licensing VSX \r\n\r\nCheck Point software is activated with a license key. To obtain a license key, register the certificate key (that appears on the back of the software media pack) with the Check Point User Center. The certificate key is used to generate a license key for the products that you are either evaluating or purchasing. To purchase the required Check Point products, contact your reseller. Check Point software that has not yet been purchased functions for 15 days only.\r\n\r\n## VSX Licenses\r\n\r\nEach VSX Gateway or VSX Cluster Member requires its own license, bound to the VSX Gateway or VSX Cluster Member IP address. Each VSX Gateway or VSX Cluster license covers a predefined number of Virtual Systems (3, 10, 25, and 50) and these licenses are cumulative. The VSX licenses are applied in addition to the Security Gateway license (container and Software Blades).\r\n\r\n## Upgrading Licenses\r\n\r\nBefore upgrading a Security Gateway or Security Management Server to R81.20, you need to have a valid support contract that includes software upgrade and major releases registered to your Check Point User Center account. The Security Management Server stores the contract file and downloads it to Security Gateways during the upgrade. By verifying your status with the User Center, the contract file enables you to easily remain compliant with current Check Point licensing standards.\r\n\r\nThe license upgrade procedure can be performed if you have purchased any of the Enterprise Software Subscription services. To upgrade a VSX license, do the Software Blades upgrade procedure. See sk65850.\r\n\r\n## The Trial Period\r\n\r\nWhen installing a Check Point product for the first time, users receive a 15 day trial period, during which the product is fully functional. Once the trial period expires, you must purchase and install the appropriate permanent product licenses. During the trial period, you can define up to 25 Virtual Systems.\r\n\r\n# Using VSX with Multi-Domain Server \r\n\r\nYou can manage a VSX deployment using Multi-Domain Server.\r\nOnly procedures specific to VSX deployments are discussed.\r\nThis chapter assumes that you are familiar with the Multi-Domain Server product.\r\nFor more about Multi-Domain Server, see the R81.20 Multi-Domain Security Management Administration Guide.\r\n\r\nCheck Point Multi-Domain Server is a centralized security management solution that addresses the unique requirements of service providers and large enterprises. By using Multi-Domain Server, administrators can centrally manage multiple independent networks, often belonging to different Domains, divisions, or branches.\r\n![[CP_R81.20_VSX_AdminGuide_img_28.jpeg]]\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 1 | SmartConsole |\r\n| 2 | Multi-Domain Server |\r\n| 3 | Domain Management Server |\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 4 | Main Domain Management Server |\r\n| 5 | VSX Gateway |\r\n| 6 | Virtual Systems in Domain Management Servers |\r\n\r\nThe Multi-Domain Server is a central Management Server that hosts the network management and security policy databases for these networks. Each independent domain is represented by a Domain, which provides the full functionality of a Security Gateway. Each Domain Management Server can host Virtual Systems, Virtual Routers and Virtual Switches as well as physical Check Point Security Gateways.\r\n\r\nThe Domain Management Server that manages a VSX Gateway or cluster is known as a Main Domain Management Server. You can host multiple Gateways and/or clusters on one Multi-Domain Server. Virtual Systems belonging to a given Domain can be distributed among multiple VSX Gateways and clusters.\r\n\r\nWhen connected to a Multi-Domain Server, SmartConsole offers a centralized management solution for Domains, Domain Management Servers and the Multi-Domain Server environment. Each Domain Management Server uses its own instance of SmartConsole, which is accessible only via the Multi-Domain Server, to provision its Virtual Devices and physical Gateways, as well as to manage their Security Policies.\r\n\r\n# VSX Provisioning \r\n\r\nThe procedures for provisioning and configuring VSX Gateways, clusters and Virtual Devices using the Multi-Domain Server model are essentially the same as described for the Security Gateway management model.\r\n\r\nThe most important difference is that you must first create and configure each Domain and its associated Domain Management Server objects using the SmartConsole connected to a Multi-Domain Server.\r\n\r\nEach Domain Management Server is the functional equivalent of one VSX Gateway.\r\nYou connect to each Domain Management Server with SmartConsole to work with network objects, security policies and other objects for that VSX Gateway.\r\n\r\nThis is the basic workflow for provisioning a VSX environment in a Multi-Domain Server deployment:\r\n\r\n1. Define and configure Multi-Domain Server and Multi-Domain Log Server as applicable for your deployment.\r\n2. Create and configure a Domain and Domain Management Server for each VSX Gateway and/or VSX Cluster.\r\n3. With SmartConsole, connect to the Domain Management Server to create and configure the VSX Gateway and/or VSX Cluster objects.\r\n\r\nSee \"Working with VSX Gateways\" on page 66 and \"Working with VSX Clusters\" on page 125.\r\nConfigure the default security policy for these objects as necessary.\r\n4. Define individual Domains and Domain Management Servers as required for your deployment.\r\n5. Create and configure Virtual Systems and other Virtual Devices for each Domain in the SmartConsole connected to that Domain.\r\n\r\nSee \"Working with Virtual Systems\" on page 70, \"Working with Virtual Switches\" on page 85, and \"Working with Virtual Routers\" on page 88.\r\n\r\n# Defining Multi-Domain Servers \r\n\r\nThis section briefly presents the procedures for installing and deploying Multi-Domain Server machines in a VSX / Multi-Domain Server environment.\r\n\r\nSee the R81.20 Multi-Domain Security Management Administration Guide for conceptual information and detailed procedures for configuring Multi-Domain Servers and Domain Management Servers.\r\n\r\nWhen working with Management High Availability, define at least two Multi-Domain Server machines.\r\nYou can also use multiple Multi-Domain Server machines to efficiently distribute management traffic (management Load Sharing) with more than one Domain Management Server for each Domain. For a Load Sharing deployment, define a Domain Management Server for each Multi-Domain Server.\r\n\r\n# Working with Virtual Devices \r\n\r\nWhen working with Virtual Devices in Multi-Domain Server, you must use the applicable Domain Management Server SmartConsole.\r\n\r\nOtherwise, the configuration procedures are the same to those for a Security Management Server.\r\nMulti-Domain Server treats Virtual Devices in the same way as physical devices.\r\nYou can add as many Virtual Systems to Domain Management Servers as your license permits.\r\nVirtual Systems added to a Domain Management Server do not have to reside on the same VSX Gateway or cluster.\r\n\r\n## Adding a Virtual System to a Domain Management Server\r\n\r\nTo add a new Virtual System to a Domain Management Server:\r\n\r\n1. Launch SmartConsole from the appropriate Domain Management Server.\r\n2. Create and configure the Virtual System (see \"Working with Virtual Systems\" on page 70).\r\n3. Define and install a security policy.\r\n\r\n## Adding Virtual Routers and Virtual Switches to a Domain Management Server\r\n\r\nTo add Virtual Routers and Virtual Switches to a Domain Management Server:\r\n\r\n1. Launch SmartConsole from the appropriate Domain Management Server.\r\n2. Create and configure Virtual Routers (see \"Working with Virtual Routers\" on page 88) and Virtual Switches (see \"Working with Virtual Switches\" on page 85) as required.\r\n\r\n# Configuring VSX Clusters \r\n\r\nThis chapter presents a conceptual overview of VSX Cluster deployments, with emphasis on clustering features and their application.\r\n\r\nIt assumes you are familiar with network cluster applications and environments, particularly ClusterXL.\r\nFor more about Check Point ClusterXL features and functionality, see the R81.20 ClusterXL Administration Guide\r\n\r\n## VSX Cluster Overview\r\n\r\nVSX Clusters provide redundancy and load sharing features for Virtual Systems and other Virtual Devices.\r\nA VSX Cluster consists of two or more identical, interconnected VSX Gateways that ensure continuous data synchronization.\r\n\r\nThe advantages of using clusters in a VSX environment include:\r\n\r\n- Transparent failover in case of VSX Cluster Member or Virtual System failure\r\n- State synchronization ensures zero downtime for mission-critical environments\r\n- Load Sharing maintains system throughput during peak demand\r\n- Enhanced scalability for future traffic growth\r\n\r\nVSX Cluster Modes:\r\n\r\n| Mode | Description |\r\n| :--: | :--: |\r\n| Virtual System Load Sharing (VSLS) | Ensures continuous operation by means of transparent VSX Cluster Member failover. <br> Enhances system performance by distributing Active Virtual Systems amongst VSX Cluster Members. <br> Efficiently balances network traffic load by distributing active Virtual Systems between VSX Cluster Members. <br> All VSX Cluster Members and Virtual Systems are continuously synchronized. |\r\n| High Availability | ![[CP_R81.20_VSX_AdminGuide_img_29.jpeg]] |\r\n\r\nNote - This is the only mode available for a VSX Cluster that was installed as R81.10 or higher.\r\n\r\nEnsures continuous operation by means of transparent VSX Cluster Member failover.\r\nAll VSX Cluster Members and Virtual Systems function in an the Active/Standby mode and are continuously synchronized.\r\n\r\nNote - This mode is available only if you upgrade a VSX Cluster from R81 or lower to R81.20.\r\n\r\n# Physical Clusters \r\n\r\nVSX Cluster is based on Check Point ClusterXL concepts. This section reviews these concepts, and then demonstrates how these principles apply to VSX virtualization.\r\n\r\nIn typical Security Gateway deployment, a cluster consists of two or more identical, interconnected physical Security Gateways that provide redundancy and/or Load Sharing. This cluster behaves as a single Security Gateway and is assigned its own IP address, which is known as its Cluster IP or Virtual IP address. This IP address is distinct from the physical IP addresses of its VSX Cluster Members, which are hidden from the networks connected to the cluster.\r\n\r\nTraffic from external networks or the Internet directed to the internal networks arrives at the external cluster IP address. Depending on the clustering mode (High Availability or Load Sharing), a designated VSX Cluster Member receives the traffic and performs the required inspection. After inspection, traffic is either sent to its destination on the internal network, or dropped.\r\n\r\nInternal networks send traffic destined for the Internet or external networks, to the cluster IP address. This traffic is processed by the designated VSX Cluster Member, inspected, and forwarded to its external destination.\r\n\r\nEach member interface has a unique, physical IP addresses. These IP addresses, which are invisible to physical networks, are used for internal communication between VSX Cluster Members and the Management Server for such tasks as downloading Security Policies, sending logs and checking the status of individual VSX Cluster Members.\r\n\r\n## VSX Clusters\r\n\r\nVSX Clusters, like their physical counterparts, connect two or more synchronized Gateways in such a way that if one fails, another immediately takes its place.\r\n\r\nVSX Clusters are defined at two levels:\r\nVSX ensures that Virtual Systems, Virtual Routers, Virtual Switches and their interfaces are provisioned and configured identically on each VSX Cluster Member.\r\n\r\nThe figure below shows that each VSX Cluster Member contains identical instances of each Virtual Device.\r\nThese identical instances are referred to as peers.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_30.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Virtual System 2 |  | 7 | VSX Cluster Member 1 |\r\n| 2 | Virtual System 1 |  | 8 | VSX Cluster Member 2 |\r\n| 3 | Internet |  | 9 | VLAN switch |\r\n| 4 | Router |  | 10 | Network 2 |\r\n| 5 | External Cluster Interface |  | 11 | Network 1 |\r\n| 6 | Sync |  | - | VLAN Trunk |\r\n\r\nVSX provides the management functionality to support network and security virtualization, including:\r\n\r\n- Assigning virtual IP addresses: Each Virtual Device interface requires its own virtual IP address.\r\n- State synchronization: Virtual Device state tables are synchronized to peers on other VSX Cluster Members.\r\n\r\n# Planning a VSX Cluster Deployment \r\n\r\nAs with physical network deployments, advance planning is the key to successfully creating a working network.\r\n\r\nIP address allocation for a VSX deployment requires particular attention.\r\nThis section takes you through the basics of IP address allocation for a VSX Cluster environment.\r\nYour VSX Cluster configuration choices affect the number of IP addresses required, both public and private.\r\n\r\n## VSX Cluster Architecture\r\n\r\nVSX IP address allocation is similar to physical networks.\r\nBoth real and virtual IP addresses are required for network connectivity (internal and external), management, and state synchronization.\r\n\r\nVSX simplifies the IP address management task by automatically assigning IP addresses to Warp Links between Virtual Devices.\r\n\r\nFor example, Warp Links between a Virtual Router and its associated Virtual Systems are created automatically and assigned IP addresses without user intervention.\r\n\r\nA VSX Cluster network has these components:\r\n\r\n- Synchronization Network\r\n- Internal Communications Network\r\n- Virtual IP addresses\r\n\r\n\r\n## Synchronization Network\r\n\r\nThe synchronization network is a physical network that carries state synchronization data between VSX Cluster Members.\r\n\r\nYou configure the synchronization network during the initial VSX Cluster definition and can make changes as necessary when adding or removing VSX Cluster Members.\r\n\r\nState Synchronization can be used ClusterXL deployments as well as other OPSEC-certified VSX solutions.\r\nThe synchronization network must be configured using unique IP addresses that are not used anywhere else in the enterprise network.\r\n\r\n# Internal Communication Network \r\n\r\nThe internal communication network is a virtual network that is required for ClusterXL environments, in addition to the synchronization network.\r\n\r\nThe internal communication network is invisible to external networks and lets VSX Cluster Members communicate and recognize the state of the environment.\r\n\r\nVSX assigns an IP address to the internal communication network during the cluster creation process.\r\nThis eliminates the need to manually assign an IP address to each VSX Cluster Member:\r\nIPv4 address: 192.168.196.0, netmask: 255.255.252.0 (a range of four class C networks).\r\nIPv6 address and netmask: FD9A: :1FFE:0:0:0/80\r\nYou can modify the default IP address using the Gateway Cluster Properties > Cluster Members page of the VSX Cluster object, but only before creating Virtual Systems.\r\n\r\nOnce Virtual Systems have been created, the IP range of the internal communication network cannot be modified.\r\n\r\nNote - To avoid overlapping IP addresses, before creating any Virtual Devices, make sure the default IP address range of the Internal Communication network is not used anywhere else in the external network.\r\n\r\n## Virtual IP Addresses\r\n\r\nCluster Virtual IP addresses are the only IP addresses visible to the external network.\r\nThe assigned cluster IP addresses must correspond to the directly-connected subnet and server as a valid next hop address.\r\n\r\nThese IP addresses are similar to virtual addresses configured across traditional cluster setups.\r\n\r\n# Working with VSX Clusters \r\n\r\n## Configuration Overview\r\n\r\nYou use SmartConsole for most of the basic cluster configurations. Many cluster management procedures require the command line. For example, you need the CLI to change the VSX Cluster definitions.\r\n\r\n## Creating VSX Clusters\r\n\r\nThis section describes how to create a new VSX Cluster using the VSX Cluster Wizard. The wizard guides you through the steps to configure a VSX Cluster.\r\n\r\nAfter completing the VSX Cluster Wizard, you can modify most VSX Cluster and VSX Cluster Member properties directly from SmartConsole.\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Main Domain Management Server that manages the VSX Cluster.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. At the top, click Objects menu > More object types > Network Object > Gateways and Servers > VSX > New Cluster.\r\n\r\nThe VSX Cluster Wizard > General Properties opens.\r\n\r\n## Defining Cluster General Properties\r\n\r\nThe Cluster General Properties page contains basic properties for VSX Clusters:\r\n\r\n- VSX Cluster Name: Unique, alphanumeric name for the cluster. The name cannot contain spaces or special characters except the underscore.\r\n- VSX Cluster IPv4 Address: IPv4 address of the cluster.\r\n- VSX Cluster IPv6 Address: IPv6 address of the cluster.\r\n- VSX Cluster Version: VSX version to use for this cluster.\r\n- VSX Cluster Platform: Platform type hosting the VSX Cluster Members:\r\n- To create a High Availability cluster, select ClusterXL.\r\n- To create a Load Sharing (VSLS) cluster, select ClusterXL Virtual System Load Sharing.\r\n\r\nNote - All VSX Cluster Members must use the same type of platform, with the same specifications and configuration.\r\n\r\n# Adding VSX Cluster Member \r\n\r\nThe VSX Cluster Members window defines the members of the new cluster. You must define at least two VSX Cluster Members. You can add more members later.\r\n\r\n1. In the VSX Cluster Members window, click Add.\r\n2. The Member Properties window opens.\r\n3. Enter the name and IP addresses for the VSX Cluster Member.\r\n\r\nNote: If you define an IPv6 IP address, you must also have an IPv4 address.\r\n4. Enter and confirm the Activation Key to initialize SIC trust between the VSX Cluster Member and the Management Server.\r\n\r\nNote - You defined this Activation Key during the First Time Configuration Wizard of the VSX Cluster Member.\r\n5. Follow these steps for all VSX Cluster Members.\r\n6. Click Next to continue.\r\n\r\n## Defining Cluster Interfaces\r\n\r\nThe VSX Cluster Interfaces window lets you define physical interfaces as VLAN Trunks.\r\nThe list shows all interfaces currently defined on the VSX Gateway or VSX Cluster object.\r\n\r\n## To configure a VLAN Trunk:\r\n\r\nSelect one or more interfaces to define them as VLAN Trunks. You can clear an interface to remove the VLAN Trunk assignment.\r\n\r\nImportant - You cannot define the management interface as a VLAN trunk. To use the management interface as a VLAN, you must define the VLAN on the VSX Gateway before you use SmartConsole to create the VSX Gateway object.\r\n\r\n## Configuring VSX Cluster Members\r\n\r\nIf you selected the custom configuration option, the VSX Cluster Members window appears.\r\nIn this window, you define the synchronization IP address for each VSX Cluster Member.\r\n\r\n## To configure the VSX Cluster Members:\r\n\r\n1. Select the synchronization interface from the list.\r\n2. Enter the synchronization interface addresses and net mask for each VSX Cluster Member.\r\n\r\nTo use a VLAN as a synchronization interface:\r\n\r\n1. On each VSX Cluster Member, define the VLAN interface on the applicable physical interface.\r\n2. In SmartConsole, create the VSX Cluster object.\r\n3. On each VSX Cluster Member, set the value of the kernel parameter fwha_monitor_all_vlan to 1 in the \\#FWDIR/boot/modules/fwken. conf file. For more information, see sk92826 and \"Working with Kernel Parameters\" on page 328.\r\n\r\n# Cluster Management \r\n\r\nThe VSX Gateway Management page allows you to define several security policy rules that protect the cluster itself. This policy is installed automatically on the new VSX Cluster.\r\n\r\nNote - This policy applies only to traffic destined for the cluster. Traffic destined for Virtual Systems, other Virtual Devices, external networks, and internal networks is not affected by this policy.\r\n\r\nThe security policy consists of predefined rules covering the following services:\r\n\r\n- UDP: SNMP requests\r\n- TCP: SSH traffic\r\n- ICMP: Echo-request (ping)\r\n- TCP: HTTPS (secure HTTP) traffic\r\n\r\n\r\n## Configuring the Cluster Security Policy\r\n\r\n1. Allow: Enable a rule to allow traffic for those services for which you wish to allow traffic. Clear a rule to block traffic. By default, all services are blocked.\r\n\r\nFor example, you may wish to allow UDP echo-request traffic in order to be able to ping VSX Cluster Member from the Management Server.\r\n2. Source: Click the arrow and select a Source Object from the list. The default value is *Any.\r\n\r\nClick New Source Object to define a new source.\r\nFor more about Security Policies, see the R81.20 Security Management Administration Guide.\r\n\r\n# Completing the Wizard \r\n\r\n1. Click Next to continue and then click Finish to complete the VSX Cluster wizard.\r\n\r\nIt can take several minutes to complete. A message appears indicating successful or unsuccessful completion of the process.\r\n\r\nIf the process ends unsuccessfully, click View Report to view the error messages.\r\nRefer to the troubleshooting steps for more information - \"VSX Diagnostics and Troubleshooting\" on page 204.\r\n2. In SmartConsole, double-click the new VSX Cluster object.\r\n3. Configure the applicable settings.\r\n4. Click OK.\r\n5. Install the Access Control Policy.\r\n6. Install the Threat Prevention Policy.\r\n\r\n# Modifying a VSX Cluster Definition \r\n\r\nIn This Section:\r\n\r\n| General Properties | 129 |\r\n| :--: | :--: |\r\n| VSX Cluster Members | 129 |\r\n| ClusterXL | 130 |\r\n| Physical Interfaces | 131 |\r\n| Synchronization | 131 |\r\n| Topology | 131 |\r\n| NAT | 133 |\r\n| VSX Bridge Configuration | 134 |\r\n| Changing the Cluster Management IP and/or Subnet | 134 |\r\n| Changing the Internal Communication Network IP | 134 |\r\n\r\nAfter you create a cluster with the wizard, you can change the topology and other parameters in the Cluster Members Properties window. This window lets you configure many advanced features not available with the wizard.\r\n\r\nTo work with a VSX Cluster definition, double-click a cluster object in SmartConsole. The VSX Cluster Properties window opens.\r\n\r\nYou can define most cluster objects with SmartConsole. There are some features or properties that you must CLI commands to configure.\r\n\r\nA brief explanation for each of the definition pages follows. More detailed explanations for features that are not specific to VSX (NAT, IPS, VPN, etc.) are available in the online help or in the applicable product documentation.\r\n\r\n## General Properties\r\n\r\nSee the General Properties page to view general properties and to activate Software Blades for use with this VSX Cluster.\r\n\r\nYou can modify the following properties:\r\n\r\n- Comment: Free text comment that appears in the Object List and elsewhere\r\n- Color: Color of the object icon as it appears in SmartConsole\r\n- Network Security: Select Software Blades on this VSX Cluster and its Cluster Members\r\n\r\n\r\n## VSX Cluster Members\r\n\r\nThe Cluster Members page lets you view and modify several properties for individual VSX Cluster Members, including IP addresses for Cluster Members and the Internal Communication Network.\r\n\r\n# Gateway VSX Cluster Member List \r\n\r\nThe Cluster Members page shows all the VSX Cluster Members.\r\n\r\n## To edit a VSX Cluster Member:\r\n\r\nFrom the Cluster Member page, select a VSX Cluster Member and click Edit.\r\nThe Cluster Member Properties window opens. These are the settings that you can edit:\r\n\r\n- General tab:\r\n- Comment: Free text comment that appears in the Object List and elsewhere\r\n- Color: Color of the object icon as it appears in SmartConsole\r\n- Secure Internal Communication: Check and reset SIC trust\r\n- Topology tab: Displays the Cluster Member IP address and Net Mask for each interface. Double-click an interface to see its properties.\r\n- NAT tab: Define NAT rules for VSX Cluster Members connected to a Virtual Router.\r\n- VPN tab: Contains a variety of configuration properties for Site-To-Site VPN deployments.\r\n\r\nThis window is only available if the IPsec VPN is enabled on the General Properties page.\r\nFor more about VPN concepts and configurations, see the R81.20 Site to Site VPN Administration Guide.\r\n\r\n## Where Used\r\n\r\nClick Where used to show information about the selected member in the objects database.\r\n\r\n- Name: Cluster name.\r\n- Table: Name of the table in the database under which the selected object is listed.\r\n- Is removable: Specifies whether or not you are allowed to remove the selected object. If the object is not removable and nevertheless you choose to remove it, it will impact the database or Rule Base.\r\n- Refresh: Click to update the window display if you make changes.\r\n- Context: Where the object is used.\r\n\r\n\r\n## Internal IP Address and Net Mask\r\n\r\nVSX creates an internal communication network and automatically assigns it an IP address and net mask from a predefined pool. You can change this IP address here if you have not yet defined a Virtual System. Although traffic from this address is never sent to any networks, you must ensure that this IP address is unique and not in use anywhere on your defined network.\r\n\r\n## ClusterXL\r\n\r\nTo manage state synchronization, open the ClusterXL window, or run the \"vsx_util\" on page 236 command on the Management Server.\r\n\r\n- Enable or disable state synchronization.\r\n- Select tracking options for VSX Cluster Member state changes.\r\n\r\nAll other ClusterXL configuration properties are disabled.\r\n\r\n# Physical Interfaces \r\n\r\nThe Physical Interfaces page allows you to add or delete a physical interface on the VSX Gateway, and to define interfaces to be used as VLAN trunks.\r\n\r\n- To add a new physical interface, click Add and enter the interface name in the appropriate field.\r\n- To define an interface as a VLAN trunk, select the applicable interface and enable the VLAN Trunk option. To disable a VLAN trunk, clear the option.\r\n\r\n\r\n## Synchronization\r\n\r\nThe Synchronization window displays the state synchronization network. There are no configurable properties.\r\n\r\n## Topology\r\n\r\nOn the Topology page, you can see and configure interface and routing definitions.\r\n\r\n## Interfaces\r\n\r\nThe Interfaces section defines interfaces and links to devices. You can add new interfaces as well as delete and modify existing interfaces.\r\n\r\nTo add an interface:\r\n\r\n1. Click New and select one of these options:\r\n\r\n- Regular - Create a new interface\r\n- State Synchronization\r\n- Leads to Virtual Router\r\n- Leads to Virtual Switch\r\n\r\nThe Interface Properties window opens.\r\nClick Actions > Copy to Clipboard to copy the Interfaces table in CSV format.\r\n2. Define the appropriate properties.\r\n3. Click OK.\r\n\r\nTo change an interface:\r\n\r\n1. Double-click an interface.\r\n\r\nThe Interface Properties window opens.\r\n2. Change the parameters for the interface.\r\n3. Click OK.\r\n\r\nTo delete an interface:\r\n\r\n1. From the Topology page, select the interface and click Delete.\r\n2. Click OK.\r\n\r\n# Routes \r\n\r\nThe Routes section of the Topology window defines routes between network devices, network addresses, and Virtual Devices. Some routes are defined automatically based on the interface definitions. You can add, change, and delete routes.\r\n\r\nTo add a default route to the routing table:\r\n\r\n1. Click Add Default Route.\r\n\r\nThe Default Gateway window opens.\r\n2. Enter the default route IP address or select the default Virtual Router.\r\n3. Click OK.\r\n\r\nThe default route is added to the routing table.\r\n4. Select the default route and click Edit.\r\n\r\nThe Route Configuration window opens.\r\n5. Configure the settings for the default route.\r\n6. Click OK.\r\n\r\nTo add a new route to the routing table:\r\n\r\n1. Click Add.\r\n\r\nThe Route Configuration window opens.\r\n2. Configure the Destination IP address and netmask.\r\n3. Configure the next hop IP address or Virtual Router.\r\n4. Optional: Select Propagate route to adjacent Virtual Devices to \"advertise\" the route to neighboring Virtual Devices, and enable connectivity between them.\r\n5. Click OK.\r\n\r\nTo change a route:\r\n\r\n1. Select the route.\r\n2. Click Edit.\r\n\r\nThe Route Configuration window opens.\r\n3. Change the settings.\r\n4. Click OK.\r\n\r\nTo delete a route:\r\n\r\n1. Select the route.\r\n2. Click Remove.\r\n\r\nA confirmation window opens.\r\n3. Click OK.\r\n\r\n# Calculating Topology Automatically Based on Routing Information \r\n\r\nEnable this option to allow VSX to automatically calculate the network topology based on interface and routing definitions (enabled by default). VSX creates automatic links, or connectivity cloud objects linked to existing internal or external networks.\r\n\r\n- This option is not available in Bridge mode.\r\n- When employing dynamic routing, it is recommended to disable this option.\r\n\r\n\r\n## VPN Domain\r\n\r\nThe VPN Domain section in the Topology page defines the set of hosts that use a VPN tunnel to communicate with peer Virtual Systems.\r\n\r\nDefine a VPN Domain to include a Virtual Device as part of the VPN connection. The domain defines the Virtual System interfaces that are in the VPN. You can define a VPN Domain in different ways:\r\n\r\n- All IP Addresses behind Cluster Members are based on topology information: Includes all hosts not located behind an external VSX Cluster Member interface.\r\n- Manually Defined: Includes all hosts in the selected network or group.\r\n- Remote Access Communities: Define an alternative VPN domain for Remote Access Community traffic.\r\n\r\n\r\n## To specify the VPN domain:\r\n\r\n1. Click Set domain for Remote Access Community.\r\n\r\nThe VPN Domain per Remote Access Community window opens.\r\n2. Double-click a Remote Access Community.\r\n\r\nThe Set VPN Domain window opens.\r\n3. Select a VPN domain from the list, or click New, to define a new domain.\r\n4. Click OK.\r\n\r\n## NAT\r\n\r\nThe NAT > Advanced page lets you configure NAT rules for packets originating from a Virtual System.\r\n\r\nTo enable and configure NAT for a Virtual System:\r\n\r\n1. Select Add Automatic Address Translation.\r\n2. Select a translation method:\r\n\r\n- Hide: Hide NAT only allows connections originating from the internal network. Internal hosts can access internal destinations, the Internet and other external networks. External sources cannot initiate a connection to internal network addresses.\r\n- Static: Static NAT translates each private address to a corresponding public address.\r\n\r\n3. If you select Hide, select one of these options:\r\n\r\n- Hide behind Gateway hides the real IP address behind the Virtual System external interface IP address,\r\nor\r\n- Hide behind IP Address hides the real address behind a virtual IP address, which is a routable, public IP address that does not belongs to any real machine.\r\n\r\n4. If you selected Static NAT, enter the static IP address in the appropriate field.\r\n5. Select the VSX Gateway from the Install on Gateway list.\r\n\r\n# VSX Bridge Configuration \r\n\r\nThe VSX Bridge Configuration page allows you to specify the loop detection algorithm when working in the Bridge mode.\r\n\r\nEnable the Check Point ClusterXL option to enable the Active/Standby Bridge Mode loop detection algorithms contained in ClusterXL.\r\n\r\nEnable the Standard Layer 2 Loop Detection Protocols to use standard loop detection protocols, such as STP or PVST+.\r\n\r\nSee \"Bridge Mode\" on page 193.\r\n\r\n## Changing the Cluster Management IP and/or Subnet\r\n\r\nTo add, change or delete the cluster management IP address and/or subnet, run the \"vsx_util change_ mgmt_ip\" on page 245 and \"vsx_util change_mgmt_subnet\" on page 246 commands on the Management Server.\r\n\r\n## Changing the Internal Communication Network IP\r\n\r\nYou can change the internal communication network IP address by using the \"vsx_util change_private_net\" on page 247 command on the Management Server.\r\n\r\n# Working with VSX Cluster Members \r\n\r\nThis section presents procedures for adding and deleting VSX Cluster Members.\r\n\r\n## Adding a New VSX Cluster Member\r\n\r\nImportant - Make sure that no other administrators are connected to the Management Server before you perform this procedure. The vsx_util command cannot modify the management database, if the database is locked because other administrators are connected.\r\n\r\n1. Install the new VSX Cluster Member.\r\n\r\nSee the R81.20 Installation and Upgrade Guide.\r\n2. Close all SmartConsole windows.\r\n3. Create a full backup of the environment (see sk100395).\r\n4. Connect to the command line on the Management Server.\r\n5. Log in the Expert mode.\r\n6. Run this command and follow the on-screen instructions:\r\n\r\n```\r\nvsx_util add_member\r\n```\r\n\r\na. Enter the IP address of the Security Management Server or Main Domain Management Server.\r\nb. Enter the Management Server administrator user name and password.\r\nc. Follow the on-screen instructions.\r\n7. Wait until the add member operation finished successfully message appears, indicating that the database has been successfully updated and saved.\r\n\r\nNote - In a Multi-Domain Server environment, this operation skips all Domain Management Servers locked by an administrator. If this should occur, run the command again for the affected Domain Management Servers once they become available.\r\n8. Connect with SmartConsole to the Security Management Server or Main Domain Management Server that manages the VSX Cluster.\r\n9. From the left navigation panel, click Gateways \\& Servers.\r\n10. Double-click the VSX Cluster object.\r\n11. From the left tree, click Cluster Members.\r\n12. Make sure you see an object representing the new VSX Cluster Member.\r\n13. If necessary, modify the VSX Cluster object configuration and click OK.\r\n14. Close all SmartConsole windows.\r\n15. Connect to the command line on the Management Server.\r\n16. Log in the Expert mode.\r\n17. Run this command and follow the on-screen instruction:\r\n\r\n# vsx_util add_member_reconf \r\n\r\n18. Wait until the Reconfigure module operation completed successfully summary notice appears.\r\n\r\nNote - In a Multi-Domain Server environment, this operation skips all Domain Management Servers locked by an administrator. If this should occur, run the command again for the affected Domain Management Servers once they become available.\r\n19. Reboot the new VSX Cluster Member.\r\n20. Connect to the command line on each VSX Cluster Member.\r\n21. Examine the VSX Cluster configuration:\r\n\r\n## cphaprob state\r\n\r\n22. If the VSX Cluster runs in the VSLS mode:\r\na. Connect to the command line on the Management Server.\r\nb. Log in the Expert mode.\r\nc. Redistribute Virtual Systems to the newly added VSX Cluster Member:\r\n\r\n```\r\nvSx_util vsls\r\n```\r\n\r\nd. Connect to the command line on each VSX Cluster Member.\r\ne. Examine the VSX Cluster configuration:\r\n\r\n## cphaprob state\r\n\r\n# Deleting a VSX Cluster Member \r\n\r\nImportant - Make sure that no other administrators are connected to the Management Server before you perform this procedure. The vsx_util command cannot modify the management database if the database is locked.\r\n\r\n1. Close all SmartConsole windows.\r\n2. Create a full backup of the environment (see sk100395).\r\n3. Detach the license from the VSX Cluster Member to be removed.\r\n\r\nOtherwise, you cannot remove a VSX Cluster Member.\r\n4. Close all SmartConsole windows.\r\n5. Connect to the command line on the Management Server.\r\n6. Log in the Expert mode.\r\n7. Run this command and follow the on-screen instructions:\r\n\r\n```\r\nvsx_util remove_member\r\n```\r\n\r\na. Enter the IP address of the Security Management Server or Main Domain Management Server.\r\nb. Enter the Management Server administrator user name and password.\r\nc. Type ' $y$ ' to confirm that you have detached the license from the VSX Cluster Member.\r\nd. Select the VSX Cluster.\r\ne. Select the VSX Cluster Member.\r\nf. Type ' $y$ ' to confirm that the VSX Cluster Member to be removed is disconnected.\r\n8. Wait until the remove member operation finished successfully message appears.\r\n\r\nNote - In a Multi-Domain Server environment, this operation skips all Domain Management Servers locked by an administrator. If this should occur, run the command again for the affected Domain Management Servers once they become available.\r\n\r\nThe management database is now updated and saved.\r\n9. Connect with SmartConsole to the Security Management Server or Main Domain Management Server that manages the VSX Cluster.\r\n10. From the left navigation panel, click Gateways \\& Servers.\r\n11. Double-click the VSX Cluster object.\r\n12. From the left tree, click Cluster Members.\r\n13. Make sure you do not see an object representing the removed VSX Cluster Member.\r\n\r\n# Changing the VSX Cluster Type \r\n\r\nImportant:\r\n\r\n- The only mode available for a VSX Cluster that was installed with R81.10 and higher is Virtual System Load Sharing (VSLS).\r\n- The High Availability mode is available only if you upgrade a VSX Cluster from R81 or lower to R81.20.\r\n\r\n\r\n## Converting from High Availability to VSLS\r\n\r\nNote - You cannot convert a VSX Cluster to the VSLS mode, if it contains Virtual Systems in the Active/Active Bridge Mode, or contains Virtual Routers.\r\n\r\n1. Close all SmartConsole windows.\r\n2. On each VSX Cluster Member:\r\na. Connect to the command line.\r\nb. Log in to the Expert mode.\r\nc. Run:\r\ncpconfig\r\nd. Enable the Per Virtual System State.\r\ne. Enable ClusterXL for Bridge Active/Standby.\r\na. Restart the Check Point services:\r\ncpstop ; cpstart\r\n3. On the Management Server:\r\na. Connect to the command line.\r\nb. Log in to the Expert mode.\r\nc. Run:\r\nvsx_util convert_cluster\r\nd. Enter the IP address of the Security Management Server or Domain Management Server that manages this VSX Cluster.\r\ne. Enter the Management Server administrator user name and password.\r\nf. Select the VSX Cluster.\r\ng. Enter:\r\n\r\nLS\r\nh. At the Proceed with conversion? prompt, enter: y\r\n\r\ni. Select an option to distribute Virtual Systems among VSX Cluster Members:\r\n\r\n- Distribute all Virtual Systems equally.\r\n- Set all Virtual Systems as Active on the same VSX Cluster Member.\r\n\r\n4. Reboot each VSX Cluster Member.\r\n5. On each VSX Cluster Member:\r\na. Connect to the command line.\r\nb. Log in to the Expert mode.\r\nc. Examine the VSX configuration:\r\nvsx stat -v\r\nd. Examine the VSX Cluster state and configuration:\r\ncphaprob state\r\n\r\n# Configuring Virtual System Load Sharing \r\n\r\nIn This Section:\r\n\r\n| Introduction ................................................................................................................................................. |\r\n| :--: | :--: |\r\n| Requirements ................................................................................................................................. |\r\n| Virtual System Priority ................................................................................................................................. |\r\n| Virtual System Weight ................................................................................................................................. |\r\n| Virtual System States ................................................................................................................................. |\r\n| Normalized VSLS Deployment Scenario ................................................................................................................. |\r\n| VSX Cluster Member Failure Scenario ................................................................................................................. |\r\n| Virtual System Failure Scenario ................................................................................................................................. |\r\n| Failure Recovery ................................................................................................................................................. |\r\n| Configuring a VSX Cluster in VSLS Mode ................................................................................................................. |\r\n| Viewing VSLS Status ................................................................................................................................. |\r\n| Distributing Virtual Systems Between VSX Cluster Members ................................................................................................. |\r\n| Exporting and Importing VSLS Configuration ................................................................................................................. |\r\n| Virtual Routers in VSLS Mode ................................................................................................................................. |\r\n\r\n## Introduction\r\n\r\nVSX Clusters can efficiently balance network traffic load by distributing active Virtual Systems between VSX Cluster Members.\r\n\r\nThis capability is known as Virtual System Load Sharing (VSLS).\r\nVirtual System Load Sharing is a cluster technology that assigns traffic for Virtual Systems to different Active VSX Cluster Members, which has these benefits:\r\n\r\n- Capacity: VSLS leverages the cluster machines to handle greater network volume by efficiently dividing the load.\r\n- Redundancy: VSLS gives full redundancy by maintaining connectivity for all Virtual Systems even when individual VSX Cluster Members fail.\r\n- Scalability: VSLS provides linear scalability for throughput and session rate.\r\n- Cost Effectiveness: A VSLS cluster uses standard network switches to get cost effective Load Sharing.\r\n- Ease of Configuration: Virtual Systems are automatically distributed between all the VSX Cluster Members - no special configuration is required.\r\n- Priority Designation: Mission-critical Virtual Systems can be separated from the other Virtual Systems to utilize better bandwidth and resources.\r\n\r\n- System Scalability: Every VSX Cluster Member added to the cluster increases the overall system capacity and redundancy.\r\n\r\nNote - These Virtual Devices are not supported when the Per Virtual System state is enabled:\r\n\r\n- Virtual Routers\r\n- Virtual Switches without physical or VLAN interfaces\r\n\r\nIn an example deployment scenario with three VSX Cluster Members, each with three Virtual Systems: an equalized Load Sharing deployment might have one Active Virtual System on each VSX Cluster Member.\r\n![[CP_R81.20_VSX_AdminGuide_img_31.jpeg]]\r\n\r\n| Item | Description | Item | Description |\r\n| :-- | :-- | :-- | :-- |\r\n| 1 | VSX Cluster Member 1 | 8 | Virtual System 2 is Backup |\r\n| 2 | VSX Cluster Member 2 | 9 | Virtual System 3 is Active |\r\n| 3 | VSX Cluster Member 3 | 10 | Virtual System 1 is Backup |\r\n| 4 | Virtual System 1 is Active | 11 | Virtual System 2 is Active |\r\n| 5 | Virtual System 2 is Standby | 12 | Virtual System 3 is Standby |\r\n| 6 | Virtual System 3 is Backup | - | Sync Network |\r\n| 7 | Virtual System 1 is Standby |  |  |\r\n\r\nA different member hosts the active peer for each Virtual System. This distribution spreads the load equally between the VSX Cluster Members.\r\n\r\nWhen you create a Virtual System, VSX automatically assigns Standby and Backup states to the applicable peers and distributes them between the other VSX Cluster Members.\r\n\r\nIn the event that a VSX Cluster Member fails, VSLS directs traffic destined to affected Virtual Systems to their fully synchronized Standby peers, which then become Active. At the same time, a Backup Virtual System switches to Standby, and synchronizes with the newly Active Virtual System.\r\n\r\nIn the event that an individual active Virtual System fails, it immediately fails over to its Standby peer and one of its Backup peers becomes the Standby, synchronizing with the newly Active peer.\r\n\r\nVSLS lets administrators manually assign Virtual Systems to specified VSX Cluster Members, or lets VSX automatically assign Virtual System traffic dynamically.\r\n\r\n# Requirements \r\n\r\nAll Virtual Systems in all VSX Cluster Members must have direct connectivity with each other.\r\nConnectivity must be accomplished using switches or VLAN connections.\r\nThis is required for detecting and assigning Virtual System states.\r\n\r\n## Virtual System Priority\r\n\r\nVirtual System priority refers to a preference regarding which VSX Cluster Member hosts a Virtual System's Active, Standby, and Backup states.\r\n\r\nThis preference is expressed as an integer value.\r\n\r\n| Priority | Definition |\r\n| :-- | :-- |\r\n| 0 | Highest priority, indicating the cluster designated to host the Virtual System Active state. |\r\n| 1 | Second highest priority, indicating the member designated to host the Virtual System <br> Standby state. |\r\n| $>1$ | Lower priorities, indicating the VSX Cluster Members designated to host a Virtual System <br> Backup state. <br> The VSX Cluster Member assigned priority 2 is the first to switch the Virtual System to the <br> Standby state in the event of a failure of either the Active or Standby Virtual System. <br> A VSX Cluster Member assigned priority 3 is the next in line to come online in the event of <br> another failure. |\r\n\r\nYou can change the priority designation with the \"vsx_uti1 vsls\" command on the Management Server.\r\n\r\n# Virtual System Weight \r\n\r\nBecause not all Virtual Systems are equal in terms of traffic and load, VSLS allows you to assign \"weights\" to individual Virtual Systems.\r\n\r\nThe weight of a Virtual System affects the dispersal pattern of other Virtual Systems across VSX Cluster Members.\r\n\r\nWhen you assign a heavier weight to a Virtual System gives it a larger share of resources on a specific VSX Cluster Member, and disperses the other Virtual Systems to other VSX Cluster Members.\r\n\r\nBy default, all Virtual Systems are assigned an equal weight factor of 10.\r\nYou can change the weight factor with the \"vsx_uti1 vsls\" command on the Management Server.\r\n\r\n## Virtual System States\r\n\r\nVSLS adds a Backup state to the existing Active and Standby states.\r\nThe Backup state contains the latest configuration settings for each Virtual System, but does not receive state table synchronization.\r\n\r\nThe figure below illustrates the relationship between Virtual System states.\r\n![[CP_R81.20_VSX_AdminGuide_img_32.jpeg]]\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 1 | VSX Cluster with 3 Cluster Members, each running 3 Virtual Systems (2, 3, and 4) |\r\n| 2 | Virtual System 1 on VSX Cluster Member 1 is Active |\r\n| 3 | Virtual System 1 on VSX Cluster Member 2 is Standby |\r\n| 4 | Virtual System 1 on VSX Cluster Member 3 is Backup |\r\n| 5 | Policy updates only |\r\n| 6 | State tables are synchronized |\r\n\r\nEach Virtual System peer in a VSLS cluster is replicated on all VSX Cluster Members, and each copy exists in a different state.\r\n\r\nThe Active and Standby states are synchronized, so that the Standby peer can immediately become Active in the event of a failure of the Active Virtual System or VSX Cluster Member.\r\n\r\nWhen this happens, the Backup peer becomes the Standby, and immediately synchronizes with the new Active Virtual System.\r\n\r\nVSLS reduces the load on the synchronization network by not synchronizing the Backup Virtual System state tables with the Active Virtual System until a failover occurs.\r\n\r\n# Normalized VSLS Deployment Scenario \r\n\r\nFor example, you can have three VSX Cluster Members, each with three Virtual Systems.\r\nIn this configuration, an equalized Load Sharing deployment could have one Active Virtual System on each VSX Cluster Member.\r\n![[CP_R81.20_VSX_AdminGuide_img_33.jpeg]]\r\n\r\n| Item | Description | Item | Description |\r\n| :-- | :-- | :-- | :-- |\r\n| 1 | VSX Cluster Member 1 | 8 | Virtual System 2 is Backup |\r\n| 2 | VSX Cluster Member 2 | 9 | Virtual System 3 is Active |\r\n| 3 | VSX Cluster Member 3 | 10 | Virtual System 1 is Backup |\r\n| 4 | Virtual System 1 is Active | 11 | Virtual System 2 is Active |\r\n\r\n| Item | Description | Item | Description |\r\n| :-- | :-- | :-- | :-- |\r\n| 5 | Virtual System 2 is Standby | 12 | Virtual System 3 is Standby |\r\n| 6 | Virtual System 3 is Backup |  | Sync Network |\r\n| 7 | Virtual System 1 is Standby |  |  |\r\n\r\nA different VSX Cluster Member can host the Active state of each Virtual System.\r\nThis distribution of Virtual Systems spreads the load between the VSX Cluster Members.\r\nWhen a Virtual System is created, the system automatically creates Standby and Backup states and distributes them between the other VSX Cluster Members.\r\n\r\n# VSX Cluster Member Failure Scenario \r\n\r\nIn the event that a member fails or experiences a connectivity problem, VSLS detects the problem and routes traffic for the affected Virtual Systems to their corresponding Standby Virtual Systems.\r\n\r\nStandby Virtual Systems, which are fully synchronized with their active peers, change immediately to the Active state and preserve active connections.\r\n\r\nAt the same time, the backup Virtual Systems switch to Standby, and synchronize fully with the newly active Virtual Systems.\r\n![[CP_R81.20_VSX_AdminGuide_img_34.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | VSX Cluster Member 1 |  | 8 | Virtual System 2 is Standby |\r\n| 2 | VSX Cluster Member 2 |  | 9 | Virtual System 3 is Active |\r\n| 3 | VSX Cluster Member 3 |  | 10 | Virtual System 1 is Standby |\r\n| 4 | Virtual System 1 is Down |  | 11 | Virtual System 2 is Active |\r\n| 5 | Virtual System 2 is Down |  | 12 | Virtual System 3 is Standby |\r\n| 6 | Virtual System 3 is Down |  |  | Sync Network |\r\n| 7 | Virtual System 1 is Active |  |  | Network Traffic |\r\n\r\nIn this scenario, VSX Cluster Member 1 fails and its Active and Standby Virtual Systems fail over to VSX Cluster Member 2 and VSX Cluster Member 3.\r\n\r\nThe Active Virtual System (VS1) moves to VSX Cluster Member 2 and directs all VS1 traffic itself.\r\nIts Backup peer on VSX Cluster Member 3 synchronizes with the new Active Virtual System and becomes the Standby.\r\n\r\nVS2 on VSX Cluster Member 2 becomes the Standby and synchronizes with the Active peer on VSX Cluster Member 3.\r\n\r\nFor VS3, the Active and Standby peers remain the same.\r\n\r\n# Virtual System Failure Scenario \r\n\r\nIn a failure scenario where an active Virtual System fails on one member, but the Standby and Backup Virtual Systems remain up: the Active Virtual System fails over to its Standby peer, and its Backup becomes the Standby.\r\n\r\nThe new Standby synchronizes with the new Active member.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_35.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Member 1 |  | 8 | VS 2 Backup |\r\n| 2 | Member 2 |  | 9 | VS 3 Active |\r\n| 3 | Member 3 |  | 10 | VS 1 Standby |\r\n| 4 | VS 1 Down |  | 11 | VS 2 Active |\r\n| 5 | VS 2 Standby |  | 12 | VS 3 Standby |\r\n| 6 | VS 3 Backup |  | - | Sync Network |\r\n| 7 | VS 1 Active |  |  |  |\r\n\r\nAll other Virtual Systems continue to function as usual, and no failover occurs.\r\n\r\n# Failure Recovery \r\n\r\nWhen the failed VSX Cluster Member or Virtual System comes back online, the system returns to its original Load Sharing configuration.\r\n\r\n# Configuring a VSX Cluster in VSLS Mode \r\n\r\n## 1. Install the VSX Cluster Members\r\n\r\nSee the R81.20 Installation and Upgrade Guide - Chapter Installing a ClusterXL, VSX Cluster, VRRP Cluster - Section Installing a VSX Cluster.\r\n2. Enable the Per Virtual System State mode on each VSX Cluster Member\r\n\r\nThe Per Virtual System State mode enables active Virtual Systems to be placed on different VSX Cluster Members, and for Virtual System-specific failover. This setting is mandatory for VSLS.\r\n\r\nOn each VSX Cluster Member:\r\na. Connect to the command line.\r\nb. Log in to the Expert mode.\r\nc. Run:\r\ncpconfig\r\nd. Select:\r\n\r\nEnable Check Point Per Virtual System State\r\ne. When the question appears:\r\n\r\nWould you like to enable Per Virtual System state?\r\nEnter $y$ to confirm.\r\nf. Reboot the VSX Cluster Member.\r\n3. In SmartConsole, create a new VSLS VSX Cluster object\r\na. Connect with SmartConsole to the Security Management Server or Main Domain Management Server that manages the VSX Cluster.\r\nb. From the navigation panel, click Gateways \\& Servers.\r\nc. At the top, click Objects menu > More object types > Network Object > Gateways and Servers > VSX > New Cluster.\r\n\r\nThe VSX Cluster Wizard > General Properties opens.\r\nd. Create and configure the new VSX Cluster.\r\n\r\nSee \"Working with VSX Clusters\" on page 125.\r\ni. On the General Properties page, from VSX Cluster Platform, select ClusterXLVirtual System Load Sharing.\r\nii. Complete the VSX Cluster Wizard.\r\n4. In SmartConsole, create the objects of applicable Virtual Routers and Virtual Systems\r\n\r\nSee:\r\n\r\n- \"Working with Virtual Routers\" on page 88\r\n- \"Working with Virtual Systems\" on page 70\r\n\r\n\r\n# 5. Use the 'vsx_util vsls' command on the Management Server \r\n\r\nUse the \"vsx_util vsls\" command (see \"vsx_util vsls\" on page 264) on the Management Server to do different Virtual System Load Sharing configuration tasks:\r\n\r\n- Show the current VSLS configuration\r\n- Distribute Virtual Systems equally between VSX Cluster Members\r\n- Set all Virtual Systems as Active on one VSX Cluster Member\r\n- Manually define the priority and weight for individual Virtual Systems\r\n- Toggle VSLS mode between Active Up and Primary Up\r\n- Import VSLS configuration from CSV text files\r\n- Export VSLS configuration to CSV text files\r\n\r\n\r\n## Procedure:\r\n\r\na. Connect to the command line on the Management Server.\r\nb. Log in to the Expert mode.\r\nc. Run:\r\nvSx_uti1 vsls\r\nd. Enter the IP address of the Security Management Server or Domain Management Server.\r\ne. Enter the Management Server administrator user name and password.\r\n\r\n# f. Select the applicable option from the VSLS menu. \r\n\r\n## Example\r\n\r\n```\r\n[Expert@MGMT:0]# vxx_util vsls\r\nEnter Security Management Server/main Domain Management Server IP address (Hit 'ENTER' for\r\n'localhost'): 172.16.16.240\r\nEnter Administrator Name: admin\r\nEnter Administrator Password: ****\r\nSelect VSS gateway/cluster object name:\r\n    VSS_Cluster_1\r\n    VSS_Cluster_2\r\n    VSS_GW_1\r\n    VSS_GW_2\r\nSelect: 1\r\n```\r\n\r\nVS Load Sharing - Menu\r\n\r\n1. Display current VS Load sharing configuration\r\n2. Distribute all Virtual Systems so that each cluster member is equally loaded\r\n3. Set all VGes active on one member\r\n4. Manually set priority and weight\r\n5. Toggle VSLS mode between Active Up and Primary Up\r\n6. Import configuration from a file\r\n7. Export configuration to a file\r\n8. Exit\r\n\r\nEnter redistribution option (1-8) [1]:\r\n\r\n# Viewing VSLS Status \r\n\r\nTo view the current VSLS status and Virtual System distribution between VSX Cluster Members, select Display current VS Load Sharing configuration from the VSLS menu.\r\n\r\n## Example\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_36.jpeg]]\r\n\r\n## Virtual System Priority\r\n\r\nVirtual System priority refers to a preference regarding which VSX Cluster Member hosts a Virtual System's Active, Standby, and Backup states.\r\n\r\nThis preference is expressed as an integer value.\r\n\r\n| Priority | Definition |\r\n| :-- | :-- |\r\n| 0 | Highest priority, indicating the VSX Cluster Member designated to host the Virtual <br> SystemActive state. |\r\n| 1 | Second highest priority, indicating the VSX Cluster Member designated to host the <br> Virtual SystemStandby state. |\r\n| $>1$ | Lower priorities, indicating VSX Cluster Members designated to host a Virtual System's <br> Backup state. <br> The VSX Cluster Member assigned priority 2 will be the first to switch the Virtual System <br> to the Standby state in the event of a failure of either the Active or Standby Virtual <br> System. <br> A VSX Cluster Member assigned priority 3 would be the next in line to come online in the <br> event of another failure. |\r\n\r\n## Virtual System Weight\r\n\r\nEach Virtual System is assigned a weight factor, which determine its traffic volume relative to the total traffic volume (the sum of all weight factors) on a given VSX Cluster Member.\r\n\r\nVSX uses the weight factor to determine the most efficient distribution of Virtual Systems between VSX Cluster Members.\r\n\r\nSystem resource allocation is not affected by the weight factor, and VSX does not take weight into consideration for any other purpose.\r\n\r\nBy default, all Virtual Systems are assigned an equal weight factor of 10.\r\n\r\n# Distributing Virtual Systems Between VSX Cluster Members \r\n\r\nThe primary advantage of VSLS is that it distributes Active, Standby and Backup Virtual Systems between VSX Cluster Members to maximize throughput and user response time.\r\n\r\nYou can distribute Virtual Systems in one of these ways:\r\n\r\n## Automatically distribute Active Virtual Systems between VSX Cluster Members\r\n\r\nThis lets you automatically distribute Active Virtual Systems between VSX Cluster Members, so that all VSX Cluster Members are equally loaded, based on assigned weights and existing or default priority definitions.\r\n\r\n1. From the VSLS menu (see \"vsx_util vsls\" on page 264), select Distribute all Virtual Systems so that each cluster member is equally loaded.\r\n2. At the \"Save \\& apply configuration?\" prompt, enter y to continue.\r\n\r\nThe process update process may take several minutes or longer to complete, depending on the quantity of Virtual Systems and VSX Cluster Members.\r\n\r\n## Automatically assign all Active Virtual Systems to the Same VSX Cluster Member\r\n\r\n1. From the VSLS menu (see \"vsx_util vsls\" on page 264), select Set all VSs active on one member.\r\n2. When prompted, enter the number corresponding to the VSX Cluster Member designated as the Primary member.\r\n3. When prompted, enter the number corresponding to the VSX Cluster Member designated as the Standby member.\r\n\r\nAll other VSX Cluster Members are designated as Backup members.\r\n4. At the \"Save \\& apply configuration?\" prompt, enter y to continue.\r\n\r\nThe process update process may take several minutes or longer to complete, depending on the quantity of Virtual Systems and VSX Cluster Members.\r\n\r\n## Manually configure priorities and weights for each Virtual System\r\n\r\nNote - After you save changes, the update requires time (several minutes or longer), depending on the quantity of Virtual Systems and VSX Cluster Members.\r\n\r\n## To assign weights automatically to all Virtual Systems\r\n\r\n1. From the VSLS menu (see \"vsx_util vsls\" on page 264), select Manually set priority and weight.\r\n2. Scroll through each Virtual System. Enter $\\mathbf{a}$.\r\n3. For each Virtual System, enter a weight value and press Enter.\r\n\r\nIf you do not enter a weight value for a Virtual System, the assigned weight is not changed.\r\nOnly Virtual Systems with a new weight value are updated.\r\nTo stop entering weight values, enter $\\mathbf{s}$.\r\n4. At the \"Save \\& apply configuration\" prompt, enter $\\mathbf{y}$ to continue.\r\n\r\n# To assign priorities and weights manually to individual Virtual Systems \r\n\r\n1. From the VSLS menu (see \"vsx_util vsls\" on page 264), select Manually set priority and weight.\r\n2. Enter $\\mathbf{m}$.\r\n3. At the \"Would you like to change the Virtual System's priority list?\" prompt, enter $\\mathbf{y}$ to continue.\r\n4. Enter the number of the VSX Cluster Member to get the highest priority.\r\n5. Enter the number of the VSX Cluster Member to get the next highest priority.\r\n6. Continue until all VSX Cluster Members have a priority.\r\n7. At the \"Would you like to change the Virtual System's weight?\" prompt, enter y to continue.\r\n8. Enter the new weight value. A valid value is an integer between 1 and 100.\r\n9. At the \"Do you wish to configure another Virtual System?\" prompt, enter $\\mathbf{y}$ to configure a different Virtual System, or enter $\\mathbf{n}$ to continue.\r\n10. At the \"Save \\& apply configuration?\" prompt, enter $\\mathbf{y}$ to continue.\r\n\r\n# Exporting and Importing VSLS Configuration \r\n\r\nWhen working with large scale VSLS deployments consisting of many Virtual Systems, multiple VSX Cluster Members, using the vsx_util command on the Management Server to do configuration tasks can be quite time consuming.\r\n\r\nTo let administrators to efficiently configure such deployments, VSX supports uploading VSLS configuration files containing configuration information for all Virtual Systems directly to Management Servers and VSX Cluster Members.\r\n\r\nThis capability offers the following advantages:\r\n\r\n- Fast VSLS configuration of large-scale deployments with many Virtual Systems and VSX Cluster Members.\r\n- Efficient migration and scalability for complex deployments.\r\n- External backup of VSLS configurations.\r\n\r\nVSLS configuration files are CSV files that are editable using a text editor or other applications, such as Microsoft Excel. You can use the configuration file to change quickly the weight and VSX Cluster Member priority for each Virtual Systems in the list.\r\n\r\nNote - You cannot use the VSLS configuration file to add or remove VSX Cluster Members. You must use the applicable vsx útil commands to do this.\r\nYou can use the VSLS configuration file to change member priorities for Virtual Systems after adding or removing a VSX Cluster Member.\r\n\r\n## VSLS Configuration File\r\n\r\nThe VSLS configuration file is a comma separated value (CSV) text file that contains configuration settings for all Virtual Systems controlled by a Management Server.\r\n\r\nAll lines preceded by the \\# symbol are comments and are not imported into the management database.\r\n\r\n## Example\r\n\r\n```\r\n# Check PointVSX - VS Load Sharing configuration file\r\n#\r\n# Administrator : aa\r\n# SmartCenter/Main Domain Management Server : 192.168.50.160\r\n# Generated on : Thu Jul 23 13:08:42 2009\r\n#\r\n#\r\n# VSID, Weight, Active member, Standby member, Backup member #1\r\n# Virtual System name: vs1\r\n2,10,gw150,gw151,gw152\r\n# Virtual System name: vs2\r\n3,10,gw151,gw152,gw150\r\n# Virtual System name: vs3\r\n4,10,gw152,gw150,gw151\r\n# Virtual System name: vs4\r\n6,10,gw151,gw150,gw152\r\n# Virtual System name: vs5\r\n5,10,gw150,gw152,gw151\r\n```\r\n\r\nThe configuration file contains one line for each Virtual System, consisting of the following data as shown below:\r\n\r\nEach line contains the VSID, the weight assigned the Virtual System, one primary VSX Cluster Member, and one Standby VSX Cluster Member.\r\n\r\nBackup VSX Cluster Members are listed after the Standby VSX Cluster Member.\r\n\r\n# Exporting a VSLS configuration \r\n\r\nThe most common way to use VSLS configuration files is to initially define your cluster environment and Virtual Systems using SmartConsole.\r\n\r\n1. From the VSLS menu (see \"vsx_util vsls\" on page 264), select Export configuration to a file.\r\n2. Enter the absolute path to the file.\r\n\r\nFor example:\r\n/home/admin/MyConfiguration\r\n\r\n## Processing Options\r\n\r\nYou can insert the following commands in the VSLS Configuration file to show audit trail information while validating and processing data.\r\n\r\nEach of the commands is like a toggle, whereby the first occurrence of a command enables the action and the next occurrence disables it.\r\n\r\nThese options let you debug efficiently very long configuration files by displaying or logging only suspicious sections of the data.\r\n\r\n| Command | Action |\r\n| :-- | :-- |\r\n| !comments | Sequentially displays comment lines (those preceded with the '\\#' character) <br> contained in the configuration file. <br> You can insert comments into the configuration file to indicate which Virtual Systems <br> are currently processed, or to provide status information as the parser processes the <br> data. |\r\n| !verbose | Shows whether or not each data line has been successfully verified and the <br> configuration parameters for each Virtual System. |\r\n| !log | Saves ! comments and ! verbose information in the vsx_util.log file. |\r\n\r\n## Importing a VSLS configuration\r\n\r\n1. From the VSLS menu (see \"vsx_util vsls\" on page 264), select Import configuration from a file.\r\n2. Enter the absolute path to the file.\r\n\r\nFor example:\r\n/home/admin/MyConfiguration\r\n3. At the \"Save \\& apply configuration?\" prompt, enter $\\mathbf{y}$ to continue.\r\n\r\nDuring the import process, the parser reads the configuration file and attempts to validate the contents.\r\nErrors are displayed on the screen together with the offending line number.\r\nIf either the Icomments or Iverbose processing options are enabled, the applicable information appears on the screen.\r\n\r\nThe process update process may take several minutes or longer to complete, depending on the quantity of Virtual Systems, Domain Management Servers, and VSX Cluster Members.\r\n\r\n# Virtual Routers in VSLS Mode \r\n\r\nFrom R81, you can configure Virtual Routers in VSLS mode.\r\n\r\n## Description of Virtual Router Groups\r\n\r\nTo ensure traffic flow during a VSX Cluster failover, a Virtual Router and all Virtual Systems that connect to it belong to the same Virtual Router Group.\r\n\r\nThe Virtual Router in a Virtual Router Group manages all Virtual Systems in that Virtual Router Group. It makes sure all Virtual Systems are Active on the same VSX Cluster Member as the Virtual Router.\r\n\r\nIf at least one Virtual System or the Virtual Router in the affected Virtual Router Group fail, all Virtual Systems and the Virtual Router in the same Virtual Router Group fail over from the affected VSX Cluster Member to another VSX Cluster Member.\r\n\r\n## Important:\r\n\r\n- A Management Server creates the corresponding Virtual Router Group automatically when you create a Virtual Router object.\r\n- You can connect a Virtual System to only one Virtual Router.\r\n- The cluster state of all members of the same Virtual Router Group is Active on the same VSX Cluster Member.\r\n- Changes in the cluster state of Virtual Systems in a Virtual Router Group take effect only after you install the Access Control Policy on the applicable Virtual Systems.\r\n- Connecting an existing Virtual System to an existing Virtual Router: If the cluster state of an existing Virtual System is Active on one VSX Cluster Member, and the cluster state of an existing Virtual Router is Active on another VSX Cluster Member, then after you connect the Virtual System to this Virtual Router and install the Access Control Policy on the Virtual System, it becomes Active on the same VSX Cluster Member as the Virtual Router.\r\n\r\n\r\n## Viewing the existing Virtual Router Groups on a Management Server\r\n\r\n## Procedure\r\n\r\n1. Connect to the command line on the Management Server that manages the VSX Cluster object.\r\n2. Log in to the Expert mode.\r\n3. Go to the configuration menu for Virtual System Load Sharing:\r\n```\r\nvsx_util vsls\r\n```\r\n\r\n4. From the VSLS menu, select Display current VS Load sharing configuration.\r\n\r\nIn the column \"VS name\":\r\n\r\n- After the name of the Virtual Router, in the brackets you see the number of the Virtual Router Group and the letter $\\mathbf{M}$ (denotes the manager of this Virtual Router Group).\r\n- After the name of the Virtual System, in the brackets you see the number of the Virtual Router Group, to which this Virtual System belongs.\r\n\r\n# Every Virtual Router Group gets a cardinal number: \r\n\r\na. For the first Virtual Router you create, the Management Server creates a Virtual Router Group \\#1.\r\nb. For the second Virtual Router you create, the Management Server creates a Virtual Router Group \\#2.\r\nc. And so on.\r\n\r\n## Example\r\n\r\n## SSS\r\n\r\n```\r\n[Expert@MGMT:0]# vax_util vxls\r\nEnter Security Management Server/main Domain Management Server IP address (Hit 'ENTER' for\r\n'localhost'): 172.16.16.240\r\nEnter Administrator Name: admin\r\nEnter Administrator Password:\r\nSelect VSS gateway/cluster object name:\r\n    1) VSS_Cluster_1\r\n    2) VSS_Cluster_2\r\n    3) VSS_ON_1\r\n    4) VSS_ON_2\r\nSelect: 1\r\n```\r\n\r\nVS Load Sharing - Menu\r\n\r\n```\r\n1. Display current VS Load sharing configuration\r\n2. Distribute all Virtual Systems so that each cluster member is equally loaded\r\n3. Set all VSes active on one member\r\n4. Manually set priority and weight\r\n5. Toggle VSLS mode between Active Up and Primary Up\r\n6. Import configuration from a file\r\n7. Export configuration to a file\r\n8. Exit\r\nEnter redistribution option (1-8) [1]: 1\r\nVSLS is in Primary Up mode.\r\nVSID| VS name | Member_1 | Member_2 | Weight |\r\n1 | VS (1M) | 0 | 1 | 10 |\r\n2 | vs1 (1) | 0 | 1 | 0 |\r\n3 | vs2 | 1 | 0 | 10 |\r\n4 | vs3 | 0 | 1 | 10 |\r\n5 | vs4 | 0 | 1 | 10 |\r\nTotal weight | 20 | 20 | 40 |\r\nLegend:\r\n0 - Highest priority\r\n1 - Lowest priority\r\nNote: Virtual devices that are on the same group are marked with the same number '(group \\#)'.\r\nVirtual device that is marked with (<group \\#> L) is defined as manager of <group \\#>.\r\nOnly a group manager has weight greater than 0 , which is the sum of weights of all group members.\r\nVirtual devices, that are not part of any group, show their own weight.\r\n2. Exit from the menu.\r\n\r\n# Viewing the existing Virtual Router Groups on VSX Cluster Members \r\n\r\n## Procedure\r\n\r\n1. Connect to the command line on the VSX Cluster Member.\r\n2. Log in to the Expert mode.\r\n3. Run:\r\ncphaprob show_vsls_groups\r\n\r\n## Notes:\r\n\r\n- You can run this command in any VSX context.\r\n- If you run this command in the context of a Virtual Router, you can see the names and VSID of Virtual Systems that belong to the corresponding Virtual Router Group.\r\nExample - Context of the Virtual Router \"VR\":\r\n\r\n```\r\n[Expert@VSX_Member_1:1]\\# cphaprob show_vsls_groups\r\nVR vsid 1 is a VSLS group manager.\r\nGroup members are:\r\nvs1 vsid 2\r\nvs2 vsid 3\r\n```\r\n\r\n- If you run this command in the context of a Virtual System that is connected to a Virtual Router, you can see the VSID of the Virtual Router that manages the corresponding Virtual Router Group.\r\nExample - Context of the Virtual System \"VS1\":\r\n\r\n```\r\n[Expert@VSX_Member_1:2]\\# cphaprob show_vsls_groups\r\nvs1 vsid 2 is a VSLS group member.\r\nVSLS Group manager is VR vsid 1\r\n```\r\n\r\n\r\n## VSLS Weights in Virtual Router Groups\r\n\r\nWhen Virtual Systems are connected to a Virtual Router, the weight of the Virtual Router in the corresponding Virtual Router Group is the total sum of all weights of all Virtual Systems.\r\n\r\nFor Virtual Systems that belong to Virtual Router Groups, outputs of different commands show their weight of as 0 (zero).\r\n\r\nFor Virtual Systems that do not belong to Virtual Router Groups, outputs of different commands show their real weight (by default, all Virtual Systems are assigned an equal weight factor of 10.).\r\n\r\nFor example, if a Virtual System \"vs1\" with the wight 20 and a Virtual System \"vs2\" with the wight 30 are connected to a Virtual Router \"vr\", then outputs of different commands show the weight of the Virtual Router as 50 .\r\n\r\nNote - The total sum of all weights of all Virtual Systems in the same Virtual Router Group cannot be more greater than 100.\r\n\r\n# Distributing Virtual Systems that belong to a Virtual Router Group between VSX Cluster Members \r\n\r\nIf it is necessary to distribute manually Virtual Systems between VSX Cluster Members, and these Virtual Systems are connected to a Virtual Router, you must distribute the corresponding Virtual Router between VSX Cluster Members (assign the priority and weight only to this Virtual Router). The Management Server automatically distributes all Virtual Systems in the corresponding Virtual Router Group.\r\n\r\nFor more information, see \"Distributing Virtual Systems Between VSX Cluster Members\" on page 152.\r\n\r\n# VSX Cluster in the High Availability Mode \r\n\r\nImportant:\r\n\r\n- The only mode available for a VSX Cluster that was installed as R81.10 and higher is Virtual System Load Sharing (VSLS).\r\n- The High Availability mode is available only if you upgrade a VSX Cluster from R81 or lower to R81.20.\r\n\r\n\r\n## Virtual Switches in a High Availability VSX Cluster\r\n\r\nIn a VSX Cluster, Virtual Switches are also clustered for redundancy and are defined as Active/Active.\r\nThe physical interface connected to the Virtual Switch is monitored by means of the Cluster Control Protocol (CCP).\r\n\r\nIn the event of a failover, all Virtual Systems on the Standby VSX Cluster Member become Active, and send Gratuitous ARP Requests from the warp interface between the Virtual System and the Virtual Switch.\r\n![[CP_R81.20_VSX_AdminGuide_img_37.jpeg]]\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 1 | Active VSX Cluster Member |\r\n| 2 | Standby VSX Cluster Member |\r\n| 3 | Virtual Switch Cluster |\r\n| 4 | Active Virtual Switch |\r\n| 5 | Virtual System 1 |\r\n| $\\bullet \\longrightarrow$ | Physical Link |\r\n\r\nIn the above figure, a simplified VSX Cluster contains two VSX Cluster Members in the High Availability mode, one Active, and the other Standby.\r\n\r\nThe Virtual Switches within each VSX Cluster are Active/Active.\r\nWhen the physical interface connected to either Virtual Switch fails to respond, a failover occurs.\r\n\r\n# Advanced Clustering Configuration \r\n\r\nThis section presents several advanced cluster scenarios and procedures for their configuration.\r\n\r\n## Monitoring all VLANs in VSX Cluster\r\n\r\nBy default, ClusterXL only monitors two VLANS for failure detection and failover.\r\nThese are the highest and lowest VLAN tags defined for a given interface.\r\nFor example, if the topology for interface eth1 includes several VLAN tags in the range of eth1.10 to eth1.50, ClusterXL only monitors VLANs eth1.10 and eth1.50 for failure. Failures on any of the other VLANs are not detected in the default configuration.\r\n\r\nNote - The command \"cphaprob -a if\" (or Gaia Clish command \"show cluster interfaces vlans\") shows the highest and lowest VLANs that are monitored.\r\n\r\nWhen both the highest and lowest VLANs fail, all the VLANs are considered down, and a failover occurs.\r\nThis means that if a VLAN, which is not listed as the highest or lowest goes down, the VLAN Trunk is still considered \"up\", and no failover occurs.\r\n\r\nThere are instances in which it would be advantageous to monitor all the VLANs in the trunk, not just the highest and lowest, and initiate a failover when any one of the VLANs goes down.\r\n\r\nTo enable monitoring of all VLANs, set the value of the kernel parameter \"fwha_monitor_all_vlan\" to 1 in the \\$FWDIR/boot/modules/fwkern.conf file. For more information, see sk92826 and \"Working with Kernel Parameters\" on page 328.\r\n\r\n## Configuring CoreXL in a VSLS VSX Cluster\r\n\r\nIn VSLS VSX Clusters of version R80.10 and higher, changing the CoreXL configuration or running the cphastop command in the context of VS0 results in failover of all the Active Virtual Systems on that VSX Cluster Member.\r\n\r\nThis behavior is by design. Active Virtual Systems on other VSX Cluster Members do not fail over.\r\n\r\n# Working with Link Aggregation \r\n\r\nIn This Section:\r\n\r\nLink Aggregation Overview ..... 164\r\nHow Link Aggregation Works ..... 165\r\nLink Aggregation High Availability ..... 165\r\nLink Aggregation Load Sharing ..... 166\r\nBond Interface Limitations ..... 167\r\n\r\n## Link Aggregation Overview\r\n\r\nLink aggregation, also known as interface bonding, joins multiple physical interfaces together into a virtual interface, known as a bond interface. A bond interface can be configured for High Availability redundancy or for load sharing, which increases connection throughput above that which is possible using one physical interface.\r\n\r\nFor more about Bond Interfaces (Link Aggregation), see the R81.20 Gaia Administration Guide and R81.20 ClusterXL Administration Guide.\r\n\r\n## Bonding (Link Aggregation) Terminology\r\n\r\n- Link Aggregation (Interface Bonding): Networking technology that binds multiple physical interfaces together into one virtual interface.\r\n- Bond: A group of physical interfaces that operate together as one virtual interface and share an IP address and MAC address. A bond is identified by the cluster by its Bond ID (for example: bond0).\r\n- Bond Interface: The logical representation of the bond.\r\n- Subordinate interface: A physical interface that is a member of a bond. Subordinate interfaces do not have an IP Address and in some cases share the same MAC address.\r\n\r\n# How Link Aggregation Works \r\n\r\nA bond contains a minimum of one and may contain up to eight subordinate interfaces. All subordinate interfaces contained in a bond share a common IP address and may share the same MAC address. We recommend that each cluster member contain the same quantity of identical subordinate interfaces.\r\n![[CP_R81.20_VSX_AdminGuide_img_38.jpeg]]\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 1 | Switch |\r\n| 2 | bond 0 |\r\n| 3 | Cluster |\r\n\r\nYou can configure Link Aggregation using one of the following strategies:\r\n\r\n- High Availability (Active/Backup): Ensures redundancy in the event of interface or link failure. This option also provides switch redundancy.\r\n- Load Sharing (Active/Active): All interfaces are active, but handle different connections simultaneously. Traffic is balanced amongst subordinate interfaces to maximize throughput. The Load Sharing option does not support switch redundancy.\r\n\r\n\r\n## Link Aggregation High Availability\r\n\r\nClusters, by definition, provide redundancy and high availability at the VSX Gateway level.\r\nLink Aggregation, however, adds interface and switch redundancy by providing automatic failover to a standby interface card within the same VSX Gateway.\r\n\r\nIn a High Availability deployment, only one interface is active at a time. If an interface or connection fails, the bond fails over to a standby subordinate interface.\r\n\r\nBonding High Availability failover occurs in one of these cases:\r\n\r\n- An active interface detects a link state failure in a monitored interface.\r\n- ClusterXL detects a failure in sending or receiving Cluster Control Protocol (CCP) keep-alive packets.\r\n\r\n# Fully Meshed Redundancy through Interface Bonding \r\n\r\nThe Link Aggregation High Availability mode, when deployed with ClusterXL, enables a higher level of reliability by providing granular redundancy in the network.\r\n\r\nThis granular redundancy is achieved by using a fully meshed topology, which provides for independent backups for both NICs and switches.\r\n![[CP_R81.20_VSX_AdminGuide_img_39.jpeg]]\r\n\r\n| Item | Description | Item | Description |\r\n| :-- | :-- | :-- | :-- |\r\n| 1 | Switch 1 | 5 | Network connection 2 |\r\n| 2 | Switch 2 | 6 | Network connection 3 |\r\n| 3 | Network connection 1 | 7 | VSX Cluster Member 1 |\r\n| 4 | Network connection 4 | 8 | VSX Cluster Member 2 |\r\n\r\nIn this scenario - VSX Cluster Members 1 and 2 are configured in the High Availability mode.\r\n\r\n## Link Aggregation Load Sharing\r\n\r\nLoad Sharing provides the ability to spread traffic over multiple subordinate interfaces, in addition to providing interface redundancy.\r\n\r\nAll interfaces are always active.\r\nTraffic is balanced between interfaces in a manner similar to the way load sharing balances traffic between VSX Cluster Members.\r\n\r\nLink Aggregation Load Sharing operates according to either the IEEE 802.3ad or the XOR standard.\r\nIn Load Sharing mode, each individual connection is assigned to a specific subordinate interface.\r\nFor a specific connection, only the designated subordinate interface is active.\r\nIf the designated subordinate interface fails, then the traffic fails over to another interface, which also continues to handle its existing traffic.\r\n\r\n# Bond Interface Limitations \r\n\r\n- You can define a maximum of 4096 interfaces on a Gaia server or appliance.\r\n\r\nThe total number of bond interfaces in use is the sum of bonds plus the number of subordinate interfaces contained in each bond.\r\n\r\n- Up to eight interfaces can be defined in a Link Aggregation deployment for each bond interface.\r\n\r\n# Configuring Bond High Availability Mode \r\n\r\nThis section explains how to configure High Availability on a bond interface.\r\nRun the CLI commands from the VSX Gateway (VS0) context.\r\nIn a VSX Cluster, run these commands on each VSX Cluster Member.\r\nUse the \"active-backup\" value for the \"mode\" parameter to configure High Availability.\r\n\r\n## Configuring the High Availability Bond\r\n\r\nThis is a workflow of CLI commands to configure Link Aggregation in High Availability mode.\r\n\r\n## Notes:\r\n\r\n- For exact commands, see R81.20 Gaia Administration Guide\r\n- When you are enslaving configured interfaces, make sure that these interfaces are not used in other configurations and that IP addresses are not assigned to them.\r\n\r\nTo configure the Link Aggregation in High Availability mode:\r\n\r\n1. Add the bonding group.\r\n2. Add subordinate interfaces to the bonding group.\r\n3. Make sure that the bond is configured correctly.\r\n4. Open SmartConsole and configure the cluster object.\r\n\r\n- For a new Link Aggregation installation, create a new cluster object.\r\n- For updating an existing configuration, update the interface topology.\r\n\r\n\r\n## Updating the Interface Topology\r\n\r\nWhen you are updating an existing configuration to Link Aggregation, it is necessary to reconfigure the applicable objects to connect to the newly created bond. This includes Virtual Systems, Virtual Routers and Virtual Switches. You can perform these actions in SmartConsole. In most cases, these definitions can be found in the object Properties window.\r\n\r\nFor large existing VSX deployments containing many Domain Management Servers and Virtual Devices, use the \"vsx_uti i change_interfaces\" command on the Management Server to reconfigure existing object topologies. For example, in a Multi-Domain Server deployment with 200 Domains, each with many Virtual Devices, it is faster to use the \"vsx_uti i change_interfaces\" command. This command automatically replaces the interface with the new bond on all applicable objects.\r\n\r\n# Reconfiguring the Bond \r\n\r\nTo configure the newly created bond for a cluster:\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Main Domain Management Server that manages the VSX Cluster.\r\n2. Delete the subordinate interfaces from the bond that you are not using.\r\na. From the navigation tree, click Topology.\r\nb. From the navigation tree, click Physical Interfaces.\r\nc. Select the subordinate interface, and click Remove.\r\nd. Click OK.\r\ne. Do these steps again for all the subordinate interfaces.\r\n3. From Gaia Clish on each VSX Cluster Member, create the new bond interface.\r\n4. Connect with SmartConsole to the Security Management Server or Main Domain Management Server that manages the VSX Cluster.\r\n5. From the Gateways \\& Servers view or Object Explorer, double-click the VSX Cluster object.\r\n6. From the left navigation tree, click Physical Interfaces.\r\n7. Click Add, and configure the bond interface.\r\n\r\nThe Physical Interface Properties window opens.\r\na. Enter the bond name.\r\nb. If the bond is a VLAN trunk, select VLAN Trunk.\r\nc. Click OK.\r\n8. From the left navigation tree, click Topology.\r\n9. Do these steps for each interface that you are adding to the bond:\r\na. Double-click the interface.\r\n\r\nThe Interface Properties window opens.\r\nb. From Interface, select the bond interface.\r\nc. Click OK.\r\n10. Install the VSX Policy (<Name of VSX Cluster Object>_VSX) on the VSX Cluster object.\r\n\r\n# Reconfiguring Topology with 'vsx_util change_interfaces' \r\n\r\nImportant - In a Multi-Domain Server environment, all Domain Management Servers must be unlocked in order for this operation to succeed. Meaning, you need to disconnect all SmartConsole clients from all Domain Management Servers.\r\n\r\nTo reconfigure objects with the \"vsx_util change_interfaces\" command:\r\n\r\n1. Close SmartConsole windows for the Security Management Server and all Domain Management Servers that use the designated interface.\r\n2. Connect to the command line on the Management Server.\r\n3. Log in to the Expert mode..\r\n4. Run the \"vsx_util change_interfaces\" command and follow the on-screen instructions:\r\na. Enter the IP address of the Security Management Server or Main Domain Management Server.\r\nb. Enter the management administrator name and password.\r\nc. Select VSX Cluster object.\r\nd. Select Apply changes to the management database and to the VSX Gateway/Cluster members immediately.\r\ne. When prompted, select the interface to be replaced.\r\nf. When prompted, select the replacement bond interface.\r\ng. If you wish to replace additional interfaces, enter \" $y$ \" when prompted and repeat the above steps.\r\nh. To complete the process, enter \" $n$ \".\r\n\r\n# Configuring Bond Load Sharing Mode \r\n\r\nThis section explains how to configure Load Sharing on a bond interface.\r\nRun the CLI commands from the VSX Gateway (VS0) context.\r\nIn a VSX Cluster configuration, run these commands on each VSX Cluster Member.\r\nConfigure one of these Load Sharing modes for the bond interface:\r\n\r\n- Round Robin - Selects the Active subordinate interfaces sequentially.\r\n- 802.3ad - Dynamically uses Active subordinate interfaces to share the traffic load. This mode uses the LACP protocol, which fully monitors the interface link between the Check Point Security Gateway and a switch.\r\n- XOR - All subordinate interfaces in the UP state are Active for Load Sharing. Traffic is assigned to Active subordinate interfaces based on the transmit hash policy: Layer 2 information (XOR of hardware MAC addresses), or Layer 3+4 information (IP addresses and Ports).\r\n\r\n\r\n## Configuring the Load Sharing Bond\r\n\r\nThis is a workflow of CLI commands to configure Link Aggregation in Load Sharing mode.\r\n\r\n## Notes:\r\n\r\n- For exact commands, see R81.20 Gaia Administration Guide\r\n- When you are enslaving configured interfaces, make sure that these interfaces are not used in other configurations and that IP addresses are not assigned to them.\r\n\r\nTo configure the Link Aggregation in Load Sharing mode:\r\n\r\n1. Add the bonding group.\r\n2. Add subordinate interfaces to the bonding group.\r\n3. Define the number of critical interfaces.\r\n4. For configurations that use Performance Pack, configure the core affinities.\r\n5. Make sure that the bond is configured correctly.\r\n6. Open SmartConsole and configure the VSX Cluster object.\r\n\r\n- For a new Link Aggregation installation, create a new cluster object.\r\n- For updating an existing configuration, update the interface topology.\r\n\r\n# Setting Critical Required Interfaces \r\n\r\nNote - The Critical Required Interfaces feature is supported for ClusterXL only.\r\n\r\nA Bond in Load Sharing mode is considered to be down when fewer than a critical minimal number of subordinate interfaces remain up. When not explicitly defined, the critical minimal number of subordinate interfaces, which must remain up, in a bond of $\\mathbf{n}$ interfaces is $\\mathbf{n - 1}$. Failure of an additional subordinate interface (when $\\mathbf{n - 2}$ subordinate interfaces remain up) will cause the entire bond interface to be considered down, even if the bond contains more than two subordinate interfaces.\r\n\r\nIf a smaller number of subordinate interfaces will be able to handle the expected traffic, you can increase redundancy by explicitly defining the critical minimal number of subordinate interfaces. Divide your maximal expected traffic speed by the speed of your subordinate interfaces and round up to a whole number to determine an appropriate number of critical subordinate interfaces.\r\n\r\nTo define the critical number of subordinate interfaces explicitly, create and edit the following file:\r\n\\$FWDIR/conf/cpha_bond_1s_config.conf\r\nEach line of the file should be written in the following syntax:\r\n<Name of Bond> <Critical Minimal Number of Subordinate Interfaces>\r\nFor example, if bond0 has 7 subordinate interfaces, and bond1 has 6 subordinate interfaces, file contents could be:\r\n\r\n```\r\nbond0 5\r\nbond1 3\r\n```\r\n\r\nIn this example:\r\n\r\n- bond0 would be considered down when 3 of its subordinate interfaces have failed.\r\n- bond1 would be considered down when 4 of its subordinate interfaces have failed.\r\n\r\n\r\n## Affinities of Bond Subordinate Interfaces to CPU Cores\r\n\r\nFor optimal performance, follow these guidelines:\r\n\r\n1. Configure static affinities of bond subordinate interfaces to CPU Cores.\r\n2. Whenever possible, dedicate one processing core to each interface.\r\n3. If there are more physical interfaces than CPU cores, then some CPU cores handle two or more interfaces.\r\n\r\nUse pairs of subordinate interface of the same position with internal and external bonds.\r\n\r\na. To view positions of subordinate interface in a bond, run in the Expert mode:\r\ncat /proc/net/bonding/<Name of Bond Interface>\r\nb. Note the sequence of the interfaces in the output.\r\n\r\nCompare this sequence for the two bonds (external bond and its respective internal bond).\r\nSubordinate interfaces that appear in the same position in the two bonds are interface pairs.\r\nSet these pairs to be handled by one processing CPU core.\r\n\r\n# Example configuration \r\n\r\nAn appliance has:\r\n\r\n- Four processing CPU cores:\r\ncore 0 , core 1 , core 2 , and core 3\r\n- Two bond interfaces:\r\nbond0 with subordinate interfaces eth0, eth1, and eth2\r\nbond1 with subordinate interfaces eth3, eth4, and eth5\r\nIn such case, two of the CPU cores need to handle two subordinate interfaces each.\r\nAn optimal configuration can be:\r\n\r\n| CPU core | bond0 | bond1 |\r\n| :-- | :-- | :-- |\r\n| 0 | eth0 | eth3 |\r\n| 1 | eth1 | eth4 |\r\n| 2 | eth2 |  |\r\n| 3 |  | eth5 |\r\n\r\nFor more information, see the R81.20 Performance Tuning Administration Guide:\r\n\r\n- Chapter CoreXL > Section Configuring Affinity Settings.\r\n- Chapter CoreXL > Section Affinity Settings for 16000 and 26000 Appliances.\r\n\r\n# Bond Failover \r\n\r\nEither of the following failure scenarios can induce bond failover:\r\n\r\n- An active interface detects a link state failure in another monitored interface\r\n- ClusterXL detects a failure in sending or receiving Cluster Control Protocol (CCP) keep-alive packets Either of these occurrences will induce a failover, either to another subordinate interface within the bond, or between VSX Cluster Members, depending on the circumstances.\r\n\r\nNote - The bond failover operation requires a network interface card that supports the Media-Independent Interface (MII) standard.\r\n\r\n## Link State Initiated Failover\r\n\r\nLink-state initiated failover occurs in this sequence:\r\n\r\n1. The active subordinate interface detects a down link state.\r\n2. The bond initiates failover to a standby interface. Since this is a failover within the bond, the status of the other VSX Cluster Member is unaffected.\r\n\r\nWhen the number of available subordinate interfaces is fewer than the critical minimum number of interfaces, failover to other VSX Cluster Members occurs (see \"Setting Critical Required Interfaces\" on page 172).\r\n3. If the standby interface continues to detect a link failure, and the initial interface is still down, failover to other VSX Cluster Members occurs.\r\n\r\n## Failover Initiated by Cluster Control Protocol (CCP)\r\n\r\nCCP failover occurs only when other VSX Cluster Members are not down, in this sequence.\r\n\r\n1. ClusterXL detects a problem sending or receiving of CCP packets.\r\n2. ClusterXL initiates an internal bond failover.\r\n3. ClusterXL monitors CCP packet transmission and reception. If additional problems are detected within three minutes, the system initiates a failover to another VSX Cluster Member.\r\n\r\n## Failover Support for VLANs\r\n\r\nClusterXL monitors VLAN IDs for connectivity failure or miscommunication, and initiates failover when necessary. By default, both the highest and the lowest VLAN IDs are monitored for failure. This is done by sending ClusterXL Control Protocol (CCP) packets on round-trip paths at a set interval.\r\n\r\nYou can configure VSX to monitor all VLANs.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_40.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Cluster |  | 5 | VLAN 3 |\r\n| 2 | bond 0 |  | 6 | S-1 |\r\n| 3 | VLAN 1 |  | 7 | S-2 |\r\n| 4 | VLAN 2 |  |  |  |\r\n\r\nWhen a failure is detected, a log of the failure is recorded in the Logs \\& Monitor view.\r\n\r\n# Monitoring the Highest and Lowest VLAN IDs \r\n\r\nBy default, the highest and lowest VLAN IDs indicate the status of the physical connection. These VLAN IDs are always monitored and a connectivity failure in either initiates a failover. In most deployments this is the desired setting, as it supports the primary purpose of the feature (detecting a connectivity failure) and the traffic generated on the network is light. However, this setting only detects VLAN configuration problems on the switch for the highest and lowest VLAN IDs.\r\n\r\n# Configuring Cisco Switches for Link Aggregation Load Sharing Mode \r\n\r\nThese are sample configuration commands for Cisco switches.\r\n\r\n## For 802.3ad (LACP)\r\n\r\n```\r\nSwitch# conf t\r\nSwitch(config)# port-channel load-balance src-dst-ip\r\nSwitch(config)# interface FastEthernet <all the participating ports>\r\nSwitch(config-if)# channel-group 1 mode active\r\nSwitch(config-if)# channel-protocol lacp\r\nSwitch(config-if)# exit\r\nSwitch(config)# interface port-channel 1\r\nSwitch(config-if)# switchport access vlan <desired vlan number>\r\nSwitch(config-if)# end\r\nSwitch# write\r\n```\r\n\r\n\r\n## For XOR\r\n\r\n```\r\nSwitch# conf t\r\nSwitch(config)# port-channel load-balance src-dst-ip\r\nSwitch(config)# interface FastEthernet <all the participating ports>\r\nSwitch(config-if)# channel-group 1 mode on\r\nSwitch(config-if)# exit\r\nSwitch (config)# interface port-channel 1\r\nSwitch(config-if)# switchport access vlan <desired vlan number>\r\nSwitch(config-if)# end\r\nSwitch# write\r\n```\r\n\r\n# Troubleshooting Bonded Interfaces \r\n\r\n## Troubleshooting Workflow\r\n\r\n1. Connect to the command line.\r\n2. Log in to the Expert mode.\r\n3. Check the status of the bond:\r\ncat /proc/net/bonding/<bond id>\r\n4. If there is a problem, check if the physical link is down, as follows:\r\na. Execute the following command:\r\n\r\n- In Gaia Clish:\r\nshow cluster bond name <bond_name>\r\n- In the Expert mode:\r\ncphaprob show_bond <bond_name>\r\nb. Look for a subordinate interface that reports the status of the link as no.\r\nc. Check the cable connections and other hardware.\r\nd. Check the port configuration on the switch.\r\n\r\n5. Check if a VSX Cluster Member is down, by running:\r\n\r\n- In Gaia Clish:\r\nshow cluster state\r\n- In the Expert mode:\r\ncphaprob state\r\nIf any of the VSX Cluster Members has a State other than Active, see the R81.20 ClusterXL Administration Guide - Chapter Monitoring and Troubleshooting Clusters.\r\n\r\nOn a VSX Cluster Member, reboot is needed after the following actions on a bond interface:\r\n\r\n1. Changing a bond mode.\r\n2. Adding a subordinate interface into a bond\r\n\r\nNote - Removing a subordinate interface does not require reboot.\r\n\r\nFor further information regarding bond status and failovers, view logs in the Logs \\& Monitor view. Any interface bond status change is logged and can be viewed in Logs \\& Monitor.\r\n\r\n# Connectivity Delays on Switches \r\n\r\nWhen using certain switches, connectivity delays may occur during some internal bond failovers. With the various features that are now included on some switches, it can take close to a minute for a switch to begin servicing a newly connected interface. The following are suggestions for reducing the startup time after link failure.\r\n\r\n1. Disable auto-negotiation on the applicable interface.\r\n2. On some Cisco switches, enable PortFast, as detailed below.\r\n\r\nNote - PortFast is not applicable if the bond group on the switch is configured as Trunk.\r\n\r\n## Warning Regarding Use of PortFast\r\n\r\nThe PortFast feature should never be used on ports that connect to other switches or hubs. It is important that the Spanning Tree complete the initialization procedure in these situations.\r\n\r\nOtherwise, these connections may cause physical loops where packets are continuously forwarded (or even multiply) in such a way that network will ultimately fail.\r\n\r\n## Sample Configuration of PortFast on a Cisco Switch\r\n\r\nThe following are the commands necessary to enable PortFast on a Gigabit Ethernet 1/0/15 interface of a Cisco 3750 switch running IOS.\r\n\r\n1. Enter configuration mode:\r\ncisco-3750A\\# conf t\r\n2. Specify the interface to configure:\r\ncisco-3750A(config)\\# interface gigabitethernet1/0/15\r\n3. Set PortFast on this interface:\r\ncisco-3750A(config-if)\\# spanning-tree portfast\r\n\r\n# Optimizing VSX \r\n\r\nThis section describes different features that let you monitor and optimize the VSX performance.\r\n\r\n# Monitoring Memory Resources (vsx mstat) \r\n\r\nUse the \"vsx mstat\" on page 226 command to monitor the memory the VSX Gateway uses.\r\nThe command shows an overview of the memory that the system and each Virtual Device is using.\r\nThese are the global memory resources that are shown:\r\n\r\n- Memory Total - Total physical memory on the VSX Gateway.\r\n- Memory Free - Available physical memory.\r\n- Swap Total - Total of swap memory.\r\n- Swap Free - Available swap memory.\r\n- Swap-in rate - Total memory swaps per second.\r\n\r\nThe Virtual Devices are listed according to the VSIDs.\r\nRun the \"vsx stat -v\" command to show the VSID for the Virtual Devices.\r\nYou must be in the Expert mode to run this command.\r\nIn addition:\r\n\r\n1. Run the cpview command in the context of Virtual System 0 (see \"cpview\" on page 215).\r\n2. From the top, click:\r\n\r\nAdvanced > VSX > VSs > Physical-Resources\r\n\r\nNote - This tab shows the memory consumption by Virtual Systems and by Virtual Routers.\r\n\r\n# Monitoring CPU Resources \r\n\r\nFrom R80.40, the CPU Resource Control is integrated into the CPView utility.\r\n\r\n1. Go to the context of Virtual System 0:\r\n\r\n- In the Expert mode:\r\n\r\n\r\n## vsenv\r\n\r\n- In Gaia Clish:\r\n\r\n\r\n## set virtual-system 0\r\n\r\n2. Run the CPView:\r\n\r\n## cpview\r\n\r\nSee \"cpview\" on page 215.\r\n3. From the top, click:\r\n\r\nAdvanced > VSX > VSs > Physical-Resources\r\n\r\n## Notes:\r\n\r\n- This tab shows the CPU consumption by Virtual Systems and by Virtual Routers.\r\n- The \"CPU \\%\" column shows the percentage of CPU used by all the processes of each Virtual System.\r\nThe column shows a percentage of a single CPU (the same behavior as in the \"top\" command).\r\nExample:\r\n- There are 4 CPU cores on the VSX Gateway.\r\n- The processes of the Virtual System \"VS1\" are using:\r\n- $30 \\%$ of CPU 0\r\n- $40 \\%$ of CPU 1\r\n- $50 \\%$ of CPU 2\r\n- $10 \\%$ of CPU 3\r\n\r\nIn such case, the \"CPU \\%\" column shows 130\\% for VS1.\r\n\r\n- To get the CPU usage for the VSX Gateway / VSX Cluster Member, divide the \"CPU \\%\" value in the Total Resource Consumption section by the number of the CPU cores.\r\n\r\n# SNMP Monitoring \r\n\r\nIn This Section:\r\n\r\n| Supported SNMP Versions ..................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_41.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | SNMP Server that sends SNMP Requests to <br> VSX Gateway |  | 6 | Virtual System 1 (ctx 1) |\r\n| 2 | eth0 |  | 7 | Virtual System in Bridge <br> mode (ctx 2) |\r\n| 3 | VSX Gateway |  | 8 | Virtual Router (ctx 3) |\r\n| 4 | SNMP Daemon |  | 9 | Virtual Switch (ctx 4) |\r\n| 5 | Virtual System 0 |  |  |  |\r\n\r\n# SNMP VS Mode \r\n\r\nIn SNMP VS mode:\r\n\r\n- Each Virtual Device has separate SNMP daemon running in the context of that Virtual Device.\r\n- Query for Virtual Devices uses the VS0 IP address.\r\n- You must run the SNMP query using the interface on the VSX Gateway.\r\n- The query is relayed to the specified Virtual Device.\r\n- The Virtual Device sends the response through the same VSX Gateway interface.\r\n- The VS ID must be specified in the SNMP query.\r\n\r\nNote - Default mode query functionality is not decreased when you enable SNMP VS mode.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_42.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Query Host |  | 4 | VS 0 |\r\n| 2 | eth0 |  | 5 | SNMP Daemon |\r\n| 3 | VSX Gateway |  | 6 | UDS |\r\n\r\n# SNMP VS in the \"vs-direct-access\" Mode \r\n\r\n- SNMP VS in the vs-direct-access mode is available only when the SNMP VS mode is enabled.\r\n- Enables SNMP queries on the IP address of a Virtual System (not only VS0), or Virtual Router.\r\n\r\n\r\n## Notes:\r\n\r\n- For cluster deployments, you can query only Virtual IP addresses.\r\n- Only Virtual Devices with an IP address can be queried, not Virtual Switches or Virtual Bridges.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_43.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Query Host |  | 4 | VS 0 |\r\n| 2 | eth0 |  | 5 | SNMP Daemon |\r\n| 3 | VSX Gateway |  | 6 | UDS |\r\n\r\n# Configuring SNMP Modes \r\n\r\nEach Virtual System must meet these requirements:\r\n\r\n## SNMP USM user\r\n\r\n- To use SNMP v3 queries, an SNMP USM user must be defined.\r\n\r\nFor more on USM user creation commands, see the R81.20 Gaia Administration Guide.\r\n\r\n- To use SNMP v3 queries on VSX, the USM user must be configured with the allowed Virtual Devices:\r\nset snmp usm user <User_Name> vsid <VSID>\r\n- By default, a USM user in VSX has no allowed Virtual Devices.\r\n\r\n# Allowed interfaces \r\n\r\nIf you enable the vs-direct-access mode, the Virtual System accepts SNMP queries on all the interfaces.\r\nTo prevent SNMP queries for a specified interface, add a new rule to the policy that blocks SNMP traffic on that interface.\r\n\r\n## Query source\r\n\r\nIn the vs mode and the vs-direct-access mode, there is no specification for query source.\r\nAll sources allowed in the Security Policy are valid.\r\n\r\n## Running SNMP Queries\r\n\r\nWhen you query a Virtual System Load Sharing cluster with the VSX Cluster Member (VS 0) Virtual IP address, the Virtual System on the Active VSX Cluster Member (VS 0) replies to the query.\r\n\r\nAn Active Virtual System on a Standby VSX Cluster Member does not reply to the query.\r\nIf you want to query the Active Virtual System on a Standby VSX Cluster Member, use the real IP address of the VSX Cluster Member.\r\n\r\n## SNMP Configuration\r\n\r\nSee the R81.20 Gaia Administration Guide and sk90860: How to configure SNMP on Gaia OS.\r\n\r\n| To Configure | Run |\r\n| :--: | :--: |\r\n| SNMP Default | 1. set snmp agent on <br> 2. set snmp mode default |\r\n| SNMP mode VS | 1. set snmp agent on <br> 2. set snmp mode vs |\r\n| SNMP direct-vs-access | 1. set snmp agent on <br> 2. set snmp mode vs <br> 3. set snmp vs-directaccess on |\r\n\r\n# Example SNMP queries for Virtual Systems \r\n\r\nThis section shows example SNMP queries.\r\n\r\n## To run an SNMP v3 query using the VSX (VS 0) IP address\r\n\r\nIn Gaia Clish:\r\n\r\n1. Enable the SNMP agent for context VS:\r\nset snmp agent on\r\n2. Add an SNMP user with permissions for VSs 2,15:\r\n```\r\nadd snmp usm user admin security-level authNoPriv auth-pass-phrase\r\nabcd1234\r\nset snmp usm user admin vsid 2,15\r\n```\r\n\r\n3. Set SNMP VS mode:\r\nset snmp mode vs\r\n4. Send the remote queries, where:\r\n\r\n- vsidN is the SNMP context name required by SNMP v3.\r\n- The IP address is the management IP address of the VSX Gateway or VSX Cluster.\r\n\r\nFor example (in the Expert mode):\r\n\r\n```\r\nsnmpwalk -n vsid2 -v 3 -l authNoPriv -u admin -A abcd1234 192.0.2.5\r\nifDesc\r\nsnmpwalk -n vsid15 -v 3 -l authNoPriv -u admin -A abcd1234 192.0.2.5\r\nsysName\r\n```\r\n\r\n192.0.2.5 is the IP address of the Management Server.\r\n\r\n## To run an SNMP v1/v2c query using the VSX (VS 0) IP Address\r\n\r\nIn Gaia Clish:\r\n\r\n1. Enable the SNMP agent for context VS 0 :\r\nset snmp agent on\r\n2. Enable SNMP v1/v2:\r\nset snmp agent-version any\r\n3. Set the SNMP community:\r\nset snmp community public read-only\r\nset snmp community private read-write\r\n4. Set the SNMP mode to VS:\r\n\r\n# set snmp mode vs \r\n\r\n5. Send remote queries, where:\r\n\r\n- The community has the VSID or Virtual System name as a suffix.\r\n- The IP address is the Management IP address of the VSX Gateway or VSX Cluster.\r\n\r\nFor example, to query a Virtual System with the name \"MY_VS\" or has VSID \"2\", run\r\nIn the Expert mode, run:\r\n\r\n```\r\nsnmpwalk -v 1 -c public_2 192.0.2.5 ifDescr\r\nsnmpwalk -v 1 -c private_MY_VS 192.0.2.5 ifDescr\r\n```\r\n\r\nCommunities with suffixes are created automatically.\r\nCommunity name collisions might occur in special cases, for example if we use these communities:\r\n\r\n- Read-only community $=$ private\r\n- Read-write community $=$ private_1\r\n\r\nThe communities' private_1 and private_1_1 are automatically created for VSID 1.\r\nPrivate_1 is not a unique community. The community is ambiguous and using it results in unexpected behavior.\r\n\r\n## To run an SNMP query using the Virtual Device's IP address\r\n\r\n1. Enable the SNMP agent for context VS0:\r\nset snmp agent on\r\n2. Add an SNMP user:\r\nadd snmp usm user admin security-level authNoPriv auth-pass-phrase abcd1234\r\n3. Specify USM user permissions for Virtual Devices:\r\nset snmp usm user admin vsid $0-10$\r\n4. Set the SNMP community:\r\nset snmp community public read-only\r\nset snmp community private read-write\r\n5. Set SNMP VS mode:\r\nset snmp mode vs\r\n6. Enable SNMP queries over Virtual Device's interfaces:\r\nset snmp vs-direct-access on\r\n7. Send remote queries, where the IP address is the Virtual IP address of the Virtual Device.\r\n\r\nIn the Expert mode, run:\r\n\r\n```\r\nsnmpwalk -v 1 -c public 192.0.2.81 ifDescr\r\nsnmpwalk -v 2c -c public 192.0.2.81 ifDescr\r\nsnmpwalk -v 1 -c private 192.0.2.82 ifDescr\r\nsnmpwalk -v 2c -c private 192.0.2.82 ifDescr\r\nsnmpwalk -v 3 -l authNoPriv -u admin -A abcd1234 192.0.2.83 ifDescr\r\n```\r\n\r\n\r\n# Notes: \r\n\r\n- The SNMP community used in the queries is the same community that you configured earlier.\r\n- Only the active Virtual Device is queried.\r\n\r\nImportant - SNMP traps are available only for VS 0\r\n\r\n# The VSX SNMP Tree \r\n\r\nTo get information from a Virtual Device (Virtual System, Virtual Switch, or Virtual Router), you must load the Check Point MIB file into your SNMP Browser.\r\n\r\n- The MIB file on the VSX Gateway (context of VS 0) is: \\$CPDIR/lib/snmp/chkpnt.mib\r\n- The VSX OID is: .1.3.6.1.4.1.2620.1.16\r\n\r\nExample commands in the Expert mode:\r\n\r\n- To run an SNMP v2c query for VSX status table, run:\r\n\r\n```\r\nsnmpwalk -m $CPDIR/lib/snmp/chkpnt.mib -c public -v 2c 192.0.2.83\r\nvsxStatusTable\r\n```\r\n\r\n- To run an SNMP v3 query for the VSX memory usage table, run:\r\n\r\n```\r\nsnmpwalk -m $CPDIR/lib/snmp/chkpnt.mib -v 3 -l authNoPriv -u admin -A\r\nabcd1234 192.0.2.83 vsxStatusMemoryUsageTable\r\n```\r\n\r\n\r\n## The vsxCountersTable refresh time:\r\n\r\nThe vsxCountersTable refresh time is configured in this file:\r\n\\$FWDIR/conf/amon_vsx_refresh_interval\r\nThe default value is 30 (seconds).\r\n\r\n# Configuring Jumbo Frames \r\n\r\nVSX supports Jumbo Frames and lets you configure up to the maximum MTU of the NIC driver.\r\n\r\n## Jumbo Frames on a Virtual Switch\r\n\r\nConfigure the MTU of a Virtual Switch to enable Jumbo Frames on the Virtual Systems that are connected to the Virtual Switch. When you configure the MTU of the Virtual Switch, all the related Warp Links and interfaces are automatically changed to the new value.\r\n\r\nYou cannot configure the MTU of a Warp Link from the Virtual System.\r\n\r\nTo configure Jumbo Frames on a Virtual Switch:\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the Virtual Switch.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. Double-click the Virtual Switch object.\r\n4. From the left tree, click Topology.\r\n5. In the Interfaces section, select the applicable interface and click Edit.\r\n6. On the General tab, configure the MTU.\r\n7. Click OK.\r\n8. Publish the SmartConsole session.\r\n\r\n## Jumbo Frames on a Virtual Router\r\n\r\nConfigure the MTU of a Virtual Router to enable Jumbo Frames on the interfaces. To change the MTU of Warp Links, configure the settings of the Virtual System.\r\n\r\nTo configure Jumbo Frames on a Virtual Router:\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the Virtual Router.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. Double-click the Virtual Router object.\r\n4. From the left tree, click Topology.\r\n5. In the Interfaces section, select the applicable interface and click Edit.\r\n6. On the General tab, configure the MTU.\r\n7. Click OK.\r\n8. Publish the SmartConsole session.\r\n9. Install the applicable Access Control policy on the Virtual Router object.\r\n\r\n# Jumbo Frames on a Virtual System in Bridge Mode \r\n\r\nConfigure the MTU of a Virtual System in Bridge Mode to enable Jumbo Frames on the interfaces.\r\n\r\nTo configure Jumbo Frames on a Virtual System in Bridge Mode:\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the Virtual System.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. Double-click the Virtual System object.\r\n4. From the left tree, click Topology.\r\n5. In the Interfaces section, select the applicable interface and click Edit.\r\n6. On the General tab, configure the MTU.\r\n7. Click OK.\r\n8. Publish the SmartConsole session.\r\n9. Install the applicable Access Control policy on the Virtual System object.\r\n\r\n# Bridge Mode \r\n\r\nBy implementing native Layer 2 bridging instead of IP routing, you can add Virtual Systems without adversely affecting the existing IP structure.\r\n\r\nWhen in the Bridge mode, Virtual System interfaces do not require IP addresses.\r\nYou can optionally assign an IP address to the Virtual System itself (not the interfaces) to enable Layer 3 monitoring, which provides network fault detection functionality.\r\n\r\nVSX supports these Bridge mode models:\r\n\r\n- Active/Active Bridge Mode: Provides redundancy while preventing undesirable loops between redundant switches.\r\n- Active/Standby Bridge Mode: Provides path redundancy and loop prevention, while offering seamless support for Virtual System Load Sharing and overcoming many of the limitations of STP.\r\n\r\n\r\n## Active/Active Bridge Mode (Spanning Tree Protocol)\r\n\r\nThe Spanning Tree Protocol is an industry standard technology to prevent loops in high-speed switched networks.\r\n\r\nTo use the STP Bridge mode, you must have STP deployed and properly configured on your network.\r\nThese STP Layer 2 protocols are supported:\r\n\r\n- 802.1d\r\n- 802.1q\r\n- 802.1s\r\n- 802.1w\r\n- PVST+\r\n\r\nSee your vendor documentation to learn how to deploy and configure STP on your network hardware.\r\n\r\n# Active/Standby Bridge Mode \r\n\r\nThe Active/Standby Bridge Mode enhances both:\r\n\r\n- High Availability (for significant improvements).\r\n- Virtual System Load Sharing (VSLS) in VSX Cluster environments (for throughput distributed among Virtual Systems).\r\n\r\nActive/Standby Bridge Mode has these advantages:\r\n\r\n- Instantaneous failover.\r\n- Enhanced administrator control over bridge failover.\r\n- VSLS support.\r\n- VLAN translation.\r\n\r\nThe principal limitation of the Active/Standby Bridge Mode is that it breaks the STP tree structure.\r\n\r\nNote - When configuring a Virtual System in the Active/Standby Bridge Mode, you should remove Virtual System VLANs from the STP database in the switches. This action prevents delays due to trunk interface failback.\r\n\r\n## Three Layer Hierarchical Model\r\n\r\nA three-layer hierarchical model is used in large, high-traffic network environments.\r\n\r\n1. A core network, with high-speed backbone switches that direct traffic to and from the Internet and other external networks.\r\n2. A distribution layer, with routers, for connectivity between the core and the access layer.\r\n3. An access layer, with redundant LAN switches, that forward traffic to and from internal networks.\r\n\r\nVSX in Active/Standby Bridge Mode is incorporated in the distribution layer, enforcing the security policy.\r\nThe routers direct external traffic to the appropriate Virtual System through a segregated VLAN. Inspected traffic exits the Virtual System through a separate segregated VLAN, to the routers and then to internal destinations.\r\n\r\n## VLAN Shared Interface Deployment\r\n\r\nIn this deployment, which cannot function using a standard STP Bridge mode configuration, each VSX Cluster Member connects to pair of redundant switches through a VLAN Trunk.\r\n\r\nAll Virtual Systems in a given VSX Cluster Member share the same VLAN Trunk.\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_44.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 9 | Virtual System 3 is Backup |\r\n| 2 | Redundant switches (external) |  | 10 | Redundant switches (internal) |\r\n| 3 | VSX Cluster |  | 11 | VLAN Switch |\r\n| 4 | VSX Cluster Member 1 |  | 12 | Internal Networks |\r\n| 5 | VSX Cluster Member 2 |  | - | Sync Network |\r\n| 6 | Virtual Systems in Bridge Mode |  |  | Physical Interface |\r\n| 7 | Virtual System 1 is Active |  |  | VLAN Trunk |\r\n| 8 | Virtual System 2 is Standby |  |  |  |\r\n\r\nWith Active/Standby Bridge Mode in High Availability mode, VSX Cluster directs traffic to VSX Cluster Members according to administrator-defined priorities and status.\r\n\r\nIn Virtual System Load Sharing deployments, the system distributes the traffic load amongst VSX Cluster Members according to the Virtual System Load Sharing configuration.\r\n\r\n# Virtual System in Bridge Mode \r\n\r\nIn This Section:\r\n\r\nCore Network Security ..... 196\r\nConfiguring Virtual Systems for the Active/Standby Bridge Mode ..... 197\r\nMulti Bridge Interfaces ..... 198\r\nImportant:\r\n\r\n- From R81, it is possible to add bridge interfaces to regular Virtual Systems with the vsx_provisioning_tool.\r\nSee \"Adding a Bridge Interface to a Virtual System\" on page 284.\r\n- From R81.10, it is possible to add bridge interfaces to regular Virtual Systems in SmartConsole.\r\nSee \"Configuring Bridge Interfaces in Regular Virtual Systems\" on page 76.\r\n\r\n\r\n## Core Network Security\r\n\r\nMany Enterprise environments are based on core networks. Situated adjacent to core network backbone switches, VSX protects the internal network by providing security at Layer 2, Layer 3 or both. VSX communicates with the core network using the existing infrastructure. With Virtual Systems in the Bridge Mode, VSX can protect departmental networks, while simultaneously preventing network segmentation. In this case, switches are located at the entrance to each department's network.\r\n![[CP_R81.20_VSX_AdminGuide_img_45.jpeg]]\r\n\r\n| Item | Description |  | Item | Description |\r\n| :-- | :-- | :-- | :-- | :-- |\r\n| 1 | Internet |  | 8 | LAN Switches |\r\n| 2 | Core Network Backbone switch |  | 9 | Sales |\r\n| 3 | VSX Cluster |  | 10 | Finance |\r\n| 4 | Router |  | - | Sync Network |\r\n| 5 | VLAN |  | - | Physical Interface |\r\n| 6 | Member 1 |  |  | VLAN Trunk |\r\n| 7 | Member 2 |  |  |  |\r\n\r\nVSX ensures connectivity between the core network and the Internet or external networks, while providing perimeter security.\r\n\r\nSecurity can be configured on a per VLAN basis.\r\n\r\n# Configuring Virtual Systems for the Active/Standby Bridge Mode \r\n\r\nTo configure a Virtual System in Bridge Mode, define it as such when you first create the Virtual System object.\r\n\r\nImportant - You cannot configure a non-Bridge Mode Virtual System to work in the Bridge Mode later.\r\n\r\nTo configure a Virtual System for the Active/Standby Bridge Mode:\r\n\r\n1. In the Virtual System General Properties page of the new Virtual System object, select Bridge Mode.\r\n2. Click Next.\r\n\r\nThe Virtual System Network Configuration window opens.\r\n3. Configure the external and internal interfaces for the Virtual System.\r\n4. Optional: Select Enable Layer 3 Bridge Interface Monitoring.\r\n\r\nThe IP address must be unique and on the same subnet as the protected network.\r\n5. Click Next.\r\n6. Click Finish.\r\n\r\n# Multi Bridge Interfaces \r\n\r\nThis feature is supported for:\r\n\r\n- VSX Gateways\r\n- VSX Clusters in the Active/Active Bridge Mode\r\n- VSX Clusters in the Active/Standby Bridge Mode\r\n\r\nMulti Bridge allows traffic from many different VLANs to move through one Virtual System in the Bridge Mode.\r\n\r\nIn a Virtual System in the Bridge Mode, you can add physical and VLAN interfaces.\r\nWhen you add more than two VLAN interfaces, Multi Bridge is automatically enabled.\r\nConfigure the same VLAN tag on each set of two interfaces to bridge them.\r\nRequirements for Multi Bridge interfaces:\r\n\r\n- All interfaces must be VLANs.\r\n- You can make multiple bridges only between two VLAN Trunks.\r\n- You can add up to 64 pairs of VLAN interfaces for one Multi Bridge.\r\n- Those two VLAN Trunks must be used together, and not with other VLAN Trunks, in other Virtual Systems in Bridge Mode or Multi Bridges.\r\n\r\nFor example, you define eth1.10, eth2.10, eth1.20, eth2.20.\r\nNow the VLAN Trunks, eth1 and eth2, cannot be used with other VLAN Trunks on other Virtual Systems in Bridge Mode: eth1.30 cannot bridge with eth3.30.\r\n![[CP_R81.20_VSX_AdminGuide_img_46.jpeg]]\r\n\r\n| Item | Description |\r\n| :-- | :-- |\r\n| 1 | Virtual System in Bridge Mode with three bridges on VLAN interfaces with tags 10, 20, and 30. |\r\n| 2 | Virtual System in Bridge Mode with three bridges on VLAN interfaces with tags 40, 50, and 60. |\r\n| 3 | VLAN Trunks. |\r\n| and | Each must be paired with the other in all bridges, or used without bridging. |\r\n| 4 | They cannot be paired with a different VLAN Trunk. |\r\n\r\nNote - Names of Multi Bridge interfaces have a template \"brXXXXXX\", where \"X\" are digits.\r\n\r\n# To configure a new Multi Bridge: \r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the new Virtual System.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. Create a new Virtual System object in one of these ways:\r\n\r\n- From the top toolbar, click the New ( $\\boldsymbol{\\star}$ ) > VSX > New Virtual System.\r\n- In the top left corner, click Objects menu > More object types > Network Object > Gateways and Servers > VSX > New Virtual System.\r\n- In the top right corner, click Objects Pane > New > More > Network Object > Gateways and Servers > VSX > Virtual System.\r\n\r\n4. In the Name field, enter the name for the new Virtual System.\r\n5. In the VSX Gateway / Cluster field, select the applicable VSX Gateway or VSX Cluster.\r\n6. Select Bridge Mode.\r\n7. Click Next.\r\n8. In the Interfaces section, click Add to add the first VLAN interface for the bridge.\r\n9. In the Interfaces section, click Add again to add the second VLAN interface for the bridge.\r\n10. In the Interfaces section, add more VLAN interface pairs to the Multi Bridge in the same way.\r\n\r\nMake sure the interfaces in each pair have the same VLAN tag, from different interfaces.\r\nFor example:\r\neth2.50, eth2.51\r\neth3.50, eth3.51\r\nMake sure to use the same two VLAN Trunks.\r\n11. Click Next.\r\n12. Click Finish.\r\n13. Install the applicable Access Control Policy on the new Virtual System object.\r\n\r\nTo convert a Bridge to a Multi Bridge:\r\n\r\n1. Connect with SmartConsole to the Security Management Server or Target Domain Management Server that manages the Virtual System in the Bridge Mode.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. Double-click the Virtual System object.\r\n4. From the left tree, click Bridge Configuration > Topology.\r\n5. In the Interfaces section, if there are physical interfaces in the Interfaces list, remove them.\r\n6. In the Interfaces section, add more VLAN interface pairs to the Multi Bridge.\r\n7. Click OK.\r\n8. Install the applicable Access Control Policy on the Virtual System object.\r\n\r\n# VSX Cluster in Bridge Mode \r\n\r\nIn This Section:\r\n\r\nEnabling Active/Standby Bridge Mode on a New VSX Cluster ..... 201\r\nEnabling Active/Standby Bridge Mode on an Existing VSX Cluster ..... 202\r\nEnabling Active/Active Bridge Mode on an Existing VSX Cluster ..... 203\r\n\r\nFor more information, see the R81.20 Installation and Upgrade Guide > Chapter Special Scenarios for Security Gateways > Section Deploying a Security Gateway or a ClusterXL in Bridge Mode.\r\n\r\n## Enabling Active/Standby Bridge Mode on a New VSX Cluster\r\n\r\n1. During the Gaia First Time Configuration Wizard of each VSX Cluster Member, on the Products page, select ClusterXL.\r\n2. After the First Time Configuration Wizard is complete and reboot:\r\n\r\n- If you enabled the Per Virtual System State feature (required for VSLS), the Active/Standby Bridge Mode is enabled automatically.\r\n- If you chose not to enable the Virtual System Load Sharing before, then:\r\na. Connect to the command line on each VSX Cluster Member.\r\nb. Run: cpconfig\r\nc. Select the option to enable Active/Standby Bridge Mode, enter $\\mathbf{y}$, and continue the configuration.\r\n\r\n3. Connect with SmartConsole to the Security Management Server or Main Domain Management Server that manages this VSX Cluster.\r\n4. From the left navigation panel, click Gateways \\& Servers.\r\n5. Double-click the VSX Cluster object.\r\n\r\nThe VSX Cluster Properties window opens.\r\n6. From the left tree, click Other > VSX Bridge Configuration.\r\n7. Select Check Point ClusterXL.\r\n\r\nThe Active/Standby Bridge Mode loop detection algorithms in ClusterXL are enabled.\r\n8. Click OK.\r\n9. Install the VSX Policy on the VSX Cluster object.\r\n\r\nThe name of this policy is:\r\n<Name of VSX Cluster Object>_VSX\r\n\r\n# Enabling Active/Standby Bridge Mode on an Existing VSX Cluster \r\n\r\n1. Connect with SmartConsole to the Security Management Server or Main Domain Management Server that manages the VSX Cluster.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. Double-click the VSX Cluster object.\r\n\r\nThe VSX Cluster Properties window opens.\r\n4. From the left tree, click Other > VSX Bridge Configuration.\r\n5. Select Check Point ClusterXL.\r\n\r\nThe Active/Standby Bridge Mode loop detection algorithms in ClusterXL are enabled.\r\n6. Click OK.\r\n7. Install the VSX Policy on the VSX Cluster object.\r\n\r\nThe name of this policy is:\r\n<Name of VSX Cluster Object>_VSX\r\n8. On each VSX Cluster Member:\r\na. Connect to the command line.\r\nb. Log in to the Expert mode.\r\nc. Run:\r\ncpconfig\r\nd. Select Enable ClusterXL for Bridge Active/Standby.\r\ne. Exit from the cpconfig menu.\r\nf. Reboot.\r\n\r\n# Enabling Active/Active Bridge Mode on an Existing VSX Cluster \r\n\r\n1. Connect with SmartConsole to the Security Management Server or Main Domain Management Server that manages the VSX Cluster.\r\n2. From the left navigation panel, click Gateways \\& Servers.\r\n3. Double-click the VSX Cluster object.\r\n\r\nThe VSX Cluster Properties window opens.\r\n4. From the left tree, click Other > VSX Bridge Configuration.\r\n5. Select Standard Layer 2 Loop Detection Protocols.\r\n6. Click OK.\r\n7. Install the VSX Policy on the VSX Cluster object.\r\n\r\nThe name of this policy is:\r\n<Name of VSX Cluster Object>_VSX\r\n8. On each VSX Cluster Member:\r\na. Connect to the command line.\r\nb. Log in to the Expert mode.\r\nc. Run:\r\ncpconfig\r\nd. Select Disable ClusterXL for Bridge Active/Standby.\r\ne. Exit from the cpconfig menu.\r\nf. Reboot.\r\n\r\n# VSX Diagnostics and Troubleshooting \r\n\r\nThis chapter presents basic diagnostic and troubleshooting procedures to follow if you encounter a problem while working with VSX. This diagnostic routine will assist you in determining the source of the problem. This chapter presents several known issues and their solutions.\r\n\r\nMost problems are caused by configuration errors occurring during the process of defining VSX Gateway, clusters and/or Virtual Devices. Another common source of problems involves networking and connectivity issues affecting VSX behavior. These problems are listed according to the order in which you will likely encounter them. Before reading and following a certain workaround, make sure you've read all the previous workarounds, and that those steps in the configuration were successful.\r\n\r\nIn some of the cases, one initial problem can cause problems in later stages of the configuration. For that reason, it is important to find the root of the problem when you are trying to understand what went wrong.\r\n\r\nImportant - In SmartView Monitor, Firewall History and System History counters do not show data for Virtual Systems.\r\n\r\n# General Troubleshooting Steps \r\n\r\nIf you suspect that there is a problem with your VSX configuration, there are several diagnostic procedures that you can follow to determine the source.\r\n\r\nThese procedures utilize various commands documented in the \"Command Line Reference\" on page 210.\r\n\r\n1. Perform a basic configuration check for each VSX Gateway or VSX Cluster Member by running the \"vsx stat -v\" command. The output will allow you to:\r\na. Account for all Virtual Systems and make sure that none are missing from the configuration.\r\nb. Make sure all Virtual Devices are Active\r\nc. Make sure the correct Security Policy is installed for each Virtual System\r\nd. Make sure the SIC trust is established with the Management Server\r\n2. Run the \"cplic print\" command on each VSX Gateway, VSX Cluster Member and Management Server to make sure the appropriate licenses are installed.\r\n3. Run the cphaprob stat command on each VSX Cluster Member to verify its status. If a member is listed with a status other than Active, Standby, or Backup, refer to the \"Troubleshooting\" chapter in the R81.20 ClusterXL Administration Guide for additional troubleshooting assistance.\r\n4. If you suspect that a Virtual System is experiencing connectivity problems, perform the following steps:\r\na. Run the \"vsenv <VSID>\" command to set the context to the appropriate Virtual System.\r\nb. Run the \"fw getifs\" command to display the interface list for the Virtual System.\r\nc. Examine connectivity status using standard operating system commands and tools such as: ping, traceroute, tcpdump, ip route, ftp, and so on. Some of these run according to context (i.e. routing, source and destination IP addresses). .\r\n\r\nYou can also execute the \"ip route\" and \"ip link\" commands.\r\nIf these tests indicate that all interfaces and routers have connectivity, and appear to be functioning correctly, you should monitor the passage of packets through the system.\r\n5. Execute the \"fw monitor -v <VSID>\" commands to capture details of packets at multiple points. This may return multiple reports on the same packet as it passes various capture points. This command does not report on Virtual Routers, except for packets destined to an external Virtual Router.\r\n6. Execute the \"tcpdump\" command to display transmitted or received packets for specific interfaces, including Warp interfaces. This often provides valuable clues for resolving connectivity issues.\r\n\r\n# Troubleshooting Specific Problems \r\n\r\n## Cannot Establish SIC Trust for VSX Gateway or VSX Cluster Member\r\n\r\nWhen creating a VSX Gateway or VSX Cluster Member, you cannot establish SIC trust. SmartConsole shows an error message:\r\n\r\nCertificate cannot be pushed. Connection error with wait agent.\r\n\r\n## Possible Causes\r\n\r\nCheck that you have network connectivity between the VSX Gateway and Management Server by pinging from the VSX system (a ping from the Management Server to the VSX Gateway will not work because of the default security policy installed on the VSX Gateway / VSX Cluster Member). Make sure the context is vrf 0 first.\r\n\r\nCheck that all the Check Point processes on the VSX Gateway(s) are up and running by running cpwd_admin list and making sure each line has a non-zero value in the PID field.\r\n\r\nCheck that the CPD process is listening to the trust establishment port.\r\n\r\nHow to Resolve\r\nOn all applicable machines, re-check the cables, routes, IP addresses and any intermediate networking devices (routers, switches, hubs, and so on) between the Management Server and the VSX Gateway.\r\n\r\nIf the VSX Gateway just rebooted, the Check Point processes might still be coming up.\r\n\r\nRun the \"netstat -an | grep 18211\" command on the VSX Gateway, and make sure that output looks like this: tcp $0 \\quad 0 \\quad 0.0 .0 .0: 18211 \\quad 0.0 .0 .0: *$ LISTEN\r\n\r\n## SIC Trust Problems with New Virtual Devices\r\n\r\nWhen creating a new Virtual System, Virtual Router or Virtual Switch, you cannot establish SIC trust.\r\n\r\n## Possible Causes\r\n\r\nTime or time zone mismatch between the Management Server and the VSX Gateway.\r\nFor proper SIC operation, the time, date and time zone must be synchronized between the Management Server and Gateways/ VSX Cluster Members. Execute the \"/bin/date -u\" command on all machines, to obtain the correct UTC/GMT time. The machines can be in different time zones, as long as their UTC/GMT times match.\r\n\r\nHow to Resolve\r\nChange the time, date and time zone on the Management Server and/or the VSX Gateway, so that their UTC/GMT times match. Refer to your operating system documentation for the exact commands needed to accomplish this.\r\n\r\n# Install Policy Error Using VSX Creation Wizard \r\n\r\nAfter completing the VSX creation wizard, a failure occurs and the following message appears in the Operation Report window:\r\n\r\nError: Default policy installation failed on VSX. Install policy manually using SmartConsole.\r\n\r\n## Possible Causes\r\n\r\nMissing or invalid license on the Management Server.\r\nExecute cplic check on the Management Server to make sure that you have the required licenses.\r\n\r\nMissing or invalid VSX Gateway / VSX Cluster licenses.\r\nRun the \"vsx stat\" command on the VSX\r\nGateway, and make sure that the number is greater than 0 (zero) in the output:\r\nNumber of Virtual Systems allowed by license:\r\n\r\nTime or time zone mismatch between the Management Server and the VSX Gateway. For proper SIC operation, the time, date and time zone must be synchronized between the Management Server and the VSX Gateway / VSX Cluster Members.\r\nExecute the /bin/date -u command on all machines, to obtain the correct UTC/GMT time. The machines can be in different time zones, as long as their UTC/GMT offsets match.\r\n\r\n## How to Resolve\r\n\r\nObtain and install the appropriate licenses.\r\n\r\nObtain a VSX and install a valid license for each VSX Gateway / VSX Cluster Members.\r\n\r\nChange the time, date and time zone on the Management Server and/or the VSX Gateway / VSX Cluster Members, so that their UTC/GMT offsets match.\r\nRefer to your operating system documentation for the exact commands needed to accomplish this.\r\n\r\n# Internal Host Cannot Ping Virtual System \r\n\r\nAfter defining a Virtual System with an internal VLAN interface, an internal host on that VLAN cannot ping the Virtual System internal or external IP address.\r\n\r\n| Possible Causes | How to Resolve |\r\n| :--: | :--: |\r\n| A policy allowing the communication was not installed on the Virtual System. Note that after creating a Virtual System, it has a Default Policy that blocks all traffic. | Install a policy on the Virtual System that enables the traffic. In SmartConsole Logs \\& Monitor view, analyze the logs to make sure that the Virtual System allows the traffic. |\r\n| There is the VLAN configuration problem on a switch, or physical cable problem. | Check the switch configuration. Make sure that VLAN tag configured on the switch is the same as used for the Virtual System VLAN interface. <br> Check the cables, and make sure that you have plugged the cable from the switch to the correct port on the VSX Gateway / VSX Cluster Members. |\r\n| Incorrect routing on adjacent routers or hosts. | Check the routing tables on intermediate routers and hosts. You can use the t.cpdump command on the applicable VLAN interface on the VSX Gateway / VSX Cluster Members to make sure that the traffic arrives to and leaves the VSX Gateway / VSX Cluster Members. |\r\n| Incorrect IP address or net mask defined on the Virtual System VLAN interface. | Check the IP address and the net mask assigned to the Virtual System internal VLAN interface. |\r\n\r\n# Re-establishing SIC Trust with Virtual Devices \r\n\r\nIn the event you encounter connectivity problems due to the loss of SIC Trust for a specific Virtual Device (Virtual System or Virtual Router), you can use the procedure below to manually re-establish the SIC trust.\r\n\r\n## To manually re-establish SIC Trust with a Virtual Device:\r\n\r\nFollow the instructions in the sk34098.\r\n\r\n1. On the VSX Gateway or each VSX Cluster Member:\r\na. Connect to the command line the VSX Gateway or each VSX Cluster Member.\r\nb. Log in to the Expert mode.\r\nc. Examine the VSX configuration to determine the ID of the Virtual Device:\r\n```\r\nvsx stat -v\r\n```\r\n\r\nd. Reset the SIC with the specified Virtual Device:\r\nvsx sic reset <VSID>\r\n2. On the Management Server:\r\na. Connect to the command line the Management Server.\r\nb. Log in to the Expert mode.\r\nc. On the Multi-Domain Server, change the context to the applicable Target Domain Management Server that manages the Virtual Device:\r\nmdsenv <IP Address or Name of Domain Management Server>\r\nd. Determine the SIC name of the Virtual Device:\r\ncpca_client lscert -stat valid -kind SIC | grep -i -A 2 <Name of Virtual Device Object>\r\ne. Revoke the SIC certificate of the Virtual Device:\r\ncpca_client revoke_cert -n $\\langle C N=\\ldots, O=\\ldots,>$\r\n3. Connect with SmartConsole to the Security Management Server or Main Domain Management Server that manages the VSX Cluster.\r\n4. From the Gateways \\& Servers view or Object Explorer, double-click the Virtual Device object.\r\n5. Click OK.\r\n\r\nThis action creates a new SIC certificate for the Virtual Device and saves it on the VSX Gateway or each VSX Cluster Member.\r\n\r\n# Command Line Reference \r\n\r\nSee the R81.20 CLI Reference Guide.\r\nBelow is a limited list of applicable commands.\r\n\r\n# Syntax Legend \r\n\r\nWhenever possible, this guide lists commands, parameters and options in the alphabetical order.\r\nThis guide uses this convention in the Command Line Interface (CLI) syntax:\r\n\r\n| Character | Description |\r\n| :--: | :--: |\r\n| TAB | Shows the available nested subcommands: |\r\n|  | ```main command \\nested subcommand 1 \\nested subsubcommand 1-1 \\nested subsubcommand 1-2 \\nested subcommand 2``` |\r\n| Example: |  |\r\n|  | ```cpwd_admin config -a <options> -d <options> -p -r del <options>``` |\r\n|  | Meaning, you can run only one of these commands: |\r\n|  | - This command: |\r\n|  | ```cpwd_admin config -a <options>``` |\r\n| Curly brackets or braces $\\}$ | Or this command: |\r\n|  | ```cpwd_admin config -d <options>``` |\r\n|  | - Or this command: |\r\n|  | ```cpwd_admin config -p``` |\r\n|  | - Or this command: |\r\n|  | ```cpwd_admin config -r``` |\r\n|  | - Or this command: |\r\n|  | ```cpwd_admin del <options>``` |\r\n| Curly brackets or braces $\\}$ | Enclose a list of available commands or parameters, separated by the vertical bar $\\mid$. <br> User can enter only one of the available commands or parameters. |\r\n| Angle brackets <br> <br> | Enclose a variable. <br> User must explicitly specify a supported value. |\r\n| Square brackets or brackets [] | Enclose an optional command or parameter, which user can also enter. |\r\n\r\n# cpconfig \r\n\r\n## Description\r\n\r\nThis command starts the Check Point Configuration Tool.\r\nThis tool configures specific settings for the installed Check Point products.\r\n\r\n## Important:\r\n\r\n- In a Cluster, you must configure all the Cluster Members in the same way.\r\n- On Scalable Platforms (Maestro and Chassis), you must connect to the applicable Security Group.\r\n\r\nSyntax on a Security Gateway / Cluster Member in Gaia Clish or the Expert mode\r\ncpconfig\r\n\r\nSyntax on a Scalable Platform Security Group in Gaia gClish or the Expert mode\r\ncpconfig\r\n\r\n## Menu Options\r\n\r\nNote - The options shown depend on the configuration and installed products.\r\n\r\n| Menu Option | Description |\r\n| :--: | :--: |\r\n| Licenses and contracts | Manages Check Point licenses and contracts on this Security Gateway or Cluster Member. |\r\n| SNMP Extension | Obsolete. Do not use this option anymore. <br> To configure SNMP, see the R81.20 Gaia Administration Guide Chapter System Management - Section SNMP. |\r\n| PKCS\\#11 Token | Register a cryptographic token, for use by Gaia Operating System. See details of the token, and test its functionality. |\r\n| Random Pool | Configures the RSA keys, to be used by Gaia Operating System. |\r\n| Secure Internal Communication | Manages SIC on the Security Gateway or Cluster Member. This change requires a restart of Check Point services on the Security Gateway or Cluster Member. For more information, see: <br> - The R81.20 Security Management Administration Guide. <br> - sk65764: How to reset SIC. |\r\n\r\n| Menu Option | Description |\r\n| :--: | :--: |\r\n| Enable cluster membership for this gateway | Enables the cluster membership on the Security Gateway. <br> This change requires a reboot of the Security Gateway. <br> For more information, see the: <br> - R81.20 Installation and Upgrade Guide. <br> - R81.20 ClusterXL Administration Guide. <br> Note - This section does not apply to Scalable Platforms (Maestro and Chassis). |\r\n| Disable cluster membership for this gateway | Disables the cluster membership on the Security Gateway. <br> This change requires a reboot of the Security Gateway. <br> For more information, see the: <br> - R81.20 Installation and Upgrade Guide. <br> - R81.20 ClusterXL Administration Guide. <br> Note - This section does not apply to Scalable Platforms (Maestro and Chassis). |\r\n| Enable Check Point Per Virtual System State | Enables Virtual System Load Sharing on the VSX Cluster Member. For more information, see \"Configuring Virtual System Load Sharing\" on page 140. <br> Note - This section does not apply to Scalable Platforms (Maestro and Chassis). |\r\n| Disable Check Point Per Virtual System State | Disables Virtual System Load Sharing on the VSX Cluster Member. For more information, see \"Configuring Virtual System Load Sharing\" on page 140. <br> Note - This section does not apply to Scalable Platforms (Maestro and Chassis). |\r\n| Enable Check Point ClusterXL for Bridge Active/Standby | Enables Check Point ClusterXL for Bridge mode. <br> This change requires a reboot of the Cluster Member. <br> For more information, see the: <br> - R81.20 Installation and Upgrade Guide. <br> - R81.20 ClusterXL Administration Guide. <br> Note - This section does not apply to Scalable Platforms (Maestro and Chassis). |\r\n| Disable Check Point ClusterXL for Bridge Active/Standby | Disables Check Point ClusterXL for Bridge mode. <br> This change requires a reboot of the Cluster Member. <br> For more information, see the: <br> - R81.20 Installation and Upgrade Guide. <br> - R81.20 ClusterXL Administration Guide. <br> Note - This section does not apply to Scalable Platforms (Maestro and Chassis). |\r\n\r\n| Menu Option | Description |\r\n| :-- | :-- |\r\n| Check Point CoreXL | Manages CoreXL and Firewall mode on the Security Gateway / <br> Cluster Member / Scalable Platform Security Group. <br> After all changes in CoreXL configuration, you must reboot the <br> Security Gateway / Cluster Member / Security Group. <br> For more information, see the R81.20 Performance Tuning <br> Administration Guide. |\r\n| Automatic start of Check Point <br> Products | Shows and controls which of the installed Check Point products <br> start automatically during boot. |\r\n| Exit | Exits from the Check Point Configuration Tool. |\r\n\r\n# Example 1 - Menu on a single Security Gateway \r\n\r\n```\r\n[Expert@MySingleOW:0]# cpconfig\r\nThis program will let you re-configure\r\nyour Check Point products configuration.\r\nConfiguration Options:\r\n(1) Licenses and contracts\r\n(2) SNMP Extension\r\n(3) PECS#11 Token\r\n(4) Random Pool\r\n(5) Secure Internal Communication\r\n(6) Enable cluster membership for this gateway\r\n(7) Check Point CoreXL\r\n(8) Automatic start of Check Point Products\r\n```\r\n\r\n(9) Exit\r\n\r\nEnter your choice (1-9) :\r\n\r\n## Example 2 - Menu on a Cluster Member\r\n\r\n```\r\n[Expert@MyClusterMember:0]# cpconfig\r\nThis program will let you re-configure\r\nyour Check Point products configuration.\r\nConfiguration Options:\r\n(1) Licenses and contracts\r\n(2) SNMP Extension\r\n(3) PECS#11 Token\r\n(4) Random Pool\r\n(5) Secure Internal Communication\r\n(6) Disable cluster membership for this gateway\r\n(7) Enable Check Point Per Virtual System State\r\n(8) Enable Check Point ClusterXL for Bridge Active/Standby\r\n(9) Check Point CoreXL\r\n(10) Automatic start of Check Point Products\r\n(11) Exit\r\nEnter your choice (1-11) :\r\n```\r\n\r\n# cpview \r\n\r\n## Overview of CPView\r\n\r\n## Description\r\n\r\nCPView is a text based built-in utility on a Check Point computer.\r\nCPView Utility shows statistical data that contain both general system information (CPU, Memory, Disk space) and information for different Software Blades (only on a Security Gateway / ClusterXL / Scalable Platform Security Group).\r\n\r\nThe CPView continuously updates the data in easy to access views.\r\nOn a Security Gateway / ClusterXL / Scalable Platform Security Group, you can use this statistical data to monitor the performance.\r\n\r\nFor more information, see sk101878.\r\n\r\n## Syntax\r\n\r\ncpview --help\r\n\r\n## CPView User Interface\r\n\r\nThe CPView user interface has three sections:\r\n\r\n| Section | Description |\r\n| :-- | :-- |\r\n| Header | This view shows the time the statistics in the third view are collected. <br> It updates when you refresh the statistics. |\r\n| Navigation | This menu bar is interactive. Move between menus with the arrow keys and mouse. <br> A menu can have sub-menus and they show under the menu bar. |\r\n| View | This view shows the statistics collected in that view. <br> These statistics update at the refresh rate. |\r\n\r\n# Using CPView \r\n\r\nUse these keys to navigate the CPView:\r\n\r\n| Key | Description |\r\n| :-- | :-- |\r\n| Arrow keys | Moves between menus and views. Scrolls in a view. |\r\n| Home | Returns to the Overview view. |\r\n| Enter | Changes to the View Mode. <br> On a menu with sub-menus, the Enter key moves you to the lowest level sub-menu. |\r\n| Esc | Returns to the Menu Mode. |\r\n| Q | Quits CPView. |\r\n\r\nUse these keys to change CPView interface options:\r\n\r\n| Key | Description |\r\n| :-- | :-- |\r\n| $\\mathbf{R}$ | Opens a window where you can change the refresh rate. <br> The default refresh rate is 2 seconds. |\r\n| $\\mathbf{W}$ | Changes between wide and normal display modes. <br> In wide mode, CPView fits the screen horizontally. |\r\n| $\\mathbf{S}$ | Manually sets the number of rows or columns. |\r\n| $\\mathbf{M}$ | Switches on/off the mouse. |\r\n| $\\mathbf{P}$ | Pauses and resumes the collection of statistics. |\r\n\r\nUse these keys to save statistics, show help, and refresh statistics:\r\n\r\n| Key | Description |\r\n| :-- | :-- |\r\n| C | Saves the current page to a file. The file name format is: <br> cpview_<ID of the cpview process>.cap<Number of the capture> |\r\n| H | Shows a tooltip with CPView options. |\r\n| Space bar | Immediately refreshes the statistics. |\r\n\r\n# vsenv \r\n\r\n## Description\r\n\r\nChanges the shell's current context to the specified Virtual Device.\r\n\r\n## Syntax\r\n\r\n```\r\nvsenv [(<VSID> | <Name of Virtual Device>)]\r\n```\r\n\r\nImportant - On Scalable Platforms (Maestro and Chassis), you must run the applicable commands in the Expert mode on the applicable Security Group.\r\n\r\n## Parameters\r\n\r\n| Parameter | Description |\r\n| :-- | :-- |\r\n| No Parameters | Changes the context to the default Virtual Device 0. |\r\n| $<V S I D>$ | Specifies the Virtual Device by its ID. |\r\n| $<$ Name of Virtual Device> | Specifies the Virtual Device by its Name. |\r\n\r\nNote - To see the configured Virtual Devices, run the \"vsx stat -v\" command.\r\n\r\nExample 1 - Changing the context to the default Virtual Device 0\r\n[Expert8MyVxxGW:0]\\# vsenv\r\nContext is set to Virtual Device VSX2_192.168.3.242 (ID 0).\r\n[Expert8MyVxxGW:0]\\#\r\n\r\nExample 2 - Changing the context to the specific Virtual Device\r\n\r\n```\r\n[Expert8MyVxxGW:0]\\# vsenv 2\r\nContext is set to Virtual Device VS2 (ID 2).\r\n[Expert8MyVxxGW:2]\\#\r\n```\r\n\r\n# VSX \r\n\r\n## Description\r\n\r\n- Shows VSX configuration.\r\n- Fetches VSX configuration.\r\n- Shows and configures Memory Resource Control.\r\n\r\nSyntax\r\n\r\n```\r\nvsx\r\n    fetch <options>\r\n    fetch_all_cluster_policies\r\n    fetchvs <options>\r\n    get\r\n    mstat <options>\r\n    resctrl\r\n    showncs <options>\r\n    sicreset\r\n    stat <options>\r\n    unloadall\r\n    vspurge\r\n```\r\n\r\nImportant - On Scalable Platforms (Maestro and Chassis), you must run the applicable commands in the Expert mode on the applicable Security Group.\r\n\r\nNote - The fw6 vsx commands are not supported.\r\n\r\n## Parameters\r\n\r\n| Parameter | Description |\r\n| :--: | :--: |\r\n| fetch <options> | Fetches configuration for VSX Gateway. See \"vsx fetch\" on page 221. |\r\n| fetch_all_cluster policies | Fetches security policy for all Virtual Systems and Virtual Routers from cluster peers. <br> See \"vsx fetch_all_cluster_policies\" on page 223. |\r\n| fetchvs <options> | Fetches configuration for a Virtual System. See \"vsx fetchvs\" on page 224. |\r\n| get | Shows the information about the current VSX context. See \"vsx get\" on page 225. |\r\n\r\n| Parameter | Description |\r\n| :--: | :--: |\r\n| mstat <options> | Shows and configures Memory Resource Control. See \"vsx mstat\" on page 226. |\r\n| resctrl | From R80.40, the CPU Resource Control is integrated into the CPView utility. <br> 1. Go to the context of Virtual System 0 : <br> - In the Expert mode: <br> vsenv <br> - In Gaia Clish: <br> set virtual-system 0 |\r\n| 2. Run the CPView: <br> cpview |  |\r\n| See \"cpview\" on page 215. <br> 3. From the top, click: <br> Advanced > VSX > VSs > Physical-Resources <br> Notes: <br> - This tab shows the CPU consumption by Virtual Systems and by Virtual Routers. <br> - The \"CPU $\\%$ \" column shows the percentage of CPU used by all the processes of each Virtual System. <br> The column shows a percentage of a single CPU (the same behavior as in the \"top\" command). <br> Example: <br> - There are 4 CPU cores on the VSX Gateway. <br> - The processes of the Virtual System \"VS1\" are using: <br> - $30 \\%$ of CPU 0 <br> - $40 \\%$ of CPU 1 <br> - $50 \\%$ of CPU 2 <br> - $10 \\%$ of CPU 3 <br> In such case, the \"CPU $\\%$ \" column shows $130 \\%$ for VS1. <br> - To get the CPU usage for the VSX Gateway / VSX Cluster Member, divide the \"CPU $\\%$ \" value in the Total Resource Consumption section by the number of the CPU cores. |\r\n| showncs <options> | Shows Check Point Network Configuration Script (NCS) for Virtual Device. <br> See \"vsx showncs\" on page 230. |\r\n| sicreset | Resets SIC for Virtual System or Virtual Router in the current VSX context. <br> See \"vsx sicreset\" on page 231. |\r\n\r\n| Parameter | Description |\r\n| :-- | :-- |\r\n| stat <options> | Shows status information for VSX Gateway. <br> See \"vsx stat\" on page 232. |\r\n| unloadall | Unloads security policy for all Virtual Systems and Virtual Routers. <br> See \"vsx unloadall\" on page 234. |\r\n| vspurge | Cleans unused entries for Virtual Devices. <br> Fetches configuration file for Virtual Devices. <br> See \"vsx vspurge\" on page 235. |\r\n\r\n# vsx fetch \r\n\r\n## Description\r\n\r\nFetches the most current configuration files from the Security Management Server or Main Domain Management Server, and applies it to the VSX Gateway.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx fetch [-v] [-q] [-s] local\r\nvsx fetch [-v | -q | -s] [-f <Configuration File>]\r\nvsx fetch [-v | -q] -C \"NCS Command\"\r\nvsx fetch [-v | -q | -c | -n | -s] [<Management Server>]\r\n```\r\n\r\nImportant - On Scalable Platforms (Maestro and Chassis), you must run the applicable commands in the Expert mode on the applicable Security Group.\r\n\r\n## Parameters\r\n\r\n| Parameter | Description |\r\n| :--: | :--: |\r\n| $-c$ | Specifies that this is a VSX Cluster. |\r\n| $-n$ | Specifies not to apply the local.vsall, if VSX configuration, as fetched from Management Server, is up-to-date. |\r\n| $-q$ | Specifies to run in quiet mode - shows only summary information. |\r\n| $-s$ | Specifies to fetch concurrently for multi-processor environment. |\r\n| $-v$ | Specifies to run in verbose mode - shows detailed information. |\r\n| local | Reads the configuration file \\$FWDIR/state/local/VSX/local.vsall and executes the Network Configuration Script (NCS). |\r\n| $-f$ <br> <Configuration <br> File> | Fetches the specified configuration with NCS commands file instead of the default local.vsall file. |\r\n| $-C$ <br> \"NCS Command\" | Executes the specified NCS command. |\r\n| <Management <br> Server> | Fetches the local.vsall from the specified Management Server (by resolvable hostname, or IP address), replaces and runs it. |\r\n|  | Note - If you do not specify the Management Server explicitly, the command takes it from the \\$FWDIR/conf/masters file on the VSX Gateway. |\r\n\r\n# Return Values \r\n\r\n- 0 (zero) indicates that the command executed successfully.\r\n- Any other value indicates an error.\r\n\r\n\r\n## Example\r\n\r\n```\r\n[Expert8MyVxxGW:0]# vsx fetch\r\nFetching VSX Configuration From: 192.168.30.40\r\n    Local VSX Configuration is Up=To=Date.\r\n    Cleaning un-used Virtual Systems entries (local.vskeep).\r\n    Purge operation succeeded.\r\n    Fetching Virtual Systems configuration file (local.vsall).\r\nSecureXL device has been enabled for vsid 1\r\nSecureXL device has been enabled for vsid 2\r\nSecureXL device has been enabled for vsid 3\r\nVirtual Systems configuration file installed successfully\r\n[Expert8MyVxxGW:0]#\r\n```\r\n\r\n# vsx fetch_all_cluster_policies \r\n\r\n## Description\r\n\r\nFetches security policy for all Virtual Systems and Virtual Routers from cluster peers.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx fetch_all_cluster_policies [-v]\r\n```\r\n\r\nImportant - On Scalable Platforms (Maestro and Chassis), you must run the applicable commands in the Expert mode on the applicable Security Group.\r\n\r\n## Parameters\r\n\r\n| Parameter | Description |\r\n| :-- | :-- |\r\n| $-v$ | Specifies to run in verbose mode - shows detailed information. |\r\n\r\n## Return Values\r\n\r\n- 0 (zero) indicates that the command executed successfully.\r\n- Any other value indicates an error.\r\n\r\n# vsx fetchvs \r\n\r\n## Description\r\n\r\nFetches configuration file for the specified Virtual Device based on information stored locally on the VSX Gateway.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx fetchvs [-v | -q] [{<VSID> | <Name of Virtual Device>}]\r\n```\r\n\r\nImportant - On Scalable Platforms (Maestro and Chassis), you must run the applicable commands in the Expert mode on the applicable Security Group.\r\n\r\n## Parameters\r\n\r\n| Parameter | Description |\r\n| :-- | :-- |\r\n| $-q$ | Specifies to run in quiet mode - shows only summary information. |\r\n| $-v$ | Specifies to run in verbose mode - shows detailed information. |\r\n| $<$ Name of Virtual Device> | Specifies the name of the Virtual Device. |\r\n| $<$ VSID> | Specifies the ID of the Virtual Device. |\r\n\r\n## Return Values\r\n\r\n- 0 (zero) indicates that the command executed successfully.\r\n- Any other value indicates an error.\r\n\r\n\r\n## Example\r\n\r\n[Expert8MyVaaG8:3]\\# vsx fetchvs 2\r\n\r\n# vsx get \r\n\r\n## Description\r\n\r\nShows the information about the current VSX context.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx get\r\n```\r\n\r\nImportant - On Scalable Platforms (Maestro and Chassis), you must run the applicable commands in the Expert mode on the applicable Security Group.\r\n\r\n## Return Values\r\n\r\n- 0 (zero) indicates that the command executed successfully.\r\n- Any other value indicates an error.\r\n\r\n\r\n## Example\r\n\r\n[Expert\\#MyVxxGW:0]\\# vsx get\r\nCurrent context is VSX Gateway MyVxxGW (ID 2).\r\n[Expert\\#MyVxxGW:0]\\#\r\n\r\n# vsx mstat \r\n\r\n## Description\r\n\r\nShows and configures Memory Resource Control.\r\nOutput shows these global memory resources:\r\n\r\n| Resource | Description |\r\n| :-- | :-- |\r\n| Memory Total | Total physical memory on the VSX Gateway. |\r\n| Memory Free | Available physical memory. |\r\n| Swap Total | Total of swap memory. |\r\n| Swap Free | Available swap memory. |\r\n| Swap-in rate | Total memory swaps per second. |\r\n\r\nIn addition:\r\n\r\n1. Run the cpview command (see \"cpview\" on page 215).\r\n2. From the top, click:\r\n\r\nAdvanced > VSX > VSs > Physical-Resources\r\n\r\n## Syntax\r\n\r\n```\r\nvsx mstat help\r\nvsx mstat\r\n    [-vs <VSID>] [unit <Unit>] [sort {<Number> | all}]\r\n    debug\r\n    disable\r\n    enable\r\n    status\r\n    swap <Minutes>\r\n```\r\n\r\nImportant - On Scalable Platforms (Maestro and Chassis), you must run the applicable commands in the Expert mode on the applicable Security Group.\r\n\r\n## Parameters\r\n\r\n| Parameter | Description |\r\n| :-- | :-- |\r\n| help | Shows the built-in usage. |\r\n| No Parameters | Shows the total memory consumption for each Virtual System. |\r\n\r\n| Parameter | Description |\r\n| :--: | :--: |\r\n| $-v s<V S I D>$ | Specifies the Virtual Systems by their IDs. <br> You can specify: <br> - One Virtual System. <br> Example: -vs 1 <br> - Many individual Virtual Systems (separate their IDs with spaces). <br> Example: -vs 23 <br> - A range of Virtual Systems. <br> Example: -vs 4-6 |\r\n| unit <Unit> | ```Note - You can combine all the available options (separate them with spaces). Example: -vs 1 4-6``` |\r\n| ```    \\(unit <Unit>``` | Specifies the memory measurement unit shown in the command output: <br> - B - bytes <br> - K - kilobytes <br> - M - megabytes (default) <br> - G - gigabytes |\r\n| sort <br> \\{\\langleNumber> | all\\} | Sorts the Virtual Systems in the output by their memory size. <br> Specifies the number of Virtual Systems shown in the command output. <br> Use all to show all Virtual Systems. <br> If you do not specify this flag, the Virtual Systems in the output are sorted by their VSID. |\r\n| debug | Shows memory consumption debug information for each Virtual System by fields, which are defined in the configuration file. |\r\n| disable | Disables the Memory Resource Control. <br> Note - This change applies immediately and does not require a reboot. |\r\n| enable | Enables the Memory Resource Control. <br> Note - This change requires a reboot. |\r\n| status | Shows the current Memory Resource Control status. |\r\n\r\n| Parameter | Description |\r\n| :--: | :--: |\r\n| swap <br> <Minutes> | Specifies the swap-in sample rate in minutes. <br> Enter the number of minutes that the system measures memory swaps to determine the swap-in rate. <br> Only integers are valid values. <br> The default swap-in sample rate is 10 . <br> Notes: <br> - Swap-in sample rate is a system-wide Linux setting. <br> When you change the value for memory monitoring, all the swapin rates are calculated according to the new value. <br> - When you enable the monitoring memory resources feature, the swap-in rate setting is saved. <br> When you disable the feature, the system restores the saved setting. |\r\n\r\n# Return Values \r\n\r\n- 0 (zero) indicates that the command executed successfully.\r\n- Any other value indicates an error.\r\n\r\n\r\n## Example 1\r\n\r\n```\r\n[Expert8MyVxxGW:0]\\# vsx mstat unit M sort all\r\nVSX Memory Status\r\n================\r\nMemory Total: 7753.95 MB\r\nMemory Free: 7168.71 MB\r\nSwap Total: 3992.71 MB\r\nSwap Free: 3992.71 MB\r\nSwap-in rate: 8796093022208.00 MB\r\n    VSID | Memory Consumption\r\n    0 | 260.79 MB\r\n    1 | 0.00 MB\r\n[Expert8MyVxxGW:0]#\r\n```\r\n\r\n\r\n## Example 2\r\n\r\n```\r\n[Expert8MyVxxGW:0]# vsx mstat -vs 0 unit G\r\nVSX Memory Status\r\nHemory Total: 7.572 GB\r\nMemory Free: 7.001 GB\r\nSwap Total: 3.899 GB\r\nSwap Free: 3.899 GB\r\nSwap-in rate: 8589934592.000 GB\r\n    VSID | Memory Consumption\r\n    0 | 0.255 GB\r\n[Expert8MyVxxGW:0]#\r\n```\r\n\r\n# Example 3 \r\n\r\n```\r\n[Expert8MyVxxGW:0]# vsx mstat debug\r\nVSX Memory Status\r\nMemory Total: 7940048.00 KB\r\nMemory Free: 7339864.00 KB\r\nSwap Total: 4088532.00 KB\r\nSwap Free: 4088532.00 KB\r\nSwap-in rate: 9007199254740992.00 KB\r\n    VSID | Private_Clean | Private_Dirty | DispatcherGConn | DispatcherNTab | SecureXL | DispatcherGConn6 |\r\nDispatcherNTab6 | SecureXL6\r\n```\r\n\r\nNote: To add a field to memory table please uncomment the required field (delete the leading '\\#')\r\nTo remove a field from memory table please comment out the required field (add a leading '\\#')\r\nConfiguration is done in the file /opt/CPsuite-R81.20/fw1/conf/memoryinfo.conf\r\n[Expert8MyVxxGW:0]\\#\r\n\r\n# vsx showncs \r\n\r\n## Description\r\n\r\nShows Check Point Network Configuration Script (NCS) for a Virtual Device.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx showncs {<VSID> | <Name of Virtual Device>}\r\n```\r\n\r\nImportant - On Scalable Platforms (Maestro and Chassis), you must run the applicable commands in the Expert mode on the applicable Security Group.\r\n\r\n## Parameters\r\n\r\n| Parameter | Description |\r\n| :-- | :-- |\r\n| $<$ Name of Virtual Device> | Specifies the name of the Virtual Device. |\r\n| $<$ VSID> | Specifies the ID of the Virtual Device. |\r\n\r\n## Return Values\r\n\r\n- 0 (zero) indicates that the command executed successfully.\r\n- Any other value indicates an error.\r\n\r\n# vsx sicreset \r\n\r\n## Description\r\n\r\nResets SIC for Virtual System or Virtual Router in the current VSX context.\r\n\r\n## Notes:\r\n\r\n- This operation is not supported for the context of VSX Gateway itself (VS0).\r\n- On the Management Server, run the \"cpca_client revoke_cert\" command to cancel the old certificate.\r\n- In SmartConsole, open the Virtual System object and immediately click OK. This action creates a new certificate, and transfers the certificate to the VSX Gateway.\r\n\r\n\r\n## Syntax\r\n\r\n```\r\nvsenv {<VSID> | <Name of Virtual Device>}\r\nvsx sicreset {<VSID> | <Name of Virtual Device>}\r\n```\r\n\r\nImportant - On Scalable Platforms (Maestro and Chassis), you must run the applicable commands in the Expert mode on the applicable Security Group.\r\n\r\n## Parameters\r\n\r\n| Parameter | Description |\r\n| :-- | :-- |\r\n| $<$ Name of Virtual Device> | Specifies the name of the Virtual Device. |\r\n| $<$ VSID> | Specifies the ID of the Virtual Device. |\r\n\r\n## Return Values\r\n\r\n- 0 (zero) indicates that the command executed successfully.\r\n- Any other value indicates an error.\r\n\r\n# vsx stat \r\n\r\n## Description\r\n\r\n## Shows status information for VSX Gateway.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx stat [-1] [-v] [<VSID>]\r\n```\r\n\r\nImportant - On Scalable Platforms (Maestro and Chassis), you must run the applicable commands in the Expert mode on the applicable Security Group.\r\n\r\n## Parameters\r\n\r\n| Parameter | Description |\r\n| :-- | :-- |\r\n| -1 | Shows a list of all Virtual Devices and their applicable information. |\r\n| -v | Shows a summary table with all Virtual Devices. |\r\n| $<V S I D>$ | Specifies a Virtual Device by its ID. |\r\n\r\n## Return Values\r\n\r\n- 0 (zero) indicates that the command executed successfully.\r\n- Any other value indicates an error.\r\n\r\n\r\n## Example 1 - Show a summary table with all Virtual Devices.\r\n\r\n```\r\n[Expert8MyVsxGW:2]\\# vsx stat -v\r\nVSX Gateway Status\r\nName: VSX1_192.168.3.241\r\nAccess Control Policy: VSX_Cluster_VSX\r\nInstalled at: 20Sep2019 22:06:33\r\nThreat Prevention Policy: <No Policy>\r\nSIC Status: Trust\r\nNumber of Virtual Systems allowed by license: 25\r\nVirtual Systems [active / configured]: 2 / 2\r\nVirtual Routers and Switches [active / configured]: 0 / 0\r\nTotal connections [current / limit]: S / 44700\r\nVirtual Devices Status\r\nID : Type & Name : Access Control Policy : Installed at : Threat Prevention Policy : SIC Stat\r\n    1 | S VS1 | VS_Policy | 20Sep2019 22:07 | <No Policy> | Trust\r\n2 | S VS2 | VS_Policy | 20Sep2019 22:07 | <No Policy> | Trust\r\nType: S - Virtual System, R - Virtual System in Bridge mode,\r\n    R - Virtual Router, W - Virtual Switch.\r\n[Expert8MyVsxGW:2]\\#\r\n```\r\n\r\nExample 2 - Show a list of all Virtual Devices and their applicable information.\r\n\r\n```\r\n[Expert8MyVxxGW:2]# vsx stat ~1\r\nVSID: 0\r\nVRID: 0\r\nType: VSX Gateway\r\nName: VSX1_192.168.3.241\r\nSecurity Policy: VSX_Cluster_VSX\r\nInstalled at: 20Sep2019 22:06:33\r\nSIC Status: Trust\r\nConnections number: 5\r\nConnections peak: 43\r\nConnections limit: 14900\r\nVSID: 1\r\nVRID: 1\r\nType: Virtual System\r\nName: VS1\r\nSecurity Policy: VS_Policy\r\nInstalled at: 20Sep2019 22:07:03\r\nSIC Status: Trust\r\nConnections number: 0\r\nConnections peak: 3\r\nConnections limit: 14900\r\nVSID: 2\r\nVRID: 2\r\nType: Virtual System\r\nName: VS2\r\nSecurity Policy: VS_Policy\r\nInstalled at: 20Sep2019 22:07:01\r\nSIC Status: Trust\r\nConnections number: 0\r\nConnections peak: 2\r\nConnections limit: 14900\r\n[Expert8MyVxxGW:2]#\r\n```\r\n\r\nExample 3 - Shows the information for the specified Virtual Device\r\n\r\n```\r\n[Expert8MyVxxGW:2]# vsx stat 2\r\nVSID: 2\r\nVRID: 2\r\nType: Virtual System\r\nName: VS2\r\nSecurity Policy: VS_Policy\r\nInstalled at: 20Sep2019 22:07:01\r\nSIC Status: Trust\r\nConnections number: 0\r\nConnections peak: 2\r\nConnections limit: 14900\r\n[Expert8MyVxxGW:2]#\r\n```\r\n\r\n# vsx unloadall \r\n\r\n## Description\r\n\r\nUnloads security policy for all Virtual Systems and Virtual Routers.\r\nSee sk33065: Unloading policy from a VSX Security Gateway.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx unloadall\r\n```\r\n\r\nImportant - On Scalable Platforms (Maestro and Chassis), you must run the applicable commands in the Expert mode on the applicable Security Group.\r\n\r\n## Return Values\r\n\r\n- 0 (zero) indicates that the command executed successfully.\r\n- Any other value indicates an error.\r\n\r\n# vsx vspurge \r\n\r\n## Description\r\n\r\nRemoves Virtual Devices that are no longer defined in the management database, but were not removed from the VSX Gateway, because the VSX Gateway was down or disconnected when the management server pushed the updated VSX configuration.\r\n\r\nThis command cleans all unused Virtual Devices entries (from the NCS local.vskeep) and fetches the VSX configuration file (NCS local.vskeep) again.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx vspurge [-q | -v] [-f <purge_file>]\r\n```\r\n\r\nImportant - On Scalable Platforms (Maestro and Chassis), you must run the applicable commands in the Expert mode on the applicable Security Group.\r\n\r\n## Parameters\r\n\r\n| Parameter | Description |\r\n| :-- | :-- |\r\n| $-q$ | Specifies to run in quiet mode - shows only summary information. |\r\n| $-v$ | Specifies to run in verbose mode - shows detailed information. |\r\n| $-f$ <purge <br> file> | Specifies the path and the name of the file, in which the command saves the purged <br> information. |\r\n\r\n## Return Values\r\n\r\n- 0 (zero) indicates that the command executed successfully.\r\n- Any other value indicates an error.\r\n\r\n# vsx_util \r\n\r\n## Description\r\n\r\n## Performs various VSX maintenance tasks.\r\n\r\nYou run this command from the Expert mode on the Management Server (Security Management Server, or a Main Domain Management Server on Multi-Domain Server).\r\n\r\nImportant - Before you run the vsx_util commands:\r\n\r\n- Back up the VSX environment. See sk100395: How to backup and restore VSX gateway.\r\n- You must close all SmartConsole clients. Failure to do so may result in a database lock error.\r\n\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util -h\r\nvsx_util <Command> [-s <Mgmt Server>] [-u <UserName>] [-c <Name of VSX\r\nObject>] [-m <Name of VSX Cluster Member>]\r\n```\r\n\r\nParameters\r\n\r\n| Parameter | Description |\r\n| :--: | :--: |\r\n| $-h$ | Shows the built-in usage. |\r\n| <Command> | Specifies the vsx_util sub-command. See the table below. |\r\n| -s <Mgmt Server> | Specifies the IP address or resolvable hostname of the Security Management Server, or Main Domain Management Server. |\r\n| $-u<$ UserName> | Specifies the administrator username. |\r\n| -c <Name of VSX Object> | Specifies the name of the VSX Gateway or VSX Cluster object. |\r\n| -m <Name of VSX Cluster Member> | Specifies the name of the VSX Gateway or VSX Cluster Member object. |\r\n\r\nImportant - The vsx_util command requires you to enter this information:\r\n\r\n- IP address or Hostname of the Security Management Server, or Main Domain Management Server.\r\n- Management Server Administrator user name and password.\r\n- The applicable VSX object, on which the command operates.\r\n- Most of the vsx_util sub-commands are interactive and require additional user input.\r\n\r\nThe 'vsx_util' sub-commands\r\n\r\n| Sub-command | Description |\r\n| :--: | :--: |\r\n| vsx_util add_ member | Adds a new Cluster Member to a VSX Cluster and pushes the VSX Cluster configuration to the new VSX Cluster Member. <br> See \"vsx_util add_member\" on page 240. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n| vsx_util <br> change_ <br> interfaces | Automatically replaces designated existing interfaces with new interfaces on all Virtual Devices, to which the existing interfaces connect. <br> See \"vsx_util change_interfaces\" on page 242. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n| vsx_util change_mgmt_ lp | Changes the VSX Management IP address (within the same subnet) of a VSX Gateway or VSX Cluster Member. <br> See \"vsx_util change_mgmt_ip\" on page 245. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n| vsx_util change_mgmt_ subnet | Changes (or adds) the VSX Management IP address of a VSX Gateway or VSX Cluster Member to a new subnet. <br> See \"vsx_util change_mgmt_subnet\" on page 246. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n| vsx_util change_ private_net | Changes the IP address of the Internal Communication Network in a VSX Cluster. See \"vsx_util change_private_net\" on page 247. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n| vsx_util convert_ cluster | Converts the VSX Cluster mode between High Availability (default) and Virtual System Load Sharing. <br> See \"vsx_util convert_cluster\" on page 248. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n| vsx_util downgrade | Downgrades the version of a VSX Gateway or VSX Cluster in the management database. <br> See \"vsx_util downgrade\" on page 249. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n\r\n| Sub-command | Description |\r\n| :--: | :--: |\r\n| vsx_util <br> reconfigure | Restores VSX configuration on a VSX Gateway or VSX Cluster Member. See \"vsx_util reconfigure\" on page 250. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n| vsx_util <br> remove_member | Removes a Cluster Member from a VSX Cluster. <br> See \"vsx_util remove_member\" on page 254. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n| vsx_util <br> show_ <br> interfaces | Shows configuration of selected interfaces - interface types, connections to Virtual Devices, and IP addresses. <br> See \"vsx_util show_interfaces\" on page 255. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n| vsx_util <br> upgrade | Upgrades the version of a VSX Gateway or VSX Cluster in the management database. <br> See \"vsx_util upgrade\" on page 259. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n| vsx_util <br> view_vs_conf | Shows configuration of a Virtual Device on the Management Server versus the VSX Gateway or VSX Cluster. <br> See \"vsx_util view_vs_conf\" on page 260. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n| vsx_util vsls | Shows the configuration menu for Virtual System Load Sharing - see status, redistribute, export and import configuration. <br> See \"vsx_util vsls\" on page 264. <br> You run this command from the Expert mode on the Management Server (Security Management Server, or a MainDomain Management Server on Multi-Domain Server). |\r\n\r\n# Notes \r\n\r\n- This command writes its messages to the vsx_util_YYYYMMDD_HH_MM.log file on the Management Server:\r\n- On a Security Management Server:\r\n\\$FWDIR/log/vsx_util_YYYYMMDD_HH_MM.log\r\n- On a Multi-Domain Server - if executed the command in the MDS context:\r\n/opt/CPsuite-R81.20/fw1/log/vsx_util_YYYYMMDD_HH_MM.log\r\n- On a Multi-Domain Server - if executed the command in the context of a Domain Management Server:\r\n/opt/CPmds-R81.20/customers/<Name of Domain Management\r\nServer>/CPsuite-R81.20/fw1/log/vsx_util_YYYYMMDD_HH_MM.log\r\n- If it is necessary to exit from the vsx_util command's menu, press the CTRL C keys.\r\n\r\nImportant - Do not press these keys, it this command already started to perform a change. If you press these keys during the operation, the command does not save its log file.\r\n\r\n# vsx_util add_member \r\n\r\n## Description\r\n\r\nAdds a new Cluster Member to a VSX Cluster and pushes the VSX Cluster configuration to the new VSX Cluster Member.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util add_member\r\n```\r\n\r\n\r\n## Required Input\r\n\r\n- The applicable VSX Cluster object.\r\n- Name of the new VSX Cluster Member.\r\n- IP address for the management interface.\r\n- IP address for the synchronization interface.\r\n- The one-time Activation Key (SIC activation key)\r\n\r\n# Comments \r\n\r\n- Execute the command and follow the instructions on the screen.\r\n- After the command adds a new Cluster Member to the management database, the command prompts you to reconfigure the new VSX Cluster Member (to push the VSX Cluster configuration to it).\r\n- If you enter \" $\\mathbf{y}$ \" to reconfigure the new VSX Cluster Member at this time, then the \"vsx_util reconfigure\" on page 250 operation starts automatically on the new VSX Cluster Member.\r\n\r\nImportant - You must reboot the new VSX Cluster Member after the reconfigure operation finishes.\r\n\r\n- If you enter \" $\\mathbf{n}$ \" to cancel the reconfigure operation on the new VSX Cluster Member at this time, then later you must manually run the \"vsx_util reconfigure\" on page 250 command for the new VSX Cluster Member.\r\n\r\n# vsx_util change_interfaces \r\n\r\n## Description\r\n\r\nAutomatically replaces designated existing interfaces with new interfaces on all Virtual Devices, to which the existing interfaces connect.\r\n\r\nThis command is useful when converting a deployment to use Link Aggregation, especially where VLANs connect to many Virtual Devices.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util change_interfaces\r\n```\r\n\r\n\r\n## Required Input\r\n\r\n- The applicable VSX Gateway or VSX Cluster object.\r\n- Where to apply the change (Management Server only, or Management Server and VSX Gateway / VSX Cluster Members).\r\n- Name of the interface to be replaced.\r\n- Name of the new (replacement) interface.\r\n\r\n\r\n## Comments\r\n\r\n- Execute the command and follow the instructions on the screen.\r\n- This command supports the resume feature.\r\n- You can use this command to migrate a VSX deployment from an Open Server to a Check Point appliance by using the Management Only mode.\r\n- Refer to the Notes section below for additional information.\r\n\r\n\r\n## Procedure\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| 1 | Close all SmartConsole clients that are connected to the Security Management Server or Domain Management Servers. |\r\n| 2 | Connect to the command line on the Management Server. |\r\n| 3 | Log in to the Expert mode. |\r\n| 4 | On Multi-Domain Server, go to the context of the Main Domain Management Server that manages the applicable VSX Gateway (VSX Cluster) object: |\r\n|  | mdsenv <IP address or Name of Domain Management Server> |\r\n| 5 | Run: |\r\n|  | vsx_util change_interfaces |\r\n\r\n| Stop | Instructions |\r\n| :--: | :--: |\r\n| 6 | Enter the IP address of the Security Management Server or Main Domain Management Server. |\r\n| 7 | Enter the Management Server administrator username and password. |\r\n| 8 | Select the VSX Gateway (VSX Cluster) object. |\r\n| 9 | When prompted, select one of the following options: <br> - Apply changes to the management database and to the VSX Gateway/Cluster members immediately <br> Changes the interface on the Management Server and on the VSX Gateway (each VSX Cluster Member). <br> - Apply changes to the management database only Changes the interface on the Management Server only. You must run the \"vsx_util reconfigure\" on page 250 command to push the updated VSX configuration to VSX Gateways (each VSX Cluster Member). |\r\n| 10 | Select the interface to be replaced. |\r\n| 11 | Select the new (replacement) interface. <br> a. You can optionally add a new interface, if you select the A new interface name option. This interface must physically exist on the VSX Gateway (all VSX Cluster Members). Otherwise, the operation fails. <br> b. At the prompt, enter the new interface name. If the new interface is a Bond interface, the interface name must match the name of the configured Bond interface exactly. |\r\n| 12 | The command prompts you: <br> Would you like to change another interface? (y|n) [n]: <br> - To replace additional interfaces, enter $\\mathbf{y}$. <br> - To complete the process, enter $\\mathbf{n}$. |\r\n| 13 | If you selected the option Apply changes to the management database only, you can remove the old (replaced) interfaces from the management database. When prompted, enter $\\mathbf{y}$ : <br> Would you like to remove the old interfaces from the database? (y|n) [n]: y |\r\n| 14 | Reboot the VSX Gateway (all VSX Cluster Members). |\r\n\r\n# Notes \r\n\r\n- The option \"Apply changes to the management database and to the VSX Gateway/Cluster members immediately\" verifies connectivity between the Management Server and the VSX Gateway or VSX Cluster Members. In the event of a connectivity failure one of the following actions occur:\r\n\r\n1. If all of the newly changed interfaces fail to establish connectivity, the process terminates unsuccessfully.\r\n2. If one or more interfaces successfully establish connectivity, while one or more other interfaces fail, you may optionally continue the process.\r\n\r\nIn this case, those interfaces for which connectivity was established successfully will be changed.\r\n\r\nFor those interfaces that failed, you must then resolve the issue and then run the \"vsx_util reconfigure\" on page 250 command to complete the process.\r\n\r\n- If you select the option \"Apply changes to the management database only\", you can select one of these:\r\n- Another interface from list (if any are available).\r\n- Option to add a new interface.\r\n\r\n# vsx_util change_mgmt_ip \r\n\r\n## Description\r\n\r\nChanges the VSX Management IP address of a VSX Gateway or VSX Cluster Member.\r\nThis command changes the Management IP address within the same subnet.\r\nFor more information, see sk92425.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util change_mgmt_ip\r\n```\r\n\r\n\r\n## Required Input\r\n\r\n- The applicable VSX Cluster object.\r\n- The applicable VSX Cluster Member object.\r\n- New management IP address.\r\n\r\n\r\n## Comments\r\n\r\n- Execute the command and follow the instructions on the screen.\r\n\r\n# vsx_util change_mgmt_subnet \r\n\r\n## Description\r\n\r\nChanges the VSX Management IP address of a VSX Gateway or VSX Cluster Member.\r\nThis command changes the Management IP address from the current subnet to a different subnet.\r\nFor more information, see sk92425.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util change_mgmt_subnet\r\n```\r\n\r\n\r\n## Required Input\r\n\r\n- The applicable VSX Gateway or VSX Cluster object.\r\n- New management IPv4 address.\r\n- New management IPv4 netmask.\r\n- New management IPv6 address.\r\n- New management IPv6 prefix.\r\n- New IPv4 default gateway.\r\n- New IPv6 default gateway.\r\n\r\n\r\n## Comments\r\n\r\n- Execute the command and follow the instructions on the screen.\r\n- This command updated only routes that were automatically generate.\r\n\r\nYou must remove and/or change all manually created routes that use the previous management subnet.\r\n\r\n- You must reboot the VSX Gateway (all VSX Cluster Members) after the command finishes.\r\n\r\n# vsx_util change_private_net \r\n\r\n## Description\r\n\r\nChanges the IP address of the Internal Communication Network in a VSX Cluster (cluster private network).\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util change_private_net\r\n```\r\n\r\n\r\n## Required Input\r\n\r\n- The applicable VSX Cluster object.\r\n- New IPv4 address for the cluster private network.\r\n- New IPv4 netmask for the cluster private network.\r\n- New IPv6 address and prefix for the cluster private network.\r\n\r\n\r\n## Comments\r\n\r\n- Run the command and follow the instructions on the screen.\r\n- The IP address of the Internal Communication Network must be unique.\r\n\r\nThis IP address must not be used anywhere in your environment, including the Virtual Devices on this VSX Cluster.\r\n\r\n- The illegal IPv4 addresses are: $0.0 .0 .0,127.0 .0$.0, and 255.255.255.255\r\n- For IPv4 address, the network mask must be one of these:\r\n- 255.255.0.0, or /16\r\n- 255.255.128.0, or /17\r\n- 255.255.192.0, or /18\r\n- 255.255.224.0, or /19\r\n- 255.255.240.0, or /20\r\n- 255.255.248.0, or /21\r\n- 255.255.252.0, or /22 (this is the default)\r\n- For IPv6 address, the new prefix must be /80.\r\n\r\n# vsx_util convert_cluster \r\n\r\n## Description\r\n\r\nConverts the VSX Cluster mode between High Availability (default) and Virtual System Load Sharing.\r\n\r\n## Important:\r\n\r\n- The only mode available for a VSX Cluster that was installed as R81.10 and higher is Virtual System Load Sharing (VSLS).\r\n- The High Availability mode is available only if you upgrade a VSX Cluster from R81 or lower to R81.20.\r\n\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util convert_cluster\r\n```\r\n\r\n\r\n## Required Input\r\n\r\n- The applicable VSX Cluster object.\r\n- The ClusterXL mode (case sensitive).\r\n\r\n\r\n## Comments\r\n\r\n- Execute the command and follow the instructions on the screen.\r\n- When you convert from Virtual System Load Sharing to High Availability:\r\n- All Virtual Systems are Active on the same VSX Cluster Member by default.\r\n- Peer Virtual Systems are Standby on other VSX Cluster Members.\r\n\r\n# vsx_util downgrade \r\n\r\n## Description\r\n\r\nDowngrades the version of a VSX Gateway or VSX Cluster in the management database.\r\n\r\nImportant - You can use this command only if you did not make any configuration changes after you used the \"vsx_util upgrade\" command.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util downgrade\r\n```\r\n\r\n\r\n## Required Input\r\n\r\n- The applicable VSX Gateway or VSX Cluster object.\r\n- The applicable Check Point version.\r\n\r\n\r\n## Comments\r\n\r\n- Used only to revert the upgraded VSX Gateway or VSX Cluster object.\r\n- Execute the command and follow the instructions on the screen.\r\n- To deploy the version change to the VSX Cluster Members, you must run the \"vsx'util reconfigure\" on page 250 command.\r\n\r\n# vsx_util reconfigure \r\n\r\n## Description\r\n\r\nRestores VSX configuration on a VSX Gateway or VSX Cluster Member (for example, after you perform clean install after a system failure).\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util reconfigure\r\n```\r\n\r\nImportant - Before you run this command on the Management Server, you must configure specific settings on the cleanly installed VSX Gateway or VSX Cluster Member as they were:\r\n\r\n- IP address of Gaia management interface\r\n- Enable IPv6 support in Gaia\r\n- Configure the applicable interfaces (Bond, VLAN, and so on)\r\n- Configure kernel parameters and their values:\r\n- \\$FWDIR/boot/modules/fwkern.conf\r\n- \\$FWDIR/boot/modules/vpnkern.conf\r\n- \\$PPKDIR/conf/simkern.conf\r\n- Configure CoreXL:\r\n- Number of CoreXL Firewall instances (for IPv4 and IPv6) in the context of VS0 (run the cpconfig command and select the option Check Point CoreXL)\r\n- \\$FWDIR/conf/fwaffinity.conf\r\n\r\n\r\n## Required Input\r\n\r\n- The applicable VSX Gateway or VSX Cluster object.\r\n- The one-time Activation Key (SIC activation key).\r\n\r\n\r\n## Comments\r\n\r\n- Execute the command and follow the instructions on the screen.\r\n- The new VSX Gateway or VSX Cluster Member:\r\n- Must be a new installation.\r\n\r\nYou cannot use a VSX Gateway or VSX Cluster Member with a previous VSX configuration.\r\n\r\n- Must have the same hardware specifications as the original.\r\n\r\nMost importantly, it must have at least the same number of interfaces.\r\n\r\n- Must have the same Gaia OS configuration as the original.\r\n\r\nMost importantly, it must have the same VSX Management IP address.\r\n\r\n# Limitations \r\n\r\nThe reconfigure process does not restore the local configuration that was performed on VSX Gateway or VSX Cluster Member itself (because this configuration is not stored on the Management Server).\r\n\r\nImportant - After the reconfigure process is complete and you rebooted VSX Gateway or VSX Cluster Member, you must manually configure these settings from scratch or from backed up files.\r\n\r\nThese settings and files are not restored during the reconfigure process and you must manually configure them again:\r\n\r\n- Any OS configuration (for example, DNS, NTP, DHCP, Dynamic Routing, DHCP Relay, and so on).\r\n- Backup files and Gaia snapshots saved in the past on the VSX Gateway or VSX Cluster Member.\r\n- Any settings manually defined in various configuration files on the VSX Gateway or VSX Cluster Member.\r\n- Any Check Point configuration files.\r\n\r\nNote - Some of these files do not exist by default. Some files are configured on each VSX Gateway and VSX Cluster Member, and some files are configured for each Virtual System.\r\n\r\n## List of the most important files\r\n\r\nNote - Some of these files do not exist by default. Some files are configured on each VSX Gateway and VSX Cluster Member, and some files are configured for each Virtual System.\r\n\r\n- \\$FWDIR/boot/modules/fwkern.conf\r\n- \\$FWDIR/boot/modules/vpnkern.conf\r\n- \\$FWDIR/conf/fwaffinity.conf\r\n- \\$FWDIR/conf/fwauthd.conf\r\n- \\$FWDIR/conf/local.arp\r\n- \\$FWDIR/conf/discntd.if\r\n- \\$FWDIR/conf/cpha_bond_1s_config.conf\r\n- \\$FWDIR/conf/resctrl\r\n- \\$FWDIR/conf/vsaffinity_exception.conf\r\n- \\$FWDIR/database/qos_policy.C\r\n- \\$PPKDIR/conf/simkern.conf\r\n- \\$PPKDIR/conf/sim_aff.conf\r\n- /var/ace/sdconf.rec\r\n\r\n- /var/ace/sdopts.rec\r\n- /var/ace/sdstatus. 12\r\n- /var/ace/securid\r\n\r\n# Example \r\n\r\nThis example shows how the VSX configuration is restored on a VSX Cluster Member.\r\n\r\n```\r\n[Expert8MDS:0]# vsx_util reconfigure\r\n* Note: the operation you are about to perform changes the information in the management *\r\n* database. Back up the database before continuing.\r\nEnter Security Management Server/main Domain Management Server IP address (Hit 'ENTER' for 'localhost'):\r\n192.168.3.240\r\nEnter Administrator Name: ******\r\nEnter Administrator Password: ******\r\nSelect VSX gateway/cluster object name:\r\n    1) VSX_Cluster\r\n\r\nSelect: 1\r\nSelect VSX member name to reconfigure:\r\n\r\n1) VSX1_192.168.3.241\r\n2) VSX2_192.168.3.242\r\n\r\nSelect: 1\r\nYou are about to perform reconfigure on VSX gateway/cluster, please read sk97552.\r\nAre you sure you want to continue [y/n]? y\r\nEnter Activation Key:\r\nRetype Activation Key:\r\n```\r\n\r\n```\r\n1/10 : Certificate Revocation\r\n| | | | | | |\r\n| :--: | :--: |\r\n| 2/10 : Certificate Replacement | | | | |\r\n| 3/10 : Connectivity Check | | | | |\r\n| 4/10 : Fetching Configuration | | | | |\r\n| 5/10 : Verifying Configuration | | | | |\r\n| 6/10 : Installing policy on: VSX_Cluster | | | | |\r\n| 7/10 : Converting Gateway to VSX | | | | |\r\n| 8/10 : Generating Activation Keys | | | | |\r\n| 9/10 : Reconfiguring | | | | |\r\n| 10/10 : Pushing Configuration | | | | |\r\nDatabase saved successfully.\r\n![[CP_R81.20_VSX_AdminGuide_img_47.jpeg]]\r\n\r\n# vsx_util remove_member \r\n\r\n## Description\r\n\r\nRemoves a Cluster Member from a VSX Cluster.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util remove_member\r\n```\r\n\r\n\r\n## Required Input\r\n\r\n- The applicable VSX Cluster object.\r\n- The applicable VSX Cluster Member object.\r\n\r\n\r\n## Comments\r\n\r\n- Before you run this command:\r\n- Make sure to remove (detach) the license from the VSX Cluster Member.\r\n- Make sure to run the \"cphastop\" command to avoid unexpected failover from the VSX Cluster Member.\r\n- Make sure to disconnect the VSX Cluster Member from all networks, except from the Management Server.\r\n- Execute the command and follow the instructions on the screen.\r\n\r\n# vsx_util show_interfaces \r\n\r\n## Description\r\n\r\nShows configuration of selected interfaces - interface types, connections to Virtual Devices, and IP addresses.\r\n\r\nThe command shows the information on the screen and also saves it to the interfacesconfig.csv file in the current working directory.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util show_interfaces\r\n```\r\n\r\nRequired Input\r\n\r\n- The applicable VSX Gateway or VSX Cluster object.\r\n- Which interfaces to show:\r\n\r\n| Menu Option | Description |\r\n| :-- | :-- |\r\n| 1) All Interfaces | Shows all interfaces (Physical and Warp). |\r\n| 2) All Physical Interfaces | Shows only Physical interfaces. |\r\n| 3) All Warp Interfaces | Shows only Warp interfaces. |\r\n| 4) A Specific Interface | Prompts you to enter the name of the specific interface to show. <br> Note - You cannot specify a VLAN tag as a <br> parameter. You can, however, specify an interface <br> used as a VLAN (without the tag) to see all VLAN <br> tags associated with that interface. See the example <br> below. |\r\n\r\nExample\r\n\r\n```\r\n[Expert@MGMT:0]# vsx_util show_interfaces\r\nEnter Security Management Server/main Domain Management Server IP address (Hit 'ENTER' for\r\n'localhost'): 172.16.16.240\r\nEnter Administrator Name: admin\r\nEnter Administrator Password:\r\nSelect VSX gateway/cluster object name:\r\n    1) VSX_Cluster_1\r\n    2) VSX_Cluster_2\r\n    3) VSX_OW_1\r\n    4) VSX_OW_2\r\nSelect: 1\r\nWhich interface would you like to display?\r\n    1) All Interfaces\r\n    2) All Physical Interfaces\r\n    3) All Warp Interfaces\r\n    4) A Specific Interface\r\nEnter your choice: 1\r\n--+\r\n| Type & Interface | Virtual Device Name |VSID| IP / Mask length\r\n--+\r\n|M eth0 |VSX_Cluster_1 |0 |v4 172.16.16.98/24 v6 2001:0DB8::98/64\r\n|\r\n--+\r\n|S eth1 |VSX_Cluster_1 |0 |v4 10.0.0.0/24\r\n|\r\n--+\r\n|U eth2 |VS1 |1 |v4 192.0.2.2/24 v6 2001:0DB8:c::1/64\r\n|\r\n--+\r\n|U eth3 |VS1 |1 |v4 192.168.3.3/24 v6 2001:0DB8:b::1/64\r\n|\r\n--+\r\n|A eth4 | | |\r\n|\r\n--+\r\n|U eth5 |VS2 |2 |v4 10.10.10.10/24 v6 2001:0DB8:a::1/64\r\n|\r\n--+\r\n|A eth6 | | |\r\n|\r\n--+\r\n#Type: M - Management Interface S - Synchronization Interface\r\n# V - VLAN Interface W - Warp Interface\r\n# U - Used Interface A - Available Interface\r\n# X - Unknown Interface E - Error in Interface Properties\r\nLogging details are available at /opt/CPsuite-981.20/fw1/log/vsx_util_20210625_17_45.log\r\n[Expert@MGMT:0]#\r\n[Expert@MGMT:0]# cat interfacesconfig.csv\r\nInterface Name, Type ,Virtual Device Name, VSID , IPv4 Address, IPv4 mask length, IPv6 Address, IPv6 mask length\r\n```\r\n\r\n```\r\neth0,M,VSX_Cluster_1,0,172.16.16.98,24,2001:0DB8::98,64\r\neth1,S,VSX_Cluster_1,0,10.0.0.0,24,,\r\neth2,U,VS1,192.0.2.2,24,2001:0DB8:c::1,64\r\neth3,U,VS1,192.168.3.3,24,2001:0DB8:b::1,64\r\neth4,A\r\neth5,U,VS2,10.10.10.10,24,2001:0DB8:a::1,64\r\neth6,A\r\n#Type: M - Management Interface S - Synchronization Interface\r\n# V - VLAN Interface W - Warp Interface\r\n# U - Used Interface A - Available Interface\r\n# X - Unknown Interface E - Error in Interface Properties\r\n[Expert@MGMT:0]#\r\n```\r\n\r\n# vsx_util upgrade \r\n\r\n## Description\r\n\r\nUpgrades the version of a VSX Gateway or VSX Cluster in the management database.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util upgrade\r\n```\r\n\r\n\r\n## Required Input\r\n\r\n- The applicable VSX Gateway or VSX Cluster object.\r\n- The applicable Check Point version.\r\n\r\n\r\n## Comments\r\n\r\n- Execute the command and follow the instructions on the screen.\r\n- After the command finishes, you must run the \"vsx_util reconfigure\" on page 250 command.\r\n- To revert this upgrade, run the \"vsx_util downgrade\" on page 249 command.\r\n\r\n# vsx_util view_vs_conf \r\n\r\n## Description\r\n\r\nCompares the configuration of all Virtual Devices on the Management Server and the actual configuration on the VSX Gateway or VSX Cluster Members.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util view_vs_conf\r\n```\r\n\r\n\r\n## Required Input\r\n\r\n- The applicable VSX Gateway or VSX Cluster object.\r\n- The applicable Virtual Device object.\r\n\r\nExample\r\n\r\n```\r\n[Expert@MGMT:0]# vsx_util show_interfaces\r\nEnter Security Management Server/main Domain Management Server IP address (Hit 'ENTER' for\r\n'localhost'): 172.16.16.240\r\nEnter Administrator Name: admin\r\nEnter Administrator Password:\r\nSelect VSX gateway/cluster object name:\r\n    1) VSX_Cluster_1\r\n    2) VSX_Cluster_2\r\n    3) VSX_GW\r\n    4) VSX_GW_2\r\nSelect: 1\r\nSelect Virtual Device object name:\r\n    1) VS1\r\n    2) VS2\r\n    3) VS3\r\n    4) VSX_Cluster\r\nSelect: 1\r\nType: Virtual System\r\nInterfaces configuration table:\r\n|Interfaces\r\n|Name |IP / Mask length\r\n| |mem 1 |mem2 |\r\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\r\n| |eth2 | |v4 10.0.0.0/24 v6 2001:db8::abc::1/64 | V | V | V |\r\n| |eth3 | |v4 10.10.10.10/24 v6 2001:db8::3121/64 | V | V | V |\r\n\r\n```\r\nInterfaces Table Legend:\r\n    V - Interface exists on the gateway and matches management information (if defined on the\r\nmanagement).\r\n    -     - Interface does not exist on the gateway.\r\n    N/A - Fetching Virtual Device configuration from the gateway failed.\r\n    !IP - Interface exists on the gateway, but there is an IP address mismatch.\r\n    !MASK - Interface exists on the gateway, but there is a Net Mask mismatch.\r\nRouting table:\r\n|Ipv4 Routes\r\n|Destination / Mask Length |Gateway\r\n|2.2.2.0/24\r\n| 2.3.3.0/24\r\n| Ipv6 Routes\r\n|Destination / Mask Length |Gateway\r\n|2001:db8::abc::/64\r\n|2001:db8::abc::/64\r\n|Destination / Mask Length |Gateway\r\n|2001:db8::abc::/64\r\n| 2001:db8::abc::/64\r\n| 2001:db8::abc::/64\r\n| 1\r\n|Ipv6 Routes\r\n|Destination / Mask Length |Gateway\r\n| 1\r\n|1\r\n|IP - Interface\r\n|IP - Interface\r\n| |mem1 |mem2 |\r\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\r\n\r\n```\r\n|2001:db8::fd9a:0:1:0/112 | |eth3 | - | V | V |\r\n+---------------------------------+---------------+--------+------+-------+\r\n```\r\n\r\nRouting Table Legend:\r\n\r\n```\r\nV - Route exists on the gateway and matches management information (if defined on the\r\nmanagement).\r\n-     - Route does not exist on the gateway.\r\nN/A - Fetching Virtual Device configuration from the gateway failed.\r\n!NH - Route exists on the gateway, but there is a Next Hop mismatch.\r\nNote: Routes can be created automatically on the gateways by the Operating System.\r\nTherefore, routes that appear on all gateways, but are not defined on the management,\r\ndo not necessarily indicate a problem.\r\nLogging details are available at /opt/CPsuite-R81.20/fw1/log/vsx_util_20210625_18_11.log\r\n[Expert@MGMT:0]#\r\n```\r\n\r\n# vsx_util vsls \r\n\r\n## Description\r\n\r\nShows the configuration menu for Virtual System Load Sharing - status, redistribute, export, and import of configuration.\r\n\r\nImportant - The only mode available for a VSX Cluster that was installed as R81.10 and higher is Virtual System Load Sharing (VSLS).\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_util vsls\r\n```\r\n\r\n\r\n## Required Input\r\n\r\n- The applicable VSX Cluster object.\r\n- The applicable redistribution option.\r\n\r\n\r\n## Comments\r\n\r\n- Execute the command and follow the instructions on the screen.\r\n- If the command output shows \"Operation not allowed. Object is not a Virtual System Load Sharing cluster.\", then run the \"vsx_util convert_cluster\" on page 248 command.\r\n\r\n\r\n## Example\r\n\r\n```\r\n[Expert8MORT:0]# vsx_util vsls\r\nEnter Security Management Server/main Domain Management Server IP address (Hit 'ENTER' for 'localhost'):\r\n172,16,16,240\r\nEnter Administrator Name: admin\r\nEnter Administrator Password:\r\nSelect VSX gateway/cluster object name:\r\n    1) VSX_Cluster_1\r\n    2) VSX_Cluster_2\r\n    3) VSX_GW_1\r\n    4) VSX_GW_2\r\nSelect: 1\r\n```\r\n\r\nVS Load Sharing - Menu\r\n\r\n[^0]\r\n[^0]:    1. Display current VS Load sharing configuration\r\n    2. Distribute all Virtual Systems so that each cluster member is equally loaded\r\n    3. Set all VSes active on one member\r\n    4. Manually set priority and weight\r\n    5. Toggle VSLS mode between Active Up and Primary Up\r\n    6. Import configuration from a file\r\n    7. Export configuration to a file\r\n    8. Exit\r\n    Enter redistribution option (1-8) [1]:\r\n\r\n# vsx_provisioning_tool \r\n\r\nThis section describes the VSX Provisioning Tool (the vsx_provisioning_tool command).\r\n\r\n## Description\r\n\r\nThis tool allows the VSX administrator to add and remove Virtual Devices (Virtual Systems, Virtual Routers, Virtual Switches), interfaces and routes from the command line of a Security Management Server or Domain Management Server.\r\n\r\nThis allows the automation of the required VSX Provisioning operations in the environment.\r\n\r\n## Syntax\r\n\r\n```\r\nvsx_provisioning_tool -h\r\nvsx_provisioning_tool [-s <Mgmt Server>] {-u <Username> | -c <Certificate>}\r\n-p <Password>\r\n    -o <Commands> [-a] -L\r\n    -f <Input File> [-l <Line>] [-a] -L\r\n```\r\n\r\nParameters\r\n\r\n| Parameter | Description |\r\n| :--: | :--: |\r\n| $-h$ | Shows the built-in usage. |\r\n| $-s<M g m t$ <br> Server> | Specifies the Security Management Server or the applicable Domain Management Server. <br> Enter the IPv4 or IPv6 address, or the resolvable hostname name. <br> This parameter is mandatory when you run the tool: <br> - From a SmartConsole computer <br> - On a Multi-Domain Server. |\r\n| $-u<$ Username> | Specifies the Management Server administrator's user name. |\r\n| $-c$ <br> <Certificate> | Specifies the path and the name for the Management Server administrator's certificate file. |\r\n| $-p<$ Password> | Specifies the password of the: <br> - Management Server administrator <br> - Certificate file |\r\n| $-o<$ Commands> | Executes the commands you enter on the command line. See \"vsx_provisioning_tool Commands\" on page 269. |\r\n\r\n| Parameter | Description |\r\n| :--: | :--: |\r\n| $-f<$ Input File> | Specifies the path and the name for the file with the commands to execute. The tool treats all text begins with a hash sign (\\#) as a comment and ignores it. This way you can add comments on separate lines, or in-line. See: <br> - \"Transactions\" on page 268 <br> - \"vsx_provisioning_tool Commands\" on page 269 |\r\n| $-1<$ Line> | Specifies the line number in <Input File>, from which to start to execute the commands. <br> You can use this \"-1\" parameter only together with the \"-f\" parameter. |\r\n| $-a$ | Specifies that before the tool executes the specified commands, it must make sure it can connect to all VSX Gateways. <br> Note - This does not guarantee that a VSX Gateway can successfully apply all the specified commands. |\r\n| $-L$ | Specifies local authentication mode. |\r\n\r\n# Exit Codes \r\n\r\nExit Code Description\r\n\r\n0\r\nThe tool successfully applied all changes, on all VSX Cluster Members.\r\n1\r\nThe tool successfully applied all changes to the management database, but not to all VSX Cluster Members.\r\n\r\n2\r\nThe tool successfully applied all changes, but SIC communication failed to establish with at least one VSX Cluster Member.\r\n\r\n3\r\nConnectivity test failed with at least one VSX Cluster Member (if you used the \"-a\" parameter).\r\nThe tool did not apply changes to the management database, or to the VSX Cluster Member.\r\n4\r\nThe tool failed to apply changes (due to internal error, syntax error, or another reason).\r\n\r\nNote - If commands are executed from a file with multiple transactions, the exit code refers to the last transaction processed.\r\n\r\n## Example 1\r\n\r\nRun the tool on the Security Management Server.\r\nExecute the commands from the text / var/log/vsx.txt file.\r\n\r\n[^0]\r\n[^0]:    vsx_provisioning_tool -a localhost -u admin -p eppassword -f /var/log/vsx.txt\r\n\r\n# Example 2 \r\n\r\nRun the tool on the Multi-Domain Server in the context of the Domain Management Server called MyDomain.\r\n\r\nCreate a new Virtual System object called VS1 on the VSX Cluster object called VSXCluster1\r\nIn the new Virtual System object, on the interface eth4, add a VLAN interface with VLAN ID 100 and IPv4 address 1.1.1.1/24.\r\n<d>www.MyDomain\r\nvsx_provisioning_tool -e localhost -u admin -p mpssmeord -o add vd name VS1 vsx VSXCluster1, add interface name eth4.100 ip 1.1.1.1/24\r\n\r\n# Transactions \r\n\r\n## Notes:\r\n\r\n- A transaction is a set of operations performed on one Virtual Device.\r\n- The utility commits all operations to the management database together when the transaction ends.\r\nIf the transaction fails, the utility discards all its commands.\r\n- You must specify the name of the Virtual Device with a parameter in the first command.\r\nYou do not need to specify this name again in other commands of the same transaction.\r\n- You cannot send operations to different Virtual Devices in one transaction.\r\n- You cannot start a new transaction until you exit the one before.\r\n- When you send commands with the \" - \" parameter, you can enter multiple commands (for example: add a Virtual System and then add interfaces and routes to it).\r\nSeparate the commands with a comma ( , ).\r\nAll the commands are one transaction.\r\nThe \" - \" parameter does not support explicit transaction commands.\r\n- When you send commands with the \"- $\\ddagger$ \" parameter, you can use explicit transaction commands (see \"vsx_provisioning_tool Commands\" on page 269).\r\n- Commands from a file can be one or more transactions:\r\n- If not inside a transaction, the current line is one transaction, which the utility automatically commits.\r\nYou can write multiple commands in one line (as one transaction), separated with a comma ( , ).\r\n- If currently inside a transaction, the utility processes the lines, but does not take action until the transaction ends.\r\n\r\n# vsx_provisioning_tool Commands \r\n\r\nAll vsx_provisioning_tool commands are pairs of a key and a value.\r\nThe first two words in each command must appear in the correct order.\r\nOther pairs can be written in any order.\r\n\r\n# Explicit Transaction Commands \r\n\r\n| Operation | Command Syntax |\r\n| :-- | :-- |\r\n| Begin a new transaction | transaction begin |\r\n| End a transaction | transaction end |\r\n| Cancel a transaction | transaction cancel |\r\n\r\nNote - SIC with the Virtual System is established automatically. If it fails, operations continue, and the transaction returns error code 2.\r\n\r\n# Adding a VSX Gateway \r\n\r\n## Description\r\n\r\nThis command adds a new VSX Gateway object.\r\n\r\n## Syntax\r\n\r\n```\r\nadd vsx type gateway name <Name of VSX Gateway Object> version <Version>\r\nmain_ip <Main IPv4 Address> main_ip6 <Main IPv6 Address> sic_otp\r\n<Activation Key> [rule_snmp {enable | disable}] [rule_ssh {enable |\r\ndisable}] [rule_ping {enable | disable} [rule_ping6 {enable | disable] ] [rule_http {enable | disable}]\r\n```\r\n\r\nNote - In this transaction, you can only add the \"set physical interface\" command.\r\n\r\nParameters\r\n\r\n|  |  |  |\r\n| :--: | :--: | :--: |\r\n| type | gateway | You must use the value \"gateway\" to add a new VSX Gateway object. |\r\n| name <Name of VSX Gateway Object> | Object name | Defines the name of the VSX Gateway object. You cannot use spaces of Check Point reserved words. |\r\n| version <Version> | Check Point version | Defines the Check Point version of the VSX Gateway object. <br> You must enter the exact version as appears in SmartConsole (case-sensitive). |\r\n| main_ip <Main IPv4 Address> | IPv4 Address | Defines the main IPv4 Address of the VSX Gateway object. |\r\n| main_ip6 <Main IPv6 Address> | IPv6 Address | Defines the main IPv6 Address of the VSX Gateway object. |\r\n| sic_otp <Activation Key> | SIC password | You must enter the same Activation Key you entered during the First Time Configuration Wizard of the VSX Gateway. |\r\n| rule_snmp \\{enable | - enable <br> - disable | Controls how to process all SNMP packets sent to the VSX Gateway: <br> - enable - Allows all SNMP packets <br> - disable - Drops all SNMP packets (default) |\r\n\r\n|  |  |  |\r\n| :--: | :--: | :--: |\r\n| rule_ssh \\{enable \\| disable \\} | - enable <br> - disable | Controls how to process all SSH packets sent to the VSX Gateway: <br> - enable - Allows all SSH packets <br> - disable - Drops all SSH packets (default) |\r\n| rule_ping \\{enable \\| disable \\} | - enable <br> - disable | Controls how to process all ICMP Echo Request (ping) packets sent to the VSX Gateway: <br> - enable - Allows all IPv4 ping packets <br> - disable - Drops all IPv4 ping packets (default) |\r\n| rule_ping6 <br> \\{enable \\| <br> disable \\} | - enable <br> - disable | Controls how to process all ICMPv6 Echo Request (ping) packets sent to the VSX Gateway: <br> - enable - Allows all IPv6 ping packets <br> - disable - Drops all IPv6 ping packets (default) |\r\n| rule_https <br> \\{enable \\| <br> disable \\} | - enable <br> - disable | Controls how to process all HTTPS packets sent to the VSX Gateway: <br> - enable - Allows all HTTPS packets <br> - disable - Drops all HTTPS packets (default) |\r\n| rule_drop \\{enable \\| disable \\} | - enable <br> - disable | Controls how to process all packets (other than SNMP, SSH, ICMP, ICMPv6, HTTPS) sent to the VSX Gateway: <br> - enable - Drops all other packets (default) <br> - disable - Allows all other packets |\r\n\r\n# Example \r\n\r\n[^0]\r\n[^0]:    vas_provisioning_too] -e localhost -u admin -p mppassword -o add vas name VSX_001 type gateway main_ip 192.168.20.1 version 881.20 sic_otp ABCDEFG rule_ssh enable rule_ping enable\r\n\r\n# Adding a VSX Cluster \r\n\r\n## Description\r\n\r\nThis command adds a new VSX Cluster object.\r\n\r\n## Syntax\r\n\r\n```\r\nadd vsx type cluster name <Name of VSX Cluster Object> version <Version>\r\nmain_ip <Main Virtual IPv4 Address> main_ip6 <Main Virtual IPv6 Address>\r\ncluster_type {vsls | ha | crbm} sync_if_name <Name of Sync Interface> sync_\r\nnetmask <Sync Interface Netmask> [rule_snmp {enable | disable}] [rule_ssh\r\n{enable | disable}] [rule_ping {enable | disable} [rule_ping6 {enable |\r\ndisable}] [rule_https {enable | disable}] [rule_drop {enable | disable}]\r\n```\r\n\r\nImportant - You must run the \"add vsx member\" command for each VSX Cluster Member in the same transaction as the \"add vsx type cluster name\" command.\r\n\r\n## Parameters\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| type | cluster | You must use the value \"cluster\" to add a new VSX Cluster object. |\r\n| name <Name of VSX Cluster Object> | Object name | Defines the name of the VSX Cluster object. You cannot use spaces of Check Point reserved words. |\r\n| version <Version> | Check Point version | Defines the Check Point version of the VSX Cluster object. <br> You must enter the exact version as appears in SmartConsole (case-sensitive). |\r\n| main_ip <Main <br> Virtual IPv4 <br> Address> | IPv4 Address | Defines the main IPv4 Virtual Address of the VSX Cluster object. |\r\n| main_ip6 <Main <br> Virtual IPv6 <br> Address> | IPv6 Address | Defines the main IPv6 Virtual Address of the VSX Cluster object. |\r\n| cluster_type \\{vsls | ha | crbm\\} | Cluster type | Defines the cluster type. <br> Enter one of these: <br> - vsls - Virtual System Load Sharing mode <br> - ha - High Availability mode <br> - crbm - X-Series appliances (former BlueCoat / Crossbeam) |\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| sync_if_name <Name of Sync Interface> | Sync interface name | Defines the name of the Cluster Synchronization interface. |\r\n| sync_netmask <Sync Interface Netmask> | IPv4 Network mask | Defines an IPv4 Netmask for the Cluster Synchronization interface (in a dot-quad format X.X.X.X). |\r\n| rule_snmp \\{enable \\| disable\\} | - enable <br> - disable | Controls how to process all SNMP packets sent to the VSX Cluster Members: <br> - enable - Allows all SNMP packets <br> - disable - Drops all SNMP packets (default) |\r\n| rule_ssh \\{enable \\| disable\\} | - enable <br> - disable | Controls how to process all SSH packets sent to the VSX Cluster Members: <br> - enable - Allows all SSH packets <br> - disable - Drops all SSH packets (default) |\r\n| rule_ping \\{enable \\| disable\\} | - enable <br> - disable | Controls how to process all ICMP Echo Request (ping) packets sent to the VSX Cluster Members: <br> - enable - Allows all IPv4 ping packets <br> - disable - Drops all IPv4 ping packets (default) |\r\n| rule_ping6 \\{enable \\| disable\\} | - enable <br> - disable | Controls how to process all ICMPv6 Echo Request (ping) packets sent to the VSX Cluster Members: <br> - enable - Allows all IPv6 ping packets <br> - disable - Drops all IPv6 ping packets (default) |\r\n| rule_https \\{enable \\| disable\\} | - enable <br> - disable | Controls how to process all HTTPS packets sent to the VSX Cluster Members: <br> - enable - Allows all HTTPS packets <br> - disable - Drops all HTTPS packets (default) |\r\n| rule_drop \\{enable \\| disable\\} | - enable <br> - disable | Controls how to process all packets (other than SNMP, SSH, ICMP, ICMPv6, HTTPS) sent to the VSX Cluster Members: <br> - enable - Drops all other packets (default) <br> - disable - Allows all other packets |\r\n\r\n# Example \r\n\r\n[^0]\r\n[^0]:    use_provisioning_tool -e localhost -o admin -p mppassword -o add vax name VSM1 type cluster cluster_type vais mais_ip 192.166.1.1 version 981.20 sync_if_name\r\n    ath3 sync_netmask 255.255.255.0 rule_ssh enable rule_ping enable\r\n\r\n# Adding a Virtual Device \r\n\r\n## Description\r\n\r\nThis command adds a new Virtual Device object:\r\n\r\n- Virtual System\r\n- Virtual System in Bridge Mode\r\n- Virtual Switch\r\n- Virtual Router\r\n\r\n\r\n## Syntax\r\n\r\nadd vd name <Name of Virtual Device Object> vsx <Name of VSX Gateway or VSX Cluster Object > [type \\{vs | vsbm | vsw | vr\\}] [vs_mtu <MTU>] [instances <Number of IPv4 CoreXL Firewall instances>] [instances6 <Number of IPv6 CoreXL Firewall instances>] [main_ip <Main IPv4 Address>] [main_ip6 <Main IPv6 Address>] [calc_topo_auto \\{true | false\\}]\r\n\r\nParameters\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| name <Name of Virtual Device Object> | Object name | Defines the name of the Virtual Device object. Mandatory parameter, if this is the first command in a transaction. |\r\n| vsx <Name of VSX Gateway or VSX Cluster Object > | Parent object name | Defines the name of the applicable VSX Gateway or VSX Cluster object, in which you create this Virtual Device. <br> You cannot use spaces or Check Point reserved words. <br> Mandatory parameter. |\r\n| type \\{vs | vsbm | vsw | <br> Vry | Type of Virtual Device | Defines the type of the Virtual Device: <br> - vs - Virtual System (default) <br> - vsbm - Virtual System in Bridge Mode <br> - vsw - Virtual Switch <br> - vr - Virtual Router |\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| vs_mtu $<$ MTU> | Integer | Defines the Global MTU value for all interfaces. This parameter is applicable only for a: <br> - Virtual System in Bridge Mode (type vsbm) <br> - Virtual Switch (type vsw) <br> Default is 1500 bytes <br> Note - For a Virtual Switch, if you do not add a VLAN or physical interface in the same transaction, the utility ignores this value. |\r\n| instances <Number of IPv4 CoreXL Firewall instances> | Integer | Defines the number of IPv4 CoreXL Firewall instances. <br> This parameter is applicable only for a: <br> - Virtual System (type vs) <br> - Virtual System in Bridge Mode (type vsbm) <br> Default is 1 . <br> For more information about CoreXL, see R81.20 <br> Performance Tuning Administration Guide |\r\n| instances6 <Number of IPv6 CoreXL Firewall instances> | Integer | Defines the number of IPv6 CoreXL Firewall instances. <br> This parameter is applicable only for a: <br> - Virtual System (type vs) <br> - Virtual System in Bridge Mode (type vsbm) <br> Default is 1 . <br> For more information about CoreXL, see R81.20 <br> Performance Tuning Administration Guide |\r\n| main_ip <Main IPv4 Address> | IPv4 Address | Defines the main IPv4 Address of the Virtual Device object. <br> This parameter is applicable only for a: <br> - Virtual System (type vs) <br> - Virtual Router (type vr) <br> Note - If you do not specify this value explicitly, the utility uses the IPv4 address of the first interface added to the new device. |\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| main_ip6 <Main IPv6 Address> | IPv6 Address | Defines the main IPv6 Address of the Virtual Device object. <br> This parameter is applicable only for a: <br> - Virtual System (type vs) <br> - Virtual Router (type vr) <br> Note - If you do not specify this value explicitly, the utility uses the IPv6 address of the first interface added to the new device. |\r\n| calc_topo_auto \\{true | false\\} | Defines how to calculate topology based on routes: <br> - true - Automatically calculate topology based on routes (default) <br> - false - Does not calculate topology based on routes (administrator can configure it manually) <br> This parameter is applicable only for a: <br> - Virtual System (type vs) <br> - Virtual Router (type vr) |\r\n\r\n# Example - Adding a Virtual Switch \"VirtSwitch1\" to the VSX Gateway \"VSX_GW1\" \r\n\r\n[^0]\r\n[^0]:    vas_promisioning_tool -s localhost: va admin vp mpasssaccd va add vd name VirtSwitch1: vas VSX_GW1 type vAs\r\n\r\n# Deleting a Virtual Device \r\n\r\n## Description\r\n\r\nThis command deletes a Virtual Device object:\r\n\r\n- Virtual System\r\n- Virtual System in Bridge Mode\r\n- Virtual Switch\r\n- Virtual Router\r\n\r\nYou cannot delete a Virtual Device if:\r\n\r\n- It is referenced by a policy rule.\r\n- It is referenced by other objects.\r\n- It is enabled for global use in a Multi-Domain Security Management environment.\r\n\r\nImportant - After you delete a Virtual Device, you cannot have more commands in the same transaction.\r\n\r\n## Syntax\r\n\r\nremove vd name <Name of Virtual Device Object>\r\n\r\n## Parameters\r\n\r\n| Parameter | Value | Notes |\r\n| :-- | :-- | :-- |\r\n| name <Name of Virtual Device <br> Object> | Object <br> name | Specifies the name of the Virtual Device object. <br> Mandatory parameter, if this is the first command <br> in a transaction. |\r\n\r\n## Example\r\n\r\n[^0]\r\n[^0]:    use_promisioning_tool -c localhost -u admin -p mppasement -e remome vd name Victimization\r\n\r\n# Modifying Settings of a Virtual Device \r\n\r\n## Description\r\n\r\nThis command changes the settings of an existing Virtual Device object:\r\n\r\n- Virtual System\r\n- Virtual System in Bridge Mode\r\n- Virtual Switch\r\n- Virtual Router\r\n\r\n\r\n## Syntax\r\n\r\nset vd name <Name of Virtual Device Object> [vs_mtu <MTU>] [instances <Number of IPv4 CoreXL Firewall instances>] [instances6 <Number of IPv6 CoreXL Firewall instances>] [main_ip <Main IPv4 Address>] [main_ip6 <Main IPv6 Address>] [calc_topo_auto \\{true | false\\}]\r\n\r\nParameters\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| name <Name of Virtual Device Object> | Object name | Specifies the name of the Virtual Device object. <br> Mandatory parameter, if this is the first command in a transaction. |\r\n| vs_mtu <MTU> | Integer | Specifies the Global MTU value for all interfaces. <br> This parameter is applicable only for a: <br> - Virtual System in Bridge Mode <br> - Virtual Switch <br> Default is 1500 bytes. |\r\n| instances <Number of IPv4 CoreXL Firewall instances> | Integer | Specifies the number of IPv4 CoreXL Firewall instances. <br> This parameter is applicable only for a: <br> - Virtual System <br> - Virtual System in Bridge Mode <br> Default is 1. <br> For more information about CoreXL, see R81.20 Performance Tuning Administration Guide. |\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| $\\begin{aligned} & \\text { instances6 <Number of IPv6 } \\\\ & \\text { CoreXL Firewall instances> } \\end{aligned}$ | Integer | Specifies the number of IPv6 CoreXL Firewall instances. <br> This parameter is applicable only for a: <br> - Virtual System <br> - Virtual System in Bridge Mode <br> Default is 1 . <br> For more information about CoreXL, see R81.20 Performance Tuning Administration Guide. |\r\n| main_ip <Main IPv4 Address> | IPv4 Address | Specifies the main IPv4 Address of the Virtual Device object. <br> This parameter is applicable only for a: <br> - Virtual System <br> - Virtual Router |\r\n| main_ip6 <Main IPv6 Address> | IPv6 Address | ```    \\ IPv6 Address``` |\r\n| calc_topo_auto \\{true | false\\} | ```    - true - false``` | Specifies how to calculate topology based on routes: <br> - true - Automatically calculate topology based on routes (default) <br> - false - Does not calculate topology based on routes (administrator can configure it manually) <br> This parameter is applicable only for a: <br> - Virtual System <br> - Virtual Router |\r\n\r\n# Example \r\n\r\n[^0]\r\n[^0]:    use_provisioning_anoi vd installpost vd admin vp mppammed vd aset vd name VS1 instatstme 8 make_ip 192.0.2.6 main_topo_auto false\r\n\r\n# Adding a Physical or VLAN Interface to a Virtual Device \r\n\r\n## Description\r\n\r\nThis command adds an interface to an existing Virtual Device object:\r\n\r\n- Virtual System\r\n- Virtual System in Bridge Mode\r\n- Virtual Switch\r\n- Virtual Router\r\n\r\n\r\n## Syntax\r\n\r\n```\r\nadd interface vd <Name of Virtual Device Object> {name <Name of Interface>\r\n| leads_to <Name of VSW or VR Object>} ip <IPv4 Address>{/<IPv4 Prefix\r\nLength> | netmask <IPv4 Netmask> | prefix <IPv4 Prefix>} ip6 <IPv6 Address>\r\n{/<IPv6 Prefix Length> | netmask6 <IPv6 Netmask> | prefix6 <IPv6 Prefix>}\r\n[propagate {true | false}] [propagate6 {true | false}] [topology {external\r\n| internal_undefined | internal_this_network | internal_specific [specific_\r\ngroup <Name of Network Group Object>]}] [mtu <MTU>]\r\n```\r\n\r\nParameters\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| vd <Name of <br> Virtual <br> Device <br> Object> | Object name | Specifies the name of the Virtual Device object. <br> Mandatory parameter, if this is the first command in a transaction. |\r\n| name <Name <br> of <br> Interface> | Interface name | Specifies the name of the physical or VLAN interface. |\r\n| leads_to <br> <Name of <br> VSW or VR <br> Object> | Object name | ```Note - You must use the \"name\" or \"leads_to\" parameter, but not both.``` |\r\n|  |  | Specifies the name of the Virtual Switch or Virtual Router object, to which this interface connects. This parameter is applicable only for a Virtual System. |\r\n|  |  | Note - You must use the \"name\" or \"leads_to\" parameter, but not both. |\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| ip <IPv4 <br> Address> \\{/<IPv4 <br> Prefix> \\} <br> netmask <br> <IPv4 <br> Netmask> \\} <br> prefix <br> <IPv4 <br> Prefix>\\} | IPv4 configuration | Specifies the IPv4 settings: <br> - <IPv4 Address> - IPv4 address <br> - <IPv4 Prefix> - Integer between 1 and 32 <br> - <IPv4 Netmask> - Number in a format X.X.X.X <br> This parameter is applicable only for a: <br> - Virtual System <br> - Virtual Router |\r\n| ip6 <IPv6 <br> Address> \\{/<IPv6 <br> Prefix> \\} <br> netmask6 <br> <IPv6 <br> Netmask> \\} <br> prefix6 <br> <IPv6 <br> Prefix>\\} | IPv6 configuration | ```Specifies the IPv6 settings: <br> - <IPv6 Address> - IPv6 address <br> - <IPv6 Prefix> - Integer between 64 and 128 <br> - <IPv6 Netmask> - Number in a format XXXX:XXXX:XXXX:XXXX:XXXX:XXXX``` |\r\n| propagate <br> \\{true \\} <br> false \\} | - true <br> - false | This parameter is applicable only for a: <br> - Virtual System <br> - Virtual Router |\r\n|  |  | For interfaces on a Virtual System that connect to a Virtual Router, you must use the possible maximum for the IPv6 address family: <br> - Netmask <br> FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF <br> - Prefix 128 |\r\n|  |  | Controls how to propagate the IPv4 routes to adjacent Virtual Devices: <br> - true - Propagate the IPv4 routes <br> - false - Do not propagate the IPv4 routes (default) |\r\n|  |  | Note - This parameter is applicable only for a Virtual System with VLAN or physical interfaces. |\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| propagate6 (true \\| false \\} | - true <br> - false | Controls how to propagate the IPv6 routes to adjacent Virtual Devices: <br> - true - Propagate the IPv6 routes <br> - false - Do not propagate the IPv6 routes (default) |\r\n| topology \\{external | internal | Specifies the Topology configuration of the interface: <br> - external - External interface. <br> - internal_undefined - Internal_ <br> this_ <br> network <br> - internal_ specific | - external - External interface. <br> - internal_undefined - Internal interface with undefined topology. This is the default for a Virtual System in Bridge Mode. <br> - internal_this_network - Internal interface. This is the default for a Virtual System and Virtual Router. Virtual System in Bridge Mode does not support this topology. <br> - internal_specific [specific_group <Name of Network Group Object>] - Internal interface with topology defined by the specified Network Group object. <br> This parameter is applicable only for a: <br> - Virtual System <br> - Virtual System in Bridge Mode <br> - Virtual Router |\r\n| specific_ <br> group <br> <Network <br> Group <br> Object <br> Name> | Name of Network Group Object | If you specified the \"topology internal_specific\" parameter, then specify the name of the Network Group object that contains the applicable Network objects. <br> Note - This parameter is applicable only if you disable the automatic topology calculation with the \"set vd ... calc_topo_auto false\" command (see \"Modifying Settings of a Virtual Device\" on page 279). |\r\n| $\\operatorname{mtu}<\\operatorname{MTU}>$ | Integer | Specifies the MTU value for this interface. Default is 1500 bytes. <br> This parameter is applicable only for a: <br> - Virtual System <br> - Virtual Router |\r\n\r\nExample - Add VLAN interface eth4.100 with IPv4 1.1.1.1/24 to the Virtual System 'VirtSystem1'\r\n\r\n[^0]\r\n[^0]:   }+_p@11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111\r\n\r\n# Adding a Bridge Interface to a Virtual System \r\n\r\n## Description\r\n\r\nSome Software Blades and features are not supported on a Virtual System in Bridge Mode, because it may not have an IP address.\r\n\r\nFor example: Threat Emulation, Identity Awareness, Identity Awareness Captive Portal, and UserCheck Portal are not supported.\r\n\r\nThis command adds a Bridge interface to an existing regular Virtual System object that always has an IP address.\r\n\r\nAs a result, the Virtual System can support these Software Blades and features for the traffic that passes over the configured bridge interface.\r\n\r\n## Notes:\r\n\r\n- Names of bridge interfaces have a template \"brx\", where \"x\" is a digit.\r\n- It is necessary to add subordinate interfaces in pairs to a bridge interface.\r\n- To see the bridge interfaces you configured in the Virtual System object:\r\n\r\n1. Connect to the command line on the VSX Gateway (each VSX Cluster Member).\r\n2. Log in to the Expert mode.\r\n3. Go to the context of the Virtual System:\r\n```\r\nvsenv <VSID>\r\n```\r\n\r\n4. Examine the list of interfaces:\r\nifconfig\r\n\r\n- You can delete bridge interfaces from a Virtual System either in SmartConsole, or with the \"vsx_provisioning_tool\" command (see \"Removing an Interface from a Virtual Device\" on page 288).\r\n\r\n\r\n## Syntax\r\n\r\nattach bridge vd <Name of Virtual System Object> ifs1 <Name of First Subordinate Interface> ifs2 <Name of Second Subordinate Interface>\r\n\r\n## Parameters\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| vd <Name of Virtual <br> System Object> | Object <br> name | Specifies the name of the Virtual System object. <br> Mandatory parameter, if this is the first command in a transaction. |\r\n| ifs1 <Name of First <br> Slave Interface> | Interface <br> name | Specifies the name of the physical interface to be the first subordinate interface of a bridge interface. |\r\n\r\n| Parameter | Value | Notes |\r\n| :-- | :-- | :-- |\r\n| ifs2 <Name of First <br> Second Interface> | Interface <br> name | Specifies the name of the physical interface to be the <br> second subordinate interface of a bridge interface. |\r\n|  |  |  |\r\n\r\nExample 1 - Adding a Bridge interface with subordinate interfaces \"eth2\" and \"eth3\" in the Virtual System \"VS1\"\r\n<vs_provisioning_tool -e localhost -o admin -p <ppassword -o attach bridge vd VS1 ifs1 eth2 ifs2 eth3\r\n\r\n# Example 2 - Adding a Multi Bridge interface in the Virtual System \"VS1\" \r\n\r\nIn this example, we add pairs of VLAN interfaces to the Virtual System \"VS1\" to add a Multi Bridge interface (see \"Multi Bridge Interfaces\" on page 198):\r\n\r\n- VLANs eth2.403 and eth3.403 as the first bridge interface\r\n- VLANs eth2.504 and eth3.504 as the second bridge interface\r\n\r\nThe prerequisite is to configure both physical interfaces \"eth2\" and \"eth3\" as VLAN Trunks (see \"Configuring a Physical Interface as VLAN Trunk\" on page 293).\r\n<vs_provisioning_tool -e localhost -o admin -p <ppassword -o attach bridge vd VS1 ifs1 eth2.403 ifs2 eth3.403, attach bridge ifs1 eth2.504 ifs2 eth3.504\r\n\r\n# Adding a VPN Tunnel Interface to a Virtual Device \r\n\r\n## Description\r\n\r\nVirtual Tunnel Interface (VTI) is a virtual interface that is used for establishing a Route-Based VPN tunnel.\r\nThis command adds a VTI to an existing Virtual System object.\r\nThe VPN tunnel and its properties are defined by the VPN community that contains the two Security Gateways.\r\n\r\nYou must define the VPN community and its member Security Gateways before you can create a VTI.\r\nTo learn more about Route Based VPN, see the R81.20 Site to Site VPN Administration Guide > Chapter Route Based VPN.\r\n\r\n## Syntax\r\n\r\nadd interface vd <Name of Virtual System Object> vpn_tunnel numbered peer <Name of VPN Peer Object> local <Tunnel Local IP> remote <Tunnel Remote IP> [tunnel_id <Tunnel ID>]\r\n\r\n## Parameters\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| vd <Name of Virtual <br> System Object> | Object name | Specifies the name of the Virtual System object (as configured in SmartConsole). Mandatory parameter, if this is the first command in a transaction. |\r\n| vpn_tunnel numbered | - true <br> - false | Specifies the type of the VPN tunnel as numbered. <br> Uses a specified, static IPv4 addresses for local and remote connections. |\r\n| peer <Name of VPN Peer Object> | Object name | Specifies the name of the remote peer object as defined in the VPN community in SmartConsole. |\r\n| local <Tunnel Local IP> remote <Tunnel Remote IP> | IPv4 <br> configuration | Specifies the IPv4 addresses in dotted decimal format for the VPN tunnel endpoints: <br> - local <Tunnel Local IP>-IPv4 address of the VPN tunnel on this Virtual System <br> - remote <Tunnel Remote IP>-IPv4 address of the VPN tunnel on the remote VPN peer <br> Applies to the Numbered VTI only. |\r\n\r\n| Parameter | Value | Notes |\r\n| :-- | :-- | :-- |\r\n| tunnel_id <Tunnel ID> | Integer | Specifies the unique Tunnel ID (integer from 1 <br> to 32768). |\r\n|  |  | Note - If the specified ID is already <br> used by another VPN tunnel on this <br> VSX Gateway or VSX Cluster <br> Member, this parameter is ignored <br> and the next available ID is used <br> instead. |\r\n\r\n# Example - Numbered VTI \r\n\r\n[^0]\r\n[^0]:    vse_provision[ng_tool = add interface vd_vel vpo_tunnel numbered peer Add Peer local 149.254.46.238 remote 149.254.46.237 tunnel_id 10\r\n\r\n# Removing an Interface from a Virtual Device \r\n\r\n## Description\r\n\r\nThis command removes an interface from an existing Virtual Device object:\r\n\r\n- Virtual System\r\n- Virtual System in Bridge Mode\r\n- Virtual Switch\r\n- Virtual Router\r\n\r\n\r\n## Important:\r\n\r\n- If the interface you remove leads to a Virtual Router, all routes through that interface are removed automatically.\r\n- You must remove all subordinate interfaces of a bridge interface in the same transaction. This also removes the bridge interface.\r\n\r\nNote - If there are routes that have a next-hop IP address, which would become inaccessible without this interface, the transaction fails.\r\n\r\n## Syntax\r\n\r\nremove interface vd <Name of Virtual Device Object> \\{name <Name of Interface> | leads_to <Name of VSW or VR Object> \\}\r\n\r\n## Parameters\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| vd <Name of Virtual Device Object> | Object name | Specifies the name of the Virtual Device object. Mandatory parameter, if this is the first command in a transaction. |\r\n| name <<Name of Interface>> | Interface name | Specifies the name of the physical or VLAN interface. <br> Note - You must use the \"name\" or \"leads to\" parameter, but not both. |\r\n| leads to <Name of VSW or VR Object> | Object name | Specifies the name of the Virtual Switch or Virtual Router object, to which this interface connects. <br> This parameter is applicable only for a Virtual System. <br> Note - You must use the \"name\" or \"leads to\" parameter, but not both. |\r\n\r\nExample 1 - Removing a VLAN interface from a Virtual System \"VS1\"\r\nvsa_provisioning_1001 v.s. localizer v.s. admin v.s. represented v.s. remove interface v.s. v.s.s. name v1001,100\r\n\r\nExample 2 - Removing all subordinate interfaces \"eth2\" and \"eth3\" of a bridge interface in the Virtual System \"VS1\"\r\nvsa_provisioning_1001 v.s. localizer v.s. admin v.s. represented v.s. remove interface v.s. v.s.s. name v1001, remove interface v.s. v.s.s. name v1001\r\n\r\n# Modifying Settings of an Interface \r\n\r\n## Description\r\n\r\nThis command changes the settings of an interface that belongs to an existing Virtual Device object:\r\n\r\n- Virtual System\r\n- Virtual System in Bridge Mode\r\n- Virtual Switch\r\n- Virtual Router\r\n\r\nNote - You cannot change or remove the IP address or netmask of an existing interface with this command. You can remove the interface and add a new interface with a different IP address, but not all the previous interface settings are kept.\r\n\r\n## Syntax\r\n\r\nset interface vd <Name of Virtual Device Object> \\{name <Name of Interface> [new_name <Name of New Interface>] | leads_to <Name of VSW or VR Object> [new_leads_to <Name of New VSW or VR Object>]\\} [propagate \\{true | false\\}] [propagate $\\overline{6}$ \\{true | false\\}] [topology \\{external | internal_undefined | internal_this_network | internal_specific [specific_group <Network Group Object Name>]\\}] [mtu <MTU>]\r\n\r\nParameters\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| vd <Name of Virtual Device Object> | Object name | Specifies the name of the Virtual Device object. <br> Mandatory parameter, if this is the first command in a transaction. |\r\n| name <Name of Interface> | Interface name | Specifies the name of the physical or VLAN interface. |\r\n|  |  | Note - You must use the \"name\" or \"leads to\" parameter, but not both. |\r\n| new_name <Name of New Interface> | Interface name | You can change the name, but not the type of interface. |\r\n|  |  | Note - You can change a VLAN or physical interface only to a VLAN or physical interface. |\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| leads_to <Name of VSW or VR Object> | Object name | Specifies the name of the Virtual Switch or Virtual Router object, to which this interface connects. <br> This parameter is applicable only for a Virtual System. |\r\n| new_leads_to <Name of New VSW or VR Object> | Object name | You can where the interface leads: <br> - You can change an interface that leads to a Virtual Switch only to lead to a different Virtual Switch. <br> - You can change an interface that leads to a Virtual Router only to lead to a different Virtual Router. |\r\n| propagate \\{true | false\\} | - true <br> - false <br> Controlls how to propagate the IPv4 routes to adjacent Virtual Devices: <br> - true - Propagate the IPv4 routes <br> - false - Do not propagate the IPv4 routes (default) |\r\n| propagate6 \\{true | false\\} | Note - This parameter is applicable only for a Virtual System with VLAN or physical interfaces. |\r\n|  |  | Controls how to propagate the IPv6 routes to adjacent Virtual Devices: <br> - true - Propagate the IPv6 routes <br> - false - Do not propagate the IPv6 routes (default) |\r\n|  |  | Note - This parameter is applicable only for a Virtual System with VLAN or physical interfaces. |\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| topology \\{external | internal_undefined |  |\r\n| internal_undefined | internal_this_network | internal_specific\\} |  |\r\n| internal_specific\\} |  |  |\r\n| specific_group <Network | Name of Network | If you specified the \"topology |\r\n| Group Object Name> | Group Object | internal_specific\" parameter, then specify the name of the Network Group object that contains the applicable Network objects. |\r\n|  |  | Note - This parameter is applicable only if you disable the automatic topology calculation with the \"set vd .... calc_ topo_auto false\" command (see \"Modifying Settings of a Virtual Device\" on page 279). |\r\n| mtu <MTU> | Integer | Specifies the MTU value for this interface. Default is 1500 bytes. This parameter is applicable only for: <br> - Virtual System <br> - Virtual Router |\r\n\r\nExample - On the Virtual System \"VS1\", change the VLAN interface eth4.10 to the physical interface eth5\r\n\r\n[^0]\r\n[^0]:    vns_provisioning_tool -s localhost -u adeln -p mppaxxacrd -o set interface vd VS1 name eth4.100 nsns_name eth5 propagata true topology internal_specific specific_group 9708s\r\n\r\n# Configuring a Physical Interface as VLAN Trunk \r\n\r\n## Description\r\n\r\nThis command configures a physical interface as VLAN Trunk.\r\nThis is required to configure VLAN interfaces the physical interface.\r\n\r\nImportant - Make sure the physical interface you configure as VLAN Trunk does not have an IP address.\r\n\r\n## Syntax\r\n\r\nset physical_interface vd <Name of VSX Gateway or VSX Cluster Object> name <Name of Interface> vlan_trunk \\{true | false\\}\r\n\r\n## Parameters\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| vd <Name of VSX Gateway or VSX Cluster Object> | Object name | Specifies the name of the VSX Gateway or VSX Cluster object. <br> Mandatory parameter, if this is the first command in a transaction. |\r\n| name <Name of Interface> | Interface name | Specifies the name of the physical interface. |\r\n| vlan_trunk \\{true | false\\} | Controls whether this physical interface is a VLAN Trunk: <br> - true - VLAN Trunk interface <br> - false-Regular physical interface (default) |\r\n\r\nExample - On the VSX Gateway \"VSX1\" configure the physical interface eth2 as VLAN Trunk\r\n\r\n[^0]\r\n[^0]:    vsa_provisioning_tool -a localhost -u admin -p mppassword -a set physical_interface vd VSX1 name eth2 vlan_trunk true\r\n\r\n# Adding a Route \r\n\r\n## Description\r\n\r\nThis command adds an IPv4 or IPv6 route to an existing Virtual System or Virtual Router object.\r\n\r\nNote - This command detects IPv4 and IPv6 automatically.\r\n\r\n## Syntax\r\n\r\nadd route vd <Name of VS or VR Object> destination (<IP Address> [/<IP Prefix>] | default | default6) [ \\{netmask <IP Netmask> | prefix <IP Prefix> \\}] \\{next_hop <Next Hop IP Address> | leads_to <Name of VS or VR Object>\\} [propagate \\{true | false\\}]\r\n\r\nParameters\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| vd <Name of VS or VR Object> | Object name | Specifies the name of the Virtual System or Virtual Router object. <br> Mandatory parameter, if this is the first command in a transaction. |\r\n| destination <br> (<IP Address> [/<IP Prefix>] | See the Notes column on the right | Specifies the route destination settings: <br> - <IP Address> - IPv4 or IPv6 address <br> - <IP Prefix> - <br> - For IPv4 - Integer between 1 and 32 <br> - For IPv6 - Integer between 64 and 128 <br> - default - Use the default IPv4 route <br> - default6 - Use the default IPv6 route |\r\n| netmask <IP <br> Netmask> | Number | Specifies an IP Netmask: <br> - For IPv4 - Number in a format X.X.X.X <br> - For IPv6 - Number in a format <br> XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX |\r\n| prefix <IP <br> Prefix> | Integer | Specifies the IP address prefix length: <br> - For IPv4 - Integer between 1 and 32 <br> - For IPv6 - Integer between 64 and 128 |\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| next-hop <Next Hop $\\overline{I P}$ Address> | IP Address | Specifies the IP address of the next hop of the route. <br> Notes: <br> - This IP address must be on a subnet of an existing interface. <br> - You must use the \"next_hop\" or \"leads_ to\" parameter, but not both. |\r\n| leads_to <Name of VS or VR Object> | Object name | Specifies the name of the Virtual System or Virtual Router object, which is the next hop for the configured route. <br> Note - You must use the \"next_hop\" or \"leads to\" parameter, but not both. |\r\n| propagate \\{true \\| false\\} | - true <br> - false | Controls how to propagate the IP routes to adjacent Virtual Devices: <br> - true - Propagate the IP routes <br> - false - Do not propagate the IP routes (default) <br> Note - The \"propagate\" parameter is applicable only if you specified the \"next_hop\" parameter. |\r\n\r\nExample - Adding a route on the Virtual System \"VS1\" that uses the default IPv4 route as a destination and the Virtual Router \"VR3\" as a next hop\r\n<re_provisioning_tool -e localhost -u admin -p mppassword -o add route vd VS1 destination default leads_to VS1\r\n\r\n# Removing a Route \r\n\r\n## Description\r\n\r\nThis command removes an IPv4 or IPv6 route from an existing Virtual System or Virtual Router object.\r\n\r\nNote - This command detects IPv4 and IPv6 automatically.\r\n\r\n## Syntax\r\n\r\nremove route vd <Name of VS or VR Object> destination \\{<IP Address> [/<IP Prefix>] | default | default6\\} [\\{netmask <IP Netmask> | prefix <IP Prefix>]\r\n\r\nParameters\r\n\r\n| Parameter | Value | Notes |\r\n| :--: | :--: | :--: |\r\n| vd <Name of VS or VR Object> | Object name | Specifies the name of the Virtual System or Virtual Router object. <br> Mandatory parameter, if this is the first command in a transaction. |\r\n| destination \\{<IP Address> [/<IP Prefix>] | See the Notes column on the right | Specifies the route destination settings: <br> - <IP Address>- IPv4 or IPv6 address <br> - <IP Prefix> <br> - For IPv4 - Integer between 1 and 32 <br> - For IPv6 - Integer between 64 and 128 <br> - default - Use the default IPv4 route <br> - default6 - Use the default IPv6 route |\r\n| netmask <IP <br> Netmask> | Number | Specifies an IP Netmask: <br> - For IPv4 - Number in a format X.X.X.X <br> - For IPv6 - Number in a format <br> XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX |\r\n| prefix <IP <br> Prefix> | Integer | Specifies the IP address prefix length: <br> - For IPv4 - Integer between 1 and 32 <br> - For IPv6 - Integer between 64 and 128 |\r\n\r\nExample - Removing a route from the Virtual System \"VS1\" that uses the default IPv6 route as a destination\r\n\r\n[^0]\r\n[^0]:    use_provisioning_tool -A localhost -u admin -p -apparented -u remove routes vd vtl; destination default6\r\n\r\n# Showing Virtual Device Data \r\n\r\n## Description\r\n\r\nThis command shows the information about an existing Virtual Device object.\r\n\r\n## Syntax\r\n\r\nshow vd name <Name of Virtual Device Object>\r\n\r\n## Parameters\r\n\r\n| Parameter | Value | Notes |\r\n| :-- | :-- | :-- |\r\n| vd <Name of Virtual Device <br> Object> | Name of the Virtual <br> Device | Specifies the name of the Virtual <br> Device object. <br> Mandatory parameter. |\r\n\r\n## Comments\r\n\r\n- The command shows only non-automatic routes.\r\n- The command does not show routes that are created automatically with route propagation.\r\n- For a Virtual Router and Virtual Switch:\r\n\r\nThe command does not show the wrpj interfaces (created automatically) that connect to Virtual Systems.\r\n\r\n# Script Examples \r\n\r\nNote - Line numbers in the left column are written only to make it easier to read the script examples.\r\n\r\n## Example 1\r\n\r\nCreate a Virtual System connected to a Virtual Router.\r\nAdd a default route on the Virtual System that routes the traffic to the Virtual Router.\r\nAdd applicable routes on the Virtual Router to route the traffic to the Virtual System.\r\n\r\n| Line | Command |\r\n| :--: | :--: |\r\n| 1 | transaction begin |\r\n| 2 | add vd name VR1 vsx VSX1 type vr |\r\n| 3 | add interface name eth3.100 ip 10.0.0.1/24 |\r\n| 4 | transaction end |\r\n| 5 | transaction begin |\r\n| 6 | add vd name VR2 vsx VSX2 type vr |\r\n| 7 | add interface name eth3.200 ip 20.0.0.1/24 |\r\n| 8 | transaction end |\r\n| 9 | transaction begin |\r\n| 10 | add vd name VS1 vsx VSX1 |\r\n| 11 | add interface leads_to VR1 ip 192.168.1.1/32 |\r\n| 12 | add interface name eth4.20 ip 192.168.20.1/24 propagate true |\r\n| 13 | add route destination default leads_to VR1 |\r\n| 14 | add route destination 192.168.40.0/25 next_hop 192.168.20.254 |\r\n| 15 | transaction end |\r\n\r\n# Example 2 \r\n\r\nCreate a Virtual System connected to a Virtual Switch, with manual topology.\r\n\r\n| Line | Command |\r\n| :--: | :--: |\r\n| 1 | transaction begin |\r\n| 2 | add vd name VSW1 vsx VSX1 type vsw vs_mtu 1400 |\r\n| 3 | add interface name eth3.100 |\r\n| 4 | transaction end |\r\n| 5 | transaction begin |\r\n| 6 | add vd name VS1 vsx VSX1 calc_topo_auto false |\r\n| 7 | add interface leads_to VSW1 ip 10.0.0.1/24 ip6 2001::1/64 topology external |\r\n| 8 | add interface name eth4.20 ip 192.168.20.1/25 ip6 2020::1/64 topology internal_this_network |\r\n| 9 | add route destination default next_hop 10.0.0.254 |\r\n| 10 | add route destination default6 next_hop 2001::254 |\r\n| 11 | transaction end |\r\n\r\n## Example 3\r\n\r\nAdd CoreXL Firewall instances to the Virtual System made in the last example.\r\nTurn on automatic calculation of topology.\r\nChange the name of the internal interface, and decrease its MTU.\r\n\r\n| Line | Command |\r\n| :--: | :--: |\r\n| 1 | transaction begin |\r\n| 2 | set vd name VS1 instances 4 instances6 2 calc_topo_auto true |\r\n| 3 | set interface name eth4.20 new_name eth4.21 mtu 1400 |\r\n| 4 | transaction end |\r\n\r\n# Configuration Examples \r\n\r\nThis section provides examples of VSX configuration.\r\n\r\n# Example 1: VSX Gateway managed by Security Management Server \r\n\r\nThis example shows:\r\n\r\n- One VSX Gateway with DMI management connection FIPS\r\n- Two Virtual Systems:\r\n- Each Virtual System connects directly to available physical interfaces on the VSX Gateway\r\n- One Virtual System is configured with the IPsec VPN Software Blade\r\n- One Virtual System is configured with the Mobile Access Software Blade\r\n- One Security Management Server manages both the VSX Gateway and the two Virtual Systems.\r\n\r\n\r\n## Related documentation:\r\n\r\n- R81.20 Installation and Upgrade Guide\r\n- R81.20 Gaia Administration Guide\r\n- R81.20 Security Management Administration Guide\r\n\r\n\r\n## Topology\r\n\r\n![[CP_R81.20_VSX_AdminGuide_img_48.jpeg]]\r\n\r\n# Action Plan \r\n\r\n## 1. Install the Security Management Server\r\n\r\nSee the R81.20 Installation and Upgrade Guide.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | Install a Check Point appliance or Open Server. |\r\n| B | Install Gaia OS. |\r\n| C | Run the Gaia First Time Configuration Wizard. <br> These settings are specific to the Security Management Server: <br> a. On the Management Connection page, select the applicable interface and configure the applicable IPv4 address. <br> In our example: eth0, 10.20.30.1/24 <br> b. On the Installation Type page, select Security Gateway and/or Security Management. <br> c. On the Products page, select Security Management. |\r\n| D | Install the applicable licenses. |\r\n| E | Configure the Security Management Server: <br> a. Connect with SmartConsole to the Security Management Server. <br> b. Configure the applicable Management Software Blades and settings. <br> c. Publish the SmartConsole session. |\r\n\r\n## 2. Install the VSX Gateway\r\n\r\nSee the R81.20 Installation and Upgrade Guide.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | Install a Check Point appliance or Open Server. |\r\n| B | Install Gaia OS. |\r\n| C | Run the Gaia First Time Configuration Wizard. <br> These settings are specific to the VSX Gateway: <br> a. On the Management Connection page, select the interface for the DMI management connection and configure the applicable IPv4 address. In our example: eth0, 10.20.30.2/24 <br> b. On the Internet Connection page, do not configure IP addresses on physical interfaces, to which your Virtual Systems connect directly. <br> c. On the Installation Type page, select Security Gateway and/or Security Management. <br> d. On the Products page, select Security Gateway. <br> e. On the Dynamically Assigned IP page, select No. |\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| D | Make sure to enable the applicable physical interfaces: <br> To enable a physical interface in Gaia Portal <br> a. Connect to the Gaia Portal in your web browser. <br> In our example: https://10.20.30.2 <br> b. Click Network Management > Network Interfaces. <br> c. In the upper left corner, click the lock icon to obtain the configuration lock. <br> d. Select the applicable physical interface > click Edit. <br> e. Select Enable. <br> f. Click OK. <br> To enable a physical interface in Gaia Clish, run: <br> a. set interface <Name of Physical Interface> state on <br> b. save config |\r\n| E | Install the applicable licenses. |\r\n\r\n# 3. Create the VSX Gateway object in SmartConsole \r\n\r\nSee \"Configuring VSX Gateways\" on page 62.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | At the top, click Objects > More object types > Network Object > Gateways and Servers > VSX > New Gateway. |\r\n| B | On the VSX Gateway General Properties (Specify the object's basic settings) page: <br> a. In the Enter the VSX Gateway Name field, enter the applicable name for this object. <br> In our example: MyVsxGw <br> b. In the Enter the VSX Gateway IPv4 field, enter the same IPv4 address you configured during the First Time Configuration Wizard of the VSX Gateway on the Management Connection page. <br> In our example: $10.20 .30 .1 / 24$ <br> c. In the Enter the VSX Gateway IPv6 field, enter the same IPv6 address you configured during the First Time Configuration Wizard of the VSX Gateway on the Management Connection page. <br> d. In the Select the VSX Gateway Version field, select the Check Point version. In our example: R81.20 <br> e. Click Next. |\r\n| C | On the VSX Gateway General Properties (Secure Internal Communication) page: <br> a. In the Activation Key field, enter the same Activation Key you entered during the First Time Configuration Wizard of the VSX Gateway. <br> b. In the Confirm Activation Key field, enter the same Activation Key again. <br> c. Click Initialize. <br> d. Click Next. |\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| D | If the Trust State field does not show Trust established, perform these steps: <br> a. Connect to the command line on the VSX Gateway. <br> b. Make sure there is a physical connectivity between the VSX Gateway and the <br> Management Server (for example, pings can pass). <br> c. Run: cpconfig <br> d. Enter the number of this option: Secure Internal Communication <br> e. Follow the instructions on the screen to change the Activation Key. <br> f. On the VSX Gateway General Properties page, click Reset. <br> g. Enter the same Activation Key you entered in the cpconfig menu. <br> h. Click Initialize. |\r\n|  | On the VSX Gateway Interfaces (Physical Interfaces Usage) page: <br> a. Examine the list of the interfaces - it must show all the physical interfaces on <br> the VSX Gateway. <br> b. If you plan to connect more than one Virtual System directly to same physical <br> interface, you must select VLAN Trunk for that physical interface. <br> c. Click Next. |\r\n| E | On the Virtual Network Device Configuration (Specify the object's basic settings) <br> page: <br> a. You can select Create a Virtual Network Device and configure the first <br> applicable Virtual Network Device at this time (we recommend to do this later) <br> - Virtual Switch or Virtual Router. <br> b. Click Next. |\r\n| F | On the VSX Gateway Management (Specify the management access rules) page: <br> a. Examine the default access rules. <br> b. Select the applicable default access rules. <br> c. Configure the applicable source objects, if needed. <br> d. Click Next. <br> Important - These access rules apply only to the VSX Gateway (context of VS0), <br> which is not intended to pass any \"production\" traffic. |\r\n| G | On the VSX Gateway Creation Finalization page: <br> a. Click Finish and wait for the operation to finish. <br> b. Click View Report for more information. <br> c. Click Close. |\r\n| H | Examine the VSX configuration: <br> a. Connect to the command line on the VSX Gateway. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat $-v$ |\r\n\r\n4. Configure the VSX Gateway object in SmartConsole\r\n\r\nSee \"Working with VSX Gateways\" on page 66.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | From the left navigation toolbar, click Gateways \\& Servers. |\r\n| B | Open the VSX Gateway object. <br> In our example: MyVsxGw |\r\n| C | Enable the applicable Software Blades. <br> Refer to: <br> - sk79700 - VSX supported features on R75.40VS and above <br> - sk106496 - Software Blades updates on VSX R75.40VS and above -FAQ <br> - Applicable Administration Guides on the R81.20 Home Page. |\r\n| D | Configure other applicable settings. |\r\n| E | Click OK to push the updated VSX Configuration. Click View Report for more information. |\r\n| F | Install policy on the VSX Gateway object: <br> a. Click Install Policy. <br> The Install Policy window opens. <br> b. In the Policy field, select the default policy for this VSX Gateway object. <br> This policy is called: <Name of VSX Gateway object>_VSX. <br> In our example: MyVsxGw_VSX <br> c. Click Install. |\r\n| G | Examine the VSX configuration: <br> a. Connect to the command line on the VSX Gateway. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat $-v$ |\r\n\r\n# 5. Create the first Virtual System object in SmartConsole \r\n\r\nSee \"Working with Virtual Systems\" on page 70.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | At the top, click Objects > More object types > Network Object > Gateways and <br> Servers > VSX > New Virtual System. |\r\n| B | On the VSX System General Properties (Define the object name and the hosting <br> VSX) page: <br> a. In the Name field, enter the applicable name for this object. <br> In our example: MyVs1 <br> b. In the VSX Gateway / Cluster field, select the applicable VSX Gateway <br> object. <br> In our example: MyVsxGw <br> c. Click Next. |\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| C | On the Virtual System Network Configuration (Define Virtual System Interfaces and Routes) page: <br> In our example, this Virtual System connects directly to two physical interfaces on the VSX Gateway. <br> In the Interfaces section, add the \"external\" interface: <br> a. Click Add > Regular. <br> b. In the Interface field, select the applicable physical interface. <br> In our example: eth1 <br> c. In the IPv4 Configuration section, enter the applicable IP Address and Net Mask. <br> In our example: 192.168.10.1/24 <br> You can select Propagate route to adjacent Virtual Devices (IPv4) to \"advertise\" this Virtual System to neighboring Virtual Devices. This enables IPv4 connectivity between neighboring Virtual Devices. <br> d. In the IPv6 Configuration section, enter the applicable IPv6 Address and Prefix. <br> You can select Propagate route to adjacent Virtual Devices (IPv6) to \"advertise\" this Virtual System to neighboring Virtual Devices. This enables IPv6 connectivity between the neighboring Virtual Devices. <br> e. Click OK. |\r\n|  | In the Interfaces section, add the \"internal\" interface: <br> a. Click Add > Regular. <br> b. In the Interface field, select the applicable physical interface - this is the \"internal\" interface. <br> In our example: eth2 <br> c. In the IPv4 Configuration section, enter the applicable IP Address and Net Mask. <br> In our example: 172.30.10.1/24 <br> You can select Propagate route to adjacent Virtual Devices (IPv4) to \"advertise\" this Virtual System to neighboring Virtual Devices. This enables IPv4 connectivity between the neighboring Virtual Devices. <br> d. In the IPv6 Configuration section, enter the applicable IPv6 Address and Prefix. <br> You can select Propagate route to adjacent Virtual Devices (IPv6) to \"advertise\" this Virtual System to neighboring Virtual Devices. This enables IPv6 connectivity between the neighboring Virtual Devices. <br> e. Click OK. <br> In the Routes section, click Add to configure the applicable static routes and the Default Route. <br> Click Next. |\r\n| D | On the VSX System Creation Finalization page: <br> a. Click Finish and wait for the operation to finish. <br> b. Click View Report for more information. <br> c. Click Close. |\r\n\r\n| Step | Instructions |\r\n| :-- | :-- |\r\n| E | Examine the VSX configuration: <br> a. Connect to the command line on the VSX Gateway. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat $-v$ |\r\n\r\n# 6. Configure the first Virtual System object in SmartConsole \r\n\r\nSee \"Working with Virtual Systems\" on page 70.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | From the left navigation toolbar, click Gateways \\& Servers. |\r\n| B | Open the first Virtual System object. <br> In our example: MyVs1 |\r\n| C | Enable the applicable Software Blades. <br> In our example: IPsec VPN blade <br> Refer to: <br> - sk79700 - VSX supported features on R75.40VS and above <br> - sk106496 - Software Blades updates on VSX R75.40VS and above - <br> FAQ <br> - Applicable Administration Guides on the R81.20 Home Page. |\r\n| D | Configure other applicable settings. |\r\n| E | Click OK to push the updated VSX Configuration. |\r\n| F | Configure and install the applicable policy on the first Virtual System object. |\r\n| G | Examine the VSX configuration: <br> a. Connect to the command line on the VSX Gateway. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat $-v$ |\r\n\r\n7. Create the second Virtual System object in SmartConsole\r\n\r\nSee \"Working with Virtual Systems\" on page 70.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | At the top, click Objects > More object types > Network Object > Gateways and <br> Servers > VSX > New Virtual System. |\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| B | On the VSX System General Properties (Define the object name and the hosting VSX) page: <br> a. In the Name field, enter the applicable name for this object. <br> In our example: MyVs2 <br> b. In the VSX Gateway / Cluster field, select the applicable VSX Gateway object. <br> In our example: MyVsxGw <br> c. Click Next. |\r\n| C | On the Virtual System Network Configuration (Define Virtual System Interfaces and Routes) page: <br> In our example, this Virtual System connects directly to two physical interfaces on the VSX Gateway. <br> In the Interfaces section, add the \"external\" interface: <br> a. Click Add > Regular. <br> b. In the Interface field, select the applicable physical interface. <br> In our example: eth1 <br> c. In the IPv4 Configuration section, enter the applicable IP Address and Net Mask. <br> In our example: 192.168.20.1/24 <br> You can select Propagate route to adjacent Virtual Devices (IPv4) to \"advertise\" this Virtual System to neighboring Virtual Devices. This enables IPv4 connectivity between Virtual Devices. <br> d. In the IPv6 Configuration section, enter the applicable IPv6 Address and Prefix. <br> You can select Propagate route to adjacent Virtual Devices (IPv6) to \"advertise\" this Virtual System to neighboring Virtual Devices. This enables IPv6 connectivity between Virtual Devices. <br> e. Click OK. |\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n|  | In the Interfaces section, add the \"internal\" interface: <br> a. Click Add > Regular. <br> b. In the Interface field, select the applicable physical interface - this is the \"internal\" interface. <br> In our example: eth2 <br> c. In the IPv4 Configuration section, enter the applicable IP Address and Net Mask. <br> In our example: 172.30.20.1/24 <br> You can select Propagate route to adjacent Virtual Devices (IPv4) to \"advertise\" this Virtual System to neighboring Virtual Devices. This enables IPv4 connectivity between the neighboring Virtual Devices. <br> d. In the IPv6 Configuration section, enter the applicable IPv6 Address and Prefix. <br> You can select Propagate route to adjacent Virtual Devices (IPv6) to \"advertise\" this Virtual System to neighboring Virtual Devices. This enables IPv6 connectivity between the neighboring Virtual Devices. <br> e. Click OK. <br> In the Routes section, click Add to configure the applicable static routes and the Default Route. <br> Click Next. |\r\n| D | On the VSX System Creation Finalization page: <br> a. Click Finish and wait for the operation to finish. <br> b. Click View Report for more information. <br> c. Click Close. |\r\n| E | Examine the VSX configuration: <br> a. Connect to the command line on the VSX Gateway. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat $-v$ |\r\n\r\n# 8. Configure the second Virtual System object in SmartConsole \r\n\r\nSee \"Working with Virtual Systems\" on page 70.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | From the left navigation toolbar, click Gateways \\& Servers. |\r\n| B | Open the second Virtual System object. <br> In our example: MyVs2 |\r\n| C | Enable the applicable Software Blades. <br> In our example: Mobile Access blade <br> Refer to: <br> - sk79700 - VSX supported features on R75.40VS and above <br> - sk106496 - Software Blades updates on VSX R75.40VS and above - <br> FAQ <br> - Applicable Administration Guide on the R81.20 Home Page. |\r\n\r\n| Step | Instructions |\r\n| :-- | :-- |\r\n| D | Configure other applicable settings. |\r\n| E | Click OK to push the updated VSX Configuration. |\r\n| F | Configure and install the applicable policy on the second Virtual System object. |\r\n| G | Examine the VSX configuration: <br> a. Connect to the command line on the VSX Gateway. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat $-v$ |\r\n\r\n# Example 2: VSX Cluster managed by MultiDomain Server \r\n\r\n## This example shows:\r\n\r\n- One VSX Cluster in Virtual System Load Sharing (VSLS)\r\n- Two VSX Cluster Members with DMI management connection\r\n- One external Virtual Switch\r\n- Two Virtual Systems:\r\n- External interface on each Virtual System connects directly to the Virtual Switch\r\n- Internal interface on each Virtual System connects to the VLAN Trunk interface\r\n- One Virtual System is configured with the IPsec VPN Software Blade\r\n- One Virtual System is configured with the Mobile Access Software Blade\r\n- One Multi-Domain Server:\r\n- One Main Domain Management Server manages the objects of the VSX Cluster and Virtual Switch\r\n- One Target Domain Management Server manages the object of the first Virtual System\r\n- One Target Domain Management Server manages the object of the second Virtual System\r\n\r\n\r\n## Related documentation:\r\n\r\n- R81.20 Installation and Upgrade Guide\r\n- R81.20 Gaia Administration Guide\r\n- R81.20 Security Management Administration Guide\r\n- R81.20 Multi-Domain Security Management Administration Guide\r\n\r\n# Topology \r\n\r\nTopology of the VSX Cluster\r\n![[CP_R81.20_VSX_AdminGuide_img_49.jpeg]]\r\n\r\nTopology of the Virtual Systems in the cluster\r\n![[CP_R81.20_VSX_AdminGuide_img_50.jpeg]]\r\n\r\nMulti-Domain Server and managed objects\r\n![[CP_R81.20_VSX_AdminGuide_img_51.jpeg]]\r\n\r\nInterfaces and IP addresses\r\n\r\n| Computer | Interface | IP Address/Net <br> Mask | Description |\r\n| :--: | :--: | :--: | :--: |\r\n| VSX Cluster <br> Member 1 | eth0 | 10.20.30.1/24 <br> Main Cluster VIP <br> 10.20.30.100/24 | Dedicated Management Interface (DMI) |\r\n|  | eth1 | none | External physical interface |\r\n|  | $\\operatorname{wrp} X$ | 192.168.10.1/24 <br> Cluster VIP <br> 192.168.10.100/24 | External warp interface on Virtual System 1 Note - Interface name is generated automatically |\r\n|  | $\\operatorname{wrp} Y$ | 192.168.20.1/24 <br> VIP <br> 192.168.20.100/24 | External warp interface on Virtual System 2 Note - Interface name is generated automatically |\r\n|  | eth2 | none | Internal physical interface - VLAN Trunk |\r\n|  | eth2.11 | 172.30.10.1/24 <br> Cluster VIP <br> 172.30.10.100/24 | Internal VLAN interface on Virtual System 1 |\r\n|  | eth2.22 | 172.30.20.1/24 <br> Cluster VIP <br> 172.30.10.100/24 | Internal VLAN interface on Virtual System 2 |\r\n|  | eth3 | 192.168.200.1/24 | Cluster Sync physical interface |\r\n\r\n| Computer | Interface | IP Address / Net Mask | Description |\r\n| :--: | :--: | :--: | :--: |\r\n| VSX Cluster Member 2 | eth0 | $\\begin{aligned} & \\text { 10.20.30.2/24 } \\\\ & \\text { Cluster VIP } \\\\ & \\text { 10.20.30.100/24 } \\end{aligned}$ | Dedicated Management Interface (DMI) |\r\n|  | eth1 | none | External physical interface |\r\n|  | $\\operatorname{wrp} X$ | $\\begin{aligned} & \\text { 192.168.10.2/24 } \\\\ & \\text { Cluster VIP } \\\\ & \\text { 192.168.10.100/24 } \\end{aligned}$ | External warp interface on Virtual System 1 Note - Interface name is generated automatically |\r\n|  | $\\operatorname{wrp} Y$ | $\\begin{aligned} & \\text { 192.168.20.2/24 } \\\\ & \\text { Cluster VIP } \\\\ & \\text { 192.168.20.100/24 } \\end{aligned}$ | External warp interface on Virtual System 2 Note - Interface name is generated automatically |\r\n|  | eth2 | none | Internal physical interface - VLAN Trunk |\r\n|  | eth2.11 | $\\begin{aligned} & \\text { 172.30.10.2/24 } \\\\ & \\text { Cluster VIP } \\\\ & \\text { 172.30.10.100/24 } \\end{aligned}$ | Internal VLAN interface on Virtual System 1 |\r\n|  | eth2.22 | $\\begin{aligned} & \\text { 172.30.10.2/24 } \\\\ & \\text { Cluster VIP } \\\\ & \\text { 172.30.10.100/24 } \\end{aligned}$ | Internal VLAN interface on Virtual System 2 |\r\n|  | eth3 | 192.168.200.2/24 | Cluster Sync physical interface |\r\n| Multi- <br> Domain <br> Server | eth0 | 10.20.30.200/24 | Leading Interface that belongs to the MultiDomain Server |\r\n|  | eth0:1 | 10.20.30.210/24 | Virtual interface that belongs to the Main Domain Management Server (DMS 1), which manages the VSX Cluster and Virtual Switch |\r\n|  | eth0:2 | 10.20.30.211/24 | Virtual interface that belongs to the Target Domain Management Server (DMS 2), which manages the Virtual System 1 |\r\n|  | eth0:3 | 10.20.30.212/24 | Virtual interface that belongs to the Target Domain Management Server (DMS 3), which manages the Virtual System 2 |\r\n\r\n# Action Plan \r\n\r\n## 1. Install the Multi-Domain Server\r\n\r\nSee the R81.20 Installation and Upgrade Guide.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | Install a Check Point appliance or Open Server. |\r\n| B | Install Gaia OS. |\r\n| C | Run the Gaia First Time Configuration Wizard. <br> These settings are specific to the Multi-Domain Server: <br> a. On the Management Connection page, select the applicable interface and configure the applicable IPv4 address. <br> In our example: eth0, 10.20.30.200/24 <br> b. On the first Installation Type page, select Multi-Domain Server. <br> c. On the second Installation Type page, select Primary Multi-Domain Server. <br> d. On the Leading VIP Interfaces Configuration page, select the applicable interface. <br> In our example: eth0 |\r\n| D | Install the applicable licenses. |\r\n| E | Configure the applicable settings: <br> a. Connect with SmartConsole to the Multi-Domain Server. <br> b. Configure the applicable settings. <br> c. Publish the SmartConsole session. |\r\n\r\n2. Create the Main Domain Management Server in SmartConsole to manage the VSX Cluster and Virtual Switch\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | Connect with SmartConsole to the Multi-Domain Server. |\r\n| B | Create a new Domain and Domain Server. <br> In our example: <br> - Name: DMS1 <br> - IPv4: 10.20.30.210/24 |\r\n| C | From the left navigation panel, click Gateways \\& Servers. |\r\n| D | Configure the Main Domain Management Server: <br> a. Connect with SmartConsole to the Main Domain Management Server (DMS1). <br> b. Configure the applicable Management Software Blades and settings. <br> c. Publish the SmartConsole session. |\r\n\r\n3. Create the Target Domain Management Server in SmartConsole to manage the Virtual System 1\r\n\r\n| Step | Instructions |\r\n| :-- | :-- |\r\n| A | Connect with SmartConsole to the Multi-Domain Server. |\r\n\r\n| Step | Instructions |\r\n| :-- | :-- |\r\n| B | Create a new Domain and Domain Server. <br> In our example: <br> - Name: DMS2 <br> - IPv4: $10.20 .30 .211 / 24$ |\r\n| C | From the left navigation panel, click Gateways \\& Servers. |\r\n| D | Configure the Target Domain Management Server: <br> a. Connect with SmartConsole to the Target Domain Management Server <br> (DMS2). <br> b. Configure the applicable Management Software Blades and settings. <br> c. Publish the SmartConsole session. |\r\n\r\n4. Create the Target Domain Management Server in SmartConsole to manage the Virtual System 2\r\n\r\n| Step | Instructions |\r\n| :-- | :-- |\r\n| A | Connect with SmartConsole to the Multi-Domain Server. |\r\n| B | Create a new Domain and Domain Server. <br> In our example: <br> - Name: DMS3 <br> - IPv4: $10.20 .30 .212 / 24$ |\r\n| C | From the left navigation panel, click Gateways \\& Servers. |\r\n| D | Configure the Target Domain Management Server: <br> a. Connect with SmartConsole to the Target Domain Management Server <br> (DMS3). <br> b. Configure the applicable Management Software Blades and settings. <br> c. Publish the SmartConsole session. |\r\n\r\n# 5. Install the VSX Cluster Member 1 \r\n\r\nSee the R81.20 Installation and Upgrade Guide.\r\n\r\n| Step | Instructions |\r\n| :-- | :-- |\r\n| A | Install a Check Point appliance or Open Server. |\r\n| B | Make sure you have enough physical interfaces for your VSX topology. |\r\n| C | Install Gaia OS. |\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| D | Run the Gaia First Time Configuration Wizard. <br> These settings are specific to the VSX Cluster Member 1: <br> a. On the Management Connection page, select the interface for the DMI management connection and configure the applicable IPv4 address. In our example: eth0, 10.20.30.1/24 <br> b. On the Internet Connection page, do not configure IP addresses on physical interfaces, to which your Virtual Systems connect directly. <br> c. On the Installation Type page, select Security Gateway and/or Security Management. <br> d. On the Products page, select Security Gateway. <br> e. On the Dynamically Assigned IP page, select No. |\r\n| E | Make sure to enable the applicable physical interfaces: <br> To enable a physical interface in Gaia Portal <br> a. Connect to the Gaia Portal in your web browser. <br> In our example: https://10.20.30.1 <br> b. Click Network Management > Network Interfaces. <br> c. In the upper left corner, click the lock icon to obtain the configuration lock. <br> d. Select the applicable physical interface > click Edit. <br> e. Select Enable. <br> f. Click OK. <br> To enable a physical interface in Gaia Clish, run: <br> a. set interface <Name of Physical Interface> state on <br> b. save config |\r\n| F | Install the applicable licenses. |\r\n| G | Enable the Per Virtual System State mode: <br> a. Connect to the command line. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: cpconfig <br> d. Select: Enable Check Point Per Virtual System State <br> e. Enter $\\mathbf{y}$ to confirm <br> f. Run: reboot |\r\n\r\n# 6. Install the VSX Cluster Member 2 \r\n\r\nSee the R81.20 Installation and Upgrade Guide.\r\n\r\n| Step | Instructions |\r\n| :-- | :-- |\r\n| A | Install a Check Point appliance or Open Server. |\r\n| B | Make sure you have enough physical interfaces for your VSX topology. |\r\n| C | Install Gaia OS. |\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| D | Run the Gaia First Time Configuration Wizard. <br> These settings are specific to the VSX Cluster Member 1: <br> a. On the Management Connection page, select the interface for the DMI management connection and configure the applicable IPv4 address. In our example: eth0, 10.20.30.2/24 <br> b. On the Internet Connection page, do not configure IP addresses on physical interfaces, to which your Virtual Systems connect directly. <br> c. On the Installation Type page, select Security Gateway and/or Security Management. <br> d. On the Products page, select Security Gateway. <br> e. On the Dynamically Assigned IP page, select No. |\r\n| E | Make sure to enable the applicable physical interfaces: <br> To enable a physical interface in Gaia Portal <br> a. Connect to the Gaia Portal in your web browser. <br> In our example: https://10.20.30.2 <br> b. Click Network Management > Network Interfaces. <br> c. In the upper left corner, click the lock icon to obtain the configuration lock. <br> d. Select the applicable physical interface > click Edit. <br> e. Select Enable. <br> f. Click OK. <br> To enable a physical interface in Gaia Clish, run: <br> a. set interface <Name of Physical Interface> state on <br> b. save config |\r\n| F | Install the applicable licenses. |\r\n| G | Enable the Per Virtual System State mode: <br> a. Connect to the command line. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: cpconfig <br> d. Select: Enable Check Point Per Virtual System State <br> e. Enter $y$ to confirm <br> f. Run: reboot |\r\n\r\n# 7. Create the VSX Cluster object with VSX Cluster Members in SmartConsole \r\n\r\nSee \"Configuring VSX Clusters\" on page 120 and \"Working with VSX Clusters\" on page 125.\r\n\r\n| Step | Instructions |\r\n| :--: | :-- |\r\n| A | Connect with SmartConsole to the Main Domain Management Server that manages <br> the objects of the VSX Cluster and Virtual Switch. <br> In our example: DMS1 |\r\n| B | At the top, click Objects > More object types > Network Object > Gateways and <br> Servers > VSX > New Cluster. |\r\n\r\n# Step \r\n\r\n## Instructions\r\n\r\nC\r\n\r\nOn the VSX Cluster General Properties (Specify the object's basic settings) page:\r\na. In the Enter the VSX Cluster Name field, enter the applicable name for this object.\r\nIn our example: MyVoxCluster\r\nb. In the Enter the VSX Cluster IPv4 field, enter the Cluster Virtual IPv4 address that is configured on the Dedicated Management Interfaces (DMI).\r\nIn our example: $10.20 .30 .100$\r\nc. In the Enter the VSX Cluster IPv6 field, enter the Cluster Virtual IPv6 address that is configured on the Dedicated Management Interfaces (DMI).\r\nd. In the Select the VSX Cluster Version field, select the applicable Check Point version.\r\nIn our example: R81.20\r\ne. In the Select the VSX Cluster Platform field, select ClusterXL Virtual System Load Sharing.\r\nSee \"Configuring Virtual System Load Sharing\" on page 140.\r\n\r\nNote - This is the only mode available for a VSX Cluster that was installed as R81.10 or higher.\r\nf. Click Next.\r\n\r\nOn the VSX Cluster Members (Define the members of this VSX Cluster) page: Add the first VSX Cluster Member:\r\na. Click Add.\r\nb. In the Cluster Member Name field, enter the applicable name for this object. In our example: MyVoxMember1\r\nc. In the Cluster Member IPv4 Address field, enter the IPv4 address of the Dedicated Management Interface (DMI).\r\nIn our example: eth0, 10.20.30.1\r\nd. In the Enter the VSX Gateway IPv6 field, enter the applicable IPv6 address.\r\ne. In the Activation Key field, enter the same Activation Key you entered during the First Time Configuration Wizard of this VSX Cluster Member.\r\nf. In the Confirm Activation Key field, enter the same Activation Key again.\r\ng. Click Initialize.\r\nh. Click OK.\r\ni. Enter the same Activation Key you entered in the cpconfig menu.\r\nj. Click Initialize.\r\n\r\nIf the Trust State field does not show Trust established, perform these steps:\r\na. Connect to the command line on the VSX Cluster Member.\r\nb. Make sure there is a physical connectivity between the VSX Cluster Member and the Management Server (for example, pings can pass).\r\nc. Run: cpconfig\r\nd. Enter the number of this option: Secure Internal Communication\r\ne. Follow the instructions on the screen to change the Activation Key.\r\nf. On the VSX Cluster General Properties page, click Reset.\r\ng. Enter the same Activation Key you entered in the cpconfig menu.\r\nh. Click Initialize.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| E | On the VSX Cluster Members (Define the members of this VSX Cluster) page: Add the second VSX Cluster Member: <br> a. Click Add. <br> b. In the Cluster Member Name field, enter the applicable name for this object. In our example: MyVsxMember2 <br> c. In the Cluster Member IPv4 Address field, enter the IPv4 address of the Dedicated Management Interface (DMI). <br> In our example: eth0, 10.20.30.2 <br> d. In the Enter the VSX Gateway IPv6 field, enter the applicable IPv6 address. <br> e. In the Activation Key field, enter the same Activation Key you entered during the First Time Configuration Wizard of this VSX Cluster Member. <br> f. In the Confirm Activation Key field, enter the same Activation Key again. <br> g. Click Initialize. <br> h. Click OK. <br> i. Click Next. |\r\n|  | If the Trust State field does not show Trust established, perform these steps: <br> a. Connect to the command line on the VSX Cluster Member. <br> b. Make sure there is a physical connectivity between the VSX Cluster Member and the Management Server (for example, pings can pass). <br> c. Run: cpconfig <br> d. Enter the number of this option: Secure Internal Communication <br> e. Follow the instructions on the screen to change the Activation Key. <br> f. On the VSX Cluster General Properties page, click Reset. <br> g. Enter the same Activation Key you entered in the cpconfig menu. <br> h. Click Initialize. |\r\n| F | On the VSX Cluster Interfaces (Physical Interfaces Usage) page: <br> a. Examine the list of the interfaces - it must show all the physical interfaces on the VSX Gateway. <br> b. If you plan to connect more than one Virtual System directly to same physical interface, you must select VLAN Trunk for that physical interface. In our example: eth2 <br> c. Click Next. |\r\n| G | On the VSX Cluster members (Synchronization Network) page: <br> a. Select the interface that will be used for state synchronization. In our example: eth3 <br> b. Configure the IPv4 addresses for the Sync interfaces on each VSX Cluster Member. <br> In our example: <br> MyVsxMember1 - 192.168.200.1 / 255.255.255.0 <br> MyVsxMember2 - 192.168.200.2 / 255.255.255.0 <br> c. Click Next. |\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| H | On the Virtual Network Device Configuration (Specify the object's basic settings) page: <br> a. You can select Create a Virtual Network Device and configure the first applicable Virtual Network Device at this time (we recommend to do this later) - Virtual Switch or Virtual Router. <br> b. Click Next. |\r\n| I | On the VSX Gateway Management (Specify the management access rules) page: <br> a. Examine the default access rules. <br> b. Select the applicable default access rules. <br> c. Configure the applicable source objects, if needed. <br> d. Click Next. <br> Important - These access rules apply only to the VSX Gateway (context of VS0), which is not intended to pass any \"production\" traffic. |\r\n| J | On the VSX Gateway Creation Finalization page: <br> a. Click Finish and wait for the operation to finish. <br> b. Click View Report for more information. <br> c. Click Close. |\r\n| K | Examine the VSX configuration: <br> a. Connect to the command line on each VSX Cluster Member. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat $\\sim \\mathrm{V}$ |\r\n\r\n# 8. Configure the VSX Cluster object in SmartConsole \r\n\r\nSee \"Working with VSX Clusters\" on page 125.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | From the left navigation toolbar, click Gateways \\& Servers. |\r\n| B | Open the VSX Cluster object. <br> In our example: MyVsxCluster |\r\n| C | Enable the applicable Software Blades. <br> Refer to: <br> - sk79700 - VSX supported features on R75.40VS and above <br> - sk106496 - Software Blades updates on VSX R75.40VS and above - FAQ <br> - Applicable Administration Guides on the R81.20 Home Page. |\r\n| D | Configure other applicable settings. |\r\n| E | Click OK to push the updated VSX Configuration. Click View Report for more information. |\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| F | Install policy on the VSX Cluster object: <br> a. Click Install Policy. <br> b. In the Policy field, select the default policy for this VSX Cluster object. <br> This policy is called: <Name of VSX Cluster object>_VSX. <br> In our example: MyVsxCluster_VSX <br> c. Click Install. |\r\n| G | Examine the VSX configuration and VSX Cluster configuration: <br> a. Connect to the command line on each VSX Cluster Member. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat $-v$ <br> d. Run: <br> - In Gaia Clish: show cluster state <br> - In the Expert mode: cphaprob state |\r\n\r\n9. Create the Virtual Switch object in SmartConsole\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | Connect with SmartConsole to the Main Domain Management Server that manages the objects of the VSX Cluster and Virtual Switch. <br> In our example: DMS1 |\r\n| B | Create the Virtual Switch object: <br> At the top, click Objects > More object types > Network Object > Gateways and Servers > VSX > New Virtual Switch. |\r\n| C | On the VSX Switch General Properties (Define the object name and the hosting VSX) page: <br> a. In the Name field, enter the applicable name for this object. <br> In our example: MyVsw <br> b. In the VSX Gateway / Cluster field, select the applicable VSX Gateway or VSX Cluster object. <br> In our example: MyVsxCluster <br> c. Click Next. |\r\n| D | On the VSX Switch Network Configuration (Define Virtual Switch Interfaces) page: <br> a. Click Add. <br> b. In the Interface field, select the applicable physical interface. <br> In our example: eth2 <br> c. Click OK. <br> d. Click Next. |\r\n| E | On the VSX Switch Cluster Creation Finalization page: <br> a. Click Finish and wait for the operation to finish. <br> b. Click View Report for more information. <br> c. Click Close. |\r\n\r\n| Step | Instructions |\r\n| :-- | :-- |\r\n| F | Examine the VSX configuration: <br> a. Connect to the command line on each VSX Cluster Member. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat $-v$ |\r\n\r\n10. Create the first Virtual System object in SmartConsole\r\n![[CP_R81.20_VSX_AdminGuide_img_52.jpeg]]\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n|  | In the Interfaces section, add the \"internal\" interface: <br> a. Click Add > Regular. <br> b. In the Interface field, select the applicable physical interface - this is the \"internal\" interface. <br> In our example: eth2 (that is marked as VLAN Trunk) <br> c. In the VLAN tag field, enter the applicable number between 2 and 4094. <br> In our example: 11 (to configure eth2.11) <br> d. In the IPv4 Configuration section, enter the applicable IP Address and Net Mask. <br> In our example: $172.30 .10 .1 / 24$ <br> You can select Propagate route to adjacent Virtual Devices (IPv4) to \"advertise\" this Virtual System to neighboring Virtual Devices. This enables IPv4 connectivity between the neighboring Virtual Devices. <br> e. In the IPv6 Configuration section, enter the applicable IPv6 Address and Prefix. <br> You can select Propagate route to adjacent Virtual Devices (IPv6) to \"advertise\" this Virtual System to neighboring Virtual Devices. This enables IPv6 connectivity between the neighboring Virtual Devices. <br> f. Click OK. <br> In the Routes section, click Add to configure the applicable static routes and the Default Route. <br> Click Next. |\r\n| E | On the Virtual System Cluster Creation Finalization page: <br> a. Click Finish and wait for the operation to finish. <br> b. Click View Report for more information. <br> c. Click Close. |\r\n| F | Examine the VSX configuration: <br> a. Connect to the command line on each VSX Cluster Member. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat $-v$ |\r\n\r\n# 11. Configure the first Virtual System object in SmartConsole \r\n\r\nSee \"Working with Virtual Systems\" on page 70.\r\n\r\n| Step | Instructions |\r\n| :-- | :-- |\r\n| A | From the left navigation toolbar, click Gateways \\& Servers. |\r\n| B | Open the first Virtual System object. <br> In our example: MyVs1 |\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| C | Enable the applicable Software Blades. <br> In our example: IPsec VPN blade <br> Refer to: <br> - sk79700 - VSX supported features on R75.40VS and above <br> - sk106496 - Software Blades updates on VSX R75.40VS and above - <br> FAQ <br> - Applicable Administration Guides on the R81.20 Home Page. |\r\n| D | Configure other applicable settings. |\r\n| E | Click OK to push the updated VSX Configuration. |\r\n| F | Configure and install the applicable policy on the first Virtual System object. |\r\n| G | Examine the VSX configuration and VSX Cluster configuration: <br> a. Connect to the command line on each VSX Cluster Member. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat -v <br> d. Run: <br> - In Gaia Clish: show cluster state <br> - In the Expert mode: cphaprob state |\r\n\r\n12. Create the second Virtual System object in SmartConsole\r\n![[CP_R81.20_VSX_AdminGuide_img_53.jpeg]]\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| D | On the Virtual System Network Configuration (Define Virtual System Interfaces and Routes) page: <br> In our example, this Virtual System connects to the Virtual Switch (\"external\") and to the physical VLAN Trunk interface (\"internal\") on the VSX Cluster Members. In the Interfaces section, add the \"external\" interface: <br> a. Click Add > Leads to Virtual Switch. <br> b. In the Leads to field, select the Virtual Switch your created earlier. In our example: MyVsxVsw <br> c. In the IPv4 Configuration section, enter the applicable IP Address and Net Mask. <br> In our example: $192.168 .20 .1 / 24$ <br> d. In the IPv6 Configuration section, enter the applicable IPv6 Address and Prefix. <br> e. Click OK. |\r\n| In the Interfaces section, add the \"internal\" interface: <br> a. Click Add > Regular. <br> b. In the Interface field, select the applicable physical interface - this is the \"internal\" interface. <br> In our example: eth2 (that is marked as VLAN Trunk) <br> c. In the VLAN tag field, enter the applicable number between 2 and 4094. In our example: 22 (to configure et $\\mathrm{h} 2.22$ ) <br> d. In the IPv4 Configuration section, enter the applicable IP Address and Net Mask. <br> In our example: $172.30 .20 .1 / 24$ <br> You can select Propagate route to adjacent Virtual Devices (IPv4) to \"advertise\" this Virtual System to neighboring Virtual Devices. This enables IPv4 connectivity between the neighboring Virtual Devices. <br> e. In the IPv6 Configuration section, enter the applicable IPv6 Address and Prefix. <br> You can select Propagate route to adjacent Virtual Devices (IPv6) to \"advertise\" this Virtual System to neighboring Virtual Devices. This enables IPv6 connectivity between the neighboring Virtual Devices. <br> f. Click OK. <br> In the Routes section, click Add to configure the applicable static routes and the Default Route. <br> Click Next. |\r\n| E | On the Virtual System Cluster Creation Finalization page: <br> a. Click Finish and wait for the operation to finish. <br> b. Click View Report for more information. <br> c. Click Close. |\r\n| F | Examine the VSX configuration: <br> a. Connect to the command line on each VSX Cluster Member. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat $-v$ |\r\n\r\n13. Configure the second Virtual System object in SmartConsole\r\n\r\nSee\"Working with Virtual Systems\" on page 70.\r\n\r\n| Step | Instructions |\r\n| :--: | :--: |\r\n| A | From the left navigation toolbar, click Gateways \\& Servers. |\r\n| B | Open the second Virtual System object. <br> In our example: MyVs2 |\r\n| C | Enable the applicable Software Blades. <br> In our example: Mobile Access blade <br> Refer to: <br> - sk79700 - VSX supported features on R75.40VS and above <br> - sk106496 - Software Blades updates on VSX R75.40VS and above - <br> FAQ <br> - Applicable Administration Guides on the R81.20 Home Page. |\r\n| D | Configure other applicable settings. |\r\n| E | Click OK to push the updated VSX Configuration. |\r\n| F | Configure and install the applicable policy on the second Virtual System object. |\r\n| G | Examine the VSX configuration and VSX Cluster configuration: <br> a. Connect to the command line on each VSX Cluster Member. <br> b. Log in to Gaia Clish, or Expert mode. <br> c. Run: vsx stat $-v$ <br> d. Run: <br> - In Gaia Clish: show cluster state <br> - In the Expert mode: cphaprob state |\r\n\r\n# Working with Kernel Parameters \r\n\r\nSee the R81.20 Quantum Security Gateway Guide.\r\n\r\n# Kernel Debug on Security Gateway \r\n\r\nSee the R81.20 Quantum Security Gateway Guide.\r\n\r\n# Glossary \r\n\r\n## A\r\n\r\nAnti-Bot\r\nCheck Point Software Blade on a Security Gateway that blocks botnet behavior and communication to Command and Control (C\\&C) centers. Acronyms: AB, ABOT.\r\n\r\n## Anti-Spam\r\n\r\nCheck Point Software Blade on a Security Gateway that provides comprehensive protection for email inspection. Synonym: Anti-Spam \\& Email Security. Acronyms: AS, ASPAM.\r\n\r\n## Anti-Virus\r\n\r\nCheck Point Software Blade on a Security Gateway that uses real-time virus signatures and anomaly-based protections from ThreatCloud to detect and block malware at the Security Gateway before users are affected. Acronym: AV.\r\n\r\n## Application Control\r\n\r\nCheck Point Software Blade on a Security Gateway that allows granular control over specific web-enabled applications by using deep packet inspection. Acronym: APPI.\r\n\r\n## Audit Log\r\n\r\nLog that contains administrator actions on a Management Server (login and logout, creation or modification of an object, installation of a policy, and so on).\r\n\r\n## B\r\n\r\n## Bridge Mode\r\n\r\nSecurity Gateway or Virtual System that works as a Layer 2 bridge device for easy deployment in an existing topology.\r\n\r\n## C\r\n\r\n## Cluster\r\n\r\nTwo or more Security Gateways that work together in a redundant configuration - High Availability, or Load Sharing.\r\n\r\n# Cluster Member \r\n\r\nSecurity Gateway that is part of a cluster.\r\n\r\n## Compliance\r\n\r\nCheck Point Software Blade on a Management Server to view and apply the Security Best Practices to the managed Security Gateways. This Software Blade includes a library of Check Point-defined Security Best Practices to use as a baseline for good Security Gateway and Policy configuration.\r\n\r\n## Content Awareness\r\n\r\nCheck Point Software Blade on a Security Gateway that provides data visibility and enforcement. See sk119715. Acronym: CTNT.\r\n\r\n## CoreXL\r\n\r\nPerformance-enhancing technology for Security Gateways on multi-core processing platforms. Multiple Check Point Firewall instances are running in parallel on multiple CPU cores.\r\n\r\n## CoreXL Firewall Instance\r\n\r\nOn a Security Gateway with CoreXL enabled, the Firewall kernel is copied multiple times. Each replicated copy, or firewall instance, runs on one processing CPU core. These firewall instances handle traffic at the same time, and each firewall instance is a complete and independent firewall inspection kernel. Synonym: CoreXL FW Instance.\r\n\r\n## CoreXL SND\r\n\r\nSecure Network Distributer. Part of CoreXL that is responsible for: Processing incoming traffic from the network interfaces; Securely accelerating authorized packets (if SecureXL is enabled); Distributing non-accelerated packets between Firewall kernel instances (SND maintains global dispatching table, which maps connections that were assigned to CoreXL Firewall instances). Traffic distribution between CoreXL Firewall instances is statically based on Source IP addresses, Destination IP addresses, and the IP 'Protocol' type. The CoreXL SND does not really \"touch\" packets. The decision to stick to a particular FWK daemon is done at the first packet of connection on a very high level, before anything else. Depending on the SecureXL settings, and in most of the cases, the SecureXL can be offloading decryption calculations. However, in some other cases, such as with Route-Based VPN, it is done by FWK daemon.\r\n\r\n## CPUSE\r\n\r\nCheck Point Upgrade Service Engine for Gaia Operating System. With CPUSE, you can automatically update Check Point products for the Gaia OS, and the Gaia OS itself. For details, see sk92449.\r\n\r\n# D \r\n\r\n## DAIP Gateway\r\n\r\nDynamically Assigned IP (DAIP) Security Gateway is a Security Gateway, on which the IP address of the external interface is assigned dynamically by the ISP.\r\n\r\n## Data Loss Prevention\r\n\r\nCheck Point Software Blade on a Security Gateway that detects and prevents the unauthorized transmission of confidential information outside the organization. Acronym: DLP.\r\n\r\n## Data Type\r\n\r\nClassification of data in a Check Point Security Policy for the Content Awareness Software Blade.\r\n\r\n## Dedicated Management Interface\r\n\r\nSeparate physical interface on VSX Gateway or VSX Cluster Members, through which Check Point Security Management Server or Multi-Domain Server connects directly to VSX Gateway or VSX Cluster Members. DMI is restricted to management traffic, such as provisioning, logging and monitoring. Acronym: DMI.\r\n\r\n## Distributed Deployment\r\n\r\nConfiguration in which the Check Point Security Gateway and the Security Management Server products are installed on different computers.\r\n\r\n## Dynamic Object\r\n\r\nSpecial object type, whose IP address is not known in advance. The Security Gateway resolves the IP address of this object in real time.\r\n\r\n## E\r\n\r\n## Endpoint Policy Management\r\n\r\nCheck Point Software Blade on a Management Server to manage an on-premises Harmony Endpoint Security environment.\r\n\r\n## Expert Mode\r\n\r\nThe name of the elevated command line shell that gives full system root permissions in the Check Point Gaia operating system.\r\n\r\n# Gaia \r\n\r\nCheck Point security operating system that combines the strengths of both SecurePlatform and IPSO operating systems.\r\n\r\n## Gaia Clish\r\n\r\nThe name of the default command line shell in Check Point Gaia operating system. This is a restricted shell (role-based administration controls the number of commands available in the shell).\r\n\r\n## Gaia Portal\r\n\r\nWeb interface for the Check Point Gaia operating system.\r\n\r\n## H\r\n\r\n## Hotfix\r\n\r\nSoftware package installed on top of the current software version to fix a wrong or undesired behavior, and to add a new behavior.\r\n\r\n## HTTPS Inspection\r\n\r\nFeature on a Security Gateway that inspects traffic encrypted by the Secure Sockets Layer (SSL) protocol for malware or suspicious patterns. Synonym: SSL Inspection. Acronyms: HTTPSI, HTTPSi.\r\n\r\nI\r\n\r\n## ICA\r\n\r\nInternal Certificate Authority. A component on Check Point Management Server that issues certificates for authentication.\r\n\r\n## Identity Awareness\r\n\r\nCheck Point Software Blade on a Security Gateway that enforces network access and audits data based on network location, the identity of the user, and the identity of the computer. Acronym: IDA.\r\n\r\nIdentity Logging\r\nCheck Point Software Blade on a Management Server to view Identity Logs from the managed Security Gateways with enabled Identity Awareness Software Blade.\r\n\r\n# Internal Network \r\n\r\nComputers and resources protected by the Firewall and accessed by authenticated users.\r\n\r\n## IPS\r\n\r\nCheck Point Software Blade on a Security Gateway that inspects and analyzes packets and data for numerous types of risks (Intrusion Prevention System).\r\n\r\n## IPsec VPN\r\n\r\nCheck Point Software Blade on a Security Gateway that provides a Site to Site VPN and Remote Access VPN access.\r\n\r\n## J\r\n\r\n## Jumbo Hotfix Accumulator\r\n\r\nCollection of hotfixes combined into a single package. Acronyms: JHA, JHF, JHFA.\r\n\r\n## K\r\n\r\n## Kerberos\r\n\r\nAn authentication server for Microsoft Windows Active Directory Federation Services (ADFS).\r\n\r\n## L\r\n\r\n## Log Server\r\n\r\nDedicated Check Point server that runs Check Point software to store and process logs.\r\n\r\n## Logging \\& Status\r\n\r\nCheck Point Software Blade on a Management Server to view Security Logs from the managed Security Gateways.\r\n\r\nMain Domain Management Server\r\nDomain Management Server on a Multi-Domain Server, on which you configured the object of your VSX Gateway or VSX Cluster. In this case, objects of your Virtual Systems are defined on different Domain Management Servers (Target Domain Management Servers).\r\n\r\n# Management Interface \r\n\r\n(1) Interface on a Gaia Security Gateway or Cluster member, through which Management Server connects to the Security Gateway or Cluster member. (2) Interface on Gaia computer, through which users connect to Gaia Portal or CLI.\r\n\r\n## Management Server\r\n\r\nCheck Point Single-Domain Security Management Server or a Multi-Domain Security Management Server.\r\n\r\n## Manual NAT Rules\r\n\r\nManual configuration of NAT rules by the administrator of the Check Point Management Server.\r\n\r\n## Mobile Access\r\n\r\nCheck Point Software Blade on a Security Gateway that provides a Remote Access VPN access for managed and unmanaged clients. Acronym: MAB.\r\n\r\n## Multi-Domain Log Server\r\n\r\nDedicated Check Point server that runs Check Point software to store and process logs in a Multi-Domain Security Management environment. The Multi-Domain Log Server consists of Domain Log Servers that store and process logs from Security Gateways that are managed by the corresponding Domain Management Servers. Acronym: MDLS.\r\n\r\n## Multi-Domain Server\r\n\r\nDedicated Check Point server that runs Check Point software to host virtual Security Management Servers called Domain Management Servers. Synonym: Multi-Domain Security Management Server. Acronym: MDS.\r\n\r\n# Network Object \r\n\r\nLogical object that represents different parts of corporate topology - computers, IP addresses, traffic protocols, and so on. Administrators use these objects in Security Policies.\r\n\r\n## Network Policy Management\r\n\r\nCheck Point Software Blade on a Management Server to manage an on-premises environment with an Access Control and Threat Prevention policies.\r\n\r\n## Non-Dedicated Management Interface\r\n\r\nShared physical interface on VSX Gateway or VSX Cluster Members (supported only in versions R80.40 and lower), which carries user \"production\" traffic and through which Check Point Security Management Server or Multi-Domain Server connects to VSX Gateway or VSX Cluster Members. Non-DMI configuration requires the use of a Virtual Router or Virtual Switch. Acronym: Non-DMI.\r\n\r\n## Open Server\r\n\r\nPhysical computer manufactured and distributed by a company, other than Check Point.\r\n\r\n## $P$\r\n\r\n## Provisioning\r\n\r\nCheck Point Software Blade on a Management Server that manages large-scale deployments of Check Point Security Gateways using configuration profiles. Synonyms: SmartProvisioning, SmartLSM, Large-Scale Management, LSM.\r\n\r\n## Q\r\n\r\n## QoS\r\n\r\nCheck Point Software Blade on a Security Gateway that provides policy-based traffic bandwidth management to prioritize business-critical traffic and guarantee bandwidth and control latency.\r\n\r\n# R \r\n\r\n## Rule\r\n\r\nSet of traffic parameters and other conditions in a Rule Base (Security Policy) that cause specified actions to be taken for a communication session.\r\n\r\n## Rule Base\r\n\r\nAll rules configured in a given Security Policy. Synonym: Rulebase.\r\n\r\n## S\r\n\r\n## SecureXL\r\n\r\nCheck Point product on a Security Gateway that accelerates IPv4 and IPv6 traffic that passes through a Security Gateway.\r\n\r\n## Security Gateway\r\n\r\nDedicated Check Point server that runs Check Point software to inspect traffic and enforce Security Policies for connected network resources.\r\n\r\n## Security Management Server\r\n\r\nDedicated Check Point server that runs Check Point software to manage the objects and policies in a Check Point environment within a single management Domain. Synonym: Single-Domain Security Management Server.\r\n\r\n## Security Policy\r\n\r\nCollection of rules that control network traffic and enforce organization guidelines for data protection and access to resources with packet inspection.\r\n\r\n## SIC\r\n\r\nSecure Internal Communication. The Check Point proprietary mechanism with which Check Point computers that run Check Point software authenticate each other over SSL, for secure communication. This authentication is based on the certificates issued by the ICA on a Check Point Management Server.\r\n\r\n## SmartConsole\r\n\r\nCheck Point GUI application used to manage a Check Point environment - configure Security Policies, configure devices, monitor products and events, install updates, and so on.\r\n\r\n# SmartDashboard \r\n\r\nLegacy Check Point GUI client used to create and manage the security settings in versions R77.30 and lower. In versions R80.X and higher is still used to configure specific legacy settings.\r\n\r\n## SmartProvisioning\r\n\r\nCheck Point Software Blade on a Management Server (the actual name is \"Provisioning\") that manages large-scale deployments of Check Point Security Gateways using configuration profiles. Synonyms: Large-Scale Management, SmartLSM, LSM.\r\n\r\n## SmartUpdate\r\n\r\nLegacy Check Point GUI client used to manage licenses and contracts in a Check Point environment.\r\n\r\n## Software Blade\r\n\r\nSpecific security solution (module): (1) On a Security Gateway, each Software Blade inspects specific characteristics of the traffic (2) On a Management Server, each Software Blade enables different management capabilities.\r\n\r\n## Standalone\r\n\r\nConfiguration in which the Security Gateway and the Security Management Server products are installed and configured on the same server.\r\n\r\n## T\r\n\r\n## Target Domain Management Server\r\n\r\nDomain Management Server on a Multi-Domain Server, on which you configured the objects of your Virtual Systems. In this case, object of your VSX Gateway or VSX Cluster are defined on a different Domain Management Server (Main Domain Management Server).\r\n\r\n## Threat Emulation\r\n\r\nCheck Point Software Blade on a Security Gateway that monitors the behavior of files in a sandbox to determine whether or not they are malicious. Acronym: TE.\r\n\r\n## Threat Extraction\r\n\r\nCheck Point Software Blade on a Security Gateway that removes malicious content from files. Acronym: TEX.\r\n\r\nUpdate Object\r\nNetwork object that represents an external service, such as Microsoft 365, AWS, Geo locations, and more.\r\n\r\nURL Filtering\r\nCheck Point Software Blade on a Security Gateway that allows granular control over which web sites can be accessed by a given group of users, computers or networks. Acronym: URLF.\r\n\r\n# User Directory \r\n\r\nCheck Point Software Blade on a Management Server that integrates LDAP and other external user management servers with Check Point products and security solutions.\r\n\r\n## V\r\n\r\n## Virtual Device\r\n\r\nLogical object that emulates the functionality of a type of physical network object. Virtual Device can be on of these: Virtual Router, Virtual System, or Virtual Switch.\r\n\r\n## Virtual Router\r\n\r\nVirtual Device on a VSX Gateway or VSX Cluster Member that functions as a physical router. Acronym: VR.\r\n\r\n## Virtual Switch\r\n\r\nVirtual Device on a VSX Gateway or VSX Cluster Member that functions as a physical switch. Acronym: VSW.\r\n\r\n## Virtual System\r\n\r\nVirtual Device on a VSX Gateway or VSX Cluster Member that implements the functionality of a Security Gateway. Acronym: VS.\r\n\r\n## Virtual System Load Sharing\r\n\r\nVSX Cluster technology that assigns Virtual System traffic to different Active Cluster Members. Acronym: VSLS.\r\n\r\n# VSX \r\n\r\nVirtual System Extension. Check Point virtual networking solution, hosted on a computer or cluster with virtual abstractions of Check Point Security Gateways and other network devices. These Virtual Devices provide the same functionality as their physical counterparts.\r\n\r\n## VSX Gateway\r\n\r\nPhysical server that hosts VSX virtual networks, including all Virtual Devices that provide the functionality of physical network devices. It holds at least one Virtual System, which is called VS0.\r\n\r\n## W\r\n\r\n## Warp Jump\r\n\r\nIf two Virtual Systems connect to the same Virtual Switch or Virtual Router, then internally traffic that must pass from a network behind one Virtual System to a network behind another Virtual System, \"jumps\" from one Virtual System to another Virtual System without passing through the Virtual Switch or Virtual Router.\r\n\r\n## Warp Link\r\n\r\nLogical interface that is created automatically in a VSX topology between: (1) Virtual System and Virtual Switch (2) Virtual System and Virtual Router. Acronym: WRP.\r\n\r\n## Z\r\n\r\n## Zero Phishing\r\n\r\nCheck Point Software Blade on a Security Gateway (R81.20 and higher) that provides real-time phishing prevention based on URLs. Acronym: ZPH.","language":"md","time":"14 days ago","created":"2025-05-06T22:33:53.107Z","annotations":[],"updated":"2025-05-06T22:33:56.356Z"},{"title":"Free Demo Contact Us","id":"72dfaf44-fe5a-4f05-a99f-c2b21c5c3c7c","type":"CODE","raw":"Free Demo\nContact Us\nSupport Center\nBlog\nWelcome: \nMichael Osborne\n  |  \nSign out\n  \n\nSALES & KNOWLEDGE\nMARKETING\nCUSTOMER ACQUISITIONS\nSUPPORT\nMY CHECK POINT\n\nSupport Center\n/\nSearch Results\n/\nSecureknowledge Details\n\nMy Favorites\nSolution ID: sk167135\nTechnical Level:\nAdvanced\nIL\nUS\n\nEdit\n\nEmail\n\nPrint\n\nSubscribe\n\nPolicy-Based Routing and Application-Based Routing in Gaia\nProduct\nQuantum Security Gateways\nVersion\nR80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\nOS\nGaia\nLast Modified\n2025-01-21\nSolution\nTable of Contents\n\n(1) Scope\n(2) Overview\n(3) Configuration\n(3.1) Configuration Example\n(3.2) Configuring Policy-Based Routing (PBR) in Gaia Portal\n(3.3) Configuring Policy-Based Routing (PBR) in Clish\n(4) Enabling Firewall rule matching in PBR (Application-Based Routing)\n(4.1) Configuring Application-Based Routing (ABR) in Gaia Portal\n(4.2) Configuring Application-Based Routing (ABR) in Clish\n(5) Supported Functionality and Limitations\n(6) References\n\n(1) Scope\nThis article presents a high-level description of the features and explains the use of Policy-Based Routing and Application-Based Routing with simple examples, and supplements the Routing Administration Guide. We also document the differences between multiple releases starting from R80.10.\n\nCustomers use Policy-Based Routing (PBR) along with other features in various topologies and look for confirmation about its use. We highlight those issues, but cannot describe all possible scenarios.\n\nStarting from R80.40, PBR works with Access Control policy (Firewall rules) to decide how traffic forwarding occurs. This applies to many more scenarios where the traffic can be intelligently forwarded based on these aspects as supported by the Firewall rules:\n\nApplication\nService\nUsers\nTime\nLocation\nand more\nGoing forward, PBR plays a significant role in Application-Based Routing (ABR) based on the core infrastructure that is already in place.\n\n(2) Overview\nPolicy-Based Routing (PBR) enables Gaia OS to route traffic to specific destinations that differ from the default routes maintained in the OS main routing table. You can direct traffic based on source (this may include single hosts to entire networks) and destination (also single hosts or entire networks). This greatly improves the control that network administrators have in routing traffic through a network. For example, a company may want all traffic from a specific source to use a different route instead of through the default gateway. To forward traffic based on PBR rules, you create user-defined PBR routing tables and corresponding routing policies to filter the traffic based on one or more of these:\n\nInbound Interface at which a packet arrives.\nSource IPv4 address and subnet mask.\nDestination IPv4 address and subnet mask.\nDestination Service Port Number (e.g., FTP, SSH, Telnet).\nProtocol Number (e.g., TCP, UDP, ICMP).\nFirewall Rule Number (introduced as a hidden feature in R80.40 for Application-Based Routing, such as Office365).\nThe Policy Rules also specify the action to take if the traffic is matched:\n\nProhibit - Send a \"Prohibit\" message to the sending host.\nUnreachable - Send an \"Unreachable\" message to the sending host.\nTable - Process the traffic according to rules defined in an Action Table.\nUsers can define and configure many PBR rules. Inbound traffic is matched against all the rules in order of the rule's priority: one rule at a time, according to the priority that is configured for the rule.\n\nPolicy-Based Routing takes precedence over normal routing. When a packet arrives at the Firewall and is accepted based on configured policy, the packet is checked for a match to a PBR rule:\n\nIf the packet matches a rule, it is then forwarded according to the routing information in the corresponding action table.\nIf the packet does not match any of the configured PBR rules, the packet is then forwarded according to the routes in the OS main routing table.\n\nApplication-Based Routing\nUsers who want to make traffic forwarding decisions based on applications not just limited to basic criteria, like inbound interface and source/destination addresses, can use Firewall rules in PBR rules and associate those firewall rules with corresponding PBR routing tables (action tables).\n\nTypical customer use case (see Figure 1, below): A customer wants to route all the traffic to the internet on the primary ISP link, except for Office365 traffic which is routed over a dedicated secondary link.\n\nThe exception can be any specific application or a cloud service. Currently, the Firewall has the capability to detect, classify and apply Firewall rules to the traffic. ABR extends PBR functionality to include Firewall rules as additional criteria to route traffic on a specified link.\n\nThis extension of PBR functionality is not just limited to the above use case but applies to many more cases where the traffic can be differentiated based on application, service, users, time and location, as supported by Firewall rules. As of now, extensive testing has been performed on the most widely used applications like Office365, Amazon and Zoom, and in general ABR is ready to support various other Updatable Objects available in CP product.\n\n\n(3) Configuration\nImportant - In a cluster, you must configure identical PBR settings on all cluster members.\n\nSupported cluster configurations:\n\nClusterXL High Availability\nClusterXL Load Sharing Unicast\nClusterXL Load Sharing Multicast\nVRRP on Gaia OS\nConfiguration in Gateway mode and VSX mode:\n\nIn Gateway mode:\n\nYou can configure PBR in Gaia Portal, or Gaia Clish.\n\nIn VSX mode:\n\nIn R80.40 and higher:\n\nYou can configure PBR on Virtual Systems and on Virtual Routers.\n\nPBR on Virtual Systems:\n\nYou can configure Source IP, Destination IP, Interface, Destination service port, and Protocol.\n\nPBR on Virtual Routers:\n\nNote - VSLS supports Virtual Routers only in R81 and higher versions.\n\nYou can configure PBR in SmartConsole in the Virtual Router object (you must install the relevant Security Policy).\nYou can configure PBR in Gaia Clish.\nYou can configure only Source IP, Destination IP, and the Interface.\nYou cannot configure additional parameters (destination service port and protocol).\nIn R80.30 and lower:\n\nYou can configure PBR only on Virtual Routers (Virtual Systems do not support PBR).\n\nPBR on Virtual Routers:\n\nNote - VSLS does not support Virtual Routers in these versions.\nYou can configure PBR in SmartConsole (R80 and higher) / SmartDashboard (R77.30 and lower) in the Virtual Router object (you must install the relevant Security Policy).\nYou can configure PBR in Gaia Clish.\nYou can configure only Source IP, Destination IP, and the Interface.\nYou cannot configure additional parameters (destination service port and protocol).\nThe configuration process consists of two parts:\n\nConfiguring the Action Table\nConfiguring the PBR Rules\nMake sure the following items have been completed before attempting to configure PBR:\n\nThe Security Gateway must be fully configured (including all the relevant Software Blades)\nPolicy must be installed on Security Gateway\nBasic routing should be working as expected\n\nConfiguration Example\nThe following scenario will be used to demonstrate the PBR configuration both in Gaia Portal and in Gaia Clish:\n\nRequired configuration:\n\nDefault path for the traffic from the internal network (55.226.23.0/24) destined for Internet via ISP2 (205.226.23.0/24) using the ISP2's next hop gateway 205.226.23.1\nSpecific traffic type HTTPS (destination service port 443) should be sent via ISP1 using the ISP1's next hop gateway 105.226.23.1\nFigure 1 - Example Network Topology\n\n\n\nFigure 2 - Gaia Portal - Interface Configuration\n\n\n\nFigure 3 - Gaia Portal - IPv4 Static Routes Configuration\n\n\n\n\n(3.2) Configuring Policy-Based Routing (PBR) in Gaia Portal\nConnect to Gaia Portal on the Security Gateway / Cluster Member in your web browser at:\n\nhttps://IP_Address_of_Security_Gateway\n\nMake sure to select the View Mode \"Advanced\" (in the top left corner).\n\nGo to Advanced Routing > Policy Based Routing.\n\n\n\nIn the Action Tables section, click the Add button.\n\nConfigure the Policy Table as explained below:\n\nParameter\tDescription\tExample\nTable Name\n\nThe name of the Policy Table.\tISP1\nTable ID\n\nA numerical ID for the Policy Table. Assigned by the system.\t1\nDefault Route\n\nThe default static route in the system routing table.\tSelected\nDestination\n\nThe destination of the route.\tNot Needed\nSubnet Mask\n\nSubnet mask for the destination of the route.\tNot Needed\nNext Hop Type\n\nSelect one of these:\n\nNormal - Accept and forward packets.\nReject - Drop packets and send unreachable messages.\nBlack Hole - Drop packets but don't send unreachable messages.\nNormal\nIn the Add Gateway section, click the Add Gateway button.\n\nConfigure the next hop Gateway and click on OK button:\n\nParameter\tDescription\tExample\nGateway Type\t\nEither IP address of the remote next hop gateway,\nor interface of type Point-to-Point belongs to the Security Gateway:\n\nGateway IP address: IPv4 address of the next hop gateway.\nGateway Interface: Name of the Security Gateway's P-t-P interface that leads to the next hop gateway.\n105.226.23.1\nGateway Priority\t\nThe preference of the particular route.\n\nRange: 1-8.\n\n1\nExamine the final Policy Table configuration and click the Save button.\n\nIn the Policy Rules section, click the Add button.\n\nThe Add Policy Rule window opens.\n\nParameter\tDescription\tExample\nPriority\t\nMany Policy Rules can be defined.\n\nTraffic is compared to each rule, in order of their priorities, until a match is found, or all Policy Rules have been checked.\n\n1\nAction\t\nThe action to take when traffic matches the rule:\n\nProhibit - Send a \"Prohibit\" message to the sending host.\nUnreachable - Send an \"Unreachable\" message to the sending host.\nTable - Perform the actions defined in an Action Table\nTable: ISP1\nMatch\t\nThis section specifies the criteria which traffic must match in order for the Policy Rule to apply.\n\nOne or more of the following may be used (in this case, traffic must match each criterion in order for the system to apply the Policy Rule):\n\nInterface - The interface on which the traffic was received from the host by the Security Gateway.\nSource, Subnet mask - The IPv4 address and subnet mask of the source.\nDestination, Subnet mask - The IPv4 address and subnet mask of the destination.\nService port - Enter the destination service port. Some pre-defined ports are: FTP data (20), SSH (22), Telnet (23), HTTP (80), HTTPS (443).\nProtocol - Enter the protocol number. Some pre-defined protocols are: ICMP (1), TCP (6), UDP (17).\nInterface/Source/Destination is mandatory, so that match will be unique to either Client-to-Server traffic, or Server-to-Client traffic (but not both).\n\nInterface: eth2\n\nService port: HTTPS\n\nProtocol: TCP\n\n\n\nConfigure the Policy Rule and click the Save button:\n\nExamine the final Policy-Based Routing configuration:\n\nTo make sure routing is working as expected, refer to step 8 in the following section (3.3).\n\n\n(3.3) Configuring Policy-Based Routing (PBR) in Gaia Clish\nNote: In VSX mode, to configure a Virtual Router / Virtual System, you must first change the context to that Virtual Device with the \"set virtual-system <VSID>\" command.\n\nConnect to command line on Gaia OS (over SSH, or console).\n\nLog in to Gaia Clish.\n\nEnsure you have the database lock, so you can change Gaia configuration:\n\nlock database override\n\nCreate an Action Table that will have the specific routes:\n\nset pbr table NAME_OF_ACTION_TABLE static-route <NETWORK_ADDRESS>/<MASK_LENGTH> nexthop gateway address <IP_ADDRESS> on\n\nBased on our example scenario:\n\nset pbr table ISP1 static-route default nexthop gateway address 105.226.23.1 on\n\nCreate the Policy Rule\n\nset pbr rule priority <PRIORITY> match interface <INTERFACE_NAME>\n\nset pbr rule priority <PRIORITY> action table <NAME_of_ACTION_TABLE>\n\nBased on our example scenario:\n\nset pbr rule priority 1 match interface eth2\n\nset pbr rule priority 1 action table ISP1\n\nNote: To use destination service port or protocol, the example commands are:\n\nset pbr rule priority 1 match port 443\n\nset pbr rule priority 1 match protocol tcp\n\nSave the Gaia configuration:\n\nsave config\n\nExamine the final Policy-Based Routing configuration:\n\nshow pbr summary\n\nExample output based on our scenario:\n\nHostName> show pbr summary\nPBR Summary\n    PBR has 1 table\n        PBR table ISP1 (ID=1) has 1 route\n            Default route, nexthop gateway\n                gateway 105.226.23.1\n                        preference 1\n    PBR has 1 rule\n        PBR rule 1 interface eth2 port 443 protocol TCP (6) table 1\nMake sure routing is working as expected:\n\nGet the number of the relevant rule:\n\n[Expert@HostName]# ip rule\nExample output:\n\n[Expert@HostName]# ip rule\n0:      from all lookup local\n1:      from all fwmark 0x1bb20/0xfffff0 iif eth2 lookup 1\n32766:  from all lookup main\n32767:  from all lookup default\nGet the route table for the relevant rule:\n\n[Expert@HostName]# ip route show table <NUMBER_OF_RULE>\nExample output:\n\n[Expert@HostName]# ip route show table 1\ndefault via 105.226.23.1 dev eth1 proto 7\n\n[Expert@HostName]# ip route\ndefault via 205.226.23.1 dev eth0 proto 7\n55.226.23.0/24 dev eth2 proto kernel scope link src 55.226.23.44 \n105.226.23.0/24 dev eth1 proto kernel scope link src 105.226.23.44 \n205.226.23.0/24 dev eth0 proto kernel scope link src 205.226.23.44\nUse the 'fw monitor' command to trace the packet flow in the Security Gateway.\n\nIn R80.40 and higher:\n\nfw monitor -F \"55.226.23.44,0,0.0.0.0,443,0\"\n\nIn R80.30 and lower:\n\nfw monitor -e \"src = 55.226.23.44 and dport = 443, accept;\n\nExample output:\n\n[vs_0][fw_0] eth2:i[52]: 55.226.23.44 -> 40.97.164.146 (TCP) len=52 id=12814\nTCP: 49239 -> 443 .S.... seq=82c694f7 ack=00000000\n[vs_0][fw_0] eth2:I[52]: 55.226.23.44 -> 40.97.164.146 (TCP) len=52 id=12814\nTCP: 49239 -> 443 .S.... seq=82c694f7 ack=00000000\n[vs_0][fw_0] eth1:o[52]: 55.226.23.44 -> 40.97.164.146 (TCP) len=52 id=12814\nTCP: 49239 -> 443 .S.... seq=82c694f7 ack=00000000\n[vs_0][fw_0] eth1:O[52]: 55.226.23.44 -> 40.97.164.146 (TCP) len=52 id=12814\nTCP: 49239 -> 443 .S.... seq=82c694f7 ack=00000000\n\n(4) Enabling Firewall rule matching in PBR (Application-Based Routing)\nThe purpose of extending the basic PBR rule criteria to include Firewall rule is to enable users to match on configured Firewall rules and forward traffic accordingly. This extension of PBR functionality forwards the traffic based on application, service, users, time, location, and many more, as supported by FW rules.\n\nCurrently, this feature is supported to direct Office365 traffic to Microsoft Cloud and is being tested with other updatable SaaS and cloud service objects.\n\nThis feature is currently hidden. To enable it, run these commands on the Security Gateway in the Expert mode and reboot:\n\nHostName:0# dbset process:rtgpbrd:runlevel 4\n\nHostName:0# dbset process:rtgpbrd:path /bin\n\nHostName:0# dbset process:rtgpbrd t\n\nHostName:0# dbset :save\n\nHostName:0# reboot\n\n\nConfiguring FW rules in SmartConsole\n\n\nConnect to the Management Server with SmartConsole and go to the Security Policies view.\n\nIn the top Access Control section, click Policy.\n\nAdd the required Access Control rules as described below:\n\nAdd a rule with the name that starts with the prefix \"PBR_\", so that this rule name will appear as an option for creating PBR rule on the Security Gateway.\n\nTo connect with Office365 services, select an Updatable object with the name \"Office365 Worldwide Services\" in the Destination column of the rule. See sk135572.\n\nAdd the http and https services in the Services and Applications column to access the cloud services.\n\nIn other columns, enter the applicable objects as needed.\n\nClick Install Policy > select the applicable policy and the Security Gateway / Cluster object.\n\nThe remaining PBR configuration should be done on the Security Gateway / Cluster Members in Gaia Portal or Gaia Clish.\n\nThe FW rule name appears in the drop-down list of FW rules with the prefix \"PBR_\".\n\nExample:\n\n\n\n\nKnown PBR limitations for using FW rules\nMake sure that all PBR rules have to be defined above non-PBR rules which have \"any-any\" in source and destination fields, as shown in the screenshot below. In this case, possible match will be (2), (3) or (4) based on the destination field and not rule number (5). In case of rule number (5), it takes few packets to determine the type of service and initial packets can't be routed on a specific path defined by ABR rules.\n\nRemember that for ABR/PBR to work properly, FW rule has to be unique and can be applied to the first packet of the connection.\n\nABR doesn't work with rule base hierarchy (inner layers).\n\nSee section 5 below for other limitations associated with PBR/ABR.\n\n\n\n\nTroubleshooting Tips:\nThe Security Gateway writes the FW rules to the file /tmp/fwpbrrules.conf when you install the Security Policy on the Security Gateway.\n\nExample:\n\n[Expert@GW:0]# cat /tmp/fwpbrrules.conf\n1 63c094b7-d27a-4a72-bf73-a0d74bbb8554 \"PBR_ToOffice365Service\"\nCheck if the process 'rtgpbrd' is running.\n\nThis process writes the FW rules to the /tmp/fwpbrrules.conf file.\n\nExample:\n\n[Expert@GW:0]# ps aux | grep rtgpbrd\nadmin  7325  0.0  0.0   5868  1688 ?  Ss  03:06 0:00 /bin/rtgpbrd\nThe Security Gateway saves the FW rules in the Gaia database.\n\nExample:\n\n[Expert@GW:0]# dbget -arv fwrules\nfwrules:instance\nfwrules:instance:default\nfwrules:instance:default:rulenum\nfwrules:instance:default:rulenum:1 t\nfwrules:instance:default:rulenum:1:name PBR_ToOffice365Service\nfwrules:instance:default:rulenum:1:uuid 63c094b7-d27a-4a72-bf73-a0d74bbb8554\n\n(4.1) Configuring Application-Based Routing (ABR) in Gaia Portal\nFollow the steps from 1 to 7 (above) mentioned for normal PBR configuration and create Action Table \"ISP1\".\n\nIn the Policy Rules section, click the Add button.\n\nThe Add Policy Rule window opens:\n\nParameter\tDescription\tExample\nPriority\tMany Policy Rules can be defined. Traffic is compared to each rule, in order of their priorities, until a match is found, or all Policy Rules have been checked.\t1\nAction\t\nThe action to take when traffic matches the rule:\n\nProhibit - Send a \"Prohibit\" message to the sending host.\nUnreachable - Send an \"Unreachable\" message to the sending host.\nTable - Perform the actions defined in an Action Table.\nTable: ISP1\nMatch\t\nThis section specifies the criteria traffic must match in order for the Policy Rule to apply.\n\nOne or more of the following may be used; in this case, traffic must match each criterion in order for the system to apply the Policy Rule.\n\nInterface - The interface on which the traffic was received from the host by the Security Gateway.\nSource, Subnet mask - The IPv4 address and subnet mask of the source.\nDestination, Subnet mask - The IPv4 address and subnet mask of the destination.\nService port - Enter the destination service port. Some pre-defined ports are: FTP data (20), SSH (22), Telnet (23), HTTP (80), HTTPS (443).\nProtocol - Enter the protocol number. Some pre-defined protocols are: ICMP (1), TCP (6), UDP (17).\nFirewall Rules - Select the FW rule from the drop-down list * (must not be the only criteria, see the note below)\nInterface, Source, or Destination is mandatory so that match will be unique to either Client-to-Server traffic, or Server-to-Client traffic (but not both).\n\nInterface: eth2\n\nFirewall Rules: PBR_Office365Services\n\nConfigure the Policy Rule and click the Save button:\n\n\n\nExamine the final Policy-Based Routing configuration.\n\nTo make sure routing is working as expected, refer to step 5 in the following section (4.2).\n\n\n(4.2) Configuring Application-Based Routing (ABR) in Gaia Clish\nFollow the steps from 1 to 4 (above) mentioned for normal PBR configuration and create Action Table\n\nCreate the Policy Rule:\n\nset pbr rule priority PRIORITY match from interface <INTERFACE_NAME>\n\nset pbr rule priority PRIORITY match fwrule <FWRULE_NUMBER>\n\nset pbr rule priority PRIORITY action table <NAME_OF_ACTION_TABLE>\n\nBased on our example scenario:\n\nset pbr rule priority 1 match interface eth2\n\nset pbr rule priority 1 match fwrule\n\n1.PBR_ToOffice365Service off\n\nset pbr rule priority 1 match fwrule 1\n\nSave the Gaia configuration:\n\nsave config\n\nExamine the final Policy-Based Routing configuration:\n\nshow pbr summary\n\nExample output based on the scenario:\n\nHostName> show pbr summary\nPBR Summary\n    PBR has 1 table\n        PBR table ISP1 (ID=1) has 1 route\n            Default route, nexthop gateway\n                gateway 105.226.23.1\n                        preference 1\n    PBR has 1 rule\n        PBR rule 1 interface eth2 fwrule 1 table 1\nTo make sure routing is working as expected:\n\nGet the number of the relevant rule:\n\n[Expert@HostName]# ip rule\nExample output:\n\n[Expert@HostName]# ip rule\n0:      from all lookup local\n1:      from all fwmark 0x1000000/0xff000000 iif eth2 lookup 1\n32766:  from all lookup main\n32767:  from all lookup default\nGet the route table for the relevant rule:\n\n[Expert@HostName]# ip route show table <NUMBER_OF_RULE>\nExample output:\n\n[Expert@HostName]# ip route show table 1\ndefault via 105.226.23.1 dev eth1 proto 7\n\n[Expert@HostName]# ip route\ndefault via 205.226.23.1 dev eth0 proto 7\n55.226.23.0/24 dev eth2 proto kernel scope link src 55.226.23.44\n105.226.23.0/24 dev eth1 proto kernel scope link src 105.226.23.44\n205.226.23.0/24 dev eth0 proto kernel scope link src 205.226.23.44\nUse the \"fw monitor\" command to trace the packet flow in the Security Gateway.\n\nExample:\n\nfw monitor -e \"src = 55.226.23.44 and dport = 443, accept;\"\n\n\n(5) Supported Functionality and Limitations\nEnter the string to filter this table: \n\n\n#\tFeature\tRelease\tPBR\tABR\tComments\n1\t\nSupport for Port and Protocol as traffic criteria or filter\n\nR81 and higher\nR80.40\nR80.30\nYes\tN/A\tPort and Protocol is a PBR feature, not applicable to ABR\nR80.20\nR80.10\nNo\tN/A\t \n2\t\nSupport for Firewall Rule as a traffic criteria or a filter\n\nR81 and higher\nR80.40\nYes\tYes\tABR is a hidden feature.\nABR does not work with rule base hierarchy (inner layers).\nR80.30\nR80.20\nR80.10\nNo\tNo\t \n3\t\nClustering (including VRRP on Gaia OS)\n\nR81 and higher\nR80.40\nYes\tYes\tABR is a hidden feature.\nABR does not work with rule base hierarchy (inner layers).\nR80.30\nR80.20\nR80.10\nYes\tNo\t \n4\t\nVSX\n\nR81 and higher\nR80.40\nYes\tYes\tSupports per-VS configuration in Gaia Clish.\nSupports VR in SmartConsole.\nR80.30\nR80.20,\nR80.10\nYes\tNo\tNo support for per-VS configuration in Gaia Clish.\nSupports VR in SmartConsole.\n5\t\nSupport for IP Reachability\n\nR81 and higher\nR80.40\nYes\tYes\tSee the Gaia Advanced Routing Guide for your version.\nIP Reachability is used as a route monitoring tool, e.g., to check the route to Internet via ISP routers or any other gateway/host in the path.\nR80.30\nYes\tNo\nR80.20\nR80.10\nNo\tNo\t \n6\t\nNormal Ethernet Interface\n\nR81 and higher\nR80.40\nYes\tYes\tABR is a hidden feature.\nABR does not work with rule base hierarchy (inner layers).\nR80.30\nR80.20\nR80.10\nYes\tNo\t \n7\t\nGRE Tunnel\n\nR81 and higher\nYes\tYes\tABR is a hidden feature.\nABR does not work with rule base hierarchy (inner layers).\nR80.40\nR80.30\nR80.20\nR80.10\nNo\tNo\t \n8\t\nRoute-based VPN (VTI)\n\nR81 and higher\nR80.40\nYes\tYes\tABR is a hidden feature.\nABR does not work with rule base hierarchy (inner layers).\nR80.30\nR80.20\nR80.10\nNo\tNo\tTraffic cannot be forwarded to VTI using PBR or ABR.\nIn most scenarios, VTI is used as the default route, and PBR-based exceptions are routed to non-VTI interfaces.\n9\t\nDomain-based VPN\n\nR81 and higher\nR80.40\nR80.30\nR80.20\nR80.10\nNo\tNo\tPBR and ABR are not supported for any release\n10\t\nLocally-generated traffic\n\nR81 and higher\nR80.40\nR80.30\nR80.20\nR80.10\nNo\tNo\tPBR rules are applied only to traffic that passes through the Security Gateway\n11\t\nSecurity Servers\n\nR81 and higher\nR80.40\nR80.30\nR80.20\nR80.10\nNo\tNo\tPBR rules are not applied to packets that the Security Gateway generates\n12\t\nSoftware Blades and related features\n\nR80.40 and higher\n(*) In some cases, support is added in Jumbo Hotfixes\tYes\tYes\t\nPBR should work with Software Blades that use the 'CP Passive Streaming Library (PSL)' and the 'CP Active Streaming Library (CPAS)'.\n\nThese Software Blades and features are certified with PBR:\n\nNAT\nVPN\nIPS\nURL Filtering \nApplication Control \nAnti-Bot\nHTTPS Inspection\nIdentity Awareness\nThese Software Blades and features are certified with ABR:\nNAT\nIPS\nHTTPS inspection\nIdentity Awareness\nABR does not work in these scenarios:\nHTTP Proxy \nRule Base hierarchy (inner layer structure)\nSecurity Zones\nR80.30\nR80.20\nR80.10\nNo\tNo\t\n13\t\nISP Redundancy\n\nR81 and higher\nR80.40\nR80.30\nR80.20\nR80.10\nNo\tNo\tConflicts with PBR and ABR rules\n14\t\nCloud Services\n\nOffice365 Services\nAWS\nR81 and higher\nR80.40\nYes\tYes\t\nCheck Point QA tested Office365 and AWS\n\nR80.30\nR80.20\nR80.10\nNo\tNo\t \n15\tIPv6\t\nR81 and higher\nR80.40\nR80.30\nR80.20\nR80.10\nNo\tNo\tPlanned for future releases\n16\tSupport for Management and Data Plane Separation (MDPS)\t\nR81 and higher\nR80.40\nR80.30\nR80.20\nR80.10\nNo\tNo\tNot possible with PBR, see sk138672\n17\t\nCheck Point Active Streaming (CPAS)\n\nR81.10 and higher\nYes\tYes\t\nR81\nR80.40\nR80.30\nR80.20\nR80.10\nNo\tNo\tSupport for CPAS was integrated in:\nR81 Jumbo Hotfix Accumulator, Take 25 (PRJ-18663)\nR80.40 Jumbo Hotfix Accumulator, Take 100 (PRJ-18662)\n18\t\nLimit on the number of rules in Access Control (Firewall) policy\n\nAll versions\nYes\tNo\t\nPBR does not have a limit\n\nABR supports a maximum of 255 rules\n\n\n(6) References\nGaia Administration Guide for your version\nGaia Advanced Routing Administration Guide for your version\nsk135572 - Microsoft Office 365 objects as Network Objects in R80.20 and above\nArticle Properties\nOriginator\nKaren Brim\nTechnical Resource\nRaghuram Devarakonda\nAccess Level\nAdvanced\nStatus\nApproved\nDate Created\n2020-06-10\nLast Modified\n2025-01-21\nEditor\nGil Frantsus\nLast Approver\nStella Shteinbuk\nComments\nInternal only\nThis SK applies to R82.10 as well\n\nWill be updated with every new Main Train release.\n\nPer Raghuram Devarakonda in TM-45677, ABR supports up to 255 rules in the rulebase.\n\nWhen there are more than 255 fw rules, ABR trims the upper most byte.\nFor example if we have a fw rule number 578 ==> 0x242, after trimming -> 0x42 ==> 66 -> will go to fw rule 66 instead of fw rule 578.\n\nWas this page helpful?\nYes\nNo\nHaven't found what you're looking for?\nOur customer support team is only a click away and ready to help you 24 hours a day.\nOpen a Service Request\nFollow Us\nYOU DESERVE THE BEST SECURITY™\n©1994-2025 Check Point Software Technologies Ltd. All rights reserved.\nCopyright | Privacy Policy | User Agreement","language":"sql","time":"14 days ago","created":"2025-05-06T22:41:47.736Z","annotations":[],"updated":"2025-05-06T22:41:49.200Z"},{"title":"Configuring Network Address Translation (NAT) on Check Point Security Gateways","id":"2b7d2b40-939f-4465-9be9-cc110e958500","type":"TEXT","raw":"ProductQuantum Security Gateways\n\nVersionR77.30 (EOS)\n\nLast Modified2021-02-11\n\n## Solution\n\n**For R80.x, refer to the \"Configuring the NAT Policy\" section of the [Security Management R80.40 Administration Guide](https://sc1.checkpoint.com/documents/R80.40/WebAdminGuides/EN/CP_R80.40_SecurityManagement_AdminGuide/Default.htm)**\n\nDefining Network Address Translation (NAT) via the network object automatically adds Rules to the Network Translation Rule Base. The Translation method can be either \"Hide\" or \"Static\".\n\nThe Global Properties section for NAT contains an option called \"Automatic ARP configuration\". Automatic ARP configuration ensures that ARP requests for a translated (NATed) machine, network or address range are answered by the Security Gateway. You no longer have to manually add a route on a Security Gateway to ensure proper routing of Static NAT devices. In addition, there is no longer a need for Manual ARP configuration via the`$FWDIR/conf/local.arp` file on the Security Gateway (details are in [sk30197](primus://skcenter.checkpoint.comsk30197)).  \n \n\n**Configuring Hide NAT**\n\nIn Hide NAT, a single public address is used to represent multiple computers on the internal network with private addresses (many-to-one relation). Hide NAT allows connections to be initiated only from the protected side of the Security Gateway that is protecting this object (Check Point, or Externally Managed Gateway or Host, Gateway node, or Host node).\n\nEnabling Hide NAT on the network object will add the appropriate rule to the NAT Rule Base. Perform the following steps to enable Hide NAT for your internal network:\n\n1.  Login to SmartDashboard.\n2.  Create the network object for the internal network.\n3.  Define the following fields:  \n    -   Name\n    -   Network Address\n    -   Net Mask\n    -   Comments\n    -   Color\n4.  Select the NAT tab, and enable the option \"Add Automatic Address Translation rules\".\n5.  Select the Translation method \"Hide\".\n6.  Select \"Hide behind gateway\". This NAT configuration hides the real address behind the IP address of the Security Gateway interface, through which the packet is routed out.\n7.  Click 'OK'.\n8.  Install the Security Policy onto the Gateway that will perform the NAT.\n\n**Configuring Static NAT**\n\nIn Static NAT, each private address is translated to a corresponding public address (one-to-one relation). Static NAT allows machines on both sides of the Security Gateway, protecting this object (Check Point, or Externally Managed Gateway or Host, Gateway node, or Host node), to initiate connections, so that, for example, internal servers can be made available externally.\n\nStatic NAT is used for Web, e-mail, and other application servers that require routable public IP addresses. These servers will be routable to the Internet, but will also retain their internal IP addresses for internal access.\n\nPerform the following steps to enable Static NAT for your Web or email server:\n\n1.  Login to SmartDashboard.\n2.  Create a Host Node object for the server.\n3.  Define the following fields:  \n    -   Name\n    -   Real IP address\n    -   Comment\n    -   Color\n4.  Select the NAT tab, and enable \"Add Automatic Address Translation rules\".\n5.  Select the Translation method \"Static\".\n6.  Enter the desired public IP address in the \"Translate to IP address\" field. The Translate to IP Address value for Static NAT is a virtual IP address, which is a public (routable) IP address that does not belong to any real machine.\n7.  Click 'OK'.\n8.  Install the Security Policy onto the Gateway that will perform the NAT.\n\n  \nFor more detailed information, refer to [Firewall R77 Administration Guide](https://sc1.checkpoint.com/documents/R77/CP_R77_Firewall_WebAdmin/html_frameset.htm)\n\n## Article Properties\n\nOriginatorNancy Hines\n\nTechnical ResourceYosi Havilo\n\nAccess LevelGeneral\n\nStatusApproved\n\nDate Created2005-02-24\n\nLast Modified2021-02-11\n\nEditorDavid Kornfield\n\nLast ApproverRonen Zel","language":"md","time":"14 days ago","created":"2025-05-06T22:55:53.985Z","annotations":[],"updated":"2025-05-06T22:56:21.267Z"},{"title":"VPN Troubleshooting Solutions for Checkpoint IPSec VPN","id":"7062fc05-7d51-4597-acb7-bccb0f0cec58","type":"TEXT","raw":"---\ncreated: 2025-04-29T18:43:28 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk32788\nauthor: \n---\n\n# sk32788 - VPN Troubleshooting Solutions\n\n> ## Excerpt\n> Applies to: IPSec VPN\n\n---\nProductIPSec VPN\n\nVersionAll\n\nLast Modified2021-02-21\n\n## Solution\n\nLinks to a number of useful troubleshooting solutions are provided in the following table:\n\n## Article Properties\n\nOriginatorDavid Kornfield\n\nTechnical ResourceEitan Natanian\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2007-04-16\n\nLast Modified2021-02-21\n\nEditorDavid Kornfield\n\nLast ApproverGil Freedman\n","language":"md","time":"14 days ago","created":"2025-05-06T22:55:54.026Z","annotations":[],"updated":"2025-05-06T22:56:33.337Z"},{"title":"Debugging FWD Child Processs","id":"ff9f8e81-1fd2-401a-84b8-d3aa4026b07b","type":"TEXT","raw":"---\ncreated: 2025-04-29T18:44:56 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk35297\nauthor: \n---\n\n# sk35297 - How to debug FWD child processes\n\n> ## Excerpt\n> Applies to: Quantum Security Gateways\n\n---\nProductQuantum Security Gateways\n\nVersionAll\n\nPlatformAll\n\nLast Modified2016-06-15\n\n## Symptoms\n\n-   FWD daemon spawns other daemons.\n\n## Cause\n\nFWD is responsible for bringing up its child processes, e.g., vpnd, in.asessiond, etc. So, it is impossible to debug a process startup, since if we kill a child process of FWD (in order to start it manualy), FWD will automatically restart its child process.\n\n## Solution\n\nThe following procedure is for the VPND process:\n\n1.  Backup the current `$FWDIR/conf/fwauthd.conf` file:\n    \n    **`[Expert@HostName]# cp $FWDIR/conf/fwauthd.conf $FWDIR/conf/fwauthd.conf_ORIGINAL`**\n    \n2.  Edit the current `$FWDIR/conf/fwauthd.conf` file in Vi editor:\n    \n    **`[Expert@HostName]# vi $FWDIR/conf/fwauthd.conf`**\n    \n3.  Locate the line that contains the name of VPND daemon\n    \n    Example:  \n    `0 vpn vpnd respawn 0`\n    \n4.  Remove this line completely, or comment it out by adding the **`#`** sign at the beginning of this line\n5.  Set the relevant debugging environment variable(s)\n    \n    **`[Expert@HostName]# export VPND_DEBUG=1`**  \n    **`[Expert@HostName]# export TDEEROR_ALL_ALL=5`**\n    \n6.  Manually start the VPND daemon under debug (in the background):\n    \n    **`[Expert@HostName]# vpnd -d 1>> /var/log/vpnd_debug.txt 2>> /var/log/vpnd_debug.txt &`**\n    \n7.  To stop the debug:\n    1.  unset the relevant debugging environment variable(s)\n        \n        **`[Expert@HostName]# unset VPND_DEBUG`**  \n        **`[Expert@HostName]# unset TDEEROR_ALL_ALL`**\n        \n    2.  Kill the VPND daemon manually:\n        \n        **`[Expert@HostName]# ps auxw | grep -v grep | grep vpnd`**\n        \n8.  Revert the changes in the `$FWDIR/conf/fwauthd.conf` file - either copy the original file back, or edit the file in Vi editor.\n\n___\n\n**Related Solution:** [sk61902 (How to start VPND daemon under debug)](http://supportcontent.checkpoint.com/solutions?id=sk61902)\n\n## Article Properties\n\nOriginatorAlexey Kobzev\n\nTechnical ResourceMartin Ickowicz\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2008-06-24\n\nLast Modified2016-06-15\n\nEditorSergei Shir\n\nLast ApproverSergei Shir\n","language":"md","time":"14 days ago","created":"2025-05-06T22:55:56.110Z","annotations":[],"updated":"2025-05-06T22:56:24.792Z"},{"title":"Debugging FWD and CPD Processes","id":"e4dfc6f0-a045-4187-85d4-ff378c4763a3","type":"TEXT","raw":"---\ncreated: 2025-04-29T18:45:21 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk42215\nauthor: \n---\n\n# sk42215 - How to debug FWD and CPD processes to diagnose \"Server Disconnected\" error\n\n> ## Excerpt\n> Applies to: Quantum Security Management, SmartConsole\n\n---\nProductQuantum Security Management, SmartConsole\n\nVersionR70 (EOS), R75 (EOS), R76 (EOS), R77 (EOS), R77.10 (EOS), R77.20 (EOS), R77.30 (EOS)\n\nLast Modified2016-12-28\n\n## Symptoms\n\n-   SmartDashboard shows \"Server Disconnected\" error when trying to connect to the SmartCenter server.\n\n## Cause\n\nThere is a problem with the FWD and/or CPD processes.\n\n## Solution\n\nDebug both the FWD or CPD processes. Two log files will be generated, which will be used to diagnose the issue.\n\n**Debugging the FWD process**\n\n1.  Connect to the relevant Security Management Server via CLI.\n2.  While the FWD process is running, run the following commands:\n    \n    `fw debug fwd on   fw debug fwd on OPSEC_DEBUG_LEVEL=3   fw debug fwd on TDERROR_ALL_ALL=5`\n    \n    Debug information is saved to the `$FWDIR/log/fwd.elg` file.\n3.  Open SmartDashboard and try to connect to the SmartCenter server.\n4.  When SmartDashboard displays the \"Server Disconnected\" error, stop debugging by running the command:\n    \n    `fw debug fwd off`\n    \n\n**Debugging the CPD process**\n\n1.  Connect to the relevant Security Management Server via CLI.\n2.  While the CPD process is running, run the following commands:\n    \n    `cpd_admin debug on TDERROR_ALL_ALL=5   cpd_admin debug on OPSEC_DEBUG_LEVEL=3`\n    \n    Debug information is saved to the `$CPDIR/log/cpd.elg` file.\n3.  Wait for it to disconnect.\n4.  Stop debugging by running the command:\n    \n    `cpd_admin debug off`\n    \n\nRename both files to `_<yourcase#>_.cpd.elg` and `_<yourcase#>_.fwd.elg` and upload them to the case or to an FTP server.\n\n## Article Properties\n\nOriginatorPatrick Polizzi\n\nTechnical ResourceJoe Dimatteo\n\nAccess LevelExpert\n\nStatusApproved\n\nDate Created2009-06-29\n\nLast Modified2016-12-28\n\nEditorYuval Jacob\n\nLast ApproverNelson Abreu\n\n## Comments\n\n#### Internal only\n","language":"md","time":"14 days ago","created":"2025-05-06T22:55:56.566Z","annotations":[],"updated":"2025-05-06T22:56:38.417Z"},{"title":"Memory Leak Investigation Guidelines","id":"ee6f4e5d-f0d3-4f82-aad9-9e2b2e5a684b","type":"TEXT","raw":"ProductCluster - 3rd-party, ClusterXL, Quantum Security Gateways, VSX (Traditional)\n\nVersionR80.30 (EOS), R80.30SP (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-02-26\n\n#### For internal users only\n\n## Solution\n\n**Note** - This procedure is not supported on Quantum Spark appliances that run Gaia Embedded OS.\n\n**Table of Contents**\n\n-   Introduction\n    \n-   Memory Leak Investigation Guidelines\n    \n-   Automated Procedure for Memory Leaks\n    \n-   Manual Procedure for Memory Leaks\n    \n-   Automated Procedure for a Scalable Platform Security Group (Maestro and Chassis)\n    \n\n## Introduction\n\nThe procedure to follow to debug memory leak effectively depends on the answer to these questions:\n\n1.  Does the memory leak, or is it extensively used?\n    \n    In a memory leak - You see a constant increment in the memory usage until there is no free memory on the appliance. This memory is not released unless the leakage is stopped (or you reboot the appliance - in case of kernel module/slab leak).  \n    Extensive memory usage - usually shows a high quantity of memory used, but there is no clear increment in the memory usage.\n    \n2.  Where is the leak? (Daemon, Slab, or Kernel module)\n    \n    It is necessary to use logic and tools like Memory Analyzer to identify where the leak is.  \n    This article describes the procedure of pinpointing where and what type of issue you are dealing with.\n    \n3.  How fast does it leak?\n    \n    It is important to note that a memory leak means that the appliance's memory is consumed **over time**. With that in mind, to examine the growth in memory consumption, it is necessary to collect multiple snapshots of the environment.\n    \n    You can accomplish this with these tools:\n    \n    -   The scripts that collect memory data, as described in this article.\n    -   CPView history database - Use the [DiagnosticsView](https://support.checkpoint.com/results/sk/sk125092) tool with the appliance's CPView history to analyze the increase in memory usage over time. You can accomplish this with the checkbox \"**All used**\" from the configured filter's memory section and the overall connection filter. In addition, you can add filters from the Explorer tab like - \"**kernel\\_memroy\\_smem**\" and \"**kernel\\_memroy\\_hmem**\".\n    -   \"`sar`\" commands ([sk112734](https://support.checkpoint.com/results/sk/sk112734)).\n\n### Memory Leak Types\n\n-   **Firewall (Kernel or User Space)**\n    \n    In a Firewall/Kernel memory leak, there is a constant increase in memory used by the FW in the output of the \"`fw ctl pstat`\" command.\n    \n    Kernel space leak - You are running Firewall in kernel mode.\n    \n    User space leak - You are running Firewall in User Mode (FWK).\n    \n    Note: All VSX gateways are running the Firewall in the User Mode.\n    \n    -   If the output shows the value \"1\":\n        \n        User Space Firewall is using JeMalloc. Contact Check Point Support to open a ticket for JeMalloc profiling.\n        \n    -   If the output shows the value \"0\":\n        \n        Refer to \"Manual Procedure for Memory Leaks\".\n        \n-   **Slab**\n    \n    The output of \"`cat /proc/meminfo`\" reflects the slab memory usage. Collect the output for some time, and Contact Check Point Support with your collected information.\n    \n-   **User Space Daemons (for example: fwd, httpd)**\n    \n    Monitor the memory usage of the User Space daemons and the number of spawns of them. You can use the '`ps`' command. For example:  \n    `ps aux | sort -nk6`  \n    You can detect suspected high spawn daemons with this command:  \n    `ps aux | awk '{print $11}' | sort | uniq -c | sort -n`  \n    If there is an unusual number of process spawns - add it to the Service Request.\n    \n\n**Symptoms which indicate a memory leak:**\n\n-   Outputs of the \"`fw ctl pstat [<flag>]`\" commands show that the system memory usage increases to a very high level (for example: memory utilization increases to 70% within a few days).\n    \n-   The system memory usage increases significantly in an unexpected manner after a certain amount of time (usually between 24-48 hours).\n    \n-   Rebooting the Security Gateway resets the system memory usage to its initial and expected value.\n    \n\n## Memory Leak Investigation Guidelines\n\n1.  Install the recommended Jumbo Hotfix for your version (see [sk98028 - Jumbo Hotfix Accumulator FAQ](https://support.checkpoint.com/results/sk/sk98028)).\n    \n2.  If the issue persists, follow the procedure below carefully, step by step.\n    \n\n## Automated Procedure for Memory Leaks\n\n#### Part 1 - Preparation\n\n> 1.  Download the **sk35496\\_Automated\\_Memory\\_Leak\\_Procedure.tar** archive [from here](https://support.checkpoint.com/results/download/132772).\n>     \n> 2.  Connect to the command line on the Security Gateway / each Cluster Member.\n>     \n> 3.  Log in to the Expert mode.\n>     \n> 4.  In your **home** directory, create a new directory called **memory\\_leak**:\n>     \n>     `mkdir -v /home/admin/memory_leak`\n>     \n> 5.  Transfer the downloaded file to the Security Gateway / each Cluster Member to the new directory - **/home/admin/memory\\_leak**.\n>     \n> 6.  Go to the directory with the archive:\n>     \n>     `cd /home/admin/memory_leak`\n>     \n> 7.  Extract the **sk35496\\_Automated\\_Memory\\_Leak\\_Procedure.tar** archive:\n>     \n>     `tar xvf sk35496_Automated_Memory_Leak_Procedure.tar`\n>     \n> 8.  Assign the '`execute`' permission to all scripts:\n>     \n>     `chmod -v +x *.sh`\n>     \n\n#### Part 2 - Run the \"`changing_parameters_stage1.sh`\" script\n\n> Syntax:\n> \n> > `cd /home/admin/memory_leak`\n> > \n> > `./changing_parameters_stage1.sh`\n> \n> Notes:\n> \n> 1.  This script configures the required parameters.\n>     \n> 2.  This script asks you to reboot.\n>     \n>     **Important** - It is mandatory to reboot before you proceed to the next stage.\n>     \n\n#### Part 3 - Run the \"`start_record_memory_stage2.sh`\" script\n\n> Steps:\n> \n> 1.  Connect to the command line on the Security Gateway / each Cluster Member.\n>     \n> 2.  Log in to the Expert mode.\n>     \n> 3.  Execute the `start_record_memory_stage2.sh` script:\n>     \n>     `cd /home/admin/memory_leak`\n>     \n>     `./start_record_memory_stage2.sh`\n>     \n> 4.  **Important** - Wait for high memory utilization before you proceed to the next part.\n>     \n> \n> Notes:\n> \n> 1.  This script checks if the required parameters are configured.\n>     \n> 2.  This script saves the initial memory state (using the \"`mem_collect_combined.sh`\" script) and other outputs in this directory:\n>     \n>     `/var/log/sk35496_Before_<DATE>/`\n>     \n\n#### Part 4 - Run the \"`finish_record_mem_stage3.sh`\" script\n\n> Steps:\n> \n> 1.  Connect to the command line on the Security Gateway / each Cluster Member.\n>     \n> 2.  Log in to the Expert mode.\n>     \n> 3.  Execute the `finish_record_mem_stage3.sh` script:\n>     \n>     `cd /home/admin/memory_leak`\n>     \n>     `./finish_record_mem_stage3.sh`\n>     \n> \n> Notes:\n> \n> 1.  This script saves the current memory state (using the \"`mem_collect_combined.sh`\" script) and other outputs in this directory:\n>     \n>     `/var/log/sk35496_After_<DATE>/`\n>     \n> 2.  The script stops Check Point services with the \"`cpstop`\" command.\n>     \n> 3.  The script stops Check Point services with the \"`service cpboot stop`\" command.\n>     \n> 4.  The script unloads the Check Point kernel modules with the \"`cpstop -fwflag -driver`\" command.\n>     \n>     **Important Note** - Examine the output carefully. There should **NOT** be any messages that the FireWall kernel module could not be unloaded.\n>     \n\n#### Part 5 - Run the \"`collect_clean_files_after_stage4.sh`\" script\n\n> Syntax:\n> \n> > `cd /home/admin/memory_leak`\n> > \n> > `./collect_clean_files_after_stage4.sh`\n> \n> Notes:\n> \n> 1.  This script disables the required parameters.\n>     \n> 2.  This script asks you to reboot.\n>     \n>     **Important** - It is mandatory to reboot to stop the memory leak procedure completely.\n>     \n\n#### Part 6 - Collect all output files\n\n> 1.  Connect to the command line on the Security Gateway / each Cluster Member.\n>     \n> 2.  Log in to the Expert mode.\n>     \n> 3.  Go to the **/var/log/** directory:\n>     \n>     `cd /var/log/`\n>     \n> 4.  Collect the output files:\n>     \n>     `tar cvfz sk35496_Memory_Leak_Output.tgz sk35496_Before_* sk35496_After_* memory_procedure_output.txt`\n>     \n> 5.  Copy this archive file from the Security Gateway / each Cluster Member:\n>     \n>     `/var/log/sk35496_Memory_Leak_Output.tgz`\n>     \n\n## Manual Procedure for Memory Leaks\n\n#### Part 1 - Enable the required kernel parameters to collect memory leak data\n\nShow / Hide this section\n\n1.  Download the `mem_collect_combined.sh` script [from here](https://support.checkpoint.com/results/download/112192).\n    \n2.  Transfer the file Security Gateway / each Cluster Member to some directory (for example: _/var/log/_).\n    \n3.  Connect to the command on the Security Gateway / each Cluster Member.\n    \n4.  Log in to the Expert mode.\n    \n5.  Create a temporary folder to save the required output files:\n    \n    `mkdir /var/log/Memory_Leak`\n    \n6.  Go to the new temporary folder:\n    \n    `cd /var/log/Memory_Leak`\n    \n7.  Move the script to the new temporary folder (based on the above example, the script is located in _/var/log/_):\n    \n    `mv -v /var/log/mem_collect_combined.sh /var/log/Memory_Leak/`\n    \n8.  Assign the \"execute\" permission to the script:\n    \n    `chmod -v +x mem_collect_combined.sh`\n    \n9.  Back up the current _$FWDIR/boot/modules/fwkern.conf_ file:\n    \n    `cp -v $FWDIR/boot/modules/fwkern.conf{,_ORIGINAL}`\n    \n10.  Add the required kernel parameters (spaces and comments are not allowed) to the _$FWDIR/boot/modules/fwkern.conf_ file:\n    \n    <table><tbody><tr data-darkreader-inline-bgcolor=\"\"><td><p>#</p></td><td><p>Required kernel parameters in</p><p>versions R81.20 and higher</p></td><td><p>Required kernel parameters in</p><p>versions R81.10 and lower</p></td></tr><tr><td><p>A</p></td><td><p><code>fw_salloc_debug_leaks=1</code></p></td><td><p><code>fw_salloc_debug_leaks=1</code></p></td></tr><tr><td><p>B</p></td><td><p><code>fw_hmem_debug_leaks=1</code></p></td><td><p><code>fw_hmem_debug_leaks=1</code></p></td></tr><tr><td><p>C</p></td><td><p><code>fw_kmem_detailed_leak_report=1</code></p></td><td><p><code>fw_kmem_detailed_leak_report=1</code></p></td></tr><tr><td><p>D</p></td><td><p><code>fw_kmem_cphwd_use_fw=1</code></p></td><td><p><code>fw_kmem_cphwd_use_fw=1</code></p></td></tr><tr><td><p>E</p></td><td><p><code>fw_kdprintf_limit=0</code></p></td><td><p><code>fw_kdprintf_limit=0</code></p></td></tr><tr><td><p>F</p></td><td><p><code>fw_kdprintf_limit_time=0</code></p></td><td><p><code>fw_kdprintf_limit_time=0</code></p></td></tr><tr><td><p>G</p></td><td><p><code>fwleak_detect=2</code></p></td><td><p><code>fwleak_detect=2</code></p></td></tr><tr><td><p>H</p></td><td><p><code>fwleak_detect_kbuf=1</code></p></td><td></td></tr><tr><td><p>I</p></td><td><p><code>cp_shmem_leak_detect=1</code></p></td><td></td></tr></tbody></table>\n    \n    Run this single long command to automate this process:\n    \n    -   In versions R81.20 and higher:\n        \n        > `for PARAMETER in fw_salloc_debug_leaks fw_hmem_debug_leaks fw_kmem_detailed_leak_report fw_kmem_cphwd_use_fw fw_kdprintf_limit fw_kdprintf_limit_time fwleak_detect fwleak_detect_kbuf cp_shmem_leak_detect ; \\   do sed -i '/'${PARAMETER}'/d' $FWDIR/boot/modules/fwkern.conf ; done ; \\   for PARAMETER in fw_salloc_debug_leaks=1 fw_hmem_debug_leaks=1 fw_kmem_detailed_leak_report=1 fw_kmem_cphwd_use_fw=1 fw_kdprintf_limit=0 fw_kdprintf_limit_time=0 fwleak_detect=2 fwleak_detect_kbuf=1 cp_shmem_leak_detect=1 ; \\   do grep -q -F $PARAMETER $FWDIR/boot/modules/fwkern.conf || echo $PARAMETER >> $FWDIR/boot/modules/fwkern.conf ; done`\n        \n    -   In versions R81.10 and lower:\n        \n        > `for PARAMETER in fw_salloc_debug_leaks fw_hmem_debug_leaks fw_kmem_detailed_leak_report fw_kmem_cphwd_use_fw fw_kdprintf_limit fw_kdprintf_limit_time fwleak_detect ; \\   do sed -i '/'${PARAMETER}'/d' $FWDIR/boot/modules/fwkern.conf ; done ; \\   for PARAMETER in fw_salloc_debug_leaks=1 fw_hmem_debug_leaks=1 fw_kmem_detailed_leak_report=1 fw_kmem_cphwd_use_fw=1 fw_kdprintf_limit=0 fw_kdprintf_limit_time=0 fwleak_detect=2 ; \\   do grep -q -F $PARAMETER $FWDIR/boot/modules/fwkern.conf || echo $PARAMETER >> $FWDIR/boot/modules/fwkern.conf ; done`\n        \n11.  **In the VSX mode only:**\n    \n    Add the parameter \"`fwk_cleanup_nicely=1`\" in the `$FWDIR/conf/user.config` file in the context of **each** Virtual System and Virtual Router.\n    \n    Run this single long command to automate this process:\n    \n    `echo \"\" ; echo \"---------\" ; echo \"Found these Virtual Devices :\" ; vsx stat -v | grep -E \"ID | R | S |\\---\" | grep -v \",\" ; for VS_ID in $(vsx stat -l | grep -B 2 -E 'Virtual System|Virtual Router' | grep VSID | awk '{print $2}') ; do echo \"\" ; echo \"---------\" ; echo \"Switching to the context of Virtual Device # $VS_ID :\" ; vsenv $VS_ID ; if [ ! -f $FWDIR/conf/user.config ] ; then touch $FWDIR/conf/user.config ; else cp $FWDIR/conf/user.config{,_ORIGINAL} ; fi ; echo \"Adding the parameter to $FWDIR/conf/user.config ...\" ; echo \"fwk_cleanup_nicely=1\" >> $FWDIR/conf/user.config ; echo \"Checking if the parameter was added to $FWDIR/conf/user.config :\" ; grep fwk_cleanup_nicely $FWDIR/conf/user.config ; done`\n    \n12.  Reboot the Security Gateway / each Cluster Member.\n    \n13.  Connect to the command on the Security Gateway / each Cluster Member.\n    \n14.  Log in to the Expert mode.\n    \n15.  Make sure the required values were configured for the kernel parameters:\n    \n    **Important** - If at least one of the values was not configured, you must repeat the steps above.\n    \n    <table><tbody><tr data-darkreader-inline-bgcolor=\"\"><td><p>#</p></td><td><p>Required commands in</p><p>versions R81.20 and higher</p></td><td><p>Required commands in</p><p>versions R81.10 and lower</p></td><td><p>Required</p><p>value</p></td></tr><tr><td><p>A</p></td><td><p><code>fw ctl get int fw_salloc_debug_leaks</code></p></td><td><p><code>fw ctl get int fw_salloc_debug_leaks</code></p></td><td><p>1</p></td></tr><tr><td><p>B</p></td><td><p><code>fw ctl get int fw_hmem_debug_leaks</code></p></td><td><p><code>fw ctl get int fw_hmem_debug_leaks</code></p></td><td><p>1</p></td></tr><tr><td><p>C</p></td><td><p><code>fw ctl get int fw_kmem_detailed_leak_report</code></p></td><td><p><code>fw ctl get int fw_kmem_detailed_leak_report</code></p></td><td><p>1</p></td></tr><tr><td><p>D</p></td><td><p><code>fw ctl get int fw_kmem_cphwd_use_fw</code></p></td><td><p><code>fw ctl get int fw_kmem_cphwd_use_fw</code></p></td><td><p>1</p></td></tr><tr><td><p>E</p></td><td><p><code>fw ctl get int fw_kdprintf_limit</code></p></td><td><p><code>fw ctl get int fw_kdprintf_limit</code></p></td><td><p>0</p></td></tr><tr><td><p>F</p></td><td><p><code>fw ctl get int fw_kdprintf_limit_time</code></p></td><td><p><code>fw ctl get int fw_kdprintf_limit_time</code></p></td><td><p>0</p></td></tr><tr><td><p>G</p></td><td><p><code>fw ctl get int fwleak_detect</code></p><p>Important - This specific parameter will show its value as \"0\". This is OK.</p></td><td><p><code>fw ctl get int fwleak_detect</code></p><p>Important - This specific parameter will show its value as \"0\". This is OK.</p></td><td><p>0</p></td></tr><tr><td><p>H</p></td><td><p><code>fw ctl get int fwleak_detect_kbuf</code></p></td><td><p>&nbsp;Not applicable</p></td><td><p>1</p></td></tr><tr><td><p>I</p></td><td><p><code>fw ctl get int cp_shmem_leak_detect</code></p></td><td><p>&nbsp;Not applicable</p></td><td><p>1</p></td></tr></tbody></table>\n    \n\n#### Part 2 - Record the initial memory state\n\nShow / Hide this section\n\n1.  Go to the temporary folder:\n    \n    `cd /var/log/Memory_Leak`\n    \n2.  Generate the CPInfo file:\n    \n    `cpinfo -d -k -D -z -o before_cpinfo.tgz`\n    \n3.  Collect the required data about SMEM Allocations, HMEM Allocations, Policy Installation, and Driver Installation:\n    \n    `cpmemstat -u before_cpmemstat.txt`\n    \n4.  Run the `mem_collect_combined.sh` script:\n    \n    `./mem_collect_combined.sh`\n    \n    The script saves its output in this directory:\n    \n    `/var/log/mem_collect_<DATE>/`\n    \n5.  Monitor the overall memory utilization as described in [sk32206 - How to determine how much Free Memory is available on Linux-based system](https://support.checkpoint.com/results/sk/sk32206).\n    \n    **Important Notes:**\n    \n    1.  Each time the overall memory utilization increases by 15-20%, collect the required data about SMEM Allocations, HMEM Allocations, Policy Installation, and Driver Installation:\n        \n        `cpmemstat -u during_cpmemstat_$(/bin/date +%d-%b-%Y_%Hh-%Mm-%Ss).txt`\n        \n    2.  Move to the next stage when:\n        \n        1.  The output of the \"`fw ctl pstat`\" command shows that the memory consumed by the Firewall (FW) is greater than 70% and Aggressive Aging did not activate during the procedure.\n            \n        2.  The total available physical memory is less than 10%. In some circumstances, high memory consumption is not always reflected in the output of the \"`fw ctl pstat`\" command.\n            \n    \n    Example for Linux kernel 3.10:\n    \n    > Total available physical memory in Linux 3.10 using the \"`free -k`\" command is 6154348:\n    > \n    > ```\n    > [Expert@R8040:0]# free -k\n    >               total        used         free      shared  buff/cache     available\n    > Mem:        7946484     1087044       731548        5172     6127892     <span data-darkreader-inline-bgcolor=\"\">6154348</span>\n    > Swap:       8385924           0      8385924\n    > ```\n    \n    Example for Linux kernel 2.6:\n    \n    > Total available physical memory in Linux 2.6.18 using the \"`free -k`\" command is 6780736:\n    > \n    > ```\n    > [Expert@R8020:0]# free -k\n    >            total         used       free      shared     buffers     cached\n    > Mem:       8031896    2410028    5621868           0       66140    1092728\n    > -/+ buffers/cache:    1251160    <span data-darkreader-inline-bgcolor=\"\">6780736</span>\n    > Swap:      8385920          0    8385920\n    > ```\n    \n\n#### Part 3 - Record the memory state during the issue\n\nShow / Hide this section\n\n**The finalization procedure dump should be done before memory consumption reaches a critical state.**\n\n**Make sure to collect the CPInfo file while the memory utilization is high.**\n\n**Note that at this stage, we stop Check Point services. In a cluster, this can cause a failover.**\n\n**Make sure to reboot the Security Gateway / Cluster Member.**\n\n1.  Go to the temporary folder:\n    \n    `cd /var/log/Memory_Leak`\n    \n2.  Run the `mem_collect_combined.sh` script:\n    \n    `./mem_collect_combined.sh`\n    \n    The script saves its output in this directory:\n    \n    `/var/log/mem_collect_<DATE>/`\n    \n3.  Generate the CPInfo file:\n    \n    `cpinfo -d -k -D -z -o after_cpinfo.tgz`\n    \n4.  Collect the required data about SMEM Allocations, HMEM Allocations, Policy Installation, and Driver Installation:\n    \n    `cpmemstat -u after_cpmemstat.txt`\n    \n5.  Stop the Check Point Services:\n    \n    1.  `cpstop`\n        \n    2.  `service cpboot stop`\n        \n6.  Unload the Check Point kernel modules:\n    \n    `cpstop -fwflag -driver`\n    \n    **Important Note** - Examine the output carefully. There should **NOT** be any messages that FireWall kernel module could not be unloaded.\n    \n7.  Collect the messages from the ring buffer:\n    \n    `dmesg > dmesg.txt`\n    \n8.  Collect the analysis of the '_cpmemstat_' outputs:\n    \n    `cpmemstat_analyzer before_cpmemstat.txt after_cpmemstat.txt > cpmemstat_analyzer.txt`\n    \n9.  Collect all the required files:\n    \n    1.  Output of the \"_mem\\_collect\\_combined.sh_\" script - this entire directory:\n        \n        `/var/log/mem_collect_<DATE>/`\n        \n    2.  CPinfo files:\n        \n        1.  `/var/log/Memory_Leak/before_cpinfo.tgz`\n            \n        2.  `/var/log/Memory_Leak/after_cpinfo.tgz`\n            \n    3.  Leak report:\n        \n        `/var/log/Memory_Leak/dmesg.txt`\n        \n    4.  '_cpmemstat_' outputs:\n        \n        1.  `/var/log/Memory_Leak/before_cpmemstat.txt`\n            \n        2.  `/var/log/Memory_Leak/after_cpmemstat.txt`\n            \n        3.  `/var/log/Memory_Leak/cpmemstat_analyzer.txt`\n            \n        4.  `/var/log/Memory_Leak/during_cpmemstat*`\n            \n    5.  CPVew history database:\n        \n        -   In versions R80.40 and higher:\n            \n            `$CPDIR/log/cpview_services/cpview_services.dat`\n            \n        -   In versions R80.30 and lower:\n            \n            `/var/log/CPView_history/CPViewDB.dat`\n            \n    6.  Linux system messages:\n        \n        `/var/log/messages*`\n        \n    7.  SecureXL UPPAK mode log (see [sk153832](https://support.checkpoint.com/results/sk/sk153832)):\n        \n        `/var/log/usim_x86.elg*`\n        \n    8.  Firewall User Space mode log:\n        \n        `$FWDIR/log/fwk.elg*`\n        \n    \n    Run this single long command to automate this process (send this output file - **/var/log/MEMORY\\_LEAK.tgz**):\n    \n    -   In versions R80.40 and higher:\n        \n        `tar cvzf /var/log/MEMORY_LEAK.tgz /var/log/Memory_Leak  /var/log/mem_collect*  $CPDIR/log/cpview_services/cpview_services.dat  /var/log/messages*  /var/log/usim_x86.elg*  $FWDIR/log/fwk.elg*`\n        \n    -   In versions R80.30 and lower:\n        \n        `tar cvzf /var/log/MEMORY_LEAK.tgz /var/log/Memory_Leak  /var/log/mem_collect*  /var/log/CPView_history/CPViewDB.dat  /var/log/messages*  $FWDIR/log/fwk.elg*`\n        \n\n#### Part 4 - Disable the required kernel parameters to collect memory leak data\n\nShow / Hide this section\n\n1.  Restore the original _$FWDIR/boot/modules/fwkern.conf_ file:\n    \n    1.  Back up the current file with kernel parameters for memory leak:\n        \n        `cp -v $FWDIR/boot/modules/fwkern.conf{,_MEMORY_LEAK}`\n        \n    2.  Restore the original file:\n        \n        `cp -v $FWDIR/boot/modules/fwkern.conf{_ORIGINAL,}`\n        \n2.  **In the VSX mode only:**\n    \n    Remove the parameter \"`fwk_cleanup_nicely=1`\" from the `$FWDIR/conf/user.config` file in the context of each Virtual System and Virtual Router.\n    \n    Run this single long command to automate this process:\n    \n    `echo \"\" ; echo \"---------\" ; echo \"Found the following Virtual Devices :\" ; vsx stat -v | grep -E \"ID | R | S |\\---\" | grep -v \",\" ; for VS_ID in $(vsx stat -l | grep -B 2 -E 'Virtual System|Virtual Router' | grep VSID | awk '{print $2}') ; do echo \"\" ; echo \"---------\" ; echo \"Switching to the context of Virtual Device # $VS_ID :\" ; vsenv $VS_ID ; echo \"Removing the parameter from $FWDIR/conf/user.config ...\" ; sed -i '/fwk_cleanup_nicely=1/d' $FWDIR/conf/user.config ; echo \"Checking if the parameter was removed from $FWDIR/conf/user.config :\" ; grep fwk_cleanup_nicely $FWDIR/conf/user.config > /dev/null ; if [ $? -eq 1 ] ; then echo \"Parameter was removed successfully\" ; else echo \"Parameter was NOT removed - check the file manually ...\" ; fi ; done`\n    \n3.  Reboot the Security Gateway / Cluster Member.\n    \n\n## Automated Procedure for a Scalable Platform Security Group (Maestro and Chassis)\n\n**Important** - Need to perform this procedure only on the problematic Security Group Members.\n\n#### Part 1 - Preparation\n\nShow / Hide this section\n\n1.  Download the **mem\\_monitor\\_v8.tar** file [from here](https://support.checkpoint.com/results/download/110871).\n    \n2.  Download the **mem\\_collect\\_combined.sh** script [from here](https://support.checkpoint.com/results/download/112192).\n    \n3.  Connect to the command line on the Security Group.\n    \n4.  Log in to the Expert mode.\n    \n5.  In your **home** directory, create a new directory called **mem\\_monitor**:\n    \n    `g_all mkdir /home/admin/memory_monitor`\n    \n6.  Transfer the downloaded files to the Security Group into the new directory (_/home/admin/memory\\_monitor/_).\n    \n7.  Copy the **mem\\_monitor\\_v8.tar** and **mem\\_collect\\_combined.sh** file to all Security Group Members:\n    \n    `asg_cp2blades /home/admin/memory_monitor/mem_monitor_v8.tar`\n    \n    `asg_cp2blades /home/admin/memory_monitor/mem_collect_combined.sh`\n    \n8.  Extract the **mem\\_monitor\\_v8.tar** and assign the 'execute' permission:\n    \n    1.  `g_all tar xvf /home/admin/memory_monitor/mem_monitor_v8.tar -C /home/admin/memory_monitor`\n        \n    2.  `g_all chmod -v u+x /home/admin/memory_monitor/collect_mem_info_v8.sh`\n        \n        `C.g_all tar xvf /home/admin/memory_monitor/mem_collect_combined.sh -C /home/admin/memory_monitor`\n        \n        `d. g_all chmod -v u+x /home/admin/memory_monitor/mem_collect_combined.sh`\n        \n\n**Note** - The script \"`collect_mem_info_v8.sh`\" executes the script \"`mem_monitor.py`\".\n\n#### Part 2 - Enable the required kernel parameters to collect memory leak data\n\nShow / Hide this section\n\n1.  Duplicate the SSH connection to the Security Group for **each** problematic Security Group Member.\n    \n2.  From the Security Group context, connect to **each** problematic Security Group Member:\n    \n    `member <ID of Security Group> <ID of Security Group Member>`\n    \n    Example for the Security Group #1 and the Security Group Member #5:\n    \n    `member 1 5`\n    \n3.  Back up the current _$FWDIR/boot/modules/fwkern.conf_ file:\n    \n    `cp -v $FWDIR/boot/modules/fwkern.conf{,_ORIGINAL}`\n    \n4.  Add the required kernel parameters (spaces and comments are not allowed) to the _$FWDIR/boot/modules/fwkern.conf_ file:\n    \n    <table><tbody><tr data-darkreader-inline-bgcolor=\"\"><td><p>#</p></td><td><p>Required kernel parameters in</p><p>versions R81.20 and higher</p></td><td><p>Required kernel parameters in</p><p>versions R81.10 and lower</p></td></tr><tr><td><p>A</p></td><td><p><code>fw_salloc_debug_leaks=1</code></p></td><td><p><code>fw_salloc_debug_leaks=1</code></p></td></tr><tr><td><p>B</p></td><td><p><code>fw_hmem_debug_leaks=1</code></p></td><td><p><code>fw_hmem_debug_leaks=1</code></p></td></tr><tr><td><p>C</p></td><td><p><code>fw_kmem_detailed_leak_report=1</code></p></td><td><p><code>fw_kmem_detailed_leak_report=1</code></p></td></tr><tr><td><p>D</p></td><td><p><code>fw_kmem_cphwd_use_fw=1</code></p></td><td><p><code>fw_kmem_cphwd_use_fw=1</code></p></td></tr><tr><td><p>E</p></td><td><p><code>fw_kdprintf_limit=0</code></p></td><td><p><code>fw_kdprintf_limit=0</code></p></td></tr><tr><td><p>F</p></td><td><p><code>fw_kdprintf_limit_time=0</code></p></td><td><p><code>fw_kdprintf_limit_time=0</code></p></td></tr><tr><td><p>G</p></td><td><p><code>fwleak_detect=2</code></p></td><td><p><code>fwleak_detect=2</code></p></td></tr><tr><td><p>H</p></td><td><p><code>fwleak_detect_kbuf=1</code></p></td><td></td></tr><tr><td><p>I</p></td><td><p><code>cp_shmem_leak_detect=1</code></p></td><td></td></tr></tbody></table>\n    \n    Run this single long command to automate this process:\n    \n    -   In versions R81.20 and higher:\n        \n        > `for PARAMETER in fw_salloc_debug_leaks fw_hmem_debug_leaks fw_kmem_detailed_leak_report fw_kmem_cphwd_use_fw fw_kdprintf_limit fw_kdprintf_limit_time fwleak_detect fwleak_detect_kbuf cp_shmem_leak_detect ; \\   do sed -i '/'${PARAMETER}'/d' $FWDIR/boot/modules/fwkern.conf ; done ; \\   for PARAMETER in fw_salloc_debug_leaks=1 fw_hmem_debug_leaks=1 fw_kmem_detailed_leak_report=1 fw_kmem_cphwd_use_fw=1 fw_kdprintf_limit=0 fw_kdprintf_limit_time=0 fwleak_detect=2 fwleak_detect_kbuf=1 cp_shmem_leak_detect=1 ; \\   do grep -q -F $PARAMETER $FWDIR/boot/modules/fwkern.conf || echo $PARAMETER >> $FWDIR/boot/modules/fwkern.conf ; done`\n        \n    -   In versions R81.10 and lower:\n        \n        > `for PARAMETER in fw_salloc_debug_leaks fw_hmem_debug_leaks fw_kmem_detailed_leak_report fw_kmem_cphwd_use_fw fw_kdprintf_limit fw_kdprintf_limit_time fwleak_detect ; \\   do sed -i '/'${PARAMETER}'/d' $FWDIR/boot/modules/fwkern.conf ; done ; \\   for PARAMETER in fw_salloc_debug_leaks=1 fw_hmem_debug_leaks=1 fw_kmem_detailed_leak_report=1 fw_kmem_cphwd_use_fw=1 fw_kdprintf_limit=0 fw_kdprintf_limit_time=0 fwleak_detect=2 ; \\   do grep -q -F $PARAMETER $FWDIR/boot/modules/fwkern.conf || echo $PARAMETER >> $FWDIR/boot/modules/fwkern.conf ; done`\n        \n5.  **In the VSX mode only:**\n    \n    Add the parameter \"`fwk_cleanup_nicely=1`\" in the file `$FWDIR/conf/user.config` in the context of **each** Virtual System.\n    \n    Run this single long command to automate this process:\n    \n    `echo \"\" ; echo \"---------\" ; echo \"Found these Virtual Devices :\" ; vsx stat -v | grep -E \"ID | S |\\---\" | grep -v \",\" ; for VS_ID in $(vsx stat -l | grep -B 2 -E 'Virtual System' | grep VSID | awk '{print $2}') ; do echo \"\" ; echo \"---------\" ; echo \"Switching to the context of Virtual Device # $VS_ID :\" ; vsenv $VS_ID ; if [ ! -f $FWDIR/conf/user.config ] ; then touch $FWDIR/conf/user.config ; else cp $FWDIR/conf/user.config{,_ORIGINAL} ; fi ; echo \"Adding the parameter to $FWDIR/conf/user.config ...\" ; echo \"fwk_cleanup_nicely=1\" >> $FWDIR/conf/user.config ; echo \"Checking if the parameter was added to $FWDIR/conf/user.config :\" ; grep fwk_cleanup_nicely $FWDIR/conf/user.config ; done`\n    \n6.  Prevent the problematic Security Group Member from pulling the _$FWDIR/boot/modules/fwkern.conf_ configuration from other Security Group Members during boot:\n    \n    1.  Back up the current files _/etc/xfer\\_file\\_list_ and _/etc/xfer\\_file\\_list.early\\_boot_:\n        \n        `cp -v /etc/xfer_file_list{,_ORIGINAL}`\n        \n    2.  Run these commands to comment out this line in the two files:\n        \n        `global_context $FWDIR/modules/fwkern.conf /bin/false`\n        \n        1.  `sed -e '/fwkern.conf/ s/^#*/#/' -i /etc/xfer_file_list`\n            \n        2.  `sed -e '/fwkern.conf/ s/^#*/#/' -i /etc/xfer_file_list.early_boot`\n            \n7.  Reboot **each** problematic Security Group Member:\n    \n    `g_reboot -b <SGM_ID>`\n    \n8.  Connect to the command line on the Security Group.\n    \n9.  Log in to the Expert mode.\n    \n10.  Duplicate the SSH connection to the Security Group for each problematic Security Group Member.\n    \n11.  From the Security Group context, connect to **each** problematic member:\n    \n    `member <ID of Security Group> <ID of Security Group Member>`\n    \n    Example for the Security Group #1 and the Security Group Member #5:\n    \n    `g_reboot -b member 1 5`\n    \n12.  Make sure the required values were configured for the kernel parameters:\n    \n    **Important** - If at least one of the values was not configured, you must repeat the steps above.\n    \n    <table><tbody><tr data-darkreader-inline-bgcolor=\"\"><td><p>#</p></td><td><p>Required commands in</p><p>versions R81.20 and higher</p></td><td><p>Required commands in</p><p>versions R81.10 and lower</p></td><td><p>Required</p><p>value</p></td></tr><tr><td><p>A</p></td><td><p><code>fw ctl get int fw_salloc_debug_leaks</code></p></td><td><p><code>fw ctl get int fw_salloc_debug_leaks</code></p></td><td><p>1</p></td></tr><tr><td><p>B</p></td><td><p><code>fw ctl get int fw_hmem_debug_leaks</code></p></td><td><p><code>fw ctl get int fw_hmem_debug_leaks</code></p></td><td><p>1</p></td></tr><tr><td><p>C</p></td><td><p><code>fw ctl get int fw_kmem_detailed_leak_report</code></p></td><td><p><code>fw ctl get int fw_kmem_detailed_leak_report</code></p></td><td><p>1</p></td></tr><tr><td><p>D</p></td><td><p><code>fw ctl get int fw_kmem_cphwd_use_fw</code></p></td><td><p><code>fw ctl get int fw_kmem_cphwd_use_fw</code></p></td><td><p>1</p></td></tr><tr><td><p>E</p></td><td><p><code>fw ctl get int fw_kdprintf_limit</code></p></td><td><p><code>fw ctl get int fw_kdprintf_limit</code></p></td><td><p>0</p></td></tr><tr><td><p>F</p></td><td><p><code>fw ctl get int fw_kdprintf_limit_time</code></p></td><td><p><code>fw ctl get int fw_kdprintf_limit_time</code></p></td><td><p>0</p></td></tr><tr><td><p>G</p></td><td><p><code>fw ctl get int fwleak_detect</code></p><p>Important - This specific parameter will show its value as \"0\". This is OK.</p></td><td><p><code>fw ctl get int fwleak_detect</code></p><p>Important - This specific parameter will show its value as \"0\". This is OK.</p></td><td><p>0</p></td></tr><tr><td><p>H</p></td><td><p><code>fw ctl get int fwleak_detect_kbuf</code></p></td><td><p>Not applicable&nbsp;</p></td><td><p>1</p></td></tr><tr><td><p>I</p></td><td><p><code>fw ctl get int cp_shmem_leak_detect</code></p></td><td><p>Not applicable</p></td><td><p>1</p></td></tr></tbody></table>\n    \n\n#### Part 3 - Record the initial memory state\n\nShow / Hide this section\n\nAt this point, you are connected to each problematic Security Group Member and you are working in the Expert mode.\n\n1.  Go to the temporary folder:\n    \n    `cd /home/admin/memory_monitor`\n    \n2.  Generate the CPInfo file:\n    \n    `cpinfo -d -k -D -z -o before_cpinfo.tgz`\n    \n3.  **In versions R80.20SP and higher:**\n    \n    Collect the required data about SMEM Allocations, HMEM Allocations, Policy Installation, and Driver Installation:\n    \n    `cpmemstat -u before_cpmemstat.txt`\n    \n4.  Collect the CPView history database:\n    \n    -   In versions R81 and higher:\n        \n        `cp -v $CPDIR/log/cpview_services/cpview_services.dat before_cpview_services.dat`\n        \n    -   In versions R80.30SP and lower:\n        \n        `cp -v /var/log/CPView_history/CPViewDB.dat before_CPViewDB.dat`\n        \n5.  Execute the `collect_mem_info_v8.sh` script:\n    \n    `/home/admin/memory_monitor/collect_mem_info_v8.sh`\n    \n    The script saves its output in this file:\n    \n    `/home/admin/memory_monitor/<HOSTNAME>_<DATE>.mem`\n    \n6.  Execute the `mem_collect_combined.sh` script:\n    \n    `/home/admin/memory_monitor/mem_collect_combined.sh`\n    \n    The script saves its output in this directory:\n    \n    `/var/log/mem_collect_<DATE>/`\n    \n7.  Monitor the overall memory utilization as described in [sk32206 - How to determine how much Free Memory is available on Linux-based system](https://support.checkpoint.com/results/sk/sk32206).\n    \n    **Important Notes:**\n    \n    1.  In versions R80.20SP and higher - each time the overall memory utilization increases by 15-20%, collect the required data about SMEM Allocations, HMEM Allocations, Policy Installation, and Driver Installation:\n        \n        `cpmemstat -u during_cpmemstat_$(/bin/date +%d-%b-%Y_%Hh-%Mm-%Ss).txt`\n        \n    2.  Move to the next stage when:\n        \n        1.  The output of the \"`fw ctl pstat`\" command shows that the memory consumed by the Firewall (FW) is greater than 70% and Aggressive Aging did not activate during the procedure.\n            \n        2.  The total available physical memory is less than 10%. In some circumstances, high memory consumption is not always reflected in the output of the \"`fw ctl pstat`\" command.\n            \n    \n    Example for Linux kernel 3.10 (versions R80.30SP and higher):\n    \n    > Total available physical memory in Linux 3.10 using the \"`free -k`\" command is 6154348:\n    > \n    > ```\n    > [Expert@R8040:0]# free -k\n    >               total        used         free      shared  buff/cache     available\n    > Mem:        7946484     1087044       731548        5172     6127892     <span data-darkreader-inline-bgcolor=\"\">6154348</span>\n    > Swap:       8385924           0      8385924\n    > ```\n    \n    Example for Linux kernel 2.6 (versions R80.20SP and lower):\n    \n    > Total available physical memory in Linux 2.6.18 using the \"`free -k`\" command is 6780736:\n    > \n    > ```\n    > [Expert@R8020:0]# free -k\n    >            total         used       free      shared     buffers     cached\n    > Mem:       8031896    2410028    5621868           0       66140    1092728\n    > -/+ buffers/cache:    1251160    <span data-darkreader-inline-bgcolor=\"\">6780736</span>\n    > Swap:      8385920          0    8385920\n    > ```\n    \n\n#### Part 4 - Record the memory state during the issue\n\nShow / Hide this section\n\n**The finalization procedure dump should be done before memory consumption reaches a critical state.**\n\n**Make sure to collect the CPInfo file while the memory utilization is high.**\n\n**Note that at this stage, we stop Check Point services.**\n\n**Make sure to reboot the Security Group Members.**\n\n1.  Connect to the command line on the Security Group.\n    \n2.  Log in to the Expert mode.\n    \n3.  Duplicate the SSH connection to the Security Group for **each** problematic Security Group Member.\n    \n4.  From the Security Group context, connect to **each** problematic Security Group Member:\n    \n    `member <ID of Security Group> <ID of Security Group Member>`\n    \n    Example for the Security Group #1 and the Security Group Member #5:\n    \n    `member 1 5`\n    \n5.  Go to the temporary folder:\n    \n    `cd /home/admin/memory_monitor`\n    \n6.  Execute the `collect_mem_info_v8.sh` script on the applicable Security Group Members:\n    \n    `/home/admin/memory_monitor/collect_mem_info_v8.sh`\n    \n    The script saves its output in this file:\n    \n    `/home/admin/memory_monitor/<HOSTNAME>_<DATE>.mem`\n    \n7.  Execute the `mem_collect_combined.sh` script on the applicable Security Group Members:\n    \n    `/home/admin/memory_monitor/mem_collect_combined.sh`\n    \n    The script saves its output in this directory:\n    \n    `/var/log/mem_collect_<DATE>/`\n    \n8.  Generate the CPInfo file:\n    \n    `cpinfo -d -k -D -z -o after_cpinfo.tgz`\n    \n9.  Collect the CPView history database:\n    \n    -   In versions R81 and higher:\n        \n        `cp -v $CPDIR/log/cpview_services/cpview_services.dat after_cpview_services.dat`\n        \n    -   In versions R80.30SP and lower:\n        \n        `cp -v /var/log/CPView_history/CPViewDB.dat after_CPViewDB.dat`\n        \n\n#### Part 5 - Disable the required kernel parameters to collect memory leak data\n\nShow / Hide this section\n\nAt this point, you are connected to each problematic Security Group Member and you are working in the Expert mode.\n\n1.  Reset the kernel debug options:\n    \n    `fw ctl debug 0`\n    \n2.  Set the state of the problematic Security Group Members to \"down\":\n    \n    -   In versions R80.20SP and higher:\n        \n        `clusterXL_admin -b <SGM_ID> down`\n        \n    -   In versions R76SP.50 and lower:\n        \n        `asg sgm_admin -b <SGM_ID> down`\n        \n3.  **In versions R80.20SP and higher:**\n    \n    Collect the required data about SMEM Allocations, HMEM Allocations, Policy Installation, and Driver Installation:\n    \n    `cpmemstat -u after_cpmemstat.txt`\n    \n4.  Stop Check Point services:\n    \n    1.  `cpstop`\n        \n    2.  `cpstop -fwflag -driver`\n        \n5.  Collect the messages from the ring buffer:\n    \n    `dmesg > dmesg.txt`\n    \n6.  **In versions R80.20SP and higher:**\n    \n    Collect the analysis of the '_cpmemstat_' outputs:\n    \n    `cpmemstat_analyzer before_cpmemstat.txt after_cpmemstat.txt > cpmemstat_analyzer.txt`\n    \n7.  On Scalable Chassis 40000 / 60000:\n    \n    1.  Output of this command (R81.10 and lower):\n        \n        `asg_info -f -v`\n        \n        This command saves the output in this file:\n        \n        `/var/log/asg_info.<HOSTNAME>.<DATE>.tar`\n        \n    2.  Output of this command:\n        \n        `asg_provision`\n        \n8.  Collect all the required files from each Security Group Member:\n    \n    1.  Output of the \"_mem\\_collect\\_combined.sh_\" script - this entire directory:\n        \n        `/var/log/mem_collect_<DATE>/`\n        \n    2.  Output of the \"_collect\\_mem\\_info\\_v8.sh_\" script:\n        \n        `/home/admin/memory_monitor/<HOSTNAME>_<DATE>.mem`\n        \n    3.  CPinfo files:\n        \n        1.  `/var/log/Memory_Leak/before_cpinfo.tgz`\n            \n        2.  `/var/log/Memory_Leak/after_cpinfo.tgz`\n            \n    4.  Leak report:\n        \n        `/var/log/Memory_Leak/dmesg.txt`\n        \n    5.  In versions R80.20SP and higher - '_cpmemstat_' outputs:\n        \n        1.  `/var/log/Memory_Leak/before_cpmemstat.txt`\n            \n        2.  `/var/log/Memory_Leak/after_cpmemstat.txt`\n            \n        3.  `/var/log/Memory_Leak/cpmemstat_analyzer.txt`\n            \n        4.  `/var/log/Memory_Leak/during_cpmemstat*`\n            \n    6.  CPVew history database:\n        \n        -   In versions R81 and higher:\n            \n            `$CPDIR/log/cpview_services/cpview_services.dat`\n            \n        -   In versions R80.30SP and lower:\n            \n            `/var/log/CPView_history/CPViewDB.dat`\n            \n    7.  `/var/log/messages*`\n        \n    8.  `$FWDIR/log/fwk.elg*`\n        \n    9.  On Scalable Chassis 40000 / 60000:\n        \n        1.  In all versions, output of this command:\n            \n            `asg_provision`\n            \n        2.  In versions R81.10 and lower, output of this command:\n            \n            `asg_info -f -v`\n            \n            This command saves the output in this file:\n            \n            `/var/log/asg_info.<HOSTNAME>.<DATE>.tar`\n            \n    \n    Run this single long command to automate this process (send this output file - **/var/log/MEMORY\\_LEAK.tgz**):\n    \n    -   In versions R81 and higher:\n        \n        `tar cvzf /var/log/MEMORY_LEAK.tgz /home/admin/memory_monitorm /var/log/mem_collect* /var/log/messages* $FWDIR/log/fwk.elg*`\n        \n        Note - On Scalable Chassis 40000 / 60000, do **not** forget the outputs of these commands as well:\n        \n        1.  In all versions:\n            \n            `asg_provision`\n            \n        2.  In versions R81.10 and lower:\n            \n            `asg_info -f -v`\n            \n    -   In versions R80.30SP and lower:\n        \n        `tar cvzf /var/log/MEMORY_LEAK.tgz /home/admin/memory_monitor /var/log/mem_collect* before_CPViewDB.dat after_CPViewDB.dat /var/log/messages* $FWDIR/log/fwk.elg*`\n        \n        Note - On Scalable Chassis 40000 / 60000, do not forget the outputs of these commands:\n        \n        1.  `asg_info -f -v`\n            \n        2.  `asg_provision`\n            \n9.  **In the VSX mode only:**\n    \n    Remove the parameter \"`fwk_cleanup_nicely=1`\" from the `$FWDIR/conf/user.config` file in the context of **each** Virtual System.\n    \n    Run this single long command to automate this process:\n    \n    `echo \"\" ; echo \"---------\" ; echo \"Found the following Virtual Devices :\" ; vsx stat -v | grep -E \"ID | S |\\---\" | grep -v \",\" ; for VS_ID in $(vsx stat -l | grep -B 2 -E 'Virtual System' | grep VSID | awk '{print $2}') ; do echo \"\" ; echo \"---------\" ; echo \"Switching to the context of Virtual Device # $VS_ID :\" ; vsenv $VS_ID ; echo \"Removing the parameter from $FWDIR/conf/user.config ...\" ; sed -i '/fwk_cleanup_nicely=1/d' $FWDIR/conf/user.config ; echo \"Checking if the parameter was removed from $FWDIR/conf/user.config :\" ; grep fwk_cleanup_nicely $FWDIR/conf/user.config > /dev/null ; if [ $? -eq 1 ] ; then echo \"Parameter was removed successfully\" ; else echo \"Parameter was NOT removed - check the file manually ...\" ; fi ; done`\n    \n10.  Restore the original files _/etc/xfer\\_file\\_list_ and _/etc/xfer\\_file\\_list.early\\_boot_:\n    \n    `cp -v /etc/xfer_file_list{_ORIGINAL,}`\n    \n11.  Reboot **each** problematic Security Group Member:\n    \n    `reboot -b <SGM_ID>`\n    \n\n## Article Properties\n\nOriginatorHanan Buskila\n\nTechnical ResourceRafael Wurf\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2008-07-08\n\nLast Modified2025-02-26\n\nEditorSergei Shir\n\nLast ApproverJon Paine\n\n## Comments\n\n#### Internal only\n\n**SK SHOULD NOT BE DELETED - referenced in Admin Guides and HCP**\n\n___\n\nContact **Hanan Buskila**, if a customer complains about this issue in the procedure \"**Automated Procedure for a Scalable Platform Security Group (Maestro and Chassis)**\":\n\nThe script `/home/admin/memory_monitor/collect_mem_info_v8.sh`  \nends unexpectedly with \"`No such file or directory`\".  \nbecause the Python path in the script `mem_monitor.py` is wrong - \"`#!/usr/bin/env python`\"\n\n___\n\nsk165294 was merged into this SK\n\n___\n\nPRHF-31450 will add the support for full path for outputs in the \"`cpmemstat -u`\" command\n\n___\n\n**Important note! The above guidelines should be followed before contacting CFG/R&D. Please use this guide to provide the needed outputs for CFG/R&D investigation (in case required).**\n\n**Important note! - make sure to remove the kernel parameters after the procedure is done to avoid any performance related issues.**\n\n___\n\n**For known memory leaks Hotfix integration, please visit [\"Memory Leak Issues\"](https://wiki.checkpoint.com/confluence/pages/viewpage.action?spaceKey=CPTRAIN&title=Memory+Leak+Issues) wiki page.**\n\n___\n\n**For every CFG memory leak task, please provide this mandatory information. To make progress on day 0, make sure to get answers to the following questions:**\n\n1.  Where there any changes done in the recent future before the issue occurred?\n2.  What are the symptoms? Could you please describe it in detail?\n3.  What kind of kernel memory has been increased over time? (HMEM / SMEM / KMEM).\n4.  Does high memory consumption reflect on reported system memory file? for instance - high memory utilization reported under AnonPages or Slab entries in /proc/meminfo.\n5.  Are User-space processes consuming the memory as well? \n6.  Are there Kernel tables growing over time without reducing?\n7.  Is the cache memory increased?\n8.  Are there any additional error messages or performance issues as well?\n9.  How is the cluster configured, are there non-default parameters that were set?\n10.  Which type of traffics passing through the GW?\n\n___\n\nFrom: Hanan Buskila  \nSent: Sunday, July 7, 2024 8:16 AM  \nTo: Sergei Shir ; Kfir Rymberg  \nCc: Odelya Tick ; Gharam Adawi ; Sarit Friedman ; Rahul Mundhe  \nSubject: RE: Memory leak procedure. -sk35496 \n\nHey,\n\nThanks for the help.\n\nIn the code – when this parameter is set to 2 we made it to be in standby – and we changed its value to 0.  \nSo we set it to 2 but after reboot, it will be 0.  \nIt isn’t very clear – but this is how it works. (not my code 😉)\n\n From: Sergei Shir  \nSent: Thursday, 4 July 2024 23:29  \nTo: Hanan Buskila ; Kfir Rymberg  \nCc: Odelya Tick ; Gharam Adawi ; Sarit Friedman ; Rahul Mundhe   \nSubject: RE: Memory leak procedure. -sk35496 \n\n(1)\n\nSK was updated\n\nThe attached TAR was uploaded to the SK\n\nThe SK was changed to show \" fwleak\\_detect = 2 \"\n\n (2)\n\nPlease clarify this point for the Manual Procedure:\n\nIn the checking stage this parameter will be set to 0 – so we need to check it’s 0 and not 2\n\nIf the procedure configures the value 2:\n\nfw ctl set in fwleak\\_detect 2\n\nthen how can it have the value 0 in this output?\n\nfw ctl get in fwleak\\_detect\n\n From: Hanan Buskila  \nSent: Thursday, 4 July 2024 11:34  \nTo: Sergei Shir ; Kfir Rymberg  \nCc: Odelya Tick ; Gharam Adawi ; Sarit Friedman ; Rahul Mundhe   \nSubject: Memory leak procedure. -sk35496 \n\nHey Sergei,   \nSorry for all the request – but we are in a stage that we try to improve the sk as much as possible 😊\n\nThe new scripts is attached – I made some changes. \n\n1\\. Added output file to see if we faced some errors – please attach the new scripts + ask customer to collect /var/log/memory\\_procedure\\_output.txt.\n\n2.changed the parameter fwleak\\_detect to be 2 which is standby mode. It’s already inside the scripts but you need to change it in the manual procedure. In the checking stage this parameter will be set to 0 – so we need to check it’s 0 and not 2. \n\n(BTW – the mem\\_collect... script hasn’t changed.)\n\nThanks for the help!\n\n___\n\nFrom: Shai Shabat   \nSent: Monday, June 14, 2021 14:40  \nTo: Chen Bary; Rachel Teitz; Guy Kogan; Ben Maoz  \nCc: Ibrahem Ibrahem; Yigal Alexander  \nSubject: RE: Question re: sk165294\n\nIn one word – yes\n\nIn more words – we made sure Jemalloc will also work with the flags to avoid changing the procedure.\n\nThere are more options for Jemalloc but we are keeping them a secret for now (until we fully map and understand them) \n\nFrom: Chen Bary <chenba@checkpoint.com>   \nSent: Monday, 14 June 2021 13:35  \nTo: Rachel Teitz ; Guy Kogan ; Shai Shabat ; Ben Maoz  \nCc: Ibrahem Ibrahem <ibrahemi@checkpoint.com>; Yigal Alexander  \nSubject: RE: Question re: sk165294\n\nHi Rachel, \n\nIn one word - No.\n\nAdding product owners - Shai and Ben \n\nBen/Shai – As far as I remember, the traditional memory leak detection SK   \ndoes not align with the new intruded kernel memory layer/tool (?) – Jmalloc.\n\nQ – What are the missing steps for the memory leak detection procedure in R81 and above? \n\n From: Rachel Teitz   \nSent: Monday, June 14, 2021 12:51  \nTo: Guy Kogan; Chen Bary  \nSubject: Question re: sk165294\n\nHi Guy and Chen.\n\nYou are listed as the Originator and Technical Resource of sk165294 – Memory leak detection proceduree \n\nThe listed versions include: R80.10, R80.20, R80.20SP, R80.30 and R80.40.\n\nIs this solution applicable to R81 and R81.10 as well?\n\nThanks","language":"md","time":"14 days ago","created":"2025-05-06T22:55:56.381Z","annotations":[],"updated":"2025-05-06T22:56:44.202Z"},{"title":"Security Gateway Log Server Stoping and Status Battling","id":"283b4274-80cc-4c76-abd0-04ac5e6ae2ad","type":"TEXT","raw":"Under some conditions, the Log Server may stop receiving logs from the Security Gateway. When a Security Gateway cannot communicate with its Log Server, it will begin to log locally. Local logging can consume disk space on the Security Gateway at a rapid pace, depending on the amount of logged traffic.\n\nThis article documents several practical troubleshooting steps to mitigate issues that prevent a Security Gateway from generating logs, transmitting them to the Log Server, and the Log Server's storing the raw logs in the fw.log file.\n\nThese general steps assume the basic roles of Security Gateway / Log Server. When applying them to environments that utilize Virtual Systems eXchange (VSX) or Multi-Domain Log Module (MLM), ensure that the steps are taken within the appropriate context.\n\n### **  \nTable of Contents:**\n\n-   **Configuration**\n\n-   Check the \"Log Servers\" configuration\n-   Confirm that presence of the Log Server in the masters file\n-   Verify that the masters file is not immutable\n\n-   **Networking**\n\n-   Confirm network connectivity between the devices\n-   Check for established FW1\\_log connections\n-   Attempt to capture outbound FW1\\_log traffic\n-   Verify whether either host's fw.log file is growing\n\n-   **Maintenance**\n\n-   Check available disk space on the Log Server\n-   Switch the active fw.log file\n-   Restart FWD daemons\n\n##   \nConfiguration\n\n### Check the \"Log Servers\" configuration...\n\nConfirm that the Check Point Host object representing the Log Server has its Logging & Status blade enabled and that the Security Gateway has the desired Log Server configured as one of its Primary Log Server.\n\nReview the configuration in SmartConsole > Check Point Host > General Properties > Management > Logging & Status:\n\n![Log Server Logging & Status Configuration](https://sc1.checkpoint.com/sc/SolutionsStatics/sk38848/sk38848-logging-and-status202307111646001.png)\n\nIf you have just enabled the Logging & Status blade on the Check Point Host, you must install database onto it to apply the changes.\n\nReview the configuration in SmartConsole > Security Gateway > Logs > Log Servers > Primary Log Servers:\n\n![Security Gateway Primary Log Server Configuration](https://sc1.checkpoint.com/sc/SolutionsStatics/sk38848/sk38848-primary-log-servers202307111646422.png)\n\nVerify that the desired Log Server appears in the list of Primary Log Servers for the Security Gateway.\n\nIf you need to change the configured Log Servers, you must install policy onto the Security Gateway to apply the changes.\n\n### Confirm the presence of the Log Server in the masters file...\n\nReview the contents of the masters file on the Security Gateway:\n\n```\n<strong>[Expert@SecurityGateway]# cat /etc/fw/conf/masters</strong><br>[Policy]<br>MgmtServer<br><span>[Log]</span><br><span>LogServer</span><br>[Alert]<br>LogServer<br>[Backup]<br>MgmtServer\n```\n\nIf the expected Log Server is missing from the \\[Log\\] section of the masters file, install policy on the Security Gateway to apply the configuration from SmartConsole.\n\n### Verify that the masters file is not immutable...\n\nIf policy installation does not update the masters file to reflect the changes from SmartConsole, check whether the file attributes were configured as \"immutable.\"\n\nCheck the masters file for the \"immutable\" file attribute:\n\n```\n<strong>[Expert@SecurityGateway]# lsattr /etc/fw/conf/masters</strong><br>----<span>i</span>----------- /etc/fw/conf/masters\n```\n\nWhile the masters file is configured to be immutable, its contents cannot change. The immutable file attribute is a manual configuration. Before disabling it, consider whether this configuration was intentional.\n\nIf there is no good reason for the masters file to be configured as immutable, remove this file attribute so that the changes from SmartConsole can be applied at policy installation.\n\nRemove the \"immutable\" file attribute from the masters file:\n\n```\n<strong>[Expert@SecurityGateway]# chattr -i /etc/fw/conf/masters</strong><br><strong>[Expert@SecurityGateway]# lsattr /etc/fw/conf/masters</strong><br>---------------- /etc/fw/conf/masters\n```\n\nOnce the masters file is no longer immutable, it can be updated with the configuration from SmartConsole. Install policy onto the Security Gateway to apply the changes.\n\n##   \nNetworking\n\n### Confirm network connectivity between the devices...\n\nPerform basic verification of the network path between the Security Gateway and the Log Server.\n\nNote: The most critical test for log functionality is client-to-server connectivity on TCP/257.  \nOther tests may or may not be useful, depending on the network configuration of the environment.\n\nUsing \"nc\" on the Security Gateway:\n\n```\n<strong>[Expert@SecurityGateway]# nc -v -z &lt;<em>LOGSERVER_IP_ADDRESS&gt;</em> 257</strong><br>LOGSERVER_IP_ADDRESS 257 (set) <span>open</span>\n```\n\nUsing \"ping\" from either host:\n\n```\n<strong>[Expert@SecurityGateway]# ping -c 3 &lt;<em>LOGSERVER_IP_ADDRESS&gt;</em></strong>\n```\n\n```\n<strong>[Expert@LogServer]# ping -c 3 &lt;<em>GATEWAY_IP_ADDRESS&gt;</em></strong>\n```\n\nUsing \"traceroute\" from either host:\n\n```\n<strong>[Expert@SecurityGateway]# traceroute &lt;<em>LOGSERVER_IP_ADDRESS&gt;</em></strong>\n```\n\n```\n<strong>[Expert@LogServer]# traceroute &lt;<em>GATEWAY_IP_ADDRESS&gt;</em></strong>\n```\n\nUsing \"tcptraceroute\" from the Security Gateway:\n\n```\n<strong>[Expert@SecurityGateway]# tcptraceroute -p 257 &lt;<em>LOGSERVER_IP_ADDRESS&gt;</em></strong>\n```\n\n###   \nCheck for established FW1\\_log connections...\n\nInspect the network sockets on the client (Security Gateway) and server (Log Server) for established connections (State=ESTAB) for the FW1\\_log service port, TCP/257.\n\nUsing \"ss\" from either host:\n\n```\n<strong>[Expert@SecurityGateway]# ss -tn dport = :257</strong><br>State &nbsp;Recv-Q &nbsp;Send-Q &nbsp;Local Address:Port &nbsp; &nbsp; &nbsp; &nbsp;Peer Address:Port<br><span>ESTAB</span> &nbsp;0 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; GATEWAY_IP_ADDRESS:63585 &nbsp;LOGSERVER_IP_ADDRESS:257\n```\n\n```\n<strong>[Expert@LogServer]# ss -tn sport = :257</strong><br>State &nbsp;Recv-Q &nbsp;Send-Q &nbsp;Local Address:Port &nbsp; &nbsp; &nbsp; &nbsp;Peer Address:Port<br><span>ESTAB</span> &nbsp;0 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; LOGSERVER_IP_ADDRESS:257 &nbsp;GATEWAY_IP_ADDRESS:63585\n```\n\nTo filter output to the connection state between specific hosts, add \"dst x.x.x.x\" to the \"ss\"command syntax:\n\n```\n<strong>[Expert@SecurityGateway]# ss -tn dst LOGSERVER_IP_ADDRESS dport = :257</strong><br>State &nbsp;Recv-Q &nbsp;Send-Q &nbsp;Local Address:Port &nbsp; &nbsp; &nbsp; &nbsp;Peer Address:Port<br><span>ESTAB</span> &nbsp;0 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; GATEWAY_IP_ADDRESS:63585 &nbsp;LOGSERVER_IP_ADDRESS:257\n```\n\n```\n<strong>[Expert@LogServer]# ss -tn dst &lt;GATEWAY_IP_ADDRESS&gt; sport = :257</strong><br>State &nbsp;Recv-Q &nbsp;Send-Q &nbsp;Local Address:Port &nbsp; &nbsp; &nbsp; &nbsp;Peer Address:Port<br><span>ESTAB</span> &nbsp;0 &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; LOGSERVER_IP_ADDRESS:257 &nbsp;GATEWAY_IP_ADDRESS:63585\n```\n\nIf an established socket is not present, ensure that the \"fwd\" process on the Log Server has a listening socket (State=LISTEN) on the appropriate port:\n\nUsing \"ss\" on the Log Server:\n\n```\n<strong>[Expert@LogServer]# ss -plnt sport = :257</strong><br>State &nbsp; Recv-Q &nbsp;Send-Q &nbsp;Local Address:Port &nbsp; &nbsp; &nbsp; &nbsp;Peer Address:Port<br><span>LISTEN</span> &nbsp;0 &nbsp; &nbsp; &nbsp; 20 &nbsp; &nbsp; &nbsp;LOGSERVER_IP_ADDRESS:257 &nbsp; &nbsp; &nbsp; &nbsp; *:* &nbsp; &nbsp; &nbsp; &nbsp;users:((\"<span>fwd</span>\",pid=20666,fd=51))\n```\n\nReview \"cpstat\" command outputs from either host for evidence of established connectivity and log transmission between the Security Gateway and Log Server.\n\nReview the output of \"cpstat fw -f log\\_connection\" on the Security Gateway:\n\n```\n[Expert@SecurityGateway]# cpstat fw -f log_connection<br><br>Overall Status: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br>Overall Status Description: &nbsp; &nbsp; <span>Security Gateway is reporting logs as defined</span><br>Local Logging Mode Description: <span>Logs are written to log server</span><br>Local Logging Mode Status: &nbsp; &nbsp; &nbsp;0<br>Local Logging Sending Rate: &nbsp; &nbsp; 0<br>Log Handling Rate: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;69<br><br>Log Servers Connections<br>------------------------------------------------------------------<br>|IP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|Status|Status Description &nbsp; &nbsp; |Sending Rate|<br>------------------------------------------------------------------<br>|LOGSERVER_IP_ADDRESS| &nbsp; &nbsp; 0|<span>Log-Server Connected</span> &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span>69</span>|<br>------------------------------------------------------------------\n```\n\nReview the output of \"cpstat ls -f logging\" on the Log Server:\n\n```\n<strong>[Expert@LogServer]# cpstat ls -f logging</strong><br><br>Log Receive Rate: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 69<br>Log Receive Rate Peak: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1337<br>Log Receive Rate Last 10 Minutes: 123<br>Log Receive Rate Last Hour: &nbsp; &nbsp; &nbsp; 420<br><br>Log Server Connected Gateways<br>------------------------------------------------------------------------<br>|Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|State &nbsp; &nbsp;|Last Login Time &nbsp; &nbsp; &nbsp; &nbsp; |Log Receive Rate|<br>------------------------------------------------------------------------<br>|GATEWAY_IP_ADDRESS|<span>Connected</span>|Day Mon DD hh:mm:ss YYYY| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span>69</span>|<br>------------------------------------------------------------------------\n```\n\n###   \nAttempt to capture outbound FW1\\_log traffic...\n\nIf there is an established FW1\\_log connection between the Security Gateway and Log Server, attempt to capture evidence of the Security Gateway sending its logs over this connection.\n\nUsing \"cppcap\" on the Security Gateway:\n\n```\n<strong>[Expert@SecurityGateway]# cppcap -p 100 -f \"host &lt;LOGSERVER_IP_ADDRESS&gt; and tcp port 257\"</strong>\n```\n\nUsing \"cppcap\" on the Log Server:\n\n```\n<strong>[Expert@LogServer]# cppcap -p 100 -f \"host &lt;GATEWAY_IP_ADDRESS&gt; and tcp port 257\"</strong>\n```\n\n### Verify whether either host's fw.log file is growing...\n\nIf the previous checks fail, the Log Server may be failing to write to its fw.log file, or the Security Gateway may be logging locally.\n\nVerify whether either host's fw.log file is growing:\n\n```\n<strong>[Expert@Hostname]# watch -d \"ls -l $FWDIR/log/fw.log\"</strong>\n```\n\n##   \nMaintenance\n\n### Check available disk space on the Log Server...\n\nReview the disk utilization on the Log Server to confirm that there is disk space available to store the logs in the /var/log parition.\n\n```\n<strong>[Expert@LogServer]# df -h /var/log</strong><br>Filesystem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size &nbsp;Used Avail Use% Mounted on<br>/dev/mapper/vg_splat-lv_log &nbsp;420G &nbsp; 69G &nbsp;<span>351G</span> &nbsp;<span>16%</span> /var/log\n```\n\nIf the Log Server's disk utilization crosses the defined thresholds, the emergency log maintenance policy will be enforced. Enforcement of the maintenance policy generally means that old logs will be deleted to make room for new ones.\n\nReview the configuration in SmartConsole > Check Point Host > Logs > Storage > Disk Space Management:\n\n![Log Server Disk Maintenance Settings](https://sc1.checkpoint.com/sc/SolutionsStatics/sk38848/sk38848-log-server-maintenance-settings202307020046463.png)\n\nIf the maintenance operation is not able to clear space for new logs, it's possible that something else occupies the disk space (which is exempt from routine clean-up).\n\nIf automatic maintenance fails to clear the necessary space to write logs to the Log Server, employ other strategies like [sk63361](https://support.checkpoint.com/results/sk/sk63361 \"sk63361: How to clean up disk space on a Security Gateway or Security Management Server\").\n\n### Switch the active fw.log file...\n\nThis step is generally only helpful when logs are sent to the Log Server, but not written to the fw.log file.\n\nIssue the \"fw logswitch\" command on the Log Server:\n\n```\n<strong>[Expert@LogServer]# fw logswitch</strong><br>Log file has been switched to: YYYY-MM-DD_hhmmss.log\n```\n\nVerify whether the Log Server's fw.log file has started writing logs:\n\n```\n<strong>[Expert@Hostname]# watch -d \"ls -l $FWDIR/log/fw.log\"</strong>\n```\n\n### Restart FWD daemons...\n\nIf logs are not being written as configured, you may consider restarting FWD as a troubleshooting step. Before executing this step, it is recommended to review fwd.elg from both hosts for clues about logging failure.\n\n```\n<strong>[Expert@Hostname]# tail -F $FWDIR/log/fwd.elg</strong>\n```\n\nTroubleshoot any relevant errors before preparing to restart FWD. Outstanding errors may persist after a FWD restart if left undiagnosed.\n\n**Note:** Be aware that FWD is monitored by ClusterXL. **Restarting FWD on an ACTIVE cluster member will cause a FWD pnote**, which triggers a failover. Restarting FWD on a Log Server causes momentary impact to logging, but does not otherwise impact traffic.\n\n##   \nWhat to try next?\n\nIf the Security Gateway still fails to send logs to the Log Server, consider debugging the log transmission process per [sk179756](https://support.checkpoint.com/results/sk/sk179756 \"sk179756: How to debug log generation and transmission\").\n\nIf the Log Server receives logs from the Security Gateway but they do not populate the Logs & Monitor view of SmartConsole, [contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/) to get assistance.","language":"md","time":"14 days ago","created":"2025-05-06T22:55:56.777Z","annotations":[],"updated":"2025-05-06T22:56:43.489Z"},{"title":"Troubleshooting Check Point Logging Issues","id":"282e09e0-3861-4b23-b7d7-ae7259be6890","type":"TEXT","raw":"## Troubleshooting Check Point logging issues when Security Management Server / Log Server is not receiving logs from Security Gateway\n\nProductMulti-Domain Security Management, Quantum Security Gateways, Quantum Security Management\n\nVersionR77.20 (EOS), R77.30 (EOS), R80 (EOS), R80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nLast Modified2024-10-15\n\n## Solution\n\nWhen troubleshooting logging related issues in a distributed environment, proceed as follows:\n\n(Before going through these steps, make sure the log directory in $FWDIR/log on SmartCenter exist. If this is Multi-Domain, make sure that both CMA/CLM and log directory exist in /var/log/mds\\_logs/CMA\\_name/log.)\n\n1.  In SmartConsole, go to '`Policy`' menu - click on '`Install Database...`' - select the Security Management Server and Log Servers - click '`OK`'.\n2.  Ensure that you have not run out of disk space on the Security Management Server / Log Servers, to which the logs are being sent:\n    \n    -   On Gaia / SecurePlatform / Linux / IPSO OS:\n        \n        Run **`df -kh`** command - check the \"`Use%`\" column\n    -   On Windows OS:\n        \n        On Desktop, open '`My Computer`' - right-click on the relevant hard disk - click on '`Properties`' - check the \"`Free space`\" line.\n    \n      \n    If needed, delete or move the unneeded logs / files to an external storage device.\n3.  Is the Security Gateway configured to send logs to Security Management Server / Log Server?\n    \n    In SmartConsole, open the Security Gateway object - check each setting in the \"`Logs`\" section.  \n    If any change was made, install policy.\n4.  Is the Security Management Server able to communicate over SIC with Security Gateway ?\n    \n    In SmartConsole, open the Security Gateway object - on '`General Properties`' pane, in \"`Secure Internal Communication`\" section - click on \"`Test SIC Status...`\".\n    \n    If this fails, then it might be due to connectivity / routing issues between the Security Gateway and the Security Management Server.\n5.  Is the Security Gateway able to communicate (other than SIC) with the Security Management Server?\n    \n    Test by sending pings from the Security Gateway to the Security Management Server.  \n    Test by sending pings from the Security Management Server to the Security Gateway.\n    \n    Note: Security policy must allow ICMP between the Security Gateway and the Security Management Server.\n    \n    If this fails, and security policy will allows ICMP, then it is most likely a routing issue on Security Gateway. Check the routing table on Security Gateway - there has to be a route to Security Management Server's network / Security Management Server's IP address:\n    \n    **`netstat -rn`**\n6.  Is the Security Management Server listening on TCP port 257?\n    \n    -   On Gaia / SecurePlatform / Linux / IPSO OS:\n        \n        **`# netstat -anp | grep \":257\"`**\n    -   On Windows OS:\n        \n        **`netstat -abno | findstr \":257\"`**\n7.  Check the Log Policy settings in _**`log_policy.C`**_ file on the Security Management Server:\n    \n    Note: Settings in this file have to match the settings in SmartDashboard in the Security Management Server object.\n    \n    -   On Gaia / SecurePlatform / Linux / IPSO OS:\n        \n        **`$FWDIR/conf/log_policy.C`**\n    -   On Windows OS:\n        \n        **`%FWDIR%\\conf\\log_policy.C`**\n    \n    _Example_:\n    \n    > ```\n    > (\n    >         :stop_logging_on_free_disk_space (true)\n    >         :min_free_disk_space (15)\n    >         :stop_free_disk_space_metrics (mbytes)\n    >         :reject_connections (false)\n    >         :alert_on_disk_space (true)\n    >         :alert_free_disk_space (396)\n    >         :alert_free_disk_space_metrics (mbytes)\n    >         :alert_type (alert)\n    >         :log_switch_on_file_size (false)\n    >         :scheduled_switch (false)\n    >         :forward_logs (false)\n    >         :log_delete_on_below (true)\n    >         :log_delete_below_metrics (mbytes)\n    >         :log_delete_below_value (495)\n    >         :log_keep_on_days (false)\n    >         :log_delete_on_run_script (false)\n    >         :dlp_blob_delete_on_run_script (false)\n    >         :dlp_blob_delete_above_value_percentage (20)\n    >         :dlp_blob_delete_on_above (true)\n    >         :packets_capture_reserved_disk_metrics (mbytes)\n    >         :packets_capture_reserved_disk_size_MB (500)\n    >         :dlp_blob_fetch_bulk_size (200)\n    >         :dlp_blob_fetch_interval (5)\n    >         :dlp_blob_retry_interval (180)\n    > )\n    > ```\n    \n8.  Are any logs coming from the Security Gateway to Security Management Server?\n    \n    -   On Gaia / SecurePlatform / Linux / IPSO OS:\n        \n        **`# tcpdump -n -i _INTERFACE_NAME_ host _IP_ADDRESS_of_GW and_ tcp port 257`**\n    -   On Windows OS:\n        \n        Use WireShark and filter for TCP port 257 and IP Address of Security Gateway.\n    \n      \n    **Note:** When NAT is configured on the Security Management object, make sure to check the 'Apply for Security Gateway Control Connections' checkbox.\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk40090/sc11909260437.JPG)\n    \n9.  Verify that topology has not changed, in case customer has reinstalled firewall or added an interface to it.  \n    Topology in the gateway object has to match interfaces and ip assigned to them in CLI of the gateway.  \n    In some cases Anti-spoofing may block logging if topology has changed. If this is the case - to resolve this issue go to the object of the problematic gateway or cluster and do get interfaces with topology.  \n    **Note.** Make sure you know what interface configuration looks like before you do this step, as you may have to re-assign Anti-spoofing groups if you had any configured. Take a database revision control or a backup of the management, or at least cpinfo, or screen shots of the interfaces configuration before doing fetch interfaces with topology.  \n    Save the changes.  \n    Install policy to the gateway.\n    \n10.  Is the active firewall log file _**`fw.log`**_ growing on the Security Gateway?\n    \n    -   On Gaia / SecurePlatform / Linux :\n        \n        **`# watch -d -n 2 \"ls -l $FWDIR/log/fw.log\"`**\n    -   On Windows OS:\n        \n        -   Either use Windows Explorer to monitor the size of the **`%FWDIR%\\log\\fw.log`** file\n        -   Or use Windows Command Prompt and repeatedly run the command  \n            **`dir %FWDIR%\\log\\fw.log`**\n    \n    If the active firewall log file is growing, then the Security Gateway is logging locally instead of forwarding the logs to the Security Management Server.\n    \n    This could be a connectivity / routing issue, or it could be the way the logging was configured on this Security Gateway. Check the Security Gateway object to ensure it is configured to send logs to the Management Server.\n11.  Check the _**`masters`**_ file on the Security Gateway.\n    \n    -   On Gaia / SecurePlatform / Linux / IPSO OS:\n        \n        **`# cat $FWDIR/conf/masters`**\n    -   On Windows OS:\n        \n        open **`%FWDIR%\\conf\\masters`**\n    \n    The Hostname of the Security Management Server must be listed in this file.\n    \n    _Example_:\n    \n    > ```\n    > [Policy]\n    > Hostname_of_Management_Server\n    > \n    > [Log]\n    > Hostname_of_Management_Server\n    > \n    > [Alert]\n    > Hostname_of_Management_Server\n    > ```\n    \n12.  The active firewall log file _**`fw.log`**_ might be corrupted on the Security Gateway.\n    \n    1.  Create a temporary folder anywhere outside **`$FWDIR/log/`** (on Windows OS: **`%FWDIR%\\log\\`**)\n    2.  Stop all Check Point services with _**`cpstop`**_ command  \n        Note: This will stop all traffic. In cluster, this will cause fail-over.\n    3.  Move all **`fw.log*`** files from the **`$FWDIR/log/`** (on Windows OS: **`%FWDIR%\\log\\`**) folder to a new temporary folder  \n        Note: Do _not_ move the folder \"**`log`**\" itself\n    4.  Start all Check Point services with _**`cpstart`**_ command\n    5.  Check if **`$FWDIR/log/fw.log`** (on Windows OS: **`%FWDIR%\\log\\fw.log`**) file was created and if it is growing\n13.  The active firewall log file _**`fw.log`**_ might be corrupted on the Security Management Server.\n    \n    Switch the active firewall log on the Security Management Server:\n    \n    -   Either from SmartView Tracker : go to \"`Network & Endpoint`\" tab - go to '`File`' menu - click on '`Switch Active File...`'\n    -   Or from command line:  \n        **`fw logswitch`**\n    \n    If switching the active log does not work / fails, perform the following on the Security Management Server:\n    \n    1.  Create a temporary folder anywhere outside **`$FWDIR/log/`** (on Windows OS: **`%FWDIR%\\log\\`**)\n    2.  Stop all Check Point services with _**`cpstop`**_ command\n    3.  Move all **`fw.log*`** files from the **`$FWDIR/log/`** (on Windows OS: **`%FWDIR%\\log\\`**) folder to a new temporary folder  \n        Note: Do _not_ move the folder \"**`log`**\" itself\n    4.  Start all Check Point services with _**`cpstart`**_ command\n    5.  Check if **`$FWDIR/log/fw.log`** (on Windows OS: **`%FWDIR%\\log\\fw.log`**) file was created and if it is growing\n14.  Debug FWD on the Gateway to show why it is logging locally or logging to the wrong log server. The debug file is created in `$FWDIR/log/fwd.elg`.\n    \n    **`# fw debug fwd on TDERROR_ALL_FWLOG_DISPATCH=5`**\n    \n    Replicate the logging issue.\n    \n    **`# fw debug fwd off TDERROR_ALL_FWLOG_DISPATCH=0`**\n    \n\n**Related Solution for Gaia Embedded Appliances:** [sk112858 - ATRG: Gaia Embedded Appliances](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk112858).\n\nRelated Solution: [sk98317 - Connectivity problems between the Security Gateway and the Log Server](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98317)\n\n## Article Properties\n\nOriginatorLisa Knowles\n\nTechnical ResourceMauro Roiz\n\nAccess LevelGeneral\n\nStatusApproved\n\nDate Created2009-04-14\n\nLast Modified2024-10-15\n\nEditorDavid Kornfield\n\nLast ApproverRonit Segal\n\n## Comments\n\n#### Internal only\n\n**Important note: Prior to using the tools mentioned in this article, make sure you thoroughly go over [sk156153 - Best Practice Guide for Debugging Check Point Products](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk156153).**\n\nThe sk should never be deleted since it is referenced in Check Point PRO tool.\n\nAs per Tomer Noy (R&D):\n\nSome of the management-side information is relevant for Edges as well. Especially the parts about files, disk space and policy.\n\nThat said, from my memory, Edges send logs a bit differently than standard CP appliances. They are sent to the SMS process, who then sends them to fwd. I'm not sure if there is much to troubleshoot there.\n\n(Some of the troubleshooting steps are not relevant for Edge gateways, but adding instruction for both types of gateways may complicate the instructions and confuse the user.)","language":"md","time":"14 days ago","created":"2025-05-06T22:55:57.266Z","annotations":[],"updated":"2025-05-06T22:56:43.155Z"},{"title":"ClusterXL: Check Point Cluster Overview","id":"203574b7-2b8a-422b-a667-8ab131cfc5bd","type":"TEXT","raw":"ProductClusterXL, VSX (Traditional)\n\nVersionR80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nPlatformAll\n\nLast Modified2022-12-21\n\n## Solution\n\nThis article explains how to perform a manual (controlled) failover in Check Point cluster while maintaining full connectivity with each cluster member, keeping interference with cluster's operations at a minimum.\n\n**Table of Contents:**\n\n1.  Overview\n    \n2.  Default Critical Devices\n    \n3.  Simulating cluster failure\n    \n4.  Adding a Critical Device\n    \n5.  Initiating a manual failover\n    \n6.  Notes\n    \n7.  Related Solutions\n    \n\n### (1) Overview\n\nDuring a failover, a cluster member is declared failed and all connections are then moved from this member to other members in the cluster.\n\nA member is declared failed when at least one of the monitored mission-critical components fails. These monitored components are called \"Critical Devices\" or \"Problem Notifications\" (pnote).\n\nClusterXL is designed so that when at least one of its _Critical Devices_ reports its state as \"`problem`\", the member is declared as failed (its state is changed to \"Down\" in the output of \"`cphaprob state`\" command), and failover occurs.\n\nRefer to _ClusterXL Administration Guide_ ([R55](http://supportcontent.checkpoint.com/documentation_download?id=5677), [R60](http://supportcontent.checkpoint.com/documentation_download?id=5509), [R61](http://supportcontent.checkpoint.com/documentation_download?id=6355), [R62](http://supportcontent.checkpoint.com/documentation_download?id=6824), [R65](http://supportcontent.checkpoint.com/documentation_download?id=7240), [R70](http://supportcontent.checkpoint.com/documentation_download?id=8714), [R71](http://supportcontent.checkpoint.com/documentation_download?id=10641), [R75](http://supportcontent.checkpoint.com/documentation_download?id=11659), [R75.20](http://supportcontent.checkpoint.com/documentation_download?id=12265), [R75.40](http://supportcontent.checkpoint.com/documentation_download?id=13090), [R75.40VS](http://supportcontent.checkpoint.com/documentation_download?id=16221), [R76](http://supportcontent.checkpoint.com/documentation_download?id=22910), [R77](http://supportcontent.checkpoint.com/documentation_download?id=24800)):\n\n-   Chapter \"Introduction to ClusterXL\" - Clustering Definitions and Terms\n-   Chapter \"Monitoring and Troubleshooting Gateway Clusters\" - Verifying that a Cluster is Working Properly\n\n### (2) Default Critical Devices\n\n**Note:** in R77.30 and above, run the \"`cphaprob -l list`\" command; in R77.20 and lower, run the \"`cphaprob -ia list`\" command.\n\n<table><tbody><tr><td>Critical Device</td><td>Description</td></tr><tr><td><em>Interface Active Check</em></td><td>Shows the state of cluster interfaces.</td></tr><tr><td><em>Synchronization</em></td><td>Shows the success or failure of Full Synchronization, which takes place when a cluster member joins the cluster (after reboot or after <code>cpstop</code> / <code>cpstart</code> commands).</td></tr><tr><td><em>Filter</em></td><td>Shows the success or failure of loading the Security Policy (whether the Policy was/is installed or not).</td></tr><tr><td><em>cphad</em></td><td><p>Shows the state of clustering daemon <code>cphamcset</code>.</p><p>Notes:</p><ul><li>Starting in R77.20, refer to <code>$FWDIR/log/cphamcset.elg</code> file</li><li>Does not exist in VSX NGX R65 / R67 / R68 cluster.</li></ul></td></tr><tr><td><em>fwd</em></td><td>Shows the state of FireWall daemon <code>fwd</code>.</td></tr><tr><td><em>cvpnd</em></td><td>Shows the state of Mobile Access daemon <code>cvpnd</code> (if Mobile Access Blade is enabled).</td></tr><tr><td><em>routed</em></td><td>On Gaia OS R76 and above, shows the state of Routing daemon <code>routed</code>.</td></tr><tr><td><em>VSX</em></td><td><p>On VSX cluster members running Gaia OS R75.40VS and above:</p><ul><li>In context of VS0 means that states of all Virtual Systems are not 'Down'</li><li>In context of other Virtual Systems means that VS0 is alive</li></ul></td></tr><tr><td><em>FIB</em></td><td>On SecurePlatform Pro OS with enabled Advanced Dynamic Routing suite, shows the state of FIB Manager daemon <code>fibmgrd</code>.</td></tr><tr><td><em>ted</em></td><td>On R77 and above, shows the state of Threat Emulation daemon <code>ted</code> (if Threat Emulation Blade is enabled).</td></tr><tr><td><em>Instances</em></td><td>On VSX cluster members in VSX HA mode (not VSLS) running Gaia OS R75.40VS and above, shows whether there is a mismatch between the number of CoreXL FW instances in the received CCP packet and the number of loaded CoreXL FW instances on this VSX member / this Virtual System (refer to <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk106912\" target=\"_blank\" rel=\"noopener\">sk106912</a>).</td></tr></tbody></table>\n\nAdditional critical devices (pnotes) that are registered by Check Point shell scripts:\n\n<table><tbody><tr><td>Check Point Shell Script</td><td>Registered Critical Device</td><td>Notes</td></tr><tr><td><em>$FWDIR/bin/clusterXL_admin</em></td><td><em>admin_down</em></td><td>Refer to the explanation in the section<br>\"<span targetid=\"Initiating a manual failover\">(5) Initiating a manual failover</span>\"</td></tr><tr><td><em>$FWDIR/bin/clusterXL_monitor_ips</em></td><td><em>host_monitor</em></td><td>Refer to <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk35780\" target=\"_blank\" rel=\"noopener\">sk35780</a></td></tr><tr><td><em>$FWDIR/bin/clusterXL_monitor_process</em></td><td>names of processes that are specified in the <em>$FWDIR/conf/cpha_proc_list</em> file</td><td>Refer to <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk92904\" target=\"_blank\" rel=\"noopener\">sk92904</a></td></tr></tbody></table>\n\nEach Critical Device has these attributes:\n\n<table><tbody><tr><td>Attribute</td><td>Description</td></tr><tr><td><em>Registration number</em></td><td>Used for internal kernel purposes.</td></tr><tr><td><em>Timeout</em></td><td>Specifies how frequently (in seconds) the kernel expects to receive a state report from Critical Device - if there is no report after this time, the kernel will change the state of the Critical Device to \"problem\", the member will be declared as failed, and failover will occur (this attribute is relevant only for some Critical Devices).</td></tr><tr><td><em>Current state</em></td><td>Specifies the state of Critical Device (<code>ok</code>, <code>problem</code>, <code>init</code>).</td></tr><tr><td><em>Time since last report</em></td><td>The time (in seconds) that passed since the kernel received the last state report from Critical Device.</td></tr></tbody></table>\n\n_Example output of the \"cphaprob -ia list\" command_:\n\n> ```\n> Device Name: Synchronization\n> Registration number: 0\n> Timeout: none\n> Current state: OK\n> Time since last report: 4143 sec\n> \n> Device Name: Filter\n> Registration number: 1\n> Timeout: none\n> Current state: OK\n> Time since last report: 4135.7 sec\n> \n> Device Name: fwd\n> Registration number: 2\n> Timeout: none\n> Current state: OK\n> Time since last report: 7500.4 sec\n> \n> Device Name: cphad\n> Registration number: 3\n> Timeout: none\n> Current state: OK\n> Time since last report: 5435.8 sec\n> \n> Device Name: routed\n> Registration number: 4\n> Timeout: none\n> Current state: OK\n> Time since last report: 198.7 sec\n> \n> Device Name: ted\n> Registration number: 5\n> Timeout: 600 sec\n> Current state: OK\n> Time since last report: 0.3 sec\n> \n> Device Name: cvpnd\n> Registration number: 6\n> Timeout: none\n> Current state: OK\n> Time since last report: 0.6 sec\n> ```\n\n### (3) Simulating cluster failure\n\nA user might want to simulate a cluster failure by causing one of the default Critical Devices to report a problem.\n\n**Examples:**\n\n-   Unplugging a cable from a cluster interface - a problem will be reported by the \"_Interface Active Check_\" pnote.\n-   Shutting down a cluster interface - a problem will be reported by the \"_Interface Active Check_\" pnote.\n-   Unloading the Security Policy - a problem will be reported by the \"_Filter_\" pnote.\n-   Stopping FWD daemon - a problem will be reported by the \"_FWD_\" pnote.\n\nThis approach is **not** recommended as it directly affects the cluster member. Although this approach lets you test the cluster failover, this can cause problems, such as that a user might get disconnected from the cluster member and will not be able to reconnect to it.\n\nCheck Point recommends to create an additional Critical Device, and create/simulate a problem on that new pnote.\n\n### (4) Adding a Critical Device\n\n-   The syntax for _adding_ a Critical Device is:\n    \n    **`[Expert@HostName]# cphaprob -d _Device_Name_ -t _TimeOut_in_Sec_ -s _State_ [-p] register`**\n-   The syntax for _removing_ a Critical Device is:\n    \n    **`[Expert@HostName]# cphaprob -d _Device_Name_ [-p] unregister`**\n\nwhere:\n\n<table><tbody><tr><td>Argument</td><td>Description</td></tr><tr><td><em>Device_Name</em></td><td>String (case-insensitive) - name of the Critical Device.</td></tr><tr><td><em>TimeOut_in_Sec</em></td><td>Unsigned integer (only positive values) - number of seconds between expected state reports from Critical Device.</td></tr><tr><td><em>State</em></td><td>String (case-sensitive) - one of these possible values:<br><ul><li><em>ok</em></li><li><em>problem</em></li><li><em>init</em> (used for internal kernel purposes)</li></ul></td></tr><tr><td><em>[-p]</em></td><td>Optional flag (stands for \"permanent\") - the Critical Device will be automatically added to the <em>$FWDIR/conf/cphaprob.conf</em> file, so that this configuration survives the reboot.</td></tr></tbody></table>\n\nWhen the configuration of a cluster member is changed from the default (which is stored in the kernel) to anything else, the configuration file _$FWDIR/conf/cphaprob.conf_ is updated with new configuration (in addition, refer to the `$FWDIR/conf/cpha_global_pnotes.conf` file).\n\n### (5) Initiating a manual failover\n\n1.  Add a new Critical Device.\n2.  Report a problem on the new Critical Device.\n\nThese 2 steps can be combined into a single command:\n\n**`[Expert@HostName]# cphaprob -d _Device_Name_ -t _TimeOut_in_Sec_ -s problem [-p] register`**\n\nThe _**$FWDIR/bin/clusterXL\\_admin**_ is a special shell script that not only makes the task of adding a new Critical Device easier, but also checks the change in member's state and provides the user with the feedback.\n\nThis script registers a Critical Device called \"_**admin\\_down**_\".\n\n-   The syntax for _bringing down_ the cluster member is:\n    \n    **`[Expert@HostName]# clusterXL_admin down [-p]`**\n-   The syntax for _bringing up_ the cluster member is:\n    \n    **`[Expert@HostName]# clusterXL_admin up [-p]`**\n\nNote: The **`[-p]`** is an optional flag (stands for \"permanent\") - the Critical Device called \"_**admin\\_down**_\" will be automatically added to the _$FWDIR/conf/cphaprob.conf_ file, so that this configuration survives the reboot.\n\n### (6) Notes\n\n-   On 3rd party cluster based on IPSO OS, you need to enable the option 'Monitoring the Firewall State' in IPSO Voyager - refer to [sk35889: Nokia Voyager - 'Monitoring the Firewall State' option](http://supportcontent.checkpoint.com/solutions?id=sk35889).\n    \n-   On Security Gateway 80 appliances, the location and the name of '**`clusterXL_admin`**' script differs. Refer to [sk65060: How to cause a manual fail-over in ClusterXL on SG-8x appliances](http://supportcontent.checkpoint.com/solutions?id=sk65060).\n    \n\n-   [sk26874 - Cannot simultaneously ping Virtual IP address of the cluster and IP addresses of physical interfaces on cluster members from a remote host](http://supportcontent.checkpoint.com/solutions?id=sk26874)\n-   [sk50840 - How to enable ClusterXL Virtual MAC (VMAC) mode](http://supportcontent.checkpoint.com/solutions?id=sk50840)\n-   [sk56060 - How to perform manual fail-over between instances of Virtual System in VSX cluster in VSLS mode](http://supportcontent.checkpoint.com/solutions?id=sk56060)\n-   [sk95133 - 'clusterXL\\_admin down' does not cause Virtual Systems to failover to the Active cluster member when VSLS is used](http://supportcontent.checkpoint.com/solutions?id=sk95133)\n-   [sk115553 - Critical Device \"routed\" reports its state as \"problem\" after running the \"clusterXL\\_admin up\" command](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk115553)\n-   [sk93306 - ATRG: ClusterXL R6x and R7x](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk93306)\n\n## Article Properties\n\nOriginatorSergei Shir\n\nTechnical ResourceGuy Elyashiv\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2010-10-05\n\nLast Modified2022-12-21\n\nEditorGil Frantsus\n\nLast ApproverRonit Segal\n\n## Comments\n\n#### Internal only\n\n**This SK is managed by the SecureKnowledge Team. Do not edit it yourself. If you need to make changes/updates to it, submit the feedback (using the field at the bottom of this SK), or contact the SK owner (shown in the top header).**\n\n**Should not be deleted - referenced in [sk93306 (ATRG ClusterXL)](http://supportcontent.checkpoint.com/solutions?id=sk93306).**","language":"md","time":"14 days ago","created":"2025-05-06T22:55:57.442Z","annotations":[],"updated":"2025-05-06T22:57:02.518Z"},{"title":"Code Snippet: Introduction, Process Flow Diagrams and Description","id":"c2497816-0853-4bfc-853a-d7951fa9e214","type":"TEXT","raw":"**Table of Contents**\n\n-   Introduction\n    \n-   Process Flow Diagrams and Description\n    \n-   QUIC Protocol\n    \n-   Application Control Troubleshooting Flow Chart\n    \n-   Application Control Debug Procedures\n    \n    -   Next Rule Base (NRB) Debugging Instructions\n        \n    -   Application Control and URL Filtering Update Process Debugging\n        \n\n## Introduction\n\n**_The Need for Application Control_**\n\nThe use of internet applications comes with risks that administrators must know about:\n\n-   Malware threats: Application use can open networks to threats from malware. Popular applications like Twitter, Facebook, and YouTube can cause users to download viruses unintentionally. File sharing can easily cause malware to be downloaded into your network.\n-   Bandwidth hogging: Applications that use a lot of bandwidth, for example, streaming media, can limit the bandwidth that is available for important business applications.\n-   Loss of Productivity: Employees can spend time on social networking and other applications that can seriously decrease business productivity. Employers do not know what employees are doing on the internet and how that really affects them.\n\n**_The Check Point Solution for Application Control_**\n\nCheck Point's latest firewall innovation brings the industry's strongest application and identity control to organizations of all sizes. You can easily create policies which detect or block thousands of applications.\n\n-   Granular Application Control: Identify, allow, or block thousands of applications. This provides protection against the increasing threat vectors and malware introduced by internet applications.\n-   Largest application library with AppWiki: Comprehensive application control that uses the industry's largest application library. It scans for and detects more than 8,411 applications and more than 255,736 Web 2.0 widgets. Checkpoint data base is updated frequently with world wide Apps and widgets.\n\n## Process Flow Diagrams and Description\n\n_**Install Policy Flow**_\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk73220/Install_Policy.png)\n\nDuring install policy, the CMI Loader collects signatures from multiple sources (e.g. IPS and Application Control) and compiles them together into unified Pattern Matchers (PM) (one for each context - such as URL, Host header etc.).\n\n**Note:** The CMI Loader is an underlying I/S that is responsible for signatures handling for Application Control and IPS blades.\n\nIn R75.20, we expand Application Control to also include custom applications located in the Check Point site, for specific customer use. Also, we introduce an additional source:\n\n-   User defined URLs, and\n-   HTTPS Inspection User defined URLs.\n\nApplication control and Custom applications signatures are kept in the Application Database (APP DB), based on two files, __appi\\_db.C__ and _appi\\_custom\\_db.C_, located on the Security Gateway. User defined URLs and HTTPS Inspection User defined URLs data is kept in the Security Gateway database.\n\nWe integrated URL Filtering together with Application Control, and both features are set in the Application Control engine (Application Control) rulebase.  \nURL Filtering is represented by a new CMI application client: URL Filtering. This client behaves like an Application Control client. It uses Application Control DB for metadata, but instead of using signatures, it uses the Online application detection engine (RAD) service. (RAD (Short for Resource Advisor) is responsible for the detection of Social Network widgets, e.g Mafia Wars).)\n\nIn addition to signatures, application metadata (such as description, tags, etc.) is read from _appi\\_db.C_.\n\nThe final stage is serializing the data to the FireWall kernel. This completes the install policy process.\n\n_**Updates Flow**_\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk73220/updates_flow_1.png)\n\nFWD is the process that runs the update mechanism on the Security Gateway. It uses a dynamic library named CIU that is responsible for the execution of the update process. The update process is only executed, if it is enabled in the policy, and it is executed according to the user defined schedule (every 2 hours, by default).\n\nThe flow of the update is as follows:\n\n1.  CIU fetches a Version file from the download site. The version of the new file is checked to find out if the Security Gateway is up to date or should be updated.\n2.  CIU fetches an update package, from the download site, that includes the databases of the Application Control (APPI) & URL Filtering (URLF) blades.\n3.  CIU executes the \"_fw load\\_sigs_\" command as a separate process to perform the actual commit of the new database.\n4.  The flow of CMI Loader during the update process is similar to the policy installation process: CMI Loader collects signatures from multiple CMI apps and compiles them together into unified Pattern Matchers (one for each context - such as URL, Host header etc.).\n5.  The signatures and the applications metadata are read from the new APP DB, fetched in Step 2 of the update (_appi\\_db.C.tmp_ on the Security Gateway).\n6.  The data is serialized\n7.  At this point, CIU collects the status of the \"_fw load\\_sigs_\" command execution\n8.  If the status is OK, CIU executes another process: \"_rad\\_admin update_\" that loads the updated local database (LDB) of the URL Filtering blade. See URL Filtering Engine.\n9.  If the second process is successful as well, CIU replaces the previous version and database files in the _$FWDIR/appi/update/_ directory with new ones.\n10.  CIU updates the _$FWDIR/appi/update/appi\\_status.C_ file with the new update status. See Application Control and URL Filtering Update Process Debugging.\n\nApplication Control URL Filtering Inspection Flow\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk73220/APPI_&_URLF_Inspection_1.png)\n\nThe parsers divide the connection to contexts (e.g. HTTP Host Header, TCP Client to Server Data) and then call CMI that invokes execution of Pattern Matchers on the different contexts, or the parsers call directly to relevant blades.\n\nAfter a match by the Pattern Matcher, the CMI Loader notifies the relevant blade that its signature was matched. Application Control retrieves all the data regarding the application (its categories, priority, etc.), based on the signature that was matched, or goes to the online service for social network widget detection. URL Filtering retrieves the URL context from CMI and sends it the URL Filtering Online Service for categorization.\n\nThe data regarding the matched application and/or the URL category is transferred to the Application Control connection, managing the connection state. The connection holds a list of transactions that may include an HTTP transaction, representing a single HTTP request-response, or a connection transaction, representing a whole TCP/UDP client-server connection.\n\nThe data is transferred to the relevant (current) transaction that aggregates it to the point, where a decision must be made (usually the first response from the server).\n\nAt this point, the transaction invokes a rulebase execution, passing all the data detected on it (applications, categories etc.). It is the rulebase's responsibility to communicate with the user-awareness unit in order to retrieve the current user.\n\nApplication Control is responsible for enforcing the rulebase policy according to the matched rule. It can be understood from the above that Application Control and URL Filtering are managed and enforced together, meaning that each blade is responsible for collecting its own data and transferring it to the shared state (Application Control connection).\n\n**In R80.x:**\n\n**![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk73220/APPI_&_URLF_Inspection_R80_101708240054.png)**\n\nThe data regarding the matched application and/or the URL category is transferred to the Unified Policy connection, managing the connection state. The connection holds a list of transactions that may include an HTTP transaction, representing a single HTTP request-response, or a connection transaction, representing a whole TCP/UDP client-server connection.\n\nThe data is transferred to the relevant (current) transaction that aggregates it to the point, where a decision must be made (usually the first response from the server).\n\nAt this point, the transaction invokes a rulebase execution, passing all the data detected on it (applications, categories etc.). It is the rulebase's responsibility to communicate with the user-awareness unit in order to retrieve the current user.\n\n_**HTTPS Inspection Matching**_\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk73220/https_Inspection_Matching_1.png)\n\n#### General\n\nIn order to inspect HTTPS encrypted traffic, we implement man-in-the-middle on the SSL protocol.  \nThe Security Gateway poses as a client with the server, and as a server with the client (for this purpose the Security Gateway creates a fake server certificate with all fields equals to the origin except the public key, issuer, issuer signature and CRL DP). Thus the Security Gateway creates two different sets of keys: one (CF key) to encrypt/decrypt client side traffic, another (SF key) to encrypt/decrypt server side traffic.\n\nWe support two different network configurations:\n\n**The Security Gateway is situated after a proxy or there is no proxy at all.**  \nCommon SSL traffic (Client Hello, Server Hello, encrypted data).\n\nThe **Security Gateway** **is situated between client and proxy.**  \nIn this case first two messages between Client and Proxy are not SSL messages, but HTTP request and response: Client sends \"CONNECT domain:port HTTP/1.1\" request to Proxy to notify it about SSL tunneling that should be established. Proxy replies with \"Connection Established\" response. From this point, all traffic between Client and Server is common SSL traffic.\n\nThe HTTPS Inspection RuleBase runs mostly in the kernel. The enforcement is done completely in the kernel, while policy installation is done partially in the kernel and partially in user space. There is no dedicated process. Policy installation code is part of the \"regular\" policy installation of the Security Gateway, and is executed under the \"fw\" process (e.g., _fw fetch localhost_).\n\n#### **Matching**\n\nSSL Inspection requires CPAS streaming to be initialized. CPAS (active) streaming is a much more resource-consuming infrastructure than PSL (passive) streaming, therefore we try to avoid CPAS streaming initialization, as soon as possible. In order to avoid CPAS streaming initialization, when we do not really need it, we run HTTPS Inspection rulebase twice on the same connection.\n\nNotes:\n\n-   Check Point's Active Streaming infrastructure (CPAS) supplies applications above it the means of handling the TCP data stream, without having to care about the implementation below (e.g. 3 way handshake enforcement, retransmissions, checksums, etc.). CPAS, as opposed to PSL, supplies means of modifying the data passed, such as enabling the changing of data, removing parts of it, and even injecting completely new data. These capabilities where once achieved through the Security Servers. This included folding the connection to the firewall and having context switches to and from user-space. Since CPAS is implemented completely in the kernel, there is no more need for context switches, hence a performance increase.\n-   PSL is the passive streaming infrastructure used in R70 that replaced the TCPSTR infrastructure that existed pre-R70.\n\nThe first time it is run on the SYN packet, as part of the Security Rulebase execution (_fw\\_https\\_inspection\\_exe\\_rulebase\\_SYN_ function). Thus, if HTTPS Inspection Rulebase returns NO MATCH, then SSL Inspection will not influence the steaming type decision (PSL will be used in most cases), but if HTTPS Inspection Rulebase returns MATCH/POSSIBLE MATCH (we cannot make final decision), then active (CPAS) streaming will be initialized.\n\nThe second time it is run on the Client Hello packet (https\\_inspection\\_exe\\_rulebase function). This time, we make the final match (URL is taken from DN cache or from previous CONNECT request), calculate the action that should be performed (according to action from the matched rule, blades defined on the matched rule and exceptions) and perform the action (INSPECT/BYPASS) on the connection.\n\nBeside the common columns in RuleBase we have several non standard ones:\n\n**Site Category** - Behaves as Application Control / URL Filtering Application/Site column, but here we use DN instead of full URL. We get the DN either from CONNECT request (proxy) or from DN cache that maps server's IP to DN from server's certificate. In order to create the mapping of IP<->DN, the HTTPS inspection rulebase performs a one-time inspection for every new host accessed, regardless of the policy.  \n**Action** - Inspect traffic or Bypass it, meaning do not terminate SSL.  \n**Blades** - Determines which blades will be activate after SSL termination. Note that there may be exceptional defenses that will not be activated, although the blade is set, because they are located before termination. An example of that is Advanced Patterns.\n\nConnection could be held during HTTPS Inspection rulebase execution due to Identity Awareness (IDA) or RAD/URL Filtering request for a-sync execution.\n\n_**Rulebase Matching**_\n\n**From R80.10:** Refer to the \"Rule Matching in the Access Control Policy\" section in the [Next Generation Security Gateway R80.10 Guide](https://sc1.checkpoint.com/documents/R80.10/WebAdminGuides/EN/CP_R80.10_NexGenSecurityGateway_Guide/html_frameset.htm).\n\n**Pre-R80.10**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk73220/Rulebase_Matching_1.jpg)\n\nApplication Control and URL Filtering uses Transaction objects in order to manage the connection parsing events, detecting applications/URL Filtering and enforcing policy. Transaction object represents a single set of client request and server response in a connection.\n\nOne of the important phases in connection flow is calling Application Control/URL Filtering rulebase for matching with the detected applications/categories (and their properties) and the connection data.\n\nEvery RB based on our NRB (New Rule Base) I/S includes common columns I/S (src, dst, service, action, track etc...) with additional column - Applications/Sites.\n\nEach column maintain its data in a kernel table. The tables are built as follows: key = specific match data (application id, source ip etc...) and value = index to another table (called _appi\\_rb\\_intvl\\_kbufs\\_table_) whose value is an array of rule number ranges.  \nAn example array is \\[1,3,5,5,7,8\\], meaning the matched rules are 1,2,3,5,7,8.  \nThe matched rules of every column are intersected to create the final matched rules list.  \nRB is integrated with Identity Awareness for matching the Src/Dst column and UserCheck for Action.\n\nApplication Control/URL Filtering RB is \"first found\" RB, therefore the first rule of the final matched rules list.\n\nAfter RB match, Transaction may enforce the connection according to match result and additional action information from RB, such as action, tracking or rule UID.\n\nNote that HTTPS Inspection RB is based on the same NRB I/S and adds a Site Category and Blade column. Same behavior also here.\n\n## QUIC Protocol\n\n[QUIC Protocol](https://en.wikipedia.org/wiki/QUIC) (UDP, port 443) is a (still evolving) protocol invented by Google to provide security protection equivalent to TLS/SSL, along with reduced connection and transport latency. According to the latest information [published](https://blog.chromium.org/2015/04/a-quic-update-on-googles-experimental.html) by Google, half of Chrome’s requests to Google servers are served over QUIC Protocol. Application Control and URLF features like Safe Search, Translate, and Cache rely on traffic inspection to classify web traffic. When QUIC is used, we cannot inspect parts of the traffic, which may impact our ability to reliably classify content. If you see this in your organization, we currently recommend you block QUIC Protocol using Application Control.\n\nNote: Starting from R82 version, Check Point Security Gateways can inspect HTTP/3 traffic according to blades configurations. For more info, refer to the HTTPS Inspection section in the [Quantum Security Management Administration Guide](https://support.checkpoint.com/product/184) for your version.\n\n## Application Control Troubleshooting Flow Chart\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk73220/Application_Control_Flow_Chart.png)\n\nThe flow chart above lists issues that are commonly encountered at various stages, such as Installation, Update DB and Operation:\n\n-   **Installation:** You may encounter licensing issues and issues caused by the fact that the 61000 appliance does not specify Application Control as a blade.\n-   **Update Database:** You may encounter cases where update of the Application Control database does not work.\n-   **Operation:** You may encounter cases where:  \n    -   When install policy, traffic stops for a few seconds.\n    -   UserCheck stops working.\n    -   UserCheck affects firewall, no traffic passes.\n    -   False Positives are detected.\n\n## Application Control Debug Procedures\n\n## Next Rule Base (NRB) Debugging Instructions\n\n### _General Description_\n\nNRB is responsible for executing the Application Control blade rule base. The rule base is activated upon application detection and returns the result to the Application Control Enforcement Manager for actual enforcement (log, connection handling, etc.).\n\n### _Processes_\n\nThe main part of the \"Install Policy\" process of the rule base is done as part of code generation in the Security Management machine. This results in kernel tables that can be viewed in the _$FWDIR/conf/<policy\\_name>.pf_ file.\n\nExecution of the rule base is done in the kernel.\n\n### _Main Concepts_\n\n**From R80.10:** Refer to \"Creating an Access Control Policy\" in the [Next Generation Security Gateway R80.10 Guide](https://sc1.checkpoint.com/documents/R80.10/WebAdminGuides/EN/CP_R80.10_NexGenSecurityGateway_Guide/html_frameset.htm).\n\n**Pre-R80.10**\n\n**Match**\n\nEach column maintain its data in the kernel table.\n\nThe tables are built as follows: **key** **\\=** specific match data (application ID, source IP, etc) and **value =** index to another table (called _appi\\_rb\\_intvl\\_kbufs\\_table_) in which its value is an array of rule number ranges. An example array is \\[PROJECTINFO:1,2,3,5,7,8\\], meaning the matched rules are 1,2,3,5,7,8.\n\nThe matched rules of every column are intersected to create the final matched rules list.\n\nThe Application Rule base creates the following kernel tables:\n\n-   _appi\\_rb\\_intvl\\_kbufs\\_table_ - holds rule range lists.\n-   _appi\\_rb\\_src\\_intvl\\_list_ and _appi\\_rb\\_dst\\_intvl\\_list_ - IP matching.\n-   _appi\\_rb\\_src\\_zone\\_intvl\\_list_ and _appi\\_rb\\_dst\\_zone\\_intvl\\_list_ - zone matching.\n-   _appi\\_rb\\_src\\_rule\\_to\\_role\\_ids_ and _appi\\_rb\\_dst\\_rule\\_to\\_role\\_ids_ - identity matching.\n-   _appi\\_rb\\_srvc\\_intvl\\_list_ - service matching.\n-   _appi\\_rb\\_app\\_intvl\\_list_ and _appi\\_rb\\_app\\_negate\\_intvl\\_list_ - application matching.\n\nThe \"Internet\" option, in the destination column, is implemented using Check Point zones. Internet connection is defined as a connection to an External or DMZ zone whose source zone is not the Local zone.\n\n### _Main Debug Flags_\n\n<table><tbody><tr><td>CLI Command</td><td>GW/<br>Mgmt</td><td>Kernel/<br>User Space</td><td>Description</td></tr><tr><td><em>fw ctl debug 0<br>fw ctl debug -buf 32000<br>fw ctl debug -m APPI all<br>fw ctl debug -m NRB all<br>fw ctl kdebug -T -f &gt; /var/log/debug_kernel.txt</em></td><td><p>Gateway</p></td><td><p>Kernel</p></td><td><p>Rule base execution</p></td></tr><tr><td><p><em>export TDERROR_ALL_ALL=0<br>fwm load &lt;policy_name&gt; &gt; /var/log/debug_policy_load.txt</em></p><p>(not relevant for R80.x)</p></td><td><p>Management</p></td><td><p>User Space</p></td><td><p>Install policy - code generation</p></td></tr></tbody></table>\n\n**From R80.10:**\n\n<table><tbody><tr><td>CLI Command</td><td>GW/<br>Mgmt</td><td>Kernel/<br>User Space</td><td>Description</td></tr><tr><td><em>fw ctl debug 0<br>fw ctl debug -buf 32000<br>fw ctl debug -m APPI all<br>fw ctl debug -m UP all<br>fw ctl kdebug -T -f &gt; /var/log/debug_kernel.txt</em></td><td><p>Gateway</p></td><td><p>Kernel</p></td><td><p>Rule base execution</p></td></tr><tr><td><p><em>export TDERROR_ALL_ALL=0<br></em></p></td><td><p>Management</p></td><td><p>User Space</p></td><td><p>Install policy - code generation</p></td></tr></tbody></table>\n\n### _Troubleshooting_\n\nIdentify your desired match section in the debug output\n\nIf you know one matching parameter, such as the connection five tuple, the ID of the application that was or should be matched, or the matched rule number, you can track it in the debug output and follow the lines above/below to try to figure out the problem. Look for the following lines:\n\n-   \"_setting conn parameters on handle <address>_\" following your connection five tuple.\n-   \"_setting app id <application id> on handle <address>_\" - this line should contain the id of the application. This way you can either know which application was really matched on the connection, or if you already know the application ID (using application database), you can track the matching section.\n-   \"_matching column Application (handle <address>)_\" - following this line, you should see \"_matching app id_\" and \"_matching cat id <tag/category id>_\" messages. From this, you can conclude what are the tag/category IDs that were received during enforcement.\n-   \"_rulebase \"match\" (index <rule number>)_\" - this line contain the matched rule number\n\n<table><tbody><tr><td>Issue</td><td>Debugging</td><td>Probable Causes</td><td>Resolution</td></tr><tr><td><p>\"Internet\" is never matched</p></td><td><ol type=\"A\"><li>Turn on kernel debug of NRB module (<strong>UP module in R80.x</strong>) and APPI module and follow Internet calculation according to zones.</li><li>Search for line \"<em>received INzone = &lt;name&gt; OUTzone = &lt;name&gt; (SYN 0)</em>\" and make sure it suits the Internet definition (see \"<span targetid=\"Main Concepts\">Main Concepts</span>\" section).</li></ol></td><td><p>Topology is not defined on the Security Gateway</p></td><td><p>Define Security Gateway topology. At least one interface should be defined as \"External\" or \"DMZ\".</p></td></tr><tr><td><p>Wrong rule number</p></td><td><ol><li>Turn on kernel debug of NRB module (<strong>UP module in R80.x</strong>)&nbsp;and APPI module.</li><li>Identify your desired match section in the debug output.</li><li>Note which application was matched and what are its tags/categories. This way you can find out if there is a problem with the application identification engine, or maybe a synchronization problem between Management and Gateway.<br><ol><li>Check that the application ID and its tags/categories match your expectations.</li><li>If the expected rule has a specific application (not \"Any\"), open <em>$FWDIR/conf/shadow_objects.C</em> to make sure the ID exists in this file and was received during enforcement.</li><li>Compare information with application database on the Security Gateway.</li></ol></li></ol></td><td><ul><li>\"Internet\" in destination (see issue above).</li><li>The application was not identified.</li><li>No synchronization between GUI applications database and enforcement applications database.</li><li>Identity Role was not identified.</li></ul></td><td><ul><li>Update Management and Gateway application database.</li><li>Check Identity Awareness configuration.</li><li>Define Security Gateway topology.</li></ul></td></tr><tr><td>No enforcement at all - no logs</td><td><ol><li>Is Application Control blade enabled?</li><li>Make sure Application rulebase tables exist. (See <em>$FWDIR/conf/&lt;policy_name&gt;.pf</em>)</li><li>Add \"any recognized\" rule with log to understand if the problem is \"No enforcement\" or simply \"No match\".</li><li>If it still seems like there is no enforcement, try to identify if this is because of rule base optimization code.<br><ol type=\"A\"><li>Turn on kernel debug of NRB module <strong>(UP module in R80.x)</strong> and APPI module.</li><li>Identify your desired match section in the debug output (<strong>this time only connection five tuple is relevant</strong>) and search for line \"<em>nrb_rb_app_conn5_optimization returned NO match</em>\". This means there will be no inspection on this connection.</li><li>The cause may be related to \"Internet\" or Identity Roles. See above how to fix this.</li></ol></li><li>When \"no match\" occurs, the connection is allowed and no log is sent, which may wrongly seem like no enforcement at all. To understand if you experience \"no match\", follow the guidelines of \"Wrong rule number\" and search for the line \"<em>rulebase 'NO match' in column '&lt;column name&gt;</em>\".</li></ol></td><td><ul><li>Blade not activated.</li><li>Database not updated.</li><li>Failure during install policy.</li><li>Optimization reached to \"no match\".</li><li>See causes of \"Wrong rule number\".</li></ul></td><td><ul><li>Turn on blade.</li><li>Update application database both on Management and Gateway.</li><li>See resolution of \"Wrong rule number\".</li></ul></td></tr></tbody></table>\n\n### Example of Output:\n\n**What problem was this debug taken for, SR scenario?**\n\nThis was a suspected false positive packet. We had to know which rule it matched, in order to understand this false positive.\n\n**Where is this output found?**\n\nThe log is from a kernel debug file.\n\n`# fw ctl debug -m UP all`  \n`# fw ctl kdebug -T -f > /var/log/debug_kernel.txt`\n\n**Connection Rule matches:**\n\n\\---------------------------\n\n`;[cpu_1];[fw4_0];...] {rulebase} up_rulebase_execute_match: [SUMMARY ffffc200205e6228] MATCH dir 0, 192.168.109.58:64040 -> 172.16.4.45:22, IPP 6;`  \n`;[cpu_1];[fw4_0];...] {rulebase} up_rulebase_execute_match: [0] 'Network' (0): MATCH 1 Accept;`  \n`;[cpu_1];[fw4_0];...] {rulebase} up_rulebase_execute_match: [1] 'NET1' (1): MATCH 1 Accept;`\n\n## Application Control and URL Filtering Update Process Debugging\n\n### General Description\n\nApplication Control (APPI) and URL Filtering (URLF) Blades have a unified update logic. Updates are divided to Management Server updates and Security Gateway updates. Management package includes all the application information, such as application name, category, description, tags, risk etc. It is used for policy definition in the rule base. Gateway package contains the applications info for logging purposes, application signatures, used as an input to the Application Control engine (Application Control) for detection, and some large URL groups for use of the URL Filtering engine. For the blade to work optimally, it is highly recommended that the management and the Security Gateway will be up to date. Updates are distributed meaning that the Management Server and each Security Gateway (and even each cluster member) is responsible for its own database package update. Updates are performed periodically according to the update's configuration of the Application Control and URL FIltering tab in SmartConsole.\n\nCurrently, this section handles only Security Gateway updates.\n\n### Processes\n\nFWD is the process that runs the update mechanism on the Security Gateway. It uses a dynamic library named CIU that is responsible for the entire execution of the update process. Eventually, if a package is downloaded successfully, it will be passed to the kernel for final deployment.\n\n### Important Files\n\nApplication Control and URL Filtering update files are located in _$FWDIR/appi/update/_:\n\n1.  The main database files are _appi\\_db.C_ and _urlf\\_db.bin_. The files are zipped and encrypted.\n2.  _next\\_update_: a clear text file that contains the time of the next update try. There are two lines in the file, each line is a number interpreted as seconds since 1970. You can use the following site in order to convert this number to a human readable date and time: [http://www.onlineconversion.com/unix\\_time.htm](http://www.onlineconversion.com/unix_time.htm). The top line is the time of the next update, in case the last update try succeeded. It is set according to the last update try time and the update interval configuration. The second line is the update in case the last update try failed. It is set to an hour from the last update try. This number is expected to be larger than the first, when the system is working properly.\n3.  _appi\\_status.C_: This file is a clear set file that also contains the current status of update of the Application Control & URL Filtering Blades on the Security Gateway. These are the relevant lines in the file:\n    -   _app\\_update\\_status_: the status of the last update try, can be 'failed', 'up-to-date' or 'new'.\n    -   _app\\_update\\_description_: a detailed description of the last update result.\n    -   _app\\_next\\_update\\_description_: a description of when the next update should happen.\n    -   _app\\_db\\_version_: the version of the current database.\n4.  _Version_: This file is a set file that contains details about the current database. It looks as follows:\n    \n    _:pkg\\_file\\_name (\"appi\\_urlf\\_db\\_pkg.tar\")  \n    :md5sum (\"a14e72a1b93742f7fe8558ab3cd91662\")  \n    :pkg\\_version (290611\\_1)  \n    :pkg\\_timestamp (1309331058)  \n    :appi\\_filename (\"appi\\_db.C.tmp\")  \n    :urlf\\_filename (\"urlf\\_db.bin.tmp\")_\n    \n    The first line contains the file name as stored on the server. The second line contains the md5 sum of the file. The third line contains the date of the package and a running number used for supporting a release of more than one package a day. In this case, the package was released on 29 June 2011 and it is the first package released that day. The fourth line contains the release date and time of the package in seconds since 1970. Final 2 lines are the contents of the package.\n    \n    The version of the package is taken from the second line, and in this case it is 11062901.\n    \n    **Note:** The file is created only after the first successful update.\n    \n\n### Main Debug Flags\n\n### Troubleshooting\n\n<table><tbody><tr><td>Issue</td><td>Debugging</td><td>Probable Causes</td><td>Resolution</td></tr><tr><td><p>Force update</p></td><td><ol><li>Change the current directory to <em>$FWDIR/appi/update/</em>.</li><li>If a file named \"<em>Version</em>\" exists, then rename it: <em># mv Version Version.backup</em></li><li>Edit the <em>next_update</em> file: <em># vi next_update</em></li><li>Change the top line to have the value 100.</li><li>The size of <em>next_update</em> is now 15 bytes, wait until it will change again to 21 (can be seen using \"<em>watch ls -l</em>\" command). This should take no more than 3 minutes.</li></ol></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>Updates fail - \"<em>Could not resolve...Check DNS configuration on the gateway</em>\" or \"<em>Could not reach...Check proxy configuration on the gateway</em>\" messages appear in the update status in the Security Gateway's page of Application Control and URL Filtering blades (it is a tooltip) or in the system query of Application Control and URL Filtering in SmartView Tracker.</td><td><ol><li>If the message says \"Check DNS...\" it is most likely a DNS configuration problem, or an incorrect spelling of a proxy. Check that DNS is configured (using <em>sysconfig</em>), and the proxy is correct.</li><li>If the message says \"Check proxy...\" it is most likely a proxy configuration problem. If proxy is really required (according to topology) check that it is configured properly in the Security Gateway properties dialog (under Topology).</li><li>If DNS and proxy are configured, it is possible that there is no connectivity and the Security Gateway can not reach the DNS. Try to ping it.</li><li>If the DNS is configured properly, check the update status on the Security Gateway in <em>$FWDIR/appi/update/appi_status.C</em> as described above.</li><li>Force and debug an update:<br><ol><li>Start the debug of FWD daemon (per <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk86321\" target=\"_blank\" rel=\"noopener\">sk86321</a>) using this syntax: <em># fw debug fwd on TDERROR_ALL_CIU=5</em></li><li>Force an update as described above.</li><li>Search for an <em>ERROR</em> of a <em>ciu*</em> function in <em>$FWDIR/log/fwd.elg</em> log file</li><li>If you see errors related to FDT (File Download Tool), then restart the debug of FWD daemon using this syntax: <em># fw debug fwd on TDERROR_ALL_FDT=5</em></li></ol></li></ol></td><td>DNS or proxy are not properly configured.</td><td><ol><li>Configure DNS on the Security Gateway using <em>sysconfig</em>.</li><li>Configure proxy on the Security Gateway in SmartDashboard in Security Gateway's properties.</li><li>Verify that the Security Gateway has access to the DNS.</li></ol></td></tr><tr><td>Updates fail - \"<em>...Internal error occurred</em>\" message appears in the update status in the Security Gateway's page of the Application Control and URL Filtering blades (it is a tooltip) or in the system query of Application Control and URL Filtering in SmartView Tracker.</td><td>Follow Step 5 above (\"Force and debug an update\").</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>Updates fail - \"<em>...Failed to reload database</em>\" message appears in the update status in the Security Gateway's page of the Application Control and URL Filtering blades (it is a tooltip) or in the system query of Application Control and URL Filtering in SmartView Tracker.</td><td>Follow Step 5 above (\"Force and debug an update\") twice using the following syntax in debug of FWD daemon:<br>once with \"<em>fw debug fwd on TDERROR_ALL_policy=5</em>\" and once with \"<em>fw debug fwd on TDERROR_ALL_module=5</em>\".<br>Each time search for an ERROR in <em>$FWDIR/log/fwd.elg</em><br>If it is of no help, then the kernel part of Application Control &amp; URL Filtering signatures IOCTL should be tested. For that, refer to <span targetid=\"Debug Procedures - APCL and URLF Update Debug\">Application Control and URL Filtering Update Process Debugging</span>.</td><td>Corrupted database.</td><td>Update Signature Development Group people.</td></tr></tbody></table>\n\n### Tips\n\n-   Update failure might be temporary. Try to force an update before troubleshooting further.","language":"md","time":"14 days ago","created":"2025-05-06T22:55:57.624Z","annotations":[],"updated":"2025-05-06T22:57:02.924Z"},{"title":"Collapse All for Product Anti-Bot, Anti-Virus","id":"67f1929a-e290-4ec4-887a-e63b72d2a3ee","type":"TEXT","raw":"ProductAnti-Bot, Anti-Virus, Application Control, Data Loss Prevention, IPS, Quantum Appliances, Quantum Security Gateways, URL Filtering\n\nVersionR77.30 (EOS), R80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nPlatform12000 (EOL), 13000 (EOL), 15000, 16000, 23000, 26000, 28000, 4000 (EOL), 5000, 6000, 7000\n\nLast Modified2025-04-02\n\n## Solution\n\nCollapse All\n\n-   In which versions is the Bypass Card supported?  \n    \n    > This feature is supported for R7x and R80.x versions running on Gaia OS only, in Single Gateway configuration.\n    > \n    > -   For VSX R77 and above, the Bypass Card Hotfix is required. Contact Check Point Solution Center via local Check Point office to get a Bypass Card Hotfix.\n    \n-   What Bypass Card models are available?  \n    \n-   How do I order a bypass card?  \n    \n    > Refer to the Check Point Product Catalog:\n    > \n    > 1.  Go to [User Center](https://usercenter.checkpoint.com/usercenter/index.jsp) - Log in\n    > 2.  At the top, click on the '`QUOTING TOOLS`' menu - click on the '`Product Catalog & Quoting`'\n    > 3.  Go to '`NETWORK SECURITY`' section - click on the relevant appliance\n    > 4.  Wait for the information to be loaded\n    > 5.  Scroll down to the '`Accessories & Add Ons`' - near '`More Add ons & Accessories`', click on a down-pointing triangle\n    > 6.  Wait for some short time for the information to be loaded\n    > 7.  Refer to '`Bypass (Fail-Open)`' item(s) - get the 'SKU' of the relevant card\n    \n-   How do I install the card?  \n    \n-   What appliances support the Bypass Card?  \n    \n    > The Bypass feature is supported by the 4000, 5000, 12000, 13000, 15000, 23000, 6000, 7000, 16000, 26000 and 28000 appliance series.  \n    > It is also supported on SandBlast Appliances TE100x, TE250X, TE1000X, TE2000X and TE2000X HPP.\n    \n-   Can higher-end appliances models, such as 64000 / 44000, support the Bypass Card for IPS?  \n    \n    > This is currently not supported.  \n    > If Bypass Card is required on other appliances, please open a Request for Enhancement (RFE) with Check Point (contact the _local Check Point office_ to submit such RFE).\n    \n-   When Bypass is enabled, can High Availability be supported?  \n    \n    > The Bypass Card is not supported in Cluster environments (High Availability mode or Load Sharing modes).  \n    > This is an undesirable scenario and if required, it should be well investigated.\n    > \n    > When Bypass kicks in, communication between the cluster members is not guaranteed. The traffic might pass through the first device in fail-open mode with no inspection and will be transparent to the switches on both sides. Again, this is an undesirable scenario in cluster environments.\n    \n-   When Bypass is enabled, is performance degradation expected?  \n    \n    > The Bypass feature should not increase latency or any performance degradation.\n    \n-   Does Bypass card support Link Aggregation (Bond)?  \n    \n    > Link Aggregation (Bonding) of ports on a Bypass card / of Bypass cards is not supported.\n    \n-   Is Bypass card supported in VSX mode?  \n    \n    > Starting from R77, Bypass Card is also supported in VSX mode.  \n    > Contact Check Point Solution Center via local Check Point office to get a Bypass Card Hotfix.\n    \n-   How long does it take for the NIC to fail open?  \n    \n    > If bypass is initiated, the flipping is immediate as this is hardware bypass. Yet, the thresholds for each of the following states should be considered:  \n    > \n    > -   There is a power loss - Immediate\n    > -   The appliance is rebooting - Immediate\n    > -   Unable to allocate memory in kernel - Immediate\n    > -   High CPU and packet drops - Threshold is set to 5,000 drops and 85% CPU usage within 20 seconds.\n    > -   DLP process is crash - 20 crashes within 300 seconds\n    > -   FWD process is not responding - Threshold is set to 75 seconds\n    \n-   Can the Bypass cards be configured to stay in bypass state?  \n    \n    > This is currently not supported.\n    \n-   Are there any limitations when using this card?  \n    \n    > Refer to [sk85560](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk85560) (section: Known Limitations).\n    \n-   Is there any limitation/degradation expected when Bypass card is installed, but bypass feature is not enabled?  \n    \n    > No. If bypass mode is not enabled, there should be no difference between using Bypass (Fail-Open) card and normal NIC.\n    \n-   Is 10GbE ByPass supported?  \n    \n    > 10GbE ByPassis supported on all appliances\n    \n\n## Article Properties\n\nOriginatorPini Berkovitch\n\nTechnical ResourceDolev Levi\n\nAccess LevelGeneral\n\nStatusApproved\n\nDate Created2012-11-13\n\nLast Modified2025-04-02\n\nEditorLiron Rubin\n\nLast ApproverLiron Rubin\n\n## Comments\n\n#### Internal only\n\nFor VSX R77.XX, the Bypass Card Hotfix is required - per VSX RnD Team Manager (Maor Elharar) - must contact _Check Point Solution Center_.\n\n-   R77 GA = gulli\\_hf\\_fonic\\_003\n-   R77.10 = ???\n-   R77.20 = ???\n-   R77.30 = ???","language":"md","time":"14 days ago","created":"2025-05-06T22:56:00.110Z","annotations":[],"updated":"2025-05-06T22:57:16.578Z"},{"title":"ProductCluster - 3rd-party, ClusterXL, Quantum Security Gateways","id":"64d73632-e32c-41ea-871b-d664e4e1e3d6","type":"TEXT","raw":"ProductCluster - 3rd-party, ClusterXL, Quantum Security Gateways\n\nVersionR80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-02-19\n\n## Solution\n\n### Objective\n\nThis article explains the steps for troubleshooting NAT in Check Point Security Gateways.\n\n### Documentation and Assumed Knowledge\n\n[sk30557 - Configuring NAT](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk30557)\n\n### Impact on the Environment and Warnings\n\nKernel debug may cause high CPU usage.\n\n### How Check Point Enforces NAT\n\n#### NAT Types\n\n-   Hide NAT - 1 translation. N hosts share a single NAT IP (Implication: Incoming connections are impossible)\n-   Static NAT - 1:1 translation\n-   Other NAT Types:\n    -   IP Pool NAT - N:M translation\n    -   Port Mapping - Translate the service (destination port)\n    -   Cluster NAT - NAT cluster member IPs to cluster virtual IP\n    -   Proxy NAT (Fold/Unfold) - change packets of connection so they will reach a proxy (security server)\n\n#### Configuration\n\nThis article only covers Automatic and Manual NAT rules.\n\n-   Automatic NAT rules - defined on the NATed object in the NAT tab.\n-   Manual NAT rules - defined directly in the NAT rule base, like security rules.\n\n**Priority between NAT rules:**\n\nPre manual rules\n\n-   Automatic rules\n-   Post manual rules\n-   In addition, inside the automatic rules group - Static rules have higher priority than Hide\n\n#### Matching NAT Rules\n\n-   The firewall performs NAT on a packet when it matches the connection on a NAT rule, similar to the Security Rule base. Both Automatic and Manual NAT rules will create a rule.\n-   When the first packet in the connection enters the firewall, it is first matched against the Security Rule base and against the NAT Rule base. The firewall then records the connection and all future packets which will be matched on that connection will be NATed.\n-   Since the firewall will record the connection from all sides (e.g, if the connection is initiated from X->Y(z), X is the client, Y is the NATed IP address and z is the internal, real IP address, the connection will also include z(Y)->X) there is no need to explicitly configure a back connection.\n-   Back connection should only be configured if you want to allow the internal server to match the rule, when it is the one which initiates the connection. For example, when z will want to open a connection to X behind IP Y.\n-   By default, Automatic NAT rules will create a back connection as well to allow connections from the internal address.\n\n**NAT Configuration Examples:**\n\n**Automatic NAT:**\n\nRight click on the object you want to hide and simply select the NAT method and NAT IP address.\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk60343/sk603431907170622.png)\n\n**Manual NAT:**\n\nAdd the NAT rule to NAT Rule base in the following manner. Original Packet will indicate how the first packet in the connection will look like, when it enters the firewall\n\nTranslated Packet will indicate how the first packet in the connection will look like when it exits the firewall to the internal server.\n\nThe returning packet on the connection will also be matched on that rule in the same manner; this time the packet will enter as seen in translated and exit as seen in original (with reversed source and destination).\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk60343/Manual_NAT_11907170623.PNG)\n\nThe following rule should be added if you plan that traffic will be initiated from Hostx\\_Internal and will be Statically NATed behind the IP of Hostx\\_External. There is no need to add it, if you only want to allow connection to be initiated to this host and not from it.\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk60343/Manual_NAT_21907170623.PNG)\n\n#### NAT Troubleshooting Flow\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk60343/NAT_Troubleshooting_Flow1907170624.PNG)\n\n### Running Kernel Debug and Firewall Monitor\n\n**Warning:**\n\n-   Kernel debug may cause high CPU usage. Before running the debug, make sure the machine is not heavily loaded. You can verify this by using the commands:\n    -   _top/vmstat_ - on UNIX-based systems\n    -   Task Manager - on Windows-based systems\n-   Disable SecureXL before generating the debug.\n\nTo run the kernel debug and firewall monitor:\n\n1.  From command line run:\n    \n    _fw monitor -e \"accept;\" -o outputfile.cap_\n    \n    If possible, you can use the INSPECT syntax to filter the capture. e.g:\n    \n    _\\# fw monitor -e \"host(x.x.x.x),accept;\" -o outputfile.cap_\n    \n    in order to filter for inbound and outbound traffic related to host x.x.x.x.\n    \n\n  \n\n1.  Open another shell and run the following commands:\n    \n    _\\# fw ctl debug 0_\n    \n    _\\# fw ctl debug -buf 32000_\n    \n    _\\# fw ctl debug -m fw + conn packet nat xlate xltrc_\n    \n    _\\# fw ctl kdebug -T -f > /var/kernel\\_debug.log_\n    \n\n  \n\n1.  Replicate the issue.\n2.  Stop the firewall monitor capture with: _ctrl+ c_\n3.  Stop kernel debug by running: _\\# fw ctl debug -x_\n\n### Verifying\n\n-   Make sure that the problem was replicated while the debug was running. \n-   [Contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/) and upload the files for further investigation.\n\n## Article Properties\n\nOriginatorAvi Maslati\n\nTechnical ResourceYosi Havilo\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2010-12-30\n\nLast Modified2025-02-19\n\nEditorDavid Kornfield\n\nLast ApproverOmer Ifergan\n\n## Comments\n\n#### Internal only","language":"md","time":"14 days ago","created":"2025-05-06T22:55:57.867Z","annotations":[],"updated":"2025-05-06T22:57:02.257Z"},{"title":"Check Point Upgrade Service Engine","id":"2967035c-8f44-4825-813a-9ceb71f30850","type":"TEXT","raw":"---\ncreated: 2025-04-29T20:01:34 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk92449\nauthor: \n---\n\n# sk92449 - Check Point Upgrade Service Engine (CPUSE) - Gaia Deployment Agent\n\n> ## Excerpt\n> Applies to: Multi-Domain Security Management, Quantum Security Gateways, Quantum Security Management\n\n---\n|     Date     |                                                                                                                                   Description                                                                                                                                   |\n|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| 16 Feb 2025  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new recommended Build 2550                                                                                                |\n| 22 Dec 2024  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new recommended Build 2512                                                                                                |\n| 29 Oct 2024  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new recommended Build 2492                                                                                                |\n| 27 Oct 2024  |                                                                                                               Updated \"Important Notes\" in section \"(2) Download\"                                                                                                               |\n| 13 Oct 2024  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new recommended Build 2474                                                                                                |\n| 07 Aug 2024  | Moved all instructions for working with CPUSE packages to the CPUSE Administration Guide  \nRemoved instructions for outdated CPUSE Deployment Agent builds  \nImproved formatting of the article |\n| 22 July 2024 |                                                                                                \"Latest build of CPUSE and What's New\" section - added new recommended Build 2443                                                                                                |\n| 14 July 2024 |                                                                                                \"Latest build of CPUSE and What's New\" section - added new recommended Build 2432                                                                                                |\n| 05 Jun 2024  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new recommended Build 2429                                                                                                |\n| 31 Mar 2024  |                                                                                    Section \"(4-C) How to work with CPUSE - How to uninstall a CPUSE package\" - improved steps in Gaia Portal                                                                                    |\n| 06 Feb 2024  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new recommended Build 2379                                                                                                |\n| 09 Oct 2023  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new recommended Build 2337                                                                                                |\n| 30 Jul 2023  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new recommended Build 2325                                                                                                |\n| 30 Apr 2023  |                                                                                                                               Improved formatting                                                                                                                               |\n| 26 Apr 2023  |                                                                                                                               Improved formatting                                                                                                                               |\n| 16 Apr 2023  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2297                                                                                                |\n| 23 Jan 2023  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2282                                                                                                |\n| 18 Dec 2022  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2267                                                                                                |\n| 02 Oct 2022  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2243                                                                                                |\n| 29 Aug 2022  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2229                                                                                                |\n| 27 July 2022 |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2208                                                                                                |\n| 10 July 2022 |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2205                                                                                                |\n| 24 May 2022  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2193                                                                                                |\n| 04 May 2022  | -   Improved formatting\n-   \"(4-D) \"How to ...\" section - restored the sub-section \"How to download SmartConsole package from Gaia Portal\" |\n| 21 Mar 2022  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2176                                                                                                |\n| 30 Jan 2022  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2154                                                                                                |\n| 14 Dec 2021  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2140                                                                                                |\n| 14 Nov 2021  |                                                                                                    \"(6) Limitations, Troubleshooting and Related solutions\" - added point #4                                                                                                    |\n| 07 Oct 2021  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2113                                                                                                |\n| 02 Sep 2021  |                                                                                            Updating screenshots and removed documentation for unsupported versions (77.10 and below)                                                                                            |\n| 24 Aug 2021  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2101                                                                                                |\n| 08 Jul 2021  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2084                                                                                                |\n| 18 Apr 2021  |                                                                                         \"(6) Limitations, Troubleshooting and Related solutions\" - added a Troubleshooting scenario #3                                                                                          |\n| 11 Apr 2021  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2047                                                                                                |\n| 07 Feb 2021  |                                                                                                \"Latest build of CPUSE and What's New\" section - added new Recommended Build 2019                                                                                                |\n| 14 Dec 2020  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1999                                                                                                     |\n| 25 Nov 2020  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1986                                                                                                     |\n| 28 Oct 2020  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1976                                                                                                     |\n| 23 Sep 2020  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1959                                                                                                     |\n| 10 Sep 2020  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1935                                                                                                     |\n| 20 Aug 2020  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1931                                                                                                     |\n| 19 Jul 2020  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1928                                                                                                     |\n| 30 Jun 2020  |                                                                                                                           Updated (6) Troubleshooting                                                                                                                           |\n| 18 Jun 2020  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1905                                                                                                     |\n| 16 Apr 2020  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1889                                                                                                     |\n| 16 Feb 2020  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1865                                                                                                     |\n| 09 Feb 2020  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1858                                                                                                     |\n| 16 Jan 2020  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1848                                                                                                     |\n| 10 Dec 2019  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1832                                                                                                     |\n| 27 Nov 2019  |                                                                                                    Added section (4-B-d) Perform a clean install or upgrade of a Blink image                                                                                                    |\n| 20 Nov 2019  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1818                                                                                                     |\n| 03 Oct 2019  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1786                                                                                                     |\n| 19 Aug 2019  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1751                                                                                                     |\n| 11 Aug 2019  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1731                                                                                                     |\n| 16 July 2019 |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1728                                                                                                     |\n| 01 July 2019 |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1722                                                                                                     |\n| 05 June 2019 |                                                                                                         Added a note that CPUSE package is not compatible with R80.20SP                                                                                                         |\n| 14 May 2019  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1677                                                                                                     |\n| 01 May 2019  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1676                                                                                                     |\n| 31 Mar 2019  |                                                                                                             Updated setion 4C - \"How to uninstall a CPUSE package\"                                                                                                              |\n| 26 Mar 2019  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1671                                                                                                     |\n| 17 Mar 2019  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1669                                                                                                     |\n| 23 Jan 2019  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1580                                                                                                     |\n| 28 Nov 2018  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1577                                                                                                     |\n| 29 Sep 2018  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1573                                                                                                     |\n| 26 Sep 2018  |                                                                                                                 Added link to R80.20 Gaia Administration Guide                                                                                                                  |\n| 15 July 2018 |                                                                                                                          Added R80.20 to Versions list                                                                                                                          |\n| 25 June 2018 |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1511                                                                                                     |\n| 24 June 2018 |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1510                                                                                                     |\n| 14 June 2018 |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1508                                                                                                     |\n| 06 May 2018  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1483                                                                                                     |\n| 08 Apr 2018  |                                                                                                        Updated Section (2) System requirements and limitations, item G.                                                                                                         |\n| 12 Feb 2018  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1439                                                                                                     |\n| 02 Jan 2018  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1418                                                                                                     |\n| 26 Nov 2017  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1405                                                                                                     |\n| 10 Oct 2017  |                                                                                  Corrected the import instructions in Gaia Portal - correct the name of the button from \"Upload\" to \"Import\".                                                                                   |\n| 08 Oct 2017  |                                                                          Renamed the \"Latest build of CPUSE and What's New\" section to the \"Download the latest build of CPUSE Agent and What's New\".                                                                           |\n| 24 Sep 2017  |                                              \"Latest build of CPUSE and What's New\" section - \"(3-D) History of older CPUSE Agent builds\" subsection - updated the text to show that build 1130 is integrated into R80 GA version.                                              |\n| 27 Aug 2017  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1298.                                                                                                    |\n| 23 Aug 2017  |                                                                                                        \"Troubleshooting and Related solutions\" section - added sk104479.                                                                                                        |\n| 17 Aug 2017  |                                                                                                        \"Troubleshooting and Related solutions\" section - added sk119993.                                                                                                        |\n| 16 Aug 2017  |                                                                                                        \"Troubleshooting and Related solutions\" section - added sk119954.                                                                                                        |\n| 24 July 2017 |                                                                 \"Latest build of CPUSE and What's New\" section - added a note that restarting the ConfD daemon should be performed during a maintenance window.                                                                 |\n| 06 July 2017 |                                                                          \"System requirements and limitations\" section - updated a note that on VSX R80.10, any package can be installed using CPUSE.                                                                           |\n| 27 June 2017 |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1294.                                                                                                    |\n| 21 June 2017 | -   Updated the instructions for importing a package in Gaia Portal (by clicking on the _Import Package_ button on the main page).\n-   Added link to R80.10 Gaia Administration Guide. |\n| 16 June 2017 |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA _Build 1293_.                                                                                                    |\n| 18 May 2017  |                                                                                                                      Added R80.10 version to the article.                                                                                                                       |\n| 25 Apr 2017  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA _Build 1283_.                                                                                                    |\n| 04 Apr 2017  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA _Build 1278_.                                                                                                    |\n| 28 Mar 2017  | -   Updated the title of this article from \"_CPUSE - Gaia Software Updates (including Gaia Software Updates Agent)_\" to \"_Check Point Upgrade Service Engine (CPUSE) - Gaia Deployment Agent_\".\n-   \"Latest build of CPUSE and What's New\" section - added the Build 1272 back. |\n| 20 Mar 2017  |                                                                                \"Latest build of CPUSE and What's New\" section - temporarily reverted from Build 1272 to the previous Build 1130.                                                                                |\n| 15 Mar 2017  |                                                                                                            Added the applicable screenshots for \"Verifier\" results.                                                                                                             |\n| 13 Mar 2017  |                                                                                                    \"Latest build of CPUSE and What's New\" section - added new GA Build 1272.                                                                                                    |\n| 11 Feb 2017  |                                                                                                        \"Troubleshooting and Related solutions\" section - added sk114592.                                                                                                        |\n| 05 Feb 2017  |                                                                                                        \"Troubleshooting and Related solutions\" section - added sk115719.                                                                                                        |\n| 15 Jan 2017  |                                                                                                        \"Troubleshooting and Related solutions\" section - added sk115515.                                                                                                        |\n| 31 Dec 2016  | -   \"(4-A) \"How to ...\" section - improved import instructions for Offline procedure in Gaia Portal.\n-   \"Troubleshooting and Related solutions\" section - added sk111158, sk115243. |\n| 19 Nov 2016  | -   \"(4-A) \"How to ...\" section - improved notes about VSX mode.\n-   \"(4-B) \"How to ...\" section - improved notes about VSX mode.\n-   \"(4-B) \"How to ...\" section - \"(4-B-b)\" subsection - added a list of files that are copied by CPUSE during an upgrade to a Major Version. |\n| 14 Nov 2016  |                                                                                                                  \"(4-D) \"How to ...\" section - improved notes.                                                                                                                  |\n| 03 Nov 2016  |                                                                                  \"System requirements and limitations\" section - added clarifications about the required license and contract.                                                                                  |\n| 02 Oct 2016  |                                                                                                     \"Latest build of CPUSE and What's New\" section - added new _Build 1130_.                                                                                                      |\n| 21 Sep 2016  |                                                                                              \"Troubleshooting and Related solutions\" section - added sk113268, sk113269, sk113270.                                                                                              |\n| 21 Aug 2016  |                                                                                                     \"Latest build of CPUSE and What's New\" section - added new _Build 1127_.                                                                                                      |\n| 23 June 2016 |                                                                                           \"(4-D) \"How to ...\" section - improved the description of \"`installer agent start`\" command.                                                                                            |\n| 21 June 2016 |                                                                    \"(4-D) \"How to ...\" section - improved the description of \"`installer agent <disable|enable>`\" and \"`installer agent <stop|start>`\" commands.                                                                    |\n| 16 June 2016 |                                                                                                     \"Latest build of CPUSE and What's New\" section - added new _Build 100_5.                                                                                                      |\n| 14 Apr 2016  |                                                                                                      \"Latest build of CPUSE and What's New\" section - added new _Build 994_.                                                                                                      |\n| 10 Apr 2016  | -   \"Troubleshooting and Related solutions\" section - added sk105746.\n-   \"System requirements and limitations\" section - added the applicable Domain objects. |\n| 09 Apr 2016  |                                                                                   \"Latest build of CPUSE and What's New\" section - added a note about manual installation of CPUSE Agent RPM.                                                                                   |\n| 31 Mar 2016  |                                                                                                                           Improved text readability.                                                                                                                            |\n| 30 Mar 2016  |                                                                                                        \"Troubleshooting and Related solutions\" section - added sk109359.                                                                                                        |\n| 27 Mar 2016  |                                                                                                                       Article was redesigned and updated.                                                                                                                       |\n| 03 Jan 2015  |                                                                                                                            Minor text improvements.                                                                                                                             |\n| 03 Jan 2015  |                                                                                                    \"System requirements and limitations\" section - updated the information.                                                                                                     |\n| 20 Nov 2015  |                                                                                                                    Add explanation for \"DAClient\" commands.                                                                                                                     |\n| 20 Sep 2015  |                                                                                                    \"System requirements and limitations\" section - updated the information.                                                                                                     |\n| 29 July 2015 |                                                                                          Corrected Gaia Clish syntax for starting and stopping the Gaia Software Updates Agent daemon.                                                                                          |\n| 26 July 2015 |                                                                                                                Added Gaia Clish syntax for Build 802 and higher.                                                                                                                |\n| 22 July 2015 |                                                                                                                 Added sk106696 to \"Related solutions\" section.                                                                                                                  |\n| 11 Mar 2015  |                                                                              \"System requirements and limitations\" section - added instructions for allowing CPUSE to work with Check Point cloud.                                                                              |\n| 29 Jan 2015  |                                       \"System requirements and limitations\" section - updated the information that option \"_Automatically download Contracts and other important data (Recommended)_\" should be enabled in SmartDashboard.                                        |\n| 05 Oct 2014  |                                                                                                   Added description for Gaia Software Updates Agent version from 710 to 747.                                                                                                    |\n| 11 Sep 2014  |                                                                     \"Overview\" - \"Description\" section - added a note that CPuse mechanism supports deployment of Major Versions (starting from build 502).                                                                     |\n| 19 Aug 2014  | -   \"Software Updates Notifications\" section - updated the information.\n-   Updated the notes for \"_set installer_\" commands. |\n| 24 July 2014 |                                                                         Added a note about the \"_ping_\" syntax in _$DADIR/bin/connection\\_test.sh_ script if Gaia server is disconnected from the Internet.                                                                         |\n| 15 June 2014 |                                                                                                              \"Related solutions\" section - added this new section.                                                                                                              |\n| 12 May 2014  |                                                                                                      Updated the information about the \"Import\" operation in Gaia Portal.                                                                                                       |\n| 17 Mar 2014  |                                                                                                                          Improvements in HTML design.                                                                                                                           |\n| 26 Jan 2014  | -   Added notes about importing an image / package.\n-   Modified manual installation instructions. |\n| 12 Dec 2013  |                                                                                                   Added description for Gaia Software Updates Agent versions from 502 to 615.                                                                                                   |\n| 03 Mar 2013  |                                                                                                                         First release of this document.                                                                                                                         |\n","language":"md","time":"14 days ago","created":"2025-05-06T22:56:00.402Z","annotations":[],"updated":"2025-05-06T22:57:03.399Z"},{"title":"ProductClusterXL, CoreXL","id":"149a7d65-8acd-46b2-bf8d-d91ea518a23c","type":"TEXT","raw":"ProductClusterXL, CoreXL\n\nVersionR77.20 (EOS), R80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nOSGaia\n\nPlatformAll\n\nLast Modified2023-04-26\n\n## Symptoms\n\n-   Output of \"`cphaprob state`\" command on a cluster member shows the state \"`Ready`\".\n\n## Cause\n\nThere are several possible reasons :\n\n1.  There are cluster members with a lower software version on this subnet / VLAN  \n    \\[member with higher software version changes its state to 'Ready'\\].\n    \n2.  The number of CoreXL FireWall instances on cluster members is different  \n    \\[member with greater number of CoreXL Firewall instances changes its state to 'Ready'\\].\n    \n    **Note:** This applies only to R80.10 and lower versions. Starting from R80.20, a cluster member with a higher number of CoreXL Firewall instances changes its state to 'Down'.\n    \n3.  The ID numbers of CoreXL FireWall instances and handling CPU core numbers on cluster members are different.\n    \n4.  On Gaia OS - Linux kernels on cluster members are different (32-bit vs 64-bit)  \n    \\[member with higher kernel edition changes its state to 'Ready'\\].\n    \n5.  On Gaia OS - Cluster member runs in VSX mode, while other members run in Gateway mode  \n    \\[member in VSX mode changes its state to 'Ready'\\].\n    \n\n## Solution\n\nThis article consists of these parts:\n\n-   **Background** - short description about Cluster Control Protocol\n    \n-   **Troubleshooting** - how to diagnose and troubleshoot\n    \n-   **CCP versions** - summary tables with CCP versions\n    \n\n## **(1) Background**\n\n1.  Cluster Control Protocol (CCP ; protocol UDP, port 8116) performs two tasks in Check Point ClusterXL:\n    \n    1.  Health Checks (state of interfaces, state of software components, fail-over notifications, etc)\n        \n    2.  State Synchronization (Delta Sync of information about the current connections)\n        \n    \n    **Note:** In 3rd party / OPSec clusters, the CCP performs only State Synchronization (Health Checks are performed by 3rd party clustering software).\n2.  The header of each CCP packet contains the following fields that are relevant in this case:\n    \n    1.  Protocol Version (an integer that is increased in each version by the programmers)\n        \n    2.  Total number of loaded CoreXL Firewall instances (total number of loaded CoreXL Firewall instances on the cluster member that generated this CCP packet).\n        \n    3.  CoreXL instance ID (The ID of the CoreXL Firewall instance, to which this CCP packet belongs (sent from/to))\n    \n    **Note:** The CoreXL fields appeared in R70, in which CoreXL became an integrated product.\n    \n3.  If a cluster member receives CCP packets with CCP Version lower than its own, it changes its state to '**Ready**' by design.\n    \n\n## **(2) Troubleshooting**\n\nLet us address each of the possible reasons for the cluster state \"_Ready_\":\n\n1.  **There are cluster members with a lower software version on this subnet / VLAN**\n    \n    Check the versions of all involved software components on all involved cluster members (member that detects other cluster members with lower software version will change its state to \"_Ready_\").  \n    All outputs on all cluster members of a given cluster must be identical:\n    \n    <table><tbody><tr><td>#</td><td>What to check</td><td>Applies to OS</td><td>How to check</td></tr><tr><td>1</td><td>FireWall module version</td><td>All</td><td><strong><code>fw ver -k</code></strong></td></tr><tr><td>2</td><td>VPN module version</td><td>All</td><td><strong><code>vpn ver -k</code></strong></td></tr><tr><td>3</td><td>SVN module version</td><td>All</td><td><strong><code>cpshared_ver</code></strong></td></tr><tr><td rowspan=\"2\">4</td><td rowspan=\"2\">OS version</td><td>Gaia OS</td><td><strong><code>show version all</code></strong></td></tr><tr><td>SecurePlatform OS</td><td><strong><code>ver -k</code></strong></td></tr><tr><td>5</td><td>32-bit / 64-bit OS</td><td>Gaia OS</td><td><strong><code>uname -a</code></strong></td></tr><tr><td>6</td><td>CCP version</td><td>All</td><td><strong><code>fw ctl get int fwha_version</code></strong></td></tr><tr><td rowspan=\"4\">7</td><td rowspan=\"4\">Value of the relevant global<br>kernel parameter that changes the 5th byte<br>of Source MAC address in CCP packets<br>(for details, refer to <a href=\"http://supportcontent.checkpoint.com/solutions?id=sk25977\" target=\"_blank\" rel=\"noopener\">sk25977</a>)</td><td>Gaia OS<br>R77.30 and above<br>Gateway mode</td><td><ol><li><strong><code>cphaconf cluster_id get</code></strong></li><li><strong><code>cat $FW_BOOT_DIR/ha_boot.conf</code></strong></li></ol></td></tr><tr><td>Gaia OS<br>R77.30 and above<br>VSX mode</td><td><ol><li><strong><code>fw ctl get int fwha_add_vsid_to_ccp_mac</code></strong></li><li><strong><code>cat $FWDIR/boot/modules/fwkern.conf</code></strong></li></ol></td></tr><tr><td>Gaia OS<br>R75.40-R77.20 /<br>SecurePlatform OS /<br>IPSO OS</td><td><ol><li><strong><code>fw ctl get int fwha_mac_magic</code></strong></li><li><strong><code>fw ctl get int fwha_mac_forward_magic</code></strong></li><li><strong><code>cat $FWDIR/boot/modules/fwkern.conf</code></strong></li></ol></td></tr><tr><td>Windows OS</td><td><ol><li><strong><code>fw ctl get int fwha_mac_magic</code></strong></li><li><strong><code>fw ctl get int fwha_mac_forward_magic</code></strong></li><li>In Windows Registry:<br><ol type=\"A\"><li>Go to <strong><code>Start</code></strong> menu - <strong><code>Run...</code></strong> - type <strong><code>regedit</code></strong> - press Enter / click OK</li><li>Go to the key <strong><code>HKLM -&gt; System -&gt; CurrentControlSet -&gt; Services -&gt; FW1 -&gt; Parameters -&gt; Globals</code></strong></li><li>Check the value of kernel parameter <strong><code>fwha_mac_magic</code></strong> (value is in hexadecimal format)</li><li>Check the value of kernel parameter <strong><code>fwha_mac_forward_magic</code></strong> (value is in hexadecimal format)</li></ol></li></ol></td></tr></tbody></table>\n    \n    Next steps:\n    \n    -   If outputs **differ** on members of this cluster, it means that some cluster members were already upgraded, and some cluster members are still running with previous software version.  \n        In this case, complete the upgrade of other cluster members.  \n        Also refer to the last possible reason - _VSX mode_.\n        \n    -   If all outputs are **identical** on all members of this cluster, it means that there is another cluster with a lower software version on this subnet / VLAN.\n        \n        To confirm this scenario, and to see which CCP versions are involved, run the following simple cluster debug:\n        \n        1.  _\\[Expert@HostName\\]# fw ctl debug 0_\n        2.  _\\[Expert@HostName\\]# fw ctl debug -buf 32000_\n        3.  _\\[Expert@HostName\\]# fw ctl debug -m cluster + ccp_\n        4.  _\\[Expert@HostName\\]# fw ctl kdebug -T -f > /var/log/ccp\\_debug.txt_\n        5.  Let the debug run for up to 1 minute.\n        6.  Press CTRL+C\n        7.  _\\[Expert@HostName\\]# fw ctl debug 0_\n        8.  Analyze the `/var/log/ccp_debug.txt file`\n        \n        Isolate the involved cluster from other clusters by setting the relevant value of the relevant global kernel parameter that changes the 5th byte of source MAC address in CCP packets (for details, refer to [sk25977 - Connecting multiple clusters to the same network segment (same VLAN, same switch)](http://supportcontent.checkpoint.com/solutions?id=sk25977)).\n        \n        <table><tbody><tr><td>OS and OS version</td><td>Mode</td><td>Instructions</td></tr><tr><td>Gaia OS R77.30 and above</td><td>Gateway mode</td><td><strong><code>cphaconf cluster_id set &lt;CLUSTER_ID_VALUE&gt;</code></strong></td></tr><tr><td>Gaia OS R77.30 and above</td><td>VSX mode</td><td>Add this line into the <code>$FWDIR/boot/modules/fwkern.conf</code> file and reboot:<br><strong><code>fwha_add_vsid_to_ccp_mac=1</code></strong></td></tr><tr><td>Gaia OS R75.40-R77.20 /<br>SecurePlatform OS /<br>IPSO OS</td><td>Gateway mode,<br>VSX mode</td><td><ol><li><strong><code>fw ctl set int fwha_mac_magic &lt;VALUE_1&gt;</code></strong></li><li><strong><code>fw ctl set int fwha_mac_forward_magic &lt;VALUE_2&gt;</code></strong></li></ol></td></tr></tbody></table>\n        \n        Note: To set the desired values of these parameters permanently on each cluster member, refer to [sk26202 - Changing the kernel global parameters for Check Point Security Gateway](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk26202).\n        \n2.  **The number of CoreXL FireWall instances on cluster members is different**\n    \n    Run these commands and count the total number of CoreXL Firewall instances in the first column (\"_ID_\") (member with greater number of CoreXL Firewall instances will go into \"_Ready_\" state):\n    \n    1.  **`[Expert@HostName]# fw ctl multik stat`**\n    2.  **`[Expert@HostName]# fw6 ctl multik stat`**\n    3.  **`[Expert@HostName]# cat /etc/fw.boot/boot.conf`**\n    \n    If the total number of CoreXL FW instances differs on members of this cluster, then:\n    \n    1.  Check the total number of CPU cores on each cluster member with this command:\n        \n        **`[Expert@HostName]# cat /proc/cpuinfo | grep processor`**\n        \n        If the total number of CPU cores differs between cluster members, then either use identical hardware, or configure the total number of CoreXL Firewall instances on all cluster members based on the cluster member with the lowest number of CPU cores:\n        \n        1.  Go to the _cpconfig_ menu:  \n            **`[Expert@HostName]# cpconfig`**\n        2.  Choose \"_Configure Check Point CoreXL_\"\n        3.  Choose \"_Change the number of firewall instances_\"\n        4.  Set the number of CoreXL FW instances\n        5.  Exit from the _cpconfig_ menu\n        6.  Reboot the cluster member\n        \n        Refer to [sk98737 - ATRG: CoreXL](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98737#Architecture) - section \"_(4) Architecture_\" - the following sub-sections:\n        \n        -   _Default number of CoreXL IPv4 FW instances_\n        -   _Maximal number of CoreXL IPv4 FW instances_\n        -   _IPv6 CoreXL FW instances limitations_\n    2.  Check the CoreXL license on each cluster member:\n        \n        **`[Expert@HostName]# cplic print`**\n        \n        The CoreXL license limits the number of running CoreXL Firewall instances. If the CoreXL licenses differ, then make sure to install identical licenses on all cluster members (to allow the same number of running CoreXL Firewall instances).\n3.  **The ID numbers of CoreXL FireWall instances and handling CPU core numbers on cluster members are different**\n    \n    Run these commands:\n    \n    1.  **`[Expert@HostName]# fw ctl multik stat`**\n    2.  **`[Expert@HostName]# fw6 ctl multik stat`**\n    \n    These outputs must be identical on all cluster members:\n    \n    -   The ID numbers of CoreXL FireWall instances on each cluster member in the first column (\"_ID_\")\n    -   The CPU core numbers on each cluster member in the third column (\"_CPU_\")\n    \n    By default, CoreXL Firewall instances are assigned sequentially - lower CoreXL Firewall instances are assigned to higher CPU cores.\n    \n    Example from a Security Gateway with 8 CPU cores:\n    \n    _CoreXL FW instance 0_ to _CPU 7_  \n    _CoreXL FW instance 1_ to _CPU 6_  \n    _CoreXL FW instance 2_ to _CPU 5_  \n    etc.\n    \n    If the assignment of CoreXL Firewall instances _is not sequential_ on a cluster member, then perform the following on that cluster member:\n    \n    1.  Disable CoreXL completely:\n        \n        **`[Expert@HostName]# cpconfig`** - choose \"_Configure Check Point CoreXL_\" - choose \"_(2) Disable Check Point CoreXL_\"\n    2.  Reboot the cluster member:\n        \n        **`[Expert@HostName]# reboot`**\n    3.  Enable CoreXL:\n        \n        **`[Expert@HostName]# cpconfig`** - choose \"_Configure Check Point CoreXL_\" - agree to enable - set the correct number of CoreXL Firewall instances\n    4.  Reboot the cluster member:\n        \n        **`[Expert@HostName]# reboot`**\n    5.  Check the assignment of CoreXL Firewall instances:\n        \n        **`[Expert@HostName]# fw ctl multik stat`**\n4.  **On Gaia OS - Linux kernels on cluster members are different (32-bit vs 64-bit)**\n    \n    Check the kernel edition in either of the shells:\n    \n    -   In Gaia Clish:\n        \n        **`HostName:0> show version os edition`**\n    -   In Expert mode:\n        \n        **`HostName:0> expert`**  \n        **`[Expert@HostName:0]# uname -r`**\n    \n    If the operating system editions differ (member with 64-bit edition will go into \"_Ready_\" state), then set identical operating system edition on all cluster members, and reboot:\n    \n    **`HostName:0> set edition default ...`**  \n    **`HostName:0> save config`**  \n    **`HostName:0> reboot`**\n5.  **On Gaia OS - Cluster member runs in VSX mode, while other cluster members run in Gateway mode**\n    \n    Note: Such a situation might occur when one of the cluster members was not operational when VSX mode was enabled / disabled. Later, when restoring the problematic cluster member with \"_vsx\\_util reconfigure_\" command, the restored cluster member will have an inconsistent configuration.\n    \n    Check whether the VSX mode is enabled in Gaia Clish:\n    \n    **`HostName:0> show vsx`**\n    \n    Next steps:\n    \n    -   Verify the configuration in SmartDashboard.\n    -   Verify that SIC is established, and SIC communication works with all cluster members.\n    -   Install the policy onto cluster members - maker sure it is installed on all cluster members.\n\n## **(3) CCP versions**\n\nNotes:\n\n-   The CCP version can be obtained by checking the value of the kernel parameter \"_fwha\\_version_\":\n    \n    **`[Expert@HostName]# fw ctl get int fwha_version`**\n-   The CCP version on 32-bit system in Gateway mode equals the value of kernel parameter \"_fwha\\_version_\":\n    \n    **`CCP <sub>32-bit GW</sub> = fwha_version`**\n-   The CCP version on 64-bit system in Gateway mode is greater by 1 than the CCP version on 32-bit system in Gateway mode:\n    \n    **`CCP <sub>64-bit GW</sub> = CCP <sub>32-bit GW</sub> + 1 = fwha_version + 1`**\n-   The CCP version on system in VSX mode 32-bit is greater by 2 than the CCP version on 32-bit system in Gateway mode:\n    \n    **`CCP <sub>VSX</sub> = CCP <sub>32-bit GW</sub> + 2 = fwha_version + 2`**\n-   The CCP version on system in VSX mode 64-bit is greater by 3 than the CCP version on 32-bit system in Gateway mode:\n    \n    **`CCP <sub>VSX</sub> = CCP <sub>32-bit GW</sub> + 3 = fwha_version + 3`**\n\n## Article Properties\n\nOriginatorSergei Shir\n\nTechnical ResourceRan Vaknin\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2009-06-17\n\nLast Modified2023-04-26\n\nEditorGil Frantsus\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only\n\n**Important note: Prior to using the tools mentioned in this article, make sure you thoroughly go over [sk156153 - Best Practice Guide for Debugging Check Point Products](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk156153).**\n\n**This SK should never be deleted - it is referenced in ClusterXL Admin Guide and in [sk93306 (ATRG ClusterXL)](http://supportcontent.checkpoint.com/solutions?id=sk93306).**\n\n___\n\n`From: Ron Smilovici   Sent: Monday, March 11, 2019 4:15 PM   To: Dmitry Krupnik   Cc: Gil Frantsus; Ran Vaknin   Subject: RE: sk42096 | Cluster member is stuck in 'Ready' state`\n\n`1,4,5 reasons are still actual for R80.20.   I have no idea regarding number 3.   \"2\" isn't relevant for \"Ready\" state. (It's good that you delete it in the image)`\n\n___\n\nSee a related thread in CXLS\\_SUPPORT@MICHAEL.CHECKPOINT.COM mailing list on 03 June 2009  \nSubject \"Hardware requirements for ClusterXL R70\"\n\n___\n\nIn the source code, search for \"CPNAMESDEF\\_FWHAP\\_CURRENT\\_V\".\n\n_Examples_:\n\n-   https://opengrok.checkpoint.com:8443/source/xref/hugo1/cpnamesDef/cpnamesDef.h  \n    https://opengrok.checkpoint.com:8443/source/xref/hugo1/fw1/fw/fwha/fwhaengine.c\n-   https://opengrok.checkpoint.com:8443/source/xref/geyser/cpnamesDef/cpnamesDef.h  \n    https://opengrok.checkpoint.com:8443/source/xref/geyser/fw1/fw/fwha/fwhaengine.c\n-   https://opengrok.checkpoint.com:8443/source/xref/gaia\\_grover/cpnamesDef/cpnamesDef.h\n\n___\n\nNote regarding Cause Reason #2:\n\nStarting from R80.20, a cluster member with a higher number of CoreXL Firewall instances will go into state 'Down'.","language":"md","time":"14 days ago","created":"2025-05-06T22:55:58.055Z","annotations":[],"updated":"2025-05-06T22:57:16.814Z"},{"title":"Introduction for URL Filtering Categorization Flow and Features","id":"5c467a0f-e26e-40c2-9230-b29978ba5784","type":"TEXT","raw":"**Table of Contents**\n\n-   Introduction\n    \n-   URL Filtering Categorization Flow\n    \n-   Features\n    \n    -   HTTPS Filtering\n        \n    -   Safe Search\n        \n    -   Cached and Translated pages categorization\n        \n-   URL Filtering Agent\n    \n-   QUIC Protocol\n    \n-   Related documentation\n    \n-   Related solutions\n    \n\n## Introduction\n\nCheck Point's latest firewall innovation brings the industry's strongest URL Filtering, application and identity control to organizations of all sizes. You can easily create policies which detect or block thousands of applications and internet sites.\n\nCheck Point's URL Filtering service holds the categorization of over 400 million hosts and URLs which supports over 40 billion URLs when you consider the number of URLs that it covers. One domain or IP entry in the database can categorize hundreds or thousands of URLs.\n\nUse the Application Control and URL Filtering blades to:\n\n-   **Learn about the applications**\n    \n    Use [Check Point's comprehensive AppWiki](https://appwiki.checkpoint.com/) to understand what applications are used for and what their risk levels are.\n    \n-   **Create a Granular Policy**\n    \n    Make rules to allow or block applications or Internet sites, by individual application, application or URL categories, or risk levels. When you use Identity Awareness, you can easily make rules for individuals or different groups of users. You can also create an HTTPS policy that enables the gateway to inspect HTTPS traffic to prevent security risks related to the SSL protocol.\n    \n-   **Learn What Your Employees are Doing**\n    \n    Use SmartView Tracker and SmartEvent to understand the application and site traffic that really occurs in your environment. Then change the policy to make it even more effective. Only administrators that have been assigned with relevant permissions can see all the fields in a log. Using these permissions makes sure that restricted data is kept private in logs and cannot be seen by all administrators.\n    \n-   **Keep Your Policies Updated**\n    \n    Application and URL Filtering Database is updated regularly with applications and site categories to help you keep your policy current. The gateway connects to the Check Point Online Web Service to identify social networking widgets and website categories for URLs that it does not recognize. Results are stored on a local cache on each Security Gateway. Subsequent uncategorized URLs are first checked against the local cache before querying the Check Point Online Web Service.\n    \n-   **Custom Applications, Sites, Categories and Groups**\n    \n    You can create applications, websites, categories, and groups that are not in the Application and URL Filtering Database for use in the policy. Use these custom objects to create a Rule Base that meets your organization's requirements. It is also possible to contact Check Point to create customized application signatures that can be imported into the database. This file can contain, for example, a database with an organization's internal applications that are not necessarily web-based.\n    \n\n## URL Filtering Categorization Flow\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk92743/URLF202303121729451.jpg)\n\nURL Categorization occurs mostly in the kernel:\n\n-   The kernel cache is queried for the URL.\n-   The cache lookup first checks for the host, and if there are members, it looks in the members array. If the URL is found in the cache, its categories are returned.\n-   If there is no URL in the cache, then a-sync request is issued, asking for online categorization.\n-   The user space daemon sends the URL to its user-space module that communicates with Check Point's online detection service.  \n    Once the online service responds with categories, the kernel cache is updated.\n\n## Features\n\n### Feature - HTTPS Filtering\n\nCategorization of HTTPS sites without HTTPS inspection (passive HTTPS). Supports URL Filtering on HTTPS traffic without HTTPS inspection.\n\nTo enable it, enable the URL Filtering blade:  \nIn SmartDashboard, go to Application & URL Filtering tab -> Advanced -> Engine Settings -> Enable \"Categorize HTTPS sites\", and install Security Policy.\n\n**How it works  \n**  \nA cache table _cptls\\_server\\_cn\\_cache_ is used here. The cache saves a mapping between IP+Port to CN (certificate's Canonical Name), and a flag if the CN is valid.\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk92743/cptls_table1.png)\n\n  \nWhen SSL traffic is coming, the _request_ (client hello) is recognized by PM (Pattern Matcher) matching on one of _SSL request signatures_ internal procedure. Then the IP+Port will be extracted from the connection and will be searched in the CPRLS cache and a CN (certificate's Canonical Name) might be found.\n\nIf a CN is found and valid, it will be sent to RAD (Resource ADvisor - internal engine responsible for URL Filtering) and the traffic will be categorized according to it. Otherwise, the traffic is continued to be inspected.\n\n  \nWhen a _response_ (server \"Hello\") arrives, it is recognized by PM (Pattern Matcher) matching on one of _SSL response signatures_ internal procedure, the certificate will be extracted and sent to _WSTLS_ process in User mode (in one or more traps). The process will try to resolve the certificate and find its CN.\n\nIt will return an asynchronous _ioctl_ with response to the kernel with the IP+Port and the CN (if found).\n\nIf a CN is returned, it will be sent to RAD and will be categorized according to it. Otherwise, the IP address will be sent to RAD and will be categorized according to it.\n\nExample: if the certificate's CN is google.com, the categories will be \"search engine/portal\"\n\n**  \nDebugging & Troubleshooting**\n\nRun the following debug on the Security Gateway:\n\n<table><tbody><tr><td>CLI command</td><td>Description</td></tr><tr><td><em>for PROC in $(pidof wstlsd) ; do fw debug $PROC on TDERROR_ALL_ALL=6 ; done</em></td><td>Debug <em>wstlsd</em> in User space - refer to <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk105559\" target=\"_blank\" rel=\"noopener\">sk105559</a> (output is saved in <em>$FWDIR/log/wstlsd.elg</em>)</td></tr><tr><td><em>fw ctl debug 0<br>fw ctl debug -buf 32000<br>fw ctl debug -m fw + cptls<br>fw ctl kdebug -T -f &gt; /var/log/kernel_debug.txt<br></em></td><td>Debug <em>cptls</em> in kernel (output is saved in <em>/var/log/kernel_debug.txt)</em></td></tr><tr><td><em>fw ctl debug 0<br>fw ctl debug -buf 32000<br>fw ctl debug -m APPI all<br>fw ctl kdebug -T -f &gt; /var/log/appi_debug.txt&nbsp;</em></td><td>Debug APPI in kernel (output is saved in <em>/var/log/appi_debug.txt)</em></td></tr><tr><td><em>fw ctl debug 0<br>fw ctl debug -buf 32000<br>fw ctl debug -m RAD_KERNEL all<br>fw ctl kdebug -T -f &gt; /var/log/rad_debug.txt<br></em></td><td>Debug RAD in kernel (output is saved in <em>/var/log/rad_debug.txt)</em></td></tr><tr><td><em>rad_admin rad debug on all</em></td><td><p>Debug RAD in User space (output is saved in <em>$FWDIR/log/rad.elg</em>)</p><p>To stop, run:<br><em>rad_admin rad debug off ALL</em></p></td></tr></tbody></table>\n\n**Problem: HTTPS Filtering feature is not working.**\n\n**Troubleshooting:**\n\n1.  Make sure you are surfing via port 443 (and not through proxy).\n2.  Check that the website you are surfing to is certificated by one of the trusted CAs configured in SmartDashboard.  \n    In SmartDashboard, go to Application & URL Filtering tab -> Advanced -> HTTPS Inspection -> Trusted CAs.  \n    If not, add its certificate.\n3.  Check that _wstlsd_ process is up.  \n    Run:  \n    _ps -ax | grep wstlsd_\n4.  Check that the '_cptls\\_server\\_cn\\_cache_' cache table is loaded.  \n    Run:  \n    _fw tab -t cptls\\_server\\_cn\\_cache -s_\n5.  Try to find your connection in the table.  \n    Run:  \n    _fw tab -t cptls\\_server\\_cn\\_cache_  \n    and search your IP+Port (in hex) in the 2 left columns.\n6.  Analyze the debug output file:\n    1.  Check that the client side was matched by the PM.  \n        Search for:  \n        _appi\\_rad\\_uf\\_cmi\\_handler\\_match\\_signature: group\\_data->group\\_id 10002002_\n    2.  Check if the IP+Port was found in the _CPTLS_ table.  \n        Search for:  \n        _fwtls\\_get\\_server\\_cn\\_from\\_cache\\_ex_\n    3.  Check if the server side was matched by the PM.  \n        Search for:  \n        _appi\\_rad\\_uf\\_cmi\\_handler\\_match\\_signature: group\\_data->group\\_id 10002003_\n    4.  Check if the certificate was extracted from the traffic.  \n        Search for:  \n        \"_CERTIFICATE_\"\n    5.  Check if the traps were sent to _WSTLSD_ process.  \n        Search for:  \n        _appi\\_rad\\_uf\\_cmi\\_handler\\_ssl\\_sn\\_trap_  \n        when you see \"_\\_last 1_\", it means it is the last trap.\n    6.  Check if you got ioctl from _WSTLDS_ process.  \n        Search for:  \n        _appi\\_rad\\_uf\\_ssl\\_cn\\_cmi\\_ioctl_\n    7.  Check if anything was sent to RAD.  \n        Search for:  \n        _rad\\_kernel\\_urlf\\_request\\_set\\_url_\n7.  Make sure you have connectivity to RAD and get response.\n\n### Feature - Safe Search\n\nSafe Search feature in web browsers is designed to screen sites that contain sexually explicit content and remove them from the search results. While no filter is 100% accurate, Safe Search helps to avoid content you may prefer not to see or would rather your children did not stumble across.  \nUser can change the settings of Safe Search from the browser for each specific search engine.  \nThis feature supports Safe Search in search engines (currently Google, Bing, and Yahoo).\n\nTo enable it, enable the URL Filtering blade.  \nIn SmartDashboard, go to Manage & Settings tab ->Blades ->  Application & URL Filtering Advanced Settings -> General -> enable \"Enforce Safe Search on search engines\", and install Security Policy.\n\n**  \nHow it works**\n\nEach search engine has its saved \"_&meter=value_\" that is added to the URL when 'Safe search' feature is enabled or disabled. For example, when enabling Safe Search engine in Google, it adds \"_&safe=active_\" to the URL. When disabling it, it adds \"_&safe=off_\" to the URL.\n\n**Debugging & Troubleshooting**\n\nRun the following debug on the Security Gateway:\n\n**  \nProblem: Safe Search feature is not working.**\n\n**Troubleshooting:**\n\n1.  Make sure that you use one of the supported search engines (Google, Bing or Yahoo).\n2.  Capture the traffic using WireShark and see if you get a redirect from the Security Gateway.\n3.  Verify that your URL is matched on one of the signatures from _$FWDIR/appi/update/appi\\_db.C_:  \n    In the debug output file, search for:  \n    _appi\\_rad\\_uf\\_cmi\\_handler\\_match\\_signature: group\\_data->group\\_id #Group Number of Relevant Section of Signatures from urlf\\_group#_\n4.  If one of the signatures was matched on your URL, analyze the debug output and see how the redirect URL _was built._In the debug output file, search for_:  \n    appi\\_rad\\_uf\\_cmi\\_handler\\_safe\\_search\\_handler: redirect\\_url: #Editted URL#_\n5.  If no signature was matched on your URL, send your URL to _**[app\\_request@checkpoint.com](mailto:app_request@checkpoint.com)**_ with a request to add a new signature to our list.\n\n### Feature - Cached and Translated pages categorization\n\nWith this feature disabled, when a user accesses the cached pages or Google translated pages, the matched category is ‘_Search Engine_’ since we drop the query string and send to RAD (Resource ADvisor) the Search Engine domain only.\n\nFor example, when accessing _http://www.ynet.co.il_ cached page from Google, the URL looks like: _http://webcache.googleusercontent.com/search?ix=seb&sourceid=chrome&ie=UTF-8&q=cache%3Awww.ynet.co.il_.  \nThe category will be the category of \"_webcache.googleusercontent.com_\" (Search Engine).\n\nThis feature extracts the correct domain from the cached / Google translated URL buffer, sends it to RAD and then gets the exact category of the page.\n\nTo enable it, enable the URL Filtering blade. In SmartDashboard, go to Application & URL Filtering tab -> Advanced -> Engine Settings -> Enable \"Enforce Safe Search in search engines\", and install Security Policy.\n\n**  \nHow it works**\n\nThe signatures are compiled to one PM (Pattern Matcher) that recognizes URLs that try to access the cached/translated pages.  \nWhen a URL is coming, the PM matching (built from the relevant signatures of this feature) is executed against it.  \nIf there is a match on one of the signatures, it means that it is a cached or translated page.  \nAccording to the signature match offset, the host is extracted and sent to RAD and the client will get the correct category of the page.\n\n**Debugging & Troubleshooting**\n\nRun the following debug on the Security Gateway:\n\n**Problem: Cached/Translated pages feature is not working.**\n\n**Troubleshooting:**\n\n1.  Make sure that you are using one of the supported search engines on cached pages (Google, Bing or Yahoo). And Google for translated pages.\n2.  Verify that your URL is matched with one of the signatures from _$FWDIR/appi/update/appi\\_db.C_ file_._  \n    In the debug output file, search for:  \n    _appi\\_rad\\_uf\\_cmi\\_handler\\_match\\_signature: group\\_data->group\\_id 10002000_\n3.  If one of the signatures was matched on your URL, run debug and see how the cached/translated domain is extracted from the URL.  \n    In the debug output file, search for:  \n    _appi\\_rad\\_uf\\_cmi\\_handler\\_extract\\_url\\_after\\_pm\\_match_\n4.  See that the extracted domain is sent to RAD.  \n    In the debug file, search for:  \n    _rad\\_kernel\\_urlf\\_request\\_set\\_url_\n5.  Make sure you have connectivity to RAD and get response.\n6.  If no signature was matched on your URL, send your URL to _**[app\\_request@checkpoint.com](mailto:app_request@checkpoint.com)**_ with a request to add a new signature to our list.\n\n## URL Filtering Agent\n\n### **General Description**\n\nThe new URL Filtering software blade uses a hosted categorization service (cloud-based categorization) that is being constantly updated to cope with the dynamic nature of the web. The Security Gateway is not required to download updates, the categorization database is not limited by the storage space on the Security Gateway, and customers receive the latest categorization to keep policies current.\n\nAs requests are being sent to the cloud, responses are being cached locally on the Security Gateway so that subsequent requests for the same sites will not query the cloud, but will be answered by the local cache. In deployments of R75.20 URL Filtering, we have seen that more than 99% of requests are being met by the cache, providing customers with the most up-to-date categorization (with the cloud) on the one hand and minimal latency (as most requests are being met by the cache), on the other.\n\nWhen there are critical updates (for example: a previously benign site has been hacked and is now used to spread malware), the cache is invalidated and forced to retrieve updates from the cloud. This is done by sending a query from the Security Gateway to the URL Filtering service every 2 hours (interval can be changed through rad\\_conf.C \"urlfs\\_service\\_check\\_seconds\"), which returns a list of URLs to be removed from the cache. The list is updated every 4 hours, and contains URLs whose category was changed to one of these Security Categories: Phishing, Spyware / Malicious Sites, Botnets, Spam, Suspicious Content.\n\n### **Processes**\n\nThe URL Filtering Software Blade (R75.20 and higher) uses a single user mode process called RAD (_$FWDIR/bin/rad_) to communicate with the online URL Filtering service. The process is initiated once Application Control, or URL Filtering Software Blades, are active on the Security Gateway. Whenever RAD successfully categorizes a URL, it caches it in its kernel cache.\n\nThe URL Filtering kernel cache holds the entire URL Family (all the URLs within the same host). Whenever there is a request for a new URL categorization, RAD sends to the online categorization service only the host part of the URL and receives the entire URL family. The response is then cached for future use.\n\n#### **Important Files**\n\nRAD holds its configuration in these files:\n\n-   _$FWDIR/conf/rad\\_conf.C_ - RAD settings.\n-   _$FWDIR/conf/rad\\_settings.C_ - RAD proxy settings.\n-   _$FWDIR/conf/rad\\_scheme.C_ - A file describing where and how to connect to the online services; reloaded on each install policy event.\n-   _$FWDIR/conf/rad\\_services.C_ - A database file that holds the kernel cache setting, such as cache table sizes and max allowed memory usage.\n\n### **URL Filtering Updates and local database (LDB) files**\n\nThe RAD kernel cache holds the entire URL Family. Whenever there is a request for a new URL categorization, RAD sends to the online categorization service only the host part of the URL and receives the entire URL family. To keep the response size short, the online service answers only if the URL family has 100 or fewer members. 99% of the URL database are part of families with 100 or fewer members and can be retrieved using the online service. The remaining 1% of the database is aggregated in a special file: _$FWDIR/appi/update/urlf\\_db.bin_\n\nThe file is reloaded on each URL Filtering update. Before sending a new online categorization request to the service, RAD looks in the local LDB file for a match. Only if the URL does not exist in the file, a request to the service is made.\n\nTo reload the LDB file, run:  \n_rad\\_admin urlf update $FWDIR/appi/update/urlf\\_db.bin_\n\n### **Website categorization mode**\n\nYou can select the mode that is used for website categorization:\n\n-   **Background**: requests are allowed until categorization is complete. When a request cannot be categorized with a cached response, an uncategorized response is received. Access to the site is allowed. In the background, the Check Point Online Web Service continues the categorization procedure. The response is then cached locally for future requests (default). This option reduces latency in the categorization procedure.\n-   **Hold**: requests are blocked until categorization is complete. When a request cannot be categorized with the cached responses, it remains blocked until the Check Point Online Web Service completes categorization.\n\n### **RAD CLI Commands**\n\n<table><tbody><tr><td><strong>Topic</strong></td><td><strong>Command</strong></td><td><strong>Explanation</strong></td><td><strong>Example</strong></td></tr><tr><td><p>Activation</p></td><td><p><em>rad_admin start</em></p></td><td><p>Start RAD process</p></td><td>&nbsp;</td></tr><tr><td>Activation</td><td><em>rad_admin stop</em></td><td>Stop RAD process</td><td>&nbsp;</td></tr><tr><td>Activation</td><td><em>rad_admin install</em></td><td>Install new RAD policy. RAD will reparse its <em>rad_setting.C</em> file.</td><td>&nbsp;</td></tr><tr><td>Debug</td><td><em>rad_admin rad debug on &lt;topic&gt;</em></td><td>Start debug (output is saved in <em>$FWDIR/log/rad.elg</em>)</td><td><p><em>rad_admin rad debug on all</em></p><p>Note: \"all\" must be in small letters</p></td></tr><tr><td>Debug</td><td><em>rad_admin rad debug off</em></td><td>Stop debug</td><td><p><em>rad_admin rad debug off ALL</em></p><p>Note: \"ALL\" must be in capital letters</p></td></tr><tr><td>Statistics</td><td><em>rad_admin stats on &lt;service&gt;</em></td><td>Start collecting statistics</td><td><em>rad_admin stats on urlf</em></td></tr><tr><td>Statistics</td><td><em>rad_admin stats print &lt;service&gt;</em></td><td>Print current statistics to <em>$FWDIR/log/&lt;service&gt;_rad_stats.csv</em></td><td><em>rad_admin stats print urlf</em></td></tr><tr><td>Statistics</td><td><em>rad_admin stats reset &lt;service&gt;</em></td><td>Reset all counters</td><td><em>rad_admin stats reset urlf</em></td></tr><tr><td>Statistics</td><td><em>rad_admin stats print_reset &lt;service&gt;</em></td><td>Print current statistics to <em>$FWDIR/log/&lt;service&gt;_rad_stats.csv</em> and reset the counters</td><td><em>rad_admin stats print_reset urlf</em></td></tr><tr><td>Statistics</td><td><em>rad_admin stats off &lt;service&gt;</em></td><td>Stop collecting statistics</td><td><em>rad_admin stats off urlf</em></td></tr><tr><td>Update</td><td><em>rad_admin urlf update &lt;full path&gt;</em></td><td>Reload URL Filtering local database file</td><td>&nbsp;</td></tr><tr><td>Fast Path</td><td><em>rad_admin fastpath &lt;service&gt;</em></td><td>Issue a request and update security categories in Security Gateway's cache<span>&nbsp;</span></td><td><em>rad_admin fastpath urlf</em></td></tr></tbody></table>\n\n### **Main Debug Flags**\n\n<table><tbody><tr><td>CLI Command</td><td>GW/<br>Mgmt</td><td>Kernel/<br>User Space</td><td>Description</td></tr><tr><td><em>fw ctl debug 0<br>fw ctl debug -buf 32000<br>fw ctl debug -m RAD_KERNEL all<br>fw ctl kdebug -T -f &gt; /var/log/debug_kernel.txt<br></em>Replicate the issue, or wait for the issue to occur.<br>Press CTRL+C to stop the kernel debug.<em><br>fw ctl debug 0<br></em></td><td>Security Gateway</td><td>Kernel</td><td>Start debug of RAD kernel module</td></tr><tr><td><em>rad_admin rad debug on</em><br>Replicate the issue, or wait for the issue to occur.<br><em>rad_admin rad debug off</em></td><td>Security Gateway</td><td>User Space</td><td>Start debug of RAD process<br>(debug is saved in <em>$FWDIR/log/rad.elg</em>)</td></tr></tbody></table>\n\n### **Getting the list of URLs Security Gateway sends to RAD (Resource ADvisor)**\n\n**Important** - This procedure makes the Security Gateway log every RAD request. This increases the size of log files and takes disk space. Make sure to restore the default setting as soon as possible.\n\n1.  Connect to the command line on the Security Gateway / **each** Cluster Member.\n    \n2.  Log in to the Expert mode.\n    \n3.  Back up the current _$FWDIR/conf/rad\\_conf.C_ file:\n    \n    `cp -v $FWDIR/conf/rad_conf.C{,_BKP}`\n4.  Edit the current _$FWDIR/conf/rad\\_conf.C_ file:\n    \n    `vi $FWDIR/conf/rad_conf.C`\n5.  Change the value of the parameter \"**normal\\_flow\\_events**\":\n    \n    from\n    \n    `:normal_flow_events (**false**)`\n    \n    to\n    \n    `:normal_flow_events (**true**)`\n    \n6.  Save the changes in the file and exit Vi editor.\n    \n7.  Restart the RAD process:\n    \n    `rad_admin stop ; sleep 5 ; rad_admin start`\n8.  **Wait at least 30 minutes.**\n    \n9.  Get the list of URLs and save it in a file:\n    \n    `grep \"Resource=\" $FWDIR/log/rad_events/Normal/* -A 1 | awk -F \"=\" '{print $2}' | sort | uniq -c > /var/log/RAD_URLs.txt`\n10.  Make sure the file contains URLs:\n    \n    `cat /var/log/RAD_URLs.txt`\n11.  Restore the default _$FWDIR/conf/rad\\_conf.C_ file:\n    \n    `cp -v -f $FWDIR/conf/rad_conf.C{_BKP,}`\n12.  Restart the RAD process:\n    \n    `rad_admin stop ; sleep 5 ; rad_admin start`\n\n## QUIC Protocol\n\n[QUIC Protocol](https://en.wikipedia.org/wiki/QUIC) (UDP, port 443) is a (still evolving) protocol invented by Google to provide security protection equivalent to TLS/SSL, along with reduced connection and transport latency. According to the latest information [published](https://blog.chromium.org/2015/04/a-quic-update-on-googles-experimental.html) by Google, half of Chrome’s requests to Google servers are served over QUIC Protocol. Application Control and URLF features like Safe Search, Translate, and Cache rely on traffic inspection to classify web traffic. When QUIC is used, we cannot inspect parts of the traffic, which may impact our ability to reliably classify content. If you see this in your organization, we currently recommend you block QUIC Protocol using Application Control.\n\nNote: Starting from R82 version, Check Point Security Gateways can inspect HTTP/3 traffic according to blades configurations. For more info, refer to the HTTPS Inspection section in the [Quantum Security Management Administration Guide](https://support.checkpoint.com/product/184) for your version.\n\n-   [Security Management Administration Guide](https://support.checkpoint.com/product/184)\n-   [Security Gateway Administration Guide](https://support.checkpoint.com/product/73)\n-   [Managing Pre-R80 Application Control and URL Filtering with R80 Administration Guide](https://sc1.checkpoint.com/documents/R80/CP_R80BC_ApplicationControlURLFiltering/html_frameset.htm)\n\n-   [sk163793 - How to scale up requests/responses RAD handling rates](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk163793)\n-   [sk65124 - URL Filtering Blade FAQ](http://supportcontent.checkpoint.com/solutions?id=sk65124)\n-   [sk115652 - Users are still able to post and chat on various web sites, although Application & URL Filtering policy is configured to block those web sites](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk115652)\n-   [sk169920 - Sporadic timeouts in the Anti-Malware/URL Filtering service (RAD)](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk169920)","language":"md","time":"14 days ago","created":"2025-05-06T22:56:00.617Z","annotations":[],"updated":"2025-05-06T22:57:54.866Z"},{"title":"Check Point ClusterXL Failover Issues with F5 BIG-IP Auto Last Hop","id":"3c59a3f0-7102-476d-8584-befc609341ab","type":"TEXT","raw":"ProductClusterXL\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-04-16\n\n## Symptoms\n\n-   Traffic issues in F5 BIG-IP environment during failover in Check Point ClusterXL\n\n## Cause\n\nF5 BIG-IP caches the last hop MAC address to overcome connectivity issues when network topology is changed. This feature is called \"_auto last hop_\".\n\nWhen \"_auto last hop_\" is enabled on F5 that is connected to a Check Point ClusterXL in the High Availability mode, the \"_auto last hop_\" will cache the last MAC address associated with the ClusterXL Virtual IP address (i.e., the physical MAC address of the _former_ Active Cluster Member) even though the ARP table learns the new MAC address associated with the Cluster Virtual IP address (i.e., MAC address of the former Standby Cluster Member that became the new Active Cluster Member).\n\nAs a result, when a ClusterXL failover occurs, the traffic arriving from F5 towards the Cluster Virtual IP address will be addressed to the MAC address of the _former_ Active Cluster Member. Because the _former_ Active Cluster Member is in the cluster state \"Down\", it does not process any incoming traffic.\n\nEven if you enable the VMAC mode on the Check Point ClusterXL, the Active Cluster Member sends information about the Virtual MAC address (associated with the Cluster Virtual IP address) in Gratuitous ARP frames only in the \"Destination MAC Address\" field. The \"Source MAC Address\" field of these G-ARP frames still contains the physical MAC address of the Active Cluster Member. When the Active Cluster Member sends regular TCP / UDP / ICMP traffic, it still uses its physical MAC address in the \"Source MAC Address\" field in the Ethernet frames.\n\n## Solution\n\nIn a ClusterXL configuration, we recommend one of these:\n\n-   Enable the \"Same VMAC\" mode:\n    \n    -   For R80.40 and higher versions, refer to the [ClusterXL Administration Guide](https://support.checkpoint.com/product/531#f-commonsource=C.%20Documentation) for your version.\n    -   This feature is available in:\n        -   Check Point R81.20 and higher (PMTR-76212)\n        -   Jumbo Hotfix Accumulator for R81.10 - starting from Take 75 (PRJ-34871)\n        -   Jumbo Hotfix Accumulator for R81 - starting from Take 72 (PRJ-34870)\n        -   Jumbo Hotfix Accumulator for R80.40 - starting from Take 180 (PRJ-34869)\n-   Enable the \"VMAC\" mode:\n    \n    -   For R80.40 and higher versions, refer to the [ClusterXL Administration Guide](https://support.checkpoint.com/product/531#f-commonsource=C.%20Documentation) for your version.\n    -   For R80.30 and lower versions, see [sk50840](http://supportcontent.checkpoint.com/solutions?id=sk50840).\n    -   This feature is available in the R71 and higher versions.\n\nWhen this issue was originally investigated in the year **2012** (when the \"Same VMAC\" mode was not available yet), we recommended these changes in an F5 BIG-IP environment:\n\n1.  Change the Check Point cluster configuration from ClusterXL to VRRP.\n    \n2.  On F5 BIG-IP, create an iRule to allocate the VRRP MAC Address to the physical MAC Addresses of the VRRP Cluster Members.\n    \n    Example (for the year **2012**):\n    \n    ```\n    when CLIENT_ACCEPTED {\n    if { [format %s [LINK::lasthop]] equals \"00:a0:8e:bd:eb:34\" || [format %s [LINK::lasthop]] equals \"00:a0:8e:bd:e7:d4\" } {\n    #set lasthop to the VRRP virtual mac\n    lasthop 666 00:00:5e:00:01:7b\n    }\n    }\n    ```\n    \n    Where:\n    \n    -   00:a0:8e:bd:eb:34 = The physical MAC address of the VRRP Member \"A\"\n    -   00:a0:8e:bd:e7:d4 = The physical MAC address of VRRP Member \"B\"\n    -   00:00:5e:00:01:7b = The VRRP MAC address\n    -   666 = VLAN, on which the VRRP routers reside\n\nAs a **workaround**, it is possible to disable \"_auto last hop_\" feature on F5. However, it may cause future connectivity issues. Make sure to set up a static route on the F5.\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorAvihai Bar\n\nTechnical ResourceMicky Michaeli\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2012-08-27\n\nLast Modified2025-04-16\n\nEditorAvihai Bar\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only\n\n**This SK applies to R82.10 as well**\n\n**Note from the year 2012** - We weren't able to successfully place an iRule that will overcome this F5 behavior, and we noticed that when an interface is disconnected and then reconnected again, the routes associated with this interface are deleted and do not return. Therefore, we did not continue the investigation in this direction and recommended the use of VRRP and iRule on the BIG IP F5 server.","language":"md","time":"14 days ago","created":"2025-05-06T22:55:58.263Z","annotations":[],"updated":"2025-05-06T22:56:52.497Z"},{"title":"Filter1Table Table with VSX Mode","id":"b3c1aee4-f84f-40e8-9580-93afa1d4f4e0","type":"TEXT","raw":"The table below shows the Software Blades and Features supported in the VSX mode (read the notes below the table).\n\n<table id=\"Filter1Table\"><tbody><tr><td>Blade / Feature</td><td>R82<br>VSNext</td><td>R82<br>Traditional<br>VSX</td><td>R81.20</td><td>R81.10</td><td>R81</td></tr><tr><td colspan=\"6\"><strong>Software Blades</strong></td></tr><tr><td>Firewall</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>IPS Blade</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>IPSec VPN Blade</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Anti-Bot Blade</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Anti-Virus Blade</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Traditional Anti-Virus Blade</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Threat Emulation Blade - ThreatCloud Emulation</td><td>Yes <strong><sup>(1)</sup></strong></td><td>Yes <strong><sup>(1)</sup></strong></td><td>Yes <strong><sup>(1)</sup></strong></td><td>Yes <strong><sup>(1)</sup></strong></td><td>Yes <strong><sup>(1)</sup></strong></td></tr><tr><td>Threat Emulation Blade - Remote Emulation</td><td>Yes <strong><sup>(1)</sup></strong></td><td>Yes <strong><sup>(1)</sup></strong></td><td>Yes <strong><sup>(1)</sup></strong></td><td>Yes <strong><sup>(1)</sup></strong></td><td>Yes <strong><sup>(1)</sup></strong></td></tr><tr><td>Threat Emulation Blade - Local Emulation</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Threat Extraction Blade (<a href=\"https://support.checkpoint.com/results/sk/sk101553\" target=\"_blank\" rel=\"noopener\">sk101553</a>)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Zero Phishing (<a href=\"https://support.checkpoint.com/results/sk/sk177924\" target=\"_blank\" rel=\"noopener\">sk177924</a>)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>N / A</td><td>N / A</td></tr><tr><td>Anti-Spam and Email Security Blade</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Data Loss Prevention (DLP) Blade</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Application Control Blade</td><td>Yes <strong><sup>(4)</sup></strong></td><td>Yes <strong><sup>(4)</sup></strong></td><td>Yes <strong><sup>(4)</sup></strong></td><td>Yes <strong><sup>(4)</sup></strong></td><td>Yes <strong><sup>(4)</sup></strong></td></tr><tr><td>URL Filtering Blade</td><td>Yes <strong><sup>(4)</sup></strong></td><td>Yes <strong><sup>(4)</sup></strong></td><td>Yes <strong><sup>(4)</sup></strong></td><td>Yes <strong><sup>(4)</sup></strong></td><td>Yes <strong><sup>(4)</sup></strong></td></tr><tr><td>Legacy URL Filtering Blade</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Content Awareness Blade</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Identity Awareness Blade</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>HTTPS Inspection</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>HTTP / HTTPS Proxy</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Monitoring Blade</td><td>No<br>(by design)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Mobile Access Blade</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>QoS Blade (Floodgate)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>QoS Feature, Light Weight (CPQOS - VSX native QoS)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td><a href=\"https://sc1.checkpoint.com/documents/Infinity_Portal/WebAdminGuides/EN/Quantum-IoT-Admin-Guide/Default.htm\" target=\"_blank\" rel=\"noopener\">IoT Protect with Infinity Portal</a></td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>IoT Protect with 3rd party IoT Discovery Service</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>SD-WAN (<a href=\"https://support.checkpoint.com/results/sk/sk180605\" target=\"_blank\" rel=\"noopener\">sk180605</a>)</td><td>No<br>(PMTR-104977)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>N / A</td></tr><tr><td colspan=\"6\"><strong>Management Server Features</strong></td></tr><tr><td>Central Deployment of Hotfixes and Version Upgrades from SmartConsole</td><td>No<br>(PMTR-108539)</td><td>Yes<br>(except VSLS)</td><td>Yes<br>(except VSLS)</td><td>Yes<br>(except VSLS)</td><td>Yes<br>(except VSLS)</td></tr><tr><td>Dedicated Management Interface (DMI) <strong><sup>(9)</sup></strong></td><td>N / A</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Non-Dedicated Management Interface (Non-DMI)</td><td>N / A</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Management Server behind NAT <strong><sup>(10)</sup></strong></td><td>Yes</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Management through a Virtual Gateway / Virtual System <strong><sup>(11)</sup></strong></td><td>Yes</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>SmartUpdate</td><td>Yes</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>SmartProvisioning / SmartLSM</td><td>No<br>(PMTR-109023)</td><td>Yes<br>(as a<br>Center<br>Gateway (Corporate<br>Office<br>Gateway)<br>in the<br>Star VPN<br>Community)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>SmartWorkflow on Management Server</td><td>Yes</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Database Revision Control on Management Server (<a href=\"https://support.checkpoint.com/results/sk/sk65420\" target=\"_blank\" rel=\"noopener\">sk65420</a>)</td><td>Yes</td><td>Yes</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Compliance Blade report on Management Server <strong><sup>(7)</sup></strong></td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>StandAlone Configuration</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>All Management Server Blades</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td colspan=\"6\"><strong>Global Features</strong></td></tr><tr><td>Network Address Translation (NAT) on traffic</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>NAT64 objects in Access Control Policy</td><td>No<br>(PMTR-107345)</td><td>Yes</td><td>Yes</td><td>Yes<br>(from R81.10<br>JHF Take 30)</td><td>No<br>(by design)</td></tr><tr><td>NAT46 objects in Access Control Policy</td><td>No<br>(MBS-16945)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>No<br>(by design)</td></tr><tr><td>NAT-T Initiator</td><td>No<br>(PMTR-47783)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>SecureXL - Kernel Mode (KPPAK)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>SecureXL - User Mode (UPPAK) <strong><sup>(13)</sup></strong></td><td>No<br>(PMTR-106079)</td><td>Yes</td><td>Yes<br>(from R81.20<br>JHF Take 89)</td><td>Yes<br>(from R81.20<br>JHF Take 150)</td><td>N / A</td></tr><tr><td>SecureXL - Penalty Box whitelist (fwaccel dos pbox)</td><td>No<br>(PMTR-109007)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>SecureXL - IP deny-list (fwaccel dos deny)</td><td>No<br>(PMTR-109008)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>SecureXL - Rate Limiting policy (fwaccel dos rate)</td><td>No<br>(PMTR-109037)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>SecureXL - Accelerated SYN Defender (fwaccel synatk)</td><td>No<br>(PMTR-109009)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>CoreXL</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>CoreXL Dynamic Dispatcher (<a href=\"https://support.checkpoint.com/results/sk/sk105261\" target=\"_blank\" rel=\"noopener\">sk105261</a>)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>CoreXL Dynamic Balancing (<a href=\"https://support.checkpoint.com/results/sk/sk164155\" target=\"_blank\" rel=\"noopener\">sk164155</a>)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>HyperFlow (<a href=\"https://support.checkpoint.com/results/sk/sk178070\" target=\"_blank\" rel=\"noopener\">sk178070</a>)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>N / A</td><td>N / A</td></tr><tr><td>Multi-Queue (<a href=\"https://support.checkpoint.com/results/sk/sk153373\" target=\"_blank\" rel=\"noopener\">sk153373</a>)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Dynamic Routing</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Source Based Routing on Virtual Router</td><td>N / A</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Policy Based Routing (PBR) on Virtual Router <strong><sup>(6)</sup></strong></td><td>N / A</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>SNMP Per Virtual Gateway / Virtual System using SNMPv3</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>DHCP Client</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>DHCP Relay</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>DHCP Server</td><td>No<br>(MBS-3246)</td><td>Yes <strong><sup>(12)</sup></strong></td><td>Yes <strong><sup>(12)</sup></strong></td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>NTP Client</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>NTP Server</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Mirror and Decrypt</td><td>No<br>(PMTR-109011)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>ICAP Client</td><td>No<br>(PMTR-16958)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>ICAP Server</td><td>No<br>(PMTR-16958)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Security Servers</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Jumbo Frames (<a href=\"https://support.checkpoint.com/results/sk/sk111407\" target=\"_blank\" rel=\"noopener\">sk111407</a>)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Rule Hit Count</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>UserCheck<br>(supported for Application Control / URL Filtering / Identity Awareness blades)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Gaia Portal</td><td>Yes</td><td>Yes <strong><sup>(8)</sup></strong></td><td>Yes <strong><sup>(8)</sup></strong></td><td>Yes <strong><sup>(8)</sup></strong></td><td>Yes <strong><sup>(8)</sup></strong></td></tr><tr><td>Gaia OS \"Cloning Groups\"</td><td>N / A<br>(built-in SMO cloning)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>IPv6 traffic</td><td>No<br>(PMTR-107345)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>VRRP Cluster</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>VPN Site-to-Site - Enhanced Link Selection</td><td>No<br>(PMTR-109016)</td><td>Yes</td><td>N / A</td><td>N / A</td><td>N / A</td></tr><tr><td>VPN Site-to-Site - Legacy Link Selection</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>VPN Site-to-Site - VTI - Numbered</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>VPN Site-to-Site - VTI - Unnumbered</td><td>No<br>(PMTR-60112)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Suspicious Activity Monitoring (SAM) Rules - in SmartUpdate, or with \"<em>fw sam</em>\" and \"<em>sam_alert</em>\" commands</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Malicious Activity Detection (MAD)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Connect Control</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>ISP Redundancy</td><td>No<br>(PMTR-108070)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Anti-Virus archive scanning</td><td>No<br>(PMTR-109024)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Threat Emulation archive scanning</td><td>No<br>(PMTR-109025)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Mail Transfer Agent (MTA) support for Threat Emulation</td><td>No<br>(PMTR-109026)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>External Network Feeds</td><td>Yes</td><td>Yes</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>IoC Feeds (<a href=\"https://support.checkpoint.com/results/sk/sk132193\" target=\"_blank\" rel=\"noopener\">sk132193</a>)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>DNS per Virtual System</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>VSLS (Virtual System Load Sharing mode)</td><td>No<br>(PMTR-108696)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Virtual Gateway / Virtual System in Monitor Mode</td><td>No<br>(PMTR-109340)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td colspan=\"6\"><strong>VSNext / Traditional VSX in Bridge Mode (<a href=\"https://support.checkpoint.com/results/sk/sk101371\" target=\"_blank\" rel=\"noopener\">sk101371</a>)</strong></td></tr><tr><td>Virtual Gateway / Virtual System in Bridge Mode (<a href=\"https://support.checkpoint.com/results/sk/sk101371\" target=\"_blank\" rel=\"noopener\">sk101371</a>)</td><td>No<br>(by design)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Multi Bridge (support for multiple bridge interfaces<br>on a Virtual System in Bridge Mode)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Virtual Gateway / Virtual System with Bridge interface</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td colspan=\"6\"><strong>Resource Control</strong></td></tr><tr><td><p>CPU monitoring per Virtual System</p><p>(the '<code>vsx resctrl</code>' command)</p></td><td><p>N / A</p></td><td><p>No<br>(by design)</p><p>Use the <a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">CPView utility</a></p></td><td><p>No<br>(by design)</p><p>Use the <a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">CPView utility</a></p></td><td><p>No<br>(by design)</p><p>Use the <a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">CPView utility</a></p></td><td><p>No<br>(by design)</p><p>Use the <a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">CPView utility</a></p></td></tr><tr><td><p>Memory monitoring per Virtual System</p><p>(the '<code>vsx mstat</code>' command)</p></td><td><p>N / A</p></td><td><p>Yes</p><p>Use the <a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">CPView utility</a></p></td><td><p>Yes</p><p>Use the <a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">CPView utility</a></p></td><td><p>Yes</p><p>Use the <a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">CPView utility</a></p></td><td><p>Yes</p><p>Use the <a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">CPView utility</a></p></td></tr><tr><td><p>CPU enforcement per Virtual System<br>(known as Resource Control Enforcer in VSX R6x versions)</p></td><td>N / A</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td><p>Memory enforcement per Virtual System<br>(known as Resource Control Enforcer in VSX R6x versions)</p></td><td>N / A</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td colspan=\"6\"><strong>Additional Features</strong></td></tr><tr><td>Merging VSX objects using <em>cp_merge</em> utility (<a href=\"https://support.checkpoint.com/results/sk/sk33751\" target=\"_blank\" rel=\"noopener\">sk33751</a>)</td><td>N / A</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Alias / Secondary IP address</td><td>No<br>(PMTR-109028)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>ECMP (Static Routes)</td><td>No<br>(PMTR-109029)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Multiple Static Routes with different priorities to the same destination</td><td>Yes</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>LLDP on data interfaces</td><td>Yes</td><td>Yes</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>LLDP on the ElasticXL's \"Mgmt\" interface</td><td>No<br>(PMTR-108547)</td><td>N / A</td><td>N / A</td><td>N / A</td><td>N / A</td></tr><tr><td>Loopback Interfaces</td><td>Yes</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>VxLAN Interfaces</td><td>No<br>(PMTR-60874)</td><td>Yes<br>(only in<br>SecureXL<br>KPPAK<br>mode)</td><td>Yes<br>(only in<br>SecureXL<br>KPPAK<br>mode)</td><td>Yes<br>(only in<br>SecureXL<br>KPPAK<br>mode)</td><td>Yes</td></tr><tr><td>GRE Interfaces</td><td>No<br>(PMTR-60868)</td><td>Yes<br>(only in<br>SecureXL<br>KPPAK<br>mode)</td><td>Yes<br>(only in<br>SecureXL<br>KPPAK<br>mode)</td><td>Yes<br>(only in<br>SecureXL<br>KPPAK<br>mode)</td><td>Yes</td></tr><tr><td>Hardware Security Module (HSM)</td><td>No<br>(PMTR-109031)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Management with Web SmartConsole</td><td>No<br>(PMTR-109032)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Management with Smart-1 Cloud</td><td>Yes</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Management with CloudGuard Controller</td><td>No<br>(by design)</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>Object Sharing from on-premises Management Server to Infinity Portal</td><td>No<br>(PMTR-109033)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Log Sharing from on-premises Management Server to Infinity Portal</td><td>No<br>(PMTR-109034)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr><tr><td>Infinity Playblocks service in Infinity Portal</td><td>No<br>(PMTR-109035)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td><td>No<br>(by design)</td></tr></tbody></table>\n\n-   For this version, refer to [sk106496 - Software Blades updates - FAQ](https://support.checkpoint.com/results/sk/sk106496).\n    \n-   In this version, Gaia Portal is supported only to run the Gaia 'First Time Configuration Wizard'.\n    \n-   In this version, IPv6 is supported with these limitations:\n    \n    -   Pure IPv6 is not supported (must have IPv4 addresses assigned) - applies only to Clusters.\n    -   IPv6 is not supported on Virtual Routers.\n-   For this version, refer to [sk106496 - Software Blades updates - FAQ](https://support.checkpoint.com/results/sk/sk106496) and to the [VSX Administration Guide](https://support.checkpoint.com/product/359#q=%22VSX%20Administration%20Guide%22&f-commonsource=C.%20Documentation) for your version.\n    \n-   For this version, refer to the [VSX Administration Guide](https://support.checkpoint.com/product/359#q=%22VSX%20Administration%20Guide%22&f-commonsource=C.%20Documentation) for your version.\n    \n-   For this version, refer to the [Gaia Advanced Routing Administration Guide](https://support.checkpoint.com/product/359) for your version and [sk100500 - Policy-Based Routing (PBR) on Gaia OS](https://support.checkpoint.com/results/sk/sk100500).\n    \n-   Because \"Compliance\" Software Blade is a Management blade, you cannot activate it in a VSX Gateway / VSX Cluster object.  \n    By design, the \"Security Best Practices\" for \"Gaia OS\" are _**not**_ checked on VSX Gateways / VSX Clusters.  \n    Refer to [sk92861 - ATRG: Compliance Blade](https://support.checkpoint.com/results/sk/sk92861).\n    \n-   In this version, Gaia Portal is supported only to install CPUSE packages.\n    \n-   Dedicated Management Interface (DMI) management is **_not_** supported through a physical interface (on the VSX Gateway / VSX Cluster Member) that has one or more VLAN interfaces configured.\n    \n-   NAT is _**not**_ supported between the Management Server and the managed VSX Gateway / VSX Cluster.  \n    It is _**not**_ supported to manage a VSX Gateway / VSX Cluster in these cases:\n    \n    -   When the Management Server is behind NAT\n    -   When the VSX Gateway / VSX Cluster is behind NAT\n-   It is _**not**_ supported to manage a VSX Gateway / VSX Cluster when the management traffic passes through a Virtual System on the same VSX Gateway / VSX Cluster. Only VS0 can communicate directly with the Management Server.\n    \n-   You configure the DHCP Server settings in the context of a Virtual System (`set virtual-system <VSID>`). Refer to the [Gaia Administration Guide](https://support.checkpoint.com/product/359#q=%22Gaia%20Administration%20Guide%22&f-commonsource=C.%20Documentation) for your version > Chapter \"Network Management\" > Section \"DHCP Server\" > Section \"Configuring a DHCP Server in Gaia Clish\".\n    \n-   For information about SecureXL User Space (UPPAK) mode, see [sk179432](https://support.checkpoint.com/results/sk/sk179432).","language":"md","time":"14 days ago","created":"2025-05-06T22:56:00.921Z","annotations":[],"updated":"2025-05-06T22:57:55.542Z"},{"title":"ProductClusterXL: Global Kernel Parameters and Introduction","id":"e54c2cb8-fa83-49ef-afbb-1f5701077be4","type":"TEXT","raw":"ProductClusterXL\n\nVersionR77.20 (EOS), R77.30 (EOS), R80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nPlatformAll\n\nLast Modified2022-11-27\n\n## Solution\n\n**Table of Contents:**\n\n-   Introduction\n    \n-   List of Kernel Parameters\n    \n-   Procedure\n    \n-   Example\n    \n-   Related solutions\n    \n\n## Introduction\n\nThe article contains a list of various relevant global kernel parameters that can be configured on cluster members to control timeouts for interface monitoring:\n\n1.  fwha\\_if\\_problem\\_tolerance\n    \n2.  fwha\\_if\\_in\\_confirmed\\_tolerance\n    \n3.  fwha\\_if\\_out\\_confirmed\\_tolerance\n    \n4.  fwha\\_if\\_in\\_confirmed\\_bond\\_tolerance\n    \n5.  fwha\\_if\\_out\\_confirmed\\_bond\\_tolerance\n    \n\n## List of Kernel Parameters\n\n**Important Note:** Internal cluster timers use special time units - **`HTU (\"HA Time Unit\")`**, where **`1 HTU = 100 milliseconds = 0.1 second`**.\n\n<table><colgroup><col span=\"1\" width=\"300\"> <col span=\"1\" width=\"N|N%|relative_length\"></colgroup><tbody><tr><td id=\"fwha_if_problem_tolerance\">Relevant global kernel parameter</td><td><code>fwha_if_problem_tolerance</code></td></tr><tr><td>Description</td><td>Changes the timeout, during which an interface is considered '<code>DOWN</code>' (so the interface changes its state from \"<code>Assumed UP</code>\" to \"<code>DOWN</code>\").</td></tr><tr></tr><tr><td>Default value</td><td>0</td></tr><tr><td>Default monitoring timeout<br>(with default parameter's value)</td><td><p>24 HTUs (= 2.4 sec)</p><p>During Policy Installation = 96 HTUs (= 9.6 sec)</p></td></tr><tr><td>Formula</td><td><p>Timeout is calculated based on this formula:</p><p><code>ClusterXL Interface Monitoring Timeout = [(fwha_if_problem_tolerance) + (IF_IN_CONFIRMED_UP_TIME) + (IF_OUT_CONFIRMED_UP_TIME) + 3] x [1 or (fwha_cul_policy_if_timeouts_multiplier)]</code></p><p><strong>Clarification:</strong></p>During policy installation, there are cases when the state of the cluster member might change (expected behavior). However, if the cluster member's state is changed, this might result in an unwanted failover. For this reason, there exist a mechanism belonging to the Cluster Under Load (CUL) feature that freezes the state machine of a cluster member.<br>Part of how the cluster implements this freezing is by using a special parameter called \"<code>fwha_cul_policy_extend_timeouts</code>\". When the cluster starts policy installation, it sets the value of this kernel parameter \"<code>fwha_cul_policy_extend_timeouts</code>\" to 1 (one), which affects 3 important timeout values in the system:<ul><li>\"dying timeout\" (how much time is required to establish that a cluster member is dying)</li><li>\"dead timeout\" (how much time is required to establish that a cluster member is dead and failover is required)</li><li>\"if problem timeout\" (how much time is required to determine that an interface has a problem as a result of not receiving CCP packets\"</li></ul>When the value of \"<code>fwha_cul_policy_extend_timeouts</code>\" is set to 1, then all of the above 3 timeouts are extended significantly (each is calculated differently, but instead of multiplying their timeout calculation by 1, we multiply it by the value of another kernel parameter \"<code>fwha_cul_policy_if_timeouts_multiplier</code>\" (whose value is set to 4 by default, and can be changed by the administrator as described in the \"<span targetid=\"Procedure\">Procedure</span>\" section below), thus causing an extension to the timeout.</td></tr><tr><td>Supported versions</td><td>R77.10 and above</td></tr></tbody></table>\n\n<table><colgroup><col span=\"1\" width=\"300\"> <col span=\"1\" width=\"N|N%|relative_length\"></colgroup><tbody><tr><td id=\"fwha_if_in_confirmed_tolerance\">Relevant global kernel parameter</td><td><code>fwha_if_in_confirmed_tolerance</code></td></tr><tr><td>Description</td><td>Changes the timeout, during which then \"<code>IN</code>\" direction of an interface is not considered \"<code>UP</code>\" (so the interface changes its \"<code>IN</code>\" state to \"<code>Assumed UP</code>\").</td></tr><tr><td>Default value</td><td>0</td></tr><tr><td>Default monitoring timeout<br>(with default parameter's value)</td><td>7 HTUs (= 0.7 sec)</td></tr><tr><td>Formula</td><td><p>Timeout is calculated based on this formula:</p><code>IF_IN_CONFIRMED_UP_TIME = (fwha_if_in_confirmed_tolerance) + (7 HTUs)</code></td></tr><tr><td>Supported versions</td><td>R77.10 and above</td></tr></tbody></table>\n\n<table><colgroup><col span=\"1\" width=\"300\"> <col span=\"1\" width=\"N|N%|relative_length\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td id=\"fwha_if_out_confirmed_tolerance\"><code>fwha_if_out_confirmed_tolerance</code></td></tr><tr><td>Description</td><td>Changes the timeout, during which then \"<code>OUT</code>\" direction of an interface is not considered \"<code>UP</code>\" (so the interface changes its \"<code>OUT</code>\" state to \"<code>Assumed UP</code>\").</td></tr><tr></tr><tr><td>Default value</td><td>0</td></tr><tr><td>Default monitoring timeout<br>(with default parameter's value)</td><td>12 HTUs (= 1.2 sec)</td></tr><tr><td>Formula</td><td><p>Timeout is calculated based on this formula:</p><code>IF_OUT_CONFIRMED_UP_TIME = (fwha_if_out_confirmed_tolerance) + (12 HTUs))</code></td></tr><tr><td>Supported versions</td><td>R77.10 and above</td></tr></tbody></table>\n\n<table><colgroup><col span=\"1\" width=\"300\"> <col span=\"1\" width=\"N|N%|relative_length\"></colgroup><tbody><tr><td id=\"fwha_if_in_confirmed_bond_tolerance\">Relevant global kernel parameter</td><td><code>fwha_if_in_confirmed_bond_tolerance</code></td></tr><tr><td>Description</td><td>Changes the timeout, during which then \"<code>IN</code>\" direction of a Bond interface is not considered \"<code>UP</code>\" (so the Bond interface changes its \"IN\" state to \"<code>Assumed UP</code>\").</td></tr><tr></tr><tr><td>Default value</td><td>0</td></tr><tr><td>Default monitoring timeout<br>(with default parameter's value)</td><td>12 HTUs (= 1.2 sec)</td></tr><tr><td>Formula</td><td><p>Timeout is calculated based on this formula:</p><code>IF_IN_CONFIRMED_BOND_UP_TIME = fwha_if_in_confirmed_bond_tolerance + (12 HTUs)</code></td></tr><tr><td>Supported versions</td><td>R77.10 and above</td></tr></tbody></table>\n\n<table><colgroup><col span=\"1\" width=\"300\"> <col span=\"1\" width=\"N|N%|relative_length\"></colgroup><tbody><tr><td id=\"fwha_if_out_confirmed_bond_tolerance\">Relevant global kernel parameter</td><td><code>fwha_if_out_confirmed_bond_tolerance</code></td></tr><tr><td>Description</td><td>Changes the timeout, during which then \"<code>OUT</code>\" direction of a Bond interface is not considered \"<code>UP</code>\" (so the Bond interface changes its \"OUT\" state to \"<code>Assumed UP</code>\").</td></tr><tr></tr><tr><td>Default value</td><td>0</td></tr><tr><td>Default monitoring timeout<br>(with default parameter's value)</td><td>22 HTUs (= 2.2 sec)</td></tr><tr><td>Formula</td><td><p>Timeout is calculated based on this formula:</p><code>IF_OUT_CONFIRMED_BOND_UP_TIME = (fwha_if_out_confirmed_bond_tolerance) + (22 HTUs)</code></td></tr><tr><td>Supported versions</td><td>R77.10 and above</td></tr></tbody></table>\n\n##   \nProcedure\n\nOn **each** cluster member, set the value of the relevant kernel parameter to the desired number of seconds (which must be specified in HTUs).\n\n-   To check the current value of a kernel parameter:\n    \n    **`[Expert@HostName]# fw ctl get int _PARAMETER_`**\n    \n-   To set the desired value for a kernel parameter _on-the-fly_:\n    \n    **`[Expert@HostName]# fw ctl set int _PARAMETER_ _VALUE_in_HTUs_`**\n    \n-   To set the desired value for a kernel parameter _permanently_ (for your operating system):\n    \n    Follow [sk26202 (Changing the kernel global parameters for Check Point Security Gateway)](http://supportcontent.checkpoint.com/solutions?id=sk26202).\n    \n    > For Gaia / SecurePlatform OS:\n    > \n    > 1.  Create the _$FWDIR/boot/modules/fwkern.conf_ file (if it does not already exit):\n    >     \n    >     _**\\[Expert@HostName\\]# touch $FWDIR/boot/modules/fwkern.conf**_\n    > 2.  Edit the _$FWDIR/boot/modules/fwkern.conf_ file in Vi editor:\n    >     \n    >     _**\\[Expert@HostName\\]# vi $FWDIR/boot/modules/fwkern.conf**_\n    > 3.  Add the following line (spaces and comments are not allowed):\n    >     \n    >     **_PARAMETER=_VALUE**\n    > 4.  Save the changes and exit from Vi editor.\n    >     \n    > 5.  Check the contents of the _$FWDIR/boot/modules/fwkern.conf_ file:\n    >     \n    >     _**\\[Expert@HostName\\]# cat $FWDIR/boot/modules/fwkern.conf**_\n    > 6.  Reboot the Security Gateway.\n    >     \n    > 7.  Verify that the new value was set:\n    >     \n    >     _**\\[Expert@HostName\\]# fw ctl get int PARAMETER**_\n    \n\n## Example\n\nLet us show how changing the value of the above kernel parameters affects the cluster timeouts for interface monitoring.\n\nAs an example, we will work with **`fwha_if_in_confirmed_tolerance`** parameter.\n\nThe default value of `fwha_if_in_confirmed_tolerance` is 0 (zero).  \nThe default timeout value of '`IF_IN_CONFIRMED_UP_TIME`' for interface monitoring with the above default value is (0 + 7 HTUs) = 0.7 sec.\n\nSetting the value of **`fwha_if_in_confirmed_tolerance`** to **2** HTUs will cause change in timeout value of '`IF_IN_CONFIRMED_UP_TIME`' for interface monitoring from 7 HTUs (0.7 sec) to (2 HTUs + 7 HTUs) = 0.9 sec.\n\n-   [sk56202 - How to troubleshoot failovers in ClusterXL](http://supportcontent.checkpoint.com/solutions?id=sk56202)\n    \n-   [sk62570 - How to troubleshoot failovers in ClusterXL - Advanced Guide](http://supportcontent.checkpoint.com/solutions?id=sk62570)\n    \n-   [sk43984 - Interface flapping when cluster interfaces are connected through several switches](http://supportcontent.checkpoint.com/solutions?id=sk43984)\n    \n-   [sk93454 - Increasing ClusterXL dead timeout](http://supportcontent.checkpoint.com/solutions?id=sk93454)\n    \n-   [sk97415 - Increasing Virtual System dead timeout](http://supportcontent.checkpoint.com/solutions?id=sk97415)\n    \n-   [sk31934 - ClusterXL IGMP Membership](http://supportcontent.checkpoint.com/solutions?id=sk31934)\n    \n-   [sk33221 - Using ClusterXL with IGMP Snooping-enabled switches](http://supportcontent.checkpoint.com/solutions?id=sk33221)\n    \n-   [sk55081 - Best practice for manual fail-over in ClusterXL](http://supportcontent.checkpoint.com/solutions?id=sk55081)\n    \n-   [sk92787 - How to debug ClusterXL failovers caused by RouteD daemon on Gaia OS](http://supportcontent.checkpoint.com/solutions?id=sk92787)\n    \n-   [sk93599 - Failover occurs randomly in VSX cluster because Critical Device 'VSX' reports its status as '`problem`'](http://supportcontent.checkpoint.com/solutions?id=sk93599)\n    \n-   [sk93306 - ATRG: ClusterXL R6x and R7x](http://supportcontent.checkpoint.com/solutions?id=sk93306)\n    \n-   [sk33781 - Performance analysis for Security Gateway NGX R65 / R7x](http://supportcontent.checkpoint.com/solutions?id=sk33781)\n    \n\n## Article Properties\n\nOriginatorDavid Hananel\n\nTechnical ResourceRan Vaknin\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2014-01-21\n\nLast Modified2022-11-27\n\nEditorDavid Kornfield\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only\n\n**Should not be deleted - referenced in sk93306 (ATRG ClusterXL)**","language":"md","time":"14 days ago","created":"2025-05-06T22:56:04.047Z","annotations":[],"updated":"2025-05-06T22:58:18.224Z"},{"title":"ProductIdentity Awareness","id":"aa1aedd1-cf14-4e58-b9a1-88682eab0571","type":"TEXT","raw":"ProductIdentity Awareness\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2024-10-26\n\n## Solution\n\n**Table of Contents**\n\n-   Introduction\n    \n-   How Does It Work\n    \n-   Problems and Troubleshooting\n    \n    -   General Active Directory (AD) Integration\n        \n    -   AD Query\n        \n    -   First-Time Wizard\n        \n    -   Access Role Picker problems\n        \n    -   Captive Portal\n        \n    -   Identity Agent\n        \n    -   X-Forward-For (XFF) HTTP header configuration\n        \n    -   Identity Collector\n        \n-   Related solutions\n    \n\n**  \nNote:** See [sk88520: Best Practices - Identity Awareness Large Scale Deployment](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk88520)\n\n## Introduction\n\nTraditionally, firewalls use IP addresses to monitor traffic and are unaware of the user and computer identities behind those IP addresses. Identity Awareness removes this notion of anonymity since it maps users and computer identities. This lets you enforce access and audit data based on identity.\n\nIdentity Awareness is an easy to deploy and scalable solution. It is applicable for both Active Directory and non-Active Directory based networks as well as for employees and guest users.\n\nIdentity Awareness uses the Source and Destination IP addresses of network traffic to identity users and computers. You can use these elements as matching criteria in the Source and Destination fields of your policy rules:\n\n-   The identity of users or user groups\n-   The identity of computers or computer groups\n\nIdentity Awareness lets you define policy rules for specified users who send traffic from specified computers or from any computer. Likewise, you can create policy rules for any user on specified computers.\n\nYou can see the logs based on user and computer name, and not just IP addresses, in the Logs & Monitor -> Logs tab. You can see events in the Logs & Monitor Access Control views.\n\nIdentity Awareness gets identities from the configured identity sources. You must enable these identity sources in the Identity Awareness Gateway object -> Identity Awareness page, and install the Access Policy:\n\n-   Browser-Based Authentication\n-   Active Directory Query (AD Query) \n-   Identity Agents \n-   Terminal Servers \n-   RADIUS Accounting \n-   Identity Web API \n-   Identity Collector (see [Identity Awareness Clients Administration Guide](https://sc1.checkpoint.com/documents/Identity_Awareness_Clients_Admin_Guide/Default.htm) > Identity Collector section for Technical Overview)\n-   Remote Access\n\nIdentity Awareness Security Gateways can share the identity information that they acquire with other Identity Awareness Security Gateways. This way, users that need to pass through many Security Gateways are only identified once.  \nSee the [R81.20 Advanced Identity Awareness Environment](https://sc1.checkpoint.com/documents/R81.20/WebAdminGuides/EN/CP_R81.20_IdentityAwareness_AdminGuide/Default.htm#cshid=ID003) section for more information.\n\n##   \nHow Does It Work\n\n### Identity Awareness Flow and responsibilities\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk86441/flow-1.jpg)\n\n-   **Identity Source  \n    **\n    -   Performs authentication, if needed (Captive Portal, Identity Agent). \n    -   Extracts {username (and/or) machine, IP Address, Domain (if possible)} and sends it to the PDP.\n-   **Identity Enforcement (PEP)** resides on the Firewall gateway and protects the resource in the 'cloud'.\n    -   Negotiate with PDP about shared identities. \n    -   Receives the Identity from the PDP and enforce traffic accordingly.\n-   **Identity Server (PDP)** resides on a remote server and is connected Identity Enforcement (PEP) over SIC connection.\n    -   Receives the information from the Identity Source\n    -   Performs authorization request to the relevant user directory (LDAP / RADIUS / Internal Users DB). For more info, refer to [sk149854](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk149854).\n    -   Performs Access Roles matching\n    -   Shares the identity to the relevant PEPs. \n-   The end user (and machine) authenticates to the identity server and generates traffic to the \"cloud\" via the Identity Enforcement firewall.  \n    **Note**: PDP and PEP can reside on the same firewall. PDP can function as PEP, but not vice versa.\n\nFor additional information about Configuration, Commands and Debugging, see the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) (for your version) for more details.\n\n## Problems and Troubleshooting\n\n-   General problems\n    \n-   Active Directory (AD) Integration\n    \n-   AD Query\n    \n-   First-Time Wizard\n    \n-   Access Role Picker problems\n    \n-   Captive Portal\n    \n-   Identity Agent\n    \n-   X-Forward-For (XFF) HTTP header configuration\n    \n-   Identity Collector\n    \n\n## General problems\n\n-   **Problem: PDP consumes high CPU.**\n    \n    > Usually filtering-out un-needed efforts from PDP solves this issue. The frequent options:\n    > \n    > 1.  **Filter-out service accounts**  \n    >     \"A service account is a user account that is created explicitly to provide a security context for services running on Windows Server operating systems. The security context determines the service's ability to access local and network resources. The Windows operating systems rely on services to run various features.\" (Microsoft).\n    >     \n    >     Since Identity Awareness saves one identity per IP, if service account is authenticate for IP x.x.x.x (e.g. installing an application via GPO), the real user identity will be revoked. Therefore, excluding the service account must be applied.  \n    >     To understand which service accounts were already identified in Identity Awareness database (available on AD Query and Identity Collector), run:\n    >     \n    >     AD Query: _\\# adlog a control srv\\_accounts show_  \n    >     Identity Collector: _\\# pdp idc service\\_accounts_\n    >     \n    >     To exclude the service accounts:\n    >     \n    >     AD Query:  \n    >     \\- Go to Gateway Properties -> Identity Awareness -> AD Query - Settings -> Advanced  \n    >     \\- Configure the network and identity filter.  \n    >     \\- In addition, select in this window \"Automatically exclude users which are logged into more than X machines simultaneously\".\n    >     \n    >     Identity Collector: on the upper pane in Identity Collector application, select \"Filters\" and configure the network / identity filter.\n    >     \n    > 2.  **Optimizing nested-group query**  \n    >     By default, PDP will run recursive query in order to find all group membership for given identity, up to 20 levels of query.  \n    >     Starting R80.10, this can be optimized by changing the query method. For more info, refer to [sk128212](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk128212).\n    > 3.  **Migrating from AD Query to Identity Collector**. For more info, refer to [Identity Awareness Clients Administration Guide](https://sc1.checkpoint.com/documents/Identity_Awareness_Clients_Admin_Guide/Default.htm) > Identity Collector section.\n    > 4.  **Optimizing Identity Agent performance.** For more info, refer to [sk88520](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk88520).\n    \n\n## Troubleshooting Active Directory (AD) Integration\n\n-   **Problem: Users are successfully identified, but their user groups and Access Roles are not correctly enforced or logged.**\n    \n    > Verify that there is one LDAP Account Unit per AD domain. If you need to configure specific domain controllers per gateway (for AD Query for example), refer to the Advanced AD Query section in the Identity Awareness Administration Guide.\n    \n-   **Problem: User fails to authenticate in Captive portal or Identity Agent although the name and password are correct.**\n    \n    > Verify that account is not locked or expired. If there are multiple accounts with the same user name, for example in multiple AD domains or in AD domain and internal user database, AD user should authenticate with domain\\\\user, for example, _CORP.ACME.COM\\\\jdoe_.\n    \n\n## Troubleshooting AD Query\n\n-   **Problem: AD Query is connected successfully to all domain controllers, but users are not detected. Furthermore, the number of events (in the SmartView Monitor or in the output of `adlog a dc` command) is relatively small.**\n    \n    > Verify that the necessary auditing logs are generated on the Security Event log of the Domain Controllers.\n    > \n    > -   On 2003 Domain controllers the events are 672, 673 and 674\n    > -   On 2008 and up Domain controllers the events are 4624, 4768, 4769 and 4770\n    \n-   **Problem: AD Query fails to connect to the Domain Controllers (can be seen in the SmartView Tracker, SmartView Monitor, or by running `adlog a dc` in Expert mode).**\n    \n    > See [sk58881](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk58881).\n    \n-   **Problem: Not all users are detected.**\n    \n    > AD Query must be configured to communicate with the actual Domain Controller that the user is connected to (as security event logs are not replicated). Verify that the Domain Controller that user is connected to (can be found by running `echo %LOGONSERVER%`) belongs to the AD Query account unit.  \n    > **Note**: if AD Query was configured via the wizard when the computer was not in the domain, only one Domain Controller is entered to the LDAP Account unit.\n    \n-   **Problem: AD Query is connected successfully to the Domain Controllers and receives events, but the number of users detected is fairly small.**\n    \n    > Verify that the users / IP addresses are not ignored (can be configured in the SmartDashboard). Furthermore, verify that the users do not pass any NAT in the way to the firewall.  \n    > If the events in the Security Event log are generated with the NAT IP address, they wll be automatically ignored because NAT is not supported by AD Query.\n    \n-   **Problem: AD Query shows that another user is connected besides the actual user for some IP address.**\n    \n    > AD Query cannot differentiate between the actual user that performed login and services which perform login from his computer. The service accounts can be filtered in the SmartDashboard. See the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) (for your version) for more details.\n    \n-   **Problem: After user logged out and another one logged in, AD Query thinks that both users are connected.**\n    \n    > AD Query aggregates users (and permissions), and only after the first one times out, it will be revoked. This behavior can be changed by selecting the 'Assume only one user per machine' option, but be sure to ignore the service account before. See the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) (for your version) for more details.\n    \n-   **Problem: SmartView Tracker error messages stating that the gateway could not fetch group membership for users, and the user names contain non-English characters.**\n    \n    > Enable (via GuiDBedit) the '_EnableUnicode_' attribute on the LDAP account unit. See the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) (for your version) for more details.\n    \n\n## Troubleshooting First-Time Wizard\n\n-   **Problem: Identity Awareness Wizard fails with error message \"WMI (DCERPC) test failed\", or similar. AD Query is configured, but still users are not identified in logs and cannot get access based on their identity. Domain Controllers that the Security Gateway fails to connect to, can be seen in SmartView Monitor or in the output of `adlog a dc` command.**\n    \n    > See [sk58881](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk58881).\n    \n-   **Problem:**\n    \n    1.  **First-Time Wizard fails, stating the LDAP connectivity failed, while the administrator selected a working account unit in it.**\n    2.  **LDAP connectivity test fails for no obvious reason and only LDAP over SSL is supported on the Domain Controllers.  \n        **\n    \n    > The First-Time Wizard works only via LDAP (not LDAPS) and it disregard the `use ssl` directive on the account unit. If LDAP is disabled, the wizard fails, and the administrator has to configure the account unit manually.\n    \n-   **Problem: Administrator wants to use the First-Time Wizard again to create other domain.**\n    \n    > Clear the '`Enable Identity Awareness`' checkbox and rerun the Wizard.\n    \n-   **Problem: First-Time Wizard fails, stating that it could not fill in the Login DN parameter in the LDAP Account Unit and the customer Active Directory Forest contains more than one Active Directory Domain.**\n    \n    > See the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) (for your version) regarding how to configure Forest with more than one domain (usually sub-domains).\n    \n\n## Troubleshooting Access Role Picker problems\n\n-   **Problem: There is a red X on the domain name and no domain users or groups appear in the picker.**\n    \n    > Verify that SmartConsole can connect to the Domain Controller. If this happens after working for some time with the picker and there is connectivity to the domain controller, restart the SmartConsole.\n    \n-   **Problem: There is no rule-match / enforcement for specific user.**\n    \n    > ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk86441/Picker-for-SK202410061020491.png)  \n    > Relevant links:  \n    > \n    > -   [sk106133](https://support.checkpoint.com/results/sk/sk106133)\n    > -   [Identity Sharing](https://sc1.checkpoint.com/documents/R81.20/WebAdminGuides/EN/CP_R81.20_IdentityAwareness_AdminGuide/Default.htm#cshid=ID004)\n    \n\n##   \nTroubleshooting Captive Portal\n\n-   **Problem: Browsing to _http://www.myIAServer.com/connect_ returns \"Server Not Found\" error or empty screen.**\n    \n    Make sure that Captive Portal configuration is correct:\n    \n    -   Is Identity Awareness enabled?\n    -   Is the Captive Portal enabled?\n    -   Did you connect to the correct URL?\n    -   Is DNS properly configured?\n    -   Did you define a proper rule?\n    -   Install Policy  \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk86441/captive-portal-pic1.jpg)\n    -   Did you connect to the correct interface?  \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk86441/captive-portal-pic2.jpg)\n    -   Does Multi Portal show that portal is up?  \n        Example:  \n        _\\[admin@cpmodule ~\\]$ mpclient status nac  \n        Portal is not running_\n-   **Problem: Cannot authenticate using correct credentials.**\n    \n    1.  Are your credentials in English only?  \n        Make sure you selected the '`Enable Unicode support`' checkbox in the LDAP account unit server object.\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk86441/support-Unicode%20.jpg)\n        \n    2.  Verify that `pdpd` is running.\n    3.  Use domain\\\\user for when you have accounts with identical names.\n-   **Problem: Changes in Captive Portal settings do not take effect.**\n    \n    Reason: If the user has a working session, it will continue to work with previous settings.\n    \n    Solution:\n    \n    1.  Close ALL open browser windows (so the session will not exist anymore).\n    2.  Delete the browser cache.\n-   **Problem: My Identity Agent already installed - why do I get the Captive Portal?**\n    \n    > Make sure your Identity Agent is running, connected and authenticated.  \n    > When you use a mainstream browser with Kerberos single sign-on enabled in SmartConsole, the captive portal redirects to the destination without the need for user interaction.\n    \n\n## Troubleshooting Identity Agent\n\n-   **Problem: Identity Agent fails to connect to server while Umbrella is closed.**\n    \n    To resolve this issue, follow the below steps and stop when one of them works:\n    \n    1.  Configure the gateway manually.\n    2.  Check the gateway Discovery configuration.\n    3.  If the problem is only for this computer, check DNS settings and network configuration.\n    4.  Reset Identity Agent settings by double-clicking on the Umbrella, go to Advanced, click 'Reset to defaults' and retry to connect.\n    5.  Restart the service by going to command line with computer admin credentials and running the _sc stop madservice_ command and then _sc start madservice_\n    6.  If it does not work for any user, make sure that the interface that the gateway uses to communicate with client is an 'internal interface', or change this settings (Identity Awareness gateway properties -> Identity Agent Settings).\n-   **Problem: Kerberos does not work for all users.**\n    \n    1.  Check the date and time on the server.\n    2.  Check if gateway Kerberos user is locked out.\n    3.  See the errors in SmartView Tracker, they can be informative.\n    4.  Reset the user password on the Domain Controller. Verify that account is not disabled.\n-   **Problem: Kerberos does not work for a single user.**\n    \n    1.  Check if user's time and date are synchronized.\n    2.  Check if user is locked out.\n    3.  See the errors in SmartView Tracker, they can be informative.\n    4.  Check if user got a Kerberos ticket.\n    5.  If you recently changed the gateway Kerberos user password, log out and than log in.\n-   **Problem: User is able to receive access when using the Identity Agent, but not via AD Query.**\n    \n    1.  Make sure that AD Query is properly configured (by using _adlog_ utility).\n    2.  Check if the user exists in the AD Query database (by using the _adlog_ utility).\n    3.  Check if communication has been established between the Identity Server and Identity Gateway (using the _pdp_ and _pep_ commands).\n    4.  If the user exists in the AD Query database but does not exist in the Identity Gateway database:\n        1.  Establish sync between the Identity Server and Identity Gateway.\n        2.  Verify that user appears in the Identity Gateway (by running _pep show user all_ command)\n-   **Problem: Users identity is not propagated to the Identity Gateway.**\n    \n    1.  Check that the daemons _pepd_ and _pdpd_ are up and running.\n    2.  Verify that the Identity Server is configured to connect to the Identity Gateway (run: \"`pdp c p`\" on Identity Gateway).\n    3.  Verify that communicate is possible to the Main IP address of the remote gateway in both directions (ping from one gateway to the other gateway Main IP address).  \n        If communication is not possible via the Main IP address, use [sk60701](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk60701) to change the IP address used for the communication channel.\n    4.  Another possible reason is, when PEP is a cluster and it establishes the PEP connections with the PDP from the physical IP addresses of the cluster members, rather than from the Cluster VIP address.  \n        Follow to [sk63264](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk63264).\n\n## Troubleshooting X-Forward-For (XFF) HTTP header configuration\n\n-   **Problem: users/machine behind proxy are not enforced correctly.**\n    1.  Verify that the XFF configuration is enabled on relevant Gateway object:\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk86441/XFF1707310505.png)\n        \n    2.  Verify that XFF configuration is enabled on the relevant layer:  \n        In SmartConsole, go to Policy -> Edit Policy -> Edit Layer -> Advanced -> Proxy Configuration\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk86441/XFF-21707310503.jpg)\n        \n\n## Troubleshooting Identity Collector\n\n-   **Problem: Not all users are detected**  \n    \n    > Identity Collector is based on security events which are logged on the Domain Controller servers (events 4624, 4768, 4769 and 4770).  \n    > Make sure the Domain Controller which the users is connected to is monitored by Identity Collector (can be found by running `echo %LOGONSERVER%` on the user PC).\n    \n-   **Problem: Download link of Identity Collector in SmartConsole does not work.**  \n    \n    > To activate the link, install policy on this gateway with \"Identity Collector\" enabled.\n    \n-   **Problem: Identity Collector fails to connect / add / edit a Security Gateway**  \n    \n    > Refer to [sk113021](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk113021)\n    \n-   **Problem: After creating a syslog parser, no events are received in Identity Collector.**\n    1.  Increase the Identity Collector debug severity to “All” (See the [Identity Awareness Clients Administration Guide](https://sc1.checkpoint.com/documents/Identity_Awareness_Clients_Admin_Guide/Default.htm) > Identity Collector - **Debug** ) \n    2.  In Identity Collector debug output, look for line:   \n        `NAC::IDCOLLECTOR::SyslogEventQuery::getEvents: recieved This buff`\n    3.  In this log, the received buffer which received over syslog is presented.  \n        Configure the parsing according to it.\n\n-   [sk44178 - Identity Logging - FAQ](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk44178)\n-   [sk60301 - Identity Awareness AD Query](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk60301)\n-   [sk44261 - Understanding the behavior of querying multiple LDAP servers](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk44261)\n-   [sk113747 - How to troubleshoot Identity Awareness AD Query connectivity issues](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk113747)\n-   [sk88520 - Best Practices - Identity Awareness Large Scale Deployment](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk88520)\n-   [sk98561 - Ports Used by Identity Awareness](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98561)\n-   [sk102986 - How to debug Captive Portal issues on Identity Awareness gateway](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk102986)\n-   [sk63264 - In a Cluster environment, Identity propagation does not occur between an Identity Server (PDP) and Identity Gateway (PEP)](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk63264)\n\n## Article Properties\n\nOriginatorStella Shteinbuk\n\nTechnical ResourceRoyi Priov\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2012-10-16\n\nLast Modified2024-10-26\n\nEditorRobert Henderson\n\nLast ApproverDaniel Epstein\n\n## Comments\n\n#### Internal only\n\nNote: This SK is relevant also for R82","language":"md","time":"14 days ago","created":"2025-05-06T22:55:58.513Z","annotations":[],"updated":"2025-05-06T22:57:25.435Z"},{"title":"ProductSmartConsole: Configuration and Debug","id":"34451907-9bb0-43be-8168-51955ec3c366","type":"TEXT","raw":"ProductSmartConsole\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nLast Modified2024-10-27\n\n## Solution\n\n**Overview  |  Configuration and Debug  |  Troubleshooting** \n\n## Overview\n\nFrom R80.10, the Logs view replaces the SmartView Tracker and SmartLog SmartConsole GUI clients.\n\nSmartLog is a part of the SmartConsole suite of utilities and is automatically installed with no additional configuration.   \nSmartLog reads and indexes logs generated by Check Point and OPSEC products. You can use this data to:\n\n-   Detect and monitor security-related events. For example: alerts, rejected connections, and failed authentication attempts can indicate intrusion attempts.\n-   Collect data on problematic issues. For example: a client is authorized to create a connection, but cannot connect. SmartLog shows that the Rule Base incorrectly blocks the client connection attempts\n-   Analyze network traffic patterns. For example: find out how many HTTP services were used during peak activity\n\nWhat sets SmartLog apart from other log utilities is its power, ease of use, and speed. The SmartLog Index Server gets log files from many log servers and indexes them for rapid data extraction. SmartLog includes a powerful query language that lets you create your own queries in minutes.\n\nThe product contains server and GUI. The server is used to index the logs and answer the queries received from the GUI. The indexes are kept in the server directory. Each index is pointing to the original log files.\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk92769/config.png)\n\n##   \nConfiguration and Debug\n\nBy default SmartLog is installed on every Log server and Security Management Server. It is also installed on the Multi-Domain Server (\"MDS\") and Domain Management Servers / Domain Log Servers in a Multi-Domain Management environment.  \nIn Multi-Domain Management, SmartLog has the ability to perform distributed query, namely, a single query on MDS level that collects responses from the relevant Domain Management Servers / Domain Log Servers.  \n**Note**  - You must enable SmartLog on each Domain Management Server / Domain Log Server.\n\nThere is an option to load logs from older version Log servers using LEA. [See sk35288 - How to enable SmartEvent to read logs from external Security Management Server / externally managed Log Server using LEA](https://support.checkpoint.com/results/sk/sk35288).\n\n  \nSmartLog parameters are located in two files:\n\n-   _$SMARTLOGDIR/conf/smartlog\\_settings.conf_ (replaced during upgrades)\n-   _$SMARTLOGDIR/smartlog\\_settings.txt_\n\n  \nA `smartlogstop;smartlogstart` is required after every change.\n\n  \nTo configure the **minimum available disk space** value, edit the _smartlog\\_settings.txt_ file and change the _:min\\_disk\\_space (space)_ parameter, where _space_ is the minimum available disk space in MB. \n\nTo change the **minimum amount of RAM required** by changing :_min\\_required\\_ram\\_mb_ (x) parameter, where _x_ can be any number from 1 to 1024.\n\n  \nSmartLog displays logs from the last 3 days. To change the **time frame**, change the   _num\\_days\\_restriction\\_for\\_fetch\\_all (3)_ parameter\n\nExample of the _smartlog\\_settings.txt_ file\n\n```\n:num_days_restriction_for_fetch_all (3)\n        :num_days_restriction_for_fetch_all_integrated (0)\n        :min_required_cores (1)\n        :min_required_disk_space_gb (1)   \n        :min_required_ram_mb (9)         \n        :override_proc_priority (19)\n        :data (\"/opt/CPSmartLog-R75.40/data\")\n        :server_port (\"127.0.0.1:18242\")     \n        :time_restriction_for_fetch_all (1342600026)\n        :time_restriction_for_fetch_all_disp (\"18/Apr/2013 11:27:06\")\n```\n\n### Index files\n\n_Index files_ are saved in the _$RTDIR/log\\_indexes_ directory - for Security Management server and global Multi-Domain Management. There are no indexes per Domain Management Server / Domain.\n\nTo remove the indexes, delete all _Index\\*_ files and directories from these locations.\n\nExample: \n\n_#mdsenv CMA\\_NAME\\_SmartLog_  \n_#smartlogstop  \n#cd /var/opt/CPmds-R7xx/customers/CMA\\_NAME\\_SmartLog/CPSmartLog-R7xx/data/  \n#rm -rf Index\\*  \n#smartlogstart_\n\n**Debug**SmartLog debug is enabled by default on the Security Management server.  \nThe _smartlog\\_server.exe_ process writes debug messages to $_SMARTLOGDIR/log/smartlog\\_server.elg_ file.\n\n##   \nTroubleshooting\n\n-   **Problem**: After installing SmartLog, the only logs that are indexed are logs from the point when SmartLog was installed. See [sk77640](http://supportcontent.checkpoint.com/solutions?id=sk77640)  \n    [  \n    ](http://supportcontent.checkpoint.com/solutions?id=sk77640)\n-   **Problem**: \"The system doesn't meet the minimal hardware requirements for SmartLog\" error when opening SmartLog GUI. See [sk77420](http://supportcontent.checkpoint.com/solutions?id=sk77420)  \n    [  \n    ](http://supportcontent.checkpoint.com/solutions?id=sk77420)\n-   **Problem**: SmartLog indexes fill up the disk space. See [sk73640](http://supportcontent.checkpoint.com/solutions?id=sk73640)[](http://supportcontent.checkpoint.com/solutions?id=sk73640)\n-   **Problem**: SmartLog displays some fields with asterisks. See [sk73400](http://supportcontent.checkpoint.com/solutions?id=sk73400)  \n    [  \n    ](http://supportcontent.checkpoint.com/solutions?id=sk73400)\n\n## Article Properties\n\nOriginatorStella Shteinbuk\n\nTechnical ResourceNitzan Massad\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2013-04-29\n\nLast Modified2024-10-27\n\nEditorRachel Teitz\n\nLast ApproverDaniel Epstein\n\n## Comments\n\n#### Internal only\n\nFrom: Nitzan Massad <nitzanm@checkpoint.com>   \nSent: Sunday, December 4, 2022 10:41 AM  \nTo: Rachel Teitz <rachelt@checkpoint.com>  \nSubject: RE: Update sk92769 and sk93970\n\nWe didn't change a thing in does two products. So no need to update the content. \n\nThanks,  \nNitzan Massad\n\nFrom: Rachel Teitz   \nSent: Sunday, December 4, 2022 10:38  \nTo: Nitzan Massad  \nSubject: RE: Update sk92769 and sk93970\n\nHi Nitzan,\n\nIn each SK, does the content need to be updated, or is it enough just to add R81.20 to the listed version?","language":"md","time":"14 days ago","created":"2025-05-06T22:56:01.082Z","annotations":[],"updated":"2025-05-06T22:57:44.123Z"},{"title":"Gaia Process Manager and Daemons","id":"f10172fe-ce26-4d81-bf2f-58ada1337f11","type":"TEXT","raw":"**Important** - Unless stated otherwise, you must run the commands in the Expert mode.\n\nAll Gaia processes and daemons run by default, other than _snmpd_ and _dhcpd_.\n\n<table id=\"Filter_1Table\"><tbody><tr data-darkreader-inline-bgcolor=\"\"><td>Daemon</td><td>Child daemon</td><td>Section</td><td>Information</td></tr><tr><td rowspan=\"70\"><p>pm</p></td><td rowspan=\"5\">-</td><td>Description</td><td>Gaia OS Process Manager (<em>/bin/pm</em>). Controls other processes and daemons.</td></tr><tr><td>Path</td><td><em>/bin/pm</em></td></tr><tr><td>Log File</td><td><em>/var/log/messages</em></td></tr><tr><td>To Stop</td><td>none</td></tr><tr><td>To Start</td><td>none</td></tr><tr><td rowspan=\"6\"><p>confd</p></td><td>Description</td><td>Database and configuration.</td></tr><tr><td>Path</td><td><em>/bin/confd</em></td></tr><tr><td>Important Note</td><td><p>Maintenance window is required to restart this daemon:</p><ul><li>When <em>confd</em> daemon is starting, by design, it restarts any currently running <em>routed</em> daemons (by sending a TERM signal). It is done to avoid possible issues in Gaia Clish (e.g., returning invalid results for routing-related commands like \"<code>show route</code>\").</li><li>Since <em>routed</em> daemon is responsible for all the routing in Gaia OS, short traffic outage will occur while <em>routed</em> daemon is being restarted.</li><li>Since <em>routed</em> daemon is a Critical Device in Check Point cluster (since R76), cluster fail-over might occur while <em>routed</em> daemon is being restarted (refer to <a href=\"https://support.checkpoint.com/results/sk/sk92878\" target=\"_blank\" rel=\"noopener\">sk92878</a>).</li></ul></td></tr><tr><td>Log File</td><td><em>/var/log/messages</em></td></tr><tr><td>To Stop</td><td><em>tellpm process:confd</em></td></tr><tr><td>To Start</td><td><em>tellpm process:confd t</em></td></tr><tr><td rowspan=\"5\"><p>searchd</p></td><td>Description</td><td>Search indexing daemon.</td></tr><tr><td>Log File</td><td><em>/var/log/messages</em></td></tr><tr><td>Path</td><td><em>/bin/searchd</em></td></tr><tr><td>To Stop</td><td><em>tellpm process:searchd</em></td></tr><tr><td>To Start</td><td><em>tellpm process:searchd t</em></td></tr><tr><td rowspan=\"5\"><p>clishd</p></td><td>Description</td><td>Gaia Clish CLI interface process - general information for all Clish sessions.</td></tr><tr><td>Path</td><td><em>/bin/clishd</em></td></tr><tr><td>Log File</td><td><em>/var/log/messages</em></td></tr><tr><td>To Stop</td><td><em>tellpm process:clishd</em></td></tr><tr><td>To Start</td><td><em>tellpm process:clishd t</em></td></tr><tr><td rowspan=\"6\"><p>clish</p></td><td>Description</td><td>Gaia Clish CLI interface process - Clish process per session.</td></tr><tr><td>Path</td><td><em>/bin/clish</em></td></tr><tr><td>Log File</td><td><em>/var/log/messages</em></td></tr><tr><td>To Stop</td><td><em>tellpm process:clish</em></td></tr><tr><td>To Start</td><td><em>tellpm process:clish t</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk106938\" target=\"_blank\" rel=\"noopener\">sk106938</a></td></tr><tr><td rowspan=\"8\"><p>routed</p></td><td>Description</td><td>Routing daemon.</td></tr><tr><td>Path</td><td><em>/bin/routed</em></td></tr><tr><td>Important Note</td><td><p>Maintenance window is required to restart this daemon:</p><ul><li>Since <em>routed</em> daemon is responsible for all the routing in Gaia OS, short traffic outage will occur while <em>routed</em> daemon is being restarted.</li><li>Since <em>routed</em> daemon is a Critical Device in Check Point cluster (since R76), cluster fail-over might occur while <em>routed</em> daemon is being restarted (refer to <a href=\"https://support.checkpoint.com/results/sk/sk92878\" target=\"_blank\" rel=\"noopener\">sk92878</a>).</li></ul></td></tr><tr><td>Log File</td><td><em>/var/log/routed.log<br>/var/log/routed_messages</em></td></tr><tr><td>Configuration File</td><td><em>/etc/routed.conf</em></td></tr><tr><td>To Stop</td><td><em>tellpm process:routed</em></td></tr><tr><td>To Start</td><td><em>tellpm process:routed t</em></td></tr><tr><td>Debug</td><td>Refer to:<br><a href=\"https://support.checkpoint.com/results/sk/sk84520\" target=\"_blank\" rel=\"noopener\">sk84520 - How to debug OSPF and RouteD daemon on Gaia</a>,<br><a href=\"https://support.checkpoint.com/results/sk/sk101399\" target=\"_blank\" rel=\"noopener\">sk101399 - How to debug BGP and RouteD daemon on Gaia</a>,<br><a href=\"https://support.checkpoint.com/results/sk/sk92598\" target=\"_blank\" rel=\"noopener\">sk92598 - How to debug PIM and Multicast on Gaia</a></td></tr><tr><td rowspan=\"7\"><p>httpd2</p></td><td>Description</td><td>Web server daemon (Gaia Portal).</td></tr><tr><td>Path</td><td><em>/web/cpshared/web/Apache/2.2.0/bin/httpd2</em></td></tr><tr><td>Log File</td><td><ul><li><em>/var/log/httpd2_error_log</em></li><li><em>/var/log/httpd2_access_log</em></li></ul></td></tr><tr><td>Configuration File</td><td><em>/web/conf/httpd2.conf</em></td></tr><tr><td>To Stop</td><td><em>tellpm process:httpd2</em></td></tr><tr><td>To Start</td><td><em>tellpm process:httpd2 t</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk84561\" target=\"_blank\" rel=\"noopener\">sk84561</a></td></tr><tr><td rowspan=\"5\"><p>monitord</p></td><td>Description</td><td>Hardware monitoring daemon.</td></tr><tr><td>Path</td><td><em>/bin/monitord</em></td></tr><tr><td>Log File</td><td><em>/var/log/messages</em></td></tr><tr><td>To Stop</td><td><em>tellpm process:monitord</em></td></tr><tr><td>To Start</td><td><em>tellpm process:monitord t</em></td></tr><tr><td rowspan=\"5\"><p>rconfd</p></td><td>Description</td><td>Provisioning daemon.</td></tr><tr><td>Path</td><td><em>/bin/rconfd</em></td></tr><tr><td>Log File</td><td><em>/var/log/messages</em></td></tr><tr><td>To Stop</td><td><em>tellpm process:rconfd</em></td></tr><tr><td>To Start</td><td><em>tellpm process:rconfd t</em></td></tr><tr><td rowspan=\"5\"><p>cloningd</p></td><td>Description</td><td>Cloning Groups daemon.</td></tr><tr><td>Path</td><td><em>/bin/cloningd</em></td></tr><tr><td>Log File</td><td><em>/var/log/messages</em></td></tr><tr><td>To Stop</td><td><em>tellpm process:cloningd</em></td></tr><tr><td>To Start</td><td><em>tellpm process:cloningd t</em></td></tr><tr><td rowspan=\"6\"><p>dhcpd</p></td><td>Description</td><td>DHCP server daemon.</td></tr><tr><td>Path</td><td><em>/usr/sbin/dhcpd</em></td></tr><tr><td>Log File</td><td><em>/var/log/messages</em></td></tr><tr><td>Configuration File</td><td><em><a href=\"http://linux.die.net/man/5/dhcpd.conf\" target=\"_blank\" rel=\"noopener\">/etc/dhcpd.conf</a></em></td></tr><tr><td>To Stop</td><td><ul><li>In Gaia Clish:<br><em>set dhcp server disable</em></li><li>In Gaia Portal:<br>\"Network Management\" section - \"DHCP Server\" pane</li></ul></td></tr><tr><td>To Start</td><td><ul><li>In Gaia Clish:<br><em></em><em>set dhcp server enable</em></li><li>In Gaia Portal:<br>\"Network Management\" section - \"DHCP Server\" pane</li></ul></td></tr><tr><td rowspan=\"7\"><p>snmpd</p></td><td>Description</td><td>SNMP (Linux) daemon.</td></tr><tr><td>Path</td><td><em>/usr/sbin/snmpd</em></td></tr><tr><td>Log File</td><td><em>/var/log/messages</em></td></tr><tr><td>Configuration File</td><td><em><a href=\"http://linux.die.net/man/5/snmpd.conf\" target=\"_blank\" rel=\"noopener\">/etc/snmp/snmpd.conf</a></em></td></tr><tr><td>To Stop</td><td><ul><li>In Gaia Clish:<br><em>set snmp agent off</em></li><li>In Gaia Portal:\"System Management\" section - \"SNMP\" pane</li></ul></td></tr><tr><td>To Start</td><td><ul><li>In Gaia Clish:<br><em>set snmp agent on</em></li><li>In Gaia Portal:<br>\"System Management\" section - \"SNMP\" pane</li></ul></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk56783\" target=\"_blank\" rel=\"noopener\">sk56783</a></td></tr><tr><td rowspan=\"5\"><p>xpand</p></td><td rowspan=\"5\">-</td><td>Description</td><td>Configuration daemon that processes and validates all user configuration requests, updates the system configuration database, and calls other utilities to carry out the request.</td></tr><tr><td>Path</td><td><em>/bin/confd</em></td></tr><tr><td>Log File</td><td><em>/var/log/messages</em></td></tr><tr><td>To Stop</td><td>None</td></tr><tr><td>To Start</td><td>None</td></tr><tr><td rowspan=\"7\"><p>sshd</p></td><td rowspan=\"7\">-</td><td>Description</td><td>SSH daemon.</td></tr><tr><td>Path</td><td><em>/usr/sbin/sshd</em></td></tr><tr><td>Log File</td><td><ul><li><em>/var/log/secure</em></li><li><em>/var/log/auth/</em></li><li><em>/var/log/messages</em></li></ul></td></tr><tr><td>Configuration File</td><td><ul><li>R80.40 Jumbo Hotfix Take 83 and higher versions:<ol><li>Back up and edit:<br><code>/etc/ssh/templates/sshd_config.templ</code></li><li>Run :<br><code>/bin/sshd_template_xlate &lt; /config/active</code></li></ol></li><li>In lower versions:<br><em><a href=\"http://linux.die.net/man/5/sshd_config\" target=\"_blank\" rel=\"noopener\">/etc/ssh/sshd_config</a></em></li></ul></td></tr><tr><td>To Stop</td><td><em>service sshd stop</em></td></tr><tr><td>To Start</td><td><em>service sshd start</em></td></tr><tr><td>Debug</td><td><ol><li>Edit the applicable \"sshd_config\" file (see above):<br><ol type=\"A\"><li>Change the \"<em>LogLevel</em>\" line:<br>from:<br><em>#LogLevel INFO</em><br>to:<br><em>LogLevel DEBUG3</em></li><li>Save the changes in the file</li><li>Load the updated configuration (in R80.40 Jumbo Hotfix Take 83 and higher versions):<br><code>/bin/sshd_template_xlate &lt; /config/active</code></li></ol></li><li>Start SSHD under debug to run in background (copy the PID):<br><em>/usr/sbin/sshd -ddd 1&gt;&gt; /var/log/sshd.debug.txt 2&gt;&gt; /var/log/sshd.debug.txt &amp;</em></li><li>Replicate the issue (connect over SSH).</li><li>Stop the SSHD:<br><em>kill -TERM &lt;PID&gt;</em><br><em>kill -KILL &lt;PID&gt;</em></li><li>Revert the changes in the applicable \"sshd_config\" file</li><li>Load the updated configuration (in R80.40 Jumbo Hotfix Take 83 and higher versions):<br><code>/bin/sshd_template_xlate &lt; /config/active</code></li><li>Analyze:<br><em>/var/log/sshd.debug.txt</em></li></ol></td></tr><tr><td rowspan=\"7\"><p>syslogd</p></td><td rowspan=\"7\">-</td><td>Description</td><td>Syslog (Linux) daemon.</td></tr><tr><td>Path</td><td><em>/sbin/syslogd</em></td></tr><tr><td>Log File</td><td><ul><li><em><em>/var/log/messages</em></em></li><li><em><em>/var/log/dmesg</em></em></li></ul></td></tr><tr><td>Configuration File</td><td><ul><li><em>/etc/syslog.conf</em></li><li><em>/var/run/syslog.conf</em></li></ul></td></tr><tr><td>To Stop</td><td><em>service syslog stop</em></td></tr><tr><td>To Start</td><td><em>service syslog start</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk108421\" target=\"_blank\" rel=\"noopener\">sk108421</a></td></tr><tr><td rowspan=\"8\"><p>DAService</p></td><td rowspan=\"8\">-</td><td>Description</td><td>Check Point Upgrade Service Engine (CPUSE) - former 'Gaia Software Updates' service (refer to <a href=\"https://support.checkpoint.com/results/sk/sk92449\" target=\"_blank\" rel=\"noopener\">sk92449</a>).</td></tr><tr><td>Path</td><td><em>$DADIR/bin/DAService</em></td></tr><tr><td>Log File</td><td><ul><li><em>/opt/CPInstLog/DeploymentAgent.log</em></li><li><em>/opt/CPInstLog/DA_UI.log</em></li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>DASERVICE</em>\"<br>(command is \"<em>$DADIR/bin/DAService_script</em>\" - this is a watchdog script that starts the <em>$DADIR/bin/DAService</em>, if it is not running).</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|DASERVICE\"</em></td></tr><tr><td>To Stop</td><td><ol><li><em>$DADIR/bin/dastop</em></li><li><em>dbget installer:stop</em></li></ol></td></tr><tr><td>To Start</td><td><ol><li><em>$DADIR/bin/dastart</em></li><li><em>dbget installer:start</em></li></ol></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk92449\" target=\"_blank\" rel=\"noopener\">sk92449</a>:</p><ol><li>Create the configuration file:<br><em>touch $DADIR/bin/DAconf</em></li><li>Add the following line (case-sensitive; spaces are not allowed):<br><em>PING_TRACE=1</em></li><li>Save the changes</li><li>Re-load the new configuration:<br><em>DAClient conf</em></li><li>As soon as possible:<br><ol type=\"i\"><li>Replicate the issue</li><li>Delete the <em>$DADIR/bin/DAconf</em> file</li><li>Re-load the configuration with <em>DAClient conf</em> command</li></ol></li><li>Analyze:<br><em>/opt/CPInstLog/DeploymentAgent.log</em></li></ol></td></tr><tr><td rowspan=\"7\"><p>AutoUpdater</p></td><td rowspan=\"7\">-</td><td>Description</td><td><p>AutoUpdater - responsible for automatic updates in:</p><ul><li>R80.40 and higher</li><li>R80.30 Jumbo Take 71 (and higher)</li><li>R80.20 Jumbo Take 117 (and higher)</li><li>R80.10 Jumbo Take 245 (and higher)</li></ul></td></tr><tr><td>Path</td><td><em>$AUTOUPDATERDIR/latest/bin/AutoUpdater</em></td></tr><tr><td>Log File</td><td><em>$AUTOUPDATERDIR/AutoUpdater.log</em></td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|AUTOUPDATER\"</em></td></tr><tr><td>To Stop</td><td><em>AutoUpdaterWDUnReg.sh ; autoupdatercli stop</em></td></tr><tr><td>To Start</td><td><em>AutoUpdaterWDReg.sh</em></td></tr><tr><td>Debug</td><td><em>autoupdatercli debug DEBUG</em></td></tr></tbody></table>\n\n**Note: Other Gaia OS daemons can be stopped in Expert mode, but it is not recommended.**\n\n<table id=\"Filter_2Table\"><tbody><tr data-darkreader-inline-bgcolor=\"\"><td>Daemon</td><td>Section</td><td>Information</td></tr><tr><td rowspan=\"6\"><p>cpwd</p></td><td>Description</td><td>WatchDog is a process that launches and monitors critical processes such as Check Point daemons on the local machine, and attempts to restart them if they fail.<br>Among the processes monitored by Watchdog are <em>cpd</em>, <em>fwd</em> and <em>fwm</em>.<br>Watchdog is controlled by the <em>cpwd_admin</em> utility.<br>To learn how to start and stop various daemons, run <em>cpwd_admin</em> command.</td></tr><tr><td>Path</td><td><em>$CPDIR/bin/cpwd</em><br><em>%CPDIR%\\bin\\cpwd</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$CPDIR/log/cpwd.elg</em><br><em>%CPDIR%\\log\\cpwd.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>To Stop</td><td><em>cpwd_admin kill</em><br>or<br><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>$CPDIR/bin/cpwd &gt;&amp; /dev/null</em><br>or<br><em>cpstart</em></td></tr><tr><td>Debug</td><td>None</td></tr><tr><td rowspan=\"8\"><p>cpd</p></td><td>Description</td><td><ul><li>Port 18191 - Generic process (add-ons container) for many Check Point services, such as installing and fetching policy, and online updates</li><li>Port 18211 - SIC push certificate (from Internal CA)</li><li>Inter-process communication between Check Point daemons (starting in R82, this task was moved to the MSGD daemon)</li></ul></td></tr><tr><td>Path</td><td><em>$CPDIR/bin/cpd</em><br><em>%CPDIR%\\bin\\cpd</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$CPDIR/log/cpd.elg</em><br><em>%CPDIR%\\log\\cpd.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CPD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CPD\"</em></td></tr><tr><td>To Stop</td><td><ul><li><p>Management Server / Security Gateway:</p><p><em>cpwd_admin stop -name CPD -path \"$CPDIR/bin/cpd_admin\" -command \"cpd_admin stop\"</em><br>or<br><em>cpstop</em></p></li><li><p>Domain Management Server on a Multi-Domain Security Management Server:</p><p><em>mdsstop_customer &lt;IP Address of Domain Management Server&gt;</em></p></li><li><p>VSX Gateway:</p><em>[Expert@HostName:0]# vsenv &lt;VSID&gt;</em><br><em>[Expert@HostName:&lt;VSID&gt;]# cpwd_admin stop -name CPD -path \"$CPDIR/bin/cpd_admin\" -command \"cpd_admin stop\" -ctx &lt;VSID&gt; -env inherit</em><br>or<br><em>[Expert@HostName:0]# cpstop</em></li></ul></td></tr><tr><td>To Start</td><td><ul><li><p>Management Server / Security Gateway:</p><p><em>cpwd_admin start -name CPD -path \"$CPDIR/bin/cpd\" -command \"cpd\"</em><br>or<br><em>cpstart</em></p></li><li><p>Domain Management Server on a Multi-Domain Security Management Server:</p><p><em>mdsstart_customer &lt;IP Address of Domain Management Server&gt;</em></p></li><li><p>VSX Gateway:</p><em>[Expert@HostName:0]# vsenv &lt;VSID&gt;</em><br><em>[Expert@HostName:&lt;VSID&gt;]# cpwd_admin start -name CPD -path \"$CPDIR/bin/cpd\" -command \"cpd\" -ctx &lt;VSID&gt; -env inherit</em><br>or<br><em>[Expert@HostName:0]# cpstart</em></li></ul></td></tr><tr><td>Debug</td><td>\"<em>cpd_admin debug</em>\" - refer to <a href=\"https://support.checkpoint.com/results/sk/sk86320\" target=\"_blank\" rel=\"noopener\">sk86320</a></td></tr><tr><td rowspan=\"8\"><p>msgd</p></td><td>Description</td><td><p>This process exists starting from the R82 version.</p><p>Dedicated daemon for the Check Point inter-process communication&nbsp;(the processing of inter-process communication was moved from the CPD daemon to the MSGD daemon).</p><p>This daemon listens on 127.0.0.1:8989.</p><p><strong>Important</strong> - If this daemon is stopped, then all Check Point inter-process communication fails. As a result, multiple tasks would fail - policy installation, license installation, and so on.</p></td></tr><tr><td>Path</td><td><em>$CPDIR/bin/msgd</em></td></tr><tr><td>Log File</td><td><em>$CPDIR/log/msgd.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"MSGD\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|MSGD\"</em></td></tr><tr><td>To Stop</td><td><ul><li><p>Management Server / Security Gateway:</p><p><em>cpwd_admin stop -name MSGD -path ${CPDIR}/bin/msgd -command \"msg_admin stop\"</em><br>or<br><em>msg_admin stop</em></p></li><li><p>Domain Management Server on a Multi-Domain Security Management Server:</p><p><em>mdsstop_customer &lt;IP Address of Domain Management Server&gt;</em></p></li><li><p>VSX Gateway:</p><em>[Expert@HostName:0]# vsenv &lt;VSID&gt;</em><br><em>[Expert@HostName:&lt;VSID&gt;]# cpwd_admin stop -name MSGD -path ${CPDIR}/bin/msgd -command \"msg_admin stop\" -ctx &lt;VSID&nbsp;-env inherit</em><br>or<br><em>[Expert@HostName:0]# cpstop</em></li></ul></td></tr><tr><td>To Start</td><td><ul><li><p>Management Server / Security Gateway:</p><p><em>cpd\"cpwd_admin start -name MSGD -path ${CPDIR}/bin/msgd -command msgd</em><br>or<br><em>cpstart</em></p></li><li><p>Domain Management Server on a Multi-Domain Security Management Server:</p><p><em>mdsstart_customer &lt;IP Address of Domain Management Server&gt;</em></p></li><li><p>VSX Gateway:</p><em>[Expert@HostName:0]# vsenv &lt;VSID&gt;</em><br><em>[Expert@HostName:&lt;VSID&gt;]# cpwd_admin start -name MSGD -path ${CPDIR}/bin/msgd -command msgd -ctx &lt;VSID&gt;&nbsp;-env inherit</em><br>or<br><em>[Expert@HostName:0]# cpstart</em></li></ul></td></tr><tr><td>Debug</td><td>Run: <em>msg_admin -h<br>msg_admin debug on &lt;Environment Setting&gt;</em><br><em>msg_admin debug off</em></td></tr><tr><td rowspan=\"8\"><p>fwd</p></td><td>Description</td><td><ul><li>On a Security Gateway - Sending the Security Logs to a Management Server / Log Server</li><li>On a Security Gateway -&nbsp;Spawning child processes (e.g., <em>vpnd</em>)</li><li>On a Security Gateway -&nbsp;Full Synchronization between ClusterXL members in versions R80.40 and lower.<br>(To perform a Full Sync with a peer cluster member, the FWD daemon on a cluster member connects to the TCP port 256 on the peer cluster member. In versions R81 and higher, the CXLD daemon on a cluster member connects to the TCP port 263.)</li><li>On a Security Gateway - Policy installation (notifies applicable daemons, e.g., Security Servers)</li><li>On a Security Gateway -&nbsp;IPS packet capture</li><li>On a Security Gateway - Update of the Application Control and URL Filtering database</li><li>On a Security Gateway - Handling connections from a Management Server to instantly block suspicious connections that are not restricted by the currently enforced security policy using the Suspicious Activity Rules feature in SmartView Monitor ('Tools' menu)</li><li>On a Security Gateway - Download of VPN Topology and of Public Key to SecureClient / SecuRemote clients</li><li>On a Security Gateway - Handling connections the OPSEC Suspicious Activity Monitor (SAM) connections from GX / LTE SAM clients</li><li>On a Management Server - Handling connections from a SmartEvent Server</li><li>On a Management Server - Handling connections for exporting FireWall logs using OPSEC Log Export API (LEA) products</li><li>On a Management Server - Handling FireWall logs sent by OPSEC products (ELA)</li><li>On a Management Server - Exchange of CA-keys and DH-keys between Management Servers (SKIP, FWZ (4.x))</li></ul></td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwd</em><br><em>%FWDIR%\\bin\\fwd</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/fwd.elg</em><br><em>%FWDIR%\\log\\fwd.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td><ul><li>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>FWD</em>\".</li><li>The \"<em>top</em>\" and \"<em>ps</em>\" commands might also show \"<em>fw</em>\" process and/or \"<em>fw_full</em>\" process, which are just wrappers for the \"<em>fwd</em>\" process.</li></ul></td></tr><tr><td>To See the Current Status</td><td><p><em>cpwd_admin list | grep -E \"APP|FWD\"</em></p></td></tr><tr><td>To Stop</td><td><ul><li><p>Management Server / Security Gateway:</p><p><em>cpwd_admin stop -name FWD -path \"$FWDIR/bin/fw\" -command \"fw kill fwd\"</em><br>or<br><em>cpstop</em></p></li><li><p>Domain Management Server on a Multi-Domain Security Management Server:</p><p><em>mdsstop_customer &lt;IP Address of Domain Management Server&gt;</em></p></li><li><p>VSX Gateway:</p><em>[Expert@HostName:0]# vsenv &lt;VSID&gt;</em><br><em>[Expert@HostName:&lt;VSID&gt;]# cpwd_admin stop -name FWD -path \"$FWDIR/bin/fw\" -command \"fw kill fwd\" -ctx &lt;VSID&gt; -env inherit</em><br>or<br><em>[Expert@HostName:0]# cpstop</em></li></ul></td></tr><tr><td>To Start</td><td><ul><li><p>Management Server / Security Gateway:</p><p><em>cpwd_admin start -name FWD -path \"$FWDIR/bin/fw\" -command \"fwd\"</em><br>or<br><em>cpstart</em></p></li><li><p>Domain Management Server on a Multi-Domain Security Management Server:</p><p><em>mdsstart_customer &lt;IP Address of Domain Management Server&gt;</em></p></li><li><p>VSX Gateway:</p><em>[Expert@HostName:0]# vsenv &lt;VSID&gt;</em><br><em>[Expert@HostName:&lt;VSID&gt;]# cpwd_admin start -name FWD -path \"$FWDIR/bin/fwd\" -command \"fwd\" -ctx &lt;VSID&gt; -env inherit</em><br>or<br><em>[Expert@HostName:0]# cpstart</em></li></ul></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk86321\" target=\"_blank\" rel=\"noopener\">sk86321</a><ol><li>Start debug:<br><em>fw debug fwd on TDERROR_ALL_ALL=5</em><br><em>fw debug fwd on OPSEC_DEBUG_LEVEL=3</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug fwd off TDERROR_ALL_ALL=0</em><br><em>fw debug fwd off OPSEC_DEBUG_LEVEL=0</em></li><li>Analyze:<br><em>$FWDIR/log/fwd.elg*</em></li></ol></td></tr><tr><td rowspan=\"6\"><p>msgd</p></td><td>Description</td><td><p>This process exists starting from the R82 version.</p><p>This process is responsible for communication between Check Point processes (to see the list of the registered processes, run the \"<em>msg_admin reg</em>\" command).</p></td></tr><tr><td>Path</td><td><em>$CPDIR/bin/msgd</em></td></tr><tr><td>Log File</td><td><em>$CPDIR/log/msgd.elg</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name MSGD -path \"$CPDIR/bin/msg_admin\" -command \"msg_admin stop\"</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name MSGD -path \"$CPDIR/bin/msgd\" -command \"msgd\"</em></td></tr><tr><td>Debug</td><td><ol><li>Start debug:<br><em>msg_admin debug on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>msg_admin debug off</em></li><li>Analyze:<br><em>$CPDIR/log/msgd.elg*</em></li></ol><a href=\"https://support.checkpoint.com/results/sk/sk41793\" target=\"_blank\" rel=\"noopener\"></a></td></tr><tr><td rowspan=\"6\"><p>cprid</p></td><td>Description</td><td>Check Point Remote Installation Daemon - distribution of packages from SmartUpdate to managed Gateways.</td></tr><tr><td>Path</td><td><em>$CPDIR/bin/cprid</em><br><em>%CPDIR%\\bin\\cprid</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$CPDIR/log/cprid.elg</em><br><em>%CPDIR%\\log\\cprid.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>To Stop</td><td><em>$CPDIR/bin/cpridstop</em></td></tr><tr><td>To Start</td><td><em>$CPDIR/bin/cpridstart</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk41793\" target=\"_blank\" rel=\"noopener\">sk41793</a></td></tr><tr><td rowspan=\"6\"><p>cprid_wd</p></td><td>Description</td><td>WatchDog for Check Point Remote Installation Daemon \"<em>cprid</em>\".</td></tr><tr><td>Path</td><td><em>$CPDIR/bin/cprid_wd</em><br><em>%CPDIR%\\bin\\cprid_wd</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$CPDIR/log/cprid_wd.elg</em></td></tr><tr><td>To Stop</td><td><em>$CPDIR/bin/cpridstop</em></td></tr><tr><td>To Start</td><td><em>$CPDIR/bin/cpridstart</em></td></tr><tr><td>Debug</td><td>Standard CSH script debugging (<em>csh -x -v $CPDIR/bin/cprid_wd</em>)</td></tr><tr><td rowspan=\"6\"><p>kissd</p></td><td>Description</td><td>KISS - used for kernel memory management.</td></tr><tr><td>Path</td><td>None - created by kernel code (drv_init)</td></tr><tr><td>Log File</td><td>None</td></tr><tr><td>To Stop</td><td>None</td></tr><tr><td>To Start</td><td>None</td></tr><tr><td>Debug</td><td>None</td></tr></tbody></table>\n\n<table id=\"Filter_3Table\"><tbody><tr data-darkreader-inline-bgcolor=\"\"><td>Daemon</td><td>Section</td><td>Information</td></tr><tr><td id=\"Security Gateway Software Blades and Features - Firewall Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Firewall Blade</td></tr><tr><td rowspan=\"8\"><p>fwd</p></td><td>Description</td><td><ul><li>Logging</li><li>Spawning child processes (e.g., <em>vpnd</em>)</li></ul></td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwd</em><br><em>%FWDIR%\\bin\\fwd</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/fwd.elg</em><br><em>%FWDIR%\\log\\fwd.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td><ul><li>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>FWD</em>\".</li><li>The \"<em>top</em>\" and \"<em>ps</em>\" commands might also show \"<em>fw</em>\" process and/or \"<em>fw_full</em>\" process, which are just wrappers for the \"<em>fwd</em>\" process.</li></ul></td></tr><tr><td>To See the Current Status</td><td><p><em>cpwd_admin list | grep -E \"APP|FWD\"</em></p></td></tr><tr><td>To Stop</td><td><ul><li><p>Security Gateway:</p><em>cpwd_admin stop -name FWD -path \"$FWDIR/bin/fw\" -command \"fw kill fwd\"</em><br>or<br><em>cpstop</em></li><li><p>VSX Gateway:</p><em>[Expert@HostName:0]# vsenv &lt;VSID&gt;</em><br><em>[Expert@HostName:&lt;VSID&gt;]# cpwd_admin stop -name FWD -path \"$FWDIR/bin/fw\" -command \"fw kill fwd\" -ctx &lt;VSID&gt; -env inherit</em><br>or<br><em>[Expert@HostName:0]# cpstop</em></li></ul></td></tr><tr><td>To Start</td><td><ul><li><p>Security Gateway:</p><em>cpwd_admin start -name FWD -path \"$FWDIR/bin/fw\" -command \"fwd\"</em><br>or<br><em>cpstart</em></li><li><p>VSX Gateway:</p><em>[Expert@HostName:0]# vsenv &lt;VSID&gt;</em><br><em>[Expert@HostName:&lt;VSID&gt;]# cpwd_admin start -name FWD -path \"$FWDIR/bin/fwd\" -command \"fwd\" -ctx &lt;VSID&gt; -env inherit</em><br>or<br><em>[Expert@HostName:0]# cpstart</em></li></ul></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk86321\" target=\"_blank\" rel=\"noopener\">sk86321</a><ol><li>Start debug:<br><em>fw debug fwd on TDERROR_ALL_ALL=5</em><br><em>fw debug fwd on OPSEC_DEBUG_LEVEL=3</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug fwd off TDERROR_ALL_ALL=0</em><br><em>fw debug fwd off OPSEC_DEBUG_LEVEL=0</em></li><li>Analyze:<br><em>$FWDIR/log/fwd.elg*</em></li></ol></td></tr><tr><td rowspan=\"7\"><p>uprd</p></td><td>Description</td><td><p>This process exists starting from the R82 version.</p><p>Unified Policy Report Daemon.</p></td></tr><tr><td>Path</td><td><em>$FWDIR/bin/uprd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/uprd.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>UPRD</em>\"</td></tr><tr><td>To See the Current Status</td><td><p><em>cpwd_admin list | grep -E \"APP|UPRD\"</em></p></td></tr><tr><td>To Stop</td><td><em>$CPDIR/bin/cpwd_admin stop -name UPRD</em><br>or<br><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>$CPDIR/bin/cpwd_admin start -name UPRD -path \"$FWDIR/bin/uprd\" -command \"uprd\"</em><br>or<br><em>cpstart</em></td></tr><tr><td id=\"Security Gateway Software Blades and Features - IPSec VPN Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">IPSec VPN Blade</td></tr><tr><td rowspan=\"7\"><p>vpnd</p></td><td>Description</td><td><p>R81.10 and higher:</p><ul><li>The single <em>vpnd</em> daemon handles these VPN connections:<ul><li>All connections from non-IKE Remote Access clients (SSL Network Extender, Capsule VPN).</li><li>Multi-Portal (SSL/TLS) traffic.</li></ul></li></ul><p>R81 and lower:</p><ul><li>The single <em>vpnd</em> daemon handles these VPN connections:<ul><li>IKE (UDP/TCP)</li><li>NAT-T</li><li>Tunnel Test</li><li>Reliable Datagram Protocol (RDP)</li><li>Topology Update for SecureClient</li><li>SSL Network Extender (SNX)</li><li>SSL Network Extender (SNX) Portal</li><li>Remote Access Client configuration</li><li>Visitor Mode</li><li>L2TP</li></ul></li></ul></td></tr><tr><td>Path</td><td>On Gaia OS / SecurePlatform OS / IPSO OS:<br><ul><li><em>$FWDIR/bin/vpn</em></li></ul>R77.30 and lower on Windows OS:<br><ul><li><em>%FWDIR%\\bin\\vpn</em></li></ul></td></tr><tr><td>Log File</td><td><p>R81.20 and higher:</p><ul><li><em>$FWDIR/log/vpnd.elg*</em></li><li><em>$FWDIR/log/vpnd.ikev1trace*</em></li><li><em>$FWDIR/log/vpnd.ikev2trace*</em></li></ul><p>R81.10:</p><ul><li><em>$FWDIR/log/vpnd.elg*</em></li><li><em>$FWDIR/log/legacy_ike.elg*</em></li><li><em>$FWDIR/log/legacy_ikev2.xml*</em></li></ul><p>R81 and R80.40:</p><ul><li><em>$FWDIR/log/vpnd.elg*</em></li><li><em>$FWDIR/log/ike.elg*</em></li><li><em>$FWDIR/log/ikev2.xmll*</em></li></ul><p>R80.30 and lower:</p><ul><li><em>$FWDIR/log/vpnd.elg*</em></li><li><em>$FWDIR/log/ike.elg*</em></li></ul><p>R77.30 and lower on Windows OS:</p><ul><li><em>%FWDIR%\\log\\vpnd.elg</em></li><li><em>%FWDIR%\\log\\ike.elg</em></li></ul></td></tr><tr><td>Notes</td><td><ul><li>This daemon is not monitored by Check Point WatchDog (\"<em>cpwd_admin list</em>\")</li><li>This daemon is spawned by the FWD daemon</li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td>Refer to:<ul><li>For R80.10 and higher versions:<br><a href=\"https://support.checkpoint.com/results/sk/sk180488\" target=\"_blank\" rel=\"noopener\">sk180488</a></li><li>For R77.30 and lower versions:<br><a href=\"https://support.checkpoint.com/results/sk/sk89940\" target=\"_blank\" rel=\"noopener\">sk89940</a></li></ul></td></tr><tr><td rowspan=\"7\"><p>iked</p></td><td>Description</td><td><p>This process exists starting from the R81.10 version.</p><p>R81.20 and higher:</p><ul><li>The multiple <em>iked</em> daemons (<em>iked0</em>, <em>iked1</em>, and so on) handle these VPN connections:<ul><li>All connections from IKE Remote Access clients (for example, Endpoint clients).</li><li>All IKE Site-to-Site connections from peer Security Gateways, and Large Scale VPN (LSV) connections.</li><li>All connections from SmartLSM ROBO gateways.</li><li>All connections from Security Gateways with a Dynamically Assigned IP Address (DAIP).</li></ul></li></ul><p>R81.10:</p><ul><li>The single <em>iked</em> daemon handles these VPN connections:<ul><li>All connections from IKE Remote Access clients (for example, Endpoint clients).</li><li>All IKE Site-to-Site connections from peer Security Gateways, and Large Scale VPN (LSV) connections.</li><li>All connections from SmartLSM ROBO gateways.</li><li>All connections from Security Gateways with a Dynamically Assigned IP Address (DAIP).</li></ul></li></ul></td></tr><tr><td>Path</td><td><em>$FWDIR/bin/ike</em></td></tr><tr><td>Log File</td><td><p>R81.20 and higher:</p><ul><li><em>$FWDIR/log/iked*.elg*</em></li><li><em>$FWDIR/log/iked*.ikev1trace*</em></li><li><em>$FWDIR/log/iked*.ikev2trace*</em></li></ul><p>R81.10:</p><ul><li><em>$FWDIR/log/ike.elg*</em></li><li><em>$FWDIR/log/iked.elg*</em></li><li><em>$FWDIR/log/ikev2.xml*</em></li></ul></td></tr><tr><td>Notes</td><td>This process is <em>not</em> monitored by Check Point WatchDog</td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td>Refer to:<ul><li>For R80.10 and higher versions:<br><a href=\"https://support.checkpoint.com/results/sk/sk180488\" target=\"_blank\" rel=\"noopener\">sk180488</a></li><li>For R77.30 and lower versions:<br><a href=\"https://support.checkpoint.com/results/sk/sk89940\" target=\"_blank\" rel=\"noopener\">sk89940</a></li></ul></td></tr><tr><td rowspan=\"7\"><p>cccd</p></td><td>Description</td><td><p>This process exists starting from the R81.10 version.</p><p>The single <em>cccd</em> daemon is responsible for the Client Communication Channel (CCC) protocol, while:</p><ul><li>IKE for the same clients runs in the IKE daemons <em>iked</em>.</li><li>The TLS layer of the CCC protocol for the same clients runs in the VPN daemon <em>vpnd</em>.</li></ul></td></tr><tr><td>Path</td><td><em>$FWDIR/bin/ccc</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cccd.elg</em></td></tr><tr><td>Notes</td><td>This process is <em>not</em> monitored by Check Point WatchDog</td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td>---</td></tr><tr><td rowspan=\"9\"><p>probemond</p></td><td>Description</td><td><p>This process exists starting from the R82 version.</p><p>Advanced monitoring of VPN tunnels using HTTP, HTTPS, or ICMP probing of the configured destinations.</p><p>To see the available CLI options, run:<br><code>probemon help</code></p></td></tr><tr><td>Path</td><td><em>$FWDIR/bin/probemond</em></td></tr><tr><td>Log File</td><td><ul><li><em>$FWDIR/log/probemond.elg</em></li><li><em>/var/tmp/probemon_event.log</em></li></ul></td></tr><tr><td>Configuration File</td><td><em>$FWDIR/conf/probemond.C</em></td></tr><tr><td>Notes</td><td><ul><li>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>PROBEMOND</em>\".</li><li>This process listens on port 9877 for other processes.</li><li>For details, refer to&nbsp;<a href=\"https://support.checkpoint.com/results/sk/sk181994\" target=\"_blank\" rel=\"noopener\">sk181994 - How to monitor the status of VPN Network Probes</a>.</li></ul></td></tr><tr><td>To See the Current Status</td><td><em>probemon status<br></em>or<br><em>cpwd_admin list | grep -E \"APP|PROBEMOND\"</em></td></tr><tr><td>To Stop</td><td><em>probemon stop</em></td></tr><tr><td>To Start</td><td><em>probemon start</em></td></tr><tr><td>Debug</td><td><ol><li>Start debug:<br><em>probemon debug trunc</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>probemon debug off</em></li><li>Analyze:<br><em>$FWDIR/log/probemond.elg*</em></li></ol></td></tr><tr><td id=\"Security Gateway Software Blades and Features - Mobile Access Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Mobile Access Blade</td></tr><tr><td rowspan=\"9\"><p>cvpnd</p></td><td>Description</td><td>Back-end daemon of the Mobile Access Software Blade.</td></tr><tr><td>Path</td><td><em>$CVPNDIR/bin/cvpnd</em></td></tr><tr><td>Log File</td><td><em>$CVPNDIR/log/cvpnd.elg</em></td></tr><tr><td>Configuration File</td><td><em>$CVPNDIR/conf/cvpnd.C</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CVPND</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CVPND\"</em></td></tr><tr><td>To Stop</td><td><em>cvpnstop</em></td></tr><tr><td>To Start</td><td><em>cvpnstart</em></td></tr><tr><td>Debug</td><td>\"<em>cvpnd_admin debug</em>\" - refer to <a href=\"https://support.checkpoint.com/results/sk/sk104577\" target=\"_blank\" rel=\"noopener\">sk104577</a>, <a href=\"https://support.checkpoint.com/results/sk/sk99053\" target=\"_blank\" rel=\"noopener\">sk99053</a></td></tr><tr><td rowspan=\"8\"><p>dbwriter</p></td><td>Description</td><td>Offloads database commands from <em>cvpnd</em> (to prevent locks) and synchronize with other members.</td></tr><tr><td>Path</td><td><em>$CVPNDIR/bin/dbwriter</em></td></tr><tr><td>Log File</td><td><em>$CVPNDIR/log/dbwriter.elg</em></td></tr><tr><td>Configuration File</td><td><em>$CVPNDIR/conf/dbwriter.C</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>DBWRITER</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|DBWRITER\"</em></td></tr><tr><td>To Stop</td><td><em>cvpnstop</em></td></tr><tr><td>To Start</td><td><em>cvpnstart</em></td></tr><tr><td rowspan=\"9\"><p>cvpnproc</p></td><td>Description</td><td>Offloads blocking commands from <em>cvpnd</em> (to prevent locks).<br>Example: Sending DynamicID.</td></tr><tr><td>Path</td><td><em>$CVPNDIR/bin/cvpnproc</em></td></tr><tr><td>Log File</td><td><em>$CVPNDIR/log/cvpnproc.elg</em></td></tr><tr><td>Configuration File</td><td><em>$CVPNDIR/conf/cvpnproc.C</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CVPNPROC</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CVPNPROC\"</em></td></tr><tr><td>To Stop</td><td><em>cvpnstop</em></td></tr><tr><td>To Start</td><td><em>cvpnstart</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk104577\" target=\"_blank\" rel=\"noopener\">sk104577</a><ol><li>Stop Mobile Access:<br><em>cvpnstop</em></li><li>Verify that <em>cvpnproc</em> process is not running:<br><em>ps aux | grep cvpnproc</em></li><li>If the <em>cvpnproc</em> process is still running, then kill it:<br><em>kill -KILL $(pidof cvpnproc)</em></li><li>Start <em>cvpnproc</em> process under debug to run in background (by running these 2 commands):<br><em>export TDERROR_ALL_ALL=5</em><br><em>$CVPNDIR/bin/cvpnproc $CVPNDIR/log/cvpnproc.elg $CVPNDIR/conf/cvpnproc.C &amp;</em></li><li>Start Mobile Access:<br><em>cvpnstart</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>unset TDERROR_ALL_ALL</em></li><li>Stop Mobile Access:<br><em>cvpnstop</em></li><li>Kill <em>cvpnproc</em> process:<br><em>kill -TERM $(pidof cvpnproc)</em><br><em>kill -KILL $(pidof cvpnproc)</em></li><li>Start Mobile Access:<br><em>cvpnstart</em></li><li>Analyze:<br><em>$CVPNDIR/log/cvpnproc.elg*</em></li></ol></td></tr><tr><td rowspan=\"8\"><p>MoveFileServer</p></td><td>Description</td><td>Move files between cluster members to perform database synchronization.</td></tr><tr><td>Path</td><td><em>$CVPNDIR/bin/MoveFileServer</em></td></tr><tr><td>Log File</td><td><em>$CVPNDIR/log/MFServer.log</em></td></tr><tr><td>Configuration File</td><td><em>$CVPNDIR/conf/mfserver.C</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process:<br><ul><li>In R77.30 and higher:<br>as \"<em>MFSERVER</em>\"</li><li>In R77.20 and lower:<br>as \"<em>MOVEFILESERVER</em>\"</li></ul></td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|MFSERVER\"</em></td></tr><tr><td>To Stop</td><td><em>cvpnstop</em></td></tr><tr><td>To Start</td><td><em>cvpnstart</em></td></tr><tr><td rowspan=\"8\"><p>MoveFileDemuxer</p></td><td>Description</td><td>Related to <em>MoveFileServer</em> process (moving files between cluster members to perform database synchronization).</td></tr><tr><td>Path</td><td><em>$CVPNDIR/bin/MoveFileDemuxer</em></td></tr><tr><td>Log File</td><td><em>$CVPNDIR/log/MFDemux.log</em></td></tr><tr><td>Configuration File</td><td><em>$CVPNDIR/conf/mfdemuxer.C</em></td></tr><tr><td>Notes</td><td><p>The \"<em>cpwd_admin list</em>\" command shows the process:</p><ul><li>In R77.30 and higher:<br>as \"<em>MFDEMUXER</em>\"</li><li>In R77.20 and lower:<br>as \"<em>MOVEFILEDEMUXER</em>\"</li></ul></td></tr><tr><td>To See the Current Status</td><td><p><em>cpwd_admin list | grep -E \"APP|MFDEMUXER\"</em></p></td></tr><tr><td>To Stop</td><td><em>cvpnstop</em></td></tr><tr><td>To Start</td><td><em>cvpnstart</em></td></tr><tr><td rowspan=\"9\"><p>Pinger</p></td><td>Description</td><td>Reduces the number of <em>httpd</em> processes that perform ActiveSync.</td></tr><tr><td>Path</td><td><em>$CVPNDIR/bin/Pinger</em></td></tr><tr><td>Log File</td><td><em>$CVPNDIR/log/Pinger.log</em></td></tr><tr><td>Configuration File</td><td><em>$CVPNDIR/conf/Pinger.C</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>PINGER</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|PINGER\"</em></td></tr><tr><td>To Stop</td><td><em>cvpnstop</em></td></tr><tr><td>To Start</td><td><em>cvpnstart</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk104577\" target=\"_blank\" rel=\"noopener\">sk104577</a><ol><li>Verify that <em>Pinger</em> process is running:<br><em>ps aux | grep Pinger</em></li><li>Enable debug for relevant users:<br><em>PingerAdmin debug users &lt;user1&gt;,&lt;user2&gt;,&lt;user3&gt;</em></li><li>Set the debug level:<br><em>PingerAdmin debug set TDERROR_ALL_Pinger=3</em><br>or<br><em>PingerAdmin debug set TDERROR_ALL_ALL=5</em></li><li>Set the debug type:<br><em>PingerAdmin debug type All</em></li><li>Delete all files from <em>$CVPNDIR/log/trace_log/</em> directory:<br>Note: Do NOT delete the directory itself!<br><em>cd $CVPNDIR/log/trace_log/</em><br><em>rm -i *</em></li><li>Enable trace log:<br>Warning: This might print passwords to local files!<br><em>PingerAdmin debug trace on</em></li><li>Start debug:<br><em>PingerAdmin debug on</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>PingerAdmin debug off</em></li><li>Disable trace log:<br><em>PingerAdmin debug trace off</em></li><li>Reset the debug:<br><em>PingerAdmin debug reset</em></li><li>Analyze:<br><em>$CVPNDIR/log/Pinger.log*</em></li></ol></td></tr><tr><td rowspan=\"7\"><p>CvpnUMD</p></td><td>Description</td><td>Reports SNMP connected users to AMON.</td></tr><tr><td>Path</td><td><em>$CVPNDIR/bin/CvpnUMD</em></td></tr><tr><td>Log File</td><td><em>$CVPNDIR/log/CvpnUMD.log</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CVPNUMD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CVPNUMD\"</em></td></tr><tr><td>To Stop</td><td><em>cvpnstop</em></td></tr><tr><td>To Start</td><td><em>cvpnstart</em></td></tr><tr><td rowspan=\"7\"><p>httpd</p></td><td>Description</td><td>Front-end daemon of the Mobile Access Software Blade (multi-processes).</td></tr><tr><td>Path</td><td><em>$CPDIR/web/Apache/2.2.0/bin/httpd</em></td></tr><tr><td>Log File</td><td><em>$CVPNDIR/log/httpd.log</em></td></tr><tr><td>Configuration File</td><td><em>$CVPNDIR/conf/httpd.conf</em></td></tr><tr><td>To Stop</td><td><em>cvpnstop</em></td></tr><tr><td>To Start</td><td><em>cvpnstart</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk104577\" target=\"_blank\" rel=\"noopener\">sk104577</a>, <a href=\"https://support.checkpoint.com/results/sk/sk99053\" target=\"_blank\" rel=\"noopener\">sk99053</a></td></tr><tr><td rowspan=\"6\"><p>fwpushd</p></td><td>Description</td><td>Mobile Access Push Notifications daemon that is controlled by \"<em>fwpush</em>\" command.<br>It is a child of the <em>fwd</em> daemon (in R77.10 and higher).</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwpushd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/fwpushd.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><ol><li>Enable debug:<br><em>fwpush debug on</em></li><li>Set the debug options:<br><em>fwpush debug set all all</em></li><li>Check the debug state:<br><em>fwpush debug stat</em></li><li>Replicate the issue</li><li>Reset the debug options:<br><em>fwpush debug reset</em></li><li>Disable debug:<br><em>fwpush debug off</em></li><li>Check the debug state:<br><em>fwpush debug stat</em></li><li>Analyze:<br><em>$FWDIR/log/fwpushd.elg*</em></li></ol></td></tr><tr><td rowspan=\"6\"><p>postgres</p></td><td>Description</td><td>PostgreSQL server. Used by Remote Access Session Visibility and Management Utility.</td></tr><tr><td>Path</td><td><em>$CPDIR/database/postgresql/bin/postgres</em></td></tr><tr><td>Configuration File</td><td><p>The path depends on the software version.<br>Your server may not contain all the files listed below.</p><ul><li><em>$CPDIR/conf/postgresql/postgresql.conf</em></li><li><em>$CPDIR/database/postgresql/data/postgresql.conf<br></em>or using another env variable:<br><em>$PGDATA/postgresql.conf</em></li><li><em>/var/log$FWDIR/datadir/postgres/sessions/postgresql.conf</em></li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>\"<em>su cp_postgres -c \"$CPDIR/database/postgresql/bin/pg_ctl -D $RTDIR/events_db/data start</em>\"</p><p>Also refer to <a href=\"https://support.checkpoint.com/results/sk/sk93970\" target=\"_blank\" rel=\"noopener\">sk93970</a></p></td></tr><tr><td id=\"Security Gateway Software Blades and Features - Identity Awareness Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Identity Awareness Blade</td></tr><tr><td rowspan=\"8\"><p>pepd</p></td><td>Description</td><td><p>Policy Enforcement Point daemon:</p><ul><li>Receiving identities via identity sharing</li><li>Redirecting users to Captive Portal</li></ul></td></tr><tr><td>Path</td><td><em>$FWDIR/bin/pep</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/pepd.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>PEPD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|PEPD\"</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td>\"<em>pep debug</em>\" - refer to the <a href=\"https://support.checkpoint.com/product/436\" target=\"_blank\" rel=\"noopener\">Identity Awareness Administration Guide</a> for your version</td></tr><tr><td rowspan=\"8\"><p>pdpd</p></td><td>Description</td><td><p>Policy Decision Point daemon:</p><ul><li>Acquiring identities from identity sources</li><li>Sharing identities with other Security Gateways</li></ul></td></tr><tr><td>Path</td><td><em>$FWDIR/bin/pdpd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/pdpd.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>PDPD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|PDPD\"</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td>\"<em>pdp debug</em>\" - refer to the <a href=\"https://support.checkpoint.com/product/436\" target=\"_blank\" rel=\"noopener\">Identity Awareness Administration Guide</a> for your version</td></tr><tr><td id=\"Security Gateway Software Blades and Features - DLP Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">DLP Blade and Content Awareness Blade</td></tr><tr><td rowspan=\"6\"><p>fwdlp</p></td><td>Description</td><td>In the DLP Blade, this is the DLP core engine that performs the scanning / inspection.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwdlp</em></td></tr><tr><td>Log File</td><td><ul><li><em>$FWDIR/log/fwdlp.elg</em></li><li><em>$DLPDIR/log/dlpe.log</em> (refer to <a href=\"https://support.checkpoint.com/results/sk/sk60387\" target=\"_blank\" rel=\"noopener\">sk60387</a>)</li><li><em>$DLPDIR/log/dlpe_msg.log</em> (refer to <a href=\"https://support.checkpoint.com/results/sk/sk73660\" target=\"_blank\" rel=\"noopener\">sk73660</a>)</li><li><em>$DLPDIR/log/dlpe_files_error.log</em></li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk73660\" target=\"_blank\" rel=\"noopener\">sk73660</a>, <a href=\"https://support.checkpoint.com/results/sk/sk60388\" target=\"_blank\" rel=\"noopener\">sk60388</a>:</p><ol><li>Start debug:<br><em>for PROC in $(pidof fwdlp) ; do fw debug $PROC on TDERROR_ALL_ALL=5 ; done</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>for PROC in $(pidof fwdlp) ; do fw debug $PROC off TDERROR_ALL_ALL=0 ; done</em></li><li>Analyze:<br><em>$FWDIR/log/fwdlp.elg*</em></li></ol></td></tr><tr><td rowspan=\"6\"><p>cp_file_convert</p></td><td>Description</td><td>In the DLP Blade and in the Content Awareness Blade, converts various file formats to simple textual format for scanning by the DLP engine and by the Content Awareness engine.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cp_file_convert</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cp_file_convertd.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk73660\" target=\"_blank\" rel=\"noopener\">sk73660</a>:</p><ol><li>Start debug:<br><em>for PROC in $(pgrep cp_file_convert) ; do fw debug $PROC on TDERROR_ALL_ALL=5 ; done</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug cp_file_convert off TDERROR_ALL_ALL=0</em></li><li>Analyze:<ul><li><em>/var/log/jail/$FWDIR/log/cp_file_convertd.elg*</em></li><li><em>$FWDIR/log/cp_file_convertd.elg*</em></li></ul></li></ol></td></tr><tr><td rowspan=\"4\"><p>dlp_fingerprint</p></td><td>Description</td><td>In the DLP Blade, identifies the data according to a unique signature known as a fingerprint stored in your repository.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/dlp_fingerprint</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td rowspan=\"8\"><p>cserver</p></td><td>Description</td><td>In the DLP Blade, this Check Server either stops or processes the e-mail.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cserver</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cserver.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>DLP_WS</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|DLP_WS\"</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk73660\" target=\"_blank\" rel=\"noopener\">sk73660</a>:</p><ol><li>Start debug:<br><em>fw debug cserver on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug cserver off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/cserver.elg*</em></li></ol></td></tr><tr><td rowspan=\"8\"><p>dlpu</p></td><td>Description</td><td>In the DLP Blade and in the Content Awareness Blade, receives data from the Check Point kernel.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/dlpu</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/dlpu.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>DLPU_&lt;N&gt;</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|DLPU_\"</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk73660\" target=\"_blank\" rel=\"noopener\">sk73660</a>:</p><ol><li>Start debug:<br><em>for PROC in $(pidof dlpu) ; do fw debug $PROC on TDERROR_ALL_ALL=5 ; done</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>for PROC in $(pidof dlpu) ; do fw debug $PROC off TDERROR_ALL_ALL=0 ; done</em></li><li>Analyze:<br><em>$FWDIR/log/dlpu.elg*</em></li></ol></td></tr><tr><td rowspan=\"8\"><p>fwucd</p></td><td>Description</td><td>In the DLP Blade, this is the UserCheck back-end daemon that sends approval / disapproval requests to user.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwucd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/fwucd.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>FWUCD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|FWUCD\"</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk73660\" target=\"_blank\" rel=\"noopener\">sk73660</a>, <a href=\"https://support.checkpoint.com/results/sk/sk60388\" target=\"_blank\" rel=\"noopener\">sk60388</a>:</p><ol><li>Start debug:<br><em>fw debug fwucd on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug fwucd off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/fwucd.elg*</em></li></ol></td></tr><tr><td rowspan=\"9\"><p>usrchkd</p></td><td>Description</td><td>In the DLP Blade, this is the main UserCheck daemon, which deals with UserCheck requests (from CLI / from the user) that are sent from the UserCheck Web Portal.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchkd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/usrchkd.elg</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$FWDIR/conf/usrchkd.conf</em></li><li><em>$FWDIR/orig/UCPortal/fwdir_conf/usrchkd.conf</em></li><li><em>$FWDIR/conf/fwauthd.conf</em></li></ul></td></tr><tr><td>Notes</td><td><ul><li>This daemon is not monitored by Check Point WatchDog (\"<em>cpwd_admin list</em>\")</li><li>This daemon is spawned by the FWD daemon</li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>To Restart</td><td><em>killall usrchkd</em></td></tr><tr><td>Debug</td><td><p>Note: It might also be required to collect the relevant kernel debug.</p><ol><li>Start debug:<br><em>usrchk debug set all all</em></li><li>Verify:<br><em>usrchk debug stat</em></li><li>Replicate the issue.</li><li>Stop debug:<br><em>usrchk debug off</em></li><li>Analyze:<br><em>$FWDIR/log/usrchkd.elg*</em></li></ol></td></tr><tr><td rowspan=\"3\"><p>usrchk</p></td><td>Description</td><td>In the DLP Blade, this is the CLI client for the UserCheck daemon USRCHKD (this process runs only when it is called explicitly).</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchk</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/usrchk.elg</em></td></tr><tr><td id=\"Security Gateway Software Blades and Features - Threat Emulation Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Threat Emulation Blade</td></tr><tr><td rowspan=\"6\"><p>ted</p></td><td>Description</td><td>Threat Emulation daemon engine - responsible for emulating files and communication with the cloud.</td></tr><tr><td>Path</td><td><em>$FWDIR/teCurrentPack/temain</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/ted.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td>\"<em>tecli debug</em>\" - refer to the <a href=\"https://support.checkpoint.com/product/417\" target=\"_blank\" rel=\"noopener\">Threat Prevention Administration Guide</a> for your version</td></tr><tr><td rowspan=\"8\"><p>dlpu</p></td><td>Description</td><td>DLP process - receives data from Check Point kernel.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/dlpu</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/dlpu.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>DLPU_&lt;N&gt;</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|DLPU_\"</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk73660\" target=\"_blank\" rel=\"noopener\">sk73660</a>:</p><ol><li>Start debug:<br><em>fw debug dlpu on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug dlpu off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/dlpu.elg*</em></li></ol></td></tr><tr><td rowspan=\"9\"><p>usrchkd</p></td><td>Description</td><td>Main UserCheck daemon, which deals with UserCheck requests (from CLI / from the user) that are sent from the UserCheck Web Portal.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchkd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/usrchkd.elg</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$FWDIR/conf/usrchkd.conf</em></li><li><em>$FWDIR/orig/UCPortal/fwdir_conf/usrchkd.conf</em></li><li><em>$FWDIR/conf/fwauthd.conf</em></li></ul></td></tr><tr><td>Notes</td><td><ul><li>This daemon is not monitored by Check Point WatchDog (\"<em>cpwd_admin list</em>\")</li><li>This daemon is spawned by the FWD daemon</li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>To Restart</td><td><em>killall usrchkd</em></td></tr><tr><td>Debug</td><td><p>Note: It might also be required to collect the relevant kernel debug.</p><ol><li>Start debug:<br><em>usrchk debug set all all</em></li><li>Verify:<br><em>usrchk debug stat</em></li><li>Replicate the issue.</li><li>Stop debug:<br><em>usrchk debug off</em></li><li>Analyze:<br><em>$FWDIR/log/usrchkd.elg*</em></li></ol></td></tr><tr><td rowspan=\"3\"><p>usrchk</p></td><td>Description</td><td>The CLI client for the UserCheck daemon USRCHKD (this process runs only when it is called explicitly).</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchk</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/usrchk.elg</em></td></tr><tr><td rowspan=\"6\"><p>scanengine_b</p></td><td>Description</td><td>Third-party engine.</td></tr><tr><td>Path</td><td><em>$FWDIR/teCurrentPack/scanengine_b</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/bdadvisor.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td>None</td></tr><tr><td rowspan=\"6\"><p>scanengine_k</p></td><td>Description</td><td>Third-party engine.</td></tr><tr><td>Path</td><td><em>$FWDIR/teCurrentPack/scanengine_k</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/kavadvisor.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td>None</td></tr><tr><td rowspan=\"6\"><p>scanengine_s</p></td><td>Description</td><td>Third-party engine.</td></tr><tr><td>Path</td><td><em>$FWDIR/teCurrentPack/scanengine_s</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/sopadvisor.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td>None</td></tr><tr><td id=\"Security Gateway Software Blades and Features - Threat Extraction Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Threat Extraction Blade</td></tr><tr><td rowspan=\"7\"><p>scrub</p></td><td>Description</td><td>Main CLI process for Threat Extraction.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/scrub</em></td></tr><tr><td>Log File</td><td><ul><li><em>$FWDIR/log/scrubd.elg</em></li><li><em>/var/log/scrub/scrubd_messages</em></li><li><em>$CPDIR/log/scrub_plg.log</em></li></ul></td></tr><tr><td>Configuration File</td><td><em>$FWDIR/conf/scrub_debug.conf</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><ol><li>Start Threat Extraction debug:<br><em>scrub debug on</em><br><em>scrub debug set all all</em></li><li>Verify Threat Extraction debug is enabled:<br><em>scrub debug stat</em></li><li>Start debug of <em>cp_file_convert</em> daemon:<br><em>for PROC in $(pgrep cp_file_convert) ; do fw debug $PROC on TDERROR_ALL_ALL=5 ; done</em></li><li>Replicate the issue</li><li>Stop debug of <em>cp_file_convert</em> daemon:<br><em>for PROC in $(pgrep cp_file_convert) ; do fw debug $PROC off TDERROR_ALL_ALL=0 ; done</em></li><li>Stop Threat Extraction debug:<br><em>scrub debug off</em><br><em>scrub debug reset</em></li><li>Verify Threat Extraction debug is disabled:<br><em>scrub debug stat</em></li><li>Analyze:<br><em>$FWDIR/log/scrubd.elg*</em><br><em>/var/log/jail/$FWDIR/log/scrub_cp_file_convertd.elg</em></li></ol></td></tr><tr><td rowspan=\"7\"><p>scrubd</p></td><td>Description</td><td>Main Threat Extraction daemon.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/scrubd</em></td></tr><tr><td>Log File</td><td><ul><li><em>$FWDIR/log/scrubd.elg</em></li><li><em>/var/log/scrub/scrubd_messages</em></li><li><em>$CPDIR/log/scrub_plg.log</em></li></ul></td></tr><tr><td>Configuration File</td><td><em>$FWDIR/conf/scrub_debug.conf</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><ol><li>Start Threat Extraction debug:<br><em>scrub debug on</em><br><em>scrub debug set all all</em></li><li>Verify Threat Extraction debug is enabled:<br><em>scrub debug stat</em></li><li>Start debug of <em>cp_file_convert</em> daemon:<br><em>for PROC in $(pgrep cp_file_convert) ; do fw debug $PROC on TDERROR_ALL_ALL=5 ; done</em></li><li>Replicate the issue</li><li>Stop debug of <em>cp_file_convert</em> daemon:<br><em>for PROC in $(pgrep cp_file_convert) ; do fw debug $PROC off TDERROR_ALL_ALL=0 ; done</em></li><li>Stop Threat Extraction debug:<br><em>scrub debug off</em><br><em>scrub debug reset</em></li><li>Verify Threat Extraction debug is disabled:<br><em>scrub debug stat</em></li><li>Analyze:<br><em>$FWDIR/log/scrubd.elg*</em><br><em>/var/log/jail/$FWDIR/log/scrub_cp_file_convertd.elg</em></li></ol></td></tr><tr><td rowspan=\"6\"><p>scrub_cp_file_convertd</p></td><td>Description</td><td>Converts various file formats to simple textual format for scanning by the Threat Extraction engine and by the Content Awareness Software Blade.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cp_file_convert</em></td></tr><tr><td>Log File</td><td><ul><li><em>/var/log/jail/$FWDIR/log/scrub_cp_file_convertd.elg</em></li><li><em>$FWDIR/log/cp_file_convert_start.log</em></li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><ol><li>Start debug:<br><em>for PROC in $(pgrep cp_file_convert) ; do fw debug $PROC on TDERROR_ALL_ALL=5 ; done</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>for PROC in $(pgrep cp_file_convert) ; do fw debug $PROC off TDERROR_ALL_ALL=0 ; done</em></li><li>Analyze:<br><em>/var/log/jail/$FWDIR/log/scrub_cp_file_convertd.elg*</em></li></ol></td></tr><tr><td rowspan=\"6\"><p>in.emaild.mta</p></td><td>Description</td><td>E-Mail Security Server that receives e-mails sent by user and sends them to their destinations.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwssd</em></td></tr><tr><td>Log File</td><td><ul><li><em>$FWDIR/log/emaild.mta.elg</em></li><li><em>/var/log/scrub/in.emaild.mta_messages</em></li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk139892\" target=\"_blank\" rel=\"noopener\">sk139892 - MTA Engine Debugging</a></p></td></tr><tr><td rowspan=\"9\"><p>usrchkd</p></td><td>Description</td><td>Main UserCheck daemon, which deals with UserCheck requests (from CLI / from the user) that are sent from the UserCheck Web Portal.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchkd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/usrchkd.elg</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$FWDIR/conf/usrchkd.conf</em></li><li><em>$FWDIR/orig/UCPortal/fwdir_conf/usrchkd.conf</em></li><li><em>$FWDIR/conf/fwauthd.conf</em></li></ul></td></tr><tr><td>Notes</td><td><ul><li>This daemon is not monitored by Check Point WatchDog (\"<em>cpwd_admin list</em>\")</li><li>This daemon is spawned by the FWD daemon</li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>To Restart</td><td><em>killall usrchkd</em></td></tr><tr><td>Debug</td><td><p>Note: It might also be required to collect the relevant kernel debug.</p><ol><li>Start debug:<br><em>usrchk debug set all all</em></li><li>Verify:<br><em>usrchk debug stat</em></li><li>Replicate the issue.</li><li>Stop debug:<br><em>usrchk debug off</em></li><li>Analyze:<br><em>$FWDIR/log/usrchkd.elg*</em></li></ol></td></tr><tr><td rowspan=\"3\"><p>usrchk</p></td><td>Description</td><td>The CLI client for the UserCheck daemon USRCHKD (this process runs only when it is called explicitly).</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchk</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/usrchk.elg</em></td></tr><tr><td id=\"Security Gateway Software Blades and Features - Zero Phishing Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Zero Phishing Blade</td></tr><tr><td rowspan=\"6\"><p><em><strong>zphd</strong></em></p></td><td><p>Description</p></td><td><p>Main Zero Phishing daemon on the Security Gateway:</p><ol><li>Gets answers from the Check Point cloud</li><li>Determines the final counter-action taken when encountering a phishing site based on the Security Policy</li><li>Sends logs</li></ol></td></tr><tr><td><p>Path</p></td><td><p><em>$FWDIR/bin/zphd</em></p></td></tr><tr><td><p>Log file</p></td><td><p><em>$FWDIR/log/zphd.elg</em></p></td></tr><tr><td><p>To Stop</p></td><td><p><em>cpstop</em></p></td></tr><tr><td><p>To Start</p></td><td><p><em>cpstart</em></p></td></tr><tr><td><p>Debug</p></td><td><ol><li><p>Start the ZPHD debug:</p><p><em>zph debug on</em></p><p><em>zph debug set all all</em></p></li><li><p>Make sure the ZPHD debug is enabled:</p><p><em>zph debug stat</em></p></li><li><p>Replicate the issue.</p></li><li><p>Stop the ZPHD debug:</p><p><em>zph debug off</em></p><p><em>zph debug reset</em></p></li><li><p>Make sure the ZPHD debug is disabled:</p><p><em>zph debug stat</em></p></li><li><p>Analyze:</p><p><em>$FWDIR/log/zphd.elg*</em></p></li></ol></td></tr><tr><td rowspan=\"6\"><p><em><strong>usercheckportal_php</strong></em></p></td><td><p>Description</p></td><td><p>UserCheck Web Portal</p></td></tr><tr><td><p>Log file</p></td><td><em>/opt/CPUserCheckPortal/log/zph</em></td></tr><tr><td><p>Configuration files</p></td><td><p><em>/opt/CPUserCheckPortal/phpincs/conf/proxy.ini</em></p><p><em>/opt/CPUserCheckPortal/conf/httpd.conf</em></p><p><em>/opt/CPUserCheckPortal/phpincs/conf/L10N/portal_en.php</em></p></td></tr><tr><td><p>To Stop</p></td><td><p><em>cpstop</em></p></td></tr><tr><td><p>To Start</p></td><td><p><em>cpstart</em></p></td></tr><tr><td><p>Debug</p></td><td><ol><li><p>Start the UserCheck Web Portal debug:</p><ol><li><p>Run:</p><p><em>/opt/CPUserCheckPortal/scripts/logs_conf_server</em></p></li><li><p>Select option \"1\"</p></li></ol></li><li><p>Replicate the issue.</p></li><li><p>Stop the UserCheck Web Portal debug:</p><ol><li>Run:<br><em>/opt/CPUserCheckPortal/scripts/logs_conf_server</em></li><li><p>Select option \"2\"</p></li></ol></li><li><p>Analyze:</p><p><em>/opt/CPUserCheckPortal/log/PortalLog.log</em></p></li></ol></td></tr><tr><td id=\"Security Gateway Software Blades and Features - Infinity Threat Prevention Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Threat Prevention</td></tr><tr><td rowspan=\"9\"><p><em>tp_conf_service</em></p></td><td>Description</td><td>Service for Threat Prevention Software Blades (R80.40 and higher) for updatable configuration.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/tp_conf_service</em></td></tr><tr><td>Notes</td><td>The <em>cpwd_admin list</em> command shows the process as \"<em>TP_CONF_SERVICE</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|TP_CONF_SERVICE\"</em></td></tr><tr><td>Log File</td><td><ul><li>In R81 and higher:<br><em>$FWDIR/log/tp_conf.elg</em></li><li>In R80.40:<br><em>$FWDIR/log/tp_conf.log</em></li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Configuration File</td><td><em>$FWDIR/conf/tp_conf.json</em></td></tr><tr><td>Debug</td><td><ol><li>Stop the daemon:<br><em>cpwd_admin stop -name TP_CONF_SERVICE</em></li><li>Start the daemon with debug logging:<br><em>cpwd_admin start -name TP_CONF_SERVICE -path $FWDIR/bin/tp_conf_service -command \"tp_conf_service --conf=tp_conf.json --log=debug\"</em></li><li>Replicate the issue</li><li>Stop the daemon:<br><em>cpwd_admin stop -name TP_CONF_SERVICE</em></li><li>Start the daemon with regular logging:<br><em>cpwd_admin start -name TP_CONF_SERVICE -path $FWDIR/bin/tp_conf_service -command \"tp_conf_service --conf=tp_conf.json --log=error\"</em></li><li>Analyze the log file</li></ol></td></tr><tr><td rowspan=\"6\"><p><em>tpd</em></p></td><td>Description</td><td>Threat Prevention Daemon - communicates with the kernel and deals with User Space tasks (R80.40 and higher).</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/tpd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/tpd.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><ol><li>Start debug:<br><em>fw debug tpd on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug tpd off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/tpd.elg*</em></li></ol></td></tr><tr><td id=\"Security Gateway Software Blades and Features - IPS Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">IPS Blade</td></tr><tr><td rowspan=\"6\"><p>in.geod</p></td><td>Description</td><td>Updates the IPS Geo Protection Database.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwssd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/geod.elg</em></td></tr><tr><td>To Stop</td><td><em>kill -KILL $(pidof in.geod)</em></td></tr><tr><td>To Start</td><td>After being killed, it will be restarted automatically</td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk102329\" target=\"_blank\" rel=\"noopener\">sk102329</a>:</p><ol><li>Start debug:<br><em>fw debug in.geod on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug in.geod off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/geod.elg*</em></li></ol></td></tr><tr><td id=\"Security Gateway Software Blades and Features - URL Filtering Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">URL Filtering Blade</td></tr><tr><td rowspan=\"9\"><p>rad</p></td><td>Description</td><td>Resource Advisor - responsible for the detection of Social Network widgets. The detection is done via an online Application Control database, which identifies URLs as applications.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/rad</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/rad.elg</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$FWDIR/conf/rad_scheme.C</em></li><li><em>$FWDIR/conf/rad_settings.C</em></li><li><em>$FWDIR/database/rad_services.C</em></li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>RAD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|RAD\"</em></td></tr><tr><td>To Stop</td><td><em>rad_admin stop</em><br>or<br><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>rad_admin start</em><br>or<br><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk92743\" target=\"_blank\" rel=\"noopener\">sk92743</a>:</p><ol><li>Start debug:<br><em>rad_admin rad debug on all</em></li><li>Replicate the issue.</li><li>Stop debug:<br><em>rad_admin rad debug off ALL</em></li><li>Analyze:<br><em>$FWDIR/log/rad.elg*</em></li></ol></td></tr><tr><td rowspan=\"9\"><p>usrchkd</p></td><td>Description</td><td>Main UserCheck daemon, which deals with UserCheck requests (from CLI / from the user) that are sent from the UserCheck Web Portal.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchkd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/usrchkd.elg</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$FWDIR/conf/usrchkd.conf</em></li><li><em>$FWDIR/orig/UCPortal/fwdir_conf/usrchkd.conf</em></li><li><em>$FWDIR/conf/fwauthd.conf</em></li></ul></td></tr><tr><td>Notes</td><td><ul><li>This daemon is not monitored by Check Point WatchDog (\"<em>cpwd_admin list</em>\")</li><li>This daemon is spawned by the FWD daemon</li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>To Restart</td><td><em>killall usrchkd</em></td></tr><tr><td>Debug</td><td><p>Note: It might also be required to collect the relevant kernel debug.</p><ol><li>Start debug:<br><em>usrchk debug set all all</em></li><li>Verify:<br><em>usrchk debug stat</em></li><li>Replicate the issue.</li><li>Stop debug:<br><em>usrchk debug off</em></li><li>Analyze:<br><em>$FWDIR/log/usrchkd.elg*</em></li></ol></td></tr><tr><td rowspan=\"3\"><p>usrchk</p></td><td>Description</td><td>The CLI client for the UserCheck daemon USRCHKD (this process runs only when it is called explicitly).</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchk</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/usrchk.elg</em></td></tr><tr><td id=\"Security Gateway Software Blades and Features - Application Control Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Application Control Blade</td></tr><tr><td rowspan=\"9\">rad</td><td>Description</td><td>Resource Advisor - responsible for the detection of Social Network widgets. The detection is done via an online Application Control database, which identifies URLs as applications.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/rad</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/rad.elg</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$FWDIR/conf/rad_scheme.C</em></li><li><em>$FWDIR/conf/rad_settings.C</em></li><li><em>$FWDIR/database/rad_services.C</em></li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>RAD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|RAD\"</em></td></tr><tr><td>To Stop</td><td><em>rad_admin stop</em><br>or<br><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>rad_admin start</em><br>or<br><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk92743\" target=\"_blank\" rel=\"noopener\">sk92743</a>:</p><ol><li>Start debug:<br><em>rad_admin rad debug on all</em></li><li>Replicate the issue.</li><li>Stop debug:<br><em>rad_admin rad debug off ALL</em></li><li>Analyze:<br><em>$FWDIR/log/rad.elg*</em></li></ol></td></tr><tr><td id=\"Security Gateway Software Blades and Features - Anti-Bot Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Anti-Bot Blade</td></tr><tr><td rowspan=\"6\"><p>in.acapd</p></td><td>Description</td><td>Daemon that captures packets to download the traffic sample from logs.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwssd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/acapd.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk108179\" target=\"_blank\" rel=\"noopener\">sk108179</a>:</p><ol><li>Start debug:<br><em>fw debug in.acapd on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug in.acapd off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/acapd.elg*</em></li></ol></td></tr><tr><td rowspan=\"9\"><p>rad</p></td><td>Description</td><td>Resource Advisor - responsible for the detection of Social Network widgets. The detection is done via an online Application Control database, which identifies URLs as applications.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/rad</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/rad.elg</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$FWDIR/conf/rad_scheme.C</em></li><li><em>$FWDIR/conf/rad_settings.C</em></li><li><em>$FWDIR/database/rad_services.C</em></li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>RAD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|RAD\"</em></td></tr><tr><td>To Stop</td><td><em>rad_admin stop</em><br>or<br><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>rad_admin start</em><br>or<br><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk92264\" target=\"_blank\" rel=\"noopener\">sk92264</a>:</p><ol><li>Start debug:<br><em>rad_admin rad debug on all</em></li><li>Replicate the issue.</li><li>Stop debug:<br><em>rad_admin rad debug off ALL</em></li><li>Analyze:<br><em>$FWDIR/log/rad.elg*</em></li></ol></td></tr><tr><td rowspan=\"9\"><p>usrchkd</p></td><td>Description</td><td>Main UserCheck daemon, which deals with UserCheck requests (from CLI / from the user) that are sent from the UserCheck Web Portal.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchkd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/usrchkd.elg</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$FWDIR/conf/usrchkd.conf</em></li><li><em>$FWDIR/orig/UCPortal/fwdir_conf/usrchkd.conf</em></li><li><em>$FWDIR/conf/fwauthd.conf</em></li></ul></td></tr><tr><td>Notes</td><td><ul><li>This daemon is not monitored by Check Point WatchDog (\"<em>cpwd_admin list</em>\")</li><li>This daemon is spawned by the FWD daemon</li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>To Restart</td><td><em>killall usrchkd</em></td></tr><tr><td>Debug</td><td><p>Note: It might also be required to collect the relevant kernel debug.</p><ol><li>Start debug:<br><em>usrchk debug set all all</em></li><li>Verify:<br><em>usrchk debug stat</em></li><li>Replicate the issue.</li><li>Stop debug:<br><em>usrchk debug off</em></li><li>Analyze:<br><em>$FWDIR/log/usrchkd.elg*</em></li></ol></td></tr><tr><td rowspan=\"3\"><p>usrchk</p></td><td>Description</td><td>The CLI client for the UserCheck daemon USRCHKD (this process runs only when it is called explicitly).</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchk</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/usrchk.elg</em></td></tr><tr><td id=\"Security Gateway Software Blades and Features - Anti-Virus Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Anti-Virus Blade</td></tr><tr><td rowspan=\"6\"><p>in.acapd</p></td><td>Description</td><td>Daemon that captures packets to download the traffic sample from logs.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwssd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/acapd.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk108179\" target=\"_blank\" rel=\"noopener\">sk108179</a>:</p><ol><li>Start debug:<br><em>fw debug in.acapd on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug in.acapd off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/acapd.elg*</em></li></ol></td></tr><tr><td rowspan=\"6\"><p>in.emaild.mta</p></td><td>Description</td><td>E-Mail Security Server that receives e-mails sent by user and sends them to their destinations.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwssd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/emaild.mta.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk60387\" target=\"_blank\" rel=\"noopener\">sk60387</a>:</p><ol><li>Start debug:<br><em>fw debug in.emaild.mta on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug in.emaild.mta off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/emaild.mta.elg*</em></li></ol></td></tr><tr><td rowspan=\"6\"><p>in.emaild.smtp</p></td><td>Description</td><td>SMTP Security Server that receives e-mails sent by user and sends them to their destinations.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwssd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/emaild.smtp.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk60387\" target=\"_blank\" rel=\"noopener\">sk60387</a>:</p><ol><li>Start debug:<br><em>fw debug in.emaild.smtp on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug in.emaild.smtp off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/emaild.smtp.elg*</em></li></ol></td></tr><tr><td rowspan=\"6\"><p>in.emaild.pop3</p></td><td>Description</td><td>POP3 Security Server that receives e-mails sent by user.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwssd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/emaild.pop3.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><ol><li>Start debug:<br><em>fw debug in.emaild.pop3 on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug in.emaild.pop3 off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/emaild.pop3.elg*</em></li></ol></td></tr><tr><td rowspan=\"8\"><p>dlpu</p></td><td>Description</td><td>DLP process - receives data from Check Point kernel.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/dlpu</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/dlpu.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>DLPU_&lt;N&gt;</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|DLPU_\"</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk73660\" target=\"_blank\" rel=\"noopener\">sk73660</a>:</p><ol><li>Start debug:<br><em>fw debug dlpu on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug dlpu off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/dlpu.elg*</em></li></ol></td></tr><tr><td rowspan=\"9\"><p>rad</p></td><td>Description</td><td>Resource Advisor - responsible for the detection of Social Network widgets. The detection is done via an online Application Control database, which identifies URLs as applications.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/rad</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/rad.elg</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$FWDIR/conf/rad_scheme.C</em></li><li><em>$FWDIR/conf/rad_settings.C</em></li><li><em>$FWDIR/database/rad_services.C</em></li></ul></td></tr><tr><td>Note</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>RAD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|RAD\"</em></td></tr><tr><td>To Stop</td><td><em>rad_admin stop</em><br>or<br><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>rad_admin start</em><br>or<br><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk92264\" target=\"_blank\" rel=\"noopener\">sk92264</a>:</p><ol><li>Start debug:<br><em>rad_admin rad debug on all</em></li><li>Replicate the issue.</li><li>Stop debug:<br><em>rad_admin rad debug off ALL</em></li><li>Analyze:<br><em>$FWDIR/log/rad.elg*</em></li></ol></td></tr><tr><td rowspan=\"9\"><p>usrchkd</p></td><td>Description</td><td>Main UserCheck daemon, which deals with UserCheck requests (from CLI / from the user) that are sent from the UserCheck Web Portal.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchkd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/usrchkd.elg</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$FWDIR/conf/usrchkd.conf</em></li><li><em>$FWDIR/orig/UCPortal/fwdir_conf/usrchkd.conf</em></li><li><em>$FWDIR/conf/fwauthd.conf</em></li></ul></td></tr><tr><td>Notes</td><td><ul><li>This daemon is not monitored by Check Point WatchDog (\"<em>cpwd_admin list</em>\")</li><li>This daemon is spawned by the FWD daemon</li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>To Restart</td><td><em>killall usrchkd</em></td></tr><tr><td>Debug</td><td><p>Note: It might also be required to collect the relevant kernel debug.</p><ol><li>Start debug:<br><em>usrchk debug set all all</em></li><li>Verify:<br><em>usrchk debug stat</em></li><li>Replicate the issue.</li><li>Stop debug:<br><em>usrchk debug off</em></li><li>Analyze:<br><em>$FWDIR/log/usrchkd.elg*</em></li></ol></td></tr><tr><td rowspan=\"3\"><p>usrchk</p></td><td>Description</td><td>The CLI client for the UserCheck daemon USRCHKD (this process runs only when it is called explicitly).</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchk</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/usrchk.elg</em></td></tr><tr><td id=\"Security Gateway Software Blades and Features - Anti-Spam Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Anti-Spam Blade</td></tr><tr><td rowspan=\"6\"><p>in.emaild.smtp</p></td><td>Description</td><td>SMTP Security Server that receives e-mails sent by user and sends them to their destinations.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwssd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/emaild.smtp.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk60387\" target=\"_blank\" rel=\"noopener\">sk60387</a>:</p><ol><li>Start debug:<br><em>fw debug in.emaild.smtp on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug in.emaild.smtp off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/emaild.smtp.elg*</em></li></ol></td></tr><tr><td rowspan=\"6\"><p>in.msd</p></td><td>Description</td><td>Mail Security Daemon that queries the Commtouch engine for reputation.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwssd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/msd.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk92264\" target=\"_blank\" rel=\"noopener\">sk92264</a>:</p><ol><li>Start debug:<br><em>fw debug in.msd on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug in.msd off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/msd.elg*</em></li></ol></td></tr><tr><td rowspan=\"5\"><p>ctasd</p></td><td>Description</td><td>Commtouch Anti-Spam daemon.</td></tr><tr><td>Path</td><td><em>/opt/aspam_engine/ctipd/bin/ctasd</em></td></tr><tr><td>Configuration File</td><td><em>/opt/aspam_engine/ctasd/conf/ctasd.conf</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td rowspan=\"7\"><p>ctipd</p></td><td>Description</td><td>Commtouch IP Reputation daemon.</td></tr><tr><td>Path</td><td><em>/opt/aspam_engine/ctipd/bin/ctipd</em></td></tr><tr><td>Log File</td><td>None</td></tr><tr><td>Configuration File</td><td><em>/opt/aspam_engine/ctipd/conf/ctipd.conf</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td>None</td></tr><tr><td id=\"Security Gateway Software Blades and Features - Monitoring Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Monitoring Blade</td></tr><tr><td rowspan=\"8\"><p>rtmd</p></td><td>Description</td><td>Real Time traffic statistics.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/rtm</em><br><em>%FWDIR%\\bin\\rtm</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/rtmd.elg</em><br><em>%FWDIR%\\log\\rtmd.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>RTMD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|RTMD\"</em></td></tr><tr><td>To Stop</td><td><em>rtmstop</em></td></tr><tr><td>To Start</td><td><em>rtmstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/skI2821\" target=\"_blank\" rel=\"noopener\">skI2821</a>:</p><ol><li>Start debug:<br><em>rtm debug on TDERROR_ALL_ALL=5</em><br><em>rtm debug on OPSEC_DEBUG_LEVEL=3</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>rtm debug off TDERROR_ALL_ALL=0</em><br><em>rtm debug off OPSEC_DEBUG_LEVEL=0</em></li><li>Analyze:<br><em>$FWDIR/log/rtmd.elg*</em></li></ol></td></tr><tr><td rowspan=\"8\"><p>cpstat_monitor</p></td><td>Description</td><td>Process is responsible for collecting and sending information to SmartView Monitor.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cpstat_monitor</em><br><em>%FWDIR%\\bin\\cpstat_monitor</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cpstat_monitor.elg</em><br><em>%FWDIR%\\log\\cpstat_monitor.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td><ul><li>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CPSM</em>\".</li><li>By default, does not run in the context of Domain Management Servers.</li><li>By default, in MGMT HA runs only on the \"Active\" Security Management Server.</li></ul></td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CPSM\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name CPSM</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name CPSM -path \"$FWDIR/bin/cpstat_monitor\" -command \"cpstat_monitor\"</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk108177\" target=\"_blank\" rel=\"noopener\">sk108177</a></td></tr><tr><td id=\"Security Gateway Software Blades and Features - HTTPS Inspection\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">HTTPS Inspection</td></tr><tr><td rowspan=\"6\"><p>wstlsd</p></td><td>Description</td><td>Handles SSL handshake for HTTPS Inspected connections.</td></tr><tr><td>Path</td><td><em>$CPDIR/bin/wstlsd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/wstlsd.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk105559\" target=\"_blank\" rel=\"noopener\">sk105559</a>:</p><ol><li>Start debug:<br><em>for PROC in $(pidof wstlsd) ; do fw debug $PROC on TDERROR_ALL_ALL=6 ; done</em></li><li>Replicate the issue (it is very important to collect the relevant traffic using both TCPDump tool and the FW Monitor).</li><li>Stop debug:<br><em>for PROC in $(pidof wstlsd) ; do fw debug $PROC off TDERROR_ALL_ALL=0 ; done</em></li><li>Analyze:<br><em>$FWDIR/log/wstlsd.elg*</em></li></ol></td></tr><tr><td rowspan=\"7\"><p>pkxld</p></td><td>Description</td><td>Performs asymmetric key operations for HTTPS Inspection (R77.30 and higher)</td></tr><tr><td>Path</td><td><em>$CPDIR/bin/pkxld</em></td></tr><tr><td>Log File</td><td>none</td></tr><tr><td>Notes</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk104717\" target=\"_blank\" rel=\"noopener\">sk104717</a></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td>None</td></tr><tr><td id=\"Security Gateway Software Blades and Features - HTTP/HTTPS Proxy\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">HTTP/HTTPS Proxy</td></tr><tr><td rowspan=\"8\"><p>wsdnsd</p></td><td>Description</td><td>DNS Resolver (in R77.30 and higher) - used for resolving all Domain Objects. The process is started and stopped during policy installation.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/wsdnsd</em><br><em>%FWDIR%\\bin\\wsdnsd</em> (R77.30 only on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/wsdnsd.elg<br>%FWDIR%\\log\\wsdnsd.elg</em> (R77.30 only on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>WSDNSD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|WSDNSD\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name WSDNSD -path \"$FWDIR/bin/wsdnsd\" -command \"kill -SIGTERM $(pidof $FWDIR/bin/wsdnsd)\"</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name WSDNSD -path \"$FWDIR/bin/wsdnsd\" -command \"wsdnsd\"</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk106443\" target=\"_blank\" rel=\"noopener\">sk106443</a>:</p><ol><li>Start debug:<br><em>fw debug wsdnsd on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug wsdnsd off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/wsdnsd.elg*</em></li></ol></td></tr><tr><td id=\"Security Gateway Software Blades and Features - ClusterXL\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Cluster</td></tr><tr><td rowspan=\"7\"><p>cphamcset</p></td><td>Description</td><td>Clustering daemon - responsible for opening sockets on the NICs to allow them to pass multicast traffic (CCP) to the machine.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cphamcset</em><br><em>%FWDIR%\\bin\\cphamcset</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cphamcset.elg</em><br><em>%FWDIR%\\log\\cphamcset.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td><ul><li>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk93306\" target=\"_blank\" rel=\"noopener\">ATRG: ClusterXL R6x and R7x</a>.</li><li>Log file exists only in R77.20 and higher</li></ul></td></tr><tr><td>To Stop</td><td><em>cphastop</em></td></tr><tr><td>To Start</td><td><em>cphastart</em></td></tr><tr><td>Debug</td><td><ol><li>Stop clustering:<br><em>cphastop</em></li><li>Start under debug:<br><em>cphamcset -d</em></li><li>Stop Check Point services:<br><em>cphastop</em></li><li>Start clustering:<br><em>cphastart</em></li></ol></td></tr><tr><td rowspan=\"7\"><p>cphaprob</p></td><td>Description</td><td>Process that lists the state of cluster members, cluster interfaces and Critical Devices (Pnotes).</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cphaprob</em><br><em>%FWDIR%\\bin\\cphaprob</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Configuration File</td><td><em>$FWDIR/conf/cphaprob.conf</em><br><em>%FWDIR%\\conf\\cphaprob.conf</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk93306\" target=\"_blank\" rel=\"noopener\">ATRG: ClusterXL R6x and R7x</a> - Chapter \"ClusterXL Monitoring and Troubleshooting\" - 'cphaprob' command.</td></tr><tr><td>To Stop</td><td>None</td></tr><tr><td>To Start</td><td>None</td></tr><tr><td>Debug</td><td>\"<em>cphaprob -D &lt;command&gt;</em>\" (e.g., \"<em>cphaprob -D state</em>\")</td></tr><tr><td rowspan=\"7\"><p>cphaconf</p></td><td>Description</td><td>Cluster configuration process - installs the cluster configuration into Check Point kernel on cluster members.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cphaconf</em><br><em>%FWDIR%\\bin\\cphaconf</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cphaconf.elg</em><br><em>%FWDIR%\\log\\cphaconf.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td><ul><li>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk93306\" target=\"_blank\" rel=\"noopener\">ATRG: ClusterXL R6x and R7x</a> - Chapter \"ClusterXL Monitoring and Troubleshooting\" - 'cphaconf' command.</li><li>Log file exists only in R77.20 and higher</li></ul></td></tr><tr><td>To Stop</td><td>None</td></tr><tr><td>To Start</td><td>None</td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk93306\" target=\"_blank\" rel=\"noopener\">ATRG: ClusterXL R6x and R7x</a> - Chapter \"ClusterXL Monitoring and Troubleshooting\" - 'cphaconf' command - 'cphaconf debug_data'.</td></tr><tr><td rowspan=\"7\"><p>cphastart</p></td><td>Description</td><td>Starts the cluster and state synchronization.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cphastart</em><br><em>%FWDIR%\\bin\\cphastart</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cphastart.elg</em><br><em>%FWDIR%\\log\\cphastart.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td><ul><li>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk93306\" target=\"_blank\" rel=\"noopener\">ATRG: ClusterXL R6x and R7x</a> - Chapter \"ClusterXL Monitoring and Troubleshooting\" - 'cphastart' and 'cphastop' commands.</li><li>Log file exists only in R77.20 and higher</li></ul></td></tr><tr><td>To Stop</td><td>None</td></tr><tr><td>To Start</td><td>None</td></tr><tr><td>Debug</td><td>\"<em>cphastart -d</em>\" - refer to <a href=\"https://support.checkpoint.com/results/sk/sk39842\" target=\"_blank\" rel=\"noopener\">sk39842</a></td></tr><tr><td rowspan=\"6\"><p>cphastop</p></td><td>Description</td><td>Stops the cluster and state synchronization.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cphastop</em><br><em>%FWDIR%\\bin\\cphastop</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk93306\" target=\"_blank\" rel=\"noopener\">ATRG: ClusterXL R6x and R7x</a> - Chapter \"ClusterXL Monitoring and Troubleshooting\" - 'cphastart' and 'cphastop' commands.</td></tr><tr><td>To Stop</td><td>None</td></tr><tr><td>To Start</td><td>None</td></tr><tr><td>Debug</td><td>Standard CSH script debugging (<em>csh -x -v $FWDIR/bin/cphastop</em>)</td></tr><tr><td rowspan=\"6\"><p>cxld</p></td><td>Description</td><td>Runs the cluster Full Sync (R81 and higher).</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cxld</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cxld.elg</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td>Runs with debug by default</td></tr><tr><td id=\"Security Gateway Software Blades and Features - SecureXL\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">SecureXL</td></tr><tr><td rowspan=\"8\"><p>sxl_statd</p></td><td>Description</td><td>Daemon that collects statistics information from the SecureXL on the Host appliance (R80.20 and higher).</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/sxl_statd</em></td></tr><tr><td>Log File</td><td>None</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>SXL_STATD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|SXL_STATD\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name SXL_STATD</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name SXL_STATD -path \"$FWDIR/bin/sxl_statd\" -command \"sxl_statd\"</em></td></tr><tr><td>Debug</td><td>None</td></tr><tr><td id=\"Security Gateway Software Blades and Features - CoreXL\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">CoreXL</td></tr><tr><td rowspan=\"8\"><p><em>dsd</em></p></td><td>Description</td><td>Dynamic Balancing (initially called \"Dynamic Split\") - responsible for dynamically adjusting CoreXL for optimized CPU resources allocation, based on continuous monitoring of system resources (R80.40 and higher)</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/dsd</em></td></tr><tr><td>Log File</td><td><em>$FWIDR/log/dsd.elg</em></td></tr><tr><td>Notes</td><td><ul><li>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>SDAEMON</em>\".</li><li>See the <a href=\"https://support.checkpoint.com/product/530\" target=\"_blank\" rel=\"noopener\">Performance Tuning Administration Guide</a> for your version.</li></ul></td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|SDAEMON\"</em></td></tr><tr><td>To Disable / Stop</td><td>In Gaia Clish / Gaia gClish:<ol><li>Get the current state:<br><em>show dynamic-balancing state</em></li><li>If enabled:<ul><li>To disable:<br><em>set dynamic-balancing state disable</em><br><em>reboot</em></li><li>To only stop (without reboot):<br><em>set dynamic-balancing state stop</em></li></ul></li></ol><p>In the Expert mode:</p><ol><li>Get the current state:<br><em>dynamic_split -p</em></li><li>If enabled:<ul><li>To disable:<br><em>dynamic_split -o disable</em><br><em>reboot</em></li><li>To only stop (without reboot):<br><em>dynamic_split -o stop</em></li></ul></li></ol></td></tr><tr><td>To Enable / Start</td><td><p>In R81 and higher, this feature is enabled by default</p><p>In Gaia Clish / Gaia gClish:</p><ol><li>Get the current state:<br><em>show dynamic-balancing state</em></li><li>If disabled, then enable and reboot:<br><em>set dynamic-balancing state enable</em><br><em>reboot</em></li><li>If enabled but stopped, then start (without reboot):<br><em>set dynamic-balancing state start</em></li></ol><p>In the Expert mode:</p><ol><li>Get the current state:<br><em>dynamic_split -p</em></li><li>If disabled, then enable and reboot:<br><em>dynamic_split -o enable</em><br><em>reboot</em></li><li>If enabled but stopped, then start (without reboot):<br><em>dynamic_split -o start</em></li></ol></td></tr><tr><td>Debug</td><td>None</td></tr><tr><td id=\"Security Gateway Software Blades and Features - VSX\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">VSX</td></tr><tr><td rowspan=\"8\"><p><em>CPUS_USGS</em></p></td><td>Description</td><td><p>Special task in the Check Point WatchDog on a Scalable Platform Security Group in the VSX mode (Maestro and Chassis) in R81.20 and higher.</p><p>This task runs a Python script that collects the Resource Control data (CPU and Memory utilization) from each Virtual System and sends it to the \"asg perf\" tool.</p></td></tr><tr><td>Path</td><td><em>/usr/scripts/get_cpus_usages/get_cpus_usages</em></td></tr><tr><td>Log File</td><td><em>/var/log/cpus_usages.log<br>/tmp/cpus_usages.txt</em></td></tr><tr><td>To See the Current Status</td><td><em>service get_cpus_usages status</em></td></tr><tr><td>To Stop</td><td><em>service get_cpus_usages stop</em></td></tr><tr><td>To Start</td><td><em>service get_cpus_usages start</em></td></tr><tr><td>To Restart</td><td><em>service get_cpus_usages restart</em></td></tr><tr><td>Debug</td><td>Standard Python script debugging</td></tr><tr><td id=\"Security Gateway Software Blades and Features - SD-WAN\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">SD-WAN</td></tr><tr><td rowspan=\"9\"><p><em>sdwan_steering</em></p></td><td>Description</td><td>SD-WAN steering process (see <a href=\"https://support.checkpoint.com/results/sk/sk180605\" target=\"_blank\" rel=\"noopener\">sk180605</a>)</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/sdwan_steering</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/sdwan_steering.elg<br></em></td></tr><tr><td>Configuration File</td><td><em>$FWDIR/conf/sdwan/sdwan_steering_params.json</em></td></tr><tr><td>Policy File</td><td><em>$FWDIR/state/local/SDWAN/sdwan_steering_policy.json</em></td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|SDWAN_STEERING\"</em></td></tr><tr><td>To Stop</td><td><em>sdwan_steering_stop -name FWD -path \"$FWDIR/bin/sdwan_steering\" -command \"sdwan_steering_stop\"</em></td></tr><tr><td>To Start</td><td><em>sdwan_steering_start -name FWD -path \"$FWDIR/bin/sdwan_steering\" -command \"sdwan_steering_start\"</em></td></tr><tr><td>Debug</td><td><ol><li>Start debug:<br><em>fw debug sdwan_steering on TDERROR_ALL_SDWAN=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug sdwan_steering off TDERROR_ALL_SDWAN=0</em></li><li>Analyze:<br><em>$FWDIR/log/sdwan_steering.elg</em></li></ol></td></tr></tbody></table>\n\n<table id=\"Filter_4Table\"><tbody><tr data-darkreader-inline-bgcolor=\"\"><td>Daemon</td><td>Section</td><td>Information</td></tr><tr><td id=\"Security Management Software Blades and Features - Network Policy Management Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Network Policy Management Blade</td></tr><tr><td rowspan=\"8\"><p>cpm</p></td><td>Description</td><td><p>From Security Management Server R80:</p><ul><li>Serves requests from SmartConsole</li><li>Responsible for writing all information to the PostgreSQL and SOLR databases</li></ul></td></tr><tr><td>Path</td><td><em>$FWDIR/scripts/cpm.sh</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cpm.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CPM</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CPM\"</em></td></tr><tr><td>To Stop</td><td><p><em>cpstop</em></p>In addition, you can use the <em>ngm_stop.sh</em> script (refer to <a href=\"https://support.checkpoint.com/results/sk/sk111772\" target=\"_blank\" rel=\"noopener\">sk111772</a>):<br><ul><li><em>$FWDIR/scripts/ngm_stop.sh</em><br>(refer to <em>$FWDIR/log/ngm_stop.elg</em>)</li><li><em>$MDS_TEMPLATE/scripts/ngm_stop.sh</em><br>(refer to <em>$MDS_TEMPLATE/log/ngm_stop.elg</em>)</li></ul></td></tr><tr><td>To Start</td><td><p><em>cpstart</em></p>In addition, you can use the <em>ngm_start.sh</em> script (refer to <a href=\"https://support.checkpoint.com/results/sk/sk111772\" target=\"_blank\" rel=\"noopener\">sk111772</a>):<br><ul><li><em>$FWDIR/scripts/ngm_start.sh</em><br>(refer to <em>$FWDIR/log/ngm_start.elg</em>)</li><li><em>$MDS_TEMPLATE/scripts/ngm_start.sh</em><br>(refer to <em>$MDS_TEMPLATE/log/ngm_start.elg</em>)</li></ul></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk183144\" target=\"_blank\" rel=\"noopener\">sk183144</a></td></tr><tr><td rowspan=\"8\"><p>fwm</p></td><td>Description</td><td>Communication between SmartConsole applications and Security Management Server.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwm</em><br><em>%FWDIR%\\bin\\fwm</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/fwm.elg</em><br><em>%FWDIR%\\log\\fwm.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>FWM</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|FWM\"</em></td></tr><tr><td>To Stop</td><td><ul><li><p>Security Management Server:</p><p><em>cpwd_admin stop -name FWM -path \"$FWDIR/bin/fwm\" -command \"fw kill fwm\"</em></p></li><li><p>Domain Management Server on a Multi-Domain Security Management Server:</p><p><em>mdsstop_customer &lt;IP Address of Domain Management Server&gt;</em></p></li></ul>In addition, in R80 and higher, you can use the <em>ngm_stop.sh</em> script (refer to <a href=\"https://support.checkpoint.com/results/sk/sk111772\" target=\"_blank\" rel=\"noopener\">sk111772</a>):<br><ul><li><em>$FWDIR/scripts/ngm_stop.sh</em><br>(refer to <em>$FWDIR/log/ngm_stop.elg</em>)</li><li><em>$MDS_TEMPLATE/scripts/ngm_stop.sh</em><br>(refer to <em>$MDS_TEMPLATE/log/ngm_stop.elg</em>)</li></ul></td></tr><tr><td>To Start</td><td><ul><li><p>Security Management Server:</p><p><em>cpwd_admin start -name FWM -path \"$FWDIR/bin/fwm\" -command \"fwm\"</em></p></li><li><p>Domain Management Server on a Multi-Domain Security Management Server:</p><p><em>mdsstart_customer &lt;IP Address of Domain Management Server&gt;</em></p></li></ul>In addition, in R80 and higher, you can use the <em>ngm_start.sh</em> script (refer to <a href=\"https://support.checkpoint.com/results/sk/sk111772\" target=\"_blank\" rel=\"noopener\">sk111772</a>):<br><ul><li><em>$FWDIR/scripts/ngm_start.sh</em><br>(refer to <em>$FWDIR/log/ngm_start.elg</em>)</li><li><em>$MDS_TEMPLATE/scripts/ngm_start.sh</em><br>(refer to <em>$MDS_TEMPLATE/log/ngm_start.elg</em>)</li></ul></td></tr><tr><td>Debug</td><td><ul><li><p>Security Management Server - refer to <a href=\"https://support.checkpoint.com/results/sk/sk86186\" target=\"_blank\" rel=\"noopener\">sk86186</a>:</p><ol><li>Start debug:<br><em>fw debug fwm on TDERROR_ALL_ALL=5</em><br><em>fw debug fwm on OPSEC_DEBUG_LEVEL=3</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug fwm off TDERROR_ALL_ALL=0</em><br><em>fw debug fwm off OPSEC_DEBUG_LEVEL=0</em></li><li>Analyze:<br><em>$FWDIR/log/fwm.elg*</em></li></ol></li><li><p>Domain Management Server - refer to <a href=\"https://support.checkpoint.com/results/sk/sk33207\" target=\"_blank\" rel=\"noopener\">sk33207</a>:</p><ol><li>Switch to the context of the relevant Domain Management Server:<br><em>mdsenv &lt;Domain_Name&gt;</em></li><li>Start debug:<br><em>fw debug fwm on TDERROR_ALL_ALL=5</em><br><em>fw debug fwm on OPSEC_DEBUG_LEVEL=3</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug fwm off TDERROR_ALL_ALL=0</em><br><em>fw debug fwm off OPSEC_DEBUG_LEVEL=0</em></li><li>Analyze:<br><em>$FWDIR/log/fwm.elg*</em></li></ol></li><li><p>Multi-Domain Security Management Server - refer to <a href=\"https://support.checkpoint.com/results/sk/sk33208\" target=\"_blank\" rel=\"noopener\">sk33208</a>:</p><ol><li>Start debug:<br><em>fw debug mds on TDERROR_ALL_ALL=5</em><br><em>fw debug mds on OPSEC_DEBUG_LEVEL=3</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug mds off TDERROR_ALL_ALL=0</em><br><em>fw debug mds off OPSEC_DEBUG_LEVEL=0</em></li><li>Analyze:<br><em>$MDS_TEMPLATE/log/mds.elg*</em></li></ol></li></ul></td></tr><tr><td rowspan=\"7\"><p>fwmha</p></td><td>Description</td><td>Communication between Management Servers in the Management High Availability mode.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwmha</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/fwmha.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>FWMHA</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|FWMHA\"</em></td></tr><tr><td>To Stop</td><td><ul><li><p>Security Management Server:</p><p><em>cpstop</em></p></li><li><p>Domain Management Server on a Multi-Domain Security Management Server:</p><p><em>mdsstop_customer &lt;IP Address of Domain Management Server&gt;</em></p></li></ul></td></tr><tr><td>To Start</td><td><em>cpstop</em></td></tr><tr><td rowspan=\"7\"><p>java_repository_manager</p></td><td>Description</td><td><p>This process exists starting from the R81 version.</p><p>Repository Manager for central installation of Hotfixes and Upgrade Packages from SmartConsole</p></td></tr><tr><td>Path</td><td><em>$REPMANDIR/bin/java_repository_manager</em></td></tr><tr><td>Log File</td><td><ul><li><em>$REPMANDIR/log/java_repository_manager.log</em></li><li><em>$REPMANDIR/log/RepositoryManager.log</em></li><li><em>$REPMANDIR/log/RepManStart.log</em></li><li><em>$REPMANDIR/log/RepManStop.log</em></li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>REPMAN</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|REPMAN\"</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td id=\"Security Management Software Blades and Features - Endpoint Policy Management Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Endpoint Policy Management Blade</td></tr><tr><td rowspan=\"6\"><p>uepm</p></td><td>Description</td><td>Endpoint Management Server.</td></tr><tr><td>Path</td><td><em>$UEPMDIR/bin/uepm</em><br><em>%UEPMDIR%\\bin\\uepm</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$UEPMDIR/logs/server_messages.log</em><br><em>%UEPMDIR%\\logs\\server_messages.log</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>To Stop</td><td><em>uepm_stop</em></td></tr><tr><td>To Start</td><td><em>uepm_start</em></td></tr><tr><td>Debug</td><td><p><em>uepm debug</em></p><p>Also refer to <a href=\"https://support.checkpoint.com/results/sk/sk92619\" target=\"_blank\" rel=\"noopener\">sk92619</a></p></td></tr><tr><td rowspan=\"4\"><p>httpd</p></td><td>Description</td><td>Communication with Endpoint Security Clients.</td></tr><tr><td>Path</td><td><em>$UEPMDIR/apache22/bin/httpd</em><br><em>%UEPMDIR%\\apache22\\bin\\httpd</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>To Stop</td><td><em>uepm_stop</em></td></tr><tr><td>To Start</td><td><em>uepm_start</em></td></tr><tr><td id=\"Security Management Software Blades and Features - Monitoring Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Monitoring Blade</td></tr><tr><td rowspan=\"8\"><p>rtmd</p></td><td>Description</td><td>Real Time traffic statistics.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/rtm</em><br><em>%FWDIR%\\bin\\rtm</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/rtmd.elg</em><br><em>%FWDIR%\\log\\rtmd.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>RTMD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|RTMD\"</em></td></tr><tr><td>To Stop</td><td><em>rtmstop</em></td></tr><tr><td>To Start</td><td><em>rtmstart</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/skI2821\" target=\"_blank\" rel=\"noopener\">skI2821</a><ol><li>Start debug:<br><em>rtm debug on TDERROR_ALL_ALL=5</em><br><em>rtm debug on OPSEC_DEBUG_LEVEL=3</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>rtm debug off TDERROR_ALL_ALL=0</em><br><em>rtm debug off OPSEC_DEBUG_LEVEL=0</em></li><li>Analyze:<br><em>$FWDIR/log/rtmd.elg*</em></li></ol></td></tr><tr><td rowspan=\"8\"><p>cpstat_monitor</p></td><td>Description</td><td>Responsible for collecting and sending information to SmartView Monitor.<br>By default, does not run in the context of Domain Management Servers.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cpstat_monitor</em><br><em>%FWDIR%\\bin\\cpstat_monitor</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cpstat_monitor.elg</em><br><em>%FWDIR%\\log\\cpstat_monitor.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CPSM</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CPSM\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name CPSM</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name CPSM -path \"$FWDIR/bin/cpstat_monitor\" -command \"cpstat_monitor\"</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk108177\" target=\"_blank\" rel=\"noopener\">sk108177</a></td></tr><tr><td id=\"Security Management Software Blades and Features - Provisioning Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Provisioning Blade</td></tr><tr><td rowspan=\"8\"><p>status_proxy</p></td><td>Description</td><td>Status collection of ROBO Gateways - SmartLSM / SmartProvisioning status proxy.<br>This process runs only on Security Management Server / Domain Management Servers that are activated for Large Scale Management / SmartProvisioning.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/status_proxy</em><br><em>%FWDIR%\\bin\\status_proxy</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/status_proxy.elg</em><br><em>%FWDIR%\\log\\status_proxy.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>STPR</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|STPR\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name STPR</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name STPR -path \"$FWDIR/bin/status_proxy\" -command \"status_proxy\"</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk108182\" target=\"_blank\" rel=\"noopener\">sk108182</a></td></tr><tr><td id=\"Security Management Software Blades and Features - SmartReporter Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">SmartReporter Blade</td></tr><tr><td rowspan=\"8\"><p>SVRServer</p></td><td>Description</td><td>Controller for the SmartReporter product.<br>Traffic is sent over SSL.</td></tr><tr><td>Path</td><td><em>$RTDIR/bin/SVRServer</em><br><em>%RTDIR%\\bin\\SVRServer</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$RTDIR/log/SVRServer.log</em><br><em>%RTDIR%\\log\\SVRServer.log</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>SVR</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|SVR\"</em></td></tr><tr><td>To Stop</td><td><em>rmdstop</em><br>or<br><em>cpwd_admin stop -name SVR -path $RTDIR/bin/SVRServer -command \"SVRServer kill SVRServer\"</em><p>Also refer to <a href=\"https://support.checkpoint.com/results/sk/sk105485\" target=\"_blank\" rel=\"noopener\">sk105485</a></p></td></tr><tr><td>To Start</td><td><em>rmdstart</em><br>or<br><em>cpwd_admin start -name SVR -path \"$RTDIR/bin/SVRServer\" -command \"SVRServer\"</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk93970\" target=\"_blank\" rel=\"noopener\">sk93970</a></td></tr><tr><td rowspan=\"8\"><p>log_consolidator</p></td><td>Description</td><td>Log Consolidator for the SmartReporter product.</td></tr><tr><td>Path</td><td><em>$RTDIR/log_consolidator_engine/bin/log_consolidator</em><br><em>%RTDIR%\\log_consolidator_engine\\bin\\log_consolidator</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$RTDIR/log_consolidator_engine/log/&lt;Log_Server_IP_Address&gt;/lc_rt.log</em><br><em>%RTDIR%\\log_consolidator_engine\\log\\&lt;Log_Server_IP_Address&gt;\\lc_rt.log</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Configuration File</td><td><ul><li><em>$RTDIR/log_consolidator_engine/conf/lc_rt_default.conf</em></li><li><em>%RTDIR%\\log_consolidator_engine\\conf\\lc_rt_default.conf</em> (R77.30 and lower on Windows OS)</li><li><em>$RTDIR/log_consolidator_engine/conf/&lt;Log_Server_IP_Address&gt;/lc_rt_default.conf</em></li><li><em>%RTDIR%\\log_consolidator_engine\\conf\\&lt;Log_Server_IP_Address&gt;\\lc_rt_default.conf</em> (R77.30 and lower on Windows OS)</li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>LC_&lt;IP_Address _of_Log_Server&gt;</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|LC_\"</em></td></tr><tr><td>To Stop</td><td><p><em>rmdstop</em></p><p>or</p><p><em>evstop</em></p><p>or</p><p><em>log_consolidator -C -m stop -s &lt;IP_Address _of_Log_Server&gt; [-g &lt;Domain_Name&gt;]</em><br>and then<br><em>log_consolidator -C -m exit -s &lt;IP_Address _of_Log_Server&gt; [-g &lt;Domain_Name&gt;]</em></p></td></tr><tr><td>To Start</td><td><em>rmdstart</em><br>or<br><em>evstart</em><br>or<br><em>log_consolidator -C -m start -s &lt;IP_Address _of_Log_Server&gt; [-g &lt;Domain_Name&gt;]</em></td></tr><tr><td rowspan=\"8\"><p>dbsync</p></td><td>Description</td><td>DBsync enables SmartReporter to synchronize data stored in different parts of the network. After SIC is established, DBsync connects to the management server to retrieve all the objects. After the initial synchronization, it gets updates whenever an object is saved. In distributed information systems, DBsync provides one-way synchronization of data between the Security Management Servers object database and the SmartReporter computer, and supports configuration and administration of distributed systems.</td></tr><tr><td>Path</td><td><em>$RTDIR/bin/dbsync</em><br><em>%RTDIR%\\bin\\dbsync</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><ul><li>In R80 and higher:<br><em>$FWDIR/log/dbsync.elg</em></li><li>R77.30 and lower:<br><em>$RTDIR/log/dbsync.elg</em><br><em>%RTDIR%\\log\\dbsync.elg</em> (on Windows OS)</li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>DBSYNC</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|DBSYNC\"</em></td></tr><tr><td>To Stop</td><td><ul><li>In R80 and higher:<br>Runs as part of CPM</li><li>In R77.30 and lower:<br><em>rmdstop</em><br>or<br><em>evstop</em><br>or<br><em>cpwd_admin stop -name DBSYNC</em></li></ul></td></tr><tr><td>To Start</td><td><ul><li>In R80 and higher:<br>Runs as part of CPM</li><li>In R77.30 and lower:<br><em>rmdstart</em><br>or<br><em>evstart</em><br>or<br><em>cpwd_admin start -name DBSYNC -path \"$RTDIR/bin/dbsync\" -command \"dbsync\"</em></li></ul></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk93970\" target=\"_blank\" rel=\"noopener\">sk93970</a></td></tr><tr><td rowspan=\"7\"><p>postgres</p></td><td>Description</td><td>PostgreSQL server.</td></tr><tr><td>Path</td><td><ul><li><em>$CPDIR/database/postgresql/bin/postgres</em></li><li><em>%CPDIR%\\database\\postgresql\\bin\\postgres<br></em>(R77.30 and lower on Windows OS)</li></ul></td></tr><tr><td>Log File</td><td><em>$RTDIR/events_db/data/pg_log/postgresql-YYY-MM-DD_HHMMSS.log</em></td></tr><tr><td>Configuration File</td><td><p>The path depends on the software version.<br>Your server may not contain all the files listed below.</p><ul><li><em>$CPDIR/conf/postgresql/postgresql.conf</em></li><li><em>$CPDIR/database/postgresql/data/postgresql.conf<br></em>or using another env variable:<br><em>$PGDATA/postgresql.conf</em></li><li><em><em>$RTDIR/events_db/data/postgresql.conf</em></em></li></ul></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>\"<em>su cp_postgres -c \"$CPDIR/database/postgresql/bin/pg_ctl -D $RTDIR/events_db/data start</em>\"</p><p>Also refer to <a href=\"https://support.checkpoint.com/results/sk/sk93970\" target=\"_blank\" rel=\"noopener\">sk93970</a></p></td></tr><tr><td id=\"Security Management Software Blades and Features - SmartEvent Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">SmartEvent Blade</td></tr><tr><td rowspan=\"8\"><p>cpsead</p></td><td>Description</td><td>Responsible for Correlation Unit functionality.</td></tr><tr><td>Path</td><td><em>$RTDIR/bin/cpsead</em><br><em>%RTDIR%\\bin\\cpsead</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$RTDIR/log/cpsead.elg</em><br><em>%RTDIR%\\log\\cpsead.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CPSEAD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CPSEAD\"</em></td></tr><tr><td>To Stop</td><td><em>evstop</em><br>or<br><em>cpwd_admin stop -name CPSEAD</em><p>Also refer to <a href=\"https://support.checkpoint.com/results/sk/sk105485\" target=\"_blank\" rel=\"noopener\">sk105485</a></p></td></tr><tr><td>To Start</td><td><em>evstart</em><br>or<br><em>cpwd_admin start -name CPSEAD -path \"$RTDIR/bin/cpsead\" -command \"cpsead\"</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk95153\" target=\"_blank\" rel=\"noopener\">sk95153</a>, <a href=\"https://support.checkpoint.com/results/sk/sk105806\" target=\"_blank\" rel=\"noopener\">sk105806</a>, <a href=\"https://support.checkpoint.com/results/sk/sk93970\" target=\"_blank\" rel=\"noopener\">sk93970</a></td></tr><tr><td rowspan=\"8\"><p>cpsemd</p></td><td>Description</td><td>Responsible for logging into the SmartEvent GUI.</td></tr><tr><td>Path</td><td><em>$RTDIR/bin/cpsemd</em><br><em>%RTDIR%\\bin\\cpsemd</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$RTDIR/log/cpsemd.elg</em><br><em>%RTDIR%\\log\\cpsemd.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CPSEMD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CPSEMD\"</em></td></tr><tr><td>To Stop</td><td><em>evstop</em><br>or<br><em>cpwd_admin stop -name CPSEMD</em></td></tr><tr><td>To Start</td><td><em>evstart</em><br>or<br><em>cpwd_admin start -name CPSEMD -path \"$RTDIR/bin/cpsemd\" -command \"cpsemd\"</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk95153\" target=\"_blank\" rel=\"noopener\">sk95153</a>, <a href=\"https://support.checkpoint.com/results/sk/sk105806\" target=\"_blank\" rel=\"noopener\">sk105806</a>, <a href=\"https://support.checkpoint.com/results/sk/sk93970\" target=\"_blank\" rel=\"noopener\">sk93970</a></td></tr><tr><td rowspan=\"8\"><p>dbsync</p></td><td>Description</td><td>DBsync enables SmartEvent to synchronize data stored in different parts of the network.<br>In distributed information systems, DBsync provides one-way synchronization of data between the Security Management Server's object database and the SmartEvent computer, and supports configuration and administration of distributed systems.<br>DBsync initially connects to the Management Server, with which SIC is established.<br>It retrieves all the objects and after the initial synchronization it gets updates whenever an object is saved.</td></tr><tr><td>Path</td><td><em>$RTDIR/bin/dbsync</em><br><em>%RTDIR%\\bin\\dbsync</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$RTDIR/log/dbsync.elg</em><br><em>%RTDIR%\\log\\dbsync.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>DBSYNC</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|DBSYNC\"</em></td></tr><tr><td>To Stop</td><td><em>evstop</em><br>or<br><em>cpwd_admin stop -name DBSYNC</em></td></tr><tr><td>To Start</td><td><em>evstart</em><br>or<br><em>cpwd_admin start -name DBSYNC -path \"$RTDIR/bin/dbsync\" -command \"dbsync\"</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk93970\" target=\"_blank\" rel=\"noopener\">sk93970</a></td></tr><tr><td rowspan=\"9\"><p>java_solr</p></td><td>Description</td><td><p>Starting in R80 (SmartEvent NGSE was integrated).</p><p>Jetty Server.</p><p>Events are stored in the SOLR database.</p></td></tr><tr><td>Path</td><td><em>$RTDIR/bin/java_solr</em></td></tr><tr><td>Log File</td><td><ul><li><em>$RTDIR/log/solr.log</em></li><li><em>$RTDIR/log/solrRun.log</em></li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>SOLR</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|SOLR\"</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$RTDIR/rfl_server/solr/solr.xml</em> (R80.10 and higher)</li><li><em>$RTDIR/conf/jetty.xml</em> (R80 and higher)</li><li><em>$RTDIR/conf/solr.log4j.properties</em> (R80 and higher)</li><li><em>$RTDIR/conf/solrConnectionConfig.xml</em> (R80 and higher)</li><li><em>$RTDIR/log_indexes/solr.xml</em> (R80 and higher)</li></ul></td></tr><tr><td>To Stop</td><td><em>evstop</em></td></tr><tr><td>To Start</td><td><em>evstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk105806\" target=\"_blank\" rel=\"noopener\">sk105806</a>.</p><ol><li><em>SmartEventSetDebugLevel solr &lt;Debug_Level&gt;</em></li><li><em>$FWDIR/scripts/solr_debug.py {on | off}</em></li></ol></td></tr><tr><td rowspan=\"9\"><p>LogCore</p></td><td>Description</td><td><p>Starting in R80 (SmartEvent NGSE was integrated).</p><p>Manages the queries it gets from the consumer processes, forwards them to SOLR database and returns the results. Also in charge of resolving and database maintenance (clean up old indexes to have space for the new ones).</p></td></tr><tr><td>Path</td><td><em>$RTDIR/bin/LogCore</em></td></tr><tr><td>Log File</td><td><ul><li><em>$RTDIR/log/RFL.log</em></li><li><em>$RTDIR/log/rflRun.log</em></li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>RFL</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|RFL\"</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$RTDIR/conf/rfl.log4j.properties</em></li><li><em>$RTDIR/conf/rfl.log4j.properties.forUpgrade</em></li><li><em>$RTDIR/conf/rflConfig.xml</em></li></ul></td></tr><tr><td>To Stop</td><td><em>evstop</em></td></tr><tr><td>To Start</td><td><em>evstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk105806\" target=\"_blank\" rel=\"noopener\">sk105806</a>.</p><em>SmartEventSetDebugLevel rfl &lt;Debug_Level&gt;</em></td></tr><tr><td rowspan=\"9\"><p>SmartView</p></td><td>Description</td><td><p>SmartEvent Web Application that allows you to connect to SmartEvent NGSE server (at <em>https://&lt;IP_Address_of_SmartEvent_Server&gt;/smartview/</em>) and see the event views and analysis directly from a Web Browser, without installing SmartConsole. The Web page comes with predefined views that you can customize.</p><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk105684\" target=\"_blank\" rel=\"noopener\">sk105684</a>.</p></td></tr><tr><td>Path</td><td><em>$RTDIR/bin/SmartView</em></td></tr><tr><td>Log File</td><td><ul><li><em>$RTDIR/log/smartview.log</em></li><li><em>$RTDIR/log/SmartViewRun.log</em></li><li><em>$RTDIR/log/smartview-service.log</em></li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>SMARTVIEW</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|SMARTVIEW\"</em></td></tr><tr><td>Configuration File</td><td><em>$RTDIR/conf/smartview.log4j.properties</em></td></tr><tr><td>To Stop</td><td><em>evstop</em></td></tr><tr><td>To Start</td><td><em>evstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk105806\" target=\"_blank\" rel=\"noopener\">sk105806</a>.</p><em>SmartEventSetDebugLevel smartview &lt;Debug_Level&gt;</em></td></tr><tr><td rowspan=\"8\"><p>log_indexer</p></td><td>Description</td><td><p>Starting in R80 (SmartEvent NGSE was integrated).</p>Log indexer.</td></tr><tr><td>Path</td><td><em>$RTDIR/log_indexer/log_indexer</em></td></tr><tr><td>Log File</td><td><em>$RTDIR/log_indexer/log/log_indexer.elg</em><br><em>$RTDIR/log_indexer/log/log_indexerRun.log</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>INDEXER</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|INDEXER\"</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$RTDIR/log_indexer/conf/log_indexer_settings.conf</em></li><li><em>$RTDIR/log_indexer/log_indexer_custom_settings.conf</em></li></ul></td></tr><tr><td>To Stop</td><td><p><em>evstop</em></p><p>Important - On a Multi-Domain Server, the <em>evstop</em> command stops the <em>log_indexer</em> process for all levels (MDS and Domains)</p></td></tr><tr><td>To Start</td><td><ul><li>On a Security Management Server:<br><em>evstart</em></li><li>On a Multi-Domain Server - for MDS context only:<br><em>evstart</em></li><li>On a Multi-Domain Server - for MDS context and Domain contexts:<br><em>mdsstart</em></li></ul></td></tr><tr><td rowspan=\"7\"><p>postgres</p></td><td>Description</td><td>PostgreSQL server.</td></tr><tr><td>Path</td><td><ul><li><em>$CPDIR/database/postgresql/bin/postgres</em></li><li><em>%CPDIR%\\database\\postgresql\\bin\\postgres</em> (R77.30 and lower on Windows OS)</li></ul></td></tr><tr><td>Log File</td><td><em>$RTDIR/events_db/data/pg_log/postgresql-YYY-MM-DD_HHMMSS.log</em></td></tr><tr><td>Configuration File</td><td><em>$RTDIR/events_db/data/postgresql.conf</em></td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>\"<em>su cp_postgres -c \"$CPDIR/database/postgresql/bin/pg_ctl -D $RTDIR/events_db/data start</em>\"</p><p>Also refer to <a href=\"https://support.checkpoint.com/results/sk/sk93970\" target=\"_blank\" rel=\"noopener\">sk93970</a></p></td></tr><tr><td id=\"Security Management Software Blades and Features - Logging &amp; Status Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Logging &amp; Status Blade</td></tr><tr><td rowspan=\"6\"><p>cplmd</p></td><td>Description</td><td>To get the data that should be presented in SmartView Tracker, the FWM spawns a child process CPLMD, which reads the information from the log file and performs unification (if necessary).<br>Upon receiving an answer from CPLMD, FWM transfers it to SmartView Tracker.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cplmd</em><br><em>%FWDIR%\\bin\\cplmd</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cplmd.elg</em><br><em>%FWDIR%\\log\\cplmd.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk86324\" target=\"_blank\" rel=\"noopener\">sk86324</a>:</p><ol><li>Start debug:<br><em>fw debug cplmd on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug cplmd off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/cplmd.elg*</em></li></ol></td></tr><tr><td id=\"Security Management Software Blades and Features - Management Portal\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Management Portal</td></tr><tr><td rowspan=\"8\"><p>cpwmd</p></td><td>Description</td><td>Check Point Web Management Daemon - back-end for Management Portal / SmartPortal.</td></tr><tr><td>Path</td><td><em>$WEBDIR/bin/cpwmd</em><br><em>%WEBDIR%\\bin\\cpwmd</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>/opt/CPportal-&lt;RXX&gt;/portal/log/cpwmd.elg</em><br><em>C:\\Program Files\\CheckPoint\\SmartPortal\\&lt;RXX&gt;\\SmartPortal\\log\\cpwmd.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CPWMD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CPWMD\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name CPWMD</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name CPWMD -path \"$WEBDIR/bin/cpwmd\" -command \"cpwmd -D -app SmartPortal\"</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk31023\" target=\"_blank\" rel=\"noopener\">sk31023</a></td></tr><tr><td rowspan=\"9\"><p>cp_http_server</p></td><td>Description</td><td>HTTP Server for Management Portal (SmartPortal) and for OS WebUI.</td></tr><tr><td>Path</td><td><em>$WEBDIR/bin/cp_http_server</em><br><em>%WEBDIR%\\bin\\cp_http_server</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk31023\" target=\"_blank\" rel=\"noopener\">sk31023</a>; <a href=\"https://support.checkpoint.com/results/sk/sk30634\" target=\"_blank\" rel=\"noopener\">sk30634</a></td></tr><tr><td>Configuration File</td><td><em>$MPDIR/conf/cp_httpd_admin.conf</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CPHTTPD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CPHTTPD\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name CPHTTPD</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name CPHTTPD -path \"$WEBDIR/bin/cp_http_server\" -command \"cp_http_server -f '$MPDIR/conf/cp_httpd_admin.conf'\"</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk31023\" target=\"_blank\" rel=\"noopener\">sk31023</a></td></tr><tr><td id=\"Security Management Software Blades and Features - SmartLog\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">SmartLog</td></tr><tr><td rowspan=\"8\"><p>smartlog_server</p></td><td>Description</td><td>SmartLog product.</td></tr><tr><td>Path</td><td><em>$SMARTLOGDIR/smartlog_server</em></td></tr><tr><td>Log File</td><td><em>$SMARTLOGDIR/log/smartlog_server.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>SMARTLOG_SERVER</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|SMARTLOG_SERVER\"</em></td></tr><tr><td>To Stop</td><td><em>smartlogstop</em></td></tr><tr><td>To Start</td><td><em>smartlogstart</em></td></tr><tr><td>Debug</td><td><ol><li>Stop SmartLog:<br><em>smartlogstop</em></li><li>Start SmartLog under debug:<br><em>env TDERROR_ALL_ALL=5 $SMARTLOGDIR/smartlog_server 1&gt;&gt; /var/log/smartlog.debug 2&gt;&gt; /var/log/smartlog.debug</em></li><li>Replicate the issue</li><li>Stop debug - press CTRL+C.</li><li>Start SmartLog normally:<br><em>smartlogstart</em></li></ol></td></tr><tr><td id=\"Security Management Software Blades and Features - Internal CA\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Internal CA</td></tr><tr><td rowspan=\"6\"><p>cpca</p></td><td>Description</td><td><p>Check Point Internal Certificate Authority (ICA):</p><ul><li>SIC certificate pulling</li><li>Certificate enrollment</li><li>CRL fetch</li><li>Admin WebUI</li></ul><p>Note: By default, in MGMT HA, it runs only on \"Active\" Security Management Server. On the \"Backup\" Security Management Server, the \"<code>cpstat mg</code>\" command will show \"<code>SmartCenter CA is not running</code>\".</p></td></tr><tr><td>Path</td><td><em>$FWDIR/bin/cpca</em><br><em>%FWDIR%\\bin\\cpca</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cpca.elg</em><br><em>%FWDIR%\\log\\cpca.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>To Stop</td><td><ul><li><p>Security Management Server:</p><p><em>cpstop</em></p></li><li><p>Domain Management Server on a Multi-Domain Security Management Server:</p><p><em>mdsstop_customer &lt;IP Address of Domain Management Server&gt;</em></p></li></ul></td></tr><tr><td>To Start</td><td><ul><li><p>Security Management Server:</p><p><em>cpstart</em></p></li><li><p>Domain Management Server on a Multi-Domain Security Management Server:</p><p><em>mdsstart_customer &lt;IP Address of Domain Management Server&gt;</em></p></li></ul></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk60338\" target=\"_blank\" rel=\"noopener\">sk60338</a>:</p><ol><li>Start debug:<br><em>fw debug cpca on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug cpca off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/cpca.elg*</em></li></ol></td></tr><tr><td id=\"Security Management Software Blades and Features - Compliance Blade\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">Compliance Blade</td></tr><tr><td rowspan=\"8\"><p>interpreter</p></td><td>Description</td><td>Process is responsible for Compliance Blade database scan.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/interpreter</em><br><em>%FWDIR%\\bin\\interpreter</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Log File</td><td><ul><li>In R77 and higher:<br><em>$FWDIR/log/grc_interpreter.elg</em><br><em>%FWDIR%\\log\\grc_interpreter.elg</em> (on Windows OS)</li><li>In R76:<br><em>/opt/CPPIgrc-R76/bin/grc_interpreter.elg</em></li><li>In R75.40/R75.45/R75.46/R75.47:<br><em>/opt/CPPIgrc-R75.40/bin/grc_interpreter.elg</em></li></ul></td></tr><tr><td>Configuration File</td><td><em>$FWDIR/conf/grc.conf</em> (R77 and higher)<br><em>%FWDIR%\\conf\\grc.conf</em> (R77.X on Windows OS)</td></tr><tr><td>Notes</td><td>This process is <em>not</em> monitored by Check Point WatchDog.</td></tr><tr><td>To Stop</td><td><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpstart</em></td></tr><tr><td>Debug</td><td><ul><li>In R77 and higher:<br><ol><li>Stop Check Point service with \"<em>cpstop</em>\" command</li><li>Either run \"<em>interpreter debug=1</em>\" command,<br>or in configuration file \"<em>grc.conf</em>\", manually set the value of \"<em>debugMode</em>\" from \"0\" to \"1\"</li><li>Start Check Point service with \"<em>cpstart</em>\" command</li></ol></li><li>In R75.4x, R76:<br><ol><li>Stop Check Point service with \"<em>cpstop</em>\" command</li><li>In configuration file \"<em>grc.conf</em>\", manually set the value of \"<em>debugMode</em>\" from \"0\" to \"1\"</li><li>Start Check Point service with \"<em>cpstart</em>\" command</li></ol></li></ul><br>In addition, refer to the \"<em>interpreter -help</em>\" command and to <a href=\"https://support.checkpoint.com/results/sk/sk92861\" target=\"_blank\" rel=\"noopener\">sk92861</a></td></tr><tr><td id=\"Security Management Software Blades and Features - SofaWare Management Server\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">SofaWare Management Server (Service Center for centrally managed Edge devices)</td></tr><tr><td rowspan=\"8\"><p>sms</p></td><td>Description</td><td>Manages communication (status collection, logs collection, policy update, configuration update) with UTM-1 Edge Security Gateways.<br>This process runs only on Security Management Server / Multi-Domain Security Management Servers that manage UTM-1 Edge devices.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/sms</em><br><em>%FWDIR%\\bin\\sms</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Configuration File</td><td><em>$FWDIR/conf/sofaware/SWManagementServer.ini</em><br><em>%FWDIR%\\conf\\sofaware\\SWManagementServer.ini</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>VPN-1 Embedded Connector</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|Embedded\"</em></td></tr><tr><td>To Stop</td><td><em>smsstop</em></td></tr><tr><td>To Start</td><td><em>smsstart</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk60780\" target=\"_blank\" rel=\"noopener\">sk60780</a></td></tr><tr><td id=\"Security Management Software Blades and Features - OPSEC LEA\" colspan=\"3\" data-darkreader-inline-bgcolor=\"\">OPSEC LEA (Log Export API)</td></tr><tr><td rowspan=\"8\"><p>lea_session</p></td><td>Description</td><td>Responsible for OPSEC LEA session between the OPSEC LEA Client and the OPSEC LEA Server on Check Point Management Server / Log Server.<br>Spawned by the FWD daemon.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/lea_session</em><br><em>%FWDIR%\\bin\\lea_session</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Configuration File</td><td><em>$FWDIR/conf/fwopsec.conf</em><br><em>%FWDIR%\\conf\\fwopsec.conf</em> (R77.30 and lower on Windows OS)<p>Refer to \"<code>lea_server</code>\" lines</p></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/lea_session.&lt;PID&gt;.elg</em><br><em>%FWDIR%\\log\\lea_session.&lt;PID&gt;.elg</em> (R77.30 and lower on Windows OS)</td></tr><tr><td>Notes</td><td>The \"<em>top</em>\" and \"<em>ps</em>\" commands show the process as \"<em>lea_session</em>\"</td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name FWD -path \"$FWDIR/bin/fw\" -command \"fw kill fwd\"</em><br>or<br><em>cpstop</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name FWD -path \"$FWDIR/bin/fw\" -command \"fwd\"</em><br>or<br><em>cpstart</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk86321\" target=\"_blank\" rel=\"noopener\">sk86321</a><ol><li>Start debug:<br><em>fw debug fwd on TDERROR_ALL_ALL=5</em><br><em>fw debug fwd on OPSEC_DEBUG_LEVEL=3</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug fwd off TDERROR_ALL_ALL=0</em><br><em>fw debug fwd off OPSEC_DEBUG_LEVEL=0</em></li><li>Analyze:<br><em>$FWDIR/log/lea_session.&lt;PID&gt;.elg*</em></li></ol></td></tr></tbody></table>\n\n<table id=\"Filter_5Table\"><tbody><tr data-darkreader-inline-bgcolor=\"\"><td>Daemon</td><td>Section</td><td>Information</td></tr><tr><td rowspan=\"7\"><p>sfwd</p></td><td>Description</td><td><p>Main process:</p><ul><li>Logging</li><li>Policy installation</li><li>VPN negotiation</li><li>Identity Awareness enforcement</li><li>UserCheck enforcement</li><li>etc.</li></ul></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/sfwd.elg</em><br>Also refer to <em>$FWDIR/log/cpwd.elg</em></td></tr><tr><td>Notes</td><td><ul><li>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>SFWD</em>\".</li><li>The \"<em>ps auxw</em>\" command shows the process as \"<em>fw sfwd</em>\".</li></ul></td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|SFWD\"</em></td></tr><tr><td>To Stop</td><td><em>$FWDIR/bin/cpwd_admin stop -name SFWD</em></td></tr><tr><td>To Start</td><td><em>$FWDIR/bin/cpwd_admin start -name SFWD -path $FWDIR/bin/fw -command \"fw sfwd\"</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk86321\" target=\"_blank\" rel=\"noopener\">sk86321</a></td></tr><tr><td rowspan=\"6\"><p>cposd</p></td><td>Description</td><td>SMB-specific daemon responsible for OS Networking operations.</td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cposd.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>cposd</em>\".</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|cposd\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name cposd</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name cposd -path /pfrm2.0/bin/cposd -command \"cposd\"</em></td></tr><tr><td rowspan=\"6\"><p>rtdbd</p></td><td>Description</td><td>Real Time database daemon.</td></tr><tr><td>Configuration File</td><td><em>/pfrm2.0/etc/rtdbd.conf</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>RTDB</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|RTDB\"</em></td></tr><tr><td>To Stop</td><td><em>$FWDIR/bin/cpwd_admin stop -name RTDB</em></td></tr><tr><td>To Start</td><td><em>$FWDIR/bin/cpwd_admin start -name RTDB -path /pfrm2.0/bin/rtdbd -command \"rtdbd\"</em></td></tr><tr><td rowspan=\"5\"><p>dropbear</p></td><td>Description</td><td>LightWeight SSH server.<br><ul><li>This process does not exist starting from the R80.20.60 and R81.10.00 versions.</li><li>This process does not exist on 900, 700, and 600 models.</li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>dropbear</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|dropbear\"</em></td></tr><tr><td>To Stop</td><td>None</td></tr><tr><td>To Start</td><td>None</td></tr></tbody></table>\n\n<table id=\"Filter_55Table\"><tbody><tr data-darkreader-inline-bgcolor=\"\"><td>Daemon</td><td>Section</td><td>Information</td></tr><tr><td><p>cpda.exe</p></td><td>Check Point Client connection service (Device Agent) - Check Point Endpoint Agent</td><td>Roles:<ul><li>Communication with Harmony Endpoint Server - HTTPS</li><li>Heart Beat &amp; Sync</li><li>Endpoint Authentication</li><li>Software Deployment</li><li>Managing Client State</li><li>EMON (Reporting) Data</li><li>Files &amp; Drivers Download</li><li>Policy Download</li></ul></td></tr><tr><td><p>IDAFServerHostService.exe</p></td><td>Check Point Device Auxiliary Framework Host</td><td>Roles:<ul><li>Communication with Harmony Endpoint Security Blades and with Device Agent</li><li>Policy Storage (persistent)</li><li>Provider Info Store EMON (Reporting), Harmony Endpoint Client state status and SYNC</li><li>Harmony Endpoint Security Logs Store (persistent) and Logs from each Harmony Endpoint Security Blade</li></ul></td></tr><tr><td><p>EPWD.exe</p></td><td>Check Point Endpoint Client Watchdog service</td><td>Keeps the Harmony Endpoint Security Blades, services, and processes running.</td></tr><tr><td><div><p>Imguardsvc64.exe</p></div></td><td>Check Point Capsule Docs Client Service</td><td rowspan=\"2\">Enables the Check Point Capsule Docs Client. If this service is stopped, Check Point Capsule Docs protected content will be unavailable.</td></tr><tr><td><p>Imdci.exe</p></td><td>Check Point Capsule Docs DCI Process</td></tr><tr><td><p>FDE_srv.exe</p></td><td>Check Point Full Disk Encryption</td><td>Responsible for boot protection, Preboot Authentication and providing strong encryption to ensure that only authorized users can access data stored on the machine/device.</td></tr><tr><td><p>CPFileAnlyz.exe<br>(formerly TESvc)</p></td><td><ul><li>Check Point Endpoint Threat Emulation</li><li>Check Point Harmony Agent Threat Emulation (32 bit)</li></ul></td><td>Check Point Endpoint Security File Analyzer silently protects your computer from potential malware.<p>Monitors file creations on the system, scans each file and emulates it if needed.</p></td></tr><tr><td><p>vsmon.exe</p></td><td>Check Point Endpoint Security Network Protection</td><td>Protects your network and your computer from unauthorized network access.</td></tr><tr><td><p>Compliance.exe</p></td><td>Check Point Endpoint Security Compliance</td><td>Checks conformance of the computer to the security policies.</td></tr><tr><td><p>epab_svc.exe</p></td><td>Check Point Endpoint Security Anti-Bot service</td><td>Detects bot-infected machines and prevents bot damages by blocking bot C&amp;C communications.</td></tr><tr><td><p>NEM_svc.exe</p></td><td>Check Point Endpoint Security Bitlocker Management</td><td>Our Bitlocker Management service uses APIs provided by Microsoft Windows to control and to manage Bitlocker.</td></tr><tr><td><p>RemediationService.exe</p></td><td>Check Point Endpoint Security Remediation service</td><td>Responsible for remediation of files. In practice, we quarantine a file (quarantine means creating a backup and then deleting the file) or deleting of malicious processes.</td></tr><tr><td><p>EFRService.exe</p></td><td>Check Point Endpoint Security Forensics service</td><td>Constantly monitors the system operation and gathers the information in to a dedicated database. When triggered, the <em>EFRService</em> is analyzing the collected data and generating a report.</td></tr><tr><td><p>cptrayUI.exe</p></td><td rowspan=\"2\">Check Point Endpoint Security Client UI Service</td><td>Responsible for all the UI aspects. Everything visual/graphical you can see in the Harmony Endpoint Client.</td></tr><tr><td><p>cptrayLogic.exe</p></td><td>Responsible for all Logic/Status data. Everything as far a textual and dynamic updates.</td></tr><tr><td><p>disknet.exe</p></td><td rowspan=\"3\"><ul><li>Check Point ESME Client</li><li>Check Point Endpoint Security MEPP Service</li></ul></td><td>Main Media Encryption &amp; Port Protection (MEPP) Service</td></tr><tr><td><p>ServiceRequest.exe</p></td><td>Helps support the MEPP Blade/Application</td></tr><tr><td><p>Unlock.exe</p></td><td>Used for the Access to Business Data.exe. This is the Explorer Utility used with MEPP</td></tr><tr><td><p>TracSrvWrapper.exe</p></td><td rowspan=\"4\">Check Point Endpoint Connect - Check Point Endpoint Security VPN Service</td><td>Main Remote Access/VPN Blade Service</td></tr><tr><td><p>TrGui.exe</p></td><td>Remote Access/VPN Blade UI Service</td></tr><tr><td><p>TracCAPI.exe</p></td><td>Provides access to users certificate storage for authentication. VPN service runs under SYSTEM account and can't access personal certificates of users. The TracSrvWrapper.exe service launches TracCAPI.exe under the user's account, and TracCAPI.exe reads the user's certificates.</td></tr><tr><td><p>VPN_ProxyServer.exe</p></td><td>Simulates a HTTP Server which hosts a PAC File in order to handle and use Proxy. Starting with Windows 10, PAC files cannot be accessed through a file:// protocol. Only http:// is allowed.</td></tr></tbody></table>\n\n<table id=\"Filter_6Table\"><tbody><tr data-darkreader-inline-bgcolor=\"\"><td>Daemon</td><td>Section</td><td>Information</td></tr><tr><td rowspan=\"9\"><p>mpdaemon</p></td><td>Description</td><td>On Security Gateway and Management Server.<br>Platform Portal / Multi Portal (<em>https://&lt;IP_Address&gt;/</em>).<br>Each portal has its Apache server (which can have multiple processes).<br>The <em>mpdaemon</em> process is responsible for starting these web servers.</td></tr><tr><td>Path</td><td><em>$CPDIR/bin/mpdaemon</em></td></tr><tr><td>Log File</td><td><em>$CPDIR/log/mpdaemon.elg</em><br><em>$CPDIR/log/mpclient.elg</em></td></tr><tr><td>Configuration File</td><td><em>$CPDIR/conf/mpdaemon.conf</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>MPDAEMON</em>\".</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|MPDAEMON\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name MPDAEMON</em><br>or<br><em>mpclient stopall</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name MPDAEMON -path \"$CPDIR/bin/mpdaemon\" -command \"mpdaemon $CPDIR/log/mpdaemon.elg $CPDIR/conf/mpdaemon.conf\"</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk87920\" target=\"_blank\" rel=\"noopener\">sk87920</a>:</p><ol><li>Start debug:<br><em>mpclient debug on</em><br><em>mpclient debug set TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>mpclient debug set TDERROR_ALL_ALL=0</em><br><em>mpclient debug off</em></li></ol></td></tr><tr><td rowspan=\"9\"><p>CloudGuard Controller</p></td><td>Description</td><td>CloudGuard Controller (Management Server)</td></tr><tr><td>Path</td><td><em>$VSECDIR</em></td></tr><tr><td>Log File</td><td><em>$MDS_FWDIR/log/cloud_proxy.elg</em></td></tr><tr><td>Configuration File</td><td><em>$MDS_FWDIR/conf/vsec.conf</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CLOUDGUARD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CLOUDGUARD\"</em></td></tr><tr><td>To Stop</td><td><ul><li>To stop temporarily:<br><em>vsec stop</em></li><li>To stop permanently:<br><em>vsec off</em></li></ul></td></tr><tr><td>To Start</td><td><ul><li>To start after ‘<em>vsec stop</em>’:<br><em>vsec start</em></li><li>To start after ‘<em>vsec off</em>':<br><em>vsec on</em></li></ul></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk115657\" target=\"_blank\" rel=\"noopener\">sk115657</a></p></td></tr><tr><td rowspan=\"8\"><p>avi_del_tmp_files</p></td><td>Description</td><td>Shell script (from <em>$FWDIR/bin/</em>) that periodically deletes various old temporary Anti-Virus files on Security Gateway and Management Server.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/avi_del_tmp_files</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/avi_del_tmp_files.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CI_CLEANUP</em>\".</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CI_CLEANUP\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name CI_CLEANUP</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name CI_CLEANUP -path $FWDIR/bin/avi_del_tmp_files -command \"avi_del_tmp_files\"</em></td></tr><tr><td>Debug</td><td>Standard CSH script debugging (<em>csh -x -v $FWDIR/bin/avi_del_tmp_files</em>)</td></tr><tr><td rowspan=\"9\"><p>ci_http_server</p></td><td>Description</td><td>HTTP Server for Content Inspection on a Security Gateway.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/ci_http_server</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cphttpd.elg</em></td></tr><tr><td>Configuration File</td><td><em>$FWDIR/conf/cihs.conf</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CIHS</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CIHS\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name CIHS</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name CIHS -path $FWDIR/bin/ci_http_server -command \"ci_http_server -j -f $FWDIR/conf/cihs.conf\"</em></td></tr><tr><td>Debug</td><td><ol><li>Stop:<br><em>cpwd_admin stop -name CIHS</em></li><li>Start under debug (with \"-v\" flag):<br><em>cpwd_admin start -name CIHS -path $FWDIR/bin/ci_http_server -command \"ci_http_server -v -j -f $FWDIR/conf/cihs.conf\"</em></li><li>Replicate the issue</li><li>Stop:<br><em>cpwd_admin stop -name CIHS</em></li><li>Start normally:<br><em>cpwd_admin start -name CIHS -path $FWDIR/bin/ci_http_server -command \"ci_http_server -j -f $FWDIR/conf/cihs.conf\"</em></li></ol></td></tr><tr><td rowspan=\"9\"><p>cp_http_server</p></td><td>Description</td><td>On Security Gateway and Management Server.<br>HTTP Server for OS WebUI and Management Portal (SmartPortal).</td></tr><tr><td>Path</td><td><em>$WEBDIR/bin/cp_http_server</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/cphttpd.elg</em></td></tr><tr><td>Configuration File</td><td><em>$MPDIR/conf/cp_httpd_admin.conf</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CPHTTPD</em>\".</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CPHTTPD\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name CPHTTPD</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name CPHTTPD -path \"$WEBDIR/bin/cp_http_server\" -command \"cp_http_server -f '$MPDIR/conf/cp_httpd_admin.conf'\"</em></td></tr><tr><td>Debug</td><td><ol><li>Stop:<br><em>cpwd_admin stop -name CPHTTPD</em></li><li>Start under debug (with \"-v\" flag):<br><em>cpwd_admin start -name CPHTTPD -path \"$WEBDIR/bin/cp_http_server\" -command \"cp_http_server -v -f '$MPDIR/conf/cp_httpd_admin.conf'\"</em></li><li>Replicate the issue</li><li>Stop:<br><em>cpwd_admin stop -name CPHTTPD</em></li><li>Start normally:<br><em>cpwd_admin start -name CPHTTPD -path \"$WEBDIR/bin/cp_http_server\" -command \"cp_http_server -f '$MPDIR/conf/cp_httpd_admin.conf'\"</em></li></ol></td></tr><tr><td rowspan=\"9\"><p>cpviewd</p></td><td>Description</td><td>On Security Gateway and Management Server.<br>CPView Utility daemon (<a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">sk101878</a>).</td></tr><tr><td>Path</td><td><ul><li>In R77.30 and higher:<br><em>$CPDIR/bin/cpviewd</em></li><li>In R77, R77.10, R77.20:<br><em>$FWDIR/bin/cpviewd</em></li></ul></td></tr><tr><td>Log File</td><td><ul><li>In R82 and higher:<br><ul><li>Management Server and Security Gateway:<br><em>$CPDIR/log/cpviewd.elg</em></li><li>VSX Gateway:<br><em>$CPDIR/log/cpviewd.elg.vs&lt;VSID&gt;</em></li></ul></li><li>In R81.20 and lower:<br>See the start and stop messages in <em>$CPDIR/log/cpwd.elg</em></li></ul></td></tr><tr><td>Configuration File</td><td><em>$CPDIR/conf/cpview_conf.xml</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CPVIEWD</em>\".</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CPVIEWD\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name CPVIEWD</em></td></tr><tr><td>To Start</td><td><ul><li>In R77.30 and higher:<br><em>cpwd_admin start -name CPVIEWD -path \"$CPDIR/bin/cpviewd\" -command \"cpviewd\"</em></li><li>In R77, R77,10, R77.20:<br><em>cpwd_admin start -name CPVIEWD -path \"$FWDIR/bin/cpviewd\" -command \"cpviewd\"</em></li></ul></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">sk101878</a></td></tr><tr><td rowspan=\"9\"><p>cpview_services</p></td><td>Description</td><td>On Security Gateway and Management Server.<br>CPView Utility Services daemon (<a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">sk101878</a>).</td></tr><tr><td>Path</td><td><em>$CPDIR/bin/cpview_services</em></td></tr><tr><td>Log File</td><td><ul><li>Management Server and Security Gateway:<ul><li>In R80.30 and higher:<br><em>$CPDIR/log/cpview_services.elg</em></li><li>In R77.30 - R80.20:<br><em>$CPDIR/log/hservice.elg</em></li></ul></li><li>VSX Gateway:<br><ul><li>In R80.30 and higher:<br><em>$CPDIR/log/cpview_services.elg.&lt;VSID&gt;</em></li><li>In R77.30 - R80.20:<br><em>$CPDIR/log/hservice.elg.&lt;VSID&gt;</em></li></ul></li></ul></td></tr><tr><td>Configuration File</td><td><em>$CPDIR/conf/cpview_services_conf.xml</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CPVIEWS</em>\".</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CPVIEWS\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name CPVIEWS</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name CPVIEWS -path \"$CPDIR/bin/cpview_services\" -command \"cpview_services\"</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">sk101878</a></td></tr><tr><td rowspan=\"7\"><p>cpview_historyd</p></td><td>Description</td><td>On Security Gateway and Management Server.<br>CPView Utility History daemon (<a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">sk101878</a>).</td></tr><tr><td>Path</td><td><ul><li>In R77.30 and higher:<br><em>$CPDIR/bin/cpview_historyd</em></li><li>In R77, R77.10, R77.20:<br><em>$FWDIR/bin/cpview_historyd</em></li></ul></td></tr><tr><td>Log File</td><td><em>/var/log/CPView_history/CPViewDB.dat</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>HISTORYD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|HISTORYD\"</em></td></tr><tr><td>To Stop</td><td><em>cpview --history off</em></td></tr><tr><td>To Start</td><td><em>cpview --history on</em></td></tr><tr><td rowspan=\"8\"><p>cpview_api_service</p></td><td>Description</td><td><p>This process exists starting from the R82 version.</p><p>CPView Utility API Service daemon (<a href=\"https://support.checkpoint.com/results/sk/sk101878\" target=\"_blank\" rel=\"noopener\">sk101878</a>) on a Security Gateway and a Management Server.</p></td></tr><tr><td>Path</td><td><em>$CPDIR/bin/cpview_api_service</em></td></tr><tr><td>Log File</td><td><ul><li>Management Server and Security Gateway:<br><em>$CPDIR/log/cpview_api_service.elg</em></li><li>VSX Gateway:<br><em>$CPDIR/log/cpview_api_service.elg.vs&lt;VSID&gt;</em></li></ul></td></tr><tr><td>Configuration File</td><td><em>$CPDIR/conf/cpview_api_service_conf.xml</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CVIEWAPIS</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CVIEWAPIS\"</em></td></tr><tr><td>To Stop</td><td><em>cpview --api_service off</em></td></tr><tr><td>To Start</td><td><em>cpview --api_service on</em></td></tr><tr><td rowspan=\"4\"><p>cpsnmpd</p></td><td>Description</td><td><p>On Security Gateway and Management Server:</p><ul><li>Listens on UDP port 260 and is capable of responding to SNMP queries for Check Point OIDs only (under OID .1.3.6.1.4.1.2620)</li><li>Accepts only SNMPv1</li><li>Supplied as a part of Check Point Suite (<em>$CPDIR/bin/cpsnmpd</em>)</li></ul></td></tr><tr><td>To Stop</td><td><em>killall cpsnmpd</em></td></tr><tr><td>To Start</td><td><em>cpsnmpd -p 260</em></td></tr><tr><td>Debug</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk66384\" target=\"_blank\" rel=\"noopener\">sk66384</a></td></tr><tr><td rowspan=\"9\"><p>lpd</p></td><td>Description</td><td>Log Parser Daemon - Search predefined patterns in log files</td></tr><tr><td>Path</td><td><em>$DIAGDIR/bin/lpd</em></td></tr><tr><td>Log File</td><td><em>$FWDIR/log/lpd.elg</em></td></tr><tr><td>Configuration File</td><td><em>$DIAGDIR/signatures/sdb.dat</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>LPD</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|LPD\"</em></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name LPD</em></td></tr><tr><td>To Start</td><td><em>cpwd_admin start -name LPD -path \"$DIAGDIR/bin/lpd\" -command \"lpd\"</em></td></tr><tr><td>Debug</td><td><ul><li>Start debug:<br><em>fw debug lpd on TDERROR_ALL_ALL=5</em></li><li>Stop debug:<br><em>fw debug lpd off TDERROR_ALL_ALL=0</em></li><li>Replicate the issue</li><li>Analyze:<br><em>$FWDIR/log/lpd.elg*</em></li></ul></td></tr><tr><td rowspan=\"11\"><p>spike_detective</p></td><td>Description</td><td><p>CPU Spike Detective - see <a href=\"https://support.checkpoint.com/results/sk/sk166454\" target=\"_blank\" rel=\"noopener\">sk166454</a></p><ul><li>Non-Scalable Platforms - R81 and higher, R80.40 Jumbo Take 69 (and higher)</li><li>On Maestro and Scalable Chassis - R81.10 and higher</li></ul></td></tr><tr><td>Path</td><td><em>$FWDIR/bin/spike_detective</em></td></tr><tr><td>Log File</td><td><ul><li><em>CPView &gt; CPU &gt; Spikes</em></li><li><em>/var/log/spike_detective/spike_detective.log</em></li><li><em>/var/log/messages</em> (in R81 and higher)</li><li><em>/var/log/spike_detective/data_spike_general_&lt;Date&gt;_&lt;Time&gt;/*</em></li><li><em>/var/log/spike_detective/data_spike_thread_&lt;Thread_ID&gt;_&lt;Date&gt;_&lt;Time&gt;</em></li><li><em>/var/log/spike_detective/data_spike_cpu_&lt;Core_Number&gt;_&lt;Date&gt;_&lt;Time&gt;</em></li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>SPIKE_DETECTIVE</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|SPIKE_DETECTIVE\"</em></td></tr><tr><td>Configuration File</td><td><em>$FWDIR/conf/spike_detective_conf.xml</em></td></tr><tr><td>To Disable</td><td><ol><li><em>$CPDIR/bin/cpprod_util CPPROD_SetValue fw1 SpikedetectiveOff 4 1 1</em></li><li><em>reboot</em></li></ol></td></tr><tr><td>To Enable</td><td><p>Note - In R81 and higher, this tool is enabled by default</p><ol><li><em>$CPDIR/bin/cpprod_util CPPROD_SetValue fw1 SpikedetectiveOff 4 0 1</em></li><li><em>reboot</em></li></ol></td></tr><tr><td>To Stop</td><td><em>cpwd_admin stop -name SPIKE_DETECTIVE</em></td></tr><tr><td>To Start</td><td><p><em>cpwd_admin start -name SPIKE_DETECTIVE -path $FWDIR/bin/spike_detective -command \"spike_detective\"</em></p></td></tr><tr><td>Debug</td><td>None</td></tr><tr><td rowspan=\"8\"><p>cpview_exporter</p></td><td>Description</td><td><p>Part of Skyline - see <a href=\"https://support.checkpoint.com/results/sk/sk178566\" target=\"_blank\" rel=\"noopener\">sk178566</a>.</p><p>CPView Exporter is a service that queries CPView at defined intervals, collects the metrics, and exports them to an OpenTelemetry Collector.</p><p>For more information, see <a href=\"https://support.checkpoint.com/results/sk/sk180521\" target=\"_blank\" rel=\"noopener\">sk180521</a>.</p></td></tr><tr><td>Path</td><td><em>$CPVIEWEXPORTER_DIR/cpview_exporter</em></td></tr><tr><td>Log File</td><td></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>OTLPAGENT</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|OTLPAGENT\"</em></td></tr><tr><td>Configuration File</td><td><em>$CPVIEWEXPORTER_DIR/config.yaml</em></td></tr><tr><td>To Stop</td><td><em>$CPVIEWEXPORTER_DIR/stop</em></td></tr><tr><td>To Start</td><td><em>$CPVIEWEXPORTER_DIR/start</em></td></tr><tr><td rowspan=\"8\"><p>otlp_agent</p></td><td>Description</td><td><p>Part of Skyline - see <a href=\"https://support.checkpoint.com/results/sk/sk178566\" target=\"_blank\" rel=\"noopener\">sk178566</a>.</p><p>The OpenTelemetry Agent is a new method to generate and report metrics on Check Point devices, as part of the Skyline OpenTelemetry flow, additional to CPView.</p><p>For more information, see <a href=\"https://support.checkpoint.com/results/sk/sk181615\" target=\"_blank\" rel=\"noopener\">sk181615</a>.</p></td></tr><tr><td>Path</td><td><em>$CPOTLPAGENT_DIR/otlp_agent</em></td></tr><tr><td>Log File</td><td><em>$CPOTLPAGENT_DIR/otlp_agent.elg</em></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>OTLPAGENTDEMON</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|OTLPAGENTDEMON\"</em></td></tr><tr><td>Configuration File</td><td><ul><li><em>$CPOTLPAGENT_DIR/events.yaml</em></li><li><em>$CPOTLPAGENT_DIR/otlp_agent_schema.json</em></li></ul></td></tr><tr><td>To Stop</td><td><em>$CPOTLPAGENT_DIR/stop</em></td></tr><tr><td>To Start</td><td><em>$CPOTLPAGENT_DIR/start</em></td></tr><tr><td rowspan=\"8\"><p>otlpcol</p></td><td>Description</td><td><p>Part of Skyline - see <a href=\"https://support.checkpoint.com/results/sk/sk178566\" target=\"_blank\" rel=\"noopener\">sk178566</a>.</p><p>OpenTelemetry Collector (CPotelcol) is an open-source service that receives metrics from multiple Agents and exports them to an external endpoint (a different OpenTelemetry Collector or Prometheus Remote Write).</p><p>For more information, see <a href=\"https://support.checkpoint.com/results/sk/sk180522\" target=\"_blank\" rel=\"noopener\">sk180522</a>.</p></td></tr><tr><td>Path</td><td><ul><li><em>$CPOTELCOL_DIR/otlpcol</em></li><li><em>$CPOTELCOL_DIR/otelcol</em></li><li><em>$CPOTELCOL_DIR/sklnctl</em></li><li><em>$CPOTELCOL_DIR/skyline_explorer</em></li></ul></td></tr><tr><td>Log File</td><td><ul><li><em>$CPOTELCOL_DIR/otelcol.log</em></li><li><em>$CPOTELCOL_DIR/sklnctl.log</em></li></ul></td></tr><tr><td>Notes</td><td>The \"<em>cpwd_admin list</em>\" command shows the process as \"<em>CPOTELCOL</em>\"</td></tr><tr><td>To See the Current Status</td><td><em>cpwd_admin list | grep -E \"APP|CPOTELCOL\"</em></td></tr><tr><td>Configuration File</td><td><em>$CPOTELCOL_DIR/config.json</em></td></tr><tr><td>To Stop</td><td><em>$CPOTELCOL_DIR/stop</em></td></tr><tr><td>To Start</td><td><em>$CPOTELCOL_DIR/start</em></td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:04.372Z","annotations":[],"updated":"2025-05-06T22:58:12.758Z"},{"title":"Check Point Security Gateway Geo Protection Update Verification","id":"b1f4614c-22e8-4ebf-a36e-37627d892ce3","type":"TEXT","raw":"ProductQuantum Security Gateways\n\nVersionR80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-02-10\n\n## Solution\n\nThis article applies to Security Gateways that are connected to the Internet.\n\nFollow these steps:\n\n1.  Connect to the command line on the Security Gateway (over SSH, or console).\n2.  Log in to the Expert mode.\n3.  Check the time stamp of the _$FWDIR/tmp/geo\\_location\\_tmp/updates/IpToCountry.csv_ file:\n    \n    **`ls -l $FWDIR/tmp/geo_location_tmp/updates/IpToCountry.csv`**\n    \n\nNotes:\n\n-   Every Geo Protection update should create this file. Therefore, the time stamp shows the time of the last Geo Protection update. This file is constantly being updated, almost daily.\n-   If you notice the file is up-to-date, and you have a false negative, then [contact Check Point Support](http://www.checkpoint.com/services/contact/index.html) for assistance.\n\n## Article Properties\n\nOriginatorMark Arbenowske\n\nTechnical ResourceYossi Moalem\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2012-07-09\n\nLast Modified2025-02-10\n\nEditorSergei Shir\n\nLast ApproverLiron Rubin\n\n## Comments\n\n#### Internal only","language":"md","time":"14 days ago","created":"2025-05-06T22:55:58.771Z","annotations":[],"updated":"2025-05-06T22:56:58.589Z"},{"title":"ProductClusterXL - Cluster Member and CCP packets","id":"a959010c-c228-4335-9ffa-380f27a999e2","type":"TEXT","raw":"ProductClusterXL\n\nVersionR77.20 (EOS), R77.30 (EOS), R80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nLast Modified2024-12-15\n\n## Solution\n\n### Background\n\nThe cluster \"dead\" interval determines how long a cluster member waits before considering a peer cluster member unresponsive.\n\nThe default cluster dead interval is 3 seconds. This is also the recommended value.\n\n**Important Note:** Internal cluster timers use special time units - `HTU (\"HA Time Unit\")`, where `1 HTU = 100 milliseconds = 0.1 second`.\n\nIf one cluster member does not receive CCP packets from the peer cluster member for more than 3 seconds, cluster failover occurs in the High Availability ClusterXL.\n\nThe cluster member that does not receive the CCP packets from the peer cluster member, generates the following logs (in SmartConsole / SmartView / SmartView Tracker):\n\n_Example from a Standby cluster member_:\n\n`cluster_info: (ClusterXL) member 2 (10.0.66.2) is up.   cluster_info: (ClusterXL) member 1 (10.0.66.1) is down.   cluster_info: (ClusterXL) member 2 (10.0.66.2) is active.   cluster_info: (ClusterXL) member 2 (10.0.66.2) is standby.`\n\nCluster kernel debug on the cluster member that does not receive the CCP packets from the peer cluster member (`fw ctl debug -m cluster + stat`) shows these messages:\n\n_Example from a Standby cluster member_:\n\n`FW-1: check_other_machine_activity: ID 0 (state ACTIVE) is dying (since 2920.8 now 2921.5)   FW-1: check_other_machine_activity: ID 0 (state ACTIVE) is dying (since 2920.8 now 2921.6)   FW-1: check_other_machine_activity: ID 0 (state ACTIVE) is dying (since 2920.8 now 2921.7)   FW-1: check_other_machine_activity: ID 0 (state ACTIVE) is dead (since 2920.8 now 2921.8)`\n\n### Instructions to increase the ClusterXL dead timeout in R75.47, R77, and higher versions\n\nSet the value of kernel parameter `fwha_dead_timeout_multiplier` to **X** to increase the cluster dead timeout to **X** seconds.\n\n**Important Note:** In versions R75.47 and R77, changing the value of this kernel parameter (`fwha_dead_timeout_multiplier`) requires changing the value of the kernel parameter `fwha_if_connectivity_tolerance` respectively (refer to [sk62863](http://supportcontent.checkpoint.com/solutions?id=sk62863)). The recommended value **for both** kernel parameters is **30 (`HTU`)**.\n\n-   To check the current value of the kernel parameter:\n    \n    `[Expert@HostName]# fw ctl get int fwha_dead_timeout_multiplier`\n    \n-   To set the desired value of the kernel parameter _on-the-fly_ (does not survive reboot):\n    \n    `[Expert@HostName]# fw ctl set int fwha_dead_timeout_multiplier _VALUE_`\n    \n-   To set the desired value of the kernel parameter _permanently_ (to survive reboot):\n    \n    Follow [sk26202 - Changing the kernel global parameters on Check Point Security Gateways](http://supportcontent.checkpoint.com/solutions?id=sk26202).\n    \n\n### Instructions to increase the ClusterXL dead timeout in versions R76, R75.46, and lower\n\n**Related Solutions:**\n\n-   [sk43984 - Interface flapping when cluster interfaces are connected through several switches](http://supportcontent.checkpoint.com/solutions?id=sk43984)\n-   [sk92723 - Cluster flapping prevention](http://supportcontent.checkpoint.com/solutions?id=sk92723)\n-   [sk97415 - Increasing Virtual System dead timeout](http://supportcontent.checkpoint.com/solutions?id=sk97415)\n-   [sk56202 - How to troubleshoot failovers in ClusterXL](http://supportcontent.checkpoint.com/solutions?id=sk56202)\n-   [sk62570 - How to troubleshoot failovers in ClusterXL - Advanced Guide](http://supportcontent.checkpoint.com/solutions?id=sk62570)\n-   [sk93306 - ATRG: ClusterXL R6x and R7x](http://supportcontent.checkpoint.com/solutions?id=sk93306)\n\n## Article Properties\n\nOriginatorSergei Shir\n\nTechnical ResourceRan Vaknin\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2013-07-08\n\nLast Modified2024-12-15\n\nEditorDavid Kornfield\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only\n\n**Location of hotfixes:** \n\n-   **R70.50**  \n    Task [36402](http://taskmanager/TaskReport.asp?TaskId=36402) , CR01146123  \n    `\\\\galaxy\\ckp\\pkg\\fw1\\flo_hf_ha50_049\\`\n-   **R71.20**  \n    Task [40281](http://taskmanager/TaskReport.asp?TaskId=40281) , CR01252972  \n    `\\\\galaxy\\ckp\\pkg\\fw1\\fly_hf_base_127\\`\n-   **R75.30**  \n    Task [36626](http://taskmanager/TaskReport.asp?TaskId=36626) , CR01151779  \n    `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\foxx_hf_ha30_399\\B983339001_1`\n-   **R75.40**\n    -   Task [37515](http://taskmanager/TaskReport.asp?TaskId=37515) , CR01173374 + (CR01173176 + CR01173336 + CR01173409)  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\foxx_hf_001_007\\`\n        \n        **Note:** This hotfix also adds the following kernel parameters (CR01173176) for Cluster Under Load (CUL) mechanism - for details, refer to [sk92723 (Cluster flapping prevention)](http://supportcontent.checkpoint.com/solutions?id=sk92723):\n        \n        -   fwha\\_cul\\_mechanism\\_enable\n        -   fwha\\_cul\\_member\\_long\\_timeout\n        -   fwha\\_cul\\_cluster\\_short\\_timeout\n        -   fwha\\_cul\\_policy\\_freeze\\_timeout\\_millisec\n        -   fwha\\_cul\\_policy\\_freeze\\_event\\_timeout\\_millisec\n        -   fwha\\_cul\\_member\\_cpu\\_load\\_limit\n        -   fwha\\_cul\\_cluster\\_log\\_delay\\_millisec\n    -   Task [37157](http://taskmanager/TaskReport.asp?TaskId=37157) , CR01170645 + (CR01139076 + CR01139077 + CR01163566 + CR01170657)  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\foxx_hf_346_001\\B986001011_1_AND_ABOVE\\linux30\\release.dynamic.hotfix\\`\n-   **R75.40VS**  \n    -   Task [37708](http://taskmanager/TaskReport.asp?TaskId=37708) , CR01169039 + CR01168878 (sk93599) + (CR01169352 + CR01169376 + CR01168710 + CR01168754 + CR01168810 + CR01168854)  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\giza_hf_020_005\\B988005014_1_AND_ABOVE\\linux30\\release.dynamic.hotfix\\`\n    -   Task [37158](http://taskmanager/TaskReport.asp?TaskId=37158) , CR01194224 (sk93454) + CR01194225 (sk97415) + CR01194227 (sk93341) + CR01194226 (sk95087) + CR01194238  \n        **NOTE: IGNORE this Task. It was an unofficial private hotfix:**  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\giza_hf_006_067\\`\n-   **R75.45**  \n    -   Task [36052](http://taskmanager/TaskReport.asp?TaskId=36052) + Task [36588](http://taskmanager/TaskReport.asp?TaskId=36588), CR01136626  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\foxx_hf_ha45_225\\`\n    -   Task [41855](http://taskmanager/TaskReport.asp?TaskId=41855), CR01345678  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\foxx_hf_004_002\\`\n    -   Task [41939](http://taskmanager/TaskReport.asp?TaskId=41939), CR01322945  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\foxx_hf_ha45_418\\`\n-   **R75.46**\n    -   Task [37761](http://taskmanager/TaskReport.asp?TaskId=37761) , CR01179018 + (CR01178991 + CR01179013 + CR01179014)  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\foxx_hf_070_208\\`\n        \n        **Note:** This hotfix also adds the following kernel parameters (CR01178991) for Cluster Under Load (CUL) mechanism - for details, refer to [sk92723 (Cluster flapping prevention)](http://supportcontent.checkpoint.com/solutions?id=sk92723):\n        \n        -   fwha\\_cul\\_mechanism\\_enable\n        -   fwha\\_cul\\_member\\_long\\_timeout\n        -   fwha\\_cul\\_cluster\\_short\\_timeout\n        -   fwha\\_cul\\_policy\\_freeze\\_timeout\\_millisec\n        -   fwha\\_cul\\_policy\\_freeze\\_event\\_timeout\\_millisec\n        -   fwha\\_cul\\_member\\_cpu\\_load\\_limit\n        -   fwha\\_cul\\_cluster\\_log\\_delay\\_millisec\n    -   Task [36531](http://taskmanager/TaskReport.asp?TaskId=36531) + Task [37522](http://taskmanager/TaskReport.asp?TaskId=37522) , CR01150500 + (CR01151788 + CR01151794 + CR01151796)\n        \n        **Note:** There are 2 parts - for FW1 and for SIM.\n        \n        1.  `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\foxx_hf_001_006\\`\n            \n            **Note:** This hotfix also adds the following kernel parameters (CR01151788) for Cluster Under Load (CUL) mechanism - for details, refer to [sk92723 (Cluster flapping prevention)](http://supportcontent.checkpoint.com/solutions?id=sk92723):\n            \n            -   fwha\\_cul\\_mechanism\\_enable\n            -   fwha\\_cul\\_member\\_long\\_timeout\n            -   fwha\\_cul\\_cluster\\_short\\_timeout\n            -   fwha\\_cul\\_policy\\_freeze\\_timeout\\_millisec\n            -   fwha\\_cul\\_policy\\_freeze\\_event\\_timeout\\_millisec\n            -   fwha\\_cul\\_member\\_cpu\\_load\\_limit\n            -   fwha\\_cul\\_cluster\\_log\\_delay\\_millisec\n        2.  `\\\\galaxy\\ckp\\pkg\\sim\\foxx_hf_006_005\\`\n    -   Task [37802](http://taskmanager/TaskReport.asp?TaskId=37802) , CR01180945 + (CR01180794 + CR01181123 + CR01181271 + CR01181758 + CR01182105 + CR01187428)  \n        **Important Note:**  \n        This hotfix is created on top of **Security Acceleration Module Hotfix for 21000 Appliances** (`Check_Point_R75.46_SAM_055_21000.tgz`) from [**sk92734**](http://supportcontent.checkpoint.com/solutions?id=sk92734).  \n        Meaning, the SAM Hotfix from sk92734 must be installed first.  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\fanta_sam_055_005\\`\n        \n        **Note:** This hotfix also adds the following kernel parameters (CR01180794) for Cluster Under Load (CUL) mechanism - for details, refer to [sk92723 (Cluster flapping prevention)](http://supportcontent.checkpoint.com/solutions?id=sk92723):\n        \n        -   fwha\\_cul\\_mechanism\\_enable\n        -   fwha\\_cul\\_member\\_long\\_timeout\n        -   fwha\\_cul\\_cluster\\_short\\_timeout\n        -   fwha\\_cul\\_policy\\_freeze\\_timeout\\_millisec\n        -   fwha\\_cul\\_policy\\_freeze\\_event\\_timeout\\_millisec\n        -   fwha\\_cul\\_member\\_cpu\\_load\\_limit\n        -   fwha\\_cul\\_cluster\\_log\\_delay\\_millisec\n-   **R75.47**  \n    CR01139243 + Cluster Under Load (CUL) mechanism parameters  \n    `integrated`\n-   **R76**  \n    Task [37525](http://taskmanager/TaskReport.asp?TaskId=37525) , CR01189081 + CR01189142  \n    `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\gizmo_hf_139_001\\B989001004_2\\`\n-   **R76 with LTE Hotfix**  \n    CR01340044  \n    `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\gizmo_lte_hf_003\\B989016003_1_AND_ABOVE\\linux30\\release.dynamic.hotfix\\`\n-   **R76SP for 61000**  \n    CR01343552  \n    `integrated`\n-   **R77.10**  \n    `integrated` since R75.47 (including Cluster Under Load (CUL) mechanism parameters)","language":"md","time":"14 days ago","created":"2025-05-06T22:56:01.402Z","annotations":[],"updated":"2025-05-06T22:58:01.331Z"},{"title":"Check Point CoreXL Firewall Instance and Affinity Control CLI Commands","id":"80513351-63fc-4f08-9ee3-8599bfb72340","type":"TEXT","raw":"Command Description **`fw ctl multik`** Controls CoreXL Firewall instances    `fw ctl multik stat` Prints the summary table for CPU cores and CoreXL Firewall instances    `fw ctl multik stat` Prints the general help message with available parameters    `fw ctl multik start` Starts CoreXL    `fw -i _Instance_ID_ ctl multik start` Starts specific CoreXL Firewall instance    `fw ctl multik stop` Stops CoreXL    `fw -i _Instance_ID_ ctl multik stop` Stops specific CoreXL Firewall instance **`fw ctl affinity <_options_>`** Controls CoreXL affinities of Virtual Devices / interfaces / processes / CoreXL Firewall instances to CPU cores    `fw ctl affinity` Prints the help message with available options    `fw -d ctl affinity -corelicnum` Prints the number of system CPU cores allowed by the CoreXL license    `fw ctl affinity -l` Prints the current CoreXL affinities    `fw ctl affinity -l -r` Prints the current CoreXL affinities in reverse order    `fw ctl affinity -l -a` Prints all current CoreXL affinities    `fw ctl affinity -l -v` Prints the current CoreXL affinities - verbose output    `fw ctl affinity -l -q` Prints the current CoreXL affinities and suppresses errors    `fw ctl affinity -l -r -a -v` Prints the current CoreXL affinities - verbose output that combines all possible outputs (shows all targets in reverse order)    `fw ctl affinity -l -x [-vsid _VSID_ranges_] [-cpu _CPU_ID_ranges_] [-flags e|k|t|n|h] [-r] [-a] [-v]` Prints the current CoreXL affinities - extended output  \nNotes:  \n\n-   If \"`-vsid`\" flag is omitted, the current context will be used (in which the command was issued)\n-   The \"`-vsid`\" flag accepts either a single VSID (e.g., '`-vsid 7`'), or a range of VSID numbers (e.g., '`-vsid 0-5`'), or a combination (e.g., '`-vsid 0-2 4`')\n-   The \"`-cpu`\" flag accepts either a single CPU ID (e.g., '`-cpu 7`'), or a range of CPU ID numbers (e.g., '`-cpu 0-5`'), or a combination (e.g., '`-cpu 0-2 4`')\n-   The \"`-flags`\" requires at least one of the following arguments (multiple arguments must be specified together):\n    -   `e` - do not print exception processes\n    -   `k` - do not print kernel threads\n    -   `t` - print all process threads\n    -   `n` - print process name instead of `/proc/<_PID_>/cmdline`\n    -   `h` - print CPU mask in Hex format\n    -   `o` - print output into the '`/tmp/affinity_list_output`' file (VSX R77.10 and above)\n\n**`fw ctl affinity -s`** Sets CoreXL Affinity    `fw ctl affinity -s -i _Interface_Name_ _CPU_ID_` Sets affinities of the specified interface to CPU core  \n**Note:** An interface's affinity can be set only to a single core    `fw ctl affinity -s -p _PID_ _CPU_IDs_ | all` Sets affinities of the specified process (by PID) to CPU cores    `fw ctl affinity -s -d -pname _Daemon_Name_ [-vsid _VSID_ranges_] -cpu _CPU_ID_ranges_` Sets affinity of the specified process (by name) to CPU cores  \nNotes:  \n\n-   If \"`-vsid`\" flag is omitted, the current context will be used (in which the command was issued)\n-   The \"`-vsid`\" flag accepts either a single VSID (e.g., '`-vsid 7`'), or a range of VSID numbers (e.g., '`-vsid 0-5`'), or a combination (e.g., '`-vsid 0-2 4`')\n-   The \"`-cpu`\" flag accepts either a single CPU ID (e.g., '`-cpu 7`'), or a range of CPU ID numbers (e.g., '`-cpu 0-5`'), or a combination (e.g., '`-cpu 0-2 4`')\n\n   `fw ctl affinity -s -d [-vsid _VSID_ranges_] -cpu _CPU_ID_ranges_` Sets affinities of Virtual Devices (VS, VR, VSW) to CPU cores  \nNotes:  \n\n-   If \"`-vsid`\" flag is omitted, the current context will be used (in which the command was issued)\n-   The \"`-vsid`\" flag accepts either a single VSID (e.g., '`-vsid 7`'), or a range of VSID numbers (e.g., '`-vsid 0-5`'), or a combination (e.g., '`-vsid 0-2 4`')\n-   The \"`-cpu`\" flag accepts either a single CPU ID (e.g., '`-cpu 7`'), or a range of CPU ID numbers (e.g., '`-cpu 0-5`'), or a combination (e.g., '`-cpu 0-2 4`')\n\n   `fw ctl affinity -s -d -inst _Instances_ranges_ -cpu _CPU_ID_ranges_` Sets affinities of the specified FWK instances to CPU cores  \nNotes:  \n\n-   The \"`-inst`\" flag accepts either a single FWK\\_ID (e.g., '`-inst 7`'), or a list of FWK\\_ID numbers (e.g., '`-inst 0 2 4`')\n-   The \"`-cpu`\" flag accepts either a single CPU ID (e.g., '`-cpu 7`'), or a range of CPU ID numbers (e.g., '`-cpu 0-5`'), or a combination (e.g., '`-cpu 0-2 4`')\n\n   `fw ctl affinity -s -d -fwkall _Number_of_CPUs_` Sets affinities of all FWK instances to CPU cores (where _Number\\_of\\_CPUs_ is an integer number) **`fw ctl affinity -vsx_factory_defaults`** Resets all VSX affinity settings (prompts the user) (VSX R77 and above) **`fw ctl affinity -vsx_factory_defaults_no_prompt`** Resets all VSX affinity settings (does not prompt the user) (VSX R77 and above)","language":"md","time":"14 days ago","created":"2025-05-06T22:56:04.803Z","annotations":[],"updated":"2025-05-06T22:57:32.598Z"},{"title":"Logging FWD Daemon","id":"87855f54-71e2-4d72-837e-4c17d2e06d6e","type":"TEXT","raw":"---\ncreated: 2025-04-29T18:44:28 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk86321\nauthor: \n---\n\n# sk86321 - How to debug FWD daemon\n\n> ## Excerpt\n> Applies to: Multi-Domain Security Management, Quantum Security Gateways, Quantum Security Management, Quantum Spark Appliances\n\n---\nProductMulti-Domain Security Management, Quantum Security Gateways, Quantum Security Management, Quantum Spark Appliances\n\nVersionOther\n\nPlatformAll\n\nLast Modified2024-02-25\n\n#### For internal users only\n\n## Solution\n\nClick Here to Collapse Entire Article\n\nFollow these steps:\n\n-   **Instructions for Security Gateway / Security Management Server / StandAlone**\n    \n    1.  Connect to the command line on the Security Gateway / Security Management Server / StandAlone.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Add a mark to the log file:\n        \n        ```\n        [Expert@HostName]# echo \"=debug_start=\" &gt;&gt; $FWDIR/log/fwd.elg\n        ```\n        \n    4.  Start the debug of FWD daemon:\n        \n        ```\n        [Expert@HostName]# fw debug fwd on TDERROR_DBG_OPT=time,host,prog,topic,pid,tid\n        [Expert@HostName]# fw debug fwd on TDERROR_ALL_ALL=5\n        [Expert@HostName]# fw debug fwd on OPSEC_DEBUG_LEVEL=3\n        ```\n        \n    5.  Replicate the issue.\n        \n    6.  Stop the debug of FWD daemon:\n        \n        ```\n        [Expert@HostName]# fw debug fwd off TDERROR_ALL_ALL=0\n        [Expert@HostName]# fw debug fwd off OPSEC_DEBUG_LEVEL=0\n        ```\n        \n    7.  Add a mark to the log file:\n        \n        ```\n        [Expert@HostName]# echo \"=debug_stop=\" &gt;&gt; $FWDIR/log/fwd.elg\n        ```\n        \n    8.  Send these files to [Check Point Support](https://www.checkpoint.com/support-services/contact-support/) for analysis:\n        \n        1.  **CPinfo file** from the involved machine collected with the latest version of CPinfo utility from [sk92739](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92739)\n            \n        2.  **Log files**:\n            \n            -   `$FWDIR/log/fwd.elg*`\n            -   `$CPDIR/log/cpwd.elg*`\n            -   `/var/log/message*`\n        \n        **Note:** Compress (TAR/GZIP) all the requested files BEFORE uploading them from the machine - if uploading over FTP, then it is mandatory to use BIN mode\n        \n    \n-   **Instructions for Multi-Domain Security Management Server**\n    \n    1.  Connect to the command line on the Security Gateway / Security Management Server / StandAlone.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Go to the context of the involved Domain Management Server:\n        \n        ```\n        [Expert@HostName]# mdsenv <em>IP Address or Name of Domain Management Server</em>\n        ```\n        \n    4.  Add a mark to the log file:\n        \n        ```\n        [Expert@HostName]# echo \"=debug_start=\" &gt;&gt; $FWDIR/log/fwd.elg\n        ```\n        \n    5.  Start the debug of FWD daemon:\n        \n        ```\n        [Expert@HostName]# fw debug fwd on TDERROR_DBG_OPT=time,host,prog,topic,pid,tid\n        [Expert@HostName]# fw debug fwd on TDERROR_ALL_ALL=5\n        [Expert@HostName]# fw debug fwd on OPSEC_DEBUG_LEVEL=3\n        ```\n        \n    6.  Replicate the issue.\n        \n    7.  Stop the debug of FWD daemon:\n        \n        ```\n        [Expert@HostName]# fw debug fwd off TDERROR_ALL_ALL=0\n        [Expert@HostName]# fw debug fwd off OPSEC_DEBUG_LEVEL=0\n        ```\n        \n    8.  Add a mark to the log file:\n        \n        ```\n        [Expert@HostName]# echo \"=debug_stop=\" &gt;&gt; $FWDIR/log/fwd.elg\n        ```\n        \n    9.  Send these files to [Check Point Support](https://www.checkpoint.com/support-services/contact-support/) for analysis:\n        \n        1.  **CPinfo file** from the context of Multi-Domain Security Management Server collected with the latest version of CPinfo utility from [sk92739](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92739)\n            \n        2.  **CPinfo file** from the context of the involved Domain Management Server collected with the latest version of CPinfo utility from [sk92739](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92739)\n            \n        3.  **Log files** from the context of the involved Domain Management Server:\n            \n            -   `$FWDIR/log/fwd.elg*`\n        4.  **Log files** from the from the Multi-Domain Security Management Server:\n            \n            -   `/var/log/message*`\n        \n        **Note:** Compress (TAR/GZIP) all the requested files BEFORE uploading them from the machine - if uploading over FTP, then it is mandatory to use BIN mode\n        \n    \n-   **Instructions for Quantum Spark Appliances**\n    \n    **Important** - In addition, see [sk113090](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk113090).\n    \n    1.  Connect to the command line on the appliance.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Stop the FWD daemon:\n        \n        ```\n        [Expert@HostName]# cpwd_admin stop -name SFWD -path \"$FWDIR/bin/fw\" -command \"fw sfwd\"\n        ```\n        \n        Verify that the daemon was stopped:\n        \n        ```\n        [Expert@HostName]# cpwd_admin list\n        ```\n        \n        The '`STAT`' column should show '`T`' (i.e., terminated).\n        \n    4.  Add a mark to the log file:\n        \n        ```\n        [Expert@HostName]# echo \"=debug_start=\" &gt;&gt; /opt/fw1/log/sfwd.elg\n        ```\n        \n    5.  Export the debug environment variables:\n        \n        ```\n        [Expert@HostName]# export TDERROR_ALL_ALL=5\n        [Expert@HostName]# export OPSEC_DEBUG_LEVEL=3\n        ```\n        \n    6.  Start the FWD debug under debug:\n        \n        ```\n        [Expert@HostName]# fw sfwd -d &amp;\n        ```\n        \n    7.  Replicate the issue.\n        \n    8.  Kill the FWD daemon:\n        \n        ```\n        [Expert@HostName]# kill $(ps auxw | grep 'sfwd' | awk '{print $2}')\n        ```\n        \n    9.  Add a mark to the log file:\n        \n        ```\n        [Expert@HostName]# echo \"=debug_stop=\" &gt;&gt; /opt/fw1/log/sfwd.elg\n        ```\n        \n    10.  Copy all FWD log files:\n        \n        ```\n        [Expert@HostName]# cp /opt/fw1/log/sfwd.el*&nbsp;&nbsp;/storage/\n        ```\n        \n    11.  Unset the debug environment variables:\n        \n        ```\n        [Expert@HostName]# unset TDERROR_ALL_ALL\n        [Expert@HostName]# unset OPSEC_DEBUG_LEVEL\n        ```\n        \n    12.  Start the FWD daemon normally:\n        \n        ```\n        [Expert@HostName]# cpwd_admin start -name SFWD -path \"$FWDIR/bin/fw\" -command \"fw sfwd\"<span id=\"_plain_text_marker\">&nbsp;</span>\n        ```\n        \n        Verify that the daemon was started:\n        \n        ```\n        [Expert@HostName]# cpwd_admin list\n        ```\n        \n        The '`STAT`' column should show '`E`' (i.e., executing).\n        \n    13.  Send these files to [Check Point Support](https://www.checkpoint.com/support-services/contact-support/) for analysis:\n        \n        1.  **CPinfo file** from the appliance:\n            \n            ```\n            [Expert@HostName]# cpinfo -z -o /storage/$(uname -n).cpinfo\n            ```\n            \n        2.  **FWD log files**:\n            \n            ```\n            /storage/sfwd.el*\n            ```\n            \n        \n        **Note:** Compress (TAR/GZIP) all the requested files BEFORE uploading them from the machine - if uploading over FTP, then it is mandatory to use BIN mode.\n        \n    \n-   **Instructions for starting the FWD in the debug mode on Security Gateway / Security Management Server / StandAlone**\n    \n    Use these instructions when the FWD daemon cannot start.\n    \n    1.  Connect to the command line on the Security Gateway / Security Management Server / StandAlone.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Stop the FWD daemon under WatchDog:\n        \n        ```\n        [Expert@HostName:0]# cpwd_admin stop -name FWD\n        ```\n        \n    4.  Set the debug environment variable:\n        \n        ```\n        [Expert@HostName:0]# export TDERROR_ALL_ALL=5\n        [Expert@HostName:0]# echo $TDERROR_ALL_ALL\n        ```\n        \n    5.  Manually start the FWD daemon under debug and redirect its output to a file:\n        \n        -   On a Security Gateway / StandAlone, run:\n            \n            ```\n            [Expert@HostName:0]# fwd -d 1&gt;&gt; /var/log/fwd_debug.txt 2&gt;&gt; /var/log/fwd_debug.txt\n            ```\n            \n        -   On a Security Management Server, run:\n            \n            ```\n            [Expert@HostName:0]# fwd -n -d 1&gt;&gt; /var/log/fwd_debug.txt 2&gt;&gt; /var/log/fwd_debug.txt\n            ```\n            \n    6.  Replicate the issue.\n        \n    7.  Stop the FWD daemon:\n        \n        Press CTRL + C\n    8.  Unset the debug environment variable:\n        \n        ```\n        [Expert@HostName:0]# unset TDERROR_ALL_ALL\n        [Expert@HostName:0]# echo $TDERROR_ALL_ALL\n        ```\n        \n    9.  Start the FWD daemon under WatchDog:\n        \n        ```\n        [Expert@HostName:0]# cpwd_admin start -name FWD -path \"$FWDIR/bin/fwd\" -command \"fwd\"\n        [Expert@HostName:0]# cpwd_admin list | egrep \"PID|FWD\"\n        ```\n        \n    10.  Send these files to [Check Point Support](https://www.checkpoint.com/support-services/contact-support/) for analysis:\n        \n        1.  **CPinfo file** from the involved machine collected with the latest version of CPinfo utility from [sk92739](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92739)\n            \n        2.  **Debug output file**:\n            \n            -   `/var/log/fwd_debug.txt`\n        3.  **Log files**:\n            \n            -   `$FWDIR/log/fwd.elg*`\n            -   `$CPDIR/log/cpwd.elg*`\n            -   `/var/log/message*`\n        \n        **Note:** Compress (TAR/GZIP) all the requested files BEFORE uploading them from the machine - if uploading over FTP, then it is mandatory to use BIN mode\n        \n    \n-   **Instructions for starting the FWD in the debug mode on Domain Management Server / Domain Log Server**\n    \n    Use these instructions when the FWD daemon cannot start.\n    \n    1.  Identify the name of the Domain Management Server / Domain Log Server, in which it is necessary to start the FWD daemon in the debug mode.\n        \n        For example, \"_cpmdm-03-01_\".\n        \n    2.  Connect to the command line on the Multi-Domain Security Mangement Server / Multi-Domain Log Server.\n        \n    3.  Log in to the Expert mode.\n        \n    4.  Identify the PIDs for these two processes - the FWD launcher and FWD itself.\n        \n        1.  To get the PID of the FWD itself:\n            \n            `[Expert@HostName:0]# mdsstat | egrep \"FWD|<_IP Address or Name of Domain Management Server / Domain Log Server_>`\"\n            \n            For example:  \n            _mdsstat | egrep \"FWD|cpmdm-03-01\"_\n            \n            ```\n            | Type| Name           | IP address      | FWM        | FWD      | CPD      | CPCA     |\n            +-----+----------------+-----------------+------------+----------+----------+----------+\n            | CMA |cpmdm-03-01     | 192.168.3.211   | up 19338   | up 19409 | up 19124 | up 19982 |\n            ```\n            \n            The PID in this example is 19409.\n            \n        2.  To get the PID of the FWD launcher:\n            \n            `[Expert@HostName:0]# cpwd_admin list | egrep \"COMMAND|FWD\" | egrep \"COMMAND|<I_P Address or Name of Domain Management Server / Domain Log Server_>\"`\n            \n            For example:\n            \n            ```\n            cpwd_admin list | egrep \"COMMAND|FWD\" egrep \"COMMAND|cpmdm-03-01\"\n            \n            APP              PID   STAT  #START  START_TIME             MON  COMMAND\n            FWD.cpmdm-03-01  17920 E     1       &lt;timestamp&gt;            N    fwd\n            ```\n            \n            The PID in this example is 17920.\n            \n    5.  Stop the FWD launcher:\n        \n        `[Expert@HostName:0]# cpwd_admin stop -name FWD.<_Name of Domain Management Server / Domain Log Server_>`\n        \n        For example:  \n        _cpwd\\_admin stop -name FWD.cpmdm-03-01_\n        \n    6.  Kill the FWD:\n        \n        `[Expert@HostName:0]# kill -9 <PID of the FWD itself>`\n        \n        For example:  \n        _kill -9 19409_\n        \n        From this moment, the FWD and its launcher are not running, and the WatchDog does not try to restart the FWD in that Domain Management Server / Domain Log Server.\n        \n    7.  Go to the context of the Domain Management Server / Domain Log Server:\n        \n        `[Expert@HostName:0]# mdsenv <_IP address or Name of Domain Management Server / Domain Log Server_>`\n        \n    8.  Start the FWD under debug and redirect its debug output to a file:\n        \n        `[Expert@HostName:0]# TDERROR_ALL_ALL=5 fwd -n &> /var/log/fwd_start_in_debug_mode.txt`\n        \n    9.  Replicate the issue.\n        \n    10.  Stop the FWD debug:\n        \n        Press CTRL+C\n        \n    11.  Start the Domain Management Server / Domain Log Server:\n        \n        `[Expert@HostName:0]# mdsstart_customer <_IP address or Name of Domain Management Server / Domain Log Server_>`\n        \n    12.  Send these files to [Check Point Support](https://www.checkpoint.com/support-services/contact-support/) for analysis:\n        \n        1.  **Debug output file**:\n            \n            -   `/var/log/fwd_start_in_debug_mode.txt`\n        2.  **CPinfo file** from the context of Multi-Domain Security Management Server / Multi-Domain Log Server collected with the latest version of CPinfo utility from [sk92739](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92739)\n            \n        3.  **CPinfo file** from the context of the involved Domain Management Server / Domain Log Server collected with the latest version of CPinfo utility from [sk92739](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92739)\n            \n        4.  **Log files** from the context of the involved Domain Management Server / Domain Log Server:\n            \n            -   `$FWDIR/log/fwd.elg*`\n        5.  **Log files** from the Multi-Domain Security Management Server / Multi-Domain Log Server:\n            \n            -   `/var/log/message*`\n        \n        **Note:** Compress (TAR/GZIP) all the requested files BEFORE uploading them from the machine - if uploading over FTP, then it is mandatory to use BIN mode\n        \n    \n\n## Article Properties\n\nOriginatorSergei Shir\n\nTechnical ResourceTamir Goren\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2012-10-13\n\nLast Modified2024-02-25\n\nEditorGil Frantsus\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only\n","language":"md","time":"14 days ago","created":"2025-05-06T22:55:58.943Z","annotations":[],"updated":"2025-05-06T22:57:03.175Z"},{"title":"ProductSmartEvent / Eventia Analyzer","id":"e9709d3a-125c-4fc8-8bfa-4fb082cf4736","type":"TEXT","raw":"ProductSmartEvent / Eventia Analyzer\n\nVersionR81 (EOS), R81.10, R81.20, R82\n\nOSGaia, Linux, Windows\n\nLast Modified2024-10-27\n\n## Solution\n\n**Table of Contents**\n\n-   Overview\n    \n-   SmartEvent Architecture\n    \n    -   Data Analysis and Event Identification\n        \n    -   Event Management\n        \n    -   Interoperability with Security Management\n        \n    -   SmartEvent Client\n        \n    -   Terminology\n        \n-   SmartEvent Common Issues\n    \n    -   Login to the SmartEvent GUI fails\n        \n    -   SmartEvent correlation unit status displays error message: \"No connection to correlation unit\"\n        \n    -   \"Install Policy\" does not work\n        \n    -   No new events are shown in the SmartEvent GUI\n        \n-   SmartEvent Debugging\n    \n    -   Debugging Introduction\n        \n    -   Debugging Syntax\n        \n\n## Overview\n\n-   ## The SmartEvent Solution\n    \n    SmartEvent provides centralized, real-time event correlation of log data from Check Point perimeter, internal, and Web security gateways, as well as third-party security devices, automatically prioritizing security events for decisive, intelligent action. By automating the aggregation and correlation of raw log data, SmartEvent not only minimizes the amount of data that needs to be reviewed, but also isolates and prioritizes the real security threats. These threats may not have been otherwise detected when viewed in isolation per device, but pattern anomalies appear when data is correlated over time.\n    \n    With SmartEvent, security teams no longer need to comb through the massive amount of data generated by the devices in their environment. Instead, they can focus on deploying resources on the threats that pose the greatest risk to their business.\n    \n-   ## Scalable, Distributed Architecture\n    \n    SmartEvent delivers a flexible, scalable platform capable of managing millions of logs per day per correlation unit in large enterprise networks. Through its distributed architecture, SmartEvent can be installed on a single server, but has the flexibility to spread processing load across multiple correlation units and reduce network load.\n    \n-   ## Easy Deployment\n    \n    SmartEvent provides a large number of predefined, but easily customizable, security events for quick deployment. Its tight integration with the Security Management Server architecture, allows it to interface with existing Security Management log servers, eliminating the need to configure each device log server separately for log collection and analysis. In addition, all objects defined in the Security Management Server are automatically accessed and used by the SmartEvent server for event policy definition and enforcement. An enterprise can easily install and have SmartEvent up and running and detecting threats in a matter of hours.\n    \n-   ## Centralized Event Correlation\n    \n    SmartEvent provides centralized event correlation and management for all Check Point products such as Security Gateway, Application Control, and Mobile Access, as well as third-party firewalls, routers and switches, intrusion detection systems, operating systems, applications and Web servers. Raw log data is collected via secure connections from Check Point and third-party devices by SmartEvent correlation units, where it is centrally aggregated, normalized, correlated, and analyzed. Data reduction and correlation functions are performed at various layers, so only significant events are reported up the hierarchy for further analysis. Log data that exceeds the thresholds set in predefined event policies triggers security events. These events can be unauthorized scans targeting vulnerable hosts, unauthorized logging, denial of service attacks, network anomalies, and other host-based activity. Events are then further analyzed and severity levels assigned. Based on the severity level, an automatic reaction may be triggered at this point to stop the harmful activity immediately at the gateway. As new information flows in, severity levels can be adjusted to adapt to changing conditions.\n    \n-   ## Real-Time Threat Analysis and Protection\n    \n    SmartEvent performs real-time event correlation based on pattern anomalies and previous data, as well as correlation based on predefined security events. Once installed on the network, SmartEvent has an intelligent, self-learning mode where it automatically learns the normal activity pattern for a given site and suggests policy changes to reduce false-alarm events. By weeding out irrelevant data and by correlating data between multiple devices, SmartEvent is able to zero in on threats that pose greatest risk to the enterprise. SmartEvent is fully integrated with the Security Management Server and can access all Check Point gateways and enforce automatic actions on these gateways against critical threats, for real-time, dynamic threat mitigation.\n    \n-   ## Intelligent Event Management\n    \n    SmartEvent lets you customize event thresholds, assign severity levels to event categories, and choose to ignore rules on specific servers and services, greatly reducing the number of false alarms. Administrators may perform event search queries, sorts and filters, as well as manage event status. With new information, the open event may easily be closed or changed to a false alarm. Daily or weekly events reports can be distributed automatically for incident management and decision support.\n    \n-   ## Event Investigation Tracking\n    \n    SmartEvent enables administrators to investigate threats using flexible data queries which are presented in timelines or charts. Once suspect traffic is identified, actions taken to resolve the threats are tracked using work tickets, allowing you to keep a record of progress made using statuses and comments.\n    \n    In addition, daily or weekly events reports can be distributed automatically for incident management and decision support.\n    \n-   ## SmartEvent Sizing Guide\n    \n    The SmartEvent Sizing Guide helps you find the recommended SmartEvent appliance suitable to your environment scale. See the Sizing Guide in [sk87263](http://supportcontent.checkpoint.com/solutions?id=sk87263).\n    \n\n## SmartEvent Architecture\n\nSmartEvent has several components that work together to help track down security threats and make your network more secure:\n\n-   Correlation Unit that analyzes log entries on Log servers\n-   SmartEvent server that contains the Events Database\n-   SmartEvent client that manages SmartEvent\n\nThey work together in the following manner:\n\n-   The Correlation Unit analyzes each log entry as it enters a Log server, looking for patterns according to the installed Event Policy. The logs contain data from both Check Point products and certain third-party devices. When a threat pattern is identified, the Correlation Unit forwards what is known as an event to the SmartEvent server.\n-   When the SmartEvent server receives events from a Correlation Unit, it assigns a severity level to the event, invokes any defined automatic reactions, and adds the event to the Events Database that resides on the server. The severity level and automatic reaction are based on the Events Policy.\n-   The SmartEvent client displays the received events, and is the place to manage events (such as filtering and closing events) and fine-tune and install the Events Policy.\n\nThe SmartEvent components can be installed on a single machine (a standalone deployment), or spread out over multiple machines and sites (a distributed deployment) to handle higher volumes of logging activity.\n\nThe SmartEvent and SmartReporter can be installed together on the same machine. In addition to generating Check Point reports, SmartReporter provides reporting services for SmartEvent.\n\n[![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk93970/SmartEvent_Architecture.PNG)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk93970/SmartEvent_Architecture.PNG \"Click the image to see it in full size in a new tab/window\")\n\nDepending on the volume of logging activity, you may want to install multiple Correlation Units, each of which can analyze the logs of multiple Log servers.\n\n-   ## Data Analysis and Event Identification\n    \n    The Correlation Unit is responsible for analyzing the log entries and identifying events from them. When analyzing a log entry, the Correlation Unit does one of the following:\n    \n    -   Marks log entries that by themselves are not events, but may be part of a larger pattern to be identified in the near future.\n    -   Takes a log entry that meets one of the criteria set in the Events Policy and generates an event.\n    -   Takes a log entry that is part of a group of items that depict a security event together. New log entries may be added to ongoing events.\n    -   Discards all log entries that do not meet event criteria.\n-   ## Event Management\n    \n    The SmartEvent server receives all the items that are identified as an event by the Correlation Unit(s). Further analysis takes place on the SmartEvent server to determine the severity level of the event and what action should take place. The event is then stored in the system database.\n    \n-   ## Interoperability with Security Management\n    \n    SmartEvent imports certain objects from the Security Management server without having to recreate the objects in the SmartEvent client. **Changes made to the objects on the Security Management Server are reflected in the SmartEvent client.**\n    \n-   ## Logs & Events View in SmartConsole\n    \n    The Logs & Events view in SmartConsole provides all of the tools necessary for configuring definitions that will recognize security-related issues in your network infrastructure. It also provides a wide variety of methods for you to view the resulting data, including timelines, reports and charts that allow you to drill down into the underlying data.\n    \n-   ### What can I do with in the Logs & Events view?\n    \n    -   **Real-time Monitoring:** The Logs & Events view presents all of the critical information that you need for ongoing monitoring of security events and security updates. This view can be displayed in a Network Operations Center to provide engineers with a clear understanding of the network's current status.\n    -   **Event Investigation:** The timelines, charts and events lists are all customizable to allow you to restructure the events data in a way that will assist you to accurately understand the security of your environment and drive your security decisions.\n    -   **Resolution Tracking:** Actions taken by administrators to investigate and resolve issues can be tracked in event tickets and comments.\n    -   **Security Status Reporting:** The event reports reveal who is attacking your network, how they are attacking and where the attacks originate. These reports, either generated from default definitions or customized, are a compelling way to present the organization's security status to management.\n    \n    **Note -** The Policy tab which contains the event definitions and other system configuration parameters is in the SmartEvent Client and not in the SmartConsole UI. All other logging and monitoring information is in the Logs & Events view in SmartConsole.  \n     \n    \n\n## Terminology\n\n-   **Event Policy:** the rules and behavior of IPS Event Analysis.\n-   **Event:** activity that is perceived as a threat and is classified as such by the Event Policy.\n-   **Log Server:** receives log messages from Check Point and third-party devices.\n-   **Correlation Unit:** component that analyzes logs on Log servers and detects events.\n-   **Event Database:** stores all detected events.\n-   **IPS Event Analysis Server:** houses the Event Database, receives events from Correlation Units, and reacts to events as they occur.\n-   **IPS Event Analysis Client:** Graphic User Interface where the Event Policy is configured and events are displayed.\n-   **Management Server:** Security Management server or Domain Management Server.\n-   **Predefined Report:** Report that you can run right out of the box.\n-   **Custom Report:** Report that you define, typically based on a predefined report.\n\nFor more information, refer to the [Logging and Monitoring Administration Guide for your version](https://support.checkpoint.com/product/451).\n\n## SmartEvent Common Issues\n\n-   ### Login to the SmartEvent GUI fails\n    \n    **_Introduction_**\n    \n    _**cpsemd**_ is the process responsible for logging into the SmartEvent GUI. Therefore, you need to check the status of this process and debug it, if necessary. Usually, the issue with the cpsemd process is that it is crashing, or not coming up. What causes this process to crash or not come up is that the PostgreSQL database is down. Therefore, in order to run the cpsemd process successfully, you need to run the PostgreSQL database successfully.\n    \n    _**Troubleshooting steps**_\n    \n    Run the _cpwd\\_admin list_ command on the SmartEvent Server and check the status of the _cpsemd_ process.\n    \n    -   If _cpsemd_ daemon is up and running, debug the _cpsemd_ and the _fwm_ processes while trying to login to the SmartEvent GUI.\n    -   If _cpsemd_ daemon is crashing or not running, run the following command in order to verify that the PostgreSQL database is down:\n        \n        _\\# ps aux | grep postgres_\n        \n    -   If indeed the PostgreSQL database is down or not running correctly, do these steps:\n        1.  Verify there is a section on the server registry file (_$CPDIR/registry/HKLM\\_registry.data_) referring to the PostgreSQL database location. The section should appear, as follows:  \n            \n            ```\n            <em>\n            : (PostgreSQL \n                  :PgDataPath (\"/opt/CPrt-&lt;CP_Version&gt;/events_db/data\") \n                  :UserName (cp_postgres) \n                  :(PgDatabase \n                      :Analyzer&lt;CP_Version_Code_Name&gt;(true) \n                  ) \n            )\n            </em>\n            ```\n            \n        2.  In case there is no such section, a registration of the PostgreSQL database should be done in order for it to run successfully. To register it, run these commands on the SmartEvent server:\n            \n            _\\# cpstop  \n            \\# $CPDIR/database/postgresql/util/PostgreSQLCmd register -p Analyzer<CP\\_Version\\_Code\\_Name> -D \"/opt/CPrt-<CP\\_Version>/events\\_db/data\"  \n            \\# cpstart_\n            \n        3.  To verify that the PostgreSQL database registration has finished successfully, look for an indication for it in the following file: _$CPDIR/log/postgresqlcmd.elg._\n            \n            Also, check the status of the PostgreSQL database with the command:  \n            _\\# $CPDIR/database/postgresql/util/PostgreSQLCmd status_\n            \n        4.  **Important:** If the PostgreSQL database registration is failing, make sure the _$RTDIR/events\\_db/data_ directory exists. If not, create it as follows and try registering the PostgreSQL database again:\n            \n            _\\# cpstop  \n            \\# cd $RTDIR/events\\_db  \n            \\# mkdir data_\n            \n        5.  If the details in the PosgreSQL section are not correct, a re-registration of the PostgreSQL database should be done, as follows:\n            \n            **Important note - Make sure the server is NOT an Endpoint Security server BEFORE executing unregister command.  \n            If it is an Endpoint Security server, consult with the Endpoint Security team at [Check Point Support.](https://www.checkpoint.com/support-services/contact-support/)**\n            \n            _\\# cpstop  \n            \\# $CPDIR/database/postgresql/util/PostgreSQLCmd unregister -p Analyzer<CP\\_Version\\_Currently\\_Appearing\\_On\\_The\\_Registry\\_File\\_Code\\_Name>  \n            \\# $CPDIR/database/postgresql/util/PostgreSQLCmd register -p Analyzer<CP\\_Version\\_Code\\_Name> -D \"/opt/CPrt-<CP\\_Version>/events\\_db/data\"  \n            \\# cpstart_\n            \n        6.  To verify that the PostgreSQL database registration has finished successfully, look for an indication for it in the following file: _$CPDIR/log/postgresqlcmd.elg_\n            \n            Also, check the status of the PostgreSQL database with the command:  \n            _\\# $CPDIR/database/postgresql/util/PostgreSQLCmd status_\n            \n        7.  **Important: Unregistering the PostgreSQL database will remove all the old events from the database. Therefore, make sure this action is indeed necessary before performing it.**\n        8.  If it is, let the customer know the old events will be removed and explain to him that he can restore them only by using the 'Offline Job' option in the SmartEvent GUI.\n        9.  If the registration of the PostgreSQL database is not finishing successfully, run it in debug mode, as follows:\n            \n            _\\# cpstop  \n            \\# export TDERROR\\_ALL\\_ALL=5  \n            \\# $CPDIR/database/postgresql/util/PostgreSQLCmd register -p Analyzer<CP\\_Version\\_Code\\_Name> -D \"/opt/CPrt-<CP\\_Version>/events\\_db/data\"  \n            &> /var/log/PostgreSQL\\_Debug.txt  \n            \\# unset TDERROR\\_ALL\\_ALL  \n            \\# cpstart_\n            \n            The debug output will be found in the _/var/log/PostgreSQL\\_Debug.txt_ file.\n            \n        10.  If the PostgreSQL database section in the server registry file is appearing correctly, debug the PostgreSQL database, as follows:\n            1.  Run _cpstop_.\n            2.  Edit the _$RTDIR/events\\_db/data/postgresql.conf_ file as follows:\n                1.  Change:  \n                    from _#logging\\_collector = off_  \n                    to _logging\\_collector = on_\n                2.  Change:  \n                    from _log\\_min\\_messages = warning_  \n                    to _log\\_min\\_messages = error_\n                3.  Save the changes made in the file.\n            3.  Run _cpstart_.\n            4.  This file will be created: _$RTDIR/events\\_db/data/pg\\_log/postgresql-YYY-MM-DD\\_HHMMSS.log_  \n                This file contains more debug output related to the PostgreSQL database issues.\n            5.  Make sure that there are no permission issues with the postgres directory. The directory of _$RTDIR/events\\_db_ should be owned by _cp\\_postgres_ user.\n            6.  Check in the Registry that _postgres_ is registered.  \n                (If not, then run: _\\# $CPDIR/database/postgresql/util/PostgreSQLCmd register -p AnalyzerFiber -D $RTDIR/events\\_db/data_)\n            7.  Check that the contents of the _LD\\_LIBRARY\\_PATH_ variable is not very long (no longer than 1024 characters). Run:  \n                _\\# echo $LD\\_LIBRARY\\_PATH_\n                \n                (On Windows OS: Also check that the registry field _PgDataPath_ has all its value with back slash \"\\\\\" and not forward slash \"/\".)\n                \n            8.  Run this command and check its output for errors:\n                \n                _\\# su cp\\_postgres; $CPDIR/database/postgresql/bin/postgres \"-D\" \"$RTDIR/events\\_db/data\"_\n                \n-   ### SmartEvent correlation unit status displays error message: \"No connection to correlation unit\"\n    \n    _**Introduction**_\n    \n    _**cpsead**_ is the process responsible for the correlation unit functionality. Therefore, you need to check the status of this process and debug it, if necessary.\n    \n    _**Troubleshooting steps**_\n    \n    1.  Review the _$RTDIR/log/cpsead.elg\\*_ files and search for the relevant error messages.\n    2.  In general, the error message will indicate a SIC issue. This means there is an issue with the connectivity between the log server and the SmartEvent server.\n    3.  In general, when experiencing this issue, the customer is using the following configuration:\n        -   One SmartEvent server\n        -   One Log Server\n        -   One OPSEC device (a different vendor log server that sends its logs to the SmartEvent server in order to generate events based on these logs)\n    4.  In this configuration, this conflict usually occurs: The SmartEvent server should communicate with the Log Server by using the _cpsead_ process, on TCP port 18184 (LEA protocol). When configuring the communication definitions on the OPSEC device side, TCP port 18184 is the port generally used for this communication. In addition, usually both the Check Point log server and the OPSEC device are communicating with the SmartEvent server using SSL. These configurations create a conflict since it is not possible for the SmartEvent server (the _cpsemd_ process) to communicate with both the Check Point log server and the OPSEC device, using the same port and the same authentication method. Therefore, the SmartEvent correlation unit is not working correctly and no events are being created. In order to solve this issue, you need to edit the relevant configuration files on both the Check Point log server and the SmartEvent server so that:\n        -   The Check Point log server will use one specific port, using SSL or no SSL.\n        -   Respectively, the OPSEC device will use a different port and a different authentication method.\n    5.  In order to configure it correctly, follow the instructions in [sk89620: Configuring a Log Server to work with both SmartEvent component and an OPSec LEA server](http://supportcontent.checkpoint.com/solutions?id=sk89620)\n-   ### \"Install Policy\" does not work\n    \n    _**Troubleshooting steps**_\n    \n    1.  Check that the correlation unit is up and running (make sure it is not in a Zombie state). If it is in a Zombie state, then run:\n        \n        _\\# cpwd\\_admin stop -name CPSEAD ; evstart_\n        \n    2.  Run:\n        \n        _\\# cpsem\\_load -d -p Standard All  \n        \\# fw debug cpsead on TDERROR\\_ALL\\_ALL=5_\n        \n        Check the _$RTDIR/log/cpsead.elg_ file.\n        \n    3.  Try to empty the _$RTDIR/conf/sem\\_masters_ file.\n-   ### No new events are shown in the SmartEvent GUI\n    \n    _**Introduction**_\n    \n    New events are not shown on the SmartEvent GUI. You need to check in which process in the SmartEvent functionality flow the issue occurs.\n    \n    _**Troubleshooting steps**_\n    \n    1.  Run the _cpwd\\_admin list_ command on the SmartEvent server and verify that all the relevant processes are up and running (_cpsead_, _cpsemd_, _dbsync_, _SVRserver_).\n    2.  If there is an issue with one of these SmartEvent processes, this should be further investigated by debugging the process.\n    3.  For example, run the _ps aux | grep postgres_ command in order to verify that the SmartEvent PostgreSQL database is up and running.\n    4.  If there is an issue with the PostgreSQL database, debug the PostgreSQL database, as follows:\n        1.  Run _cpstop_.\n        2.  Edit the _$RTDIR/events\\_db/data/postgresql.conf_ file as follows:\n            1.  Change:  \n                from _#logging\\_collector = off_  \n                to _logging\\_collector = on_\n            2.  Change:  \n                from _log\\_min\\_messages = warning_  \n                to _log\\_min\\_messages = error_\n        3.  Save the changes made in the file.\n        4.  Run _cpstart_.\n            \n            The following file will be created: _$RTDIR/events\\_db/data/pg\\_log/postgresql-YYY-MM-DD\\_HHMMSS.log_  \n            This file contains more debug output related to the PostgreSQL database issues.\n            \n    5.  Verify the basic SmartEvent definitions. For example: the SmartEvent policy configuration and installation, the Internal Network objects definitions, the log server and correlation unit definitions, install the database on the SmartEvent server, etc.\n    6.  If all the above are working properly, but there has been an issue in the past with one of the SmartEvent components, the following behavior will be seen: All the events generated by the _cpsead_ process (on the correlation unit) that were not stored on the PostgreSQL database for some reason, will be kept under the _$RTDIR/distrib/_ directory on the SmartEvent server. Consequently, this directory size will be significantly large. This can cause the events to 'get stuck' along the way and not get to the _cpsemd_ process that should store them in the PostgreSQL database.\n    7.  In order to solve this issue, the following steps should be performed on the SmartEvent server:\n        \n        _\\# evstop  \n        \\# cd $RTDIR/distrib/<UID>  \n        \\# rm --r \\*  \n        \\# $CPDIR/database/postgresql/bin/psql -U cp\\_postgres -p 18272 events\\_db -c \"UPDATE guaranteeddeltbl SET msgid = 0\"  \n        \\# evstart_\n        \n    \n    Also see [sk94964: SmartEvent shows no new events](http://supportcontent.checkpoint.com/solutions?id=sk94964).\n    \n\n## SmartEvent Debugging\n\n-   ## Debugging Introduction\n    \n    When a customer reports an issue, you first need to understand on which component this issue occurs. Then, you need to check which process is responsible for this component's functionality. Once you know which process is responsible for the issue, you know which process needs to be debugged and then you can discover the root cause for the issue.\n    \n    **For example:**\n    \n    The customer reports: The SmartEvent correlation unit status displays the following error message: \"No connection to correlation unit\"\n    \n    **Troubleshooting steps:**\n    \n    1.  You need to make sure that you understand the issue. Ask the customer for screenshots illustrating the issue.\n    2.  Now that you know on which component the issue occurs, you need to determine which process is responsible for the functionality of this component. The process responsible for the correlation unit functionality is _**cpsead**_.\n    3.  Since the _cpsead_ process is responsible for the correlation unit component, you need to check for issues with this process and in case needed, debug this process in order to find the root cause for the issue and resolve it.\n-   ## Debugging Syntax\n    \n    -   ### Debug of _cpsead_ daemon\n        \n        -   Instructions for Gaia OS / SecurePlatform OS / Linux OS:\n            \n            1.  Connect to the command line on the SmartEvent server.\n            2.  Log in to the Expert mode.\n            3.  Start the debug:\n                \n                _\\[Expert@HostName:0\\]# fw debug cpsead on TDERROR\\_ALL\\_ALL=5_\n                \n            4.  Replicate the issue.\n            5.  Stop the debug:\n                \n                _\\[Expert@HostName:0\\]# fw debug cpsead off TDERROR\\_ALL\\_ALL=0_\n                \n            6.  Collect and analyze the log files:\n                \n                _$RTDIR/log/cpsead.elg\\*_\n                \n        -   Instructions for Windows OS:\n            \n            1.  Open Windows Command Prompt on the SmartEvent server.\n            2.  Start the debug:\n                \n                _C:\\\\> fw debug cpsead on TDERROR\\_ALL\\_ALL=5_\n                \n            3.  Replicate the issue.\n            4.  Stop the debug:\n                \n                _C:\\\\> fw debug cpsead off TDERROR\\_ALL\\_ALL=0_\n                \n            5.  Collect and analyze the log files:\n                \n                _%RTDIR%\\\\log%\\\\cpsead.elg\\*_\n                \n    -   ### Debug of _cpsemd_ daemon\n        \n        -   Instructions for Gaia OS / SecurePlatform OS / Linux OS:\n            \n            1.  Connect to the command line on the SmartEvent server.\n            2.  Log in to the Expert mode.\n            3.  Start the debug:\n                \n                _\\[Expert@HostName:0\\]# fw debug cpsemd on TDERROR\\_ALL\\_ALL=5_\n                \n            4.  Replicate the issue.\n            5.  Stop the debug:\n                \n                _\\[Expert@HostName:0\\]# fw debug cpsemd off TDERROR\\_ALL\\_ALL=0_\n                \n            6.  Collect and analyze the log files:\n                \n                _$RTDIR/log/cpsemd.elg\\*_\n                \n        -   Instructions for Windows OS:\n            \n            1.  Open Windows Command Prompt on the SmartEvent server.\n            2.  Start the debug:\n                \n                _C:\\\\> fw debug cpsemd on TDERROR\\_ALL\\_ALL=5_\n                \n            3.  Replicate the issue.\n            4.  Stop the debug:\n                \n                _C:\\\\> fw debug cpsemd off TDERROR\\_ALL\\_ALL=0_\n                \n            5.  Collect and analyze the log files:\n                \n                _%RTDIR%\\\\log%\\\\cpsemd.elg\\*_\n                \n    -   ### Debug of _SVRServer_ daemon\n        \n        -   Instructions for Gaia OS / SecurePlatform OS / Linux OS:\n            \n            1.  Connect to the command line on the SmartReporter server.\n            2.  Log in to the Expert mode.\n            3.  Stop the current SmartReporter server:\n                \n                _\\[Expert@HostName:0\\]# rmdstop -server_\n                \n            4.  Set the debug environment variables:\n                \n                _\\[Expert@HostName:0\\]# set TDERROR\\_ALL\\_SVRServer=5_  \n                _\\[Expert@HostName:0\\]# set TDERROR\\_ALL\\_ReportingRepository=5_  \n                _\\[Expert@HostName:0\\]# set TDERROR\\_ALL\\_ReportingIS=5_  \n                _\\[Expert@HostName:0\\]# set TDERROR\\_ALL\\_Generator=5_  \n                _\\[Expert@HostName:0\\]# set TDERROR\\_ALL\\_GenManager=5_\n                \n            5.  Start the SmartReporter server daemon:\n                \n                _\\[Expert@HostName:0\\]# SVRServer_  \n                The information will be printed to the console and to the daemon's log file.\n                \n            6.  Replicate the issue.\n            7.  Stop the current SmartReporter server:\n                \n                _\\[Expert@HostName:0\\]# rmdstop -server_\n                \n            8.  Unset the debug environment variables:\n                \n                _\\[Expert@HostName:0\\]# set TDERROR\\_ALL\\_SVRServer=1_  \n                _\\[Expert@HostName:0\\]# set TDERROR\\_ALL\\_ReportingRepository=1_  \n                _\\[Expert@HostName:0\\]# set TDERROR\\_ALL\\_ReportingIS=1_  \n                _\\[Expert@HostName:0\\]# set TDERROR\\_ALL\\_Generator=1_  \n                _\\[Expert@HostName:0\\]# set TDERROR\\_ALL\\_GenManagr=1_\n                \n            9.  Collect and analyze these log files:\n                \n                _$RTDIR/log/SVRServer.log\\*_  \n                _$RTDIR/Results/<Report\\_Type>/<Date\\_Time>/geninfo.txt_\n                \n        -   Instructions for Windows OS:\n            \n            1.  Open Windows Command Prompt on the SmartEvent server.\n            2.  Stop the current SmartReporter server:\n                \n                _C:\\\\> rmdstop -server_\n                \n            3.  Set the debug environment variables:\n                \n                _C:\\\\> set TDERROR\\_ALL\\_SVRServer=5_  \n                _C:\\\\> set TDERROR\\_ALL\\_ReportingRepository=5_  \n                _C:\\\\> set TDERROR\\_ALL\\_ReportingIS=5_  \n                _C:\\\\> set TDERROR\\_ALL\\_Generator=5_  \n                _C:\\\\> set TDERROR\\_ALL\\_GenManager=5_\n                \n            4.  Start the SmartReporter server daemon:\n                \n                _C:\\\\> SVRServer_  \n                The information will be printed to the console and to the daemon's log file.\n                \n            5.  Replicate the issue.\n            6.  Stop the current SmartReporter server:\n                \n                _C:\\\\> rmdstop -server_\n                \n            7.  Unset the debug environment variables:\n                \n                _C:\\\\> set TDERROR\\_ALL\\_SVRServer=1_  \n                _C:\\\\> set TDERROR\\_ALL\\_ReportingRepository=1_  \n                _C:\\\\> set TDERROR\\_ALL\\_ReportingIS=1_  \n                _C:\\\\> set TDERROR\\_ALL\\_Generator=1_  \n                _C:\\\\> set TDERROR\\_ALL\\_GenManagr=1_\n                \n            8.  Collect and analyze these log files:\n                \n                _%RTDIR%\\\\log\\\\SVRServer.log\\*_  \n                _%RTDIR%\\\\Results\\\\<Report\\_Type>\\\\<Date\\_Time>\\\\geninfo.txt_\n                \n    -   ### Debug of _dbsync_ daemon\n        \n        -   Instructions for Gaia OS / SecurePlatform OS / Linux OS:\n            \n            1.  Connect to the command line on the SmartEvent server.\n            2.  Log in to the Expert mode.\n            3.  Start the debug:\n                \n                _\\[Expert@HostName:0\\]# fw debug dbsync on TDERROR\\_ALL\\_ALL=5_\n                \n            4.  Replicate the issue.\n            5.  Stop the debug:\n                \n                _\\[Expert@HostName:0\\]# fw debug dbsync off TDERROR\\_ALL\\_ALL=0_\n                \n            6.  Collect and analyze the log files:\n                \n                _$RTDIR/log/dbsync.elg\\*_\n                \n        -   Instructions for Windows OS:\n            \n            1.  Open Windows Command Prompt on the SmartEvent server.\n            2.  Start the debug:\n                \n                _C:\\\\> fw debug dbsync on TDERROR\\_ALL\\_ALL=5_\n                \n            3.  Replicate the issue.\n            4.  Stop the debug:\n                \n                _C:\\\\> fw debug dbsync off TDERROR\\_ALL\\_ALL=0_\n                \n            5.  Collect and analyze the log files:\n                \n                _%RTDIR%\\\\log%\\\\dbsync.elg\\*_\n                \n    -   ### Debug of PostgreSQL database\n        \n        -   Instructions for Gaia OS / SecurePlatform OS / Linux OS:\n            \n            -   Output on whether the PostgreSQL database has started successfully or not can be found in the following file:\n                \n                _$CPDIR/log/postgresqlcmd.elg_\n            -   In order to get more debug output related to the PostgreSQL database issues, the following steps should be performed on the SmartEvent server:\n                1.  Run _cpstop_.\n                2.  Backup the current _$RTDIR/events\\_db/data/postgresql.conf_ file.\n                3.  Edit the _$RTDIR/events\\_db/data/postgresql.conf_ file as follows:\n                    1.  Change:  \n                        from _#logging\\_collector = off_  \n                        to _logging\\_collector = on_\n                    2.  Change:  \n                        from _log\\_min\\_messages = warning_  \n                        to _log\\_min\\_messages = error_\n                4.  Save the changes made in the file.\n                5.  Run _cpstart_.\n                6.  The following file will be created:\n                    \n                    _$RTDIR/events\\_db/data/pg\\_log/postgresql-YYY-MM-DD\\_HHMMSS.log_\n                    \n                    This file contains more debug output related to the PostgreSQL database issues.\n                    \n                7.  Replicate the issue.\n                8.  Run _cpstop_.\n                9.  Backup the current debug _$RTDIR/events\\_db/data/postgresql.conf_ file.\n                10.  Restore the original _$RTDIR/events\\_db/data/postgresql.conf_ file.\n                11.  Run _cpstart_.\n                12.  Collect and analyze the log files:\n                    \n                    _$RTDIR/events\\_db/data/pg\\_log/postgresql-YYY-MM-DD\\_HHMMSS.log\\*_\n                    \n        -   Instructions for Windows OS:\n            \n            -   Output on whether the PostgreSQL database has started successfully or not can be found in the following file:\n                \n                _%CPDIR%\\\\log\\\\postgresq\\\\cmd.elg_\n            -   In order to get more debug output related to the PostgreSQL database issues, the following steps should be performed on the SmartEvent server:\n                1.  Run _cpstop_.\n                2.  Backup the current _%RTDIR%\\\\events\\_db\\\\data\\\\postgresql.conf_ file.\n                3.  Edit the _%RTDIR%\\\\events\\_db\\\\data\\\\postgresql.conf_ file as follows:\n                    1.  Change:  \n                        from _#logging\\_collector = off_  \n                        to _logging\\_collector = on_\n                    2.  Change:  \n                        from _#log\\_directory = 'pg\\_log'_  \n                        to _log\\_directory = 'pg\\_log'_\n                    3.  Change:  \n                        from _#log\\_min\\_duration\\_statement = -1_  \n                        to _log\\_min\\_duration\\_statement = 0_\n                    4.  Change:  \n                        from _#log\\_line\\_prefix = ''_  \n                        to _log\\_line\\_prefix = '<%t %p>'_\n                    5.  Change:  \n                        from _#log\\_statement = 'none'_  \n                        to _log\\_statement = 'all'_\n                4.  Save the changes made in the file.\n                5.  Run _cpstart_.\n                6.  The following file will be created:\n                    \n                    _%RTDIR%\\\\events\\_db\\\\data\\\\pg\\_log\\\\postgresql-YYY-MM-DD\\_HHMMSS.log_\n                    \n                    This file contains more debug output related to the PostgreSQL database issues.\n                    \n                7.  Replicate the issue.\n                8.  Run _cpstop_.\n                9.  Backup the current debug _%RTDIR%\\\\events\\_db\\\\data\\\\postgresql.conf_ file.\n                10.  Restore the original _%RTDIR%\\\\events\\_db\\\\data\\\\postgresql.conf_ file.\n                11.  Run _cpstart_.\n                12.  Collect and analyze the log files:\n                    \n                    _%RTDIR%\\\\events\\_db\\\\data\\\\pg\\_log\\\\postgresql-YYY-MM-DD\\_HHMMSS.log\\*_\n                    \n\n**Related Solutions:**\n\n-   [sk98767: SmartEvent NGSE](http://supportcontent.checkpoint.com/solutions?id=sk98767)\n-   [sk33810: How to backup and restore SmartEvent / SmartReporter server](http://supportcontent.checkpoint.com/solutions?id=sk33810)\n-   [sk90660: How to move SmartEvent / Eventia Analyzer database to different hard drive on Windows 2003](http://supportcontent.checkpoint.com/solutions?id=sk90660)\n-   [sk90103: SmartReporter Database Management Tasks](http://supportcontent.checkpoint.com/solutions?id=sk90103)\n-   [sk69706: Past Events in SmartEvent are deleted when current database size reaches 200 GB or after 365 days](http://supportcontent.checkpoint.com/solutions?id=sk69706)\n-   [sk80720: SmartEvent Performance Tuning Guide](http://supportcontent.checkpoint.com/solutions?id=sk80720)\n-   [sk92766: SmartEvent stops getting new events](http://supportcontent.checkpoint.com/solutions?id=sk92766)\n-   [sk56781: SmartEvent / Eventia Analyzer stopped showing new events on the 'Events' tab in the SmartEvent GUI](http://supportcontent.checkpoint.com/solutions?id=sk56781)\n-   [sk113265: \"Correlation Unit <Correlation\\_Unit\\_Server\\_Name (IP\\_Address)> is running out of disk space\" error in SmartEvent GUI](http://supportcontent.checkpoint.com/solutions?id=sk113265)\n\n## Article Properties\n\nOriginatorDavid Kornfield\n\nTechnical ResourceNitzan Massad\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2013-08-04\n\nLast Modified2024-10-27\n\nEditorRachel Teitz\n\nLast ApproverDaniel Epstein\n\n## Comments\n\n#### Internal only\n\nFrom: Nitzan Massad <nitzanm@checkpoint.com>   \nSent: Sunday, December 4, 2022 10:41 AM  \nTo: Rachel Teitz <rachelt@checkpoint.com>  \nSubject: RE: Update sk92769 and sk93970\n\nWe didn't change a thing in does two products. So no need to update the content. \n\nThanks,  \nNitzan Massad\n\nFrom: Rachel Teitz   \nSent: Sunday, December 4, 2022 10:38  \nTo: Nitzan Massad  \nSubject: RE: Update sk92769 and sk93970\n\nHi Nitzan,\n\nIn each SK, does the content need to be updated, or is it enough just to add R81.20 to the listed version?  \n\\------------------------------------------------------------------------------------------------  \n**  \nImportant note: Prior to using the tools mentioned in this article, make sure you thoroughly go over [sk156153 - Best Practice Guide for Debugging Check Point Products](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk156153).**\n\nPostgreSQL Logging:\n\n[http://wiki.postgresql.org/images/9/9d/Logging\\_pgopen\\_withnotes.pdf](http://wiki.postgresql.org/images/9/9d/Logging_pgopen_withnotes.pdf)","language":"md","time":"14 days ago","created":"2025-05-06T22:56:01.614Z","annotations":[],"updated":"2025-05-06T22:58:06.649Z"},{"title":"ProductAnti-Bot, Anti-Spam, URL Filtering","id":"53b3045f-1dc4-4a3e-ba9c-cd97a9b66bfb","type":"TEXT","raw":"ProductAnti-Bot, Anti-Spam, Anti-Virus, URL Filtering\n\nVersionR80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nPlatformAll\n\nLast Modified2023-04-30\n\n## Symptoms\n\n-   \"_Contract is expired_\" or \"_Contract entitlement check failed_\" error appears in SmartConsole / SmartDashboard during policy installation.\n    \n\n## Solution\n\nClick Here to Show the Entire Article\n\n## **Scenario 1**\n\n### **Additional Symptoms**\n\n-   Fwd debug shows:  \n    `BusinessFault - code: [003] details: [EntitlementEJB:doProductEntitlement() User Product Entitlement Failure]`  \n    `EntitlementEJB:doProductEntitlement() User Product Entitlement Failure was converted to FDT code: 19`  \n    `get_business_fault returned: 19`  \n    `19 with details [EntitlementEJB:doProductEntitlement() User Product Entitlement Failure]`\n-   fwd debug shows:  \n    `fwasync_conn_pre_send_check: Internal error. Failed to enlarge connection buffer`   \n    `Error opening file /opt/CPshrd-R77/CTX/CTX00001/database//authkeys.C:: No such file or directory`\n-   Traffic capture shows one-way communication to Check Point servers.\n\n  \n\n## Scenario 2\n\n### Additional Symptoms\n\n-   \"`Update failed. Gateway cannot access internet`\" error appears in SmartView Tracker.\n-   SmartView Monitor shows a wrong expiration date for the Anti-Virus and Anti-Bot Software Blades\n\n**Related solutions:**\n\n-   [sk43807 - Anti-Virus and URL Filtering update fails on the Standby member of ClusterXL in High Availability mode](http://supportcontent.checkpoint.com/solutions?id=sk43807)\n-   [sk92264 - ATRG: Anti-Bot and Anti-Virus](http://supportcontent.checkpoint.com/solutions?id=sk92264)\n-   [sk100177 - Contracts Expiration warning for Application Control / URL Filtering / Anti-Bot / Anti-Virus during policy installation](http://supportcontent.checkpoint.com/solutions?id=sk100177)\n-   [sk84580 - Incorrect Dates for Service Blades During Policy Push and/or in SmartView Monitor](http://supportcontent.checkpoint.com/solutions?id=sk84580)\n-   [sk83520 - How to verify that Security Gateway and/or Security Management Server can access Check Point servers?](http://supportcontent.checkpoint.com/solutions?id=sk83520)\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorZiv Huyan\n\nTechnical ResourceYan Renaud\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2014-02-19\n\nLast Modified2023-04-30\n\nEditorRonit Segal\n\nLast ApproverRonit Segal\n\n## Comments\n\n#### Internal only\n\n**sk137113 was merged into this sk**\n\n**Internal comments for Scenario 2:  \nImportant note: Prior to using the tools mentioned in this article, make sure you thoroughly go over [sk156153 - Best Practice Guide for Debugging Check Point Products](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk156153).**\n\nA possible simple RC is that **the policy used for the AB/AV  Firewall doesn't include the Threat Prevention policy under it**, thus the TP policy was never pushed to the FW.\n\nAdded \\[--proxy IP\\_or\\_HostName:Port \\] to **curl\\_cli** calls","language":"md","time":"14 days ago","created":"2025-05-06T22:56:05.086Z","annotations":[],"updated":"2025-05-06T22:58:11.949Z"},{"title":"Deleting Entries from Gaia Configuration Database","id":"2ee56f87-54bd-4336-a7c3-bb5f01edefb4","type":"TEXT","raw":"---\ncreated: 2025-05-05T11:37:37 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk87062\nauthor: \n---\n\n# sk87062 - How to delete entries from Gaia configuration database\n\n> ## Excerpt\n> Applies to: Quantum Security Gateways, Quantum Security Management\n\n---\nProductQuantum Security Gateways, Quantum Security Management\n\nVersionAll\n\nOSGaia\n\nPlatformAll\n\nLast Modified2022-07-27\n\n## Solution\n\n**Important: This article contains steps that directly modify the Gaia Database. Serious problems might occur if you modify the database incorrectly. Therefore, make sure that you follow the provided steps carefully.**\n\n**Examples:**\n\n-   Show / Hide instructions for deleting the BGP entries\n    \n    > 1.  Connect to the command line on Gaia OS.\n    >     \n    > 2.  Log in to the Expert mode.\n    >     \n    > 3.  Backup the current Gaia Database files:\n    >     \n    >     **`[Expert@HostName:0]# cp -v /config/db/initial /config/db/initial_BACKUP`**\n    >     \n    >     **`[Expert@HostName:0]# cp -v /config/db/initial_db /config/db/initial_db_BACKUP`**\n    > 4.  Delete all the BGP entries from the Gaia Database:\n    >     \n    >     **`[Expert@HostName]# grep ':bgp0' /config/db/initial | cut -d \" \" -f 1 | xargs -n 1 dbset`**\n    >     \n    >     References:\n    >     \n    >     -   [https://linux.die.net/man/1/grep](https://linux.die.net/man/1/grep)\n    >     -   [https://linux.die.net/man/1/cut](https://linux.die.net/man/1/cut)\n    >     -   [https://linux.die.net/man/1/xargs](https://linux.die.net/man/1/xargs)\n    > 5.  Save the changes in Gaia Gatabase:\n    >     \n    >     **`[Expert@HostName]# dbset :save`**\n    >     \n    >     **Note:** If \"`dbset :save`\" command is not operational (e.g., you are working in Single Mode / Maintenance Mode), then run the following command:  \n    >     **`# conv2db /config/db/initial /config/db/initial_db`**\n    >     \n    > 6.  Verify the BGP entries in the Gaia Database:\n    >     \n    >     **`[Expert@HostName]# grep ':bgp0' /config/db/initial`**\n    > 7.  Reconfigure the BGP (either in Gaia Portal, or in Gaia Clish).\n    >     \n    \n-   Show / Hide instructions for deleting the Bond interface entries\n    \n    > 1.  Connect to the command line on Gaia OS.\n    >     \n    > 2.  Log in to the Expert mode.\n    >     \n    > 3.  Backup the current Gaia Database files:\n    >     \n    >     **`[Expert@HostName:0]# cp -v /config/db/initial /config/db/initial_BACKUP`**\n    >     \n    >     **`[Expert@HostName:0]# cp -v /config/db/initial_db /config/db/initial_db_BACKUP`**\n    > 4.  Delete all the entries of the problematic bond from the Gaia Database:\n    >     \n    >     **`[Expert@HostName]# grep ':bond<ID>' /config/db/initial | cut -d “ “ -f 1 | xargs -n 1 dbset`**\n    >     \n    >     _Example for Bond0_:  \n    >     `[Expert@HostName]# grep ':bond0' /config/db/initial | cut -d \" \" -f 1 | xargs -n 1 dbset`\n    >     \n    >     References:\n    >     \n    >     -   [https://linux.die.net/man/1/grep](https://linux.die.net/man/1/grep)\n    >     -   [https://linux.die.net/man/1/cut](https://linux.die.net/man/1/cut)\n    >     -   [https://linux.die.net/man/1/xargs](https://linux.die.net/man/1/xargs)\n    > 5.  Save the changes in Gaia Gatabase:\n    >     \n    >     **`[Expert@HostName]# dbset :save`**\n    >     \n    >     **Note:** If \"`dbset :save`\" command is not operational (e.g., you are working in Single Mode / Maintenance Mode), then run the following command:  \n    >     **`# conv2db /config/db/initial /config/db/initial_db`**\n    >     \n    > 6.  Verify the Bond entries in the Gaia Database:\n    >     \n    >     **`[Expert@HostName]# grep ':bond<ID>' /config/db/initial`**\n    >     \n    >     _Example for Bond0_:  \n    >     `[Expert@HostName]# grep ':bond0' /config/db/initial`\n    >     \n    > 7.  Reboot.\n    >     \n    > 8.  Reconfigure the relevant Bond interface.\n    >     \n    \n\n**Notes:**\n\n-   Modify the syntax of the '`grep`' command to match only the entries you want to remove.\n    \n-   If there are routemaps configured, which you do not want to remove, then make sure the '`grep`' does not match them.\n    \n-   The entry, for which you are searching has to be inside single quotes:\n    \n    **`[Expert@HostName]# grep '_search_pattern_' /config/db/initial`**\n\n**Also see** [sk108497 - BGP routemaps stop working correctly after upgrade](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk108497). This SK contains another procedure how to delete entries from Gaia Database.\n\n## Article Properties\n\nOriginatorKeith Fruge\n\nTechnical ResourceMajd Sharkia\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2012-11-01\n\nLast Modified2022-07-27\n\nEditorStella Shteinbuk\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only\n\nFrom: Itai Weiss  \nSent: Wednesday, July 25, 2018 4:20 PM  \nTo: Gil Frantsus  \nCc: Amit Danziger; Alexander Kim; Tal Martsiano  \nSubject: RE: Feedback for Solution: sk87062\n\nHi Gil,\n\nThe customer is correct with his explanation below.\n\nAlthough I was able to delete using the '-d/ -f 1' it might be better to change it to:\n\n-   '-d \\\\ -f 1'\n-   In this option it's important to have 2 spaces after '\\\\' so it might be better to use the option '-d \" \" –f 1' – less room for mistakes.\n\nItai.\n\n#Tested in my lab, Had to use bond0 instead of bond 0 ( See step 4) .   \n#Verified and has been tested in my lab\n","language":"md","time":"14 days ago","created":"2025-05-06T22:55:59.127Z","annotations":[],"updated":"2025-05-06T22:57:10.369Z"},{"title":"Supported Transceivers and Appliances Compatibility Matrix","id":"959170dc-c652-4aae-a1bb-823b5a45cb03","type":"TEXT","raw":"<table id=\"Unique_ID6Table\"><tbody><tr><td>Description</td><td>Supported Transceivers</td><td>Supported Appliances <sup>(Note 5)</sup></td><td>Supported Rates</td></tr><tr><td><p>1000BASE-CU SFP (*)</p></td><td><ul><li>CPAC-TR-1T-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li></ul></td><td><ul><li>1 GbE</li></ul></td></tr><tr><td><p>1000BASE-CU SFP (*)</p></td><td><ul><li>CPAC-TR-1T-B</li><li>CPAC-TR-1T-C</li></ul></td><td><ul><li>MHO140</li><li>MHO175 (using adapter and starting from R82)</li></ul></td><td><ul><li>1 GbE</li></ul></td></tr><tr><td><p>1000BASE-SX SFP</p></td><td><ul><li>CPAC-TR-1SX-B</li><li>CPAC-TR-1SX-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li></ul></td><td><ul><li>1 GbE</li></ul></td></tr><tr><td><p>1000BASE-SX SFP</p></td><td><ul><li>CPAC-TR-1SX-C</li></ul></td><td><ul><li>MHO140</li><li>MHO175 (using adapter and starting from R82)</li></ul></td><td><ul><li>1 GbE</li></ul></td></tr><tr><td><p><span>1000BASE-LX SFP</span></p></td><td><ul><li><span>CPAC-TR-1LX-B</span></li><li><span>CPAC-TR-1LX-C</span></li><li><span>CPAC-TR-1LX-D (see Note 4)</span></li></ul></td><td><ul><li><span>MHO140</span></li></ul></td><td><ul><li><span>1 GbE</span></li></ul></td></tr><tr><td rowspan=\"2\"><p>10GBASE-T SFP+</p></td><td><ul><li>CPAC-TR-10T-C</li><li>CPAC-TR-10T-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li></ul></td><td><ul><li>10 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-10T-ADP (see Note 1)</li><li>CPAC-TR-10T-D-ADP (see Note 1)</li></ul></td><td><ul><li>MHO175</li></ul></td><td><ul><li>10 GbE</li></ul></td></tr><tr><td rowspan=\"2\"><p>10GBASE-SR SFP+</p></td><td><ul><li>CPAC-TR-10SR-B</li><li>CPAC-TR-10SR-C</li><li>CPAC-TR-10SR-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li></ul></td><td><ul><li>10 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-10SR-ADP (see Note 1)</li><li>CPAC-TR-10SR-D-ADP (see Note 1,4)</li></ul></td><td><ul><li>MHO175</li></ul></td><td><ul><li>10 GbE</li></ul></td></tr><tr><td rowspan=\"2\"><p>10GBASE-LR SFP+</p></td><td><ul><li>CPAC-TR-10LR-B</li><li>CPAC-TR-10LR-CM</li><li>CPAC-TR-10LR-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li></ul></td><td><ul><li>10 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-10LR-ADP (see Note 1)</li><li>CPAC-TR-10LR-D-ADP (see Note 1,4)</li></ul></td><td><ul><li>MHO175</li></ul></td><td><ul><li>10 GbE</li></ul></td></tr><tr><td><p>10GBASE-CU-1M SFP+</p></td><td><ul><li>CPAC-DAC-10G-1M-B</li><li>CPAC-DAC-10G-1M</li><li>CPAC-DAC-10G-1M-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO175</li></ul></td><td><ul><li>10 GbE</li></ul></td></tr><tr><td><p>10GBASE-CU-3M SFP+</p></td><td><ul><li>CPAC-DAC-10G-3M-B</li><li>CPAC-DAC-10G-3M</li><li>CPAC-DAC-10G-3M-D</li></ul></td><td><ul><li>MHO140</li><li>MHO175</li></ul></td><td><ul><li>10 GbE</li></ul></td></tr><tr><td><p>10GBASE-CU-5M SFP+</p></td><td><ul><li>CPAC-DAC-10G-5M</li><li>CPAC-DAC-10G-5M-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO175</li></ul></td><td><ul><li>10 GbE</li></ul></td></tr><tr><td><p>10GBASE-ER SFP+</p></td><td><ul><li>CPAC-TR-10ER-C</li><li>CPAC-TR-10ER-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li></ul></td><td><ul><li>10 GbE</li></ul></td></tr><tr><td rowspan=\"2\"><p>25GBASE-SR SFP28</p><p>(Supported in R81.20 and higher)</p></td><td><ul><li>CPAC-TR-25SR-DM (see Note 4)</li></ul></td><td><ul><li>MHO-140</li></ul></td><td><ul><li>25 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-25SR-ADP (see Note 1)</li><li>CPAC-TR-25SR-D-ADP (see Note 1,4)</li></ul></td><td><ul><li>MHO-175</li></ul></td><td><ul><li>25 GbE</li></ul></td></tr><tr><td><div><p>25GBASE-CR4-1M SFP28</p><p>(Supported in R81.20 and higher)</p></div></td><td><ul><li>CPAC-DAC-25G-1M</li><li>CPAC-DAC-25G-1M-D (see Note 4)</li></ul></td><td><ul><li>MH0140</li><li>MHO170 (see Note 3)</li><li>MHO175 (see Note 3)</li></ul></td><td><ul><li>25 GbE</li></ul></td></tr><tr><td><p>25GBASE-CR4-3M SFP28</p><p>(Supported in R81.20 and higher)</p></td><td><ul><li>CPAC-DAC-25G-3M</li><li>CPAC-DAC-25G-3M-D (see Note 4)</li></ul></td><td><ul><li>MH0140</li><li>MHO170 (see Note 3)</li><li>MHO175 (see Note 3)</li></ul></td><td><ul><li>25 GbE</li></ul></td></tr><tr><td><div><p>25GBASE-CR4-5M SFP28</p><p>(Supported in R81.20 and higher)</p></div></td><td><ul><li>CPAC-DAC-25G-5M</li><li>CPAC-DAC-25G-5M-D (see Note 4)</li></ul></td><td><ul><li>MH0140</li><li>MHO170 (see Note 3)</li><li>MHO175 (see Note 3)</li></ul></td><td><ul><li>25 GbE</li></ul></td></tr><tr><td rowspan=\"2\"><p>40GBASE-SR4 QSFP+</p></td><td><ul><li>CPAC-TR-40SR-QSFP-100m</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>40 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-40SR-QSFP-100m-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO175</li></ul></td><td><ul><li>40 GbE</li></ul></td></tr><tr><td rowspan=\"2\"><p>40GBASE-SR4E QSFP+</p></td><td><ul><li>CPAC-TR-40SR-QSFP-300m</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>40 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-40SR-QSFP-300m-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO175</li></ul></td><td><ul><li>40 GbE</li></ul></td></tr><tr><td rowspan=\"2\"><p>40GBASE-LR4 QSFP+</p></td><td><ul><li>CPAC-TR-40LR-QSFP-10Km</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>40 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-40LR-QSFP-10Km-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO175</li></ul></td><td><ul><li>40 GbE</li></ul></td></tr><tr><td rowspan=\"2\"><p>40GBASE-SR-BD QSFP+</p></td><td><ul><li>CPAC-TR-40SR-QSFP-BIDI</li></ul></td><td><ul><li>MHO140</li><li>MHO175</li></ul></td><td><ul><li>40 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-40SR-QSFP-BIDI-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>40 GbE</li></ul></td></tr><tr><td><p>40GBASE-SWDM4 QSFP+</p></td><td><ul><li>CPAC-TR-40SWDM4</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>40 GbE</li></ul></td></tr><tr><td rowspan=\"2\"><p>40GBASE-ER4 QSFP+</p></td><td rowspan=\"2\"><ul><li>CPAC-TR-40ER4</li></ul></td><td rowspan=\"2\"><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td rowspan=\"2\"><ul><li>40 GbE</li></ul></td></tr><tr></tr><tr><td><p>MTP/MPO to 4 Duplex LC Breakout Cable, OM3, 3m</p></td><td><ul><li>CPAC-TR-40SPLIT-QSFP-3M (see Note 2)</li></ul></td><td><ul><li>MHO140</li><li>MHO175</li></ul></td><td><ul><li>40 GbE to 4x10 GbE</li></ul></td></tr><tr><td><p>MTP/MPO to 4 Duplex LC Breakout Cable, OM3, 6m</p></td><td><ul><li>CPAC-TR-40SPLIT-QSFP-6M (see Note 2)</li></ul></td><td><ul><li>MHO140</li><li>MHO175</li></ul></td><td><ul><li>40 GbE to 4x10 GbE</li></ul></td></tr><tr><td><p>40GBASE-CR4-1M QSFP+</p></td><td><ul><li>CPAC-DAC-40G-1M-B</li><li>CPAC-DAC-40G-1M</li><li>CPAC-DAC-40G-1M-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>40 GbE</li></ul></td></tr><tr><td><p>40GBASE-CR4-3M QSFP+</p></td><td><ul><li>CPAC-DAC-40G-3M-B</li><li>CPAC-DAC-40G-3M</li><li>CPAC-DAC-40G-3M-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>40 GbE</li></ul></td></tr><tr><td><p>40GBASE-CR4-5M QSFP+</p></td><td><ul><li>CPAC-DAC-40G-5M</li><li>CPAC-DAC-40G-5M-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>40 GbE</li></ul></td></tr><tr><td><p>40/10GBASE-CR4/CU QSFP+/SFP+</p></td><td><ul><li>CPAC-DAC-40/10G-1M-B</li><li>CPAC-DAC-40/10G-1M</li><li>CPAC-DAC-40/10G-3M-B</li><li>CPAC-DAC-40/10G-3M</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>10 GbE</li><li>40 GbE</li></ul></td></tr><tr><td rowspan=\"3\"><p>100GBASE-SR4 QSFP28</p></td><td><ul><li>CPAC-TR-100SR-B</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-100SR-MHO140/170</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-100SR</li><li>CPAC-TR-100SR-D (see Note 4)</li></ul></td><td><ul><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td rowspan=\"2\"><p>100GBASE-LR4 QSFP28</p></td><td><ul><li>CPAC-TR-100LR-B</li><li>CPAC-TR-100LR</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-100LR-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td><p>100GBASE-CR4-1M QSFP28</p></td><td><ul><li>CPAC-DAC-100G-1M-B</li><li>CPAC-DAC-100G-1M</li><li>CPAC-DAC-100G-1M-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td><p>100GBASE-CR4-3M QSFP28</p></td><td><ul><li>CPAC-DAC-100G-3M-B</li><li>CPAC-DAC-100G-3M</li><li>CPAC-DAC-100G-3M-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td><p>100GBASE-CR4-5M QSFP28</p></td><td><ul><li>CPAC-DAC-100G-5M</li><li>CPAC-DAC-100G-5M-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td><p>25/100GBASE-CR4/CU QSFP28/SFP28</p></td><td><ul><li>CPAC-DAC-100/25G-3M</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>25 GbE</li><li>100 GbE</li></ul></td></tr><tr><td rowspan=\"2\"><p>100GBASE-SWDM4 QSFP28</p></td><td><ul><li>CPAC-TR-100SWDM4</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-100SWDM4-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td rowspan=\"2\"><p>100GBASE-CWDM4 QSFP28</p></td><td><ul><li>CPAC-TR-100CWDM4</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td><ul><li>CPAC-TR-100CWDM4-D (see Note 4)</li></ul></td><td><ul><li>MHO140</li><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td><p>100GBASE-SR1.2 QSFP28</p></td><td><ul><li>CPAC-TR-100SR-BiDi</li></ul></td><td><ul><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr><tr><td><p>100GBASE-ER4 QSFP28</p></td><td><ul><li>CPAC-TR-100ERL4</li></ul></td><td><ul><li>MHO140</li><li>MHO170</li><li>MHO175</li></ul></td><td><ul><li>100 GbE</li></ul></td></tr></tbody></table>\n\n**Note 1**: This SKU includes the adapter CPAC-TR-QSFP28-SFP28 and the transceiver.\n\n**Note 2**: We recommend to use the CPAC-TR-40SR-QSFP-100m transceiver when you use the splitter CPAC-TR-40SPLIT-QSFP-3M or CPAC-TR-40SPLIT-QSFP-6M.\n\n**Note 3**: Requires an adapter CPAC-TR-QSFP28-SFP28 for the transceiver or DAC to connect to the QSFP28 interfaces.\n\n**Note 5**: On **MHO-170** and **MHO-175**, only the ports 1, 2, 31, and 32 support transceivers that require more than 5W (for example, CPAC-TR-100ERL4).","language":"md","time":"14 days ago","created":"2025-05-06T22:56:01.826Z","annotations":[],"updated":"2025-05-06T22:57:25.012Z"},{"title":"Configuration for Routemap with Gaia Clish","id":"32e9724f-053d-44a3-80ce-398e77ce2f67","type":"TEXT","raw":"---\ncreated: 2025-05-01T13:55:24 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk100501\nauthor: \n---\n\n# sk100501 - How to configure Routemaps in Gaia Clish\n\n> ## Excerpt\n> Applies to: Cluster - 3rd-party, ClusterXL, Quantum Security Gateways, VSX (Traditional)\n\n---\nThis article explains how to configure routing policy with the routemaps utility on Gaia OS. This allows routes to be shared among different routing protocols, and allows the user to configure different policies for different sets of routes.\n\n**Table of Contents:**\n\n1.  Routemap Behavior\n    \n2.  Warnings\n    \n3.  Configuring Import Routemaps\n    \n    1.  Importing all routes from a specific protocol\n        \n    2.  Importing only selected routes\n        \n    3.  Rejecting selected routes while importing\n        \n    4.  Applying parameters to selected imported routes\n        \n4.  Configuring Export Routemaps\n    \n    1.  Exporting all routes from one or more protocols\n        \n    2.  Exporting only selected routes\n        \n    3.  Restricting routes while exporting\n        \n5.  Verifying the Routemap Configuration\n    \n6.  Related documentation\n    \n7.  Related solutions\n    \n\n## (1) Routemap Behavior\n\nEach protocol with Routemap support allows configuration of Import Routemaps and Export Routemaps.  \nA protocol's Import Routemaps govern, which routes will be imported into the routing table from that protocol.  \nA protocol's Export Routemaps govern, which routes from other routing protocols will be sent out with that protocol.\n\nWhen multiple import routemaps or export routemaps are configured for the same protocol, the routemap with the lowest configured preference value is applied first; if no match is found, the next highest preference is checked, etc.  \nIf a BGP peer has routemaps configured as per [sk110477](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk110477), then these routemaps will be used instead of the routemaps configured for the associated peer group.\n\nWithin a routemap, the same procedure applies when checking individual routemap IDs: the IDs are checked from lowest to highest until a match is found. Therefore, more specific match conditions should have lower IDs or should be present in lower preference routemaps so that they are checked first, instead of being ignored in favor of less specific match conditions.  \nFor a single protocol, or BGP AS, two or more routemaps of the same type (import, export) may not have the same configured preference value.\n\nRoutemaps automatically match the protocol that is using them, unless another protocol is specified. Therefore, when no match protocol condition is specified on a routemap, it automatically matches all routes from that protocol.\n\nAdding match conditions of the same type increases the number of routes matched, while adding match conditions of different types decreases the number of routes matched. Therefore, \"match interface eth1\" + \"match interface eth2\" is equivalent to \"match routes with nexthop interface eth1 or eth2\" (less specific), while \"match interface eth1\" + \"match network 192.168.0.0/16\" is equivalent to \"match routes with nexthop interface eth1 and network 192.168.0.0/16\" (more specific).\n\n**Note: VLANs and bonding groups are treated the same as other logical interfaces for the purposes of routemap policy.**\n\n## (2) Warnings\n\nWhen you configure route maps, you change the default behavior of routing protocols. Be careful when you configure these settings. An accidental change to routing protocols can block routes that were imported before, which can result in a loss of connectivity, or send routes out publicly, which can cause security vulnerabilities. \n\n**Enabling a routemap for any protocol will cause any Inbound Route Filters or Route Redistribution settings for that protocol to be ignored.**\n\n## (3) Configuring Import Routemaps\n\n### (3-A) Importing all routes from a specific protocol\n\n1.  Create the routemap:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ on`**\n2.  Optionally, you may specify one or more actions you wish to take on the imported routes:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ action _ACTION_IF_MATCH_SUCCEEDS_`**\n3.  Since no match conditions are specified, this routemap matches all routes for the protocol that is using it. Set the import routemap on the protocol(s), from which you wish to import the routes:\n    \n    **`HostName> set _PROTOCOL_ import-routemap _ROUTEMAP_NAME_ preference _ROUTEMAP_PREFERENCE_NUMBER_ on`**\n4.  Save Gaia configuration:\n    \n    **`HostName> save config`**\n5.  All routes from that protocol will now be imported.\n\nRepeat these steps for all protocols, from which you wish to import the routes.  \nNote that if identical behavior is desired for multiple protocols, the same routemap may be used for each of those protocols.\n\n_Example_:\n\nImport all routes from BGP Internal and BGP AS 100, and set the weight to 15:\n\n> ```\n> HostName&gt; set routemap bgp_import id 1 on\n> HostName&gt; set routemap bgp_import id 1 action preference 15\n> HostName&gt; set bgp internal import-routemap bgp_import preference 1 on\n> HostName&gt; set bgp external remote-as 100 import-routemap bgp_import preference 1 on\n> HostName&gt; save config\n> ```\n\n### (3-B) Importing only selected routes\n\n1.  Create several routemap IDs on the same routemap:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ on`**\n    \n    Note: Create a routemap for each set of match conditions you wish to specify.\n2.  Set the match conditions for each ID:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ match`**\n    \n    Note: These match conditions should be tailored to the routes that you wish to accept.\n3.  For each ID, set the ID type to \"`Allow`\" to allow the matched routes:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ allow`**\n4.  Optionally, for each ID, you may specify one or more actions you wish to take on the imported routes:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ action _ACTION_IF_MATCH_SUCCEEDS_`**\n5.  Set the import routemap to this newly created routemap on the protocol(s), from which you wish to import the routes:\n    \n    **`HostName> set _PROTOCOL_ import-routemap _ROUTEMAP_NAME_ preference _ROUTEMAP_PREFERENCE_NUMBER_ on`**\n6.  Save Gaia configuration:\n    \n    **`HostName> save config`**\n\n_Example_:\n\nImport RIP routes with metric 100, or with nexthop interface eth0 or eth2.  \nFor the routes matched to nexthop interface, add 10 to the metric value:\n\n> ```\n> HostName&gt; set routemap rip_import id 1 on\n> HostName&gt; set routemap rip_import id 1 match metric value 100\n> HostName&gt; set routemap rip_import id 1 allow\n> HostName&gt; set routemap rip_import id 2 on\n> HostName&gt; set routemap rip_import id 2 match interface eth0\n> HostName&gt; set routemap rip_import id 2 match interface eth2\n> HostName&gt; set routemap rip_import id 2 action metric add 10\n> HostName&gt; set routemap rip_import id 2 allow\n> HostName&gt; set rip import-routemap rip_import preference 1 on\n> HostName&gt; save config\n> ```\n\n### (3-C) Rejecting selected routes while importing\n\n1.  Create several routemap IDs on the same routemap:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ on`**\n    \n    Notes:\n    \n    -   Create a routemap for each set of match conditions you wish to specify.\n    -   Create a routemap ID higher than all others with no match conditions to allow any routes not explicitly restricted.\n2.  Set the match conditions for each ID:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ match`**\n    \n    Note: These match conditions should be tailored to the routes that you wish to reject.\n3.  For each ID with match conditions, set the ID type to \"`Restrict`\" to block the routes matched. Set the highest ID to \"`Allow`\":\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ restrict`**  \n    or  \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ allow`**\n    \n4.  Optionally, for the ID with the \"`Allow`\" type, you may specify one or more actions you wish to take on the imported routes:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ action _ACTION_IF_MATCH_SUCCEEDS_`**\n5.  Set the import routemap to this newly created routemap on the protocol(s), from which you wish to import the routes:\n    \n    **`HostName> set import-routemap _ROUTEMAP_NAME_ preference _ROUTEMAP_PREFERENCE_NUMBER_ on`**\n6.  Save Gaia configuration:\n    \n    **`HostName> save config`**\n\n_Example_:\n\nImport all OSPFv2 External routes except those to network 10.0.0.0/8 with nexthop interface eth2, and those to network 192.168.0.0/16 on any interface.  \nThe remaining routes have the OSPFv2 External route type set to Type 1:\n\n> ```\n> HostName&gt; set routemap ospf_import id 10 on\n> HostName&gt; set routemap ospf_import id 10 match network 10.0.0.0/8 all\n> HostName&gt; set routemap ospf_import id 10 match interface eth2\n> HostName&gt; set routemap ospf_import id 10 restrict\n> HostName&gt; set routemap ospf_import id 20 on\n> HostName&gt; set routemap ospf_import id 20 match network 192.168.0.0/16 all\n> HostName&gt; set routemap ospf_import id 20 restrict\n> HostName&gt; set routemap ospf_import id 30 on\n> HostName&gt; set routemap ospf_import id 30 action route-type type-1\n> HostName&gt; set routemap ospf_import id 30 allow\n> HostName&gt; set ospf import-routemap ospf_import preference 1 on\n> HostName&gt; save config\n> ```\n\n### (3-D) Applying parameters to selected imported routes\n\n1.  Create several routemap IDs on the same routemap:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ on`**\n    \n    Notes:\n    \n    -   Create a routemap for each set of match conditions you wish to specify.\n    -   Create a routemap ID higher than all others with no match conditions to allow any routes not explicitly defined.\n2.  Set the match conditions for each ID:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ match`**\n    \n    Note: These match conditions should be tailored to the routes that you wish to reject.\n3.  For each ID, set the ID type to \"`Allow`\" to allow the routes:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ allow`**\n4.  For each ID, specify any number of actions you wish to take on the imported routes:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ action`**\n5.  Set the import routemap to this newly created routemap on the protocol(s), from which you wish to import the routes:\n    \n    **`HostName> set import-routemap _ROUTEMAP_NAME_ preference _ROUTEMAP_PREFERENCE_NUMBER_ on`**\n6.  Save Gaia configuration:\n    \n    **`HostName> save config`**\n\n_Example_:\n\nImport routes from BGP AS 1. Routes with network 10.1.0.0/16 have the local preference set to 10. Routes from neighbor 192.168.100.100 have the protocol rank set to 50. All other routes are imported and have the weight set to 100:\n\n> ```\n> HostName&gt; set routemap bgp_import id 1 on\n> HostName&gt; set routemap bgp_import id 1 match network 10.1.0.0/16 all\n> HostName&gt; set routemap bgp_import id 1 action localpref 10\n> HostName&gt; set routemap bgp_import id 1 allow\n> HostName&gt; set routemap bgp_import id 2 on\n> HostName&gt; set routemap bgp_import id 2 match neighbor 192.168.100.100 on\n> HostName&gt; set routemap bgp_import id 2 action precedence 50\n> HostName&gt; set routemap bgp_import id 2 allow\n> HostName&gt; set routemap bgp_import id 3 on\n> HostName&gt; set routemap bgp_import id 3 action preference 100\n> HostName&gt; set routemap bgp_import id 3 allow\n> HostName&gt; set bgp external remote-as 1 import-routemap bgp_import preference 1 on\n> HostName&gt; save config\n> ```\n\n## (4) Configuring Export Routemaps\n\n### (4-A) Exporting all routes from one or more protocols\n\n1.  Create a routemap with one ID for every protocol you wish to export:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ on`**\n2.  For each ID, specify a match condition for a protocol you wish to export:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ match protocol _PROTOCOL_`**\n    \n    Notes:\n    \n    -   Each protocol should only be matched in one ID, and each ID should have a match condition.\n    -   When exporting routes from one OSPF instance to another, only External routes will be exported unless you add a match protocol condition. To export all OSPF routes you must match protocol ospf2/ospf3 on one ID and match protocol ospf2ase/ospf3ase on another ID.\n3.  For each ID, set the ID type to \"`Allow`\" to export the routes:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ allow`**\n4.  Optionally, for each ID, you may specify one or more actions you wish to take on the exported routes:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ action _ACTION_IF_MATCH_SUCCEEDS_`**\n5.  Set the export routemap to this newly created routemap on the protocol(s), from which you wish to export the routes:\n    \n    **`HostName> set _PROTOCOL_ export-routemap _ROUTEMAP_NAME_ preference _ROUTEMAP_PREFERENCE_NUMBER_ on`**\n6.  Save Gaia configuration:\n    \n    **`HostName> save config`**\n\n_Example_:\n\nExport all Interface and Static routes to both RIP and OSPFv2. Exported interface routes have their metric set to 5, while exported static routes have their metric set to 25:\n\n> ```\n> HostName&gt; set routemap if_static id 1 on\n> HostName&gt; set routemap if_static id 1 match protocol direct\n> HostName&gt; set routemap if_static id 1 action metric value 5\n> HostName&gt; set routemap if_static id 2 on\n> HostName&gt; set routemap if_static id 2 match protocol static\n> HostName&gt; set routemap if_static id 2 action metric value 25\n> HostName&gt; set rip export-routemap if_static preference 1 on\n> HostName&gt; set ospf export-routemap if_static preference 1 on\n> HostName&gt; save config\n> ```\n\n### (4-B) Exporting only selected routes\n\n1.  Create several routemap IDs on the same routemap:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ on`**\n    \n    Note: Create one for each set of match conditions you wish to specify.\n2.  Set the match conditions for each ID:\n    \n    ```\n    HostName&gt; set routemap <em>ROUTEMAP_NAME</em> id <em>ID_NUMBER</em> match protocol <em>PROTOCOL</em>\n    HostName&gt; set routemap <em>ROUTEMAP_NAME</em> id <em>ID_NUMBER</em> match <em>MATCH_CONDITION</em>\n    ```\n    \n    Notes:\n    \n    -   These match conditions should be tailored to the routes you wish to export.\n    -   One of these match conditions should match the protocol, from which you are exporting, unless that protocol is the same protocol, to which you are exporting.\n3.  For each ID, set the ID type to \"`Allow`\" to export the routes:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ allow`**\n4.  Optionally, for each ID, you may specify one or more actions to perform on the exported routes:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ action _ACTION_IF_MATCH_SUCCEEDS_`**\n5.  Set the export routemap to this newly created routemap on the protocol(s), to which you wish to export the routes:\n    \n    **`HostName> set _PROTOCOL_ export-routemap _ROUTEMAP_NAME_ preference _ROUTEMAP_PREFERENCE_NUMBER_ on`**\n6.  Save Gaia configuration:\n    \n    **`HostName> save config`**\n\n_Example_:\n\nExport two sets of routes to BGP AS 1: OSPFv2 routes in the prefix 10.0.0.0/8 with mask length between 24 and 32, and BGP AS 100 routes:\n\nNote: There is no match protocol condition for the BGP routes, because there is an implicit match condition for the same protocol, if no match protocol statement is present.\n\n> ```\n> HostName&gt; set routemap bgp_export id 1 on\n> HostName&gt; set routemap bgp_export id 1 match protocol ospf2\n> HostName&gt; set routemap bgp_export id 1 match network 10.0.0.0/8 between 24 and 32\n> HostName&gt; set routemap bgp_export id 1 allow\n> HostName&gt; set routemap bgp_export id 2 on\n> HostName&gt; set routemap bgp_export id 2 match as 100 on\n> HostName&gt; set routemap bgp_export id 2 allow\n> HostName&gt; set bgp external remote-as 1 export-routemap bgp_export preference 2 on\n> HostName&gt; save config\n> ```\n\n### (4-C) Restricting routes while exporting\n\n1.  Create a routemap to export a set of routes that you wish to restrict a subset of (see the\"Exporting all routes from one or more protocols\" section or \"Exporting only selected routes\" section above).\n    \n2.  Create a separate new routemap, and create one routemap ID belonging to it for each set of match conditions you wish to specify:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ on`**\n3.  For each ID, set the ID type to \"`Restrict`\" to block the routes matched:\n    \n    **`HostName> set routemap _ROUTEMAP_NAME_ id _ID_NUMBER_ restrict`**\n4.  Set the export routemap on the protocol, to which you wish to export the routes:\n    \n    **`HostName> set _PROTOCOL_ export-routemap _ROUTEMAP_NAME_ preference _ROUTEMAP_PREFERENCE_NUMBER_ on`**\n    \n    Notes:\n    \n    -   There will be two export routemaps - one routemap to restrict routes, and one routemap to allow them.\n    -   The restrict routemap should have a lower preference value, so that it takes priority over the allow routemap. Otherwise, the allow routemap may allow routes that you wish to restrict, since it is matched first.\n5.  Save Gaia configuration:\n    \n    **`HostName> save config`**\n\n_Example_:\n\nUsing the following routemaps:\n\n-   routemap '`bgp_export`' from the \"Exporting only selected routes\" section as the \"`Allow`\" routemap\n-   new routemap as the \"`Restrict`\" routemap\n\nNotes:\n\n-   The preference value for the \"`Allow\"` routemap is higher than the preference value for the \"`Restrict`\" routemap, so the restrict routes are matched first.\n-   The command to set the \"`Allow`\" routemap for BGP is re-stated here. This restrict routemap will restrict routes from BGP AS 100 that are in the prefix 192.168.0.0/16.\n\nCommands:\n\n> ```\n> HostName&gt; set routemap bgp_restrict id 1 on\n> HostName&gt; set routemap bgp_restrict id 1 match as 100\n> HostName&gt; set routemap bgp_restrict id 1 match network 192.168.0.0/16 all\n> HostName&gt; set routemap bgp_restrict id 1 restrict\n> HostName&gt; set bgp external remote-as 1 export-routemap bgp_restrict preference 1 on\n> HostName&gt; set bgp external remote-as 1 export-routemap bgp_export preference 2 on\n> HostName&gt; save config\n> ```\n\n## (5) Verifying the Routemap Configuration\n\nUsing the following command to verify that the configured routemaps are present in a protocol:\n\n**`HostName> show _PROTOCOL_ routemap`**\n\nIn order to confirm that the desired Import Routemap behavior is present:\n\n-   Verify that any routes that should be imported appear in the routing table (run in Clish \"**`show route`**\" command for IPv4 or \"**`show ipv6 route`**\" command for IPv6).\n-   Verify that any routes that should not be imported are not present.\n\nIf a route that should be present does not appear, then check whether it appears when running in Clish \"**`show route all`**\" command for IPv4, or \"**`show ipv6 route all`**\" command for IPv6:\n\n-   If it appears (and is marked as _Hidden_ or _Inactive_), then the Import Routemap for that protocol has a configuration problem.  \n    For example, an incorrect family has been configured for BGP import. For IPv6 routes a family of “inet6” or “inet-and-inet6” should be used.\n-   If it does not appear, then the route was never received by the routing protocol in question.\n\n-   Gaia Advanced Routing Administration Guide ([R75.40](http://supportcontent.checkpoint.com/documentation_download?id=13221), [R75.40VS](http://supportcontent.checkpoint.com/documentation_download?id=16245), [R76](http://supportcontent.checkpoint.com/documentation_download?id=22929), [R77.X](http://supportcontent.checkpoint.com/documentation_download?id=24803), [R80.10](http://downloads.checkpoint.com/dc/download.htm?ID=54803), [R80.20](https://sc1.checkpoint.com/documents/R80.20_GA/WebAdminGuides/EN/CP_R80.20_Gaia_Advanced_Routing_AdminGuide/html_frameset.htm), [R80.30](https://sc1.checkpoint.com/documents/R80.30/WebAdminGuides/EN/CP_R80.30_Gaia_Advanced_Routing_AdminGuide/html_frameset.htm), [R80.40](https://sc1.checkpoint.com/documents/R80.40/WebAdminGuides/EN/CP_R80.40_Gaia_Advanced_Routing_AdminGuide/Topics-GARG/Gaia-Advanced-Routing.htm), [R81](https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_Gaia_Advanced_Routing_AdminGuide/Topics-GARG/Gaia-Advanced-Routing.htm)).\n    \n-   Gaia Administration Guide ([R75.40](http://supportcontent.checkpoint.com/documentation_download?id=13241), [R75.40VS](http://supportcontent.checkpoint.com/documentation_download?id=16244), [R76](http://supportcontent.checkpoint.com/documentation_download?id=22928), [R77.X](http://supportcontent.checkpoint.com/documentation_download?id=24828), [R80.10,](http://downloads.checkpoint.com/dc/download.htm?ID=54824) [R80.20](https://sc1.checkpoint.com/documents/R80.20_GA/WebAdminGuides/EN/CP_R80.20_Gaia_AdminGuide/html_frameset.htm), [R80.30](https://sc1.checkpoint.com/documents/R80.30/WebAdminGuides/EN/CP_R80.30_Gaia_AdminGuide/html_frameset.htm), [R80.40](https://sc1.checkpoint.com/documents/R80.40/WebAdminGuides/EN/CP_R80.40_Gaia_AdminGuide/Topics-GAG/Gaia-Overview.htm),  [R81](https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_Gaia_AdminGuide/Topics-GAG/Gaia-Overview.htm)).\n    \n-   600 / 700 / 1100 / 1200R / 1400 appliances Advanced Routing Administration Guide ([R75.20](http://supportcontent.checkpoint.com/documentation_download?id=26395), [R77.20](http://downloads.checkpoint.com/dc/download.htm?ID=43085)).\n    \n\n-   [sk98936 - How to configure route redistribution and inbound route filters in Gaia Portal](http://supportcontent.checkpoint.com/solutions?id=sk98936)\n    \n-   [sk115361 - How to restrict redistribution of an interface route into OSPF using a routemap](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk115361)\n    \n-   [sk98214 - When try to add static routes to routemaps on routed configuration, brings cluster member down](http://supportcontent.checkpoint.com/solutions?id=sk98214)\n    \n-   [sk93777 - Clish 'show configuration' command on Gaia OS does not display the PBR and RouteMap commands](http://supportcontent.checkpoint.com/solutions?id=sk93777)\n    \n-   [sk98415 - When exporting Static/Direct/RIP routes into OSPF without routemap, tag value set to unexpected value](http://supportcontent.checkpoint.com/solutions?id=sk98415)\n    \n-   [sk110115 - Unable to restrict imported OSPF routes using routemaps](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk110115)\n    \n-   [sk98909 - How to advertise static routes in VS in Gaia](http://supportcontent.checkpoint.com/solutions?id=sk98909)\n    \n-   [sk98190 - How to configure Route-Based VPN with BGP on Locally managed 600 / 1100 appliance](http://supportcontent.checkpoint.com/solutions?id=sk98190)\n    \n-   [sk86985 - How to configure iBGP to propagate routes](http://supportcontent.checkpoint.com/solutions?id=sk86985)\n    \n-   [sk94765 - How to configure filtering learned routes to import the default route via BGP](http://supportcontent.checkpoint.com/solutions?id=sk94765)\n    \n-   [sk110477 - Not able to configure routemap for each BGP peer on Gaia OS](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk110477)\n    \n-   [sk70380 - Gaia FAQ - Frequently Asked Questions](http://supportcontent.checkpoint.com/solutions?id=sk70380)\n","language":"md","time":"14 days ago","created":"2025-05-06T22:56:05.273Z","annotations":[],"updated":"2025-05-06T22:58:18.450Z"},{"title":"ProductCluster - 3rd-party, ClusterXL, Multi-Domain Security Management","id":"67de915a-7949-4de4-afaa-da547f5470ea","type":"TEXT","raw":"ProductCluster - 3rd-party, ClusterXL, Multi-Domain Security Management, Quantum Security Gateways, Quantum Security Management\n\nVersionR80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-01-15\n\n## Solution\n\nGaia has introduced an all-new Portal that provides full access to system configuration.\n\n**Gaia Portal (WebUI) architecture**\n\nGaia Portal (WebUI) is powered by an Apache server running on the Security Gateway or Security Management server. The Apache server handles HTTPS requests of Gaia via a CGI interface, passing the requests to the TCL scripts. Besides this, the Apache manages the sessions using a proprietary Apache module that works in coordination with the Gaia DB and RBA roles. The Client side is based on Javascript and CSS files powered by ExtJs Javascript library. The Gaia Portal, as system portal, functions with and without multi-portal I/S. When there is no multi-portal, the HTTPS requests go directly to the Apache process listening for HTTPS connections.\n\nTroubleshooting needs to be conducted when you have problems accessing the Gaia Portal, for example:\n\n-   User cannot access the Gaia Portal.\n-   User cannot access specific pages of the Gaia Portal.\n-   Log in to Gaia Portal succeeded, but then the Gaia Portal is stuck.\n-   The browser displays errors on several pages.\n\n**Table of Contents**\n\n1.  Browser displays an error\n    \n2.  Error on specific page in Gaia Portal\n    \n3.  Gaia Portal fails to execute a command or function\n    \n4.  Gaia Portal crashes\n    \n5.  Gaia Portal failed to load\n    \n6.  Access to Gaia Portal failed\n    \n7.  Gaia Portal failed to load showing blank page\n    \n8.  Changing the Gaia Portal port in Clish results in warning\n    \n9.  Cannot access Gaia portal, browser shows \"Page cannot be displayed\"\n    \n10.  Cannot connect to Gaia portal after changing the name of Security Gateway\n    \n11.  Gaia Portal is not accessible/responsive after upgrade\n    \n\n### (1) Browser displays an error\n\n-   Check with other supported browsers - Internet Explorer, Firefox, Chrome and Safari - refer to relevant _Gaia Administration Guide_ and to [sk92668 - Browsers supported to work with Gaia Portal](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92668).\n-   Open the browser console, and see if there is any error message:  \n    -   in Google Chrome, press _**F12**_ and go to _**Console**_ tab\n    -   in FireFox, press CTRL+Shift+J keys\n-   Related solution: [sk118801 - \"ERR\\_CONNECTION\\_REFUSED\" error is displayed in web browser when connecting to Gaia Portal](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk118801)\n    \n\n### (2) Error on specific page in Gaia Portal\n\nClick Here to Collapse instructions for all browsers\n\n### (3) Gaia Portal fails to execute a command or function\n\nCheck the same command in Gaia Clish:\n\n-   If the command works correctly - Probably, this is a Gaia Portal problem.\n    -   Check browser logs. Refer to section \"Browser displays an error\".\n    -   Check TCL server side logs:  \n        -   Using the browser console or Apache logs _/usr/local/apache2/logs_, find the name of the TCL file being accessed by the browser.\n        -   Every TCL file has its debug file. Edit the TCL file that is located in the _the /web/cgi-bin2/_ directory.\n        -   Look for the debug file name (should be something like _/tmp/<feature>.debug_).\n        -   Examine this log file.\n    -   Check _/var/log/messages_ file to see errors of _ipstcl_ process (the TCL interpreter).\n-   If the command does not work - probably, this is Gaia Database problem. Check the _/var/log/messages_ file.\n\n### (4) Gaia Portal crashes\n\n-   Check browser logs with the browser console.\n-   Check the relevant log files:  \n    -   _/var/log/messages\\*_ files\n    -   Apache logs in the _/usr/local/apache2/logs/_ directory\n\n### (5) Gaia Portal failed to load\n\nThe reasons for this issue can vary and may occur at different layers.  \nBelow are steps and instructions on how to narrow the troubleshooting scope.\n\nShow / Hide Solution\n\n-   Check if you have connectivity to the machine from the client machine via ping.  \n    Capture the traffic with _**tcpdump**_ to see if pings can reach the machine.\n-   When browsing to the Gaia portal, check the HTTPS connections:\n    -   Capture the traffic with _**tcpdump**_ to see that the HTTPS connections are being seen on the machine.\n    -   If HTTPS connections are seen on the machine, and this machine is Security Gateway / Cluster member,  \n        then run a simple kernel debug to check these HTTPS connections are dropped: _**fw ctl zdebug + drop**_.  \n        If there is a doubt, and this machine _**is NOT connected to any network**_ (except your test computer),  \n        then try unloading the Firewall policy: _**fw unloadlocal**_ (to reload the policy, run: _**fw fetch localhost**_ command).\n    -   Check if the Multi-Portal is not routing the Gaia connections to the wrong portal.  \n        Run _**fw ctl zdebug + crypt**_ command.  \n        If there is a doubt, and this machine _**is NOT connected to any network**_ (except your test computer),  \n        then try unloading the Firewall policy to disable Multi-Portal: _**fw unloadlocal**_ (to reload the policy, run: _**fw fetch localhost**_ command).\n    -   If indeed Multi-Portal routes the Gaia connections to the wrong portal, then check that the Gaia Portal port is configured  \n        in SmartConsole in the corresponding object and see that the browser connects to the same port.\n    -   Check the Apache server logs to see if Gaia connections arrive at the Apache server:\n        -   Examine the files in the _**/usr/local/apache2/logs/**_  \n        -   Examine the files _**/var/log/httpd2\\_\\***_ and _**/var/log/httpd\\_\\***_\n-   Check the ownership and permissions of the TCL files in the _/web/cgi-bin2/_ directory with _**ls -al /web/cgi-bin2/**_ command.  \n    These TCL files should have:  \n    \n    -   The following ownership: _**admin root**_\n    -   The following permissions: _**\\-r-xr-xr-x**_\n    \n      \n    Note: the _httpd\\_dyno.tcl_ file located in this directory, has different permissions since it is obsolete and is not used by Gaia Portal anymore.\n    \n    To correct the ownership / permissions, run:\n    \n    -   For ownership: _**chown -v admin:root /web/cgi-bin2/\\***_\n    -   For permissions: _**chmod -v a=rx /web/cgi-bin2/\\***_\n-   Check the ownership and permissions of _/usr/bin/cgisu_ file with _ls -l /usr/bin/cgisu_ command.  \n    This file should have:  \n    \n    -   The following ownership: _**admin config**_\n    -   The following permissions: _**\\-r-sr-x---**_\n    \n      \n    To correct the ownership / permissions, run:  \n    -   For ownership: _**chown -v admin:config /usr/bin/cgisu\\***_\n    -   For permissions: _**chmod -v 4550 /usr/bin/cgisu**_\n-   Check that the files _**/web/conf/server.key**_ and _**/web/conf/server.crt**_ are _not_ empty with the following commands:  \n    \n    -   _**cat /web/conf/server.key**_\n    -   _**cat /web/conf/server.crt**_\n    \n      \n    Related solutions:  \n    -   [sk97648: How to create and set certificate for Gaia Portal](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk97648)\n    -   [sk108252: How to change Gaia Portal's certificate from SHA-1 to SHA-256](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk108252)\n    -   [sk109593: How to configure Gaia Portal to use a 3rd party CA-issued Wildcard certificate](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk109593)\n\n### (6) Access to Gaia Portal failed\n\nCheck the ownership and permissions for _/tmp_ directory.\n\nThis directory should have:\n\n-   The following ownership: _**admin root**_\n-   The following permissions: _**drwxrwxrwt**_\n\nTo correct the ownership / permissions, run:\n\n-   For ownership: _**chown -v admin:root /tmp**_\n-   For permissions: _**chmod -v a=rwxt /tmp**_\n\n### (7) Gaia Portal failed to load showing only blank page\n\nEnable JavaScript in your browser. For more information, refer to [http://www.enable-javascript.com](http://www.enable-javascript.com/).\n\n### (8) Changing the Gaia Portal port in Clish results in warning\n\n> \"_WARNING This command is for initial use. SSL port should be set through SmartDashboard. Changing the port may cause inconsistency with the settings on the SmartDashboard. Are you sure you want to continue?(Y/N)_  \n> _\\[N\\]_  \n> _\"It is recommended to change the port using the Platform Portal section of the object in SmartDashboard._  \n> _Add the port to the end of the Main URL and push policy._ _\"show web ssl-port\" should now display the port in the Main URL_\n\nShow / Hide Solution\n\n**For Security Gateway**:\n\nIn SmartConsole, perform:\n\n1.  Open the Security Gateway / Cluster object and go to the \"Platform Portal\" pane.\n2.  In the \"Main URL\" field, set the desired port (e.g., port 4434):  \n    _https://IP\\_ADDRESS:PORT_\n3.  Click on OK to apply the changes.\n4.  Install the security policy on this Security Gateway / Cluster object.\n\n**Note**: Using Clish to change portal port on Security Gateway will be overwritten on a policy installation. After the change the httpd process can be seen listening to the new port with \"_netstat -lpn|grep port_\". Port 443 is handled by he mpdaemon and will not be listed in netstat.\n\n**For Security Management Server**:\n\n1.  Connect to command line on Security Management Server and log in to Clish.\n2.  Set the desired port (e.g., port 4434):  \n    _HostName> set web ssl-port <Port\\_Number>_\n3.  Save the changes: _HostName> save config_\n4.  Verify that the configuration was saved:  \n    _\\[Expert@HostName\\]# grep 'httpd:ssl\\_port' /config/db/initial_\n\n### (9) Cannot access Gaia portal, browser shows \"Page cannot be displayed\"\n\n-   When accessing Gaia portal, it loads for 1-2 seconds and then the browser displays the \"_This page cannot be displayed_\" message.\n-   WebUI debug output according to [sk84561](http://supportcontent.checkpoint.com/solutions?id=sk84561) contains:  \n    \\[error\\] (17)File exists: Cannot create SSLMutex with file \\`/usr/local/apache2/logs/ssl\\_mutex'  \n    Configuration Failed\n\nShow / Hide Solution \n\nTo resolve the problem, remove the _ssl\\_mutex_ file:\n\n1.  Run _\\# rm -r /usr/local/apache2/logs/ssl\\_mutex_\n    \n2.  Restart the web server daemon:\n    \n    _\\# tellpm process:httpd2  \n    __\\# tellpm process:httpd2 t_\n    \n\n### (10) Cannot connect to Gaia portal after changing the name of Security Gateway\n\nAfter the name of the Security Gateway is changed and SIC is reset with the Management server, there is a certificate error and Gaia portal page does not load.\n\nCause: Old certificate was not removed from the Security Gateway before changing its name.\n\nShow / Hide Solution \n\n1.  In SmartConsole, go to the 'Security Gateway object -> IPSec VPN -> Repository Of Certificates Available to the Gateway', and delete the certificate that contains the old name of the gateway.\n2.  If the firewall does not have the IPSEC VPN blade enabled, temporarily enable this blade under General Properties and view the Certificate(s) available to the gateway.  \n    **Exercise caution to ensure that the certificate is issued by the Security Management server**, as in the example below:\n    \n    _Subject: CN=GwyC-77.10 VPN Certificate,O=Mgmt..imce48  \n    __Issuer: O=Mgmt..imce48_\n    \n3.  Ensure that the issuer name shows the Security Management server name.\n4.  After successfully confirming step 3 above, click \"OK\" and highlight the certificate again and click \"Remove\".\n5.  A warning will come up that the certificate will be removed and a new one will be generated--click \"OK\" or \"yes\".\n6.  Go back and confirm that the new certificate now shows the new hostname.\n7.  Install policy to the Security Gateway in question, and now there should be access to the WebUI.\n\n### (11) Gaia Portal is not accessible/responsive after upgrade\n\nSymptoms:\n\n-   Gaia Portal is stuck in the loading icon after entering username and password.\n-   \"`The URL you requested could not be found on the server`\" message is displayed in the Web browser.\n-   \"`sec_error_reused_issuer_and_serial`\" message is displayed in the Web browser.\n-   Debug of Gaia Portal per [sk84561](http://supportcontent.checkpoint.com/solutions?id=sk84561) - `/var/log/httpd2_error_log` file - repeatedly shows:  \n    `Error: unable to stat file /tmp/<Name_of_Some_File>.xsl: No such file or directory, referer: https://<IP_Address>/.../cgi-bin/home.tcl`\n-   `\"No WebUI and RBA error - permission denied\"` is repeated in `/var/log/messages`\n\nPossible reasons: \n\n-   CPWMD process fails to start.\n-   Wrong permissions were set to the WebUI web server files/directories.\n-   Wrong permissions were set to the /tmp directory.\n\nShow / Hide this Section\n\n**Note:** Close the web browser before making any modifications. Web browsers can cache a negative connection attempt.\n\nPermissions of the `/tmp` directory should be as follows:\n\n> ```\n> d<strong>rwxrwxrwt</strong> 5 admin root 4096 Jan  2 11:21 /tmp\n> ```\n\n**Notes**:\n\n-   To view the current permissions of a _directory_, use the '[`ls -ld`](http://linux.die.net/man/1/ls)' command on the directory:\n    \n    `[Expert@HostName]# ls -ld /tmp`\n    \n-   To change the _access_ permissions, use the '[`chmod`](http://linux.die.net/man/1/chmod)' command:\n    \n    `[Expert@HostName]# chmod [-R] u=[rwx],g=[rwx],o=[rwx] TARGET_DIRECTORY`\n    \n    where\n    \n    -   '`-R`' flag should be used for recursive change (for all files inside a directory).\n    -   '`u=[rwx],g=[rwx],o=[rwx]`' should be used for setting the specific permission for User, Group, Others.\n    \n    To set the default permissions for the `/tmp` directory, run:\n    \n    **`[Expert@HostName]# chmod a=rwxt /tmp`**\n    \n    Run '`chmod --help`' for more information.\n    \n-   To change the _ownership_ permissions, use the '[`chown`](http://linux.die.net/man/1/chown)' command:\n    \n    `[Expert@HostName]# chown [-R] USER:GROUP TARGET_DIRECTORY`\n    \n    where\n    \n    -   '`-R`' flag should be used for recursive change (for all files inside a directory).\n    \n    Run '`chown --help`' for more information.\n    \n\n## Article Properties\n\nOriginatorGhanim Fodi\n\nTechnical ResourceTal Martsiano\n\nAccess LevelGeneral\n\nStatusApproved\n\nDate Created2013-01-16\n\nLast Modified2025-01-15\n\nEditorGil Frantsus\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only\n\nSK is relevant also to R82.10\n\nThis article is merged with sk83482, sk96117, sk89100 and sk65319\n\n**Important note: Prior to using the tools mentioned in this article, make sure you thoroughly go over [sk156153 - Best Practice Guide for Debugging Check Point Products](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk156153).**\n\n**This SK is managed by the SecureKnowledge Team. Do not edit it yourself. If you need to make changes/updates to it, submit the feedback (using the field at the bottom of this SK), or contact the SK owner (shown in the top header).**\n\n___\n\n**Troubleshooting**\n\nIit has been found that disabling UserCheck resolved issue accessing the WebUI (SR 1-8696853551, 5-1270222041)  \nThe following procedure:\n\n1.  Open SmartDashboard\n2.  Edit the Cluster object, go to User Check\n3.  Clear the \"Enable UserCheck for active blades\" checkbox\n4.  Install policy","language":"md","time":"14 days ago","created":"2025-05-06T22:55:59.479Z","annotations":[],"updated":"2025-05-06T22:57:25.905Z"},{"title":"ProductClusterXL - Global Kernel Parameters for Cluster Members","id":"018285b1-fc93-40d2-a50c-be02d01e8cd3","type":"TEXT","raw":"ProductClusterXL\n\nVersionR80.30SP (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2024-12-08\n\n## Symptoms\n\n-   Cluster members repeatedly fail-over during high CPU utilization.\n    \n-   Cluster members fail-over during policy installation.\n    \n\n## Solution\n\n**Table of Contents:**\n\n-   Introduction\n    \n-   Troubleshooting guidelines\n    \n    -   Definitions\n        \n    -   Background\n        \n    -   Checklist\n        \n-   Legend\n    \n-   List of Kernel Parameters\n    \n    -   Cluster flapping during policy installation\n        \n    -   Cluster flapping during run time\n        \n-   Notes\n    \n\n## Introduction\n\nThe article contains a list of various relevant global kernel parameters that can be configured on cluster members in ClusterXL configured in High Availability mode to prevent cluster flapping:\n\n-   `fwha_cul_cluster_log_delay_millisec`\n-   `fwha_cul_cluster_short_timeout`\n-   `fwha_cul_mechanism_enable`\n-   `fwha_cul_member_cpu_load_limit`\n-   `fwha_cul_member_long_timeout`\n-   `fwha_cul_policy_freeze_event_timeout_millisec`\n-   `fwha_cul_policy_freeze_timeout_millisec`\n-   `fwha_dead_timeout_multiplier`\n-   `fwha_freeze_state_machine_timeout`\n-   `fwha_if_connectivity_tolerance`\n-   `fwha_pnote_timeout_mechanism_cpu_load_limit`\n-   `fwha_pnote_timeout_mechanism_disable_feature_timeout`\n-   `fwha_pnote_timeout_mechanism_monitor_cpu`\n-   `fwha_policy_update_timeout_factor`\n\n**Important Notes:**\n\n-   This article applies only to ClusterXL configured in High Availability mode.\n-   Cluster Under Load (CUL) mechanism is _**not**_ needed in OPSEC / 3rd party clusters because in such clusters, Check Point cluster does not make any decision regarding the states of cluster members.\n\n## Troubleshooting guidelines\n\nNote: For additional information, refer to Related solutions section.\n\n### Definitions\n\nFlapping - Consequent changes in the state of either cluster interfaces (cluster interface flapping), or cluster members (cluster member flapping). Such consequent changes in the state are seen in SmartConsole > Logs (if in in a cluster object, the cluster administrator set '`Track changes in the status of cluster members`' to '`Log`').\n\nClusterXL relies completely on the Cluster Control Protocol (CCP) - proprietary Check Point protocol that runs between cluster members on UDP port 8116, and has the following roles:\n\n-   State Synchronization (Delta Sync)\n-   Health checks (state of cluster members and of cluster interfaces):  \n    -   Health-status Reports\n    -   Cluster-member Probing\n    -   State-change Commands\n    -   Querying for Cluster Membership\n\n### Background\n\nIf the Cluster Control Protocol (CCP) packets are not sent/received within the predefined timeouts, the state of an interface and/or of a cluster member might change to 'Down' (i.e., failed). This, in turn, might cause fail-over between cluster members. Depending on the root causes of these issues with sending and receiving of CCP packets, the state of an interface and/or of a member might change occasionally, or repeatedly (flap).\n\nThe following are most common reasons for issues with sending and receiving of CCP packets:\n\n-   high CPU load on cluster member(s)\n-   overloaded interface(s) on cluster member(s)\n-   latency on the network\n-   congestion on the network\n\n### Checklist\n\n1.  Determine the nature of the issue - does the state of an interface change, or the state of a member change (or both).\n    \n    Note: Check the cluster-related messages in SmartView Tracker.\n    \n2.  Determine the frequency on the issue - does the state of an interface and/or of a member change occasionally, or repeatedly (flap).\n    \n    Note: Analyze the cluster-related messages in SmartView Tracker.\n    \n3.  Check whether there is an apparent trigger for this issue (e.g., only policy installation, only during specific hours, etc.).\n    \n    Note: Correlate the cluster-related messages in SmartView Tracker to traffic logs and to messages in 'Management' log (Audit log).\n    \n4.  Check the CPU load on all cluster members during the issue.\n    \n    Note: Correlate outputs of these commands: '`top`', '`ps auxwf`', and '`vmstat 1`' (commands should be run simultaneously each second - best practice is to create a shell script that runs these commands in a loop). Refer to [sk98348: Best Practices - Security Gateway Performance](https://support.checkpoint.com/results/sk/sk98348) / [sk33781: Performance analysis for Security Gateway NGX R65 / R7x](https://support.checkpoint.com/results/sk/sk33781).\n    \n5.  Check the load on the problematic interfaces on all cluster members during the issue.\n    \n    Note: Correlate the cluster-related messages in SmartView Tracker to output of '`netstat -ni`' command.\n    \n6.  Run and analyze the cluster debug on all cluster members during the issue.\n    \n    Note: [Contact Check Point Support](http://www.checkpoint.com/services/contact/index.html) to get the debug instructions relevant to your specific case. It is recommended to collect the CPU load during this debug (collect outputs of '`top`', '`ps`', '`vmstat`' commands).\n    \n7.  When the trigger for cluster flapping is identified, use the relevant kernel parameters listed below to fine tune the cluster (refer to Notes section for instructions on how to set the desired values for kernel parameters).\n    \n\n## Legend\n\nEach global kernel parameter is described in _the form of a table_:\n\n<table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td>This cell contains the exact name of global kernel parameter.</td></tr><tr><td>Description</td><td>This cell contains a short description of this global kernel parameter.</td></tr><tr><td>Default value</td><td>This cell contains the default value of this global kernel parameter.</td></tr><tr><td>Recommended value</td><td>This cell contains the recommended value that should be set for this global kernel parameter if your cluster flaps in the described scenario.</td></tr><tr><td>Impact</td><td>This cell contains possible impact of changing the value of this global kernel parameter from default value to other value.</td></tr><tr><td>Supported versions</td><td>This cell contains the list of versions that support this global kernel parameter.<br>Note: If specific parameter is not integrated in your version, then <a href=\"http://www.checkpoint.com/services/contact/index.html\" target=\"_blank\" rel=\"noopener\">contact Check Point Support</a> to get a Hotfix that will add that parameter to you Security Gateway.</td></tr><tr><td>Comment</td><td>This cell contains additional related information.</td></tr></tbody></table>\n\n## List of Kernel Parameters\n\n**Important Note:** Some internal cluster timers use special time units - `HTU (\"HA Time Unit\")`, where `1 HTU = 100 milliseconds = 0.1 second`.\n\nAll the relevant kernel parameters were divided into two major groups:\n\n-   Cluster flapping during policy installation\n    \n-   Cluster flapping during run time\n    \n\nLet us review the relevant kernel parameters:\n\n-   #### Cluster flapping during policy installation\n    \n    Causes:\n    \n    -   FWD pnote and/or CPHAD pnote reports its state as '`problem`' due to failure of the `fwd` daemon and/or the `cphamcset` daemon to send periodic report to Check Point kernel.\n    -   Standby member becomes Active, while the original Active member is functioning and considered up, as it does not receive CCP packets from the original Active member.\n    -   Standby member becomes Active, while the original Active member is functioning and considered up, as it completes the policy installation before the original Active member.\n    \n    Relevant kernel parameters:\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_freeze_state_machine_timeout</code></td></tr><tr><td>Description</td><td><ul><li>Freeze member's state for N seconds, starting from cluster policy installation time.</li><li>If a Standby member does not receive CCP packets from the Active member (e.g., the Active member is overloaded or crashes), it will change its state to Active.</li></ul></td></tr><tr><td>Default value</td><td>40 sec - from R80.10 and higher</td></tr><tr><td>Recommended value</td><td>200 seconds</td></tr><tr><td>Impact</td><td>None</td></tr><tr><td>Supported versions</td><td>All</td></tr><tr><td>Comment</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk32488\" target=\"_blank\" rel=\"noopener\">sk32488</a>.</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_policy_update_timeout_factor</code></td></tr><tr><td>Description</td><td>Multiplier for a policy state synchronization timeout between cluster members - after this timeout, a cluster member gives up and does not wait anymore for policy/configuration update:<br><code>[20 seconds x (number of members in cluster) x fwha_policy_update_timeout_factor]</code></td></tr><tr><td>Default value</td><td><div><table><tbody><tr><td>Default<br>Value</td><td>Cluster<br>Versions</td></tr><tr><td>1</td><td><ul><li>from R81 to R81.20 for Scalable Platforms</li><li>R80.20SP and R80.30SP for Scalable Platforms</li><li>from R60 to R80.20</li></ul></td></tr><tr><td>12</td><td><ul><li>from R82 and higher for Scalable Platforms</li></ul></td></tr><tr><td>24</td><td><ul><li>from R80.30 and higher (for non-Scalable Platforms)</li></ul></td></tr></tbody></table></div></td></tr><tr><td>Recommended value</td><td><div><table><tbody><tr><td>Recommended<br>Value</td><td>Cluster<br>Versions</td></tr><tr><td>3</td><td><ul><li>from R81 to R81.20 for Scalable Platforms</li><li>R80.20SP and R80.30SP for Scalable Platforms</li><li>from R60 to R80.20</li></ul></td></tr><tr><td>12</td><td><ul><li>from R82 and higher for Scalable Platforms</li></ul></td></tr><tr><td>24</td><td><ul><li>from R80.30 and higher (for non-Scalable Platforms)</li></ul></td></tr></tbody></table></div></td></tr><tr><td>Impact</td><td>None</td></tr><tr><td>Supported versions</td><td>Starting in NGX R60</td></tr><tr><td>Comment</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk63163\" target=\"_blank\" rel=\"noopener\">sk63163</a>.</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_pnote_timeout_mechanism_monitor_cpu</code></td></tr><tr><td>Description</td><td>Avoid pnote failure during CPU load for default of 180 sec.<br>Notes:<br><ul><li>configurable</li><li>each member monitors its local load</li><li>system load is not advertised between members</li></ul></td></tr><tr><td>Default value</td><td>0 (feature is disabled)</td></tr><tr><td>Recommended value</td><td>1 (feature is enabled)</td></tr><tr><td>Impact</td><td><ul><li>During high CPU load, failover might not occur due to FWD and/or CPHAD pnotes.</li><li>No logs / alert during the timeout period, until FWD daemon recovers.</li></ul></td></tr><tr><td>Supported versions</td><td>R71 - R77.20</td></tr><tr><td>Comment</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk43172\" target=\"_blank\" rel=\"noopener\">sk43172</a>.<br><strong>Note:</strong> This parameter is not relevant in the versions R77.30 and higher.</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_pnote_timeout_mechanism_cpu_load_limit</code></td></tr><tr><td>Description</td><td>Average CPU utilization threshold in per cent for the member to consider itself under load.</td></tr><tr><td>Default value</td><td>80 %</td></tr><tr><td>Recommended value</td><td>80 %</td></tr><tr><td>Impact</td><td>None</td></tr><tr><td>Supported versions</td><td>R71 - R77.20</td></tr><tr><td>Comment</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk43172\" target=\"_blank\" rel=\"noopener\">sk43172</a>.<br><strong>Note:</strong> This parameter is not relevant in the versions R77.30 and higher.</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_pnote_timeout_mechanism_disable_feature_timeout</code></td></tr><tr><td>Description</td><td>Avoid failover when a pnote reports its status as '<code>problem</code>' for the duration of <em>VALUE</em> HTUs (1 \"HA Time Unit\" = 100 milliseconds).</td></tr><tr><td>Default value</td><td>1800 HTUs (= 180 sec)</td></tr><tr><td>Recommended value</td><td>1800 HTUs (= 180 sec)</td></tr><tr><td>Impact</td><td>None</td></tr><tr><td>Supported versions</td><td>R71 - R77.20</td></tr><tr><td>Comment</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk43172\" target=\"_blank\" rel=\"noopener\">sk43172</a>.<br><strong>Note:</strong> This parameter is not relevant in the versions R77.30 and higher.</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_cul_mechanism_enable</code></td></tr><tr><td>Description</td><td>Enables Cluster Under Load (CUL) mechanism - avoid failure due to pnote reporting its status as '<code>problem</code>' and freeze the state of cluster member during CPU load time.<br>Note: each member monitors its local load and advertises it among other members.</td></tr><tr><td>Default value</td><td>1 - from R77 and higher</td></tr><tr><td>Recommended value</td><td>1 (feature is enabled)</td></tr><tr><td>Impact</td><td><ul><li>In case Active member fails, network outage for <em>VALUE</em> of '<code>fwha_cul_cluster_short_timeout</code>'.</li><li>Starting in R76, pnotes related to User Space processes are not monitored (<a href=\"https://support.checkpoint.com/results/sk/sk92878\" target=\"_blank\" rel=\"noopener\">sk92878</a>).</li><li>Enabling this feature does not affect pnotes.</li></ul></td></tr><tr><td>Supported versions</td><td>Starting in R75.40VS (not including R75.45, R75.46)</td></tr><tr><td>Comment</td><td>None</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_cul_cluster_short_timeout</code></td></tr><tr><td>Description</td><td>Cluster Under Load (CUL) mechanism -&nbsp;MIN lasting freeze period due to CPU load for the duration of <em>VALUE</em> HTUs (1 \"HA Time Unit\" = 100 milliseconds).</td></tr><tr><td>Default value</td><td>100 HTUs (= 10 sec)</td></tr><tr><td>Recommended value</td><td>100 HTUs (= 10 sec)</td></tr><tr><td>Impact</td><td>None</td></tr><tr><td>Supported versions</td><td>Starting in R75.40VS (not including R75.45, R75.46)</td></tr><tr><td>Comment</td><td>None</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_cul_member_long_timeout</code></td></tr><tr><td>Description</td><td>Cluster Under Load (CUL) mechanism -&nbsp;MAX lasting freeze period due to CPU load for the duration of <em>VALUE</em> HTUs (1 \"HA Time Unit\" = 100 milliseconds).</td></tr><tr><td>Default value</td><td>1800 HTUs (= 180 sec)</td></tr><tr><td>Recommended value</td><td>1800 HTUs (= 180 sec)</td></tr><tr><td>Impact</td><td>None</td></tr><tr><td>Supported versions</td><td>Starting in R75.40VS (not including R75.45, R75.46)</td></tr><tr><td>Comment</td><td><strong>Note:</strong> This parameter is not relevant in the versions R80.20 with Jumbo HFA Take_21, R80.30 and higher.</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_cul_policy_freeze_timeout_millisec</code></td></tr><tr><td>Description</td><td>Cluster Under Load (CUL) mechanism -&nbsp;monitor for problems during policy installation period (e.g., pnote problem, CCP of Active member are not received), but no more than the first timeout - the '<code>fwha_cul_policy_freeze_timeout_millisec</code>' defined in milliseconds.<br>During the monitoring time, if event occurs and requires failover, the second timeout will start counting - the '<code>fwha_cul_policy_freeze_event_timeout_millisec</code>' defined in milliseconds, which defines the duration, for which CUL policy actually freezes the member state during the monitoring period. After the event timeout exceeded, policy freeze will turn off and will stop monitoring fail events during the on going policy installation.</td></tr><tr><td>Default value</td><td>30000 milliseconds&nbsp;</td></tr><tr><td>Recommended value</td><td>30000 milliseconds</td></tr><tr><td>Impact</td><td>None</td></tr><tr><td>Supported versions</td><td>Starting in R75.40VS (not including R75.45, R75.46)</td></tr><tr><td>Comment</td><td>None</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_cul_policy_freeze_event_timeout_millisec</code></td></tr><tr><td>Description</td><td>Cluster Under Load (CUL) mechanism - monitor for problems during policy installation period (e.g., pnote problem, CCP of Active member are not received), but no more than the first timeout - the '<code>fwha_cul_policy_freeze_timeout_millisec</code>' defined in milliseconds.<br>During the monitoring time, if event occurs and requires failover, the second timeout will start counting - the '<code>fwha_cul_policy_freeze_event_timeout_millisec</code>' defined in milliseconds, which defines the duration, for which CUL policy actually freezes the member state during the monitoring period. After the event timeout exceeded, policy freeze will turn off and will stop monitoring fail events during the ongoing policy installation.</td></tr><tr><td>Default value</td><td>15000 milliseconds</td></tr><tr><td>Recommended value</td><td>15000 milliseconds</td></tr><tr><td>Impact</td><td>If the Active member fails during policy installation, a network outage of maximal duration depending on the assigned value.</td></tr><tr><td>Supported versions</td><td>Starting in R75.40VS (not including R75.45, R75.46)</td></tr><tr><td>Comment</td><td>None</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_cul_member_cpu_load_limit</code></td></tr><tr><td>Description</td><td>Cluster Under Load (CUL) mechanism - if the average of CPU kernel load exceeds this load watermark limit in percent, then the registered pnotes will be able to change to report their status as '<code>problem</code>' (change their blocking state to ACTIVE).</td></tr><tr><td>Default value</td><td>80 %</td></tr><tr><td>Recommended value</td><td>80 %</td></tr><tr><td>Impact</td><td>The greater this limit value is configured, the higher CPU load has to be when the CUL mechanism is enabled.</td></tr><tr><td>Supported versions</td><td>Starting in R75.40VS (not including R75.45, R75.46)</td></tr><tr><td>Comment</td><td>None</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_cul_cluster_log_delay_millisec</code></td></tr><tr><td>Description</td><td>Cluster Under Load (CUL) mechanism - print CUL logs only if CUL is still reported after the first event for at least <em>VALUE</em> of HTUs (1 \"HA Time Unit\" = 100 milliseconds).</td></tr><tr><td>Default value</td><td>2000 HTUs (= 200 sec)</td></tr><tr><td>Recommended value</td><td>2000 HTUs (= 200 sec)</td></tr><tr><td>Impact</td><td>None</td></tr><tr><td>Supported versions</td><td>Starting in R75.40VS (not including R75.45, R75.46)</td></tr><tr><td>Comment</td><td>None</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_dead_timeout_multiplier</code></td></tr><tr><td>Description</td><td><p>Multiplier for dead interval between members in seconds.<br>Set the value of this parameter to N to increase the cluster dead timeout to Nx10 HTUs = N seconds (1 \"HA Time Unit\" = 100 milliseconds).</p><p>Note: Changing the value of this parameter requires changing the value of <code>fwha_if_connectivity_tolerance</code> respectively (does <em>not</em> apply to the versions R77.10 and higher).</p></td></tr><tr><td>Default value</td><td>3</td></tr><tr><td>Recommended value</td><td>3</td></tr><tr><td>Impact</td><td>Failover might take some time - up to the number of <em>VALUE</em> seconds.</td></tr><tr><td>Supported versions</td><td>Starting in R75.47 and higher, R77 and higher (not including R76)</td></tr><tr><td>Comment</td><td>None</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_if_connectivity_tolerance</code></td></tr><tr><td>Description</td><td><p>Multiplier for tolerance of Interface Active Check pnote.<br>Set the value of this parameter to N to increase the timeout of Interface Active Check pnote to Nx10 HTUs = N seconds (1 \"HA Time Unit\" = 100 milliseconds).</p><p>Note: Value of this parameter should correlate to the value of <code>fwha_dead_timeout_multiplier</code> parameter.</p></td></tr><tr><td>Default value</td><td>3</td></tr><tr><td>Recommended value</td><td>3</td></tr><tr><td>Impact</td><td>Detection of interface problem might take some time - up to the number of <em>VALUE</em> seconds.</td></tr><tr><td>Supported versions</td><td>Starting in NGX R65 HFA_50 (not available in VSX R6x)</td></tr><tr><td>Comment</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk62863\" target=\"_blank\" rel=\"noopener\">sk62863</a>.</p><p><strong>This parameter is not relevant and should not be used in the versions R77.10 and higher</strong></p></td></tr></tbody></table>\n    \n-   ### Cluster flapping during run time\n    \n    Causes:\n    \n    -   FWD pnote and/or CPHAD pnote reports its state as '`problem`' due to failure of the `fwd` daemon and/or the `cphamcset` daemon to send periodic report to Check Point kernel.\n    -   Standby member becomes Active, while the original Active member is functioning and considered up, as it does not receive CCP packets from the original Active member.\n    -   One of the interfaces on the Active member is considered 'Down', as no CCP packets are received on that interface from other members due to system load on this member.\n    \n    Relevant kernel parameters:\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_pnote_timeout_mechanism_monitor_cpu</code></td></tr><tr><td>Description</td><td>Avoid pnote failure during CPU load for default of 180 sec.<br>Notes:<br><ul><li>configurable</li><li>each member monitors its local load</li><li>system load is not advertised between members</li></ul></td></tr><tr><td>Default value</td><td>0 (feature is disabled)</td></tr><tr><td>Recommended value</td><td>1 (feature is enabled)</td></tr><tr><td>Impact</td><td><ul><li>During high CPU load, failover might not occur due to FWD and/or CPHAD pnotes.</li><li>No logs / alert during the timeout period, until FWD daemon recovers.</li></ul></td></tr><tr><td>Supported versions</td><td>R71 - R75.46</td></tr><tr><td>Comment</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk43172\" target=\"_blank\" rel=\"noopener\">sk43172</a>.</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_pnote_timeout_mechanism_cpu_load_limit</code></td></tr><tr><td>Description</td><td>Average CPU usage threshold in per cent for the member to consider itself under load.</td></tr><tr><td>Default value</td><td>80 %</td></tr><tr><td>Recommended value</td><td>80 %</td></tr><tr><td>Impact</td><td>None</td></tr><tr><td>Supported versions</td><td>R71 - R75.46</td></tr><tr><td>Comment</td><td>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk43172\" target=\"_blank\" rel=\"noopener\">sk43172</a>.</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_cul_mechanism_enable</code></td></tr><tr><td>Description</td><td>Enables Cluster Under Load (CUL) mechanism - avoid failure due to pnote reporting its status as '<code>problem</code>' and freeze the state of cluster member during CPU load time.<br>Note: each member monitors its local load and advertises it among other members.</td></tr><tr><td>Default value</td><td>1 (enabled)</td></tr><tr><td>Recommended value</td><td>1 (feature is enabled)</td></tr><tr><td>Impact</td><td><ul><li>In case Active member fails, network outage for <em>VALUE</em> of '<code>fwha_cul_cluster_short_timeout</code>'.</li><li>Starting in R76, pnotes related to User Space processes are not monitored (<a href=\"https://support.checkpoint.com/results/sk/sk92878\" target=\"_blank\" rel=\"noopener\">sk92878</a>).</li><li>Enabling this feature does not affect pnotes.</li></ul></td></tr><tr><td>Supported versions</td><td>Starting in R75.40VS (not including R75.45, R75.46)</td></tr><tr><td>Comment</td><td>None</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_cul_cluster_short_timeout</code></td></tr><tr><td>Description</td><td>Cluster Under Load (CUL) mechanism -&nbsp;MIN lasting freeze period due to CPU load for the duration of <em>VALUE</em> HTUs (1 \"HA Time Unit\" = 100 milliseconds).</td></tr><tr><td>Default value</td><td>100 HTUs (= 10 sec)</td></tr><tr><td>Recommended value</td><td>100 HTUs (= 10 sec)</td></tr><tr><td>Impact</td><td>None</td></tr><tr><td>Supported versions</td><td>Starting in R75.40VS (not including R75.45, R75.46)</td></tr><tr><td>Comment</td><td>None</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_cul_member_long_timeout</code></td></tr><tr><td>Description</td><td>Cluster Under Load (CUL) mechanism - MAX lasting freeze period due to CPU load for the duration of <em>VALUE</em> HTUs (1 \"HA Time Unit\" = 100 milliseconds).</td></tr><tr><td>Default value</td><td>1800 HTUs (= 180 sec)</td></tr><tr><td>Recommended value</td><td>1800 HTUs (= 180 sec)</td></tr><tr><td>Impact</td><td>None</td></tr><tr><td>Supported versions</td><td>Starting in R75.40VS (not including R75.45, R75.46)</td></tr><tr><td>Comment</td><td>None</td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_dead_timeout_multiplier</code></td></tr><tr><td>Description</td><td><p>Multiplier for dead interval between members in seconds.<br>Set the value of this parameter to N to increase the cluster dead timeout to Nx10 HTUs = N seconds (1 \"HA Time Unit\" = 100 milliseconds).</p><p>Note: Changing the value of this parameter requires changing the value of <code>fwha_if_connectivity_tolerance</code> respectively (does <em>not</em> apply to R77.10 and higher).</p></td></tr><tr><td>Default value</td><td>3</td></tr><tr><td>Recommended value</td><td>3</td></tr><tr><td>Impact</td><td>Failover might take some time - up to the number of <em>VALUE</em> seconds.</td></tr><tr><td>Supported versions</td><td>Starting in R75.47 and higher, R77 and higher (not including R76)</td></tr><tr><td>Comment</td><td></td></tr></tbody></table>\n    \n    <table><colgroup><col width=\"300\" span=\"1\"> <col width=\"N|N%|relative_length\" span=\"1\"></colgroup><tbody><tr><td>Relevant global kernel parameter</td><td><code>fwha_if_connectivity_tolerance</code></td></tr><tr><td>Description</td><td><p>Multiplier for tolerance of Interface Active Check pnote.<br>Set the value of this parameter to N to increase the tolerance timeout to Nx10 HTUs = N seconds (1 \"HA Time Unit\" = 100 milliseconds).</p><p>Note: Value of this parameter should correlate to the value of <code>fwha_dead_timeout_multiplier</code> parameter.</p></td></tr><tr><td>Default value</td><td>3</td></tr><tr><td>Recommended value</td><td>3</td></tr><tr><td>Impact</td><td>Detection of interface problem might take some time - up to the number of <em>VALUE</em> seconds.</td></tr><tr><td>Supported versions</td><td>Starting in NGX R65 HFA_50 (not available in VSX R6x)</td></tr><tr><td>Comment</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk62863\" target=\"_blank\" rel=\"noopener\">sk62863</a>.</p><p><strong>This parameter is not relevant and should not be used in the versions R77.10 and higher</strong></p></td></tr></tbody></table>\n    \n\n## Notes\n\n-   Some kernel parameters can be set _on-the-fly_ with '`fw ctl set int _PARAMETER_ _VALUE_`' command (e.g., `fwha_mac_magic`).\n    \n-   Some kernel parameters can be set only _during boot_ of the machine (any parameter that controls memory allocation, sizes of memory buffers).\n    \n-   To check the current value of a kernel parameter:\n    \n    `[Expert@HostName]# fw ctl get int _PARAMETER_`\n    \n-   To set the desired value for a kernel parameter _on-the-fly_:\n    \n    `[Expert@HostName]# fw ctl set int _PARAMETER_ _VALUE_`\n    \n    **Important Note:** Some internal cluster timers use special time units - `HTU (\"HA Time Unit\")`, where `1 HTU = 100 milliseconds = 0.1 second`. For such parameters, run:  \n    `[Expert@HostName]# fw ctl set int _PARAMETER_ _VALUE_in_HTUs_`\n    \n-   To set the desired value for a kernel parameter _permanently_ (for your operating system):\n    \n    Follow [sk26202 - Changing the kernel global parameters for Check Point Security Gateway](https://support.checkpoint.com/results/sk/sk26202).\n    \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorSergei Shir\n\nTechnical ResourceRan Vaknin\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2013-05-07\n\nLast Modified2024-12-08\n\nEditorGil Frantsus\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only\n\n**Should not be deleted - referenced in sk93306 (ATRG ClusterXL)**\n\n___\n\n**Statement from ClusterXL RnD about CUL in OPSEC / 3rd party clusters:**\n\n```\n----Original Message----\nFrom: Omer Aharonian \nSent: Sunday, June 05, 2016 18:31\nTo: Konstantin Bryman\nSubject: RE: CUL and cluster OPSEC ( Xbeam )\n\nCUL is not needed in OPSEC clusters since in such clusters CXL does not make any decision regarding states.\n\n----Original Message----\nFrom: Konstantin Bryman \nSent: Sunday, June 05, 2016 6:04 PM\nTo: Omer Aharonian\nSubject: CUL and cluster OPSEC ( Xbeam )\n\nHi Omer, \n\nWe talked about it quickly last week, I wanted to follow up on it…\n\nBasically as Xbeam is cluster opsec and we provide state synchronization there is no real need for the CUL, right? \nFailovers, traffic distribution etc… is controlled by  the chassis. \n\nThe reason I'm asking is that we currently have an escalated case with a Diamond customer, \nand logs are a bit spammed with CUL notifications. \nI want to disable it to try and clear the logs as much as possible to get information on the real issue, \nit also flood the dmesg so it's a bit problematic. \n\nI did some tests in my lab and turned it off and didn't see any negative impact...\n```\n\n___\n\nCluster Under Load (CUL) kernel parameters were ported from R75.47 to other versions:\n\n-   fwha\\_cul\\_mechanism\\_enable\n-   fwha\\_cul\\_member\\_cpu\\_load\\_limit\n-   fwha\\_cul\\_member\\_long\\_timeout\n-   fwha\\_cul\\_cluster\\_short\\_timeout\n-   fwha\\_cul\\_cluster\\_log\\_delay\\_millisec\n-   fwha\\_cul\\_policy\\_freeze\\_timeout\\_millisec\n-   fwha\\_cul\\_policy\\_freeze\\_event\\_timeout\\_millisec\n\n**Location of hotfixes that will add CUL parameters to Security Gateway:**\n\n-   **R75.40VS**  \n    -   Task [37347](http://taskmanager/TaskReport.asp?TaskId=37347) , CR01169352 + CR01169039 (sk93454) + CR01168878 (sk93599) + (CR01169376 + CR01168710 + CR01168754 + CR01168810 + CR01168854)  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\giza_hf_020_005\\`\n    -   Task [37515](http://taskmanager/TaskReport.asp?TaskId=37515) , CR01173336 + CR01173374 (sk93454) + (CR01173176 + CR01173409)  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\foxx_hf_001_007\\B986007001_2`\n    -   Task [38732](http://taskmanager/TaskReport.asp?TaskId=38732) , CR01203288 + CR01203322 (sk92456) + CR01203299 + CR01203308 + CR01205611 + CR01203469  \n        **Note:** There are 2 parts - for FW1 and for SIM.  \n        \n    -   \\\\\\\\galaxy\\\\ckp\\\\pkg\\\\fw1\\_wrapper\\\\giza\\_hf\\_001\\_006\\\\\n    \n    -   \\\\\\\\galaxy\\\\ckp\\\\pkg\\\\sim\\\\giza\\_hf\\_001\\_006\\\\\n    \n-   **R75.46**  \n    -   Task [36531](http://taskmanager/TaskReport.asp?TaskId=36531) , CR01151794 + CR01150500 (sk93454) + (CR01151788 + CR01151796)  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\foxx_hf_001_006\\` \n    -   Task [37761](http://taskmanager/TaskReport.asp?TaskId=37761) , CR01179013 + CR01179018 (sk93454) + (CR01178991 + CR01179014)  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\foxx_hf_070_208\\`\n    -   Task [37802](http://taskmanager/TaskReport.asp?TaskId=37802) , CR01181123 + CR01180945 (sk93454) + (CR01180794 + CR01181271 + CR01181758 + CR01182105 + CR01187428)  \n        **Important Note:**  \n        This hotfix is created on top of Security Acceleration Module Hotfix for 21000 Appliances (`Check_Point_R75.46_SAM_055_21000.tgz`) from [**sk92734**](http://supportcontent.checkpoint.com/solutions?id=sk92734).  \n        Meaning, the SAM Hotfix from sk92734 must be installed first.  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\fanta_sam_055_005\\`\n-   **R75.47**  \n    CR01137045 + CR01139243 + CR01162005 + CR01184989  \n    `integrated`\n-   **R76**  \n    Task [38131](http://taskmanager/TaskReport.asp?TaskId=38131) , CR01189800  \n    **Note:** Must install these 2 packages:\n    1.  From Task [37571](http://taskmanager/TaskReport.asp?TaskId=37571) , CR01133747 + CR01133749 + CR01159927:  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\gizmo_hf_base_038\\`\n    2.  From Task [38131](http://taskmanager/TaskReport.asp?TaskId=38131) , CR01189794 (memory leak fix) + (CR01189780 (sk93454) + CR01189800 + CR01189833):  \n        `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\gizmo_hf_038_005\\`\n-   **R76 for Verizon**  \n    Task [39061](http://taskmanager/TaskReport.asp?TaskId=39061) , CR01200040 + (more than 20 CRs)  \n    `\\\\galaxy\\ckp\\pkg\\fw1_wrapper\\gizmo_hf_vrzn\\B989005013_3\\`\n\n___\n\nThis is a general cluster debug for **Troubleshooting guidelines - Algorithm - Step 6**, which can be run indefinitely (it does not cause CPU load - just monitor the free disk space, since the information is written into an output file):\n\n1.  Prepare:\n    \n    `[Expert@HostName]# fw ctl debug 0`  \n    `[Expert@HostName]# fw ctl debug -buf 32000`  \n    `[Expert@HostName]# fw ctl debug -m cluster + conf stat pnote if mac drop`\n    \n2.  Verify:\n    \n    `[Expert@HostName]# fw ctl debug -m cluster`\n    \n3.  Start:\n    \n    `[Expert@HostName]# fw ctl kdebug -T -f > /var/log/$(uname -n)_debug.txt`\n    \n4.  Replicate:\n    \n    Replicate the issue, or wait for the issue to occur.  \n    Note: The more state changes you catch, the easier it would be for Check Point Support to determine the root cause.\n    \n    Important Note: If possible, then collect the CPinfo file _during_ the issue from all cluster members  \n    (or at least, collect outputs of these commands:  \n    _`cphaprob state`_, _`cphaprob -a if`_, _`cphaprob -ia list`_, _`cphaprob syncstat`_, _`fw ctl pstat`_).\n    \n5.  Stop:\n    \n    Press CTRL+C  \n    `[Expert@HostName]# fw ctl debug 0`\n    \n6.  Send:\n    -   ``/var/log/<`MEMBER_HOSTNAME>`_debug.txt``\n    -   CPinfo files collected during the issue\n    -   Outputs of '`cphaprob`' commands collected during the issue\n    -   Export of cluster-related messages from SmartView Tracker for the time of the issue","language":"md","time":"14 days ago","created":"2025-05-06T22:56:01.994Z","annotations":[],"updated":"2025-05-06T22:58:06.919Z"},{"title":"ProductMulti-Domain Security Management, Quantum Security Gateways","id":"b27e867e-20a7-4986-8bcb-0ae525601e0f","type":"TEXT","raw":"ProductMulti-Domain Security Management, Quantum Security Gateways, Quantum Security Management, SmartView Monitor\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.10.x, R81.20, R82\n\nLast Modified2025-04-03\n\n## Solution\n\n**Table of Contents:**\n\n1.  The Need for Suspicious Activity Rules\n    \n2.  Suspicious Activity Rules Solution\n    \n3.  Creating a New Suspicious Activity Rule\n    \n4.  Creating a Suspicious Activity Rule from Monitoring Results\n    \n5.  Managing Suspicious Activity Rules\n    \n6.  Working with Suspicious Activity Monitoring Server from CLI (fw sam)\n    \n7.  Working with SAM Policy editor from CLI (fw sam\\_policy)\n    \n8.  Kernel debug\n    \n\nClick Here to Collapse the Entire Article\n\n### (1) The Need for Suspicious Activity Rules\n\nThe fast-changing environment of network security requires that you be able to react immediately to a security problem without having to change the entire network's Firewall rule base (for example, when you want to block a specific user).\n\nTo achieve this you must make sure that all inbound and outbound network activity is inspected and identified as suspicious when necessary (for example, when network or system activity indicates that someone is attempting to break in).\n\n### (2) Suspicious Activity Rules Solution\n\nThe Suspicious Activity Monitoring (SAM) utility is integrated into SmartView Monitor. The utility blocks activities that you see in the SmartView Monitor's results and that appear to be suspicious. Using SAM, you can block a user who tries several times to gain unauthorized access to a network or Internet resource.\n\nThe firewall rules in a SAM-enabled Security Gateway block suspicious connections that are not restricted by the security policy. These rules are applied immediately (Install Policy is not required).\n\n### (3) Creating a New Suspicious Activity Rule\n\n**Note:** SAM rules consume some CPU resources on a Security Gateway. Accordingly, set an expiration that gives you time to investigate but does not affect performance. The best practice is to keep only the SAM rules that you need. If you confirm that an activity is risky, edit the Security Policy, educate users, or otherwise handle the risk.\n\nFollow these steps in the SmartView Monitor to create a SAM rule from scratch to block suspicious activity based on source, destination, or service:\n\nShow / Hide this section\n\n1.  Go to _**Suspicious Activity Rules**_ settings:\n    \n    -   Show / Hide instructions for R8x versions\n        \n        1.  Connect with SmartConsole to Security Management Server / Domain Management Server.\n            \n        2.  In the _Application main navigation pane_, click on _**LOGS & MONITOR**_.\n            \n        3.  At the top, go to _**New Tab**_ tab.\n            \n        4.  At the bottom, in the _**External Apps**_ section, click on _**Tunnel & User Monitoring**_:\n            \n            [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Tunnel_and_User_Monitoring.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Tunnel_and_User_Monitoring.png \"Click the image to see it in full size in a new tab/window\")\n        5.  SmartView Monitor GUI opens.\n            \n        6.  Go to _**Suspicious Activity Rules...**_:\n            \n            -   Either click on the _**Suspicious Activity Rules**_ button on the toolbar:\n                \n                ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/Suspicious_Activity_Rules_button.png)\n            -   Or go to the _main menu_ - go to _**View**_ menu - click on _**Menu Bar**_, and then, go to _**Tools**_ menu - click on the _**Suspicious Activity Rules...**_:\n                \n        7.  The _**Enforced Suspicious Activity Rules**_ window opens.\n            \n            Click on _**Add...**_ button at the bottom.\n            \n            [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Enforced_Suspicious_Activity_Rules_window_empty.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Enforced_Suspicious_Activity_Rules_window_empty.png \"Click the image to see it in full size in a new tab/window\")\n        8.  The _**Block Suspicious Activity**_ window opens.\n            \n            [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/Block_Suspicious_Activity_window.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/Block_Suspicious_Activity_window.png \"Click the image to see it in full size in a new tab/window\")\n        \n    -   Show / Hide instructions for R7x versions\n        \n        1.  Connect with SmartView Monitor to Security Management Server / Domain Management Server.\n            \n        2.  Go to _**Suspicious Activity Rules...**_:\n            \n            -   Either click on the _**Suspicious Activity Rules**_ button on the toolbar:\n                \n                ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/Suspicious_Activity_Rules_button.png)\n            -   Or go to the _main menu_ - go to _**View**_ menu - click on _**Menu Bar**_, and then, go to _**Tools**_ menu - click on the _**Suspicious Activity Rules...**_:\n                \n        3.  Go to _**Tools**_ menu - click on the _**Suspicious Activity Rules...**_:\n            \n            ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R7x_Tools_menu_Suspicious_Activity_Rules.png)\n        4.  The _**Enforced Suspicious Activity Rules**_ window opens.\n            \n            Click on _**Add...**_ button at the bottom.\n            \n            [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R7x_Enforced_Suspicious_Activity_Rules_window_empty.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R7x_Enforced_Suspicious_Activity_Rules_window_empty.png \"Click the image to see it in full size in a new tab/window\")\n        5.  The _**Block Suspicious Activity**_ window opens.\n            \n            [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/Block_Suspicious_Activity_window.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/Block_Suspicious_Activity_window.png \"Click the image to see it in full size in a new tab/window\")\n        \n2.  Configure the required Suspicious Activity rule:\n    \n    <table><tbody><tr><td>Setting</td><td>Description</td></tr><tr><td><em>Apply on all<br>Security Gateways</em></td><td>Specifies that this rule should be enforced on all managed Check Point Security Gateways</td></tr><tr><td><em>Apply On</em></td><td>Specifies the Check Point Security Gateway on which thus rule should be enforced</td></tr><tr><td><em>Source</em></td><td><p>Specifies the Host IP address (select <em>IP</em>), or Network IP address (select <em>Network</em>) that initiates the communication</p>To block <em>all</em> sources that fit the other parameters, select <em>IP</em> and enter <em>Any</em></td></tr><tr><td><em>Destination</em></td><td><p>Specifies the Host IP address (select <em>IP</em>), or Network IP address (select <em>Network</em>) to which the traffic is sent</p>To block <em>all</em> destinations that fit the other parameters, select <em>IP</em> and enter <em>Any</em></td></tr><tr><td><em>Service</em></td><td><p>Specifies the service to which the rule is applied:</p><ul type=\"square\"><li><p>To block <em>all</em> connections that fit the other parameters, enter <em>Any</em></p></li><li><p>To block <em>one</em> suspicious service or protocol:</p><ol type=\"i\"><li>Click on the <em>[...]</em> button</li><li>Select / configure the relevant service / protocol:<br><ul type=\"circle\"><li>To use a pre-defined service, select the option <em>Select Service from list</em> - select the relevant pre-defined service</li><li>To use a user-defined service, select the option <em>Custom Service</em> - select the relevant protocol (<em>TCP</em> or <em>UDP</em>) - enter the relevant port number</li></ul></li><li>Click on OK</li></ol></li></ul></td></tr><tr><td><em>Expiration</em></td><td><p>Specifies the time frame for the specific rule:</p><ul type=\"square\"><li><p><em>Relative</em>: specifies the desired relative expiration - <em>Next 10 Minutes, Next Hour, Next Day, Next Week, Never</em></p></li><li><p><em>Absolute Date</em>: specifies the desired absolute expiration - set the specific date and time</p></li></ul></td></tr><tr><td><em>Advanced...</em></td><td><p>Specifies the action that should be enforced when the connection matches this rule:</p><p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/Block_Suspicious_Activity_window_Advanced.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/Block_Suspicious_Activity_window_Advanced.png\" alt=\"\" width=\"20%\"></a></p><div><table><tbody><tr><td>Setting</td><td>Description</td></tr><tr><td><em>Action</em></td><td>Specifies whether communication that matches this rule should or should not be allowed.<br>Select the desired action:<br><ul><li><em>Notify</em> - Security Gateway will allow the connection, and a specified notification is generated (<em>No log, Log, Alert</em>)</li><li><em>Reject</em> - Security Gateway will send an TCP RST packet to the source machine of the connection, and will close the connection</li><li><em>Drop</em> - Security Gateway silently discards the TCP SYN packets, and the connection will eventually time out</li></ul></td></tr><tr><td><em>Track</em></td><td>Specifies whether communication that matches this rule is tracked in SmartView Tracker, or via other tracking options.<br>Select the desired tracking:<br><ul><li>No log</li><li>Log</li><li>Alert</li></ul></td></tr><tr><td><em>Close connections</em></td><td>Specifies that existing connections, whose communication matches this rule, should be closed immediately</td></tr></tbody></table></div></td></tr></tbody></table>\n    \n3.  Click on _**Enforce**_ button to apply this rule on the selected Security Gateway(s).\n    \n    **Important Note:** It is not possible to edit the SAM rule after clicking on this button. The current rule would have to be deleted and a new rule would have to be configured.\n\n### (4) Creating a Suspicious Activity Rule from Monitoring Results\n\n**Note:** SAM rules consume some CPU resources on Security Gateway. So, set an expiration that gives you time to investigate but does not affect performance. The best practice is to keep only the SAM rules that you need. If you confirm that an activity is risky, edit the Security Policy, educate users, or otherwise handle the risk.\n\nFollow these steps to create a SAM rule from Monitoring Results to block suspicious activity based on source, destination, or service:\n\n-   Show / Hide instructions for R8x versions\n    \n    1.  Connect with SmartConsole to Security Management Server / Domain Management Server.\n        \n    2.  In the _Application main navigation pane_, click on _**GATEWAYS & SERVERS**_.\n        \n    3.  Open the _**Device & License Information...**_ window:\n        \n        <table><tbody><tr><td>Option 1:</td><td>Option 2:</td></tr><tr><td><ol type=\"A\"><li><p>Select the relevant Security Gateway.</p></li><li><p>Click on the <em><strong>Monitor</strong></em> button on the toolbar.</p><em>Example</em>:<br><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Monitor_button.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Monitor_button.png\" alt=\"\" width=\"40%\"></a></li></ol></td><td><ol type=\"A\"><li><p>Select the relevant Security Gateway.</p></li><li><p>In the lower pane, go to <em><strong>Summary</strong></em> tab.</p></li><li><p>At the bottom, click on <em><strong>Device &amp; License Information...</strong></em> link, or <em><strong>Device Information...</strong></em> link.</p><p><em>Example</em>:<br><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Device_and_License_Information.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Device_and_License_Information.png\" alt=\"\" width=\"40%\"></a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Device_Information.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Device_Information.png\" alt=\"\" width=\"40%\"></a></p></li></ol></td></tr></tbody></table>\n        \n    4.  The _**Device & License Information...**_ window opens.\n        \n        In the left tree, click on _**Traffic**_ to see the counters.\n        \n        _Example_:  \n        [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Traffic_Counters.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Traffic_Counters.png \"Click the image to see it in full size in a new tab/window\")\n        \n    5.  Click on the relevant counter:\n        \n        -   Top Services\n        -   Top Destinations\n        -   Top VoIP Users\n        -   Top P2P Users\n        -   Top Sources\n    6.  In the _**Results**_ window, right-click on the relevant bar in the chart / row in the report that represents the source, destination, or service that you want to block - in the context menu, click on the relevant _block_ option:\n        \n        <table><tbody><tr><td><div><table><tbody><tr><td>Selected<br>counter</td><td>Option in the<br>context menu</td></tr><tr><td><em>Top Services</em></td><td>Block Service</td></tr><tr><td><em>Top Destinations</em></td><td>Block Source</td></tr><tr><td><em>Top VoIP Users</em></td><td><ul><li>Block Source</li><li>Block Destination</li></ul></td></tr><tr><td><em>Top P2P Users</em></td><td>Block Source</td></tr><tr><td><em>Top Sources</em></td><td>Block Source</td></tr></tbody></table></div></td><td><em>Example</em>:<br><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Traffic_Counters_Right_Click_Block_Destination.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Traffic_Counters_Right_Click_Block_Destination.png\" alt=\"\" width=\"30%\"></a></td></tr></tbody></table>\n        \n    7.  The _**Block Suspicious Activity**_ window opens.\n        \n        Based on the selected counter, some settings in the rule will already be configured - the Security Gateway object, the Source IP address, the Destination IP address, the service.\n        \n        Configure the relevant settings in the Suspicious Activity rule.\n        \n        _Example_:  \n        [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Traffic_Counters_Right_Click_Block_Destination_Block_Suspicious_Activity_rule.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Traffic_Counters_Right_Click_Block_Destination_Block_Suspicious_Activity_rule.png \"Click the image to see it in full size in a new tab/window\")\n        \n    8.  Click on _**Enforce**_ button.\n        \n        **Important Note:** It is not possible to edit the SAM rule after clicking on this button. The current rule would have to be deleted and a new rule would have to be configured.\n    \n-   Show / Hide instructions for R7x versions\n    \n    1.  Connect with SmartView Monitor to Security Management Server / Domain Management Server.\n        \n    2.  In the left tree, expand the _**Traffic**_ view - click on the relevant counter.\n        \n        -   Top Services\n        -   Top Destinations\n        -   Top VoIP Users\n        -   Top P2P Users\n        -   Top Sources\n    3.  The _**Select Gateway/Interface**_ window opens.\n        \n        Select the relevant interface direction (and connection direction) - expand the object of the relevant Security Gateway - select the relevant interface - click on OK.\n        \n        _Example_:  \n        [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R7x_Top_Services_Select_Gateway_Interface.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R7x_Top_Services_Select_Gateway_Interface.png \"Click the image to see it in full size in a new tab/window\")\n    4.  In the _**Results**_ window, right-click on the relevant bar in the chart / row in the report that represents the source, destination, or service that you want to block - in the context menu, click on the relevant _block_ option:\n        \n        <table><tbody><tr><td><div><table><tbody><tr><td>Selected<br>counter</td><td>Option in the<br>context menu</td></tr><tr><td><em>Top Services</em></td><td>Block Service</td></tr><tr><td><em>Top Destinations</em></td><td>Block Source</td></tr><tr><td><em>Top VoIP Users</em></td><td><ul><li>Block Source</li><li>Block Destination</li></ul></td></tr><tr><td><em>Top P2P Users</em></td><td>Block Source</td></tr><tr><td><em>Top Sources</em></td><td>Block Source</td></tr></tbody></table></div></td><td><em>Example</em>:<br><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R7x_Right_Click_Block_Service.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R7x_Right_Click_Block_Service.png\" alt=\"\" width=\"30%\"></a></td></tr></tbody></table>\n        \n    5.  The _**Block Suspicious Activity**_ window opens.\n        \n        Based on the selected counter, some settings in the rule will already be configured - the Security Gateway object, the Source IP address, the Destination IP address, the service.\n        \n        Configure the relevant settings in the Suspicious Activity rule.\n        \n        _Example_:  \n        [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R7x_Right_Click_Block_Service_Block_Suspicious_Activity_rule.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R7x_Right_Click_Block_Service_Block_Suspicious_Activity_rule.png \"Click the image to see it in full size in a new tab/window\")\n        \n    6.  Click on _**Enforce**_ button.\n        \n        **Important Note:** It is not possible to edit the SAM rule after clicking on this button. The current rule would have to be deleted and a new rule would have to be configured.\n    \n\n### (5) Managing Suspicious Activity Rules\n\nShow / Hide this section\n\n1.  Open SmartView Monitor GUI:\n    \n    -   Instructions for R8x versions:\n        \n        1.  Connect with SmartConsole to Security Management Server / Domain Management Server.\n            \n        2.  In the _Application main navigation pane_, click on _**LOGS & MONITOR**_.\n            \n        3.  At the top, go to _**New Tab**_ tab.\n            \n        4.  At the bottom, in the _**External Apps**_ section, click on _**Tunnel & User Monitoring**_:\n            \n            [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Tunnel_and_User_Monitoring.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/R8x_Tunnel_and_User_Monitoring.png \"Click the image to see it in full size in a new tab/window\")\n        5.  SmartView Monitor GUI opens.\n            \n    -   Instructions for R7x versions:\n        \n        1.  Connect with SmartView Monitor to Security Management Server / Domain Management Server.\n            \n2.  Go to _**Suspicious Activity Rules...**_:\n    \n    -   Either click on the _**Suspicious Activity Rules**_ button on the toolbar:\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk112061/Suspicious_Activity_Rules_button.png)\n    -   Or go to the _main menu_ - go to _**View**_ menu - click on _**Menu Bar**_, and then, go to _**Tools**_ menu - click on the _**Suspicious Activity Rules...**_:\n        \n3.  The _**Enforced Suspicious Activity Rules**_ window opens.\n    \n    -   To see the configured rules on all managed Security Gateways, select _**Apply on All**_ option\n    -   To see the configured rules on a specific Security Gateway, select _**Show On**_ option and select the relevant Security Gateway object.\n4.  You can remove a specific SAM rule, or all SAM rules at once.\n    \n    Note: If you added a SAM rule that conflicts with another SAM rule, then the _conflicting_ SAM rule remains hidden.  \n    For example, if you define a SAM rule to drop _http_ traffic, and a SAM rule already exists to reject _http_ traffic, then only the \"drop\" SAM rule will be shown. If you delete the \"drop\" SAM rule, then the \"reject\" SAM rule will appear.\n\n### (6) Working with SAM Server from CLI (fw sam)\n\nThe _**fw sam**_ command can be used to work with Suspicious Activity Rules from the CLI on either Security Management Server / Domain Management Server, or Security Gateway.\n\n**Note:** **The \"`fw sam`\" command is not supported on Quantum Maestro and Scalable Chassis.**\n\nShow / Hide this section\n\n-   To Add/Cancel SAM rule according to criteria:\n    \n    _**\\[Expert@HostName:0\\]# fw \\[-d\\] sam \\[-v\\] \\[-s <SAM\\_Server>\\] \\[-S <SIC\\_Name\\_of\\_SAM\\_Server>\\] \\[-f <Security\\_Gateway>\\] \\[-t <Timeout>\\] \\[-l <Log\\_Type>\\] \\[-C\\] \\[-e <key=val>\\]+ \\[-r\\] -{n|i|I|j|J} <Criteria>**_\n-   To delete all SAM rules:\n    \n    _**\\[Expert@HostName:0\\]# fw \\[-d\\] sam \\[-v\\] \\[-s <SAM\\_Server>\\] \\[-S <SIC\\_Name\\_of\\_SAM\\_Server>\\] \\[-f <Security\\_Gateway>\\] -D**_\n-   To monitor all SAM rules:\n    \n    _**\\[Expert@HostName:0\\]# fw \\[-d\\] sam \\[-v\\] \\[-s <SAM\\_Server>\\] \\[-S <SIC\\_Name\\_of\\_SAM\\_Server>\\] \\[-f <Security\\_Gateway>\\] \\[-r\\] -M -{i|j|n|b|q} all**_\n-   To monitor SAM rules according to criteria:\n    \n    _**\\[Expert@HostName:0\\]# fw \\[-d\\] sam \\[-v\\] \\[-s <SAM\\_Server>\\] \\[-S <SIC\\_Name\\_of\\_SAM\\_Server>\\] \\[-f <Security\\_Gateway>\\] \\[-r\\] -M -{i|j|n|b|q} <Criteria>**_\n\nwhere:\n\n> <table><tbody><tr><td>Parameter</td><td>Description</td></tr><tr><td>-d</td><td>Enables debug mode for <em>fw</em> command. Writes to local <em>stderr</em>.</td></tr><tr><td>-v</td><td>Enables verbose mode. Writes one message (describing whether the command was successful or not) to <em>stderr</em> for each Security Gateway machine, on which the command is enforced.</td></tr><tr><td>-s &lt;SAM_Server&gt;</td><td>Specifies IP address (in the <em>X.X.X.X</em> format) / resolvable HostName of Security Gateway that will enforce the command.<br>The default is <em>localhost</em>.</td></tr><tr><td>-S &lt;SIC_Name_of_SAM_Server&gt;</td><td>The SIC name for the SAM server to be contacted. It is expected that the SAM server will have this SIC name, otherwise the connection will fail.<br>If no server SIC name is supplied, the connection will proceed without SIC names comparison.<br>For more information about enabling SIC, refer to the OPSEC API Specification.<br>On VSX Gateway, run the <em>fw vsx showncs -vs &lt;VSID&gt;</em> command to show the SIC name for the relevant Virtual System.&nbsp;</td></tr><tr><td>-f &lt;Security_Gateway&gt;</td><td><p>Specifies the Security Gateway machine on which to enforce the action:</p><ul><li><p><em>All</em> - Default. Specifies that the action should be enforced on all managed Security Gateways where SAM Server runs.<br>This syntax can be used only on Security Management Server / Domain Management Server.</p></li><li><p><em>localhost</em> - Specifies that the action should be enforced on this local machine (on which the \"<em>fw sam</em>\" command is being executed).<br>This syntax can be used only on Security Gateway / StandAlone.</p></li><li><p><em>Gateways</em> - Specifies that the action should be enforced on all objects defined as Security Gateways, on which SAM Server runs.<br>This syntax can be used only on Security Management Server / Domain Management Server.</p></li><li><p><em>Name of Security Gateway object</em> - Specifies that the action should be enforced on this specific Security Gateway object.<br>This syntax should be used only on Security Management Server / Domain Management Server.</p></li><li><p><em>Name of Group object</em> - Specifies that the action should be enforced on all specific Security Gateways in this Group object.<br>This syntax can be used only on Security Management Server / Domain Management Server.</p></li></ul></td></tr><tr><td>-D</td><td><p>Cancels all <em>inhibit</em> (<em>-i, -j,-I,-J</em>) and <em>notify</em> (<em>-n</em>) commands.</p>To \"uninhibit\" the inhibited connections, execute \"<em>fw sam</em>\" command with the \"<em>-C</em>\" or \"<em>-D</em>\" parameters.<br>It is also possible to use this command for active SAM requests.</td></tr><tr><td>-C</td><td>Cancels the \"<em>fw sam</em>\" command to inhibit connections with the specified parameters.<br>These connections will no longer be inhibited (rejected or dropped).<br>The command parameters must match the ones in the original \"<em>fw sam</em>\" command, except for the \"<em>-t &lt;Timeout&gt;</em>\" parameter.</td></tr><tr><td>-t &lt;Timeout&gt;</td><td>Specifies the time period (in seconds) during which the action will be enforced.<br>The default is forever, or until cancelled.</td></tr><tr><td>-l &lt;Log_Type&gt;</td><td><p>Specifies the type of the log for enforced action:</p><ul><li><em>nolog</em> - Does not generates any Log / Alert</li><li><em>short_noalert</em> - Generates a Log</li><li><em>short_alert</em> - Generates an Alert</li><li><em>long_noalert</em> - Generates a Log</li><li><em>long_alert</em> - Generates an Alert (default)</li></ul></td></tr><tr><td>-e &lt;key=val&gt;+</td><td><p>Specifies rule information based on the keys and the provided values.<br>Multiple keys are separated by the plus sign (+).<br>Available keys are:</p><ul><li><em>name</em> - security rule name (limited to 100 characters)</li><li><em>comment</em> - security rule comment (limited to 100 characters)</li><li><em>originator</em> - security rule originator's username (limited to 100 characters)</li></ul></td></tr><tr><td>-r</td><td>Specifies that all IP addresses should be resolved.</td></tr><tr><td>-n</td><td>Specifies that a \"Notify\" long-format log entry should be generated.<br>Generates an alert when connections that match the specified services or IP addresses pass through the FireWall.<br>This action does <em>not</em> inhibit / close connections.</td></tr><tr><td>-i</td><td>Inhibits (do not allow) new connections with the specified parameters.<br>Each inhibited connection is logged according to log type.<br>Matching connections will be <em>rejected</em>.</td></tr><tr><td>-I</td><td>Inhibits new connections with the specified parameters, and closes all existing connections with the specified parameters.<br>Each inhibited connection is logged according to the log type.<br>Matching connections will be <em>rejected</em>.</td></tr><tr><td>-j</td><td>Inhibits new connections with the specified parameters.<br>Each inhibited connection is logged according to the log type.<br>Matching connections will be <em>dropped</em>.</td></tr><tr><td>-J</td><td>Inhibits new connections with the specified parameters, and closes all existing connections with the specified parameters.<br>Each inhibited connection is logged according to the log type.<br>Matching connections will be <em>dropped</em>.</td></tr><tr><td>-b</td><td>Bypasses new connections with the specified parameters.</td></tr><tr><td>-q</td><td>Quarantines new connections with the specified parameters.</td></tr><tr><td>-M</td><td>Monitors the active SAM requests with the specified actions and criteria.</td></tr><tr><td>all</td><td>Gets all active SAM requests.<br>Used for monitoring purposes only.</td></tr><tr><td>&lt;Criteria&gt;</td><td><p>Criteria are used to match connections, and are composed of various combinations of the following parameters:</p><ul><li>Source IP Address</li><li>Source Netmask</li><li>Destination IP Address</li><li>Destination Netmask</li><li>Service (per <a href=\"http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml\" target=\"_blank\" rel=\"noopener\">IANA Service Name and Port Number Registry</a>)</li><li>Protocol Number (per <a href=\"http://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml\" target=\"_blank\" rel=\"noopener\">IANA Protocol Numbers</a>)</li></ul><p>Possible combinations are:</p><ul><li>src &lt;ip&gt;</li><li>dst &lt;ip&gt;</li><li>any &lt;&lt;ip&gt;</li><li>subsrc &lt;ip&gt; &lt;netmask&gt;</li><li>subdst &lt;ip&gt; &lt;netmask&gt;</li><li>subany &lt;ip&gt; &lt;netmask&gt;</li><li>srv &lt;src ip&gt; &lt;dest ip&gt; &lt;service&gt; &lt;protocol&gt;</li><li>subsrv &lt;src ip&gt; &lt;src netmask&gt; &lt;dest ip&gt; &lt;dest netmask&gt; &lt;service&gt; &lt;protocol&gt;</li><li>subsrvs &lt;src ip&gt; &lt;src netmask&gt; &lt;dest ip&gt; &lt;service&gt; &lt;protocol&gt;</li><li>subsrvd &lt;src ip&gt; &lt;dest ip&gt; &lt;dest netmask&gt; &lt;service&gt; &lt;protocol&gt;</li><li>dstsrv &lt;dest ip&gt; &lt;service&gt; &lt;protocol&gt;</li><li>subdstsrv &lt;dest ip&gt; &lt;dest netmask&gt; &lt;service&gt; &lt;protocol&gt;</li><li>srcpr &lt;ip&gt; &lt;protocol&gt;</li><li>dstpr &lt;ip&gt; &lt;protocol&gt;</li><li>subsrcpr &lt;ip&gt; &lt;netmask&gt; &lt;protocol&gt;</li><li>subdstpr &lt;ip&gt; &lt;netmask&gt; &lt;protocol&gt;</li><li>generic &lt;key=val&gt;</li></ul><p>where:</p><div><table><tbody><tr><td>Parameter</td><td>Description</td></tr><tr><td>src &lt;ip&gt;</td><td>Matches the Source IP address of the connection.</td></tr><tr><td>dst &lt;ip&gt;</td><td>Matches the Destination IP address of the connection.</td></tr><tr><td>any &lt;ip&gt;</td><td>Matches either the Source IP address or the Destination IP address of the connection.</td></tr><tr><td>subsrc &lt;ip&gt; &lt;netmask&gt;</td><td>Matches the Source IP address of the connections according to the netmask.</td></tr><tr><td>subdst &lt;ip&gt; &lt;netmask&gt;</td><td>Matches the Destination IP address of the connections according to the netmask.</td></tr><tr><td>subany &lt;ip&gt; &lt;netmask&gt;</td><td>Matches either the Source IP address or Destination IP address of connections according to the netmask.</td></tr><tr><td>srv &lt;src ip&gt; &lt;dest ip&gt; &lt;service&gt; &lt;protocol&gt;</td><td>Matches the specific Source IP address, Destination IP address, Service (port number) and Protocol.</td></tr><tr><td>subsrv &lt;src ip&gt; &lt;netmask&gt; &lt;dest ip&gt; &lt;netmask&gt; &lt;service&gt; &lt;protocol&gt;</td><td>Matches the specific Source IP address, Destination IP address, Service (port number) and Protocol.<br>Source and Destination IP addresses are assigned according to the netmask.</td></tr><tr><td>subsrvs &lt;src ip&gt; &lt;src netmask&gt; &lt;dest ip&gt; &lt;service&gt; &lt;protocol&gt;</td><td>Matches the specific Source IP address, source netmask, destination netmask, Service (port number) and Protocol.</td></tr><tr><td>subsrvd &lt;src ip&gt; &lt;dest ip&gt; &lt;dest netmask&gt; &lt;service&gt; &lt;protocol&gt;</td><td>Matches specific Source IP address, Destination IP, destination netmask, Service (port number) and Protocol.</td></tr><tr><td>dstsrv &lt;dest ip&gt; &lt;service&gt; &lt;protocol&gt;</td><td>Matches specific Destination IP address, Service (port number) and Protocol.</td></tr><tr><td>subdstsrv &lt;dest ip&gt; &lt;netmask&gt; &lt;service&gt; &lt;protocol&gt;</td><td>Matches specific Destination IP address, Service (port number) and Protocol.<br>Destination IP address is assigned according to the netmask.</td></tr><tr><td>srcpr &lt;ip&gt; &lt;protocol&gt;</td><td>Matches the Source IP address and protocol.</td></tr><tr><td>dstpr &lt;ip&gt; &lt;protocol&gt;</td><td>Matches the Destination IP address and protocol.</td></tr><tr><td>subsrcpr &lt;ip&gt; &lt;netmask&gt; &lt;protocol&gt;</td><td>Matches the Source IP address and protocol of connections.<br>Source IP address is assigned according to the netmask.</td></tr><tr><td>subdstpr &lt;ip&gt; &lt;netmask&gt; &lt;protocol&gt;</td><td>Matches the Destination IP address and protocol of connections.<br>Destination IP address is assigned according to the netmask.</td></tr><tr><td>generic &lt;key=val&gt;+</td><td><p>Matches the GTP connections based on the specified keys and provided values.<br>Multiple keys are separated by the plus sign (+).<br>Available keys are:</p><ul><li>service=gtp</li><li>imsi</li><li>msisdn</li><li>apn</li><li>tunl_dst</li><li>tunl_dport</li><li>tunl_proto</li></ul></td></tr></tbody></table></div></td></tr></tbody></table>\n\n**Notes:**\n\n-   Logs for enforced SAM rules (configured with _fw sam_ command) are stored in the _**$FWDIR/log/sam.dat**_ file.  \n    By design, the file is purged automatically after you enable the **Purge SAM file when it reaches: option:** in the Security Gateway / Cluster Object **Properties** \\> **Other** \\> **SAM**.  \n    This data log file contains the records in one of the following formats:\n    \n    -   <type>,<actions>,<expire>,<ipaddr>\n    -   <type>,<actions>,<expire>,<src>,<dst>,<dport>,<ip\\_p>\n-   SAM Requests are stored in the kernel table _**sam\\_requests**_ on the Security Gateway.\n    \n-   IP Addresses blocked by SAM rules are stored in the kernel table _**sam\\_blocked\\_ips**_ on the Security Gateway.\n    \n\n### (7) Working with SAM Policy editor from CLI (fw sam\\_policy)\n\nThe _**fw sam\\_policy**_ command can be used to work with the Suspicious Activity Policy editor from the CLI on either Security Management Server / Domain Management Server, or Security Gateway.\n\nShow / Hide this section\n\n-   To add a new SAM policy rule:\n    \n    _**\\[Expert@HostName:0\\]# fw sam\\_policy add \\[-u\\] \\[-f <target>\\] \\[-t <timeout>\\] {\\[-a <d|r|n|q|i>\\]} \\[-l <r |a>\\] \\[-n <name>\\] \\[-c <comment>\\] \\[-o <originator>\\] ip <ip filter arguments>**_\n    \n    where:\n    \n    > <table><tbody><tr><td>Parameter</td><td>Description</td></tr><tr><td>-d</td><td>Enables debug mode for <em>fw</em> command. Writes to local <em>stderr</em>.</td></tr><tr><td>-u</td><td>Specifies that this is a user-defined rule.</td></tr><tr><td>-f &lt;Security_Gateway&gt;</td><td><p>Specifies the Security Gateway machine on which to enforce the policy:</p><ul><li><p><em>all</em> - Default. Specifies that the policy should be enforced on all managed Security Gateways.</p></li><li><p><em>Name of Security Gateway object</em> - Specifies that the policy should be enforced on this specific Security Gateway object.</p></li><li><p><em>Name of Group object</em> - Specifies that the policy should be enforced on all specific Security Gateways in this Group object.</p></li></ul></td></tr><tr><td>-t &lt;Timeout&gt;</td><td>Specifies the time period (in seconds) during which the policy will be enforced.</td></tr><tr><td>-a &lt;d | r | n | q | i&gt;</td><td><p>Specifies the action:</p><ul><li><em>d</em> - Drop the connection</li><li><em>r</em> - Reject the connection</li><li><em>n</em> - Notify the connection</li><li><em>q</em> - Quarantine the connection</li><li><em>i</em> - Inspect the connection</li></ul></td></tr><tr><td>-t &lt;Timeout&gt;</td><td>Specifies the time period (in seconds) during which the policy will be enforced.</td></tr><tr><td>-l &lt;r | a&gt;</td><td><p>Specifies the log type:</p><ul><li><em>r</em> - Regular log</li><li><em>a</em> - Alert</li></ul></td></tr><tr><td>-n &lt;name&gt;</td><td>Specifies the security rule name.</td></tr><tr><td>-c &lt;comment&gt;</td><td>Specifies the security rule comment.</td></tr><tr><td>-o &lt;originator&gt;</td><td>Specifies the security rule originator.</td></tr><tr><td>-z &lt;zone&gt;</td><td>Specifies the security zone.</td></tr><tr><td>ip &lt;IP filter arguments&gt;</td><td><p>Specifies that rule should be added with IP filter arguments:</p><p><em>[-C] [-s &lt;src ip&gt;] [-m &lt;src mask&gt;] [-d &lt;dst ip&gt;] [-M &lt;dst mask&gt;] [-p &lt;port&gt;] [-r &lt;proto&gt;]</em></p><p>where:</p><div><table><tbody><tr><td>Parameter</td><td>Description</td></tr><tr><td><em>-C</em></td><td>Specifies that open connections should be closed.</td></tr><tr><td><em>-s &lt;src ip&gt;</em></td><td>Specifies Source IP address.</td></tr><tr><td><em>-m &lt;src mask&gt;</em></td><td>Specifies Source subnet mask (in dotted decimal format).</td></tr><tr><td><em>-d &lt;dst ip&gt;</em></td><td>Specifies Destination IP address.</td></tr><tr><td><em>-M &lt;dst mask&gt;</em></td><td>Specifies Destination subnet mask (in dotted decimal format).</td></tr><tr><td><em>-p &lt;port&gt;</em></td><td>Specifies port number (per <a href=\"http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml\" target=\"_blank\" rel=\"noopener\">IANA Service Name and Port Number Registry</a>).</td></tr><tr><td><em>-r &lt;proto&gt;</em></td><td>Specifies protocol number (per <a href=\"http://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml\" target=\"_blank\" rel=\"noopener\">IANA Protocol Numbers</a>).</td></tr></tbody></table></div></td></tr></tbody></table>\n    \n-   To delete an existing SAM policy rule:\n    \n    _**\\[Expert@HostName:0\\]# fw \\[-d\\] sam\\_policy del \"<uid>\"**_\n    \n    where:\n    \n    > <table><tbody><tr><td>Parameter</td><td>Description</td></tr><tr><td>-d</td><td>Enables debug mode for <em>fw</em> command. Writes to local <em>stderr</em>.</td></tr><tr><td>\"&lt;uid&gt;\"</td><td>Unique identifier of an existing SAM rule, as obtained from the output of <em>fw sam_policy get</em> command.<br>Example:<br><code>fw sam_policy del \"&lt;5779378c,00000000,64291eac,00005584&gt;\"</code></td></tr></tbody></table>\n    \n-   To get the SAM policy:\n    \n    _**\\[Expert@HostName:0\\]# fw \\[-d\\] sam\\_policy get \\[-l\\] \\[-u <uid>\\] \\[-k <key> -t <in> \\[+{-v <val>}\\] \\[-n\\]\\]**_\n    \n    where:\n    \n    > <table><tbody><tr><td>Parameter</td><td>Description</td></tr><tr><td>-d</td><td>Enables debug mode for <em>fw</em> command. Writes to local <em>stderr</em>.</td></tr><tr><td>-l</td><td>Prints rule's parameters of each rule on separate lines<br>(instead of printing each entire rule on a separate line).</td></tr><tr><td>-u &lt;uid&gt;</td><td>Specifies rule UID (can be combined with a filter).</td></tr><tr><td>-k &lt;key&gt;</td><td>Specifies the key of predicate.</td></tr><tr><td>-t &lt;in&gt;</td><td>Specifies the type of predicate.</td></tr><tr><td>-v &lt;val&gt;</td><td>Specifies the value of predicate.</td></tr><tr><td>-n</td><td>Negation.</td></tr></tbody></table>\n    \n    Example output:\n    \n    > `[Expert@HostName:0]# fw sam_policy get   Get operation succeeded   operation=add uid=<5779372c,00000000,64291eac,00005530> target=all timeout=5622 action=notify log=log close= src_ip_addr=172.30.254.254 req_type=ip   operation=add uid=<5779378c,00000000,64291eac,00005584> target=all timeout=5884 action=notify log=log close= src_ip_addr=172.30.244.244 req_type=ip`\n    \n-   To read add/del SAM policy rules from standard input:\n    \n    _**\\[Expert@HostName:0\\]# fw \\[-d\\] sam\\_policy batch \\[-F <separator>\\]**_\n    \n    where:\n    \n    > <table><tbody><tr><td>Parameter</td><td>Description</td></tr><tr><td>-d</td><td>Enables debug mode for <em>fw</em> command. Writes to local <em>stderr</em>.</td></tr><tr><td>-F &lt;separator&gt;</td><td>Specifies the separator between command arguments.</td></tr></tbody></table>\n    \n\n**Notes:**\n\n-   SAM Policy rules (configured with _fw sam\\_policy_ command) are stored in the _**$FWDIR/database/sam\\_policy.db**_ file.\n    \n-   SAM Policy management file is _**$FWDIR/database/sam\\_policy.mng**_.\n    \n\n### (8) Kernel debug\n\nShow / Hide this section\n\nThe following kernel debug on the Security Gateway shows information about the enforcement of SAM rules (that were configured either in SmartView Monitor, or with _fw sam_ command):\n\n1.  Prepare:\n    \n    _\\[Expert@HostName:0\\]# fw ctl debug 0_  \n    _\\[Expert@HostName:0\\]# fw ctl debug -buf 32000_  \n    _\\[Expert@HostName:0\\]# fw ctl debug -m fw + sam conn drop_\n2.  Verify:\n    \n    _\\[Expert@HostName:0\\]# fw ctl debug -m fw_\n3.  Start:\n    \n    _\\[Expert@HostName:0\\]# fw ctl kdebug -T -f > /var/log/debug\\_sam.txt_\n4.  Replicate the issue.\n    \n5.  Stop:\n    \n    Press CTRL+C, and run  \n    _\\[Expert@HostName:0\\]# fw ctl debug 0_\n6.  Analyze:\n    \n    _/var/log/debug\\_sam.txt_\n\n## Article Properties\n\nOriginatorInocente Sandoval\n\nTechnical ResourceRobert Ruiz\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2016-06-27\n\nLast Modified2025-04-03\n\nEditorLiron Rubin\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only\n\n-   Per Eric Dale's request, all references to the \"quota\" keyword were removed from this SK. \n-   Per Tal Ben Avraham, the \"fw sam\" command will not be supported on Quantum Maestro and Scalable Chassis (02641733). \"fwaccel dos\" command should be used instead.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:11.297Z","annotations":[],"updated":"2025-05-06T22:59:10.887Z"},{"title":"CPView API Service Commands","id":"3c26fa27-3359-454e-a14f-1ab9f351aaaf","type":"TEXT","raw":"<table><tbody><tr><td><p><code>cpview</code></p></td></tr><tr><td><p><code>cpview --help</code></p></td></tr><tr><td><p><code>cpview --api_service {on | off | stat}</code></p></td></tr><tr><td><p><code>cpview --metric [--request_source &lt;Source&gt;] [--request_name &lt;Name&gt;] [--filter &lt;Filter&gt;]</code></p></td></tr><tr><td><p><code>cpview --print [--ignoreWarnings] [--showDesc] [--request_source &lt;Source&gt;] [--request_name &lt;Name&gt;] [--filter &lt;Filter&gt;]</code></p></td></tr><tr><td><p><code>cpview --services {on | off | stat | export}</code></p></td></tr><tr><td><p><code>cpview --history [&lt;Timestamp&gt;]</code></p></td></tr></tbody></table>\n\n<table id=\"Unique_ID_Syntax_R8200Table\"><tbody><tr><td>Command</td><td>Description</td></tr><tr><td><p><code>cpview</code></p></td><td><p>Opens the interactive tool interface.</p></td></tr><tr><td><p><code>cpview -h</code></p><p><code>cpview --help</code></p></td><td><p>Shows the built-in help and exits.</p></td></tr><tr><td><p><code>cpview -a {on | off | stat}</code></p><p><code>cpview --api_service {on | off | stat}</code></p></td><td><p>Administration of the CPView API service (to query the data with API):</p><ul><li><p><code>on</code> - Enables the CPView API service (this is the default)</p></li><li><p><code>off</code> - Disables the CPView API service</p></li><li><p><code>stat</code> - Shows the status of the CPView API service</p></li></ul><p>Example Output:</p><p><code>[Expert@R82:0]# cpview --api_service stat<br>CPView api service running<br>[Expert@R82:0]#</code></p><p>For information about the CPView API commands, see <a href=\"https://sc1.checkpoint.com/documents/latest/GaiaAPIs/index.html#introduction~v1.8%20\" target=\"_blank\" rel=\"noopener\">Gaia API Reference v1.8 (or higher)</a> &gt; Chapter \"Diagnostics\" &gt; Section \"CPView\".</p></td></tr><tr><td><p><code>cpview -m [-e &lt;Source&gt;] [-r &lt;Name&gt;] [-f &lt;Filter&gt;]</code></p><p><code>cpview --metric [--request_source &lt;Source&gt;] [--request_name &lt;Name&gt;] [--filter &lt;Filter&gt;]</code></p></td><td><p>Raw print mode (JSON).</p><p>Shows all CPView metrics one time, in the Metric format for Skyline Telemetry (<a href=\"https://support.checkpoint.com/results/sk/sk178566\" target=\"_blank\" rel=\"noopener\">sk178566</a>).</p><ul><li><p><code>cpview -m</code></p><p><code>cpview --metric</code></p><p>Shows all CPView metrics, in the Metric format for Skyline Telemetry.</p></li><li><p><code>cpview -m -e &lt;Source&gt;</code></p><p><code>cpview --metric --request_source &lt;Source&gt;</code></p><p>Shows CPView metrics only the specified sources, in the Metric format for Skyline Telemetry.</p></li><li><p><code>cpview -m -r &lt;Name&gt;</code></p><p><code>cpview --metric --request_name &lt;Name&gt;</code></p><p>For internal Check Point use only.</p>Shows CPView metrics only from the specified data producer, in the Metric format for Skyline Telemetry.<p>In the <code>$CPDIR/conf/cpview_api_service_conf.xml</code> file, refer to the values in the parameter \"<code>requests_name</code>\". Example values: <code>TP_ONLY</code>, <code>SDWAN_ONLY</code>, <code>SDWAN_AND_TP</code>.</p></li><li><p><code>cpview -m -f &lt;Filter&gt;</code></p><p><code>cpview --metric --filter &lt;Filter&gt;</code></p><p>Shows only the specified CPView metrics, in the Metric format for Skyline Telemetry.</p><p>You must specify the filter string that matches one of these - <strong>Metric ID</strong>, <strong>Statistics ID</strong>, or <strong>Internal Metric Label</strong>.</p><p>To specify several filter strings, separate them with commas without spaces (a maximum of 512 characters). You must enclose the filter strings in quotes - each filter string (<strong>\"String1\",\"String2\",...,\"StringN\"</strong>) or all filter strings together (<strong>\"String1,String2,...,StringN\"</strong>).<br>Example: <code>-f \"UM_STAT.UM_CPU.num_of_cores\",\"UM_STAT.UM_CPU.ds_status\"</code></p><ul><li><p><strong>Metric ID</strong></p><p>Refer to one of these:</p><ul><li><p>The \"<code>metric-id</code>\" value in the output of the \"<code>cpview -m</code>\" / \"<code>cpview --metric</code>\" command.</p></li><li><p>The <a href=\"https://sc1.checkpoint.com/documents/Appliances/Skyline/Default.htm\" target=\"_blank\" rel=\"noopener\">Skyline Administration Guide</a> &gt; Chapter \"<strong>Skyline Metrics Repository</strong>\" &gt; column \"<strong>Metric ID</strong>\".</p></li></ul><p><strong>Important</strong> - In front of the filter string that matches a Metric ID, you must add the prefix \"<strong>M:</strong>\".</p><p>Example Output - Formatted as pretty JSON:</p><pre>[Expert@R82:0]# cpview -m -f M:\"system.cpu.count\" | jq '.'\n{\n  \"metrics\": [\n    {\n      \"data\": [\n        {\n          \"value\": 4\n        }\n      ],\n      \"description\": \"The number of CPU cores on this machine.\",\n      \"metric-id\": \"system.cpu.count\",\n      \"metric-type\": \"Gauge\",\n      \"metric-unit\": \"{cpu}\",\n      \"metric-value-type\": \"double\"\n    }\n  ],\n  \"timestamp\": 1730744843\n}\n</pre></li><li><p><strong>Statistics ID</strong></p><p>Refer to the \"<code>stat-id</code>\" value in the output of the \"<code>cpview -p</code>\" / \"<code>cpview --print</code>\" command.</p><p>Example Output - Formatted as pretty JSON:</p><pre>[Expert@R82:0]# cpview -m -f \"UM_STAT.UM_CPU.num_of_cores\" | jq '.'\n{\n  \"metrics\": [\n    {\n      \"data\": [\n        {\n          \"value\": 4\n        }\n      ],\n      \"description\": \"The number of CPU cores on this machine.\",\n      \"metric-id\": \"system.cpu.count\",\n      \"metric-type\": \"Gauge\",\n      \"metric-unit\": \"{cpu}\",\n      \"metric-value-type\": \"double\"\n    }\n  ],\n  \"timestamp\": 1730737683\n}\n</pre></li><li><p><strong>Internal Metric Label</strong></p><p>In the <code>$CPDIR/conf/cpview_api_service_conf.xml</code> file, refer to the values of the \"<code>labels=</code>\" parameters.</p><p>Examples of Internal Metric Labels:</p><ul><li><p><code>labels=\"CPU,Dynamic_Split,OS,Configuration\"</code></p></li><li><p><code>labels=\"Hardware,Interfaces,Drops,Errors\"</code></p></li></ul><p>In the CLI syntax, you can use any of these labels - one or several:</p><ul><li><code>-f \"CPU\"</code></li><li><code>-f \"Dynamic_Split\"</code></li><li><code>-f \"CPU,Dynamic_Split\"</code></li><li><code>-f \"Drops,Errors\"</code></li><li>and so on</li></ul><p>Example Output - Formatted as pretty JSON:</p><pre>[Expert@R82:0]# cpview -m -f \"Dynamic_Split\" | jq '.'\n{\n  \"metrics\": [\n    {\n      \"data\": [\n        {\n          \"value\": 0\n        }\n      ],\n      \"description\": \"The state of the CoreXL Dynamic Balancing (On/Off).\",\n      \"metric-id\": \"system.cpu.dynamic_balancing.state\",\n      \"metric-type\": \"Gauge\",\n      \"metric-unit\": \"{state}\",\n      \"metric-value-type\": \"double\"\n    }\n  ],\n  \"timestamp\": 1730737802\n}\n[Expert@R82:0]#\n</pre></li></ul></li></ul></td></tr><tr><td><p><code>cpview -p [-i] [-d] [-f &lt;Filter&gt;]</code></p><p><code>cpview --print [--ignoreWarnings] [--showDesc] [--filter &lt;Filter&gt;]</code></p></td><td><p>Simple print mode (JSON).</p><p>Shows all CPView metrics one time.</p><ul><li><p><code>cpview -p</code></p><p><code>cpview --print</code></p><p>Shows all CPView metrics.</p></li><li><p><code>cpview -p -e &lt;Source&gt;</code></p><p><code>cpview --print --request_source &lt;Source&gt;</code></p><p>For internal Check Point use only.</p>Specifies the source/entity of the data request that is sent to Check Point Cloud.</li><li><p><code>cpview -p -r &lt;Name&gt;</code></p><p><code>cpview --print --request_name &lt;Name&gt;</code></p><p>Shows only the specified CPView requests.</p></li><li><p><code>cpview -p -i</code></p><p><code>cpview --print --ignoreWarnings</code></p><p>Reserved for future use.</p><p>Ignores warnings and continues to execute.</p></li><li><p><code>cpview -p -d</code></p><p><code>cpview --print --showDesc</code></p><p>Shows the additional \"<code>name</code>\" and \"<code>description</code>\" strings for each metric.</p></li><li><p><code>cpview -p -f &lt;Filter&gt;</code></p><p><code>cpview --print --filter &lt;Filter&gt;</code></p><p>Shows only the specified CPView metrics, together with the description, name, and type of each metric.</p><p>You must specify the filter string that matches one of these - <strong>Statistics ID</strong> or <strong>Internal Metric Label</strong>.</p><p>To specify several filter strings, separate them with commas without spaces (a maximum of 512 characters). You must enclose the filter strings in quotes - each filter string (<strong>\"String1\",\"String2\",...,\"StringN\"</strong>) or all filter strings together (<strong>\"String1,String2,...,StringN\"</strong>).<br>Example: <code>-f \"UM_STAT.UM_CPU.num_of_cores\",\"UM_STAT.UM_CPU.ds_status\"</code></p><ul><li><p><strong>Statistics ID</strong></p><p>Refer to the \"<code>stat-id</code>\" value in the output of the \"<code>cpview -p</code>\" / \"<code>cpview --print</code>\" command.</p><p>Example Output - Formatted as pretty JSON:</p><pre>[Expert@R82:0]# cpview -p -f \"UM_STAT.UM_CPU.num_of_cores\" | jq '.'\n{\n  \"next-cursor\": null,\n  \"data\": [\n    {\n      \"stat-id\": \"UM_STAT.UM_CPU.num_of_cores\",\n      \"records\": [\n        {\n          \"timestamp\": {\n            \"posix\": 1730729512,\n            \"iso-8601\": \"2024-11-04T16:11+0200\"\n          },\n          \"value\": 4\n        }\n      ]\n    }\n  ]\n}\n</pre></li><li><p><strong>Internal Metric Label</strong></p><p>In the <code>$CPDIR/conf/cpview_api_service_conf.xml</code> file, refer to the values of the \"<code>labels=</code>\" parameters.</p><p>Examples of Internal Metric Labels:</p><ul><li><p><code>labels=\"CPU,Dynamic_Split,OS,Configuration\"</code></p></li><li><p><code>labels=\"Hardware,Interfaces,Drops,Errors\"</code></p></li></ul><p>In the CLI syntax, you can use any of these labels - one label or several labels:</p><ul><li><code>-f \"CPU\"</code></li><li><code>-f \"Dynamic_Split\"</code></li><li><code>-f \"CPU,Dynamic_Split\"</code></li><li><code>-f \"Drops,Errors\"</code></li><li>and so on</li></ul><p>Example Output - Formatted as pretty JSON:</p><pre>[Expert@R82:0]# cpview -p -f \"Dynamic_Split\" | jq '.'\n{\n  \"next-cursor\": null,\n  \"data\": [\n    {\n      \"stat-id\": \"UM_STAT.UM_CPU.ds_status\",\n      \"records\": [\n        {\n          \"timestamp\": {\n            \"posix\": 1730736137,\n            \"iso-8601\": \"2024-11-04T18:02+0200\"\n          },\n          \"value\": \"Off\"\n        }\n      ]\n    }\n  ]\n}\n[Expert@R82:0]#\n</pre></li></ul></li></ul></td></tr><tr><td><p><code>cpview -s {on | off | stat}</code></p><p><code>cpview --services {on | off | stat}</code></p></td><td><p>Administration of the CPView services that are responsible for the Database and SNMP activity:</p><ul><li><p><code>on</code> - Enables the CPView services (this is the default)</p></li><li><p><code>off</code> - Disables the CPView services</p></li><li><p><code>stat</code> - Shows the status of the CPView services</p></li><li><p><code>export</code> - Exports the current CPView database</p></li></ul><p>Example Output:</p><p><code>[Expert@R82:0]# cpview --services stat<br>CPView services running<br>[Expert@R82:0]#</code></p></td></tr><tr><td><p><code>cpview -t [&lt;Timestamp&gt;]</code></p><p><code>cpview --history [&lt;Timestamp&gt;]</code></p></td><td><p>Shows the data in the History mode - either the oldest available data, or the data for the specified timestamp.</p><p>In CPview, press the \"<strong>t</strong>\" key and enter the applicable date and time.</p><p>The &lt;Timestamp&gt; format is:<br><code>[Jan...Dec] [01...31] [4-digit Year] [hh:mm:ss]</code></p><p>In versions R81.10 and higher, you can enter a partial date. For example: <code>Jan 02</code></p></td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:05.487Z","annotations":[],"updated":"2025-05-06T22:58:06.135Z"},{"title":"Anti-Bot Overview","id":"3a575aab-0d2d-4ad6-b0a6-263efa925d22","type":"TEXT","raw":"## **Table of Contents**\n\n-   Overview\n    \n-   ThreatSpect Engine and ThreatCloud Repository\n    \n    -   Reputation Layer\n        \n    -   Signatures Layer\n        \n    -   Suspicious Mail Outbreaks Layer\n        \n    -   Behavioral Patterns Layer\n        \n-   Connection Flow\n    \n-   Policy installation\n    \n-   Indicators\n    \n-   Troubleshooting and Debug\n    \n    -   General Debug\n        \n\n## Overview\n\n**Starting from R80, Anti-Bot and Anti-Virus Software Blades are part of Threat Prevention solution.**\n\nTo challenge today's malware landscape, Check Point's comprehensive Threat Prevention solution offers a multi-layered, pre- and post-infection defense approach and a consolidated platform that enables enterprise security to deal with modern malware:\n\n-   **Anti-Virus** - Pre-infection detection and blocking of malware at the gateway. The Anti-Virus Software Blade is continuously updated from ThreatCloud. It detects and blocks malware by correlating multiple detection engines before users are affected.\n-   **Anti-Bot** - Post-infection detection of bots on hosts. Prevents bot damages by blocking bot C&C (Command and Control) communications. The Anti-Bot Software Blade is continuously updated from ThreatCloud, a collaborative network to fight cybercrime. Anti-Bot discovers infections by correlating multiple detection methods.\n\n### Anti-Bot\n\nA _bot_ is malicious software that can invade your computer. There are many infection methods. These include opening attachments that exploit a vulnerability and accessing a web site that results in a malicious download.\n\nOne bot can often create multiple threats. Bots are frequently used as part of Advanced Persistent Threats (APTs) where cyber criminals try to damage individuals or organizations. The Anti-Bot Software Blade detects and prevents these bot and botnet threats. A botnet is a collection of compromised and infected computers.\n\nThe Anti-Bot Software Blade uses these procedures to identify bot infected computers:\n\n-   **Identify the C&C addresses used by criminals to control bots -** These web sites are constantly changing and new sites are added on an hourly basis. Bots can attempt to connect to thousands of potentially dangerous sites. It is a challenge to know which sites are legitimate and which are not.\n-   **Identify the communication patterns used by each botnet family -** These communication fingerprints are different for each family and can be used to identify a botnet family. Research is done for each botnet family to identify the unique language that it uses. There are thousands of existing different botnet families and new ones are constantly emerging.\n-   **Identify bot behavior -** Identify specified actions for a bot such as, when the computer sends spam or participates in DoS attacks.\n\n### Anti-Virus\n\n_Malware_ is a major threat to network operations that has become increasingly dangerous and sophisticated. Examples include worms, blended threats (combinations of malicious code and vulnerabilities for infection and dissemination) and Trojans.\n\nThe Anti-Virus Software Blade scans incoming and outgoing files to detect and prevent these threats. It also gives pre-infection protection from malware contained in these files.\n\nThe Anti-Virus Software Blade:\n\n-   Identifies malware in the organization using the ThreatSpect engine and ThreatCloud repository:\n    -   Prevents malware infections from incoming malicious files types (Word, Excel, PowerPoint, PDF, etc.) in real-time. Incoming files are classified on the gateway and the result is then sent to the ThreatCloud repository for comparison against known malicious files, with almost no impact on performance.\n    -   Prevents malware download from the internet by preventing access to sites that are known to be connected to malware. Accessed URLs are checked by the gateway's caching mechanisms or sent to the ThreatCloud repository to determine if they are permissible or not. If not, the attempt is stopped before any damage can take place.\n-   Uses the ThreatCloud repository to receive binary signature updates and query the repository for URL reputation and Anti-Virus classification.\n\n## ThreatSpect Engine and ThreatCloud Repository\n\nThe ThreatSpect engine is a unique multi-tiered engine that analyzes network traffic and correlates information across multiple layers to find bots and other malware. It combines information on remote operator hideouts, unique botnet (a collection of compromised computers) traffic patterns and behavior to identify thousands of different botnet families and outbreak types.\n\n## Reputation Layer\n\nAnalyzes the reputation of URLs, IP addresses and external domains that computers in the organization access. The engine searches for the known or suspicious activity, such as Command and Control (C&C).\n\nThe Reputation layer classifies per connection:\n\n-   IP address - from handle first packet before security rule base. Only in kernel, not in the cloud.\n-   DNS - host from DNS request (for both TCP and UDP)\n-   URL - complete URL from the HTTP request\n\nAfter the discovery of bot infected machines, the Anti-Bot Software Blade blocks outbound communication to C&C sites based on the Rule Base.\n\nThis classification has 3 stages:\n\n1.  First, every URL is searched in the local database, located in _$FWDIR/conf/urlrep.eng_ file that contains some malware data - commonly used signatures, URLs, and their related reputations.  \n    Local database is loaded to the kernel, and compiled to one Pattern Matcher (PM) that is executed on the incoming URLs to find a match.  \n    If the URL is found there, a response to the client is returned.  \n    If there is no match against local database, continue to next Step.\n2.  RAD (Resource ADvisor) cache (for DNS and URL only), that gives answers to 99% of URL reputation requests.\n3.  RAD (Resource ADvisor) service in the cloud (for DNS and URL only)\n\nIf the URL was not found in the cache, a request is sent out to RAD and a response is returned (asynchrony) back to the client, and the relevant data is kept in the cache.\n\nAnti-Bot Resource Classification mode for DNS is overridden to \"background\" on the Security Gateway. These settings override the existing default settings in the SmartDashboard.\n\nThe Resource Classification settings for Anti-Bot are now configurable from the Security Gateway using the _malware\\_config_ file.\n\nUsing the Security Gateway configuration file provides more granularity and divide classification to DNS, HTTP and SMTP.\n\nThere are three values for each option:\n\n-   **hold** - for hold classification\n-   **bg** - for background classification\n-   **policy** - for classification according to Security policy\n\nThe default values for HTTP and SMTP is policy, but for DNS the default is now _background_.\n\n**Reputation tables**\n\n-   _fw tab -t malware\\_cache\\_tbl_ - holds hostnames with relevant metadata on the threats related to this host and it sub-domains\n-   _fw tab -t malware\\_map\\_tbl_ - Map between first level domain (FLDs) to sub-domains that were surfed through that gateway\n\nReputation tables format:\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk92264/Reputation-tables.png)\n\n-   **PM** - Pattern Matcher\n-   **AU1** - meaning that the host and ALL its sub-domains are malicious (the metadata of the malware will be kept in the table).\n-   **GRAY record** - meaning that there are paths of this host/sub-domains which are malicious. The related malicious URLs (patterns) are compiled to PM (pattern matcher). Then, the requested URL is executed on the PM. If there is a match, then the URL is malicious (and the metadata of the matched pattern will be returned to the client), otherwise, the URL is white.\n\n**Reputation Debug** \n\nRun the following debug on the Security gateway when Reputation fails. For example, when getting \"_service error_\" log or \"_cannot connect to cloud_\" or when Reputation test page cannot be displayed.\n\n**Reputation Troubleshooting**\n\n<table><tbody><tr><td>Issue</td><td>Troubleshooting</td></tr><tr><td>How to know if the host was found in the local database?</td><td><p>In <em>fw_malware_debug.txt</em> file search for \"<em>malware_res_rep_pm_match_cb</em>\".<br>If found - there was a match on the PM of the local database</p></td></tr><tr><td>How to know if the host is in the cache?</td><td>In <em>rad_debug.txt</em> file search for \"<em>rad_kernel_malware_cache_get: key was found in cache - requested_url: , requested_url_len: ...</em>\"</td></tr><tr><td>How to know if the host in the cache is good or malicious?</td><td><p>In the <em>rad_debug.txt</em> file:</p><ul><li>If you see: \"<em>malware_prepare_response: preparing white response</em>\" - this is a good (white) host</li><li>If you see: \"<em>malware_prepare_response: preparing AU1 response</em>\" - this is a malicious host</li><li>If you see: \"<em>rad_kernel_malware_pattern_metadata_arr_fill_from_match: total_matches after pm execution</em>: &lt;X&gt; \" and if (X != 0) - this is a malicious host, otherwise it is white.</li></ul></td></tr><tr><td>How to know if the host was sent to RAD?</td><td><p>In <em>rad_debug.txt</em> file search for \"<em>rad_kernel_malware_cache_get: key was not found in cache</em> - <em>requested_url: &lt;requested url&gt;, requested_url_len: &lt;url length&gt;</em> ....\"</p></td></tr><tr><td>How to know if RAD response is good or malicious?</td><td><p>In rad_debug.txt file search for \"<em>rad_kernel_malware_pattern_metadata_arr_deserialize: _this-&gt;patterns_count =&lt;X&gt;.</em>..\" (that appears a bit after \"<em>rad_kernel_malware_response_kernel_deserialize</em>\")<br>If the number of patterns <em>(X) != 0</em> - then the host is malicious. Otherwise it's white.</p></td></tr><tr><td>Why do I have the map table?</td><td><p>The map table is used for mapping between the first level domain (FLD) to its sub-domains. The key in this table is the FLD, and its value is a list of sub-domains under that domain that were surfed from the gateway. This table is used by the security service.</p></td></tr><tr><td>What to do if there is no response?</td><td><ol><li>Verify that Anti-Malware blade is enabled.</li><li>Check proxy and DNS are configured.</li><li>Check that you have connectivity from the gateway to RAD</li><li>Make sure the tables are on <em>fw tab -t &lt;table name&gt;</em> - does not return \"<em>Table &lt;table name&gt; not loaded: Invalid argument)</em>\"</li><li>Open debug files, search for <em>[ERROR]</em></li></ol></td></tr></tbody></table>\n\n##   \nSignatures Layer\n\nDetects threats by identifying unique patterns in files or in the network by using the CMI infrastructure. Local database is located in the _$FWDIR/conf/malware.eng_ file and points to a package fetched in the update process.\n\nSignature example:\n\n_ctx: 147 ; 'data: \"/za/images/threatwiki/pages/TestAntiBotBlade.html\", nocase;data: \"checkpoint.com\", nocase, part:headers;' {name: \"CheckPoint - Testing Bot\"; type: \"Trojan\" ; family\\_name: \"CheckPoint\"; enf: 1; confidence: 3; perf: 1; severity: 3; protection\\_type: \"Home\"; stream: 0; act\\_type: 2; limitations: none}_\n\n**  \nSignatures Debug:**\n\nRun the following debug on the Security gateway:\n\n##   \nSuspicious Mail Outbreaks Layer\n\nDetects infected machines in the organization based on analysis of outgoing mail traffic. The Suspicious Mail Outbreaks layer requires an Anti-Spam License and supported in inspect (detect) mode only.\n\n**  \nSuspicious Mail Outbreaks Flow**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk92264/Suspicious-Mail-Outbreaks-Flow2.png)\n\n-   When new connection arrives to kernel, some part of email (in kbytes) is trapped to User mode daemon by_msd_ - mail security daemon\n-   The _msd_ process asks the Commtouch engine for reputation by using _ct_ process _ctasd_\n-   The Commtouch (_ct_) process checks its cache and if necessary, classifies using service in the cloud\n\n**Debug**\n\nRun the following debug on the Security gateway:\n\n## Behavioral Patterns Layer\n\nAnti-Bot engine. Detects unique patterns that indicate the presence of a bot.  \nFor example, how a C&C communicates with a bot-infected machine, when the computer sends spam or participates in DoS attacks.\n\n##   \nConnection Flow\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk92264/connection-flow2.png)\n\n1.  On new connection arrival, in the first packet, before the Security rulebase:  \n    \\- Malware rulebase matches a profile for Anti-Bot and Anti-Virus  \n    \\- IP is classified by reputation IP address\n2.  The streaming I/S passes the data to the relevant parsers (HTTP, SMTP, etc.)\n3.  The parsers call for CMI server  \n    \\- Pattern Matcher execution  \n    \\- Notifies the relevant engine / blade\n\nUpon engine detection, the Malware rulebase is hierarchically matched (to check if the detected protection is in exception)\n\n**Connection Debug in kernel**\n\n## Policy installation\n\n**Policy Model**\n\nThe Anti-Bot and Anti-Virus policy determines how the system inspects connections for bots and viruses. The primary component of the policy is the Rule Base. The rules use the Malware database and network objects.  \nThe Blades are integrated with Rule Base. Each rule references to set of configuration - profile, which the connection will be inspected / enforced (by Anti-Bot & Anti-Virus) accordingly.\n\n1.  Granular Policy - multiple profile support per gateway, a profile can be assigned to multiple rules\n2.  Cloud based - the threats / protections in SmartConsole are shown directly from the cloud\n3.  Separate policy installation - quickly completed and does not affect Security policy\n\n  \nMalware database is located in _$FWDIR/conf/install\\_manager\\_tmp/ANTIMALWARE/conf/_ directory on the Security Management server.\n\nMatching malware rule base is done on the first packet handling and saved in the _mal\\_conns_ table.  \nThis table limit is 25,000.\n\nRun the \"_fw tab -t mal\\_conns_\" command to see its content.\n\nAfter compilation the compiled policy is transferred to _$FWDIR/state/\\_\\_tmp/AMW/_ directory.\n\nIf the policy installation is completed successfully, the files are copied to _$FWDIR/state/local/AMW/< current policy directory>_.\n\nMalware database is asynchronously loaded after separate policy installation is completed. Any failure will be logged, and the status can be monitored in the overview page.\n\n**Rule Base Debug**\n\n_fw ctl debug 0  \nfw ctl debug -buf 32000  \nfw ctl debug -m NRB all  \nfw ctl debug -m fw + malware (_since R80: _fw ctl debug -m MALWARE + all)  \nfw ctl kdebug -T -f > /var/log/debug.txt_\n\n**Debug of Policy installation**\n\n**Note**: For better results, run both user mode debugs at the same time.\n\n## Indicators \n\n**Threat Indicators** lets you add feeds to the Anti-Bot and Anti-Virus engines, in addition to the feeds included in the Check Point packages and ThreatCloud feeds.\n\nAn Indicator is a set of observables which represent a malicious activity in an operational cyber domain, with relevant information on how to interpret it and how to handle it. This feature is available since [R77.20 Security Management Add-On](https://support.checkpoint.com/results/sk/sk101217).\n\n**Starting with R80.30, see the [Threat Prevention Administration Guide](https://support.checkpoint.com/product/417#f-commonsource=C.%20Documentation) for the relevant version.**\n\n**For lower versions, read below**\n\n**IOC** - Indicators Of Compromise.\n\nIOC Compromise convey an attack campaign by:\n\n-   specific observable patterns\n-   additional information intended to represent artifacts & behaviors of interest within a cyber-security context\n\n**Observable** - is an event or a stateful property that can be observed in an operational cyber domain. For example: IP address, MD5 file signature, URL, Mail sender address.\n\nIndicators are derived from intelligence, self analysis and/or governments, partners etc.\n\nThe goal of Indicator is to give an ability to add private feed into Anti-Virus and Anti-Bot engines, besides Check Point packages update and ThreatCloud feed. It also assist the customers with the operational and engineering management challenges they face handling indicators: Managing, implementing, exchanging and auditing.\n\n### Requirements\n\n-   Local - the indicators remain only in user's premise\n-   Each indicator is a file with the following information:\n    -   Metadata\n    -   List of observables and their metadata\n-   Automatic way to add a huge amount of files\n-   Types are - MD5s and addresses (domains, URLs, IPs)\n-   No suppression based on collaboration information (e.g. collaboration with white files)\n-   Up to 260K observables\n-   Action of observable is retrieved from the metadata, profile and policy, just as for the DB of protection of Anti-Malware\n\n### Indicator File Format\n\nEach indicator file can be either in CSV or STIX XML format and contain records of equal size.\n\n**CSV (\\*.csv) format**\n\n-   Delimiter between fields is ','\n-   Delimiter between records is '\\\\n'\n-   Fields are plain text\n-   Each record \"must\" contain the same number of comma-separated fields\n-   Quoted fields are accepted.\n-   The first line/record, prefixed with ‘#’, is a header containing column names in each of the fields.\n\n**STIX - Structured Threat Information eXpression**\n\nSTIX™ is a collaborative community-driven effort to define and develop a standardized language to represent structured cyber threat information.  \nFor more information, refer to [STIX 1.x Archive Website](https://stixproject.github.io/).\n\n### **Configuration in SmartConsole**\n\n1.  User adds his indicator file which can be either .CSV file or STIX formatted file. Refer to [Threat Prevention Administration Guide](https://support.checkpoint.com/product/417#f-commonsource=C.%20Documentation) for more information regarding creation of these files and examples.  \n    To load Indicators, go to Security Policies -> Threat Prevention -> Policy ->Threat Tools -> Indicators \n2.  SmartConsole does the basic validation for this file, for example it checks that the file is not empty and that CSV file is in the expected format.  \n    For example, if an optional field is empty, the default value is used. If a mandatory field is empty, the Indicator file will not load.\n3.  When uploading a file to SmartConsole, an XML file is generated for displaying purposes only.\n4.  Security Management server gives an unique UUID for each Indicator file in the system.\n    \n    Example from R80.20:\n    \n    ![](https://sc1.checkpoint.com/sc//SolutionsStatics/sk92264/Indicator-r80201901270627.png)\n    \n    Example from R77:30:\n    \n    ![](https://sc1.checkpoint.com/sc//SolutionsStatics/sk92264/Indicator1708270204.png)\n    \n\n**  \nCode Generation**\n\n1.  Prepares IOC metadata as a new _fwset_ object called \"indicators\". This set contains each indicator's filename, SDB name, uuid, etc.\n2.  Creates a zip file with all the indicator files themselves. \n\n### Limitations\n\n-   Observables of IP addresses and IP Ranges can hold IPv4 values only.\n-   MD5 observables cannot be enforced by Anti-Bot Blade. They automatically change to be Anti-Virus observables. If user does not own Anti-Virus blade, there is no enforcement.\n\n### Commands Examples\n\nYou can run these commands from the CLI (Command Line Interface):\n\n`load_indicators --add -a prevent -i CIB-20140210-01.csv --policy Standard`\n\n`load_indicators --delete --indc-files -i CIB-20140210-01.csv --policy Standard -f`\n\n`Stix_Converter.exe <input_file> <output_file> <error_file>`\n\n`Indicator_Parser.exe -i Appendix_E_MD5s.xml -o output.csv -pid 18446744069414584321`\n\n###   \nDebugging\n\n**Debug via SmartConsole**\n\nTo **_debug an import of Idicator file_** via SmartConsole, run the following commands from the command line where SmartConsole is installed, under _PROGRAM\\\\util\\\\_ directory:\n\n```\nC:\\Program Files (x86)\\CheckPoint\\SmartConsole\\R77.20\\PROGRAM\\util&gt; <br> &gt; set TDERROR_ALL_IOC=5 <br> &gt; Indicator_Parser.exe -i  -o out.xml –pid 18446744069414584321 &gt; sdb_debug.txt 2&gt;&amp;1 <br> &gt; set TDERROR_ALL_IOC=\n```\n\n**Debug via CLI (Command Line Interface)**\n\nTo debug an import/deletion of Indicator file via CLI, run the following commands from the Security Management machine:\n\n```\n&gt; export TDERROR_ALL_IOC=5 <br>&gt; load_indicators  -i  &gt;&amp; cli_debug.txt <br>&gt; unset TDERROR_ALL_IOC\n```\n\nFor example: _load\\_indicators --add -a prevent -i indicator.csv >& cli\\_debug.txt_\n\n## Troubleshooting and Debug\n\n**Check Point ThreatWiki**\n\nThe ThreatWiki is an easy to use tool that lets you search and filter Check Point's Malware Database. Filter by a category, type or risk level and search for a keyword or malware.\n\n-   For versions R80 and above, this tool is available at this [online Web page](https://threatwiki.checkpoint.com/threatwiki/public.htm). This link is also located in the SmartConsole:\n    \n    ![](https://sc1.checkpoint.com/sc//SolutionsStatics/sk92264/ThreatWiki1901270412.png)\n    \n\n-   In versions R77.30 and lower, ThreatWiki is available in the SmartDashboard in Threat Prevention/Threat Wiki:\n    \n    ![](https://sc1.checkpoint.com/sc//SolutionsStatics/sk92264/ThreatWiki.png)\n    \n\n### General Debug\n\n**Policy Installation Debug - Security Management side**\n\n-   **Conversion debug**\n    \n    _\\# export INTERNAL\\_POLICY\\_LOADING=1_ (‘fwm’ command is deprecated in R80. This export will enable it)  \n    _\\# fwm -d load -p threatprevention <policy\\_name> <targets> >& <debug\\_file>_  \n    _\\# unset INTERNAL\\_POLICY\\_LOADING_\n    \n-   **Code generation debug**\n    \n    _\\# export LINKS\\_C\\_DIR=0_  \n    _\\# export TDERROR\\_ALL\\_ALL=5_  \n    _\\# amw\\_loader -d load -p <policy\\_name> -d $FWDIR/conf/install\\_manager\\_tmp/ANTIMALWARE/conf/ <target> >& <debug\\_file>_  \n    _\\# unset LINKS\\_C\\_DIR_  \n    _\\# unset TDERROR\\_ALL\\_ALL_\n    \n    **Note**: on MDS environment, use 'setenv' command prior to debugs\n    \n\n  \n**Policy Installation Debug - Security Gateway side** \n\n-   **User mode debug**_\\# TDERROR\\_ALL\\_MALWARE=5 fw -d amw fetchlocal >& <debug\\_file>_Run the following debug on the Security gateway when policy installation fails with \"_Load on module failed_\" error:\n    \n    _\\# TDERROR\\_ALL\\_MALWARE=5 fw -d amw –d fetchlocal –d $FWDIR/state/\\_\\_tmp/AMW/ >& <debug\\_file>_\n    \n-   If the User mode debug shows no errors, the failure is probably in the kernel prepare/commit phases.\n    \n    **Kernel mode debug**\n    \n    _\\# fw ctl debug 0_  \n    _# fw ctl zdebug + malware >& <debug\\_file>_\n    \n-   **Runtime debug**\n    \n    _\\# fw ctl zdebug + malware >&_\n    \n\n___\n\nFor additional information refer to\n\n-   [Threat Prevention Administration Guide](https://support.checkpoint.com/product/417#f-commonsource=C.%20Documentation) for the relevant version\n-   [sk92515 - How to configure Threat Prevention Exceptions in R77.30 and lower](http://supportcontent.checkpoint.com/solutions?id=sk92515)[](http://www.checkpoint.com/products/anti-bot-software-blade/)","language":"md","time":"14 days ago","created":"2025-05-06T22:55:59.678Z","annotations":[],"updated":"2025-05-06T22:57:33.110Z"},{"title":"Error Message for IPSec Security Association Negotiation","id":"ccb81b23-119b-4c89-83ba-5bc46792bd58","type":"TEXT","raw":"## \"No valid SA\"\n\n**The Error message indicates a failure in the IPSec Security Association negotiations process: specifically a function timeout occurred. The two most common causes of function timeouts are:**\n\n-   A packet needs to be encrypted, but a new IPSec SA needed for its encryption could not be created.\n-   A packet needs to be decrypted, but the IPSec SA matching the SPI on the packet does not exist.\n\nDuring IKE Quick Mode Exchange, the VPN daemon negotiates IPSec Security Associations (SAs) with the VPN partner site. If negotiations fail and the exchange does not complete, the VPN daemon has no IPSec SAs to send to the firewall kernel. The firewall daemon expires the running VPN's state tables entries or does not start a new VPN, since it did not receive the updated IPSec SAs. The expiration triggers this error message.\n\n**The message indicates the SAs expired, but does not indicate the root cause of the problem. Other SmartView Tracker messages, before or after the \"sk19423 Error\", provide more information about the issue.**\n\nFor a more comprehensive discussion, see [sk19423: Error: \"Packet is dropped because there is no valid SA - please refer to solution sk19423 in SecureKnowledge Database for more information\"](http://supportcontent.checkpoint.com/solutions?id=sk19423).\n\n## Various Scenarios\n\nThere are quite a number of scenarios, in which you may encounter the \"No valid SA\" error. The scenarios that we have encountered and dealt with are detailed below.\n\n## Scenario 1\n\n**Title: _Error: \"Packet is dropped because there is no valid SA - please refer to solution sk19423 in SecureKnowledge Database for more information\"_**\n\n**Product:** Security Gateway\n\n**OS:** SecurePlatform\n\n**Symptoms:**\n\n-   Error in SmartView Tracker: \"Packet is dropped because there is no valid SA - please refer to solution sk19423 in SecureKnowledge Database for more information\".\n\n**Summary:** The message indicates the SAs expired, but does not indicate the root cause of the problem. Other SmartView Tracker messages, before or after the \"sk19423 Error\", provide more information about the issue. This article discusses troubleshooting encryption errors that spawn the sk19423 message in various configurations.\n\nSee [sk19423: Error: \"Packet is dropped because there is no valid SA - please refer to solution sk19423 in SecureKnowledge Database for more information\"](http://supportcontent.checkpoint.com/solutions?id=sk19423).\n\n___\n\n## Scenario 2\n\n**Title: _\"No valid SA\" logs in SmartView Tracker when creating IPsec VPN tunnel with an interoperable device._**\n\n**Product:** Security Gateway\n\n**OS:** All\n\n**Symptoms:**\n\n-   \"No valid SA\" logs in SmartView Tracker when creating IPsec VPN tunnel with an interoperable device.\n\n**Summary:** The nature of this problem is due to the ability of the Check Point Security Gateway to dynamically supernet subnets to reduce the amount of SA overhead normally generated by VPN traffic. Most third party vendors are inherently static and therefore do not have the ability to understand this dynamic behaviour. There are currently three possible solutions to this problem.\n\nSee _Scenario 1_ in [sk108600 - VPN Site-to-Site with 3rd party](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk108600#Scenario%201).\n\n___\n\n## Scenario 3\n\n**Title: _Site-to-site VPN tunnel fails with various error messages_**\n\n**Product:** Security Gateway\n\n**OS:** SecurePlatform, Windows\n\n**Symptoms:**\n\n-   Site-to-site VPN tunnel with 3rd party vendor fails with one or more errors in SmartView Tracker:\n-   Error: \"Encryption failure: packet is dropped as there is no valid SA\"\n\n-   Error: \"No valid SA\"\n-   -   `Error: \"Encryption failure: No response from peer\"`\n    -   `Error: \"No proposal chosen\"   `\n-   \"`Invalid ID information`\" error in SmartView Tracker when the Security Gateway initiates a Quick Mode.\n-   VPN tunnel can be initiated from one side to the other but no return traffic is seen.\n-   TCPdump on the external interface shows that UDP traffic on port 500 enters the Security Gateway, but is not routed past the Security Gateway.\n-   VPN tunnel becomes unstable after an '`IKE: Send Delete`' packet was sent.\n\n**Summary:** Phase-two Quick Mode failure occurs due to configuration/misconfiguration of VPN/encryption domain for firewalls involved in Site-to-Site VPN tunnels. Typically, this occurs when VPN domain group contains either numerous networks, or numerous hosts from different consecutive networks along with network objects. This article discusses troubleshooting the supernetting issue.\n\nSee _Scenario 1_ in [sk108600 - VPN Site-to-Site with 3rd party](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk108600#Scenario%201).\n\n___\n\n## Scenario 4\n\n**Title:** _VPN between Check Point Security Gateway and Cisco PIX fails: \"No valid SA\"_\n\n**Product:** Security Gateway\n\n**OS:** SecurePlatform\n\n**Symptoms:**\n\n-   Error: \"Packet is dropped because there is no valid SA - please refer to solution sk19423 in SecureKnowledge Database for more information\".\n-   VPN between Check Point Security Gateway and Cisco PIX fails.\n-   SmartView Tracker may display the following error messages:\n    -   Error: \"Encryption failure: packet is dropped as there is no valid SA\"\n    -   Error: \"No valid SA\"\n    -   Error: \"Encryption failure: No response from peer\"\n    -   Error: \"No proposal chosen\"\n\n**Summary:** VPN between Check Point Security Gateway and Cisco PIX may fail because Cisco Tunnel Sharing is configured for host based VPN, while Check Point Tunnel Sharing is usually configured for network based VPN.\n\nVPN between Check Point Security Gateway and Cisco PIX may also fail due to a mismatch in the settings between the two devices. For instance, if the Check Point Security Gateway proposes a network of 192.168.1.X/24, but the Cisco Access list is setup for traffic from 192.168.X.X/16, the connection will fail.\n\nSee Scenario 3 in [sk112054: Troubleshooting the \"Encryption failure: no response from peer\" error](http://supportcontent.checkpoint.com/solutions?id=sk112054).\n\n___\n\n## Scenario 5\n\n**Title: _Why do packets get dropped in IPSO cluster with error \"Packet is dropped because there is no valid SA\"_  \n**\n\n**Product:** Security Gateway\n\n**OS:** IPSO\n\n**Symptoms:**\n\n-   When running SecureClient / SecuRemote connections to Nokia IPSO 3.7 and Check Point cluster, the connection is properly established, but some servers in the encryption domain cannot always be accessed. The log shows packets being dropped with the following error message: encryption fail reason: \"Packet is dropped because there is no valid SA - please refer to solution sk19423 in Secureknowledge database for more information.\"\n\n**Summary:** In the IPSO and Check Point cluster environment, there can be a Quick Mode SA initiated also **from the cluster side** to the SecureClient station and not just from the client side to the cluster. Even though there is already an active IPSec SA, established by the client, the Check Point cluster sometimes wants to establish its own, corresponding IPSec SA. The SA is initiated when a return packet is handled by another cluster member than the one that handled the initial client IKE connection. \n\nIf the SA negotiation initiated from the cluster side fails for some reason, a situation can arise where part of the connections to the encryption domain work properly, but part of the connections fail. In this case, the logs show packets being dropped with the above error message.\n\nSee [sk40187: Why do packets get dropped in IPSO cluster with error \"Packet is dropped because there is no valid SA\"](http://supportcontent.checkpoint.com/solutions?id=sk40187).\n\n___\n\n## Scenario 6\n\n**Title: _Error: \"Encryption failure: Both endpoints are in the encryption domain\"_**\n\n**Product:** Security Gateway\n\n**Symptoms:**\n\n-   VPN rule result is \"Accept\" instead of \"Encrypt\", followed by error: \"Both end points are in the encryption domain\".\n-   Error: \"Encryption fail reason: Packet is dropped because there is no valid SA - please refer to solution sk19423 in SecureKnowledge Database for more information\"\n\n**Cause:  \n**\n\nTwo possible causes are:\n\n-   In VPN-1 Power/UTM NGX and above, the Security Gateway's interface is automatically included in its Encryption Domain.\n-   If user uses Virtual Interfaces on the Security Gateway, these Virtual Interfaces are also included in the Security Gateway's Encryption Domain, even though they were not explicitly defined as part of the Encryption Domain.\n\n**Solution:**\n\n Remove overlapping Encryption Domains, or any Virtual Interface IP Addresses of the Security Gateway that could result in a conflict.\n\n___\n\n## Scenario 7\n\n**Title: _Cannot Establish Site-to-Site VPN Between Managed UTM-1 Edge Devices_**\n\n**Product:** Edge\n\n**Symptoms:**\n\n-   Cannot establish site-to-site VPN between two UTM-1 Edge appliances managed by the same Security Management Server.\n-   SmartView Tracker shows VPN traffic between sites as dropped due to no valid SA.\n-   IKE debugs contain the error \"FW\\_SECUREMOTE\\_NOTIFICATION: Could not agree on common methods. Check that the user is properly defined.\"\n-   Unable to manage device from SmartDashboard.\n\n**Cause:** The appliances have lost their connection to the Service Center (Security Management Server).\n\n**Solution:**\n\nRe-connect the UTM-1 Edge appliances to the Service Center.\n\n___\n\n## Scenario 8\n\n**Title: _VPN packets dropped with \"no valid SA\" error, when CoreXL enabled in VPN over a VPN configuration_**\n\n**Product:** CoreXL\n\n**OS:** SecurePlatform 2.6, IPSO 6.2\n\n**Symptoms:**\n\n-   VPN packets are dropped with \"no valid SA\" error, when CoreXL is enabled in VPN over a VPN configuration.\n\n**Cause:** CoreXL is incorrectly passing the decrypted VPN packet to a separate gateway causing the firewall to decide that it should decrypt the second VPN packet.\n\n**Solution:**\n\n[Contact Check Point Support](http://www.checkpoint.com/services/contact/index.html) to get a Hotfix for this issue.  \nA Support Engineer will make sure the Hotfix is compatible with your environment before providing the Hotfix.\n\n___\n\n## Scenario 9\n\n**Title: _iPhone L2TP connections fail in LS Cluster environment_**\n\n**Product:** Security Gateway\n\n**Version:** NGX R65\n\n**OS:** Linux, SecurePlatform, SecurePlatform 2.6, Windows\n\n**Symptoms:**\n\n-   iPhone (with R65 HFA\\_50) L2TP connections fail in LS Cluster environment.\n-   Various generic error messages are \"Main Mode Sent Notification to Peer: payload malformed - possibly a mismatch in pre-shared keys\" and \"No valid SA\"\n\n**Cause:** NGX R65 HFA\\_50 has a bug that breaks L2TP connections.\n\n**Solution:**\n\niPhone L2TP connections do work in NGX R65 HFA\\_40.\n\nPlease upgrade the firewall to R70 or Higher. A fix should be incorporated in these releases.\n\nPlease also note you may also have to upgrade the Management server to the same version or higher. Check Point does not support having the firewall at a higher level than the Management server.\n\n___","language":"md","time":"14 days ago","created":"2025-05-06T22:56:02.180Z","annotations":[],"updated":"2025-05-06T22:57:48.803Z"},{"title":"IPS Update Troubleshooting","id":"2d5eafeb-614b-4cb0-9a2c-728ebdd4e38e","type":"TEXT","raw":"ProductIPS\n\nVersionR80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nOSGaia, Windows\n\nLast Modified2025-03-02\n\n## Solution\n\n## How to troubleshoot IPS update \\[scheduled and manual\\] issues\n\nIf IPS update fails, the user needs to understand what kind of update is being performed, as troubleshooting steps are different for various kinds of update.\n\n### _For manual IPS update issues_\n\n**The client (Windows PC that runs SmartDashboard) is the one that initiates the connection towards the Check Point updates servers, and most troubleshooting has to be performed on the client PC.**\n\nIn both cases (**scheduled and manual**), the following update server URLs should be reachable by DNS, HTTP and HTTPS (for example can be opened on a normal web browser, e.g. Google Chrome or Internet Explorer).\n\nOpen the browser on the client that is performing the IPS manual update, and verify connectivity to:\n\n-   [http://cws.checkpoint.com](http://cws.checkpoint.com/)\n-   [https://updates.checkpoint.com](https://updates.checkpoint.com/)\n-   [http://dl3.checkpoint.com](https://dl3.checkpoint.com/)\n-   [https://secureupdates.checkpoint.com](https://secureupdates.checkpoint.com/)\n\n**Notes:** \n\n-   You might get a redirect to a page, a page with the words \"It works!\" or \"File not found.\" \n-   A blank page indicates an issue.\n\nIf there is no connectivity to the above servers, the issue is on the client connectivity side. For example; a proxy issue, routing issue, etc.\n\n**If there is connectivity (with or without proxy);**\n\n1.  If the update is stuck at 99%, please refer to article [sk111760](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk111760).\n2.  Verify if HTTPS Inspection is enabled and if \"Bypass HTTPS inspection of traffic to well-known software update services\" is enabled\" per article [sk98655](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98655).\n3.  If the update won't start at all, and fails, please collect the following information:  \n    1.  Debug SmartConsole GUI client as per article [sk112334](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk112334).\n    2.  Download [WireShark](https://www.wireshark.org/download.html) and install it on the client PC, collect a traffic capture file during the IPS manual update issue being replicated.\n    3.  Provide the output files from SmartConsole debug and traffic capture to [Check Point Support](http://www.checkpoint.com/services/contact/index.html).\n\n  \n\n1.  Collect the following debugs:\n    1.   FWM debug form the Management server during IPS update:  \n        \\# fw debug fwm on TDERROR\\_ALL\\_FWMAU=5  \n        \\# fw debug fwm on TDERROR\\_ALL\\_FDT=5  \n        \\# tail -F $FWDIR/log/fwm.elg > /var/tmp/IPSfwmupdate.txt\n        \n        To disable fwm debug run:  \n        #fw debug fwm off TDERROR\\_ALL\\_ALL=0\n        \n    2.  FWD debug from the Gateway during the IPS update:  \n        \\# fw\\_debug fwd on TDERROR\\_ALL\\_ALL=5 \n        \n        \\# tail -F $FWDIR/log/fwd.elg > /var/tmp/IPSfwdupdate.txt\n        \n          \n        To turn off:  \n        \\# fw\\_debug fwd off\n    3.  After replication and debug collect files from:\n        1.  GW - /var/tmp/IPSfwdupdate.txt\n        2.  MGMT - /var/tmp/IPSfwmupdate.txt\n\n1.  If any other symptom, [contact Check Point Support](http://www.checkpoint.com/services/contact/index.html) for additional troubleshooting.\n\n### _For scheduled IPS update issues_\n\n**The Security Management Server / Multi Domain Management Server (the Management or the relevant CMA) is the initiator of the connection towards Check Point updates servers, and most troubleshooting has to be performed on it.**\n\n1.  Since the IP addresses of the update servers are changed according to geo-location, and are very dynamic, make sure that the _/etc/hosts_ file under the Security Management Server does not contain any manual entry for the below servers:\n    -   cws.checkpoint.com\n    -   secureupdates.checkpoint.com\n    -   updates.checkpoint.com\n    -   dl3.checkpoint.com\n\n  \n\n1.  Review article [sk98781](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98781) and make sure that the checkbox for \"Automatically download Contracts and other important data\" is selected. If it is not selected, do so, and install the policy. Then try the update again.\n2.  Verify if HTTPS Inspection is enabled and if \"Bypass HTTPS inspection of traffic to well-known software update services\" is enabled\" per article [sk98655](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98655).\n3.  Verify that the Security Management Server can reach and resolve the servers, as follows:\n    \n    1.  If the Security Management Server is not using proxy, use:\n        \n        _\\# nslookup cws.checkpoint.com_\n        \n        Repeat the command for all servers and verify that there is an IP reply.\n        \n        Verify that the Security Management Server has HTTP/HTTPS access to Check Point update servers, using _curl_:  \n        (If R76 and lower, ca-bundle.crt is in $FWDIR/bin)\n        \n        _\\# curl\\_cli -v -1 --cacert $CPDIR/conf/ca-bundle.crt https://updates.checkpoint.com_\n        \n        _\\# curl\\_cli -v http://dl3.checkpoint.com_\n        \n        _\\# curl\\_cli -v http://cws.checkpoint.com_\n        \n        **Note:** Possible connectivity errors: Could not resolve host, fetch .crl failed, etc. (these indicate an Internet connection problem).\n    \n      \n    1.  If the Security Management Server is using proxy, use:\n        \n        _\\# nslookup cws.checkpoint.com_\n        \n        Repeat the command for all servers and verify that there is an IP reply.\n        \n        Verify that the Security Management Server has HTTP/HTTPS access to Check Point update servers, using _curl_:  \n        (If R76 and lower, ca-bundle.crt is in $FWDIR/bin)\n        \n        _\\# curl\\_cli -v -1 --cacert $CPDIR/conf/ca-bundle.crt https://updates.checkpoint.com -x <proxyIP:proxyPORT>_\n        \n        _\\# curl\\_cli -v http://dl3.checkpoint.com -x <proxyIP:proxyPORT>_\n        \n        _\\# curl\\_cli -v http://cws.checkpoint.com -x <proxyIP:proxyPORT>_\n        \n        **Note:** Change <proxyIP:proxyPORT> to the proxy IP address and port, removing the symbols. For example, if the proxy IP address and port is: 10.20.30.40:8080, the command will be:\n        \n        _\\# curl\\_cli -v -1 --cacert $CPDIR/conf/ca-bundle.crt https://updates.checkpoint.com -x 10.20.30.40:8080_\n        \n\n**For scheduled IPS update:**\n\nIf all of the above tests were performed and the issue persists, please review and perform _FWM_ debug according to article [sk86186](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk86186), making sure the scheduled update will occur while the _FWM_ debug is running.\n\nFWM debug for scheduled IPS update can be run using a more focused debug:\n\n_\\# fw debug fwm on TDERROR\\_ALL\\_FWMAU=5  \n\\# fw debug fwm on TDERROR\\_ALL\\_FDT=5_\n\nTo disable fwm debug run:\n\n_#fw debug fwm off TDERROR\\_ALL\\_ALL=0_\n\nIf the Security Management version is R80 and up, also debug the CPM process:\n\n_\\# $MDS\\_FWDIR/scripts/cpm\\_debug.sh -t IPS\\_Update -s DEBUG_\n\nTo disable CPM debug run:\n\n_\\# $MDS\\_FWDIR/scripts/cpm\\_debug.sh -t IPS\\_Update -s INFO_\n\n_\\# $MDS\\_FWDIR/scripts/cpm\\_debug.sh -r_\n\nDebug output files: $MDS\\_FWDIR/log/cpm.elg\\*.\n\n**Note:** Verify that debugs are removed from the _tdlog.cpm_ file.\n\n**Note:** In a Multi-Domain Management server environment, the logs for the global IPS update will be in the $MDSDIR/log/mds.elg file, while the logs for every Domain IPS update will be in the corresponding directory in $MDSDIR/customers/, in the fwm.elg file.\n\nCollect all files and outputs from troubleshooting steps above and [Contact Check Point Support](http://www.checkpoint.com/services/contact/index.html) along with a screenshot of the update issue (Try to include the error that pops-up from the update)\n\nFor faster resolution and verification, collect [CPinfo](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92739) files from the Security Management and Security Gateways, involved in the case.\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorAlmog Sasson\n\nTechnical ResourceBogdan Kirylyuk\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2016-07-27\n\nLast Modified2025-03-02\n\nEditorGil Frantsus\n\nLast ApproverOmri Morami\n\n## Comments\n\n#### Internal only\n\n**Important note: Prior to using the tools mentioned in this article, make sure you thoroughly go over [sk156153 - Best Practice Guide for Debugging Check Point Products](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk156153).**\n\n**For additional troubleshooting steps refer to the following: internal SK's:  \n[sk163540: Troubleshooting IPS or Application Control update issues on the Management Server](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk163540&partition=Internal&product=Application)  \n[sk174903: Application Intelligence \\\\ IPS Update Failure or Hanging on Multi-Domain Management](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk174903&partition=Internal&product=Multi-Domain).**\n\n**Example output showing connectivity, using the certificate, and using SHA-256:**\n\n```\n* About to connect() to updates.checkpoint.com port 443 (#0)<br>*    Trying &lt;IP ADDRESS&gt;... connected <br>* Connected to updates.checkpoint.com (&lt;IP ADDRESS&gt;) port 443 (#0)<br>* successfully set certificate verify locations:<br>*    CAfile: /opt/CPshrd-R77/conf/ca-bundle.crt&nbsp;<br>...<br>* SSL connection using AES256-SHA&nbsp;\n```\n\n**FWM debug for scheduled IPS update can be run using a more focused debug:**\n\n_\\# fw debug fwm on TDERROR\\_ALL\\_FWMAU=5  \n# fw debug fwm on TDERROR\\_ALL\\_FDT=5_\n\nSearch for \"FwmAutoUpdates\" and \"FDT\\_download\\_files\\_from\\_fileObj\" in fwm.elg files. Example from a successful scheduled IPS update:\n\n```\n\"CFwmAutoUpdates::GetAsmUpdateVersion\": current asm_update_version: 634156203 <br>\"CFwmAutoUpdates::IsUpdateNeeded\": Asm: 634156203, DC: 634156394, update is needed. <br>[INFO] FDT_download_files_from_fileObj: Activated<br>[INFO] FDT_download_files_from_fileObj: FileSize from set: 24725979<br>[INFO] FDT_download_files_from_fileObj: output file path is: /opt/CPsuite-R77/fw1/conf/SMC_Files/AsmAutoUpdates, filename is sd_updates_&lt;XXX&gt;.upf<br>[INFO] FDT_download_files_from_fileObj: free disk space: [21828677632] file size: [24725979] currect downloaded file [0]<br>[INFO] FDT_download_files_from_fileObj: Remove sha1 file (support resume related)<br>[INFO] FDT_download_files_from_fileObj: file download /opt/CPsuite-R77/fw1/conf/SMC_Files/AsmAutoUpdates/sd_updates_&lt;XXX&gt;.upf passed SH1 test<br>[INFO] FDT_download_files_from_fileObj: file download /opt/CPsuite-R77/fw1/conf/SMC_Files/AsmAutoUpdates/sd_updates_&lt;XXX&gt;.upf completed successfully<br>\"FwmAutoUpdates_AutoUpdatesWaitForReply\": Download succeeded, about to create db revision. <br>\"FwmAutoUpdates_AutoUpdatesWaitForReply\": db revision created successfully , about to perform db update. <br>\"FwmAutoUpdates_AutoUpdatesWaitForReply\": Update succeeded, will perform policy installation is needed. <br>\"FwmAutoUpdates_AutoUpdatesWaitForReply\": Automatic install not needed.\n```\n\n**Values of next triggered Scheduled IPS update can be found in the Management's server registry file:**\n\n```\n(Any issues with a faulty NTP server or virtualized hardware clock (Hyper-V, VMware) can cause for the next scheduled IPS update to be in an irrelevant future date)\n```\n\n\\# vi /opt/CPshrd-R77/registry/HKLM\\_registry.data\n\n: (ScheduledEvents  \n:FWM\\_SCHED\\_AU\\_APP (\"07/02/**2036** 13:29:11\")  \n:FWM\\_SCHED\\_AU (\"07/02/**2036** 07:29:11\")","language":"md","time":"14 days ago","created":"2025-05-06T22:56:11.549Z","annotations":[],"updated":"2025-05-06T22:59:15.088Z"},{"title":"Check Point Support for Monitor Mode","id":"1e1c2a54-fc0f-4498-8bc6-362834a63b7d","type":"TEXT","raw":"ProductAnti-Bot, Anti-Spam, Anti-Virus, Application Control, CloudGuard Network, Data Loss Prevention, IPS, Identity Awareness, Quantum Appliances, Quantum Scalable Chassis, Quantum Security Gateways, Quantum Security Management, Threat Emulation, URL Filtering\n\nVersionR77.30 (EOS), R80 (EOS), R80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10\n\nOSGaia\n\nPlatform12000 (EOL), 13000 (EOL), 15000, 21000 (EOL), 2200 (EOL), 23000, 3000, 4000 (EOL), 41000 (EOL), 44000, 5000, 61000 (EOL), 64000, Intel/PC, Power-1 (EOL), UTM-1 (EOL), VMWare ESX, VSX-1 (EOL)\n\nLast Modified2025-04-24\n\n## Solution\n\n**Table of Contents:**\n\n-   Introduction\n    \n-   Support for Security Gateway blades\n    \n-   Support for Cluster\n    \n-   Support for Management blades\n    \n-   Limitations\n    \n-   Important Notes\n    \n-   How to configure\n    \n-   FAQ\n    \n-   Related documentation\n    \n-   Related solutions\n    \n\n## Introduction\n\nThis articles describes Check Point support for Monitor Mode by various products / blades / features in different deployments.\n\nMonitor Mode can be configured on Check Point Security Gateway interfaces and allows Check Point Security Gateway to listen to traffic from a Mirror Port or Span Port on a switch.\n\nMonitor Mode on Check Point Security Gateway interface is usually configured to monitor and analyze network traffic without affecting the production environment.\n\nYou can use mirror ports in the following scenarios:\n\n-   As a permanent part of your deployment, to monitor the use of applications in your organization.\n-   As an evaluation tool for the capabilities of the Application Control and IPS blades before you decide to purchase them.\n\nBenefits of a mirror port include:\n\n-   There is no risk to your production environment.\n-   It requires minimal set-up configuration.\n-   It does not require TAP equipment, which is much more expensive.\n\nNotes:\n\n-   When enabling monitor mode, anti spoofing and local spoofing should be disabled.\n-   The mirror port neither enforces any security policy, nor performs any active operations (prevent/drop/reject).  \n    Therefore, you can only use mirror port to evaluate the monitoring and detecting capabilities of the software blades.\n-   All duplicated packets arriving at the monitor interface of the Security Gateway are terminated and will not be forwarded in any way.\n-   Security Gateway in Monitor Mode does not send any traffic through the monitor interface.\n\nTopology:\n\n-   You can configure a Mirror (TAP) port to duplicate network traffic that is sent to a Security Gateway.\n-   The gateway inspects the traffic but does not drop packets.\n-   Connect the Security Gateway to a mirror port on the switch that duplicates the appropriate ports and VLANs.\n\n> <table><tbody><tr><td><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk101670/Topology.png\" alt=\"\"></td><td><div><table><tbody><tr><td>Item</td><td>Description</td></tr><tr><td>1</td><td>Switch with mirror port</td></tr><tr><td>2</td><td>Servers</td></tr><tr><td>3</td><td>Computers</td></tr><tr><td>4</td><td>Security Gateway in monitor mode</td></tr><tr><td>5</td><td>Security Management Server that manages the Security Gateway</td></tr></tbody></table></div><p>Note: Make sure that one mirror port on the switch<br>is connected to one interface on the Security Gateway.</p></td></tr></tbody></table>\n\n## Support for Security Gateway blades\n\nMonitor Mode is **fully supported** (unless stated otherwise) on Gaia / SecurePlatform OS by the following blades for single Security Gateway deployment:\n\n> <table><tbody><tr><td>Blade</td><td>Comments</td></tr><tr><td>Firewall</td><td><em>&nbsp;None</em></td></tr><tr><td>IPS</td><td>The following will not work:<br><ul><li>'SYN Attack' protection (SYNDefender)</li><li>'Initial Sequence Number (ISN) Spoofing' protection</li><li>'Send error page' action in Web Intelligence protections</li><li>Client/Server notifications about connection termination</li></ul></td></tr><tr><td>Application Control</td><td><ul><li>UserCheck is not supported</li></ul></td></tr><tr><td>URL Filtering</td><td><ul><li>UserCheck is not supported</li></ul></td></tr><tr><td>Data Loss Prevention</td><td><ul><li>'Prevent' and 'Ask User' actions will automatically be demoted to 'Inform User' action</li><li>UserCheck is not supported</li><li>FTP inspection is not supported</li></ul></td></tr><tr><td>Identity Awareness</td><td><ul><li>Captive Portal is not supported</li><li>Identity Agent is not supported</li></ul></td></tr><tr><td>Threat Emulation</td><td><ul><li>Emulation Connection Prevent Handling Modes - \"Background\" and \"Hold\" - are not supported&nbsp;(refer to <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk106119\" target=\"_blank\" rel=\"noopener\">sk106119</a>)</li></ul></td></tr><tr><td>Anti-Bot / Anti-Virus</td><td><em>&nbsp; &nbsp;None</em></td></tr></tbody></table>\n\nNote: Monitor Mode _is_ supported by Security Gateway VE Network mode.\n\n## Support for Cluster\n\nClusterXL / 3rd Party cluster is **_not_ supported** in Monitor Mode.\n\n## Support for Management blades\n\nMonitor Mode is **fully supported** for all Management Blades only on **StandAlone** machine (Management and Gateway on the same machine).\n\n## Limitations\n\nThese features, Software Blades and deployments are _**not**_ supported in Monitor Mode:\n\n-   NAT\n-   IPSec VPN\n-   HTTPS Inspection\n-   Mobile Access\n-   Anti-Spam & Email Security\n-   Anti spoofing and local spoofing\n-   HTTP / HTTPS proxy\n-   QoS\n-   Traditional Anti-Virus\n-   User Authentication\n-   Client Authentication\n-   Cluster deployment\n-   Security Gateway VE Hypervisor mode / vSEC Gateway\n-   VSX R65 / R67 / R68\n-   Gaia Embedded OS (600 / 700 / 1100 / 1200R / 1400 / Series-80 appliances running R75.20.X / R77.20.31 and lower - refer to [sk105380](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk105380))\n-   SecurePlatform Embedded OS (Series-80 appliances running R71.45)\n-   Setting the value of the kernel parameters \"`psl_tap_enable`\" / \"`fw_tap_enable`\" to 1 (one) _on-the-fly_ with the \"`fw ctl set int`\" command (Issue ID 02386641).\n-   FTP inspection with the Anti-Virus, Threat Emulation, or Content Awareness blade is not supported when Security Gateway works in Monitor Mode (SPAN port).\n\n## Important Notes\n\n-   When enabling monitor mode, anti spoofing and local spoofing should be disabled.  \n    In order to disable address spoofing check:  \n    Edit the `$FWDIR/boot/modules/fwkern.conf` file (create it if does not exist) in Vi editor:  \n    `[Expert@HostName:0]# vi $FWDIR/boot/modules/fwkern.conf`  \n    disable anti spoofing by adding the following line (spaces are not allowed):  \n    `fw_local_interface_anti_spoofing=0`\n\n-   Security Gateway in Monitor Mode must be connected to the Internet (for Cloud-based services - e.g., Social Network widgets and URL Filtering).\n-   Valid license and Contracts file must be installed on Security Gateway in Monitor Mode.\n-   To configure Monitor Mode on **VSX**, refer to [sk88980 - How to configure a Security Policy for Mirror Port Use](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk88980#Mirror%20Port%20Topology%20Configuration) - section \"(2) Mirror Port Topology Configuration\".\n-   To configure Monitor Mode on a **41000 / 61000 Security System** that runs an R76SP.X release, refer to the corresponding R76SP.X Administration Guide.\n-   To configure Monitor Mode on a **40000 / 60000 Scalable Platform** or **Maestro** that runs an R80SP.20 or higher release, refer to the corresponding R80SP.X Scalable Platforms Administration Guide, or Maestro Next Generation Security Gateway R80.20SP Guide - Chapter 'Deploying a Security Group in Monitor Mode'.\n-   To configure Monitor Mode on an **SMB appliances running Gaia Embedded OS**, refer to [sk112572 - Monitor Mode on SMB appliances running Gaia Embedded OS](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk112572).\n\n## How to configure\n\n**Important Note: All steps in this procedure are mandatory.**\n\n1.  Enable the Monitor Mode on the desired interface:\n    \n    <table><tbody><tr><td>OS</td><td>Configuration in GUI</td><td>Configuration in CLI</td></tr><tr><td>Gaia OS</td><td><p>In Gaia Portal:</p><ol type=\"A\"><li>Connect to the Gaia Portal in web browser.</li><li>Go to <em>Network Management</em> section - click on <em>Network Interfaces</em> page.</li><li>Select the desired interface and click on <em>Edit</em> button.</li><li>Check the box <em>Enable</em>.</li><li>If the interface has an IP address assigned to it, then remove it.</li><li>Go to the <em>Ethernet</em> tab.</li><li>Check the box <em>Monitor Mode</em>.</li><li>Click on <em>OK</em> button.</li></ol></td><td><p>In Gaia Clish:</p><ol type=\"A\"><li>Connect to the command line on Gaia OS.</li><li>Log in to Clish.</li><li>Enable the desired interface:<br><code>HostName:0&gt; set interface <em>Name_of_Interface</em> state on</code></li><li>If the interface has an IP address assigned to it, then remove it:<br><code>HostName:0&gt; delete interface <em>Name_of_Interface</em> ipv4-address</code></li><li>Enable the Monitor Mode on the desired interface:<br><code>HostName:0&gt; set interface <em>Name_of_Interface</em> monitor-mode on</code></li><li>Verify that the Monitor Mode was enabled on the desired interface:<br><code>HostName:0&gt; show interface <em>Name_of_Interface</em> monitor-mode</code></li><li>Save the changes:<br><code>HostName:0&gt; save config</code></li></ol></td></tr><tr><td>SecurePlatform OS</td><td><p>In SecurePlatform WebUI:</p><ul><li>Not possible</li></ul></td><td><p>In SecurePlatform Expert mode:</p><ol type=\"A\"><li>Connect to the command line.</li><li>Log in to the Expert mode.</li><li>Go to 'sysconfig' menu:<br><code>[Expert@HostName]# sysconfig</code></li><li>Choose <em>5) Network Connections</em>.</li><li>Choose <em>2) Configure Connection</em>.</li><li>Select the desired interface that will be connected to the SPAN port on the switch.</li><li>If the interface has an IP address, then remove it:<br>choose <em>3) Remove IP from interface</em></li><li>Choose <em>5) Define as connected to a mirror port</em>.</li><li>Press <em>e</em> to exit to the <em>Configure Connection</em> screen of the <em>sysconfig</em> menu.</li><li>Choose <em>5) Show connection configuration</em></li><li>Select the interface that was configured as mirror port.</li><li>Press <em>e</em> to exit from the <em>sysconfig</em> menu.</li></ol></td></tr></tbody></table>\n    \n2.  Install policy on the Security Gateway.\n    \n    **Important Note:** In _Global Properties_, go to _Stateful Inspection_ pane - in the section _Out of state packets_, clear all the boxes (so that Security Gateway does not drop out of state packets).\n3.  When configuring monitor mode for **Security Gateway which doesn't have webui access,** we also need to configure additional parameters: `fw_tap_enable` and `psl_tap_enable.`  \n    Use the script below when access to webui is not available.\n    \n    **Starting from R80.20**\n    \n    1.  Download the _[Change\\_MQ\\_configuration\\_sk101670.7z](https://supportcenter.checkpoint.com/supportcenter/portal/role/supportcenterUser/page/default.psml/media-type/html?action=portlets.DCFileAction&eventSubmit_doGetdcdetails=&fileid=80343)_ script, transfer it to the desired gateway and unpack.  \n        You will get the `asym2Sym.sh` script file.\n    2.  Run the script:\n        \n        -   `cd <SCRIPT DRIECTORY>`\n        -   `chmod 744 asym2sym.sh`\n        -   For span mode, run `./asym2Sym.sh -s OR ./asym2Sym.sh --span`  \n            For tap mode, run `./asym2Sym.sh -t OR ./asym2Sym –tap`\n        \n        **Notes regarding the script:** \n        \n        -   This script requires immediate reboot that cannot be postponed or delayed.\n        -   This script enables the `fw_tap_enable` and `psl_tap_enable` parameters (tap mode) in `$FWDIR/boot/modules/fwkern.conf` and `$PPKDIR/conf/simkern.conf` files in order to survive the reboot.  \n            While in span mode, `psl_tap_enable` parameter only will be enabled and `fw_tap_enable` parameter will be disabled.\n        -   This script will generate the following backup files:\n            -   `modprobe.conf` backup file - created as `modprobe.conf.(date_time)` under the same directory where the original `modprobe.conf` file resides (`/etc/`)\n            -   `fwkern.conf` backup file - will be created as `fwkern.conf.(date_time)` under the same directory where the original `fwkern.conf` file resides (`$FWDIR/boot/modules/`)\n            -   `simkern.conf` backup file - will be created as `simkern.conf.(date_time)` under the same directory where the original `simkern.conf` file resides (`$PPKDIR/conf/`)\n        -   To revert changes, run the script with the _\\-r_ option with the backup file (which was generated previously by running the script without any option) as input.  \n            The revert operation\n            -   will disable the `fw_tap_enable` and `psl_tap_enable` parameters\n            -   will overwrite the original `modprobe.conf` file with the provided backup file.\n    \n    **For pre-R80.20 versions**\n    \n    1.  Edit the `$FWDIR/boot/modules/fwkern.conf` file (create it if does not exist) in Vi editor:  \n        `[Expert@HostName:0]# vi $FWDIR/boot/modules/fwkern.conf`\n    2.  Enable the PSL Tap Mode by adding the following line (spaces are not allowed):  \n        `psl_tap_enable=1`\n    3.  Enable the FW Tap Mode by adding the following line (spaces are not allowed):  \n        `fw_tap_enable=1`\n    4.  Save the changes and exit from Vi editor.\n    5.  Reboot the Security Gateway.\n    \n    Notes:\n    \n    -   Setting the value of the kernel parameters \"`psl_tap_enable`\" / \"`fw_tap_enable`\" to 1 (one) _on-the-fly_ with the \"`fw ctl set int`\" command is _**not**_ supported (Issue ID 02386641).\n    -   This configuration is also required when using a TAP device or Mirror / Span ports with separated TX/RX queues.\n    -   This configuration will make the Mirror Port on Security Gateway work better for the first 10-30 minutes when processing connections, in which the TCP \"SYN\" packet did not arrive.\n4.  Connect the Mirror Port interface of the Security Gateway to a SPAN port on the switch where the traffic passes.\n    \n    If necessary, configure the port on the switch to be a SPAN port and duplicate the incoming and outgoing packets.\n    \n\n**Note**: For 61000 / 41000 appliances, refer to the relevant section in the 61000 / 41000 Security System Administration Guide.\n\n## FAQ\n\nClick Here to Collapse All\n\n-   Do we support configuration of more than one Mirror Port?  \n    \n    > Multiple Mirror Ports are supported with the following caveat: the Security Gateway must not see the same traffic twice on the different interfaces.\n    \n-   Can a Security Gateway be used to pass production traffic through it and as a Mirror Port at the same time?  \n    \n-   Do we need to disable Drop Out of State packets?  \n    \n-   How do you clear the events from SmartEvent?  \n    \n    > Run the following commands:\n    > \n    > ```\n    > [Expert@MirrorGW]# cpstop\n    > \n    > [Expert@MirrorGW]# $CPDIR/database/postgresql/util/PostgreSQLCmd start\n    > \n    > [Expert@MirrorGW]# $CPDIR/database/postgresql/bin/psql -p 18272 -U cp_postgres postgres -c \"drop database events_db\" \n    > \n    > [Expert@MirrorGW]# $CPDIR/database/postgresql/util/PostgreSQLCmd stop\n    > \n    > [Expert@MirrorGW]# cpstart\n    > ```\n    \n-   During policy installation, I get the error: `The Topology information must be configured for object ..., interface ..., in order to use selected features`  \n    \n-   How can I make sure my Mirror Port is not being overrun by network traffic?  \n    \n    > When on a Mirror Port, the device cannot control the flow of packets. If there is not enough CPU or memory resources to deal with or buffer packets before inspection, packets could be dropped.  \n    > It will not affect the traffic on the production network, but you could miss an event (which might have a bad outcome for a PoC).  \n    > It is hard to know when peaks in network traffic happen, and you cannot monitor CPU all the time. You should closely monitor the NIC statistics 1-2 times a day during first phase of the PoC to check that there are no RX drops / overruns on the Mirror Port interface.\n    > \n    > _Example_:\n    > \n    > ```\n    > [Expert@MirrorGW]# ifconfig eth1\n    > eth1      Link encap:Ethernet  HWaddr 00:09:34:1C:39:A4\n    > UP BROADCAST RUNNING MULTICAST  MTU:1500\n    > RX packets:20535957 <em><strong>errors:0 dropped:0 overruns:0</strong></em> frame:0\n    > TX packets:0 <em><strong>errors:0 dropped:0 overruns:0 carrier:0</strong></em>\n    > <em><strong>collisions:0</strong></em> txqueuelen:1000\n    > RX bytes:3698852852 (3.4 GiB)  TX bytes:0\n    > Interrupt:16\n    > ```\n    > \n    > [Contact Check Point Support](http://www.checkpoint.com/services/contact/index.html) for assistance if any of the following counters shows positive / increasing numbers:  \n    > \n    > -   errors\n    > -   dropped\n    > -   overruns\n    > -   carrier\n    > -   collisions\n    \n-   I am not seeing Application Control / URL Filtering / DLP events on any TCP connections  \n    \n    > Follow these steps on R75.4X (starting in R76, Hairpin Mode is not relevant).\n    > \n    > Check if Hairpin Mode is enabled:\n    > \n    > `[Expert@MirrorGW]# cat /sys/class/net/br1/brif/eth1/hairpin_mode`\n    > \n    > Note: Path will vary based on Bridge (e.g., _br1_) and physical interface (e.g., _eth1_) used. If the returned value is 0 (zero), it means that the Hairpin Mode is disabled. In such case, enable it manually:\n    > \n    > `[Expert@MirrorGW]# echo 1 > /sys/class/net/br1/brif/eth1/hairpin_mode`\n    > \n    > Note: This command does not survive a reboot.To make this change permanent, add this '`echo 1 > ...`' command at the bottom of the `/etc/rc.d/rc.local` script.\n    \n\n-   Gaia Administration Guides\n-   Command Line Interface Reference Guides \n-   61000 / 41000 Security System Administration Guide:\n    \n    -   [R76SP.50](https://sc1.checkpoint.com/documents/R76SP.50/CP_R76SP.50_Security_System_AdminGuide/html_frameset.htm) - (chapter \"Managing the 61000/41000 Security System\" - section \"Port Mirroring (SPAN Port)\"):\n    -   [R76SP.30](http://downloads.checkpoint.com/dc/download.htm?ID=45210), [R76SP.40](http://downloads.checkpoint.com/dc/download.htm?ID=47984) - chapter \"Managing the 61000/41000 Security System\" - section \"Port Mirroring (SPAN Port)\"\n    -   [R76SP.20](http://downloads.checkpoint.com/dc/download.htm?ID=41763) - chapter \"Configuring the 61000/41000 Security System\" - section \"Port Mirroring (SPAN Port)\"\n    -   [R76SP](http://downloads.checkpoint.com/dc/download.htm?ID=27964), [R76SP.10](http://downloads.checkpoint.com/dc/download.htm?ID=36217) - chapter \"System Configuration\" - section \"Port Mirroring (SPAN Port)\"\n    -   [R75.40VS](http://downloads.checkpoint.com/dc/download.htm?ID=22941) - chapter \"System Configuration\" - section \"Port Mirroring Configuration\"\n-   R80.20SP Administration Guides:\n    \n    -   [R80.20SP Scalable Platforms Administration Guide](https://sc1.checkpoint.com/documents/R80.20SP/WebAdminGuides/EN/CP_R80.20SP_AdminGuide/html_frameset.htm) - Chapter 'Deploying a Security Group in Monitor Mode'\n    -   [Maestro Next Generation Security Gateway R80.20SP Guide](https://sc1.checkpoint.com/documents/R80.20SP/WebAdminGuides/EN/CP_R80.20SP_Maestro_NextGenSecurityGateway_Guide/html_frameset.htm) - Chapter 'Deploying a Security Group in Monitor Mode'\n\n-   [sk105842 - Security Gateway in Monitor Mode with enabled SecureXL might freeze intermittently](http://supportcontent.checkpoint.com/solutions?id=sk105842)\n    \n-   [sk92985 - Security Gateway in Monitor Mode does not block traffic](http://supportcontent.checkpoint.com/solutions?id=sk92985)\n    \n-   [sk88980 - How to configure a Security Policy for Mirror Port Use](http://supportcontent.checkpoint.com/solutions?id=sk88980)\n    \n-   [sk112798 - Low performance on Security Gateway configured in Monitor Mode (Mirror Port mode)](http://supportcontent.checkpoint.com/solutions?id=sk112798)\n    \n-   [sk72640 - Optimizing Security Gateway Configuration for Mirror Port Use](http://supportcontent.checkpoint.com/solutions?id=sk72640)\n    \n-   [sk83500 - How to run a Mirror Port Proof of Concept (PoC)](http://supportcontent.checkpoint.com/solutions?id=sk83500)\n    \n-   [sk70900 - How to configure Monitor Mode on DLP Security Gateway running Gaia OS](http://supportcontent.checkpoint.com/solutions?id=sk70900)\n    \n-   [sk65390 - Mirror Port mode recommended hotfix for R75.20 Security Gateway on SecurePlatform OS](http://supportcontent.checkpoint.com/solutions?id=sk65390)\n    \n-   [sk101371 - Bridge Mode on Gaia OS and SecurePlatform OS](http://supportcontent.checkpoint.com/solutions?id=sk101371)\n    \n\n## Article Properties\n\nOriginatorOfir Weissberg\n\nTechnical ResourceShai Shabat\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2014-07-19\n\nLast Modified2025-04-24\n\nEditorLiron Rubin\n\nLast ApproverRoy Zhuang\n\n## Comments\n\n#### Internal only\n\n**SK should not be deleted, referenced in vSEC documentation**\n\n**Notes:**\n\n-   Mirror Port and any CPAS mechanism are not supported.\n-   To configure Monitor Mode on UTM-1 / Power-1 appliances, updated e1000 NIC drivers v7.6.15.5 must be installed (integrated since in R76) - for historical information, see [sk37503](http://supportcontent.checkpoint.com/solutions?id=sk37503).\n\n___\n\nFrom Ben Maoz: \"Starting in R80.20, to set the kernel parameter fw\\_tap\\_enable, in addition to the file _$FWDIR/boot/modules/fwkern.conf_, you ALSO need to add it to the file _$PPKDIR/conf/simkern.conf_\"\n\n\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n\n**R80.10 in VSX Mode fully supports Monitor mode.**\n\n```\n----Original Message----\nFrom: Shai Shabat \nSent: Wednesday, November 02, 2016 9:48 AM\nTo: Izhar Shoshani-Levi; Niv Gafni\nSubject: RE: VSX in monitor mode.\n\nIn order to officially enable monitor mode you need webUI.\nSince there is no webUI in VSX we count as not supported.\nIf customer needs monitor mode in VSX we can enable it with global flags\n\n----Original Message----\nFrom: Izhar Shoshani-Levi \nSent: Tuesday, November 01, 2016 3:39 PM\nTo: Shai Shabat; Niv Gafni\nSubject: VSX in monitor mode.\n\nHi,\n\nsk101670 states that Monitor mode is not supported in VSX mode. QA tested and verify it works and actually you can have \none VS in monitor mode while the other VS is not.\nAny reason why the SK states it is not supported? \n```\n\n___\n\n**Per Ben Maoz**: Starting in R80.20, to set the kernel parameter _fw\\_tap\\_enable_, in addition to the file _$FWDIR/boot/modules/fwkern.conf_, you ALSO need to add it to the file _$PPKDIR/boot/modules/simkern.conf_In R81.10 and later simkern.conf will not require this parameter because the value is loaded from fwkern.conf during boot and the value in simkern.conf is not used.  See [TM-81783](https://jira-prd.checkpoint.com/browse/TM-81783) for further detail.\n\n___\n\nTo configure Monitor Mode on UTM-1 / Power-1 appliances, updated e1000 NIC drivers v7.6.15.5 must be installed","language":"md","time":"14 days ago","created":"2025-05-06T22:56:05.859Z","annotations":[],"updated":"2025-05-06T22:58:18.871Z"},{"title":"Emphasize IPv6 Implementation in Check Point Product","id":"23f1d6a0-3439-433e-b9bb-d2abd2b8b2d5","type":"TEXT","raw":"ProductClusterXL, Quantum Security Gateways\n\nVersionR80.20.x, R81 (EOS), R81.10, R81.10.x, R81.20, R82\n\nOSGaia\n\nLast Modified2025-01-05\n\n## Solution\n\n### Introduction\n\nThe purpose of this document is to emphasize the IPv6 implementation in Check Point products.\n\nThe main point of IPv6 feature is that Security Gateway treats IPv6 IP addresses in the same way as IPv4. All commands including debug, are supported with no change and their output contains records for both IPv6 and IPv4 addresses.\n\nInternet Protocol version 6 (IPv6) represents an enhancement of the Internet Protocol (IP), the communications protocol responsible for routing traffic across the Internet. All Check Point Firewall versions support IPv6, with full integration into the Gaia Operating System beginning from version R75.40. This integration includes features such as CoreXL, SecureXL, and ClusterXL, for enhanced performance and scalability.\n\nClusterXL supports High Availability clusters for IPv6. Load Sharing is **not** supported. All IPv6 status information is synchronized, and the IPv6 clustering mechanism is activated during fail-over.\n\nQuantum Spark Gateways support IPv6 only in the 1500, 1600, 1800, and higher appliance models.\n\n### **Limitations**\n\n-   See [sk163313 - IPv6 features and limitations](https://support.checkpoint.com/results/sk/sk163313).\n-   See [sk174348 - IPv6 Limitations on Quantum Spark Appliances](https://support.checkpoint.com/results/sk/sk174348).\n\n###   \n**IPv6 Traffic Handling**\n\nIn releases prior to R76, the firewall did not store IPv6 addresses as actual IPv6 addresses in various tables. Instead, each encountered IPv6 address was assigned a unique identifier, referred to as a \"descriptor,\" which ranged from 1 to 2^32. This descriptor was utilized in the connections table and other internal tables.\n\nEvery IPv6 packet being handled in the firewall required first finding the matching descriptor (or allocating a new one), which meant more overhead. To make things worst, the table which held the conversion between IPv6 address and a descriptor was shared for all Firewall instances, which meant a shared lock for all instances when accessing this table.\n\nAll tables contain real IPv6 addresses and there is no difference between how we inspect packets between v4 and v6. The performance is expected to be better as a result.\n\n### **  \nPerformance with IPv6 enabled**\n\nEnabling IPv6 support has some performance implications on both IPv6 and IPv4 traffic. More memory is needed for IPv6 versions of CoreXL and SecureXL (Performance Pack), which will reduce IPv4 concurrent connection capacity by about 30% (exact amount depends on available memory). IPv4 packet rate/throughput and connection rate should not be impacted.\n\nFor a given appliance, the IPv6 connection rate is approximately 40% lower than the corresponding IPv4 rate. Additionally, the concurrent connection rate for IPv6 is about 50% lower than that of IPv4. These discrepancies result from the increased memory requirements for processing IPv6 traffic.\n\n###   \n**Supported IPv6 RFCs**\n\n-   [RFC 1981](https://tools.ietf.org/html/rfc1981) - Path Maximum Transmission Unit Discovery for IPv6\n-   [RFC 2460](https://tools.ietf.org/html/rfc2460) - IPv6 Basic specification\n-   [RFC 2464](https://tools.ietf.org/html/rfc2464) - Transmission of IPv6 Packets over Ethernet Networks\n-   [RFC 3596](https://tools.ietf.org/html/rfc3596) - DNS Extensions to support IPv6\n-   [RFC 4007](https://www.rfc-editor.org/info/rfc4007) - IPv6 Scoped Address Architecture\n-   [RFC 4193](https://tools.ietf.org/html/rfc4193) - Unique Local IPv6 Unicast Addresses\n-   [RFC 4213](https://tools.ietf.org/html/rfc4213) - Basic Transition Mechanisms for IPv6 Hosts and Routers - 6in4 tunnel is supported\n-   [RFC 4291](https://tools.ietf.org/html/rfc4291.html) - IPv6 Addressing Architecture (which replaced RFC1884)\n-   [RFC 4443](https://tools.ietf.org/html/rfc4443) - ICMPv6\n-   [RFC 4861](https://tools.ietf.org/html/rfc4861) - Neighbor Discovery\n-   [RFC 4862](https://tools.ietf.org/search/rfc4862) - IPv6 Stateless Address Auto-configuration\n\n### Commands\n\nOn Gaia, all configurations should be performed in Gaia Clish.\n\nThe output of the **`ifconfig -a`** command lists all interfaces along with their IPv4 and IPv6 addresses, including any configured tunnels between them:\n\n```\n<em>[Expert@lab-machine]# ifconfig -a\neth0        Link encap:Ethernet  HWaddr 00:50:56:8B:67:97  \n            inet addr:172.23.32.101  Bcast:172.23.32.255  Mask:255.255.255.0\n            <strong>inet6 addr: 2001::1:172:23:32:101/64 Scope:Global\n            inet6 addr: fe80::250:56ff:fe8b:6797/64 Scope:Link</strong>\n            UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n            RX packets:65433 errors:0 dropped:0 overruns:0 frame:0\n            TX packets:30583 errors:0 dropped:0 overruns:0 carrier:0\n            collisions:0 txqueuelen:1000 \n            RX bytes:6666783 (6.3 MiB)  TX bytes:31846750 (30.3 MiB)\n\nlo          Link encap:Local Loopback  \n            inet addr:127.0.0.1  Mask:255.0.0.0\n            <strong>inet6 addr: ::1/128 Scope:Host</strong>\n            UP LOOPBACK RUNNING  MTU:16436  Metric:1\n            RX packets:910150 errors:0 dropped:0 overruns:0 frame:0\n            TX packets:910150 errors:0 dropped:0 overruns:0 carrier:0\n            collisions:0 txqueuelen:0 \n            RX bytes:184930728 (176.3 MiB)  TX bytes:184930728 (176.3 MiB)\n\nsit0        <strong>Link encap:IPv6-in-IPv4</strong>  \n            NOARP  MTU:1480  Metric:1\n            RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n            TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\n            collisions:0 txqueuelen:0 \n            RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)</em>\n\n```\n\nTo monitor the IPv6 traffic, use the **_fw6 monitor_** command:\n\nExample:\n\n```\n<em>[Expert@lab-machine]# fw6 monitor\n monitor: getting filter (from command line)\n monitor: compiling\nmonitorfilter:\nCompiled OK.\n monitor: loading\n monitor: monitoring (control-C to stop)\n[vs_0][fw_1] eth1:i[104]: 2001::192:168:0:119 -&gt; 2001::1:172:23:32:119 payload length=64 (ICMPv6)\nICMPv6: type=128 code=0 echo request id=61263 seq=6145\n[vs_0][fw_1] eth1:I[104]: 2001::192:168:0:119 -&gt; 2001::1:172:23:32:119 payload length=64 (ICMPv6)\nICMPv6: type=128 code=0 echo request id=61263 seq=6145\n[vs_0][fw_1] eth0:o[104]: 2001::192:168:0:119 -&gt; 2001::1:172:23:32:119 payload length=64 (ICMPv6)</em>\n```\n\n**  \nIPv6 Configuration and Diagnostics:  \n**\n\n**Important Note:** Changes made with commands in the Expert mode do not survive the reboot.\n\n<table><tbody><tr><td>Operation</td><td>Command Example</td></tr><tr><td>Show IPv6 addresses</td><td><em>ip -6 addr show</em></td></tr><tr><td>Add or delete IPv6 addresses</td><td><em>ip -6 addr add 2001:1::192:168:1:1/64 dev eth0</em><br><em>ip -6 addr del 2001:1::192:168:1:1/64 dev eth0</em><br><em>ifconfig eth0 inet6 add 2001:1::192:168:1:1/64</em><br><em>ifconfig eth0 inet6 del 2001:1::192:168:1:1/64</em></td></tr><tr><td>Show IPv6 routing table</td><td><em>ip -6 route show</em><br><em>netstat -rn -A inet6</em><br><em>route -n -A inet6</em></td></tr><tr><td>Add or delete IPv6 routes</td><td><em>ip -6 route add 2002:a::/64 via 2001:1::192:168:1:10 dev eth0</em><br><em>ip -6 route del 2002:a::/64 via 2001:1::192:168:1:10 dev eth0</em><br><em>ip -6 route add default via 2607:f0d0:2001::1</em><br><em>route -A inet6 add 2002:a::138 gw 2002:a::1 dev eth0</em><br><em>route -A inet6 add ::/0 gw 2002:b::1 dev eth0</em></td></tr><tr><td>Show IPv6 neighbors</td><td><em>ip -6 neigh show</em></td></tr><tr><td>Manually add or delete a neighbor</td><td><em>ip -6 neigh add fec0::1 lladdr 02:01:02:03:04:05 dev eth0</em><br><em>ip -6 neigh del fec0::1 lladdr 02:01:02:03:04:05 dev eth0</em></td></tr><tr><td>Remove all neighbors</td><td><em>ip neigh flush all</em></td></tr><tr><td>Show IPv6 multicast group membership</td><td><em>ip -6 maddr show</em></td></tr><tr><td>Enable IPv6 forwarding on a host</td><td><em>echo 1 &gt; /proc/sys/net/ipv6/conf/all/forwarding</em></td></tr><tr><td>Ping IPv6 hosts</td><td><em>ping6 2001:1::10:0:0:1</em></td></tr><tr><td>Ping Link Local IPv6 addresses</td><td><em>ping6 -I eth0 fe80::213:72ff:fe93:c23d</em></td></tr><tr><td>tcpdump with filter for IPv6 traffic only</td><td><em>tcpdump -nni eth0 ip6</em></td></tr></tbody></table>\n\n## Article Properties\n\nOriginatorStella Shteinbuk\n\nTechnical ResourceTal Martsiano\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2013-02-19\n\nLast Modified2025-01-05\n\nEditorRobert Henderson\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only","language":"md","time":"14 days ago","created":"2025-05-06T22:55:59.908Z","annotations":[],"updated":"2025-05-06T22:57:38.472Z"},{"title":"SK92770 - Database Management and VSX Gateway","id":"83f16240-5062-4435-9e83-333b54210587","type":"TEXT","raw":"---\ncreated: 2025-05-05T11:32:32 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk92770\nauthor: \n---\n\n# sk92770 - How to use dbget and dbset on Gaia OS\n\n> ## Excerpt\n> Applies to: Cluster - 3rd-party, ClusterXL, Multi-Domain Security Management, Quantum Security Gateways, Quantum Security Management, VSX (Traditional)\n\n---\nProductCluster - 3rd-party, ClusterXL, Multi-Domain Security Management, Quantum Security Gateways, Quantum Security Management, VSX (Traditional)\n\nVersionR77.20 (EOS), R77.30 (EOS), R80 (EOS), R80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10\n\nOSGaia\n\nPlatformAll\n\nLast Modified2023-01-06\n\n## Symptoms\n\n-   Gaia Database includes corrupted entries.\n-   Entries cannot be deleted from Gaia Database neither when using Clish, nor when using Gaia Portal.\n\n## Solution\n\n**Disclaimer:** The `dbset` command should **NOT** be used on VSX Gateway (because it might cause the Gaia database and the Management database to be out-of-sync, which in turn will force the user to reinstall/reconfigure the VSX Gateway). [Consult Check Point Support](http://www.checkpoint.com/support-services/contact-support/index.html) before any modification of Gaia database.\n\n**Table of Contents:**\n\n-   Introduction\n    \n-   Changing configuration in Gaia Database\n    \n-   dbget utility\n    \n-   dbset utility\n    \n-   Related solutions\n    \n\n## Introduction\n\n-   Gaia OS Database is stored on hard disk in the **`/config/db/`** directory:\n    \n    -   **`/config/db/initial`** file stores active configuration in plain-text format.\n    -   **`/config/db/initial_db`** file stores active configuration in SQLite v3 database.\n    -   **`/config/active`** file is a symbolic link to `/config/db/initial` file.\n    -   **`/config/active_db`** file is a symbolic link to `/config/db/initial_db` file.\n    \n    The `/config/db/initial` and `/config/db/initial_db` files are updated synchronously and automatically:\n    \n    -   In Clish - after running '`save config`' command.\n    -   In Gaia Portal - after applying the change (depending on the setting, change might be applied automatically, or user must click on '`Apply`' or '`Save`' button).\n    \n    _Example_:\n    \n    ```\n    [Expert@HostName]# <strong>ls -l /config/</strong>\n    total 4\n    lrwxrwxrwx 1 admin root   18 Dec  9 14:07 active -&gt; /config/db/initial\n    lrwxrwxrwx 1 admin root   21 Dec  9 14:07 active_db -&gt; /config/db/initial_db\n    drwxr-xr-x 2 admin root 4096 Apr 25 19:55 db\n    [Expert@HostName]#\n    \n    [Expert@HostName]# <strong>ls -l /config/db</strong>\n    total 312\n    -rw-r--r-- 1 admin root  37210 Apr 25 19:55 initial\n    -rw-r--r-- 1 admin root 273408 Apr 25 19:55 initial_db\n    [Expert@HostName]#\n    ```\n    \n-   After machine boots, the Database is loaded into memory.\n-   Each entry in the Gaia Database is separated by a single space, when the left side is called the **prefix** and the right side is the **value** of the prefix. Some lines end with '**t**', which stands for '**true**'.\n    \n    _Example_:\n    \n    ```\n    [Expert@FW1-Member]# <strong>grep hosts /config/db/initial</strong>\n    hosts:v4:FW2-Member t\n    hosts:v4:FW2-Member:address 192.168.204.12\n    hosts:v4:FW1-Member t\n    hosts:v4:FW1-Member:address 192.168.204.11\n    hosts:v4:MGMT t\n    hosts:v4:MGMT:address 192.168.204.10\n    hosts:v4:localhost t\n    hosts:v4:localhost:address 127.0.0.1\n    hosts:v6:FW2-Member t\n    hosts:v6:MGMT t\n    hosts:v6:localhost t\n    hosts:v6:localhost:address \\:\\:1\n    [Expert@FW1-Member]#\n    ```\n    \n\n## Changing configuration in Gaia Database\n\nThe **only supported** way to change configuration in Gaia Database is either in Clish shell, or in Gaia Portal.\n\n**Disclaimer:** The `dbset` command should **NOT** be used on VSX Gateway at all (because it will cause the Gaia database and the Management database to be out-of-sync, which in turn will force the user to reinstall/reconfigure the VSX Gateway).\n\nIn some very rare specific scenarios (e.g., entries in Gaia Database that cannot be deleted using Clish or Gaia Portal), users can use the **dbget** and **dbset** utilities for manipulating the in-memory Gaia Database.\n\n**Note:** The `dbget` and `dbset` utilities are **not** officially supported. Check Point cannot guarantee that observed issues can be solved using the `dbget` and `dbset` utilities.\n\n**Warning:** The `dbget` and `dbset` utilities bypass the validations performed in Clish and Gaia Portal and also bypass the database configuration lock. Serious problems may occur if user modifies the Gaia Database incorrectly by using the `dbget` and `dbset` utilities, or by using any method other than Clish or Gaia Portal. These problems may require the user to reinstall the Gaia OS from scratch.\n\n## dbget utility\n\n**dbget** utility is used to query Gaia in-memory Database.\n\nThis utility is run in Expert mode:\n\n**`[Expert@HostName]# dbget [-iarvcn] [-t transaction_id] [-h hostname username:password] variable`**\n\nwhere:\n\n| Flag |                        Explanation                         |\n|------|------------------------------------------------------------|\n|  i   |                   Iterate over entries.                    |\n|  a   | Iterate over all children (with null and non-null values). |\n|  r   |             Iterate over entries recursively.              |\n|  v   |                      Display values.                       |\n|  c   |   Iterate over all children that do not have null value.   |\n|  n   |              Display names in numeric order.               |\n\n_Examples_:\n\n-   Query the value of the prefix \"`hosts:v4:FW1-Member1:address`\":\n    \n    ```\n    [Expert@FW1-Member]# dbget hosts:v4:FW1-Member:address\n    192.168.204.11\n    [Expert@FW1-Member]#\n    ```\n    \n-   Query the value of the prefix \"`hosts`\" recursively:\n    \n    ```\n    [Expert@FW1-Member]# dbget -rv hosts\n    hosts:v4:FW1-Member t\n    hosts:v4:FW1-Member:address 192.168.204.11\n    hosts:v4:FW2-Member t\n    hosts:v4:FW2-Member:address 192.168.204.12\n    hosts:v4:MGMT t\n    hosts:v4:MGMT:address 192.168.204.10\n    hosts:v4:localhost t\n    hosts:v4:localhost:address 127.0.0.1\n    hosts:v6:FW2-Member t\n    hosts:v6:MGMT t\n    hosts:v6:localhost t\n    hosts:v6:localhost:address \\:\\:1\n    [Expert@FW1-Member]#\n    ```\n    \n    These are the contents of `/etc/hosts` file:\n    \n    ```\n    [Expert@FW1-Member]# cat /etc/hosts\n    #  This file was AUTOMATICALLY GENERATED\n    #  Generated by /bin/hosts_xlate on Thu Apr 25 15:01:11 2013\n    # \n    #  DO NOT EDIT\n    # \n    192.168.204.10 MGMT\n    192.168.204.11 FW1-Member\n    192.168.204.12 FW2-Member\n    127.0.0.1 localhost\n    ::1 localhost\n    [Expert@FW1-Member]#\n    ```\n    \n-   Query the DNS servers:\n    \n    ```\n    [Expert@HostName]# dbget -rv resolv\n    resolv:resolver:1 192.168.36.172\n    resolv:resolver:2 192.168.36.173\n    [Expert@HostName]#\n    ```\n    \n\n## dbset utility\n\n**dbset** utility is used to modify in-memory Gaia Database by adding/removing/editing entries.\n\nThis utility is run in Expert mode:\n\n**`[Expert@HostName]# dbset [-t transaction_id] [[-6] -h hostname [username:password]] name value`**  \nOR  \n**`[Expert@HostName]# dbset [-t transaction_id] [[-6] -h hostname [username:password]] -f [filename]`**\n\n_Examples_:\n\n-   Add a new host \"`FW3-Member`\" with IP address \"`192.168.204.13`\":\n    \n    ```\n    [Expert@FW1-Member]# dbset hosts:v4:FW3-Member t\n    [Expert@FW1-Member]# dbset hosts:v4:FW3-Member:address 192.168.204.13\n    [Expert@FW1-Member]# dbset :save\n    ```\n    \n-   Change the IP address of host \"`FW3-Member`\":\n    \n    ```\n    [Expert@FW1-Member]# dbset hosts:v4:FW3-Member:address 192.168.204.33\n    [Expert@FW1-Member]# dbset :save\n    ```\n    \n-   Remove the host \"`FW3-Member`\":\n    \n    ```\n    [Expert@FW1-Member]# dbset hosts:v4:FW3-Member\n    [Expert@FW1-Member]# dbset hosts:v4:FW3-Member:address\n    [Expert@FW1-Member]# dbset :save\n    ```\n    \n-   Change keyboard layout (refer to [sk73420](http://supportcontent.checkpoint.com/solutions?id=sk73420)):\n    \n    ```\n    [Expert@HostName]# dbset keyboard:mapping <em>Layout_Name</em>\n    [Expert@HostName]# dbset :save\n    ```\n    \n-   Change IP address of a DNS server:\n    \n    ```\n    [Expert@HostName]# dbset resolv:resolver:1 192.168.36.185\n    [Expert@HostName]# dbset :save\n    ```\n    \n-   Remove a DNS server:\n    \n    ```\n    [Expert@HostName]# dbset resolv:resolver:1\n    [Expert@HostName]# dbset :save\n    ```\n    \n\n-   [sk87062 (How to delete entries from Gaia configuration database)](http://supportcontent.checkpoint.com/solutions?id=sk87062)\n\n## Article Properties\n\nOriginatorYaniv Sagauker\n\nTechnical ResourceTal Martsiano\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2013-04-30\n\nLast Modified2023-01-06\n\nEditorGil Frantsus\n\nLast ApproverMauricio Bracale\n\n## Comments\n\n#### Internal only\n\nRelated **internal** solutions:\n\n-   [sk38567 (How to use dbget and dbset on IPSO)](http://supportcontent.checkpoint.com/solutions?id=sk38567).\n\n___\n\n**E-Mail thread with RnD:**\n\n```\n----Original Message----\nFrom: VSX Support [mailto:VSXSUPPORT@MICHAEL.CHECKPOINT.COM] On Behalf Of Niv Gafni\nSent: Sunday, August 21, 2016 9:48 AM\nTo: VSXSUPPORT@MICHAEL.CHECKPOINT.COM\nSubject: Re: Conflict between sk92770 and 97998 about using dbset\n\nHi Nikunj,\n\nAs you said, sk92770 is a general Disclaimer to prevent users \nfrom manually managing the Gaia database. \nIn specific cases of mgmt-gw inconsistency, this is the procedure to sync \n(please note that it is not necessarily the preferred operation). \nWe will review the SK, and think of a better language. \nIt is important to keep it stern, to prevent unexperienced users \nfrom modifying the Gaia database, without a good reason. \n\n----Original Message----\nFrom: Nikunj Rangpariya\nSent: Thursday, August 18, 2016 at 5:39:00 PM\nTo: VSXSUPPORT@MICHAEL.CHECKPOINT.COM\nSubject: Conflict between sk92770 and 97998 about using dbset \n\nHi Experts \n\nWhile troubleshooting an issue where Wrp interface shows up on VSX firewall, \neven after removing it from Smart Dashboard and re-provisioning the firewall,\nwe came across some conflicting information.\n\nLooking at sk97998, there is a method (option) to Manually delete the obsolete route \nand the obsolete interface from Gaia OS database on the problematic VSX machine using dbset. \n\nHowever in sk92770 there is following Disclaimer which is concerning: \n--------------------------------------------\nDisclaimer: The dbset command should NOT be used on VSX Gateway at all (because it will \ncause the Gaia database and the Management database to be out-of-sync, which in turn will \nforce the user to reinstall/reconfigure the VSX Gateway).\n--------------------------------------------\n\nI have seen previous cases in my research where dbset was used \nto resolve such kind of issue based on sk97998. \n\nI would like advise on the disclaimer, that does it only apply when there are no issues \nand Gaia Database and Management database are properly synced ? \nIn our case there is a problematic interface which only shows up on Gaia database \non VSX gateway and that is why we want to use sk97998.\n\nOr these SKs should be edited to reflect the correct explanation on conflicting information ? \n\nAny advice on this is appreciated.\n```\n","language":"md","time":"14 days ago","created":"2025-05-06T22:56:02.437Z","annotations":[],"updated":"2025-05-06T22:57:54.298Z"},{"title":"Troubleshooting Check Point Identity Awareness AD Query Connectivity and Configuration","id":"30933752-247c-4a87-b044-a6432f788fde","type":"TEXT","raw":"ProductIdentity Awareness\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia, Windows\n\nLast Modified2024-10-29\n\n## Solution\n\nUsing Identity Awareness blade with AD Query authentication method requires several configurations and connectivity tests to be verified in order to make sure it works correctly.\n\nTo test AD Query connectivity and/or configuration issues, follow this guidelines:\n\n1.  Make sure that the user defined under the LDAP account unit is a Domain Administrator. If it is not, the user should be defined per article:\n    \n    -   For Windows 2008 and higher: [sk93938](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk93938).\n        \n    -   For Windows 2003 and lower: [sk43874](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=skXXXXXX).\n        \n2.  After making sure the user is defined exactly per the above articles (or as a Domain Admin), the user permissions should be verified. This can be done with 2 tools:\n    \n    -   **Wbemtest (Windows side test)** - a tool that is used to quickly explore or confirm WMI details, permissions and connectivity, the tool itself and instructions how to run it are described in article [sk91040](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk91040) .\n        \n        Note: In case of failures with Wbemtest, most likely the issue is related to the user permissions and/or configuration on the Active Directory side, with WMI, and this needs to be checked with Microsoft Support.\n        \n    -   **test\\_ad\\_connectivity (Gateway side test)** - a tool that tests for LDAP and WMI  \n        connectivity. Both are needed for AD Query to function. the tool itself and instructions how to run it are described in article  [sk100406](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk100406) .\n        \n        **Note:** in case of failures, review $FWDIR/log/test\\_ad\\_connectivity.elg file, filtering \"ntstatus\":\n        \n        `[Expert@Home]# cat $FWDIR/log/test_ad_connectivity.elg | grep -i \"ntstat\"`\n        \n        Common outputs/issues/error numbers: **0xC0000022** - Access Denied, **0x00000102** - Timeout reach, etc.\n        \n        **All values, their explanation and description are described under Microsoft KnowledgeBase:** [NTSTATUS Values](https://msdn.microsoft.com/en-us/library/cc704588.aspx)\n        \n        By using the Wireshark filter **ldap.resultCode == 49**  to confirm the credentials set on the LDAP Account Unit are incorrect. \n        \n3.  After connectivity was verified using both Wbemtest and test\\_ad\\_connectivity, next step is to understand the status of the DCs connectivity, using:\n    \n    `[Expert@Home]# adlog a dc`\n    \n4.  In case there is still an error, validate that the user is indeed configured correctly (Full Distinguish Name is correct), using ldapsearch tool:\n    \n    `[Expert@HostName]# ldapsearch -h Domain_Controller_IP_Address -D \"Full_DN_for_User_used_to_authenticate_to_AD\" -w \"User_used_to_auth_Password\" -b \"Base_DN_for_search\" \"LDAP_Search_Filter\"`\n    \n    **_Example_**\n    \n    `# ldapsearch -h 10.20.30.40 -D \"CN=Administrator, CN=Users, DC=Support, DC=checkpoint, DC=com\" -b \"DC=support, DC=checkpoint, DC=com\" -w \"my_password\" \"(&(objectclass=user)(sAMAccountName=Administrator))\" > /var/tmp/ldap_test.txt`\n    \n    Review the output file under _**/var/tmp/ldap\\_test.txt**_ and verify the user has been identified.\n    \n    **Notes:**\n    \n    -   If error appears, either the command was not ran correctly, or the username and password are incorrect.\n        \n    -   If '0 matches' output appears, it means the user is NOT located under the \"LDAP\\_Search\\_Filter\", in our case, under  CN=users, DC=support, DC=checkpoint, DC=com.\n        \n5.  In case failures still exists, the next step is to debug and capture the logging of the user, to understand what is causing the issue, to do so:\n    \n    1.  Make sure LDAP account unit was defined, and has a user configured per the above.\n        \n    2.  Open 1st SSH to the gateway and login to expert mode.\n        \n    3.  Start traffic capture and Identity Awareness usermode debugs as follow:\n        \n        `[Expert@Home]# pdp d rotate`\n        \n        `[Expert@Home]# adlog a d on`\n        \n        `[Expert@Home]# adlog a d extended`\n        \n        `[Expert@Home]# pdp debug on`\n        \n        `[Expert@Home]# pdp d s all all`\n        \n        `[Expert@Home]# fw monitor -e \"(port(389) or port(636)) and host(X.X.X.X),accept;\" -o /var/tmp/ldap.pcap`\n        \n        **Note:** Replace X.X.X.X with the Domain Controller \\[that has issues\\] IP address\n        \n    4.  Via 2nd SSH to the same gateway; re-initialize adlog process to force user login:\n        \n        `[Expert@Home]# adlog a control reconf;sleep 5;watch -n 1 -d \"adlog a dc\"`\n        \n    5.  The screen should show that adlog is reconfiguring, and then after few seconds, it should show the Domain Controller statuses.\n        \n        **Make sure issue is replicated.**\n        \n    6.  Stop all debugs and captures on the 1st SSH window with CTRL+C and run the followings to reset the flags and copy the files:\n        \n        `[Expert@Home]# adlog a d off`\n        \n        `[Expert@Home]# pdp d unset all all`\n        \n        `[Expert@Home]# pdp d off`\n        \n        `[Expert@Home]# cp $FWDIR/log/pdpd.elg* /var/tmp/`\n        \n6.  [Contact Check Point Support](http://www.checkpoint.com/services/contact/index.html) to analyze the output files and start investigation.\n    \n    For faster resolution and verification please collect [CPinfo](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92739) files from the Security Management and Security Gateways involved in the case\n    \n    Collect the required files:\n    \n    -   \\[**ldap.pcap**\\]\n    -   pdpd.elg\\* \\[**all files named pdpd.elg.\\***\\] from **/var/tmp/**\n    -   Mention IP addresses that are relevant for the issue\n    -   Outputs of the other tests performed:\n    -   **wbemtest**\n    -   **test\\_ad\\_connectivity** output\n    -   **$FWDIR/log/test\\_ad\\_connectivity.elg** file\n    -   **\\# adlog a dc** output, etc.\n\n**Related solutions:**\n\n-   [sk107156 - Regular Expressions do not work to exclude users from Identity Awareness AD Query](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk107156)\n-   [sk105950 - Identity Awareness AD Query fails over VPN tunnel](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk105950)\n-   [sk60301 - Identity Awareness AD Query](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk60301)\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorAlmog Sasson\n\nTechnical ResourceVitaly Uritsky\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2016-10-09\n\nLast Modified2024-10-29\n\nEditorGil Frantsus\n\nLast ApproverJames Brunsting\n\n## Comments\n\n#### Internal only","language":"md","time":"14 days ago","created":"2025-05-06T22:56:11.752Z","annotations":[],"updated":"2025-05-06T22:59:21.200Z"},{"title":"sk98348 - Best Practices and Security Gateway Performance","id":"ebd4e8ee-81b3-4e00-bb6d-1fbcf0174379","type":"TEXT","raw":"---\ncreated: 2025-05-05T20:52:25 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk98348\nauthor: \n---\n\n# sk98348 - Best Practices - Security Gateway Performance\n\n> ## Excerpt\n> Applies to: Anti-Bot, Anti-Virus, Application Control, Cluster - 3rd-party, ClusterXL, CoreXL, IPS, Quantum Security Gateways, SecureXL, URL Filtering, VSX (Traditional)\n\n---\nClick Here to Collapse the Entire Article\n\n**Table of Contents (click on section titles to see sub-sections):**\n\n-   (1) Background\n    \n\n-   (3) Best practices\n    \n    -   (3-1) Network interface cards\n        \n    -   (3-2) Throughput\n        \n    -   (3-3) SecureXL\n        \n    -   (3-4) CoreXL\n        \n    -   (3-5) SecureXL with CoreXL\n        \n    -   (3-6) SMT (HyperThreading)\n        \n    -   (3-7) Multi-Queue\n        \n    -   (3-8) Rulebase optimization\n        \n    -   (3-9) IPS optimization\n        \n    -   (3-10) Application Control & URL Filtering optimization\n        \n    -   (3-11) Anti-Virus & Anti-Bot optimization\n        \n    \n\n-   (6) Command Line syntax\n    \n    -   (6-1) SecureXL\n        \n        -   (6-1-A) 'fwaccel' command\n            \n        -   (6-1-B) 'sim' command\n            \n    -   (6-2) CoreXL\n        \n        -   (6-2-A) Gateway mode\n            \n        -   (6-2-B) VSX mode\n            \n    -   (6-3) Multi-Queue\n        \n    \n-   (7) Examples\n    \n-   (8) Related documentation\n    \n-   (9) Related solutions\n    \n-   (10) Revision history\n    \n\nOrganization of this article:\n\n-   Chapter 1 \"_Background_\" - provides a short background on the performance of Security Gateway.\n    \n-   Chapter 2 \"_Introduction_\" - lists the relevant definitions, supported configurations, limitations, and commands specific to a product.\n    \n-   Chapter 3 \"_Best practices_\" - provides the recommendations and guidelines for achieving the optimal performance.\n    \n-   Chapter 4 \"_Initial diagnostics_\" - lists the basic commands and guidelines for checking the current utilization of machine's resources.\n    \n-   Chapter 5 \"_Advanced diagnostics_\" - lists the advanced commands and guidelines for checking the current utilization of machine's resources.\n    \n-   Chapter 6 \"_Command Line syntax_\" - provides the complete list of commands and their options specific to a product.\n    \n-   Chapter 7 \"_Examples_\" - provides real-life examples.\n    \n-   Chapter 8 \"_Related documentation_\" - lists the relevant documents.\n    \n-   Chapter 9 \"_Related solutions_\" - lists the relevant solutions.\n    \n\n___\n\n## (1) Background\n\nThe performance of Security Gateway depends on:\n\n-   CPU - utilization / saturation / errors\n-   Memory - utilization / saturation / errors\n-   Network Interfaces - utilization / saturation / errors\n-   Storage device I/O, capacity, controller - utilization / saturation / errors\n-   Throughput (packet rate \\* packet size)\n\nCheck Point solutions for improving the performance of Security Gateway:\n\n-   SecureXL - refer to [sk153832 - ATRG: SecureXL for R80.20 and higher](https://support.checkpoint.com/results/sk/sk153832)\n-   CoreXL - refer to [sk98737 - ATRG: CoreXL](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98737)\n-   SMT (HyperThreading) - refer to [sk93000 - SMT (HyperThreading) Feature Guide](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk93000)\n-   [Performance Tuning Administration Guide](https://support.checkpoint.com/product/530) for your version - Chapter \"Multi-Queue\"\n-   [ClusterXL Administration Guide](https://support.checkpoint.com/product/531) for your version\n-   VPN - refer to [sk105119 - Best Practices - VPN Performance](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk105119) and to [sk104760 - ATRG: VPN Core](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk104760)\n\n___\n\n## (2) Introduction and Limitations\n\n### (2-1) Introduction and Limitations - SecureXL\n\nShow / Hide introduction information\n\n> **Definitions:**\n> \n> -   _Performance Pack_ is a software acceleration product installed on Security Gateways. The Performance Pack uses _SecureXL_ technology and other innovative network acceleration techniques to deliver wire-speed performance for Security Gateways. SecureXL is implemented either in software, or in hardware (SAM cards on Check Point 21000 appliances; ADP cards on IP Series appliances).\n>     \n> -   _Affinity_ - Association of a particular network interface with a CPU core (either 'Automatic' (default), or 'Static' / 'Manual'). Interfaces are bound to CPU cores via SMP IRQ affinity settings (refer to [sk61962 - SMP IRQ Affinity on Check Point Security Gateway)](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk61962).\n>     \n>     Notes:\n>     -   The default SIM Affinity setting for all interfaces is 'Automatic' - the affinity for each interface is automatically reset every 60 seconds, and balanced between all available CPU cores based on the current CPU load.\n>     -   \"sim affinity\" has been deprecated in R80.40. To change the affinity, use either: \"fw ctl affinity\" (see (6-2) Command Line syntax - CoreXL), or mq\\_mng tools (refer to [Performance Tuning Administration Guide](https://support.checkpoint.com/product/530) for your version)\n> -   _FWACCEL_ - FireWall Accelerator (acceleration feature).\n>     \n> -   _SIM_ - SecureXL Implementation Module (acceleration device).\n>     \n> -   _Connection offload_ - Firewall kernel passes the relevant information about the connection from Firewall Connections Table to SecureXL Connections Table.  \n>     Note: In ClusterXL High Availability, the connections are _**not**_ offloaded to SecureXL on _Standby_ member.\n>     \n> -   _Connection notification_ - SecureXL passes the relevant information about the accelerated connection from SecureXL Connections Table to Firewall Connections Table.\n>     \n> -   _Partial connection_ - Connection that exists in the Firewall Connections Table, but not in the SecureXL Connections Table (versions R70 and above).\n>     \n>     -   In Cluster HA - partial connections are offloaded when a cluster member becomes Active\n>     -   In Cluster LS - partial connections are offloaded upon post-sync (only for NAT / VPN connections)\n>     \n>     Such connections must be offloaded to SecureXL, since packets in these connections must not be dropped.  \n>     If a packet matched a partial connection in the outbound, then it should be dropped.\n> -   _Delayed connection_ - Connection created from SecureXL Connection Templates without notifying the Firewall for a predefined period of time.\n>     \n> -   _Anticipated connection_ - Connection that is anticipated by SecureXL based on policy rules to avoid dropping it by Drop Template.\n>     \n>     In the following firewall policy:  \n>     \n>     | NO. | SOURCE | DESTINATION |     VPN     | SERVICE | ACTION |\n>     |-----|--------|-------------|-------------|---------|--------|\n>     |  1  |  `Any`   |     `Any`     | `Any Traffic` |   `ftp`   | `Accept` |\n>     |  2  |  `Any`   |     `Any`     | `Any Traffic` |   `Any`   |  `Drop`  |\n>     \n>     1.  Any FTP connection that will be opened will be accepted.\n>     2.  A SYN packet of a Telnet connection will be dropped, and a Drop Template will be offloaded to SecureXL.\n>     3.  The FTP Data connection FTP might match this Drop Template and will be dropped.\n>     \n>     Therefore, to prevent the drop of a legitimate connection:  \n>     1.  SecureXL will offload such connections (in this example, FTP Data) and will mark them as anticipated.\n>     2.  SecureXL will try to match an anticipated connection to an existing connection or an existing Accept Template.\n>     3.  If such a match was found, the packet will be forwarded to the firewall and will not be matched to a Drop Template.\n> -   _Accept Template_ - Feature that accelerates the speed, at which a connection is established by matching a new connection to a set of attributes. When a new connection matches the Accept Template, subsequent connections are established without performing a rule match and therefore are accelerated. Accept Templates are generated from active connections according to policy rules. Currently, Accept Template acceleration is performed only on connections with the **same** destination port (using wildcards for source ports).  \n>     Note: Size of Templates table (_cphwd\\_tmpl_, id 8111) is limited to 1/4 of the size of Firewall Connections Table (_connections_, id 8158).\n>     \n> -   _Drop Template_ - Feature that accelerates the speed, at which a connection is dropped by matching a new connection to a set of attributes. When a new connection matches the Drop Template, subsequent connections are dropped without performing a rule match and therefore are accelerated. Currently, Drop Template acceleration is performed only on connections with the **same** destination port (does not use wildcards for source ports). Drop Templates are generated from policy rules by a special algorithm:\n>     \n>     -   Analyze the Rule Base\n>     -   Produce mutually exclusive ranges\n>     -   Offload the ranges to SecureXL\n>     -   Once a packet is dropped, offload a Drop Template\n>     -   All subsequent packets matching that range will be dropped by SecureXL\n> -   _Accelerated path_ - Packet flow when the packet is completely handled by the SecureXL device. It is processed and forwarded to the network.\n>     \n> -   _Medium path_ (PXL) - Packet flow when the packet is handled by the SecureXL device, except for IPS (some protections) / VPN (in some configurations) / Application Control / Content Awareness / Anti-Virus / Anti-Bot / HTTPS Inspection / Proxy mode / Mobile Access / VoIP / Web Portals. The CoreXL layer passes the packet to one of the CoreXL Firewall instances to perform the processing (even when CoreXL is disabled, the CoreXL infrastructure is used by the SecureXL device to send the packet to the single CoreXL Firewall instance that still functions).\n>     \n> -   _Firewall path_ / _Slow path_ (F2F) - Packet flow when the SecureXL device is unable to process the packet (refer to [sk32578 - SecureXL Mechanism](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk32578)). The packet is passed on to the CoreXL layer and then to one of the CoreXL Firewall instances for full processing. This path also processes all packets when SecureXL is disabled.\n>     \n> -   _Active Streaming_ (CPAS) - Technology that sends streams of data to be inspected in the kernel, since more than a single packet at a time is needed to understand the application that is running (such as HTTP data). Active Streaming is Read-enabled and Write-enabled, and works as a transparent proxy. Connections that pass through Active Streaming cannot be accelerated by SecureXL.\n>     \n> -   _Passive Streaming_ - Technology that sends streams of data to be inspected in the kernel, since more than a single packet at a time is needed to understand the application that is running (such as HTTP data). Passive Streaming is Read-only, and it cannot hold packets, but the connections are accelerated by SecureXL.\n>     \n> -   _Passive Streaming Library_ (PSL) - IPS infrastructure, which transparently listens to TCP traffic as network packets, and rebuilds the TCP stream out of these packets. Passive Streaming can listen to all TCP traffic, but process only the data packets, which belong to a previously registered connection. For more details, refer to [sk95193 - ATRG: IPS](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk95193).\n>     \n> -   _PXL_ - Technology name for the combination of SecureXL and PSL.\n>     \n> -   _QXL_ - Technology name for the combination of SecureXL and QoS (R77.10 and above).\n>     \n> -   _F2F_ / _F2Fed_ - Packets that cannot be accelerated by SecureXL (refer to [sk32578 - SecureXL Mechanism](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk32578)) are Forwarded to the Firewall.\n>     \n> -   _F2P_ - Forward to PSL/Applications. Feature that allows to perform the PSL processing on the CPU cores, which are dedicated to the Firewall.\n>     \n> -   _IRQ Swizzling_ - Traditionally, in a PCIe bus, all PCIe ports are mapped to one interrupt. Swizzling allows the PCIe slots to be balanced across four interrupts instead of one (enabling IRQ Swizzling requires a BIOS update).\n>     \n> \n> **Supported operating systems:**\n> \n> -   Gaia OS (R75.40 and higher)\n> -   Gaia Embedded OS (R77.20.00 and higher)\n> -   SecurePlatform OS (R77.30 and lower)\n> -   SecurePlatform Embedded OS (R77)\n> -   IPSO OS (R77.30 and lower)\n> -   Crossbeam XOS (R77.30 and lower)\n> -   Crossbeam COS (R77.30 and lower)\n> \n> **Traffic flow:**\n> \n> > [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/SecureXL_Flow_1.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/SecureXL_Flow_1.png \"Click the image to see it in full size in a new tab/window\")\n> > \n> > [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/SecureXL_Flow_2.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/SecureXL_Flow_2.png \"Click the image to see it in full size in a new tab/window\")\n> \n> **Packet flow:**\n> \n> > -   Flow logic:\n> >     \n> >     [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/SecureXL_Flow_3.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/SecureXL_Flow_3.png \"Click the image to see it in full size in a new tab/window\")\n> > -   Accelerated packet:\n> >     \n> >     [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/SecureXL_Flow_4.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/SecureXL_Flow_4.png \"Click the image to see it in full size in a new tab/window\")\n> > -   Packet matched to a template:\n> >     \n> >     [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/SecureXL_Flow_5.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/SecureXL_Flow_5.png \"Click the image to see it in full size in a new tab/window\")\n> > -   Non-accelerated packet:\n> >     \n> >     [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/SecureXL_Flow_6.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/SecureXL_Flow_6.png \"Click the image to see it in full size in a new tab/window\")\n> \n> **Limitations:**\n> \n> -   For limitations of traffic acceleration and templating, refer to [sk32578 - SecureXL Mechanism](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk32578).\n> -   SIM Affinity has been deprecated in R80.40 and higher versions, refer to [sk170012](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk170012).\n> -   SIM Affinity is applicable only to **physical** interfaces (VLAN / Bond interfaces are influenced by the \"physical\" decision).  \n>     Note: Some systems may require BIOS update to enable IRQ Swizzling and EIRQ technologies. To determine whether a specific system supports the required technology, contact your hardware vendor.\n> -   On VSX Gateway, WARP interfaces can not be assigned to a CPU core.\n> -   The SecureXL NAT Templates are supported _**only**_ in **R75.40 and above** ([sk71200](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk71200)).\n> -   The SecureXL Drop Templates are supported _**only**_ in **R76 and above** ([sk66402](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk66402)).\n> -   The SecureXL Optimized Drops feature (used for DoS/DDoS protection) is supported _**only**_ in **R76 and above** ([sk90861](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk90861)).\n> -   The SecureXL Penalty box feature (used for DoS/DDoS protection) is supported _**only**_ in **R75.40VS and above** (on VSX Gateway, the penalty box would only be enforced on Virtual System 0) ([sk74520](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk74520)).\n> -   SecureXL does _**not**_ support Point-to-Point interfaces (PPP, PPTP, PPPoE).\n> -   In R80.20, SAM is supported only for non-accelerated usage. Traffic connected to the Acceleration-ready 10G Interface Card (CPAC-ACCL-4-10F-21000) will be handled by the host. 10G Ports on the CPAC-ACCL-4-10F-21000 cannot be assigned as SAM ports in R80.20.   \n>     Note: In case a PPP-interface is detected, SecureXL disables itself on that interface ([sk79880](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk79880)).\n> -   ClusterXL Sticky Decision Function (SDF) **disables** SecureXL.\n> -   QoS **disables** SecureXL in the versions R77.30 and lower.\n> -   It is possible that a connection will exist in the Firewall Connections Table, but not in the SecureXL Connections Table (partial connection).  \n>     This situation can occur:  \n>     -   After policy installation\n>     -   After cluster failover\n>     -   If a user turned off ('`fwaccel off`' command) and turned on ('`fwaccel on`' command) acceleration\n> \n> **Documentation:**\n> \n> -   [Performance Tuning Administration Guide](https://support.checkpoint.com/product/530) for your version - Chapter \"SecureXL\"\n> \n> **Command Line syntax:**\n> \n> -   FWACCEL (controls acceleration feature)\n>     \n>     ```\n>     [Expert@HostName]# <strong>fwaccel &lt;parameter&gt; [-h]</strong>\n>     [Expert@HostName]# <strong>fwaccel6 &lt;parameter&gt; [-h]</strong>\n>     ```\n>     \n> -   In R80.30 and lower only: SIM (controls acceleration device)\n>     \n>     ```\n>     [Expert@HostName]# <strong>sim &lt;parameter&gt; [-h]</strong>\n>     [Expert@HostName]# <strong>sim6 &lt;parameter&gt; [-h]</strong>\n>     ```\n>     \n\n### (2-2) Introduction and Limitations - CoreXL\n\nShow / Hide introduction information\n\n> **Definitions:**\n> \n> -   _CoreXL_ - A performance-enhancing technology for Security Gateways on multicore processing platforms. CoreXL enhances Security Gateway performance by enabling the CPU processing cores to concurrently perform multiple tasks.\n>     \n> -   _Secure Network Distributor_ (_SND_) - Traffic entering network interface cards (NICs) is directed to a processing CPU core running the SND, which is responsible for:\n>     \n>     -   Processing incoming traffic from the network interfaces\n>     -   Securely accelerating authorized packets (if SecureXL is enabled)\n>     -   Distributing non-accelerated packets among Firewall kernel instances (SND maintains global dispatching table - which connection was assigned to which instance)\n> -   _Firewall Instance_ / _FW Instance_ - On a Security Gateway with CoreXL enabled, the Firewall kernel is replicated multiple times. Each replicated copy, or Firewall Instance, runs on one CPU processing core. These Firewall instances handle traffic concurrently, and each Firewall instance is a complete and independent Firewall inspection kernel. When CoreXL is enabled, all the Firewall kernel instances on the Security Gateway process traffic through the same interfaces and apply the same security policy.\n>     \n> -   _Affinity_ - Association of a particular network interface / Firewall kernel instance / daemon with a CPU core (either 'Automatic' (default), or 'Manual').  \n>     Note: The default CoreXL interface affinity setting for all interfaces is 'Automatic' when SecureXL is installed and enabled.\n>     \n> -   _Accelerated path_ - Packet flow when the packet is completely handled by the SecureXL device. It is processed and forwarded to the network.\n>     \n> -   _Medium path_ (PXL) - Packet flow when the packet is handled by the SecureXL device, except for IPS (some protections) / VPN (in some configurations) / Application Control / Content Awareness / Anti-Virus / Anti-Bot / HTTPS Inspection / Proxy mode / Mobile Access / VoIP / Web Portals. The CoreXL layer passes the packet to one of the CoreXL Firewall instances to perform the processing. This path is available only when CoreXL is enabled.\n>     \n> -   _Firewall path_ / _Slow path_ (F2F) - Packet flow when the SecureXL device is unable to process the packet (refer to [sk32578 - SecureXL Mechanism](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk32578)). The packet is passed on to the CoreXL layer and then to one of the CoreXL Firewall instances for full processing. This path also processes all packets when SecureXL is disabled.\n>     \n> -   _Passive Streaming Library_ (PSL) - IPS infrastructure, which transparently listens to TCP traffic as network packets, and rebuilds the TCP stream out of these packets. Passive Streaming can listen to all TCP traffic, but process only the data packets, which belong to a previously registered connection. For more details, refer to [sk95193 - ATRG: IPS](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk95193).\n>     \n> -   _PXL_ - Technology name for the combination of SecureXL and PSL.\n>     \n> \n> **Supported operating systems:**\n> \n> -   Gaia OS (R75.40 and above)\n> -   SecurePlatform OS (R77.30 and lower)\n> -   IPSO OS (R77.30 and lower)\n> -   Crossbeam XOS (R77.30 and lower)\n> -   Crossbeam COS (R77.30 and lower)\n> \n> **Architecture:**\n> \n> > _Example of default configuration for machine with 8 CPU cores_:\n> > \n> > [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/8_CPUs_2_SNDs_6_FWs.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/8_CPUs_2_SNDs_6_FWs.png \"Click the image to see it in full size in a new tab/window\")\n> \n> **Default number of CoreXL IPv4 FW instances:**\n> \n> > Note: The real number of CoreXL FW instances depends on the current CoreXL license.\n> > \n> > | Number of  \n> > CPU  \n> > cores | Default number of  \n> > CoreXL IPv4  \n> > FW instances | Default number of  \n> > Secure Network Distributors  \n> > (SNDs) |\n> > |-------------------------|------------------------------------------------|----------------------------------------------------------|\n> > |            1            | 1  \n> > Note: CoreXL is disabled | 0  \n> > Note: CoreXL is disabled |\n> > |            2            |                       2                        |                            2                             |\n> > |            4            |                       3                        |                            1                             |\n> > |         6 - 20          |           `[Number of CPU cores] - 2`            |                            2                             |\n> > |        21-59(1)         |           `[Number of CPU cores] - 4`            |                            4                             |\n> > |      More than 59       |           `[Number of CPU cores] - 10`           |                            10                            |\n> > \n> >   \n> > **Notes:**\n> > \n> > -   <sup>(1)</sup> In R77.30 the limit is 32, and in versions R80.10 - R80.30 limit is 40 instances.  \n> >     In R80.40 User-Mode Firewall, limit is 64 instances when running with SMT. In R80.40 Kernel-Mode Firewall limit is the same as in R80.30.\n> > -   For Maximal number of CoreXL IPv4 FW instances, check [sk98737 - ATRG: CoreXL](https://support.checkpoint.com/results/sk/sk98737)\n> \n> **Relation between CoreXL IPv4 FW instances and CoreXL IPv6 FW instances:**  \n> (run the '`fw ctl multik stat`' command and '`fw6 ctl multik stat`' command on Security Gateway)\n> \n> -   The number of **IPv4** Firewall instances - from a minimum of 2 to a number equal to the maximal number of CPU cores on the Security Gateway.\n> -   The number of **IPv6** Firewall instances - from a minimum of 2 to a number equal to the number of IPv4 Firewall instances.\n> -   The number of **IPv6** Firewall instances cannot exceed the number of **IPv4** Firewall instances.\n> -   The total number of **IPv4** Firewall instances and **IPv6** Firewall instances together cannot exceed **32**.\n> \n> **CoreXL and ClusterXL:**\n> \n> -   The number of CoreXL Firewall instances must be identical on all members of the cluster because the state synchronization between members is performed for each CoreXL Firewall instance (e.g., CoreXL Firewall Instance #2 on Member\\_A can synchronize only with CoreXL Firewall Instance #2 on Member\\_B).  \n>     Note: A Cluster Member with a higher number of CoreXL Firewall instances enters the '`Ready`' state. Refer to [sk42096 - Cluster member is stuck in 'Ready' state](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk42096).\n> \n> **Documentation:**\n> \n> -   [Performance Tuning Administration Guide](https://support.checkpoint.com/product/530) for your version - Chapter \"CoreXL\"\n> \n> **Command Line syntax:**\n> \n> ```\n> [Expert@HostName]# <strong>fw ctl multik &lt;parameter&gt;</strong>\n> [Expert@HostName]# <strong>fw ctl affinity [-<em>flag</em>]</strong>\n> ```\n\n### (2-3) Introduction and Limitations - SMT (HyperThreading)\n\nShow / Hide introduction information\n\n> **Definitions:**\n> \n> -   _SMT_ (Simultaneous Multi-Threading - Intel® HyperThreading, or Intel® HT) is a feature that is supported on Check Point appliances running Gaia OS. When enabled, SMT doubles the number of logical CPUs on the Security Gateway, which enhances physical processor utilization. When SMT is disabled, the number of logical CPUs equals the number of physical cores.  \n>     SMT improves performance up to 30% in NGFW software blades such as **IPS**, **Application & URL Filtering** and **Threat Prevention** by increasing the number of CoreXL Firewall instances based on the number of logical CPUs.\n> \n> **Supported configurations:**\n> \n> -   SMT is supported in the versions R77 and above.\n> -   SMT is supported _**only**_ on Security Gateways running **Gaia OS** with the **64-bit** kernel.\n> -   SMT is supported on Check Point appliances.\n> -   SMT is supported on Open Servers starting from R80.40 Jumbo Hotfix Take #45.\n> \n> **Limitations:**\n> \n> -   SMT is relevant _**only**_ if CoreXL is enabled (this is the default).\n> \n> **Notes:**\n> \n> -   When SMT (HyperThreading) is enabled, the number of available CPU cores is **not** linear.\n>     \n>     _Example_:\n>     \n>     ```\n>     CPU core 0-5 - socket 1\n>     CPU core 6-11 - socket 2\n>     CPU core 12-15 - socket 1 HyperThreading\n>     CPU core 16-23 - socket 2 HyperThreading\n>     ```\n>     \n> \n> **Documentation:**\n> \n> -   [sk93000 - SMT (HyperThreading) Feature Guide](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk93000)\n\n### (2-4) Introduction and Limitations - Multi-Queue\n\nShow / Hide introduction information\n\n> **Background:**\n> \n> Today, each network interface card has one traffic queue that is handled by one CPU at a time. Since the Secure Network Distributor (SND) - SecureXL and CoreXL Distributor is running on the CPU cores that handle the traffic queues, user cannot use more CPU cores for acceleration than the number of network interface cards passing the traffic.\n> \n> **Definitions:**\n> \n> -   _Multi-Queue_ is an acceleration feature that lets the user configure more than one traffic queue for each network interface card, which allows using more CPU cores for acceleration.\n>     \n> -   _RX queue_ - Receive packet queue.\n>     \n> -   _TX queue_ - Transmit packet queue.\n>     \n> -   _Secure Network Distributor (SND)_ - Traffic entering network interface cards (NICs) is directed to a processing CPU core running the SND, which is responsible for:\n>     \n>     -   Processing incoming traffic from the network interfaces\n>     -   Securely accelerating authorized packets (if SecureXL is enabled)\n>     -   Distributing non-accelerated packets among Firewall kernel instances\n> -   _IRQ affinity_ - Process of binding a network interface card's IRQ to one or more CPU cores.\n>     \n> -   _Accelerated path_ - Packet flow when the packet is completely handled by the SecureXL device. It is processed and forwarded to the network.\n>     \n> -   _Medium path_ (PXL) - Packet flow when the packet is handled by the SecureXL device, except for IPS (some protections) / VPN (in some configurations) / Application Control / Content Awareness / Anti-Virus / Anti-Bot / HTTPS Inspection / Proxy mode / Mobile Access / VoIP / Web Portals. The CoreXL layer passes the packet to one of the CoreXL FW instances to perform the processing. This path is available only when CoreXL is enabled.\n>     \n> -   _Firewall path_ / _Slow path_ - Packet flow when the SecureXL device is unable to process the packet (refer to [sk32578 - SecureXL Mechanism](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk32578)). The packet is passed on to the CoreXL layer and then to one of the CoreXL FW instances for full processing. This path also processes all packets when SecureXL is disabled.\n>     \n> -   _Passive Streaming Library_ (PSL) - IPS infrastructure, which transparently listens to TCP traffic as network packets, and rebuilds the TCP stream out of these packets. Passive Streaming can listen to all TCP traffic, but process only the data packets, which belong to a previously registered connection. For more details, refer to [sk95193 - ATRG: IPS](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk95193).\n>     \n> -   _PXL_ - Technology name for combination of SecureXL and PSL.\n>     \n> \n> **Supported configurations:**\n> \n> -   Multi-Queue is integrated into **R76**, **R77 and above**.  \n>     For lower versions, a Multi-Queue **hotfix** has to be installed.\n> -   Multi-Queue is supported on Check Point Appliances (including IP Series Appliances) and on Open Servers.\n> -   Multi-Queue is supported _**only**_ on machines that run Gaia OS (R75.40 and higher) or SecurePlatform OS (R77.30 and lower).\n> -   Multi-Queue is supported _**only**_ for network interface cards that use **igb** (1 GbE) and **ixgbe** (10 GbE) drivers.\n> \n> **Limitations:**\n> \n> -   Multi-Queue is relevant _**only**_ if SecureXL is enabled (this is the default).\n> -   Multi-Queue is relevant _**only**_ if CoreXL is enabled (this is the default).\n> -   Multi-queue is _**not**_ supported on Appliances / Open Servers with a single CPU core.\n> -   In Gaia with kernel 2.6.18: Multi-Queue allows to configure a **maximum** of 5 interfaces (due to IRQ limitations).\n> -   The number of traffic queues is **limited** by the number of CPU cores and the type of network interface card driver:  \n>     -   **igb** driver:\n>         -   Gaia with kernel 2.6.18: up to 4 RX queues\n>         -   Gaia with kernel 3.10: 2-16 (depends on the interface)\n>     -   **ixgbe** driver - up to 16 RX queues\n> \n> **Documentation:**\n> \n> -   [Performance Tuning Administration Guide](https://support.checkpoint.com/product/530) for your version - Chapter \"Multi-Queue\"\n> \n> **Command Line syntax:**\n> \n> ```\n> [Expert@HostName]# mq_mng -h\n> ```\n\n___\n\n## (3) Best practices\n\n### (3-1) Best practices - Network interface cards\n\nShow / Hide best practices information\n\n> -   Refer to the list of [Certified Network Interfaces](https://www.checkpoint.com/support-services/hcl/).\n> -   You should use the [PCI Express](http://en.wikipedia.org/wiki/PCI-Express) (PCIe) cards, because they have better performance than [PCI-X](http://en.wikipedia.org/wiki/PCI-X) cards.\n> -   If you are using a motherboard with multiple PCI or PCI-X buses, make sure that each Network Interface Card is installed in a slot connected to a **different** bus.\n> -   If you are using more than two Network Interface Cards in a system with only two 64-bit/66Mhz PCI buses, make sure that the least-used cards are installed in slots connected to the same bus.\n> -   If the traffic rate is very high and causes high amount of SoftIRQ (and traffic drops on interfaces), consider increasing the sizes of receive/transmit buffer on network interface cards as described in [sk42181 - How to increase sizes of buffer on SecurePlatform/Gaia for Intel NIC and Broadcom NIC](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk42181).\n\n### (3-2) Best practices - Throughput\n\nShow / Hide best practices information\n\n> **Setting the maximal number of concurrent connections:**\n> \n> -   Versions R75.40VS, R75.45 and higher\n>     \n>     1.  SmartConsole - open Security Gateway object.\n>     2.  Go to '`Optimizations`' pane.\n>     3.  The '`Calculate the maximum limit for concurrent connections`' should be set to '`Automatically`'.  \n>         Note: Manual limit should be set only for security reasons.\n>     4.  Enter the desired value.\n>     5.  The '`Calculate connections hash table size and memory pool`' should be set to '`Automatically`'.\n>     6.  Click on '`OK`'.\n>     7.  Install the policy.\n> -   Versions R75.40 and lower\n>     \n>     1.  SmartDashboard - open Security Gateway object.\n>     2.  Go to '`Optimizations`' pane.\n>     3.  In the '`Calculate the maximum limit for concurrent connections`', select the '`Manually`' (recommended setting is '`Automatically`').\n>     4.  Enter the desired value.\n>     5.  The '`Calculate connections hash table size and memory pool`' should be set to '`Automatically`'.\n>     6.  Click on '`OK`'.\n>     7.  Install the policy.\n> \n> Notes:\n> \n> -   You should ensure that the total number of concurrent connections is appropriate to the TCP end timeout.  \n>     Too many concurrent connections will adversely affect the Security Gateway's performance.\n> -   You can calculate the maximum number of concurrent connections by multiplying the _session establishment rate_ by the _TCP session timeout_:  \n>     `[MAXIMAL number of concurrent connections] = [MAXIMAL session establishment rate] x [TCP entire session timeout]`  \n>     Notes:  \n>     -   This formula is used to understand what number of concurrent connections a session rate test will generate.\n>     -   It is very hard to predict the maximal connections capacity of a Security Gateway because of multiple varying factors.\n>     -   Administrator should monitor the memory utilization on Security Gateway after changing these settings.\n>     -   Only the maximal (possible) session rate should be considered.\n>     -   This formula will _not_ predict connections capacity, which is stated in Check Point datasheet documents.\n>     -   Average session rate can be obtained using the [sk101878 - CPView Utility](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101878) - from '`Traffic`' tab.\n>     -   Additional information can be obtained based on [sk67560 - How to export History Report from SmartView Monitor](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk67560) - from '`Traffic`' view.\n>     -   TCP timeout varies highly between applications and protocols (e.g., SSH is usually long, HTTP is usually short).\n> -   By reducing the following timeouts, you increase the capacity of actual TCP and UDP connections (SmartConsole - '`Policy`' menu - '`Global Properties`' - '`Stateful Inspection`'):  \n>     -   _TCP end timeout_ - determines the amount of time a TCP connection will stay in the FireWall Connections Table (id 8158) after a TCP session has ended.\n>     -   _UDP virtual session timeout_ - determines the amount of time a UDP connection will stay in the FireWall Connections Table (id 8158) after the last UDP packet was seen by the Security Gateway.\n> \n> **Optimal connection/sec rate:**\n> \n> 1.  SmartConsole - go to '`Policy`' menu - click on '`Global Properties`'.\n> 2.  Go to '`FireWall`' pane.\n> 3.  Uncheck the following boxes:  \n>     -   Accept RIP\n>     -   Accept Domain Name over UDP (Queries)\n>     -   Accept Domain Name over TCP (Zone Transfer)\n>     -   Accept ICMP requests\n> 4.  Click on '`OK`'.\n> 5.  Install the policy.\n> \n> **ARP cache table:**\n> \n> Increase the number of entries in the ARP cache table:\n> \n> -   If you are testing large subnets that are directly connected to the Security Gateway without a router.\n> -   If '`kernel: neighbour table overflow`' appears repeatedly in `/var/log/messages` files and in the output of the '`dmesg`' command.  \n>     Related solutions:  \n>     -   [sk43772 - 'kernel: neighbour table overflow' appears repeatedly in /var/log/messages files](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk43772)\n>     -   [sk92372 - How to change the size of IPv6 Neighbors cache table](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92372)\n> \n> **NAT session rate:**\n> \n> -   For Security Gateway versions R75.40 - R80.10:  \n>     Enable SecureXL NAT Templates per [sk71200 - SecureXL NAT Templates](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk71200).\n> -   For Security Gateway versions R75.30 and lower:  \n>     1.  Disable SecureXL.\n>     2.  And change **one** of the following:\n>         -   Either decrease the _TCP end timeout_ to 2 seconds (SmartConsole - '`Policy`' menu - '`Global Properties`' - '`Stateful Inspection`').\n>         -   Or increase the hash size of SND's Connection Table by increasing (_permanently_ per [sk26202](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk26202)) the value of the kernel parameter **`fwmultik_gconn_tab_hsize`** from the default 524288 to 8388608 and rebooting the machine.  \n>             Important Note: This change reduces the capacity for the maximum number of concurrent connections.\n\n### (3-3) Best practices - SecureXL\n\nShow / Hide best practices information\n\n> **Note:** This section does _**not**_ take the CoreXL into consideration.\n> \n> **BIOS settings:**\n> \n> -   If your BIOS supports CPU clock setting, then make sure that the BIOS is set to the **actual** CPU speed (no over-clocking).\n> -   If your BIOS supports Hyper-Threading, then refer to \"SMT (HyperThreading)\" section.\n> \n> **Network Interface Cards:**\n> \n> -   Refer to the list of [Certified Network Interfaces](https://www.checkpoint.com/support-services/hcl/).\n> -   You should use the [PCI Express](http://en.wikipedia.org/wiki/PCI-Express) (PCIe) cards, because they have better performance than [PCI-X](http://en.wikipedia.org/wiki/PCI-X) cards.\n> -   If you are using a motherboard with multiple PCI or PCI-X buses, make sure that each Network Interface Card is installed in a slot connected to a **different** bus.\n> -   If you are using more than two Network Interface Cards in a system with only two 64-bit/66Mhz PCI buses, make sure that the least-used cards are installed in slots connected to the same bus.\n> \n> **Network interface affinity:**\n> \n> -   Each NIC should be bound (affined) to a separate CPU core using the 'Static' affinity mode (run the '`sim affinity -s`' command).\n>     -   **Note**: The '`sim affinity`' command has been deprecated in R80.40 (refer to [sk170012](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk170012)). To configure affinity, refer to the section \"(3-4) CoreXL\".\n> -   Pairs of interfaces carrying significant data flows (based on network topology) should be assigned to pairs of CPU cores on the same physical CPU processor.\n> -   Pairs of interfaces that serve the same connections (based on network topology) should be assigned to pairs of CPU cores on the same physical CPU core.\n> -   On Open Servers with 4 CPU cores and Dual Port NICs, the IRQ Swizzling technology should be enabled in the BIOS to properly distribute IRQs among 4 CPU cores.  \n>     Note: Applies only to Dual Port NICs. IRQ Swizzling is not required with Quad Port NICs.\n> -   For systems with 8 CPU cores and Quad Port NICs, the EIRQ technology should be enabled to properly distribute IRQs among all 8 CPU cores.  \n>     Note: At the time of this writing, there is no certified platform with this ability.\n> \n> **NAT session rate:**\n> \n> -   For Security Gateway versions R75.40 - R80.10:  \n>     Enable SecureXL NAT Templates per [sk71200 - SecureXL NAT Templates](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk71200).\n> -   For Security Gateway versions R75.30 and lower:  \n>     1.  Disable SecureXL.\n>     2.  And change **one** of the following:\n>         -   Either decrease the _TCP end timeout_ to 2 seconds (SmartConsole - '`Policy`' menu - '`Global Properties`' - '`Stateful Inspection`').\n>         -   Or increase the hash size of SND's Connection Table by increasing (_permanently_ per [sk26202](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk26202)) the value of the kernel parameter **`fwmultik_gconn_tab_hsize`** from the default 524288 to 8388608 and rebooting the machine.  \n>             Important Note: This change reduces the capacity for the maximum number of concurrent connections.\n> \n> **Accelerated Drop Rules:**\n> \n> -   Available in R75.40 and higher.\n> -   Accelerated Drop Rules protect the Security Gateway and site from Denial of Service attacks by dropping packets at the acceleration layer (SecureXL).\n> -   The drop rules are configured in a file on the Security Gateway (using the '`sim dropcfg <options>`' command), which is then offloaded to the SecureXL device for enforcement.  \n>     Note: There is no relation between the rules being configured in the file and the rules configured in SmartConsole.\n> -   For R75.40 - R80.10 versions, refer to [sk67861 - Accelerated Drop Feature in R80.10 and lower.](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk67861)\n> \n> **Optimized Drops:**\n> \n> -   Available in R76 and higher.\n> -   Allows SecureXL to accelerate dropped traffic.\n> -   Once the feature is enabled, dropped traffic is accelerated depending on traffic drop rate per second. Once drop rate matches the thresholds, feature is dynamically activated/deactivated.\n> -   Refer to [sk90861 - Optimized Drops feature in R76 and above.](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk90861)\n> \n> **Delayed Synchronization in cluster:**\n> \n> -   To decrease the load on CPU in cluster environment:\n>     \n>     -   Either disable the synchronization of non-critical connections (e.g., UDP DNS, ICMP).\n>     -   Or (if connection must be synchronized) start synchronizing the connection only some time after its initiation (right-click on the service - '`Edit...`' - '`Advanced...`' - check the box '`Start synchronizing [X] seconds after connection initiation`' - install policy).\n>     \n>     Notes:\n>     \n>     -   Applies only to TCP services whose '`Protocol Type`' is set to '`HTTP`' or '`None`'.\n>     -   Delayed Synchronization is disabled if the '`Track`' option in the rule is set to '`Log`' or '`Account`'.\n>     -   Delayed Synchronization is performed only for connections matching a SecureXL Connection Template.\n\n### (3-4) Best practices - CoreXL\n\nShow / Hide best practices information\n\n> **Note:** This section does _**not**_ take the SecureXL into consideration.\n> \n> **Notes:**\n> \n> -   CoreXL improves performance with almost linear scalability in the following scenarios:\n>     \n>     -   Much of the traffic can not be accelerated by SecureXL\n>     -   Many IPS features enabled, which disable SecureXL functionality\n>     -   Large rulebase\n>     -   NAT rules\n> -   CoreXL will _**not**_ improve performance in the following scenarios:\n>     \n>     -   SecureXL accelerates much of the traffic\n>     -   Traffic mostly consists of VPN\n>     -   Traffic mostly consists of VoIP\n> -   It is very important to verify that the CPU cores are equally utilized (run the '`top`' command). If this is not the case, you should consider changing the distribution of the Secure Network Distributors (SNDs) and CoreXL FW instances.\n>     \n> -   Under normal circumstances, it is _**not**_ recommended for the SND and a CoreXL FW instance to share the same CPU core.  \n>     However, it is necessary in the following cases:\n>     \n>     -   When using a machine with exactly two cores. It is better for both SNDs and CoreXL FW instances to share CPU cores, instead of allocating only one CPU core to each.\n>     -   When you know that almost all of the packets are being processed in the _Accelerated path_, and you want to assign all CPU cores to this path. If the CoreXL FW instances do not process significant amount of traffic, then it is appropriate to share the CPU cores.\n> -   The interfaces affinity should be configured only to to CPU cores that are running as SNDs (CPU cores that are _**not**_ running CoreXL FW instances), with these exceptions:\n>     \n>     -   On machines with exactly **two** CPU cores (both SNDs and CoreXL FW instances use the same CPU cores).\n>     -   For tests, in which traffic is accelerated by SecureXL (if it is enabled).\n> -   If you replaced the CPU on the machine to a CPU with more/less CPU cores than the previous CPU, then you must reconfigure the number of CoreXL FW instances in the '`cpconfig`' menu.\n>     \n> -   In a cluster environment, changing the number of CoreXL Firewall instances should be treated as a version upgrade - a cluster member member with a higher number of CoreXL Firewall instances enters the '`Ready`' state. Refer to [sk42096 - Cluster member is stuck in 'Ready' state](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk42096).  \n>     To change the number of CoreXL Firewall instances, schedule a maintenance window and follow either a _Minimal Effort Upgrade_ procedure, or a _Zero Downtime Upgrade_ procedure from the [_Installation and Upgrade Guide_](https://support.checkpoint.com/product/531) for your version.\n>     \n> \n> **Changing the distribution of the SND, CoreXL FW instances, and daemons among the CPU cores:**\n> \n> Note: Run the '`fw ctl affinity -l -r -a -v`' command to see the current distribution.\n> \n> -   To change the distribution of the SND, CoreXL FW instances, and daemons, change the current affinities of interfaces and/or of daemons.\n>     \n>     Notes:\n>     \n>     -   To make the affinity settings persistent, edit the '`$FWDIR/conf/fwaffinity.conf`' file on Security Gateway (see the contents of the file for the correct syntax).\n>     -   To apply the configuration from the '`$FWDIR/conf/fwaffinity.conf`' file _on-the-fly_ (without reboot), execute the '`$FWDIR/scripts/fwaffinity_apply`' shell script on Security Gateway (see the contents of the script for available flags).\n> -   To ensure CoreXL's efficiency, all traffic must be directed to CPU cores that are running as SNDs (CPU cores that are _**not**_ running CoreXL FW instances).  \n>     Therefore, if you change affinities of interfaces and/or daemons, you will need to accordingly set the number of CoreXL FW instances and ensure that the CoreXL FW instances run on other CPU cores.\n>     \n> -   It is recommended to allocate an additional CPU core to the SND _**only**_ if all of the following conditions are met:\n>     \n>     -   Your platform has at least 8 CPU cores.\n>     -   The '`idle`' value (run '`top`' command and press 1 to display all CPU cores) for the CPU core currently running the SND is in the 0%-5% range.\n>     -   The sum of the '`idle`' values (run the '`top`' command and press 1 to display all CPU cores) for the CPU cores running CoreXL FW instances is significantly higher than 100%.\n>     \n>     If any of the above conditions are _**not**_ met, the default configuration of one processing core allocated to the SND is sufficient, and no further configuration is necessary.\n>     \n> -   It is recommended to allocate an additional CPU core to the FWD daemon if the Security Gateway is performing heavy logging.\n>     \n>     **Notes:**\n>     \n>     -   A Security Gateway with 20 cores or more automatically reassign one worker core for exclusive use by the FWD daemon for logging.\n>     -   Avoiding the CPU cores that are running the SND is important _**only**_ if these CPU cores are explicitly defined as affinities of interfaces. If interface affinities are set to 'Automatic', any CPU core that is _**not**_ running a CoreXL FW instance can be used for the FWD daemon, and interface traffic will be automatically diverted to other CPU cores.\n>     \n>     > _Example of configuration for machine with 8 CPU cores_:\n>     > \n>     > [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/8_CPUs_2_SNDs_5_FWs_1_Daemon.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/8_CPUs_2_SNDs_5_FWs_1_Daemon.png \"Click the image to see it in full size in a new tab/window\")\n>     \n\n### (3-5) Best practices - SecureXL with CoreXL\n\nShow / Hide best practices information\n\n> **Background:**\n> \n> When most of the traffic is accelerated by SecureXL (run '`fwaccel stats -s`' command), the load on CPU cores that run as Secure Network Distributor (SND) can be very high, while the load on CPU cores that run CoreXL FW instances can be very low. This is an inefficient utilization of CPU capacity.\n> \n> **Notes:**\n> \n> -   Traffic is processed by the CoreXL FW instances only when the traffic is _**not**_ accelerated by SecureXL (if SecureXL is installed and enabled).\n>     \n> -   With CoreXL, there are cases when performance **without** SecureXL is better than with it, even when SecureXL does manage to accelerate part of the traffic.\n>     \n> \n> **Packet flow:**\n> \n> When SecureXL is enabled, a packet enters the Security Gateway and first reaches the SecureXL device. The packet will be handled in one of three ways:\n> \n> 1.  _Accelerated path_ - The packet is completely handled by the SecureXL device. It is processed and forwarded to the network.\n>     \n> 2.  _Medium path_ (PXL) - Packet flow when the packet is handled by the SecureXL device, except for IPS (some protections) / VPN (in some configurations) / Application Control / Content Awareness / Anti-Virus / Anti-Bot / HTTPS Inspection / Proxy mode / Mobile Access / VoIP / Web Portals. The CoreXL layer passes the packet to one of the CoreXL FW instances to perform the processing.  \n>     This path is available only when CoreXL is enabled.\n>     \n> 3.  _Firewall path_ / _Slow path_ - The SecureXL device is unable to process the packet (refer to [sk32578 - SecureXL Mechanism](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk32578)). The packet is passed on to the CoreXL layer and then to one of the CoreXL FW instances for full processing.  \n>     This path also processes all packets when SecureXL is disabled.\n>     \n> \n> > [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/Packet_Flow.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/Packet_Flow.png \"Click the image to see it in full size in a new tab/window\")\n> \n> **Default affinity settings for interfaces:**\n> \n> -   If SecureXL is _enabled_ - the default affinities of all interfaces are 'Automatic' - the affinity for each interface is automatically reset every 60 seconds, and balanced between available CPU cores based on the current load.\n>     \n> -   If SecureXL is _disabled_ - the default affinities of all interfaces are with available CPU cores - those CPU cores that are _**not**_ running a CoreXL FW instance or _**not**_ defined as the affinity for a daemon.\n>     \n> \n> **Setting interface affinities:**\n> \n> -   If SecureXL is _enabled_ - the affinities of all interfaces are handled by the '`sim affinity`' command. Interface affinities are automatically distributed among CPU cores that are _**not**_ running CoreXL FW instances and that are _**not**_ set as the affinity for any daemon.\n>     \n>     **Note**: 'sim affinity' has been deprecated in R80.40 (refer to [sk170012](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk170012)). To configure affinity, refer to the section \"(3-4) CoreXL\".\n>     \n> -   If SecureXL is _disabled_ - interface affinities are loaded at boot based on the `$FWDIR/conf/fwaffinity.conf` configuration file (if SecureXL is _enabled_, then lines beginning with \"i\" in this file are ignored).\n>     \n> -   To balance the load on the CPU cores that are running as SNDs (CPU cores that are _**not**_ running CoreXL FW instances):\n>     \n>     1.  Check the amount of interrupts from each interface - run:\n>         \n>         _`[Expert@HostName]# cat /proc/interrupts`_\n>     2.  Check, which CPU cores (that run as SNDs) are most utilized - run:\n>         \n>         _`[Expert@HostName]# top`_\n>         \n>         Note: Press digit 1 (above the letter Q) to display all CPU cores and press Shift+W to save this configuration.\n>         \n>     3.  Assign the interfaces accordingly across the CPU cores that run as SNDs - run:\n>         \n>         _`[Expert@HostName]# sim affinity -s`_\n\n### (3-6) Best practices - SMT (HyperThreading)\n\nShow / Hide best practices information\n\n> **Notes:**\n> \n> -   SMT is _**not**_ recommended if only FireWall / IPSec VPN blades are used, because performance improvement by SMT is achieved on NGFW software blades.\n>     \n> -   SMT is _**not**_ recommended for environments that have high memory utilization.\n>     \n>     > Reason: Firewall consumes memory for traffic inspection. If the memory utilization is already very high before enabling the SMT, the performance will decrease noticeably because SMT adds more CoreXL FW instances.\n>     > \n>     > To check the extent of memory utilization on the Security Gateway, refer to:\n>     > \n>     > -   Initial diagnostics - Memory\n>     >     \n>     > -   Advanced diagnostics - Memory\n>     >     \n>     \n> -   SMT is _**not**_ recommended if these blades/features are enabled:\n>     \n>     -   Data Loss Prevention blade\n>     -   Anti-Virus in Traditional Mode\n>     -   Using Services with Resources in Firewall policy\n>     \n>     > Reason: Each of these blades might have high memory consumption. These blades run Security Servers that are executed per CoreXL FW instance. Since SMT adds more CoreXL FW instances, overall memory consumption on Security Gateway might increase considerably.\n>     > \n>     > To check the extent of memory utilization on the Security Gateway, refer to:\n>     > \n>     > -   Initial diagnostics - Memory\n>     >     \n>     > -   Advanced diagnostics - Memory\n>     >     \n>     \n> -   If you have two ports on 12600/12700/12800, 13500/13800 and 21000 appliances to handle most of the traffic, it is also recommended to enable **Multi-Queue feature** to increase SMT performance (refer to [Performance Tuning Administration Guide](https://support.checkpoint.com/product/530) for your version - Chapter \"Multi-Queue\").\n> \n> **Documentation:**\n> \n> -   [sk93000 - SMT (HyperThreading) Feature Guide](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk93000)\n\n### (3-7) Best practices - Multi-Queue\n\nShow / Hide best practices information\n\n> **When Multi-Queue will not help:**\n> \n> -   When most of the processing is done in CoreXL - either in the _Medium path_, or in the _Firewall path_ (_Slow path_).\n> -   All current CoreXL FW instances are highly loaded, so there are no CPU cores that can be reassigned to SecureXL.\n> -   When IPS, or other deep inspection Software Blades are heavily used.\n> -   When all network interface cards are processing the same amount of traffic.\n> -   When all CPU cores that are currently used by SecureXL are congested.\n> -   When trying to increase traffic session rate.\n> -   When there is not enough diversity of traffic flows. In the extreme case of a single flow, for example, traffic will be handled only by a single CPU core. (Clarification: The more traffic is passing to/from different ports/IP addresses, the more you benefit from Multi-Queue. If there is a single traffic flow from a single Client to a single Server, then Multi-Queue will not help.)\n> \n> **Guidelines for configuring Multi-Queue:**\n> \n> -   Network interface cards must support Multi-Queue.\n> -   Multi-Queue is relevant _**only**_ if SecureXL is enabled.\n> -   Multi-Queue is relevant _**only**_ if CoreXL is enabled.\n> -   Examine the CPU affinity (for interfaces (SND) and for CoreXL FW instances).\n> -   Examine the CPU utilization.\n> -   Decide if more CPU cores can be allocated to the Secure Network Distributor (SND).\n> \n> **Multi-Queue is recommended when all these conditions occur:**\n> \n> -   Load on CPU cores that run as SND is high (idle < 20%).\n> -   Load on CPU cores that run CoreXL FW instances is low (idle > 50%).\n> -   There are no CPU cores left to be assigned to the SND by changing interface affinity.\n> \n> **Number of active RX queues:**\n> \n> -   By default on a Security Gateway, the number of active RX queues is calculated by:  \n>     `Number of Active RX queues = [Total Number of CPU cores] - [Number of CoreXL FW instances]`\n>     \n> -   By default on a VSX gateway, the number of active RX queues is calculated by:  \n>     `Number of Active RX queues = The lowest CPU ID, to which the _fwk_ process on VSX is assigned`\n>     \n> \n> **Notes:**\n> \n> -   For Multi-Queue enhancements in Gaia 3.10 refer to: [sk153373 -](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk153373) [Multi-Queue Management for Check Point R80.30 with Gaia 3.10 kernel](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk153373)\n> -   For best performance, it is _**not**_ recommended to assign both SND and a CoreXL FW instance to the same CPU core.\n> -   Do _**not**_ change the IRQ affinity of queues manually. Changing the IRQ affinity of the queues manually can adversely affect performance.\n> \n> **Documentation:**\n> \n> -   [Performance Tuning Administration Guide](https://support.checkpoint.com/product/530) for your version - Chapter \"Multi-Queue\"\n\n### (3-8) Best practices - Rule Base optimization\n\nShow / Hide best practices information\n\n> 1.  Refer to [sk32578 - SecureXL Mechanism](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk32578) to allow more connections to be accelerated by SecureXL.\n>     \n> 2.  Place most used rules at the top - use the Hit Count in the SmartConsole / SmartDashboard (R75.40 and above) and SmartView Monitor ('Top' view).  \n>     **Note:** the new column-based matching of Gateways of version R80.10 and above eliminates this need.\n>     \n> 3.  In addition, you can provide a full Connections Table from your Security Gateway to [Check Point Support](http://www.checkpoint.com/services/contact/index.html) for thorough analysis (run the command '`fw tab -t connections -u > /var/log/Connections_Table.txt`').\n>     \n>     In versions R82 and higher versions you can use the _connview_ tool to collect the connections information. For more information refer to [R82 CLI Reference Guide](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_CLI_ReferenceGuide/Default.htm) > Security Gateway Commands.\n>     \n\n### (3-9) Best practices - IPS optimization\n\nShow / Hide best practices information\n\n> 1.  There are different IPS protections with different confidence levels and performance impacts.\n>     \n> 2.  The default Optimize Profile for IPS contains the best setup in terms of performance and reliability of the detection rate.\n>     \n> 3.  Deviation from the Optimize Profile can cause a performance impact on the environment and false positive detection.\n>     \n> 4.  Avoid setting protections to run in \"Detect\" mode - it might increase CPU consumption (without increasing the security).\n>     \n> 5.  Identify the protections that consume most of the CPU resources - follow [sk43733 - How to measure CPU time consumed by IPS protections](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk43733).\n>     \n> 6.  Disable protections that are not needed in your environment. To check, which protections are needed, you may use vulnerability tools (such as Nessus).\n>     \n> 7.  Set Protection Scope to \"_Protect internal hosts only_\" (SmartConsole - Security Gateway properties - IPS pane).  \n>     **Note:** This step is not needed with the improved IPS mechanism for Gateways of version R80.10 and above.\n>     \n> 8.  Using null TP profiles and blade-based global exceptions to exclude certain traffic from IPS inspection completely can improve the Security Gateway performance.  \n>     **Important:** You must be aware of the security implications of this configuration.\n>     \n\n### (3-10) Best practices - Application Control & URL Filtering optimization\n\nShow / Hide best practices information\n\n> **Application Control & URL Filtering policy:**\n> \n> 1.  Create as specific rules as possible, to prevent the unwanted traffic from hitting the wrong rule.\n>     \n>     Limit the scope of the rule by selecting only the relevant services (instead of the default '`Any`') - right-click on the column titles - click on the '`Service`' column:\n>     \n>     [](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/APPI_URLF_Service_Column.png \"Click the image to see it in full size in a new tab/window\")  \n>     ![Application Control & URL Filtering](https://sc1.checkpoint.com/sc/SolutionsStatics/sk98348/sk98348_Application_Control_URL_Filtering_policy202501081005451.png)\n> 2.  Avoid using \"_Any_\" in \"_Source_\" and \"_Destination_\" columns.\n>     \n> 3.  In the \"_Destination_\" column, use the default \"_Internet_\", unless a specific destination has to be explicitly selected (e.g., in case of internal servers).\n>     \n> 4.  There is **no** need for \"Clean Up\" rule at the bottom (because the behavior of Application Control & URL Filtering Blades is different from that of the Firewall Blade).  \n>     Such rule should only be used for short period of time and only for logging purposes.\n>     \n> 5.  Remove the \"_Any - Any - Allow_\" rule, if such rule exists (because the behavior of Application Control & URL Filtering Blades is different from that of the Firewall Blade).  \n>     Such rule should only be used for short period of time and only for logging purposes.\n>     \n> \n> **Advanced - Engine Settings:**\n> \n> 1.  Go to \"_Check Point Online Web Service_\" section.\n>     \n> 2.  In the \"_Website categorization mode_\" section, select \"_Background_\" (to prevent latency due to packet holding until categorization is completed).\n>     \n> \n> **Related solutions:**\n> \n> -   [sk174045 - Wrong rule match on the first access to a URL/Website](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk174045)\n\n### (3-11) Best practices - Anti-Virus & Anti-Bot optimization\n\nShow / Hide best practices information\n\n> **Anti-Virus & Anti-Bot policy:**\n> \n> 1.  Create as specific rules as possible, to prevent the unwanted traffic from hitting the wrong rule.\n>     \n> 2.  Avoid using \"_Any_\" in \"_Source_\" and \"_Destination_\" columns.\n>     \n> 3.  There is **no** need for \"Clean Up\" rule at the bottom (because the behavior of Anti-Virus & Anti-Bot Blades is different from that of the Firewall Blade).  \n>     Such rule should only be used for short period of time and only for logging purposes.\n>     \n> \n> **Advanced - Engine Settings:**\n> \n> 1.  Go to \"_Check Point Online Web Service_\" section.\n>     \n> 2.  In the \"_Website categorization mode_\" section, select \"_Background_\" (to prevent latency due to packet holding until categorization is completed).\n>     \n> \n> **Decreasing performance impact:**\n> \n> 1.  Edit the Anti-Virus & Anti-Bot profile:\n>     \n>     1.  Go to '`Profiles`' pane.\n>         \n>     2.  Select the relevant profile - click on '`Edit...`' button.\n>         \n>     3.  Go to '`General Properties`' pane.\n>         \n>     4.  In the '`Performance Impact`' field, select '`Low`'.\n>         \n>     5.  Click on '`OK`'.\n>         \n>     6.  Save the changes: go to '`File`' menu - click on '`Save`'.\n>         \n>     7.  Install the policy onto the relevant Security Gateway / Cluster object.\n>         \n> 2.  Exclude networks:\n>     \n>     Consider excluding networks, whose traffic does not have to be inspected - follow [sk92515 - How to configure Anti-Virus Exceptions](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92515).\n>     \n>     Note: Standard exceptions are still being inspected (i.e., CPU is consumed). However, the traffic will be allowed. The exceptions per [sk92515](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92515) are completely excluded from the Anti-Virus & Anti-Bot engine inspection (i.e., decrease the load on CPU).\n>     \n> 3.  Decrease the CPU consumption by RAD process and DLPU process:\n>     \n>     Consider disabling MD5 check and GZIP inspection - follow [sk94056 - When Anti-Virus and Anti-Bot blades are enabled, RAD process and DLPU process consume CPU at high level](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk94056).\n> 4.  Disable scanning of archive file:\n>     \n>     Consider disabling '`Archive Scanning`' because it requires high amount of CPU resources:\n>     \n>     1.  Go to '`Profiles`' pane.\n>         \n>     2.  Select the relevant profile - click on '`Edit...`' button.\n>         \n>     3.  Go to '`Anti-Virus Settings`' pane.\n>         \n>     4.  In the '`Archives`' section, uncheck the box '`Enable Archive scanning (impacts performance).`'.\n>         \n>     5.  Click on '`OK`'.\n>         \n>     6.  Save the changes: go to '`File`' menu - click on '`Save`'.\n>         \n>     7.  Install the policy onto the relevant Security Gateway / Cluster object.\n>         \n> 5.  Using a global exception.\n>     \n>     A blade-based global exception exclude traffic completely from Anti-Virus/Anti-Bot inspection and improve performance. Example for global exception:\n>     \n>     | No. | Protected Scope | Source | Destination | Protection/Site/File/Blade | Service |  Action  | Track |\n>     |-----|-----------------|--------|-------------|----------------------------|---------|----------|-------|\n>     |  1  |       Any       |  Any   |     Any     | Anti-Virus  \n>     Anti-Bot |   Any   | Inactive |  Log  |\n>     \n\n___\n\n## (4) Initial diagnostics\n\n### (4-1) Initial diagnostics - CPU\n\nShow / Hide initial diagnostics information\n\n> 1.  **`cpview`**\n>     \n>     Background:\n>     \n>     -   Displays the CPU utilization (and many other counters). Refer to [sk101878 - CPView Utility](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101878).\n>     \n>     Diagnostics:\n>     \n>     -   Monitor the CPU utilization during the problem\n>     \n>     Analysis:\n>     \n>     -   On the '`Overview`' tab, refer to '`CPU:`' section - look at counter '`Used`'\n>     -   On the '`I/S`' tab, go to '`CPU`' menu - go to '`Overview`' menu - refer to section '`CPU`'\n> 2.  **`cpstat -f multi_cpu os`**\n>     \n>     Background:\n>     \n>     -   Displays internal statistics for OS about all CPU cores as collected by Check Point\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem\n>     \n>     Analysis:\n>     \n>     -   Look at all the columns\n>     \n>     _Example from machine with 8 CPU cores_:\n>     \n>     > ```\n>     > Processors load\n>     > ---------------------------------------------------------------------------------\n>     > |CPU#|User Time(%)|System Time(%)|Idle Time(%)|Usage(%)|Run queue|Interrupts/sec|\n>     > ---------------------------------------------------------------------------------\n>     > |   1|           1|             2|          96|       4|        ?|             0|\n>     > |   2|           2|             4|          94|       6|        ?|             0|\n>     > |   3|           1|             1|          98|       2|        ?|             0|\n>     > |   4|           2|             3|          94|       6|        ?|             0|\n>     > ---------------------------------------------------------------------------------\n>     > ```\n>     \n> 3.  **`top`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/1/top](http://linux.die.net/man/1/top)\n>     -   Displays dynamic real-time view of a running system on Linux\n>     \n>     Usage:\n>     \n>     -   When running the command for the first time:\n>         \n>         1.  Press '1' to display all CPU cores\n>         2.  Press 'd' to set update interval - type 2 and press Enter\n>         3.  Press 'n' to set maximum tasks displayed - type 15 and press Enter\n>         4.  Press Shift+W to save the top's configuration\n>     -   When running the command for diagnostics:\n>         \n>         -   Press Shift+P to sort the output by CPU utilization\n>         -   Press Shift+M to sort the output by Memory utilization\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem\n>     \n>     Analysis:\n>     \n>     -   Look at the load in \"User Space\" - counter _us_  \n>         High CPU consumption in \"User Space\" can be caused by processes that perform heavy tasks (e.g., too much logging by _fwd_, reloading the configuration during policy installation, etc.)\n>     -   Look at the load in \"System (kernel) Space\" - counter _sy_  \n>         High CPU consumption in \"System (kernel) Space\" can be caused by heavy tasks (e.g., deep inspection of packets, enabling of all blades, enabling of all IPS protections in _Prevent_ mode, etc.)\n>     -   Look at the amount of \"Idle\" - counter _id_  \n>         The more CPU is idle, the better the machine's performance is\n>     -   Look at the amount of \"I/O waiting\" - counter _wa_  \n>         High amount of \"I/O waiting\" is caused by heavy reading from/writing to hard disk (e.g., during policy installation, heavy logging, insufficient RAM, etc.)\n>     -   Look at the amount of \"SoftIRQ\" - counter _si_  \n>         High amount of \"SoftIRQ\" is usually caused by high amount of traffic\n>     -   Look at the amount of \"Hardware IRQs\" - counter _hi_\n>     -   Look at the CPU consumption by the processes - column _%CPU_  \n>         Constant high CPU consumption by a process can be caused by numerous factors - function stack should be collected from the process using a [special Check Point shell script](https://supportcenter.checkpoint.com/supportcenter/portal/role/supportcenterUser/page/default.psml/media-type/html?action=portlets.DCFileAction&eventSubmit_doGetdcdetails=&fileid=32051) ('`pstack`') - refer to \"(5-1) Advanced diagnostics - CPU\" section  \n>         **Note** - You must be logged in to access the `pstack` script.  \n>         Related solution: [sk116740 - \"top\" command on VSX Gateway shows that FWK process consumes CPU at more than 100%](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk116740).\n>     \n>     _Example from machine with 2 CPU cores_:\n>     \n>     > ```\n>     > top - 15:18:47 up 14:06,  1 user,  load average: 0.55, 0.37, 0.35\n>     > Tasks: 213 total,   1 running, 212 sleeping,   0 stopped,   0 zombie\n>     > Cpu0  :  0.7%us,  0.7%sy,  0.0%ni, 97.3%id,  0.0%wa,  0.0%hi,  1.4%si,  0.0%st\n>     > Cpu1  :  0.7%us,  0.7%sy,  0.0%ni, 97.3%id,  0.0%wa,  0.0%hi,  1.4%si,  0.0%st\n>     > Cpu2  :  0.0%us,  0.7%sy,  0.0%ni, 98.6%id,  0.0%wa,  0.0%hi,  0.7%si,  0.0%st\n>     > Cpu3  :  2.0%us,  3.4%sy,  0.0%ni, 93.3%id,  0.0%wa,  0.0%hi,  1.3%si,  0.0%st\n>     > Mem:   2005908k total,  1907412k used,    98496k free,   103952k buffers\n>     > Swap:  4225084k total,   323268k used,  3901816k free,   198288k cached\n>     > \n>     >   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND\n>     > 16948 admin     24   0 71692  10m 4744 S    2  0.6  15:14.00 DAService\n>     >  4103 admin     15   0     0    0    0 S    1  0.0   8:38.37 fw_worker_0\n>     >  4105 admin     15   0     0    0    0 S    1  0.0  10:46.19 fw_worker_2\n>     >  4104 admin     15   0     0    0    0 S    1  0.0   4:05.49 fw_worker_1\n>     >     1 admin     15   0  2040  720  624 S    0  0.0   0:01.44 init\n>     >     2 admin     RT  -5     0    0    0 S    0  0.0   0:01.82 migration/0\n>     >     3 admin     15   0     0    0    0 S    0  0.0   0:00.02 ksoftirqd/0\n>     > ... ... ...\n>     > ```\n>     \n> 4.  **`ps auxwwwf`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/1/ps](http://linux.die.net/man/1/ps)\n>     -   Displays information about the current processes (daemons)\n>     \n>     Usage:\n>     \n>     -   Refer to the manual page\n>     -   By default, output is sorted by _PID_ column\n>     -   Simplest sorting can be done by pipelining the output of _`ps`_ command to _`sort`_ command - for example, to sort the CPU usage, run:  \n>         _`[Expert@HostName]# ps auxww | sort -nrk 3`_\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem\n>     \n>     Analysis:\n>     \n>     -   Look at the amount of \"_CPU_\", \"_MEM_\", \"_VSZ_\", \"_RSS_\", \"_TIME_\" consumed by the daemons\n>     -   Constant high CPU consumption can be caused by numerous factors - function stack should be collected from the process using a [special Check Point shell script](https://supportcenter.checkpoint.com/supportcenter/portal/role/supportcenterUser/page/default.psml/media-type/html?action=portlets.DCFileAction&eventSubmit_doGetdcdetails=&fileid=32051) ('`pstack`') - refer to \"(5-1) Advanced diagnostics - CPU\" section\n>     \n>     _Example_ (excerpt):\n>     \n>     > ```\n>     > USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\n>     > admin        1  0.0  0.0   2040   720 ?        Ss   01:12   0:01 init [3]\n>     > admin        2  0.0  0.0      0     0 ?        S&lt;   01:12   0:01 [migration/0]\n>     > admin        3  0.0  0.0      0     0 ?        S    01:12   0:00 [ksoftirqd/0]\n>     > admin        4  0.0  0.0      0     0 ?        S&lt;   01:12   0:00 [watchdog/0]\n>     > ..................\n>     > admin     4103  1.0  0.0      0     0 ?        S    01:13   8:41 [fw_worker_0]\n>     > admin     4104  0.4  0.0      0     0 ?        S    01:13   4:07 [fw_worker_1]\n>     > admin     4105  1.2  0.0      0     0 ?        S    01:13  10:50 [fw_worker_2]\n>     > admin     4115  0.0  0.2  13976  4184 ?        Ss   01:13   0:02 /opt/CPshrd-R77/bin/cpwd\n>     > admin     5098  0.2  2.4 342988 49860 ?        Ssl  01:13   2:07  \\_ cpd\n>     > admin     5136  0.0  0.3 153612  6216 ?        Ss   01:13   0:00  \\_ mpdaemon /opt/CPshrd-R77/log/\n>     > ..................\n>     > admin     5374  0.1  5.6 610672 113844 ?       Ssl  01:13   1:32  \\_ fwd\n>     > admin     5449  0.0  0.4  27856  9232 ?        S    01:13   0:00  |   \\_ cpca\n>     > admin     5720  0.0  2.0 207256 41100 ?        S    01:13   0:01  |   \\_ syslog 514 all\n>     > admin     6030  0.0  2.7 295536 54336 ?        Sl   01:14   0:06  |   \\_ vpnd 0\n>     > admin     6033  0.0  2.5 239748 52012 ?        Sl   01:14   0:15  |   \\_ pdpd 0 -t\n>     > admin     6034  0.0  2.5 211336 50924 ?        S    01:14   0:11  |   \\_ pepd 0 -t\n>     > admin     6036  0.0  2.1 233164 43804 ?        Sl   01:14   0:02  |   \\_ fwpushd 0\n>     > admin     6038  0.0  0.6  35016 13232 ?        S    01:14   0:00  |   \\_ wstlsd 0 0\n>     > ..................\n>     > admin     5382  0.5  7.5 453272 151396 ?       Ssl  01:13   4:18  \\_ fwm\n>     > admin     5390  0.0  1.0  46240 21504 ?        Ss   01:13   0:00  \\_ status_proxy\n>     > admin     5750  0.0  0.8  35228 17264 ?        Ss   01:13   0:01  \\_ rad\n>     > admin     5827  0.0  1.1  42500 22748 ?        Ss   01:13   0:00  \\_ cpstat_monitor\n>     > admin     5996  0.0  0.5  57176 11516 ?        Ssl  01:14   0:02  \\_ fwucd\n>     > admin     6022  0.0  1.0 132424 21652 ?        Ssl  01:14   0:03  \\_ dlpu -i 0 0\n>     > ..................\n>     > admin     4636  0.0  0.3  25020  7784 ?        Ss   01:13   0:00 /bin/pm\n>     > admin     4653  0.1  0.5  31620 11908 ?        Ss   01:13   1:02  \\_ /bin/confd\n>     > admin     4654  0.1  0.7  38040 14312 ?        SNsl 01:13   0:57  \\_ /bin/searchd -niceboost 10\n>     > admin     4656  0.0  0.4  99740  9880 ?        Ssl  01:13   0:01  \\_ /bin/rconfd /etc/actions_mapping.xml\n>     > admin     4657  0.0  0.1   6472  3824 ?        Ss   01:13   0:18  \\_ /bin/monitord\n>     > admin     4683  0.0  0.3  25252  7168 ?        Ss   01:13   0:00  \\_ /bin/cloningd\n>     > admin     4685  0.0  0.1  10048  2348 pts/0    Ss+  01:13   0:00  \\_ /bin/clishd default server\n>     > admin     4687  0.0  0.1  19032  2796 ?        Ssl  01:13   0:00  \\_ /bin/clish -p\n>     > admin     4688  0.0  0.0   2948   868 ?        Ss   01:13   0:00  \\_ /usr/bin/tclsh /usr/libexec/netflowd\n>     > admin     4689  0.0  0.3  30360  7368 ?        Ss   01:13   0:07  \\_ /usr/sbin/snmpd -f -c /etc/snmp/userDefinedSettings.conf\n>     > admin     5041  0.0  0.3  32768  6912 ?        Ss   01:13   0:00  \\_ /bin/routed -N\n>     > admin     5047  0.0  0.3  33128  7820 ?        S    01:13   0:00  |   \\_ /bin/routed -i default -f /etc/routed0.conf -h 0\n>     > ..................\n>     > admin     9438  0.0  0.0   1652   496 tty1     Ss+  01:14   0:00 /sbin/agetty 9600 tty1\n>     > admin     9439  0.0  0.0   1648   500 tty2     Ss+  01:14   0:00 /sbin/agetty 9600 tty2\n>     > admin     9440  0.0  0.0   1652   504 tty3     Ss+  01:14   0:00 /sbin/agetty 9600 tty3\n>     > admin     9441  0.0  0.0   2416  1052 ?        Ss   01:14   0:00 /bin/bash /bin/console_agetty\n>     > admin     9463  0.0  0.0   1652   508 tty4     Ss+  01:14   0:00  \\_ /sbin/agetty 9600 tty4 vt100\n>     > admin    16948  2.1  0.5  71692 11072 ?        Sl   03:15  15:21 /opt/CPda/bin/DAService\n>     > ```\n>     \n> 5.  **`cat /proc/interrupts`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/5/proc](http://linux.die.net/man/5/proc)\n>     -   Displays the number of interrupts on each CPU core from each IRQ\n>     \n>     Usage:\n>     \n>     -   Refer to the manual page\n>     -   By default, output is sorted by IRQ number\n>     -   The only relevant devices are network interfaces\n>     -   To shorten the output, use the '`grep`' command - for example, run:  \n>         _`[Expert@HostName]# cat /proc/interrupts | grep -E \"CPU|eth\"`_\n>     -   To collect this output continuously, use the '`watch`' command - for example, run:  \n>         _`[Expert@HostName]# watch -d -n 1 'cat /proc/interrupts | grep -E \"CPU|eth\"'`_\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem\n>     \n>     Analysis:\n>     \n>     -   Look at the general trend - which CPU receives more interrupts and from which interfaces\n>     -   If some CPU cores receive more interrupts than others, then affinity of interfaces to CPU cores should be optimized - interface should be redistributed better\n>     \n>     _Example from machine with 4 CPU cores and 4 interfaces_:\n>     \n>     > ```\n>     >            CPU0       CPU1       CPU2       CPU3\n>     >   0:   51254849          0          0          0    IO-APIC-edge  timer\n>     >   1:          4          0          0          5    IO-APIC-edge  i8042\n>     >   6:          2          3          0          0    IO-APIC-edge  floppy\n>     >   7:          0          0          0          0    IO-APIC-edge  parport0\n>     >   8:          3          0          0          0    IO-APIC-edge  rtc\n>     >   9:          0          0          0          0   IO-APIC-level  acpi\n>     >  12:          0          0          0        115    IO-APIC-edge  i8042\n>     >  15:        302       1043        168       1127    IO-APIC-edge  ide1\n>     > <strong> 59:     320145       6732       5944       6189   IO-APIC-level  ioc0, eth3</strong>\n>     > <strong> 67:   15765753          0          0          0   IO-APIC-level  eth0</strong>\n>     > <strong> 75:      24271       1285         36          0   IO-APIC-level  eth1</strong>\n>     > <strong> 83:      24272          0       1322          0   IO-APIC-level  eth2</strong>\n>     > NMI:          0          0          0          0\n>     > LOC:   50950084   50945459   50949418   50945128\n>     > ERR:          0\n>     > MIS:          0\n>     > ```\n>     \n> 6.  **`cat /proc/cpuinfo`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/5/proc](http://linux.die.net/man/5/proc)\n>     -   Displays a collection of CPU and system architecture dependent items about CPU (on multi-CPU (SMP) machines will show information for each CPU)\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the information about CPU (architecture, vendor, number)\n>     \n>     Analysis:\n>     \n>     -   Look at the processor number\n>     -   Look at the processor model\n>     -   Look at the CPU clock frequency\n>     -   Look at the supported flags (e.g., _`pae`_)\n>     \n>     _Example_ (excerpt):\n>     \n>     > ```\n>     > processor       : 0\n>     > vendor_id       : GenuineIntel\n>     > cpu family      : 6\n>     > model           : 44\n>     > model name      : Intel(R) Xeon(R) CPU           E5645  @ 2.40GHz\n>     > stepping        : 2\n>     > cpu MHz         : 2399.483\n>     > cache size      : 12288 KB\n>     > physical id     : 0\n>     > siblings        : 2\n>     > core id         : 0\n>     > cpu cores       : 2\n>     > fdiv_bug        : no\n>     > hlt_bug         : no\n>     > f00f_bug        : no\n>     > coma_bug        : no\n>     > fpu             : yes\n>     > fpu_exception   : yes\n>     > cpuid level     : 11\n>     > wp              : yes\n>     > flags           : fpu vme de pse tsc msr <em><strong>pae</strong></em> mce ...\n>     > bogomips        : 4806.12\n>     > ```\n>     \n> 7.  **`dmesg`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/dmesg](http://linux.die.net/man/8/dmesg)\n>     -   Displays the Linux kernel ring buffer - bootup messages from various kernel modules and hardware components\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to search for errors from various kernel modules and hardware components\n>     \n>     Analysis:\n>     \n>     -   Check each line for kernel boot parameters (e.g., _vmalloc_), errors, failures, components/features being disabled\n\n### (4-2) Initial diagnostics - Memory\n\nShow / Hide initial diagnostics information\n\n> Related solution: [sk115072 - How to determine amount of installed RAM on Check Point Appliance](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk115072).\n> \n> 1.  **`cpview`**\n>     \n>     Background:\n>     \n>     -   Displays the Memory utilization (and many other counters). Refer to [sk101878 - CPView Utility](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101878).\n>     \n>     Diagnostics:\n>     \n>     -   Monitor the Memory utilization during the problem\n>     \n>     Analysis:\n>     \n>     -   On the '`Overview`' tab, refer to '`Memory:`' section - look at counters '`Free MB`'\n>     -   On the '`I/S`' tab, go to '`Memory`' menu - go to '`FW-Kernel`' menu - refer to section '`Firewall kernel memory usage summary:`' - look at counter '`%Usage`'\n> 2.  **`fw ctl pstat`**\n>     \n>     Background:\n>     \n>     -   Displays FireWall internal statistics about memory and traffic\n>     \n>     Diagnostics:\n>     \n>     -   Collect the output _before_ and _after_ the suspected problem\n>     -   Use different flags to get more data:  \n>         -   for HMEM: _`fw ctl pstat -h`_\n>         -   for SMEM: _`fw ctl pstat -s`_\n>         -   for KMEM: _`fw ctl pstat -k`_\n>         -   for Handles (kbufs): _`fw ctl pstat -l`_\n>     -   Counters are reset when Check Point Services are stopped (with '`cpstop`' command)\n>     -   Under memory, '`allocations`' counter always grows, may wrap around\n>     \n>     Analysis:\n>     \n>     -   No single field that indicates a problem - need to interpret all counters together\n>     -   HMEM  \n>         -   failures under HMEM - no real memory problem, just mean HMEM is full ; HMEM should have been configured larger\n>         -   \"_`failed allocations`_\" under HMEM (only) do not indicate any problem\n>     -   SMEM  \n>         -   failures under SMEM - reached Check Point memory limit , exhausted OS memory, large non-sleep allocation , indicate some shortage\n>         -   \"_`failed allocations`_\" under SMEM may not mean that a user's allocation failed, maybe HMEM extension failed\n>         -   \"_`failed free`_\" under SMEM means an overrun or freeing an invalid pointer - indicates a bug\n>     -   KMEM  \n>         -   failures under KMEM - application asked for memory and could not get it , usually, it is a memory problem\n>         -   \"_`failed allocations`_\" under KMEM means that the application didn't get memory\n>     \n>     _Example_:\n>     \n>     > ```\n>     > System Capacity Summary:\n>     >   Memory used: 12% (183 MB out of 1515 MB) - below watermark\n>     >   Concurrent Connections: 79 (Unlimited)\n>     >   Aggressive Aging is not active\n>     > \n>     > Hash kernel memory (hmem) statistics:\n>     >   Total memory allocated: 155189248 bytes in 37888 (4096 bytes) blocks using 37 pools\n>     >   Total memory bytes  used: 33563132   unused: 121626116 (78.37%)   peak: 53675664\n>     >   Total memory blocks used:     9082   unused:    28806 (76%)   peak:    13407\n>     >   Allocations: 96170689 alloc, 0 failed alloc, 95799050 free\n>     > \n>     > System kernel memory (smem) statistics:\n>     >   Total memory  bytes  used: 280891432   peak: 297288060\n>     >   Total memory bytes wasted: 12156438\n>     >     Blocking  memory  bytes   used:   902804   peak:   933368\n>     >     Non-Blocking memory bytes used: 279988628   peak: 296354692\n>     >   Allocations: 10526 alloc, 1 failed alloc, 8437 free, 0 failed free\n>     >   vmalloc bytes  used:  7340032 expensive: yes\n>     > \n>     > Kernel memory (kmem) statistics:\n>     >   Total memory  bytes  used: 159039668   peak: 185833572\n>     >   Allocations: 96179738 alloc, 1 failed alloc\n>     >                95807459 free, 0 failed free\n>     >   External Allocations: 0 for packets, 63652 for SXL\n>     > \n>     > Cookies:\n>     >         17293941 total, 0 alloc, 0 free,\n>     >         19087 dup, 17386724 get, 117090 put,\n>     >         32037742 len, 0 cached len, 0 chain alloc,\n>     >         0 chain free\n>     > \n>     > Connections:\n>     >         82980 total, 31766 TCP, 50795 UDP, 7 ICMP,\n>     >         412 other, 0 anticipated, 0 recovered, 79 concurrent,\n>     >         568 peak concurrent\n>     > \n>     > Fragments:\n>     >         0 fragments, 0 packets, 0 expired, 0 short,\n>     >         0 large, 0 duplicates, 0 failures\n>     > \n>     > NAT:\n>     >         0/0 forw, 0/0 bckw, 0 tcpudp,\n>     >         0 icmp, 0-0 alloc\n>     > \n>     > Sync: off\n>     > ```\n>     \n> 3.  **`cpstat -f memory os`**\n>     \n>     Background:\n>     \n>     -   Displays internal statistics for OS about memory as collected by Check Point\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem (usually, over some time period)\n>     \n>     Analysis:\n>     \n>     -   High memory consumption can be caused by high amount of traffic\n>     -   Constant increase in memory consumption might suggest some memory leak - follow [sk35496 - How to detect a memory leak on Security Gateway with SecurePlatform OS / Gaia OS](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk35496)\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Total Virtual Memory (Bytes):  6380535808\n>     > Active Virtual Memory (Bytes): 1882390528\n>     > Total Real Memory (Bytes):     2054049792\n>     > Active Real Memory (Bytes):    1643986944\n>     > Free Real Memory (Bytes):      410062848\n>     > Memory Swaps/Sec:              -\n>     > Memory To Disk Transfers/Sec:  -\n>     > ```\n>     \n> 4.  **`cat /proc/meminfo`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/5/proc](http://linux.die.net/man/5/proc)\n>     -   Displays the amount of free and used memory (both physical and swap) on the system as well as the shared memory and buffers used by the kernel\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem (usually, over some time period)\n>     \n>     Analysis:\n>     \n>     -   Sum up these counters: _`MemFree`_ + _`Buffers`_ + _`Cached`_, and compare the result with counter _`MemTotal`_ - follow [sk42717 - How to read the output of 'cat /proc/meminfo' on Linux-based system](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk42717)\n>     -   Constant increase in memory consumption might suggest some memory leak - follow [sk35496 - How to detect a memory leak on Security Gateway with SecurePlatform OS / Gaia OS](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk35496)\n>     \n>     _Example_:\n>     \n>     > ```\n>     > MemTotal:      2005908 kB\n>     > RawMemTotal:   2097152 kB\n>     > MemFree:         95092 kB\n>     > Buffers:        107136 kB\n>     > Cached:         198520 kB\n>     > SwapCached:      90452 kB\n>     > Active:        1335364 kB\n>     > Inactive:       121220 kB\n>     > HighTotal:      262016 kB\n>     > HighFree:          808 kB\n>     > LowTotal:      1743892 kB\n>     > LowFree:         94284 kB\n>     > SwapTotal:     4225084 kB\n>     > SwapFree:      3901816 kB\n>     > Dirty:             864 kB\n>     > Writeback:           0 kB\n>     > AnonPages:     1137312 kB\n>     > Mapped:         108660 kB\n>     > Slab:            82164 kB\n>     > PageTables:      19132 kB\n>     > NFS_Unstable:        0 kB\n>     > Bounce:              0 kB\n>     > CommitLimit:   5228036 kB\n>     > Committed_AS:  4025512 kB\n>     > VmallocTotal:   247800 kB\n>     > VmallocUsed:    114732 kB\n>     > VmallocChunk:   117952 kB\n>     > HugePages_Total:     0\n>     > HugePages_Free:      0\n>     > HugePages_Rsvd:      0\n>     > Hugepagesize:     2048 kB\n>     > ```\n>     \n> 5.  **`dmesg`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/dmesg](http://linux.die.net/man/8/dmesg)\n>     -   Displays the Linux kernel ring buffer - bootup messages from various kernel modules and hardware components\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to search for errors from various kernel modules and hardware components\n>     \n>     Analysis:\n>     \n>     -   Check each line for kernel boot parameters (e.g., _vmalloc_), errors, failures, components/features being disabled\n\n### (4-3) Initial diagnostics - Network interface cards\n\nShow / Hide initial diagnostics information\n\n> **Important related solution for R80.10 and lower:** [sk110351 - Traffic latency on VSX Gateway if MTU larger than 4096 (Jumbo Frames) is configured on an interface](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk110351).\n> \n> 1.  **`cpview`**\n>     \n>     Background:\n>     \n>     -   Displays the traffic and interfaces statistics (and many other counters). Refer to [sk101878 - CPView Utility](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101878).\n>     \n>     Diagnostics:\n>     \n>     -   Monitor the traffic and interfaces during the problem\n>     \n>     Analysis:\n>     \n>     -   On the '`Overview`' tab, refer to '`Traffic counters:`' section\n>     -   On the '`SysInfo`' tab, refer to '`Hardware Information:`' section\n>     -   On the '`Traffic`' tab, go to '`Overview`' menu - refer to '`Traffic Rate:`' section\n>     -   On the '`Traffic`' tab, go to '`Overview`' menu - refer to '`Concurrent Connections:`' section\n>     -   On the '`Traffic`' tab, go to '`Overview`' menu - refer to '`Interface drops:`' section\n>     -   On the '`Traffic`' tab, go to '`Interfaces`' menu - refer to '`Errors and Drops:`' section\n> 2.  **`netstat -ni`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/netstat](http://linux.die.net/man/8/netstat)\n>     -   Displays a table of all network interfaces\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem (usually, over some time period)\n>     \n>     Analysis:\n>     \n>     -   _RX-OK_ - number of packets that have been received error-free\n>     -   _RX-ERR_ - number of packets that have been received damaged (refer to [sk61922](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk61922))\n>     -   _RX-DRP_ - number of received packets that have been dropped (refer to [sk61922](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk61922))\n>     -   _RX-OVR_ - number of received packets that have been lost because of an overrun (number of times the receiver hardware was unable to hand received data to a hardware buffer - the internal FIFO buffer of the chip is full, but is still tries to handle incoming traffic ; most likely, the input rate of traffic exceeded the ability of the receiver to handle the data)\n>     -   _TX-OK_ - number of packets that have been transmitted error-free\n>     -   _TX-ERR_ - number of packets that have been transmitted damaged\n>     -   _TX-DRP_ - number of transmitted packets that have been dropped\n>     -   _TX-OVR_ - number of transmitted packets that have been lost because of an overrun\n>     -   _Flg_ - shows the flags that have been set for this interface - these characters are one-character versions of the long flag names that are displayed in the output of '_ifconfig_' command:  \n>         -   _A_ = this interface will receive all Multicast addresses\n>         -   _B_ = a Broadcast address has been set\n>         -   _D_ = debugging is turned on\n>         -   _L_ = this interface is a loopback device\n>         -   _M_ = all packets are received (promiscuous mode)\n>         -   _m_ = master\n>         -   _N_ = trailers are avoided\n>         -   _O_ = ARP is turned off for this interface\n>         -   _P_ = this is a Point-to-Point connection\n>         -   _R_ = interface is running\n>         -   _s_ = slave\n>         -   _U_ = interface is up\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Kernel Interface table \n>     > Iface       MTU  Met      RX-OK RX-ERR  RX-DRP RX-OVR      TX-OK TX-ERR TX-DRP TX-OVR Flg\n>     > br0        1500    0    4384062      0       0      0         28      0      0      0 BMRU\n>     > eth0       1500    0   12505484      0       0      0   20359171      0      0      0 BMRU\n>     > eth1       1500    0   11882710      0      62      0  449677832      0      0      0 BMRU\n>     > eth2       1500    0 2592575900 362803 3626586      0 1158425513      0      0      0 BMRU\n>     > eth3       1500    0 1189952933     30 9382997      0 2575575506      0      0      0 BMRU\n>     > lo        16436    0     174524      0       0      0     174524      0      0      0 LRU\n>     > ```\n>     \n> 3.  **`ifconfig _name_of_interface_`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/ifconfig](http://linux.die.net/man/8/ifconfig)\n>     -   Displays the status and traffic statistics for the currently active interfaces\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem (usually, over some time period)\n>     \n>     Analysis:\n>     \n>     -   _UP_ - indicates that the kernel modules related to the Ethernet interface has been loaded\n>     -   _BROADCAST_ - indicates that interface supports broadcasting - a necessary characteristic to obtain IP address via DHCP\n>     -   _NOTRAILERS_ - indicates that trailer encapsulation is disabled (Linux usually ignore trailer encapsulation so this value has no effect at all)\n>     -   _RUNNING_ - indicates that interface is ready to accept data\n>     -   _MULTICAST_ - indicates that the interface supports multicasting\n>     -   _MTU_ - Maximum Transmission Unit is the size of each packet received by the interface (default value is 1500; setting MTU to a higher value could hazard packet fragmentation or buffer overflows)\n>     -   _Metric_ - used to compute the cost of a route - it tells the OS, to which interface a packet should be forwarded, when multiple interfaces could be used to reach the packet's destinationTakes values of 0,1,2,3,... The lower the value, the more leverage it has. This parameter has significance only while routing packets. For example, if you have two Ethernet cards and you want to forcibly make your machine use one card over the other in sending the data. Then you can set the Metric value of the Ethernet card which you favor lower than that of the other Ethernet card.\n>     -   _RX packets_ - total number of packets received via the interface\n>     -   _RX errors_ - number of damaged packets received (refer to [sk61922](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk61922))\n>     -   _RX dropped_ - number of dropped packets due to reception errors (refer to [sk61922](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk61922))\n>     -   _RX overruns_ - number of received packets that experienced data overruns (number of times the receiver hardware was unable to hand received data to a hardware buffer)\n>     -   _RX frame_ - number received packets that experienced frame errors\n>     -   _TX packets_ - total number of packets transmitted via the interface\n>     -   _TX errors_ - number of packets that experienced transmission error\n>     -   _TX dropped_ - number of dropped transmitted packets due to transmission errors\n>     -   _TX overruns_ - number of transmitted packets that experienced data overruns (number of times the transmitter hardware was unable to hand received data to a hardware buffer)\n>     -   _TX carriers_ - number received packets that experienced loss of carriers\n>     -   _TX collisions_ \\- number of transmitted packets that experienced Ethernet collisions (a nonzero value of this field indicates possibility of network congestion)\n>     -   _TX txqueuelen_ - configured length of transmission queue\n>     -   _RX bytes_ - total bytes received over this interface\n>     -   _TX bytes_ - total total bytes transmitted over this interface\n>     \n>     _Example_:\n>     \n>     > ```\n>     > eth0        Link encap:Ethernet  HWaddr 00:50:56:AA:69:33\n>     >             inet addr:172.30.41.90  Bcast:172.30.255.255  Mask:255.255.0.0\n>     >             UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n>     >             RX packets:21363169 errors:0 dropped:0 overruns:0 frame:0\n>     >             TX packets:128400 errors:0 dropped:0 overruns:0 carrier:0\n>     >             collisions:0 txqueuelen:1000\n>     >             RX bytes:1608073037 (1.4 GiB)  TX bytes:33703584 (32.1 MiB)\n>     > ```\n>     \n> 4.  **`netstat -anp`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/netstat](http://linux.die.net/man/8/netstat)\n>     -   Displays both listening and non-listening (for TCP this means established connections) sockets\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem (usually, over some time period)\n>     \n>     Analysis:\n>     \n>     -   Under \"_`Active Internet connections`_\" look at \"_`Recv-Q`_\" and at \"_`Send-Q`_\"\n>     -   _Recv-Q_ - data (in bytes), which has not yet been pulled from the socket buffer by the application (value should be as close to 0 as possible)\n>     -   _Send-Q_ - data (in bytes), which the sending application has given to the transport, but has yet to be ACKnowledged by the receiving TCP (value should be as close to 0 as possible - a large number may indicate a network bottleneck)\n>     \n>     _Example_:\n>     \n>     > ```\n>     > [Expert@FW]# netstat -anp\n>     > Active Internet connections (servers and established)\n>     > Proto <strong>Recv-Q</strong> <strong>Send-Q</strong> Local Address           Foreign Address         State          PID/Program name\n>     > tcp        0   <strong>2368</strong> 172.30.20.69:22         172.30.20.228:3676      ESTABLISHED 16179/0\n>     > udp   <strong>256956</strong>      0 0.0.0.0:9282            0.0.0.0:*\n>     > [Expert@FW]#\n>     > ```\n>     \n> 5.  **`ethtool _name_of_interface_`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/ethtool](http://linux.die.net/man/8/ethtool)\n>     -   Displays Ethernet card settings\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to check the current status\n>     \n>     Analysis:\n>     \n>     -   Check every line of the output\n>     -   Configuration on both ends of the cable should be identical (speed /duplex / auto-negotiation)\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Settings for eth0:\n>     >         Supported ports: [ TP ]\n>     >         Supported link modes:   10baseT/Half 10baseT/Full\n>     >                                 100baseT/Half 100baseT/Full\n>     >                                 1000baseT/Full\n>     >         Supports auto-negotiation: Yes\n>     >         Advertised link modes:  10baseT/Half 10baseT/Full\n>     >                                 100baseT/Half 100baseT/Full\n>     >                                 1000baseT/Full\n>     >         Advertised auto-negotiation: Yes\n>     >         Speed: 1000Mb/s\n>     >         Duplex: Full\n>     >         Port: Twisted Pair\n>     >         PHYAD: 1\n>     >         Transceiver: internal\n>     >         Auto-negotiation: on\n>     >         Supports Wake-on: d\n>     >         Wake-on: d\n>     >         Current message level: 0x00000007 (7)\n>     >         Link detected: yes\n>     > ```\n>     \n> 6.  **`ethtool -i _name_of-interface_`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/ethtool](http://linux.die.net/man/8/ethtool)\n>     -   Displays information about associated driver\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to check the current status\n>     \n>     Analysis:\n>     \n>     -   Use driver with [NAPI](http://en.wikipedia.org/wiki/NAPI)\n>     -   Use the latest version of the driver\n>     \n>     _Example_:\n>     \n>     > ```\n>     > driver: e1000\n>     > version: 7.6.15.5-NAPI\n>     > firmware-version: N/A\n>     > bus-info: 0000:02:00.0\n>     > ```\n>     \n> 7.  **`ethtool -g _name_of-interface_`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/ethtool](http://linux.die.net/man/8/ethtool)\n>     -   Displays information about RX/TX ring parameters\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to check the current status\n>     \n>     Analysis:\n>     \n>     -   Check the current size of the buffers versus the maximum allowed - follow [sk42181 - How to increase sizes of buffer on SecurePlatform/Gaia for Intel NIC and Broadcom NIC](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk42181)\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Ring parameters for eth0:\n>     > Pre-set maximums:\n>     > RX:             4096\n>     > RX Mini:        0\n>     > RX Jumbo:       0\n>     > TX:             4096\n>     > Current hardware settings:\n>     > RX:             256\n>     > RX Mini:        0\n>     > RX Jumbo:       0\n>     > TX:             1024\n>     > ```\n>     \n> 8.  **`arp -an | wc -l`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/arp](http://linux.die.net/man/8/arp)\n>     -   Displays the system's ARP cache table\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to check the current status\n>     \n>     Analysis:\n>     \n>     -   Check the number of entries in the ARP table\n>     -   Refer to [sk43772 - 'kernel: neighbour table overflow' appears repeatedly in /var/log/messages files](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk43772)\n>     -   Refer to [sk92372 - How to change the size of IPv6 Neighbors cache table](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92372)\n>     \n>     _Example_:\n>     \n>     > ```\n>     > [Expert@HostName]# arp -an | wc -l\n>     > 1\n>     > [Expert@HostName]# arp -an\n>     > ? (172.30.1.1) at 00:1C:EB:1C:B4:43 [ether] on eth0\n>     > [Expert@HostName]# arp -en\n>     > Address                  HWtype  HWaddress           Flags Mask            Iface\n>     > 172.30.1.1               ether   00:1C:EB:1C:B4:43   C                     eth0\n>     > [Expert@HostName]# \n>     > ```\n>     \n> 9.  **`dmesg`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/dmesg](http://linux.die.net/man/8/dmesg)\n>     -   Displays the Linux kernel ring buffer - bootup messages from various kernel modules and hardware components\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to search for errors from various kernel modules and hardware components\n>     \n>     Analysis:\n>     \n>     -   Check each line for kernel boot parameters (e.g., _vmalloc_), errors, failures, components/features being disabled\n\n### (4-4) Initial diagnostics - SecureXL\n\nShow / Hide initial diagnostics information\n\n> 1.  **`cpview`**\n>     \n>     Background:\n>     \n>     -   Displays the SecureXL status and statistics (and many other counters). Refer to [sk101878 - CPView Utility](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101878).\n>     \n>     Diagnostics:\n>     \n>     -   Monitor the SecureXL performance during the problem\n>     \n>     Analysis:\n>     \n>     -   On the '`SysInfo`' tab, refer to '`Configuration Information:`' section - look at '`PPack Status`'\n>     -   On the '`Traffic`' tab, go to '`Overview`' menu - refer to section '`Templates:`'\n>     -   On the '`I/S`' tab, go to '`SXL`' menu - go to '`Overview`' menu\n> 2.  **`fwaccel stat`**\n>     \n>     Background:\n>     \n>     -   Displays the status of SecureXL and SecureXL Templates\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to check the current status\n>     \n>     Analysis:\n>     \n>     -   \"_Accelerator Status_\" should be \"_on_\"\n>     -   \"_Accept Templates_\" should be \"_enabled_\"\n>     -   If \"_Accept Templates_\" are \"_disabled_\" from a specific rule, then optimize the rulebase - follow [sk32578 - SecureXL Mechanism](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk32578)\n>     -   [](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk66402)Status of \"_NAT Templates_\" is determined by [sk71200 - SecureXL NAT Templates](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk71200)\n>     -   \"_Cryptography Features_\" section appears only if SecureXL device supports cryptography, or if a VPN Accelerator card is installed on the machine.\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Accelerator Status : on\n>     > Accept Templates   : disabled by Firewall\n>     >                                disabled from rule #31\n>     > Drop Templates     : disabled\n>     > NAT Templates      : disabled by user\n>     > \n>     > Accelerator Features : Accounting, NAT, Cryptography, Routing,\n>     >                        HasClock, Templates, Synchronous, IdleDetection,\n>     >                        Sequencing, TcpStateDetect, AutoExpire,\n>     >                        DelayedNotif, TcpStateDetectV2, CPLS, WireMode,\n>     >                        DropTemplates, NatTemplates, Streaming,\n>     >                        MultiFW, AntiSpoofing, ViolationStats,\n>     >                        Nac, AsychronicNotif, ERDOS\n>     > Cryptography Features : Tunnel, UDPEncapsulation, MD5, SHA1, NULL,\n>     >                         3DES, DES, CAST, CAST-40, AES-128, AES-256,\n>     >                         ESP, LinkSelection, DynamicVPN, NatTraversal,\n>     >                         EncRouting, AES-XCBC, SHA256\n>     > ```\n>     \n> 3.  **`fwaccel stats -s`**\n>     \n>     Background:\n>     \n>     -   Displays summary of SecureXL acceleration statistics\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem\n>     \n>     Analysis:\n>     \n>     -   If the ratio of \"_Accelerated/Total_\" is less than 80%, it means that acceleration is poor, and the optimization is required\n>     -   The higher the ratio of \"_F2Fed pkts/Total pkts_\" is, the more traffic is Forwarded to Firewall for inspection (the poorer the performance is) - see the _`fwaccel conns`_ command below\n>     -   The higher the ratio of \"_PXL pkts/Total pkts_\" is, the more packets passed in _Medium path_. Meaning, packets were handled by the SecureXL device, except for IPS / Application Control / Anti-Virus / Anti-Bot processing. The CoreXL layer passed the packets to one of the CoreXL FW instances to perform the processing. This path is available only when CoreXL is enabled.\n>     -   The higher the ratio of \"_QXL pkts/Total pkts_\" is, the more packets were processed by QoS.\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Accelerated conns/Total conns : 364/13215 (2%)\n>     > Delayed conns/(Accelerated conns + PXL conns) : 48/12023 (0%)\n>     > Accelerated pkts/Total pkts   : 18252/564927 (3%)\n>     > F2Fed pkts/Total pkts   : 36776/564927 (6%)\n>     > PXL pkts/Total pkts   : 509899/564927 (90%)\n>     > QXL pkts/Total pkts   : 0/564927 (0%)\n>     > ```\n>     \n> 4.  **`fwaccel conns`**\n>     \n>     Background:\n>     \n>     -   Displays entries from SecureXL connections table\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem (**Important Note:** This command consumes high amount of memory)\n>     \n>     Analysis:\n>     \n>     -   Look at the _Flags_ column:  \n>         \n>         -   _U_ = Unidirectional - the connection can pass data on either C2S or S2C - data packets from the opposite direction will be F2F'ed\n>         -   _N_ = NAT is being performed on the connection by the device\n>         -   _A_ = Accounting is performed on the connection (the connection is viewed by either rulebase accounting or SmartView Monitor)\n>         -   _C_ = Encryption is done on the connection by the device\n>         -   _W_ = the connection is in wire mode\n>         -   _P_ = Partial (versions R70 and higher)\n>         -   _S_ = Streaming - PXL (versions R70 and higher)\n>         -   _F_:  \n>             -   In R81 and higher = Fast accelerated connection.\n>             -   In R80.40 and lower = Forward to Firewall - the connection is not accelerated  \n>                 -   To quickly determine the amount of F2F connections:  \n>                     1.  Check the total number of connections in SecureXL connections table:  \n>                         _`[Expert@HostName]# fwaccel conns -s`_\n>                     2.  Check the total number of F2F connections:  \n>                         _`[Expert@HostName]# fwaccel conns | grep ' F' | grep -v 'Flags' | wc -l`_\n>                 -   To see why specific connections are Forwarded to Firewall, run kernel debug. Refer to \"(5-4) Advanced diagnostics - SecureXL\" section\n>         \n>         _Example_ (all IP addresses were replaced by \"X\"):\n>         \n>         > ```\n>         > Source        SPort Destination    DPort PR Flags   C2S i/f   S2C i/f\n>         > ------------- ----- -------------- ----- -- ------- --------- ---------\n>         >    X.X.X.X     61242    X.X.X.X      80  6 ..N.... eth5/eth0 eth0/eth5\n>         >    X.X.X.X      6000    X.X.X.X    3842  6 ....... eth0/eth4 eth4/eth0\n>         >    X.X.X.X      1620    X.X.X.X      88 17 ....... eth4/eth2 eth2/eth4\n>         >    X.X.X.X     50829    X.X.X.X      80  6 ..N.... eth5/eth0 eth0/eth5\n>         >    X.X.X.X      4285    X.X.X.X      80  6 F.N.... eth5/eth0 eth0/eth5\n>         >    X.X.X.X        80    X.X.X.X   49312  6 F.N.... eth5/eth0 eth0/eth5\n>         >    X.X.X.X        80    X.X.X.X   11450  6 ..N.... eth5/eth0 eth0/eth5\n>         >    X.X.X.X     58562    X.X.X.X      80  6 F.N.... eth5/eth0 eth0/eth5\n>         >    X.X.X.X       161    X.X.X.X    5002 17 F...... eth2/eth2 -/-\n>         >    X.X.X.X     21891    X.X.X.X       0  1 F...... eth2/eth4 eth4/eth2\n>         >    X.X.X.X     34303    X.X.X.X     389  6 F.N.... eth2/eth2 eth2/-\n>         > ```\n>         \n>     -   **`fwaccel templates`**\n>         \n>         Background:\n>         \n>         -   Displays SecureXL Connection Templates  \n>             Note: Size of Templates table (_cphwd\\_tmpl_, id 8111) is limited to 1/4 of the size of Firewall Connections Table (_connections_, id 8158).\n>         \n>         Diagnostics:\n>         \n>         -   Collect this output continuously during the problem (**Important Note:** This command consumes high amount of memory)\n>         \n>         Analysis:\n>         \n>         -   Check whether templates are created:  \n>             _`[Expert@HostName]# fwaccel templates -s`_\n>         -   Check whether templates were created for relevant connections (search for relevant IP addresses using the _`grep`_ command)\n>         -   Look at the _Flags_ column:  \n>             -   You should not see connections with _F_, _N_, or _C_ flags\n>             -   _F_ = Forward to Firewall - the connection is not accelerated\n>             -   _U_ = Unidirectional - the connection can pass data on either C2S or S2C - data packets from the opposite direction will be F2F'ed\n>             -   _N_ = NAT is being performed on the connection by the device\n>             -   _A_ = Accounting is performed on the connection (the connection is viewed by either rulebase accounting or SmartView Monitor)\n>             -   _C_ = Encryption is done on the connection by the device\n>             -   _W_ = the connection is in wire mode\n>             -   _P_ = Partial (versions R70 and higher)\n>             -   _S_ = Streaming - PXL (versions R70 and higher)\n>             -   _D_ = Drop Template\n>             -   _L_ = Log drop action\n>         -   The _LCT_ column - shows how many seconds ago a connection was created by the template\n>         -   The _DLY_ column - shows Delayed Synchronization value for the template\n>         \n>         _Example_ (all IP addresses were replaced by \"X\"):\n>         \n>         > ```\n>         > Source       SPort Destination  DPort PR  Flags     LCT DLY C2S i/f S2C i/f Inst Identity\n>         > ------------ ----- ------------ ----- -- --------- ---- --- ------- ------- ---- --------\n>         >   X.X.X.X     *    X.X.X.X        161 17 ...A...S.   65   0 36/21   21/36    0        0\n>         >   X.X.X.X     *    X.X.X.X        161 17 ...A...S.    5   0 36/8    8/36     1        0\n>         >   X.X.X.X     *    X.X.X.X       1437 17 ...A...S.   27   0 36/8    8/36     1        0\n>         >   X.X.X.X     *    X.X.X.X        161 17 ...A...S.   23   0 36/21   21/36    2        0\n>         >   X.X.X.X     *    X.X.X.X         88 17 ...A...S.   11   0 8/36    36/8     4        0\n>         > ```\n>         \n>     -   **`sim if`**\n>         \n>         Background:\n>         \n>         -   Displays the list of interfaces used and seen by the SecureXL\n>         \n>         Diagnostics:\n>         \n>         -   Collect this output to see the current status\n>         \n>         Analysis:\n>         \n>         -   Look at the _Name_ column and _Address_ column\n>         -   Look at the _F_ column (refer to \"(6-1-B) 'sim' command\" section - 'sim if' command)\n>         \n>         _Example_:\n>         \n>         > ```\n>         >  Name      | Address         | MTU  | F | SIM F | IRQ | Dev        | Output\n>         >  --------------------------------------------------------------------------------\n>         >  eth0      | 172.30.168.38   | 1500 | 039 | 00000 |  67 | 0x85b1b000 | 0xffffffff\n>         >  eth1      | 10.20.30.38     | 1500 | 029 | 00008 |  75 | 0xbc5d3000 | 0xffffffff\n>         >  eth2      | 10.5.0.1        | 1500 | 029 | 00000 |  83 | 0xbcbbb000 | 0xffffffff\n>         > ```\n>         \n>     -   **`sim affinity -l`**\n>         \n>         Background:\n>         \n>         -   Displays the current affinity of network interfaces to CPU cores\n>         \n>         Diagnostics:\n>         \n>         -   Collect this output to see the current status\n>         \n>         Check the SIM Affinity mode:\n>         \n>         -   If SIM Affinity was configured in _Static_ mode, then the following configuration file should exist and should _**not**_ be empty:\n>             \n>             _\\[Expert@HostName\\]# cat `$PPKDIR/boot/modules/sim_aff.conf`_\n>         -   If SIM Affinity was configured in _Automatic_ mode, then the following Task should exist in CPD Scheduler:\n>             \n>             _\\[Expert@HostName\\]# cpd\\_sched\\_config print | grep -A 5 \"Sim\\_Affinity\"_\n>             \n>             ```\n>             Task: \"Sim_Affinity\"\n>                     Command: sim\n>                     Arguments: affinity -c\n>                     Interval: 60\n>                     Active: true\n>                     RunAtStart: false \n>             ```\n>             \n>         \n>         _Example_:\n>         \n>         > ```\n>         > eth0 : 0\n>         > eth1 : 0\n>         > eth2 : 1\n>         > eth3 : 1\n>         > ```\n>         \n\n### (4-5) Initial diagnostics - CoreXL\n\nShow / Hide initial diagnostics information\n\n> 1.  **`cpview`**\n>     \n>     Background:\n>     \n>     -   Displays the CoreXL status and statistics (and many other counters). Refer to [sk101878 - CPView Utility](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101878).\n>     \n>     Diagnostics:\n>     \n>     -   Monitor the CoreXL performance during the problem\n>     \n>     Analysis:\n>     \n>     -   On the '`SysInfo`' tab, refer to '`Configuration Information:`' section - look at '`CoreXL Status`'\n>     -   On the '`SysInfo`' tab, refer to '`Configuration Information:`' section - look at '`CoreXL instances`'\n>     -   On the '`I/S`' tab, go to '`CoreXL`' menu - go to '`General`' menu - refer to '`Queues:`' section - look at counter '`Enqueue fail`'\n>     -   On the '`I/S`' tab, go to '`CoreXL`' menu - go to '`Instances`' menu - activate the statistics (!may affect performance) - go to each CoreXL FW instance ('`FW-Instance<N>`'):\n>         -   refer to '`FW Stats`' section\n>         -   refer to '`Top FW-Lock consumers:`' section\n> 2.  **`fw ctl multik stat`**\n>     \n>     Background:\n>     \n>     -   Displays status of CoreXL instances and summary for traffic that passes through each CoreXL FW instance (current number and peak number of concurrent connections)\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     Analysis:\n>     \n>     -   Check the number and the allocation of FW instances to CPU cores (in cluster, the output must be identical on all members)\n>     -   Check the peak number connections on FW instances (instances should be loaded as equally as possible)\n>     \n>     _Example from machine with 4 CPU cores (1 SND + 3 CoreXL FW instances)_:\n>     \n>     > ```\n>     > ID | Active  | CPU    | Connections | Peak\n>     > ----------------------------------------------\n>     >  0 | Yes     | 3      |          26 |       66\n>     >  1 | Yes     | 2      |          36 |       64\n>     >  2 | Yes     | 1      |          39 |       53\n>     > ```\n>     \n> 3.  **`fw ctl affinity -l -r -v -a`**\n>     \n>     Background:\n>     \n>     -   Displays affinity of interfaces, processes and CoreXL FW instances to CPU cores\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     Analysis:\n>     \n>     -   Check the affinity settings (of interfaces, processes and FW instances) to CPU cores (in cluster, the output must be identical on all members)\n>     -   The interfaces affinity should be configured only to to CPU cores that are running as SNDs (CPU cores that are _**not**_ running CoreXL FW instances)\n>     -   Under normal circumstances, it is _**not**_ recommended for the SND and a CoreXL FW instance to share the same CPU core\n>     \n>     _Example from machine with 4 CPU cores and 4 interfaces (1 SND + 3 CoreXL FW instances)_:\n>     \n>     > ```\n>     > CPU 0:  eth0 (irq 67) eth3 (irq 59)\n>     > CPU 1:  eth1 (irq 75)\n>     >         fw_2\n>     > CPU 2:  eth2 (irq 83)\n>     >         fw_1\n>     > CPU 3:  fw_0\n>     > All:    mpdaemon fwucd cpca vpnd fwm ... cpd cprid\n>     > ```\n>     \n> 4.  **`cat /proc/interrupts`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/5/proc](http://linux.die.net/man/5/proc)\n>     -   Displays the number of interrupts on each CPU core from each IRQ\n>     \n>     Usage:\n>     \n>     -   Refer to the manual page\n>     -   By default, output is sorted by IRQ number\n>     -   The only relevant devices are network interfaces\n>     -   To shorten the output, use the '`grep`' command - for example, run:  \n>         _`[Expert@HostName]# cat /proc/interrupts | grep -E \"CPU|eth\"`_\n>     -   To collect this output continuously, use the '`watch`' command - for example, run:  \n>         _`[Expert@HostName]# watch -d -n 1 'cat /proc/interrupts | grep -E \"CPU|eth\"'`_\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem\n>     \n>     Analysis:\n>     \n>     -   Look at the general trend - which CPU receives more interrupts and from which interfaces\n>     -   If some CPU cores receive more interrupts than others, then affinity of interfaces to CPU cores should be optimized - interface should be redistributed better\n>     \n>     _Example from machine with 8 CPU cores and 5 interfaces_:\n>     \n>     > ```\n>     >            CPU0       CPU1       CPU2       CPU3\n>     >   0:   51254849          0          0          0    IO-APIC-edge  timer\n>     >   1:          4          0          0          5    IO-APIC-edge  i8042\n>     >   6:          2          3          0          0    IO-APIC-edge  floppy\n>     >   7:          0          0          0          0    IO-APIC-edge  parport0\n>     >   8:          3          0          0          0    IO-APIC-edge  rtc\n>     >   9:          0          0          0          0   IO-APIC-level  acpi\n>     >  12:          0          0          0        115    IO-APIC-edge  i8042\n>     >  15:        302       1043        168       1127    IO-APIC-edge  ide1\n>     > <strong> 59:     320145       6732       5944       6189   IO-APIC-level  ioc0, eth3</strong>\n>     > <strong> 67:   15765753          0          0          0   IO-APIC-level  eth0</strong>\n>     > <strong> 75:      24271       1285         36          0   IO-APIC-level  eth1</strong>\n>     > <strong> 83:      24272          0       1322          0   IO-APIC-level  eth2</strong>\n>     > NMI:          0          0          0          0\n>     > LOC:   50950084   50945459   50949418   50945128\n>     > ERR:          0\n>     > MIS:          0\n>     > ```\n>     \n\n___\n\n## (5) Advanced diagnostics\n\n### (5-1) Advanced diagnostics - CPU\n\nShow / Hide advanced diagnostics information\n\n> 1.  **`cpview`**\n>     \n>     Background:\n>     \n>     -   Displays the CPU utilization (and many other counters). Refer to [sk101878 - CPView Utility](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101878).\n>     \n>     Diagnostics:\n>     \n>     -   Monitor the CPU utilization during the problem\n>     \n>     Analysis:\n>     \n>     -   On the '`I/S`' tab, go to '`CPU`' menu - go to '`Contexts`' menu - refer to section '`Contexts`'\n> 2.  **`vmstat [-n] [_delay_in_sec_ [_number_of_samples_]]`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/vmstat](http://linux.die.net/man/8/vmstat)\n>     -   Displays information about processes, memory, paging, block IO, and CPU activity\n>     \n>     Usage:\n>     \n>     -   Refer to the manual page\n>     -   By default, the output's header (with names of columns) is displayed every 20 samples. If output is redirected to a file, then it will be very difficult to analyze it using such commands as '`grep`' / '`awk`'. Therefore, if output is redirected to a file, use the '`-n`' flag to display the header only once (at the very top) - run:  \n>         _`[Expert@HostName]# vmstat -n [_delay_in_sec_ [_number_of_samples_]]`_\n>     -   By default, only 1 sample is printed (with the average values since boot). Therefore, to collect this output continuously, specify the delay between the samples - run:  \n>         _`[Expert@HostName]# vmstat [-n] _delay_in_sec_ [_number_of_samples_]`_\n>     -   If you specified the delay between the samples, then the output will be collected indefinitely (until the command is stopped or killed). If you want to limit the output, then specify the total number of samples - run:  \n>         _`[Expert@HostName]# vmstat [-n] _delay_in_sec_ _number_of_samples_`_\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem\n>     \n>     Analysis:\n>     \n>     -   Look at the \"_`procs`_\" section - number of processes waiting for CPU (counter _`r`_)\n>     -   Look at the \"_`swap`_\" section - reading from swap file (_`si`_) and writing to swap file (_`so`_)\n>     -   Look at the \"_`io`_\" section - reading from hard disk (_`bi`_) and writing to hard disk (_`bo`_)\n>     -   Look at the \"_`system`_\" section - number of Context Switches (_`cs`_)\n>     -   Look at the \"_`cpu`_\" section - at all counters:  \n>         -   \"User Space\" - counter _`us`_\n>         -   \"System (kernel) Space\" - counter _`sy`_\n>         -   \"Idle\" - counter _`id`_\n>         -   \"I/O waiting\" - counter _`wa`_\n>     \n>     _Example_:\n>     \n>     > ```\n>     > procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu------\n>     >  r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n>     >  2  0 323280 100128 103192 198132    1    2     8    35  117  130  2  3 96  0  0\n>     >  2  0 323280 100400 103196 198132    0    0     0   260 1297 6904  1  4 95  0  0\n>     >  1  0 323280 100404 103196 198132    0    0     0     0 1289 7100  1  4 95  0  0\n>     >  7  0 323280 100252 103200 198132    0    0     0    32 1308 6971  0  2 97  0  0\n>     >  1  0 323280 100428 103200 198132    0    0     0     0 1265 7111  1  3 97  0  0\n>     > ```\n>     \n> 3.  **`sar [-u] [-P { <cpu> | ALL }] [_interval_in_sec_ [_number_of_samples_]]`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/1/sar](http://linux.die.net/man/1/sar)\n>     -   Displays information about CPU activity, network devices, memory, paging, block IO, etc.\n>     \n>     Usage:\n>     \n>     -   Refer to [sk112734 - How to collect System Activity Report using the \"sar\" command](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk112734)\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output during the problem\n>     \n>     Analysis:\n>     \n>     -   Look at the load in \"User Space\" - counter _user_  \n>         High CPU consumption in \"User Space\" can be caused by processes that perform heavy tasks (e.g., too much logging by _fwd_, reloading the configuration during policy installation, etc.)\n>     -   Look at the load in \"System (kernel) Space\" - counter _system_  \n>         High CPU consumption in \"System (kernel) Space\" can be caused by heavy tasks (e.g., deep inspection of packets, enabling of all blades, enabling of all IPS protections in _Prevent_ mode, etc.)\n>     -   Look at the amount of \"Idle\" - counter _idle_  \n>         The more CPU is idle, the better the machine's performance is\n>     -   Look at the amount of \"I/O waiting\" - counter _iowait_  \n>         High amount of \"I/O waiting\" is caused by heavy reading from/writing to hard disk (e.g., during policy installation, heavy logging, insufficient RAM, etc.)\n>     -   Look at the counter _steal_ - Percentage of time spent in involuntary wait by the virtual CPU or CPUs while the hypervisor was servicing another virtual processor.\n>     \n>     _Example_:\n>     \n>     > ```\n>     > [Expert@R77-GW:0]# sar -u\n>     > Linux 2.6.18-92cp (R77-GW)      08/04/16\n>     > \n>     > 16:10:01          CPU     %user     %nice   %system   %iowait    %steal     %idle\n>     > 16:20:01          all      0.50      0.00      1.49      0.43      0.00     97.58\n>     > 16:30:01          all      0.53      0.00      1.78      0.36      0.00     97.32\n>     > 16:40:01          all      0.53      0.00      1.55      0.24      0.00     97.68\n>     > 16:50:01          all      0.51      0.00      1.76      0.26      0.00     97.46\n>     > 17:00:01          all      0.51      0.21      1.71      0.33      0.00     97.25\n>     > 17:10:01          all      0.48      0.00      1.57      0.35      0.00     97.59\n>     > 17:20:01          all      0.49      0.00      1.64      0.31      0.00     97.57\n>     > 17:30:01          all      0.48      0.00      1.60      0.48      0.00     97.44\n>     > 17:40:01          all      0.48      0.00      1.61      0.31      0.00     97.60\n>     > 17:50:01          all      0.50      0.00      1.68      0.32      0.00     97.51\n>     > 18:00:01          all      0.49      0.18      1.44      0.29      0.00     97.60\n>     > 18:10:01          all      0.48      0.00      1.76      0.45      0.00     97.31\n>     > 18:20:01          all      0.49      0.00      1.71      0.32      0.00     97.48\n>     > 18:30:01          all      0.49      0.00      1.53      0.41      0.00     97.56\n>     > 18:40:01          all      0.53      0.00      1.88      0.32      0.00     97.26\n>     > 18:50:01          all      0.49      0.00      1.56      0.29      0.00     97.66\n>     > Average:          all      0.50      0.02      1.64      0.34      0.00     97.49\n>     > [Expert@R77-GW:0]#\n>     > \n>     > [Expert@R77-GW:0]# sar -P 1\n>     > Linux 2.6.18-92cp (R77-GW)      08/04/16\n>     > \n>     > 16:10:01          CPU     %user     %nice   %system   %iowait    %steal     %idle\n>     > 16:20:01            1      0.51      0.00      1.28      0.20      0.00     98.01\n>     > 16:30:01            1      0.52      0.00      1.41      0.03      0.00     98.04\n>     > 16:40:01            1      0.51      0.00      1.35      0.04      0.00     98.10\n>     > 16:50:01            1      0.47      0.00      1.38      0.01      0.00     98.14\n>     > 17:00:01            1      0.52      0.20      1.37      0.05      0.00     97.86\n>     > 17:10:01            1      0.47      0.00      1.39      0.08      0.00     98.06\n>     > 17:20:01            1      0.51      0.00      1.38      0.11      0.00     98.01\n>     > 17:30:01            1      0.50      0.00      1.36      0.20      0.00     97.94\n>     > 17:40:01            1      0.49      0.00      1.30      0.08      0.00     98.14\n>     > 17:50:01            1      0.49      0.00      1.37      0.11      0.00     98.03\n>     > Average:            1      0.50      0.02      1.36      0.09      0.00     98.03\n>     > [Expert@R77-GW:0]#\n>     > ```\n>     \n> 4.  **`sh pstack_sym.sh _<PID_of_problematic_daemon>_`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/1/pstack](http://linux.die.net/man/1/pstack)\n>     -   Displays a stack trace of a running process\n>     -   Check Point R&D have created a special shell script to collect the necessary information based on the 'pstack' utility\n>     \n>     Usage:\n>     \n>     1.  [Download the package](https://supportcenter.checkpoint.com/supportcenter/portal/role/supportcenterUser/page/default.psml/media-type/html?action=portlets.DCFileAction&eventSubmit_doGetdcdetails=&fileid=32051) that contains the 'pstack' utility and special Check Point shell script that collects the necessary information.\n>         \n>     2.  Transfer the package to the problematic machine (into some directory, e.g., `/some_path_to_pstack/`).\n>         \n>     3.  Navigate to the directory with the package:\n>         \n>         **`[Expert@HostName]# cd /some_path_to_pstack/`**\n>     4.  Unpack the package:\n>         \n>         **`[Expert@HostName]# tar -xvf pstack_sym.tar`**\n>     5.  Install the 'pstack' utility:\n>         \n>         **`[Expert@HostName]# rpm -ihv --force --nodeps pstack-1.1-7.i386.rpm`**\n>         \n>         Note: there is no need to restart any service or to reboot the machine.\n>     6.  Determine the PID of the problematic daemon (that consumes the CPU at high level) - run the **`top`** command and look at the left-most column '`PID`'.\n>         \n>         Alternatively, if you already know the name of the daemon, run this command:\n>         \n>         **`[Expert@HostName]# ps auxw | grep -v grep | grep -i NAME_OF_PROBLEMATIC_DAEMON_THAT_CONSUMES_CPU | awk '{print $2}'`**\n>     7.  During the problem, run the special shell script at least 5-7 times:\n>         \n>         **`[Expert@HostName]# sh pstack_sym.sh _<PID_of_problematic_daemon>_`**\n>         \n>         **Important Note:** It might take 10-15 minutes for the script to complete the analysis - please wait patiently.\n>         \n>         1.  run the script\n>         2.  wait until the script finishes\n>         3.  follow the instructions on the screen\n>         4.  run the script\n>         5.  wait until the script finishes\n>         6.  follow the instructions on the screen\n>         7.  etc., etc., etc.\n>     8.  Send the following to [Check Point Support](https://www.checkpoint.com/support-services/contact-support/) for analysis:\n>         \n>         -   Outputs collected by the script (location is shown on the screen)\n>         -   Log files from the problematic daemon (should be located either in `$CPDIR/log/`, or in `$FWDIR/log/`)\n>         -   CPinfo file from the problematic machine (just to see the versions and the configuration)\n>     \n>     Analysis:\n>     \n>     -   All the outputs will be analyzed by Check Point Support and R&D\n>     \n>     _Example_:\n>     \n>     > ```\n>     > [Expert@FW]# sh pstack_sym.sh 30477\n>     >  \n>     > **************************************************\n>     > Starting the analysis - please wait patiently\n>     > **************************************************\n>     >  \n>     > \n>     > 30477: cpd\n>     > (No symbols found)\n>     > 0x77751db7 : select + 57 (libc-2.3.2.so) (112, 7f9b7de0, 7f9b85e0, 7f9b8de0, 779c3244, 0) + 1850\n>     > 0x779acaac : T_event_mainloop_iter_select + 1ec (libComUtils.so) (87f8b90, 779c3244, 96, 779a6259, 779a4560, 779c3738) + 20\n>     > 0x779ad23f : T_event_mainloop_iter + 16f (libComUtils.so) (87f8b90, 77f95218, 0, 885dad8, 7f9b9678, 77fb5250) + 10\n>     > 0x779ad298 : T_event_mainloop_e + 28 (libComUtils.so) (87f8b90, 805359c)\n>     > 0x77f12402 : opsec_mainloop + 22 (libopsec.so) (885dc88, 0, 80516f2, 770d, 0, 0) + 9a0\n>     > 0x0804cfd8 : /opt/CPshrd-R71/bin/cpd + 4fd8 (1, 7f9ba0c4, 7f9ba0cc, 0, 777b1898, 77fbe020) + 40\n>     > 0x776917fd : __libc_start_main + ed (libc-2.3.2.so) (804cb10, 1, 7f9ba0c4, 80509e0, 8050a28, 77fb5be0) + 80645f48\n>     >  \n>     > **************************************************\n>     > This script has completed the analysis\n>     > **************************************************\n>     >  \n>     >  \n>     > Going to TAR the output files :\n>     > ----------------------------------\n>     > tar: Removing leading `/' from member names\n>     > tmp/pstack_30477.out\n>     > tmp/pstack_30477_FINAL_OUTPUT.txt\n>     > tmp/pstack_30477_maps.out\n>     > tmp/pstack_30477_objdump.out\n>     > tmp/pstack_30477_proc-stat.txt\n>     > tmp/pstack_30477_ps_auxxxwwf.txt\n>     > tmp/pstack_30477_top.txt\n>     > opt/CPshrd-R71/log/cpwd.elg\n>     > opt/CPshrd-R71/log/cpwd.elg.1\n>     > opt/CPshrd-R71/log/cpwd.elg.2\n>     > var/log/messages\n>     > var/log/messages.1\n>     > var/log/messages.2\n>     > var/log/messages.3\n>     > var/log/messages.4\n>     > \n>     >  \n>     > Please send the following file to Check Point Support...\n>     > ----------------------------------\n>     > /tmp/pstack_30477.tar\n>     > ----------------------------------\n>     >  \n>     > [Expert@FW]#\n>     > ```\n>     \n> 5.  `perf top`\n>     \n>     Description:\n>     \n>     -   The `perf top` command is used for real time system profiling and functions similarly to the `top` utility. However, where the `top` utility generally shows you how much CPU time a given process or thread is using, `perf top` shows you how much CPU time each specific function uses. In its default state, `perf top` tells you about functions being used across all CPUs in both the user-space and the kernel-space. To use perf top you need root access.\n>         \n>     \n>     Usage:\n>     \n>     -   `perf top [-e <EVENT> | --event=EVENT] [<options>]`\n>         \n>     \n>     For a list of the available options, refer to the [perf-top - Linux manual page](https://man7.org/linux/man-pages/man1/perf-top.1.html).\n>     \n>     _Example output_:\n>     \n>     > ```\n>     > Samples: 8K of event 'cycles', 2000 Hz, Event count (approx.): 4579432780 lost: 0/0 drop: 0/0\n>     > Overhead  Shared Object       Symbol\n>     >    2.20%  [kernel]            [k] do_syscall_64\n>     >    2.17%  [kernel]            [k] module_get_kallsym\n>     >    1.49%  [kernel]            [k] copy_user_enhanced_fast_string\n>     >    1.37%  libpthread-2.29.so  [.] pthread_mutex_lock 1.31% [unknown] [.] 0000000000000000 1.07% [kernel] [k] psi_task_change 1.04% [kernel] [k] switch_mm_irqs_off 0.94% [kernel] [k] fget\n>     >    0.74%  [kernel]            [k] entry_SYSCALL_64\n>     >    0.69%  [kernel]            [k] syscall_return_via_sysret\n>     >    0.69%  libxul.so           [.] 0x000000000113f9b0\n>     >    0.67%  [kernel]            [k] kallsyms_expand_symbol.constprop.0\n>     >    0.65%  firefox             [.] moz_xmalloc\n>     >    0.65%  libpthread-2.29.so  [.] __pthread_mutex_unlock_usercnt\n>     >    0.60%  firefox             [.] free\n>     >    0.60%  libxul.so           [.] 0x000000000241d1cd\n>     >    0.60%  [kernel]            [k] do_sys_poll\n>     >    0.58%  [kernel]            [k] menu_select\n>     >    0.56%  [kernel]            [k] _raw_spin_lock_irqsave\n>     >    0.55%  perf                [.] 0x00000000002ae0f3\n>     >   \n>     > ```\n>     \n\n### (5-2) Advanced diagnostics - Memory\n\nShow / Hide advanced diagnostics information\n\n> 1.  **`cpview`**\n>     \n>     Background:\n>     \n>     -   Displays the Memory utilization (and many other counters). Refer to [sk101878 - CPView Utility](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101878).\n>     \n>     Diagnostics:\n>     \n>     -   Monitor the Memory utilization during the problem\n>     \n>     Analysis:\n>     \n>     -   On the '`I/S`' tab, go to '`Memory`' menu - go to '`FW-Kernel`' menu - refer to section '`KMEM:`' - look at counter '`Failed`'\n>     -   On the '`I/S`' tab, go to '`Memory`' menu - go to '`FW-Kernel`' menu - refer to section '`HMEM:`' - look at counter '`Failed`'\n>     -   On the '`I/S`' tab, go to '`Memory`' menu - go to '`FW-Kernel`' menu - refer to section '`SMEM:`' - look at counter '`Failed`'\n>     -   On the '`I/S`' tab, go to '`Memory`' menu - go to '`SMEM-Failures`' menu\n>     -   On the '`I/S`' tab, go to '`Memory`' menu - go to '`Contexts`' menu\n> 2.  **`vmstat [-n] [_delay_in_sec_ [_number_of_samples_]]`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/vmstat](http://linux.die.net/man/8/vmstat)\n>     -   Displays information about processes, memory, paging, block IO, and CPU activity\n>     \n>     Usage:\n>     \n>     -   Refer to the manual page\n>     -   By default, the output's header (with names of columns) is displayed every 20 samples. If output is redirected to a file, then it will be very difficult to analyze it using such commands as '`grep`' / '`awk`'. Therefore, if output is redirected to a file, use the '`-n`' flag to display the header only once (at the very top) - run:  \n>         _`[Expert@HostName]# vmstat -n [_delay_in_sec_ [_number_of_samples_]]`_\n>     -   By default, only 1 sample is printed (with the average values since boot). Therefore, to collect this output continuously, specify the delay between the samples - run:  \n>         _`[Expert@HostName]# vmstat [-n] _delay_in_sec_ [_number_of_samples_]`_\n>     -   If you specified the delay between the samples, then the output will be collected indefinitely (until the command is stopped or killed). If you want to limit the output, then specify the total number of samples - run:  \n>         _`[Expert@HostName]# vmstat [-n] _delay_in_sec_ _number_of_samples_`_\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem\n>     \n>     Analysis:\n>     \n>     -   Look at the \"_`procs`_\" section - number of processes waiting for CPU (_`r`_)\n>     -   Look at the \"_`memory`_\" section - sum of these counters should be compared to the total amount of RAM\n>     -   Look at the \"_`swap`_\" section - reading from swap file (_`si`_) and writing to swap file (_`so`_)\n>     \n>     _Example_:\n>     \n>     > ```\n>     > procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu------\n>     >  r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n>     >  2  0 323280 100128 103192 198132    1    2     8    35  117  130  2  3 96  0  0\n>     >  2  0 323280 100400 103196 198132    0    0     0   260 1297 6904  1  4 95  0  0\n>     >  1  0 323280 100404 103196 198132    0    0     0     0 1289 7100  1  4 95  0  0\n>     >  7  0 323280 100252 103200 198132    0    0     0    32 1308 6971  0  2 97  0  0\n>     >  1  0 323280 100428 103200 198132    0    0     0     0 1265 7111  1  3 97  0  0\n>     > ```\n>     \n> 3.  **`sar [-q][-r][-B][-W] [_interval_in_sec_ [_number_of_samples_]]`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/1/sar](http://linux.die.net/man/1/sar)\n>     -   Displays information about CPU activity, network devices, memory, paging, block IO, etc.\n>     \n>     Usage:\n>     \n>     -   Refer to [sk112734 - How to collect System Activity Report using the \"sar\" command](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk112734)\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output during the problem\n>     \n>     Analysis:\n>     \n>     -   Look at the number of tasks waiting for run time - counter _runq-sz_\n>     -   Look at the system load average - counters _ldavg-1_, _ldavg-5_, _ldavg-15_\n>     -   Look at the percentage of used memory - counter _memused_\n>     -   Look at the percentage of used swap memory - counter _swpused_\n>     -   Look at the total number of kB the system paged in from disk per second - counter _pgpgin/s_\n>     -   Look at the total number of kB the system paged out to disk per second - counter _pgpgout/s_\n>     -   Look at the number of page faults (major + minor) made by the system per second - counter _fault/s_\n>     -   Look at the number of major faults the system has made per second - counter _majflt/s_\n>     -   Look at the total number of swap pages - counter _pswpin/s_ and counter _pswpout/s_\n>     \n>     _Example_:\n>     \n>     > ```\n>     > [Expert@R77-GW:0]# sar -q\n>     > Linux 2.6.18-92cp (R77-GW)      08/04/16\n>     > \n>     > 16:10:01      runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15\n>     > 16:20:01            1       114      1.11      1.04      1.06\n>     > 16:30:01            0       115      1.07      1.13      1.09\n>     > 16:40:01            0       115      1.15      1.11      1.09\n>     > 16:50:01            1       114      1.03      1.04      1.06\n>     > 17:00:01            0       114      1.10      1.09      1.08\n>     > 17:10:01            1       114      1.08      1.08      1.08\n>     > 17:20:01            1       112      1.01      1.10      1.09\n>     > 17:30:01            0       112      1.23      1.11      1.09\n>     > 17:40:01            1       112      1.15      1.12      1.09\n>     > 17:50:01            0       114      1.14      1.10      1.09\n>     > Average:            0       114      1.11      1.09      1.08\n>     > [Expert@R77-GW:0]#\n>     > \n>     > [Expert@R77-GW:0]# sar -r\n>     > Linux 2.6.18-92cp (R77-GW)      08/04/16\n>     > \n>     > 16:10:01    kbmemfree kbmemused  %memused kbbuffers  kbcached kbswpfree kbswpused  %swpused  kbswpcad\n>     > 16:20:01      1221768    784220     39.09     43328    381364   2128604         0      0.00         0\n>     > 16:30:01      1220728    785260     39.15     44648    381408   2128604         0      0.00         0\n>     > 16:40:01      1219280    786708     39.22     45880    381432   2128604         0      0.00         0\n>     > 16:50:01      1218016    787972     39.28     47300    381456   2128604         0      0.00         0\n>     > 17:00:01      1216792    789196     39.34     48628    381420   2128604         0      0.00         0\n>     > 17:10:01      1215504    790484     39.41     50076    381444   2128604         0      0.00         0\n>     > 17:20:01      1214964    791024     39.43     51272    381472   2128604         0      0.00         0\n>     > 17:30:01      1213444    792544     39.51     52524    381492   2128604         0      0.00         0\n>     > 17:40:01      1212624    793364     39.55     53568    381436   2128604         0      0.00         0\n>     > 17:50:01      1210840    795148     39.64     54940    381488   2128604         0      0.00         0\n>     > Average:      1216396    789592     39.36     49216    381441   2128604         0      0.00         0\n>     > [Expert@R77-GW:0]#\n>     > \n>     > [Expert@R77-GW:0]# sar -B\n>     > Linux 2.6.18-92cp (R77-GW)      08/04/16\n>     > \n>     > 16:10:01     pgpgin/s pgpgout/s   fault/s  majflt/s\n>     > 16:20:01         0.00     34.64   4417.09      0.00\n>     > 16:30:01         0.03     37.03   4506.64      0.00\n>     > 16:40:01         0.01     35.28   4402.80      0.00\n>     > 16:50:01         0.00     36.98   4462.80      0.00\n>     > 17:00:01         0.00     36.63   4519.38      0.00\n>     > 17:10:01         0.00     37.15   4489.80      0.00\n>     > 17:20:01         0.00     35.27   4440.20      0.00\n>     > 17:30:01         0.01     35.86   4487.54      0.00\n>     > 17:40:01         0.01     35.87   4460.36      0.00\n>     > Average:         0.01     36.08   4464.99      0.00\n>     > [Expert@R77-GW:0]#\n>     > \n>     > [Expert@R77-GW:0]# sar -W\n>     > Linux 2.6.18-92cp (R77-GW)      08/04/16\n>     > \n>     > 16:10:01     pswpin/s pswpout/s\n>     > 16:20:01         0.00      0.00\n>     > 16:30:01         0.00      0.00\n>     > 16:40:01         0.00      0.00\n>     > 16:50:01         0.00      0.00\n>     > 17:00:01         0.00      0.00\n>     > 17:10:01         0.00      0.00\n>     > 17:20:01         0.00      0.00\n>     > 17:30:01         0.00      0.00\n>     > 17:40:01         0.00      0.00\n>     > Average:         0.00      0.00\n>     > [Expert@R77-GW:0]#\n>     > ```\n>     \n> 4.  **`slabtop [-d _refresh_in_sec_] [-s_Sort_Criteria_]`**\n>     \n>     Background:\n>     \n>     -   Manual pages:  \n>         -   [http://linux.die.net/man/1/slabtop](http://linux.die.net/man/1/slabtop)\n>         -   [http://linux.die.net/man/5/slabinfo](http://linux.die.net/man/5/slabinfo)\n>         -   [http://linux.die.net/man/5/proc](http://linux.die.net/man/5/proc)\n>         -   and [http://en.wikipedia.org/wiki/Slab\\_allocation](http://en.wikipedia.org/wiki/Slab_allocation)\n>     -   Displays kernel slab cache information in real time (caches of frequently used objects in the Linux kernel - buffer heads, inodes, dentries, etc.)\n>     -   Instead of manually parsing the highly verbose _/proc/slabinfo_ file manually, it is recommended to use the _/usr/bin/slabtop_ program.\n>     \n>     Usage:\n>     \n>     -   Refer to the manual page\n>     -   By default, output is refreshed every 3 seconds, unless you use the \"`-d _refresh_in_sec_`\" option\n>     -   By default, output is sorted by the number of objects (column \"_OBJS_\", which is equal to using the \"_\\-so_\" option).\n>     -   Recommended output sort is by the cache size of the slab (column \"_CACHE SIZE_\", use the \"_\\-sc_\" option).\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem\n>     \n>     Analysis:\n>     \n>     -   Provide the output(s) to Check Point Support (involvement of R&D is required)\n>     -   The most interesting information is the amount of resources a certain kernel module is using (if this amount seems too high, then there may be something wrong with this module)\n>     -   Some of the more commonly used statistics from _/proc/slabinfo_ file that are included in the output of _/usr/bin/slabtop_:\n>         \n>         -   OBJS - The total number of objects (memory blocks), including those in use (allocated), and some spares not in use\n>         -   ACTIVE - The number of objects (memory blocks) that are in use (allocated)\n>         -   USE - Percentage of total objects that are active \\[`(ACTIVE/OBJS)*100%`\\]\n>         -   OBJ SIZE - The size of the objects\n>         -   SLABS - The total number of slabs\n>         -   OBJ/SLAB - The number of objects that fit into a slab\n>         -   CACHE SIZE - The cache size of the slab\n>         -   NAME - The name of the slab\n>     \n>     _Example of 'slabtop' output_ (excerpt):\n>     \n>     > ```\n>     >  Active / Total Objects (% used)    : 160565 / 174730 (91.9%)\n>     >  Active / Total Slabs (% used)      : 5005 / 5005 (100.0%)\n>     >  Active / Total Caches (% used)     : 94 / 141 (66.7%)\n>     >  Active / Total Size (% used)       : 19571.55K / 20754.12K (94.3%)\n>     >  Minimum / Average / Maximum Object : 0.01K / 0.12K / 128.00K\n>     > \n>     >   OBJS ACTIVE  USE OBJ SIZE  SLABS OBJ/SLAB CACHE SIZE NAME\n>     >  85536  82456  96%    0.05K   1188       72      4752K buffer_head\n>     >  12876  10385  80%    0.13K    444       29      1776K dentry_cache\n>     >   9516   9498  99%    0.05K    122       78       488K selinux_inode_security\n>     >   7571   6711  88%    0.03K     67      113       268K size-32\n>     >   7524   6869  91%    0.09K    171       44       684K vm_area_struct\n>     >   7056   7056 100%    0.48K    882        8      3528K ext3_inode_cache\n>     >   5936   5703  96%    0.27K    424       14      1696K radix_tree_node\n>     >   4524   4453  98%    0.05K     58       78       232K sysfs_dir_cache\n>     > ```\n>     \n>     _Example of '`cat /proc/slabinfo`' output_ (excerpt):\n>     \n>     > ```\n>     > # name            &lt;active_objs&gt; &lt;num_objs&gt; &lt;objsize&gt; &lt;objperslab&gt; &lt;pagesperslab&gt; : tunables ...\n>     > bridge_fdb_cache       0      0     64   59    1 : tunables  120   60    8 : slabdata      0      0      0\n>     > jbd_1k                 0      0   1024    4    1 : tunables   54   27    8 : slabdata      0      0      0\n>     > jbd_4k                 1      1   4096    1    1 : tunables   24   12    8 : slabdata      1      1      0\n>     > ......\n>     > scsi_io_context        0      0    104   37    1 : tunables  120   60    8 : slabdata      0      0      0\n>     > ext3_inode_cache    4596   4888    492    8    1 : tunables   54   27    8 : slabdata    611    611      0\n>     > ext3_xattr             0      0     48   78    1 : tunables  120   60    8 : slabdata      0      0      0\n>     > journal_handle        89    169     20  169    1 : tunables  120   60    8 : slabdata      1      1      0\n>     > journal_head         205    432     52   72    1 : tunables  120   60    8 : slabdata      6      6      0\n>     > ......\n>     > size-32(DMA)           0      0     32  113    1 : tunables  120   60    8 : slabdata      0      0      0\n>     > size-64             3724   4071     64   59    1 : tunables  120   60    8 : slabdata     69     69      0\n>     > size-32            17449  18306     32  113    1 : tunables  120   60    8 : slabdata    162    162     60\n>     > kmem_cache           141    165    256   15    1 : tunables  120   60    8 : slabdata     11     11      0\n>     > ```\n>     \n> 5.  **`fw ctl failmem _PERCENTAGE_of_ALLOCATIONS_to_FAIL_`**\n>     \n>     Background:\n>     \n>     -   Administrator can test the behaviour of the Security Gateway during a memory shortage by failing a certain percentage of all memory allocations\n>     \n>     Usage:\n>     \n>     -   Refer to [sk100766 - Simulation of low memory resources on Security Gateway - random failing of memory allocations](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk100766)\n>     \n>     Diagnostics:\n>     \n>     -   Run this test to check how the Security Gateway is going to behave during a memory shortage\n>     \n>     Analysis:\n>     \n>     -   Monitor Security Gateway's resources utilization during this test - Memory, CPU, Interfaces, how traffic is passing, etc.\n\n### (5-3) Advanced diagnostics - Network interface cards\n\nShow / Hide advanced diagnostics information\n\n> 1.  **`netstat -s`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/netstat](http://linux.die.net/man/8/netstat)\n>     -   Displays summary statistics for each protocol\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem (usually, over some time period)\n>     \n>     Analysis:\n>     \n>     -   In the \"_Ip_\" section, look at \"_incoming packets discarded_\"\n>     -   In the \"_Icmp_\" section, look at \"_ICMP messages failed_\"\n>     -   In the \"_Tcp_\" section, look at \"_bad segments received_\"\n>     -   In the \"_Udp_\" section, look at \"_packet receive errors_\"\n>     -   Search for lines with \"_error_\", \"_fail_\", \"_timeout_\", \"_loss_\", \"_lost_\"\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Ip:\n>     >     17862464 total packets received\n>     >     0 forwarded\n>     >     0 incoming packets discarded\n>     >     948002 incoming packets delivered\n>     >     788408 requests sent out\n>     >     287 outgoing packets dropped\n>     >     1 dropped because of missing route\n>     > Icmp:\n>     >     297 ICMP messages received\n>     >     0 input ICMP message failed.\n>     > ......\n>     > IcmpMsg:\n>     >         InType0: 7\n>     >         InType3: 290\n>     >         OutType3: 290\n>     >         OutType8: 11\n>     > Tcp:\n>     >     66034 active connections openings\n>     >     11704 passive connection openings\n>     >     23572 failed connection attempts\n>     > ......\n>     > Udp:\n>     >     15488 packets received\n>     >     287 packets to unknown port received.\n>     > ......\n>     > TcpExt:\n>     >     1 packets pruned from receive queue because of socket buffer overrun\n>     >     1142 TCP sockets finished time wait in fast timer\n>     > ......\n>     > IpExt:\n>     >     InMcastPkts: 420\n>     >     InBcastPkts: 277064\n>     > ```\n>     \n> 2.  **`ethtool -S _name_of_interface_`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/8/ethtool](http://linux.die.net/man/8/ethtool)\n>     -   Displays NIC-specific and driver-specific statistics\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem (usually, over some time period)\n>     \n>     Analysis:\n>     \n>     -   Check every line that contains \"_error_\", \"_drop_\", \"_buffer_\", \"_fail_\"\n>     -   [sk61922 - Excessive RX Errors / RX Drops found on interface](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk61922)\n>     \n>     _Example_:\n>     \n>     > ```\n>     > NIC statistics:\n>     >      rx_packets: 21610536\n>     >      tx_packets: 130262\n>     >      rx_bytes: 1712923726\n>     >      tx_bytes: 34001412\n>     > ......\n>     >      rx_errors: 0\n>     >      tx_errors: 0\n>     >      tx_dropped: 0\n>     > ......\n>     >      rx_length_errors: 0\n>     >      rx_over_errors: 0\n>     >      rx_crc_errors: 0\n>     >      rx_frame_errors: 0\n>     >      rx_no_buffer_count: 0\n>     >      rx_missed_errors: 0\n>     >      tx_aborted_errors: 0\n>     >      tx_carrier_errors: 0\n>     >      tx_fifo_errors: 0\n>     > ......\n>     > ```\n>     \n> 3.  **`sar [-n { DEV | EDEV }] [_interval_in_sec_ [_number_of_samples_]]`**\n>     \n>     Background:\n>     \n>     -   Manual page - [http://linux.die.net/man/1/sar](http://linux.die.net/man/1/sar)\n>     -   Displays information about CPU activity, network devices, memory, paging, block IO, etc.\n>     \n>     Usage:\n>     \n>     -   Refer to [sk112734 - How to collect System Activity Report using the \"sar\" command](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk112734)\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output during the problem\n>     \n>     Analysis:\n>     \n>     -   Look at all the counters\n>     \n>     _Example_:\n>     \n>     > ```\n>     > [Expert@R77-GW:0]#  sar -n DEV 1 2\n>     > Linux 2.6.18-92cp (R77-GW)      08/04/16\n>     > \n>     > 19:12:02        IFACE   rxpck/s   txpck/s   rxbyt/s   txbyt/s   rxcmp/s   txcmp/s  rxmcst/s\n>     > 19:12:03           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > 19:12:03         eth0      1.01      2.02    107.07    193.94      0.00      0.00      0.00\n>     > 19:12:03         eth1      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > \n>     > 19:12:03        IFACE   rxpck/s   txpck/s   rxbyt/s   txbyt/s   rxcmp/s   txcmp/s  rxmcst/s\n>     > 19:12:04           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > 19:12:04         eth0      6.06      9.09    595.96   1076.77      0.00      0.00      0.00\n>     > 19:12:04         eth1      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > \n>     > Average:        IFACE   rxpck/s   txpck/s   rxbyt/s   txbyt/s   rxcmp/s   txcmp/s  rxmcst/s\n>     > Average:           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > Average:         eth0      3.54      5.56    351.52    635.35      0.00      0.00      0.00\n>     > Average:         eth1      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > [Expert@R77-GW:0]#\n>     > \n>     > [Expert@R77-GW:0]#  sar -n EDEV 1 2\n>     > Linux 2.6.18-92cp (R77-GW)      08/04/16\n>     > \n>     > 19:12:36        IFACE   rxerr/s   txerr/s    coll/s  rxdrop/s  txdrop/s  txcarr/s  rxfram/s  rxfifo/s  txfifo/s\n>     > 19:12:37           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > 19:12:37         eth0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > 19:12:37         eth1      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > \n>     > 19:12:37        IFACE   rxerr/s   txerr/s    coll/s  rxdrop/s  txdrop/s  txcarr/s  rxfram/s  rxfifo/s  txfifo/s\n>     > 19:12:38           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > 19:12:38         eth0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > 19:12:38         eth1      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > \n>     > Average:        IFACE   rxerr/s   txerr/s    coll/s  rxdrop/s  txdrop/s  txcarr/s  rxfram/s  rxfifo/s  txfifo/s\n>     > Average:           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > Average:         eth0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > Average:         eth1      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n>     > [Expert@R77-GW:0]#\n>     > ```\n>     \n\n### (5-4) Advanced diagnostics - SecureXL\n\nShow / Hide advanced diagnostics information\n\n> Refer to [sk153832 (ATRG: SecureXL for R80.20 and higher)](https://support.checkpoint.com/results/sk/sk153832).\n> \n> 1.  **`cpview`**\n>     \n>     Background:\n>     \n>     -   Displays the SecureXL status and statistics (and many other counters). Refer to [sk101878 - CPView Utility](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101878).\n>     \n>     Diagnostics:\n>     \n>     -   Monitor the SecureXL performance during the problem\n>     \n>     Analysis:\n>     \n>     -   On the '`Traffic`' tab, go to '`Overview`' menu - refer to section '`Templates:`'\n>     -   On the '`Traffic`' tab, go to '`Overview`' menu - refer to section '`Logged drops:`' - look at counter '`SXL`'\n>     -   On the '`I/S`' tab, go to '`SXL`' menu - go to '`F2F-Reasons`' menu\n>     -   On the '`I/S`' tab, go to '`SXL`' menu - go to '`Drop-Reasons`' menu\n> 2.  **Forwarded to Firewall (F2F) traffic**\n>     \n>     Background:\n>     \n>     -   Some connections cannot be accelerated by design - refer to [sk32578 - SecureXL Mechanism](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk32578)\n>     \n>     Diagnostics:\n>     \n>     -   Collect this information during the problem (**Important Note:** These commands might increase CPU and memory consumption)\n>     \n>     Analysis:\n>     \n>     -   To check the total number of F2F connections:  \n>         _`[Expert@HostName]# fw tab -t connections -u -z`_\n>     -   To see why specific connections are Forwarded to Firewall, run the following kernel debug (debug will apply only to new connections):\n>         \n>         ```\n>         [Expert@HostName]# fw ctl debug 0\n>         [Expert@HostName]# fwaccel dbg resetall\n>         [Expert@HostName]# sim dbg resetall\n>         [Expert@HostName]# fw ctl debug -buf 32000\n>         [Expert@HostName]# fwaccel dbg + offload\n>         [Expert@HostName]# sim dbg + f2f\n>         [Expert@HostName]# fwaccel dbg list\n>         [Expert@HostName]# sim dbg list\n>         [Expert@HostName]# fw ctl kdebug -T -f &gt; /var/log/debug.txt\n>         ```\n>         \n> 3.  **`fwaccel stats`**\n>     \n>     Background:\n>     \n>     -   Displays SecureXL acceleration statistics\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output continuously during the problem\n>     \n>     Analysis:\n>     \n>     -   [Performance Tuning Administration Guide](https://support.checkpoint.com/product/530) for your version - Chapter \"SecureXL\".\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Name                  Value              Name                  Value\n>     > --------------------  ---------------    --------------------  ---------------\n>     > \n>     > Accelerated Path\n>     > ------------------------------------------------------------------------------\n>     > accel packets                       0    accel bytes                         0\n>     > conns created                   60665    conns deleted                   60606\n>     > ... ...\n>     > \n>     > Accelerated VPN Path\n>     > ------------------------------------------------------------------------------\n>     > C crypt conns                       0    enc bytes                           0\n>     > dec bytes                           0    ESP enc pkts                        0\n>     > ... ...\n>     > \n>     > Medium Path\n>     > ------------------------------------------------------------------------------\n>     > PXL packets                         0    PXL async packets                   0\n>     > PXL bytes                           0    C PXL conns                         0\n>     > C PXL templates                     0\n>     > \n>     > Accelerated QoS Path\n>     > ------------------------------------------------------------------------------\n>     > QXL packets                         0    QXL async packets                   0\n>     > QXL bytes                           0    C QXL conns                         0\n>     > C QXL templates                     0\n>     > \n>     > Firewall Path\n>     > ------------------------------------------------------------------------------\n>     > F2F packets                  14870123    F2F bytes                   966432478\n>     > C F2F conns                        59    TCP violations                      0\n>     > C partial conns                     0    C anticipated conns                 0\n>     > port alloc f2f                      0\n>     > \n>     > General\n>     > ------------------------------------------------------------------------------\n>     > memory used                         0    free memory                         0\n>     > C used templates                    0    pxl tmpl conns                      0\n>     > ... ...\n>     > \n>     > (*) Statistics marked with C refer to current value, others refer to total value\n>     > ```\n>     \n> 4.  **`cat /proc/ppk/stats`**\n>     \n>     Background:\n>     \n>     -   Displays total number of packets that passed through interfaces\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     _Example_:\n>     \n>     > ```\n>     > IRQ | Stats           | Interface\n>     > ----------------------------------------------\n>     >  67         793651087   eth0\n>     >  75                 0   eth1\n>     >  83                 0   eth2\n>     >  59                 0   eth3\n>     > \n>     > Ifn1 | Ifn2 | Stats\n>     > -----------------------------\n>     > ```\n>     \n> 5.  **`cat /proc/ppk/conf`**\n>     \n>     Background:\n>     \n>     -   Displays SecureXL configuration and basic statistics\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     Analysis:\n>     \n>     -   For _Flags_ line, refer to \"(6-1-B) 'sim' command\" section - 'sim if' command\n>     -   For _TmplQuota_ lines, refer to \"(6-1-B) 'sim' command\" section - 'sim tmplquota' command\n>     -   For _Debug flags_ section, refer to \"(6-1-B) 'sim' command\" section - 'sim dbg' command  \n>         (Note: the numbers in the left column correspond to order of debug modules in the output of '`sim dbg list`' command)\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Flags                          : 0x00009a16\n>     > Accounting Update Interval     : 60\n>     > Conn Refresh Interval          : 512\n>     > SA Sync Notification Interval  : 0\n>     > UDP Encapsulation Port         : 0\n>     > Min TCP MSS                    : 0\n>     > TCP Auto-Expire Timeout        : 20\n>     > Connection Limit               : 18446744073709551615\n>     > TmplQuota Enabled              : 0\n>     > TmplQuota Quota (rate)         : 512\n>     > TmplQuota Drop Dduration       : 300\n>     > TmplQuota Monitor only         : 0\n>     > TmplQuota Dropped pkts         : 0\n>     > \n>     > Total Number of conns          : 54\n>     > Number of F2F conns            : 54\n>     > Number of Crypt conns          : 0\n>     > Number of TCP conns            : 18\n>     > Number of Non-TCP conns        : 36\n>     > Number of Delayed TCP conns    : 0\n>     > Number of Delayed Non-TCP conns: 0\n>     > \n>     > Debug flags :\n>     >  0     : 0x0\n>     >  1     : 0x0\n>     >  2     : 0x0\n>     >  3     : 0x0\n>     >  4     : 0x0\n>     >  5     : 0x0\n>     >  6     : 0x0\n>     >  7     : 0x0\n>     >  8     : 0x0\n>     >  9     : 0x0\n>     >  10     : 0x0\n>     >  11     : 0x0\n>     >  12     : 0x0\n>     >  13     : 0x0\n>     >  14     : 0x0\n>     >  15     : 0x0\n>     > ```\n>     \n> 6.  **`cat /proc/ppk/ifs`**\n>     \n>     Background:\n>     \n>     -   Displays the list of interfaces used and seen by the SecureXL\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     Analysis:\n>     \n>     -   Look at the _Name_ column and _Address_ column\n>     -   Look at the _F_ column (refer to \"(6-1-B) 'sim' command\" section - 'sim if' command)\n>     \n>     _Example_:\n>     \n>     > ```\n>     >  No | Interface | Address         | IRQ |  F  | SIM F | Dev                | Output Func        | Features\n>     > -------------------------------------------------------------------------------------------------------------\n>     >   2 | eth0      |    172.30.41.90 |  67 |  39 |     0 | 0xeffc2000         | 0xf0a862e0         | 0x000013a0\n>     >   3 | eth1      |     10.10.10.90 |  75 |  29 |     0 | 0xefc33000         | 0xf0a862e0         | 0x000013a0\n>     >   4 | eth2      |     20.20.20.90 |  83 |  29 |     0 | 0xef7fd000         | 0xf0a862e0         | 0x000013a0\n>     >   5 | eth3      |     30.30.30.90 |  59 |  29 |     0 | 0xef496000         | 0xf0a862e0         | 0x000013a0\n>     > ```\n>     \n> 7.  **`cat /proc/ppk/affinity`**\n>     \n>     Background:\n>     \n>     -   Displays the status and the thresholds for New Affinity (feature will be activated only if there is no massive VPN traffic and the packets-per-second rate (cut-through) is high enough to benefit from the new affinity; feature will be activated only if CPU strength is greater than 3 GHz)\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     _Example_:\n>     \n>     > ```\n>     > New affinity enabled           : no\n>     > Min CPU speed to act (MHz)     : 3000\n>     > Min accelerated PPS to act     : 250000\n>     > Max enc. bytes rate to act     : 10000\n>     > Current accelerated PPS        : 0\n>     > Current enc. bytes rate        : 0\n>     > Currently new sim affinity set : no\n>     > ```\n>     \n> 8.  **`cat /proc/ppk/cpls`**\n>     \n>     Background:\n>     \n>     -   Displays the SecureXL configuration for ClusterXL Load Sharing support\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     Analysis:\n>     \n>     -   The most important data in this output is the value of _fwha\\_conf\\_flags_ - it should include the value of 0x1 (i.e., _ACTIVE_).\n>     \n>     _Example_:\n>     \n>     > ```\n>     > fwha_conf_flags: 0\n>     > fwha_df_type: 0\n>     > fwha_member_id: 255\n>     > fwha_port: 0\n>     > fwha_src_mac: 00 00 00 00 00 00\n>     > fwha_src_mac_mask: 00 00 00 00 00 00\n>     > udp_enc_port: 0\n>     > selection table size: 0\n>     > selection table:\n>     > 00 00 00 00 00 00 00 00 00 00\n>     > ```\n>     \n> 9.  **`cat /proc/ppk/statistics`**\n>     \n>     Background:\n>     \n>     -   Displays SecureXL statistics - the same output as from '`fwaccel stats -l`' command\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Name                  Value              Name                  Value\n>     > --------------------  ---------------    --------------------  ---------------\n>     > conns created                   67518    conns deleted                   67475\n>     > temporary conns                     0    templates                           0\n>     > nat conns                           0    accel packets                       0\n>     > accel bytes                         0    F2F packets                  16599213\n>     > ESP enc pkts                        0    ESP enc err                         0\n>     > ESP dec pkts                        0    ESP dec err                         0\n>     > ESP other err                       0    espudp enc pkts                     0\n>     > espudp enc err                      0    espudp dec pkts                     0\n>     > espudp dec err                      0    espudp other err                    0\n>     > AH enc pkts                         0    AH enc err                          0\n>     > AH dec pkts                         0    AH dec err                          0\n>     > AH other err                        0    memory used                         0\n>     > free memory                         0    acct update interval               60\n>     > current total conns                43    TCP violations                      0\n>     > conns from templates                0    TCP conns                          15\n>     > delayed TCP conns                   0    non TCP conns                      28\n>     > delayed nonTCP conns                0    F2F conns                          43\n>     > F2F bytes                  1076600709    crypt conns                         0\n>     > enc bytes                           0    dec bytes                           0\n>     > partial conns                       0    anticipated conns                   0\n>     > dropped packets                     0    dropped bytes                       0\n>     > nat templates                       0    port alloc templates                0\n>     > conns from nat templ                0    port alloc conns (tm                0\n>     > port alloc f2f                      0    PXL templates                       0\n>     > PXL conns                           0    PXL packets                         0\n>     > PXL bytes                           0    PXL async packets                   0\n>     > conns auto expired                  0    C used templates                    0\n>     > pxl tmpl conns                      0    C conns from tmpl                   0\n>     > C non TCP F2F conns                28    C tcp handshake conn               14\n>     > C tcp established co                1    C tcp closed conns                  0\n>     > C tcp f2f handshake                14    C tcp f2f establishe                1\n>     > C tcp f2f closed con                0    C tcp pxl handshake                 0\n>     > C tcp pxl establishe                0    C tcp pxl closed con                0\n>     > QXL templates                       0    QXL conns                           0\n>     > QXL packets                         0    QXL bytes                           0\n>     > QXL async packets                   0    outbound packets                    0\n>     > outbound pxl packets                0    outbound f2f packets           124862\n>     > outbound bytes                      0    outbound pxl bytes                  0\n>     > outbound f2f bytes           33552839    trimmed pkts  0\n>     > ```\n>     \n> 10.  **`fwaccel stats -d`**\n>     \n>     Background:\n>     \n>     -   Displays SecureXL drop statistics\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Reason                Value              Reason                Value\n>     > --------------------  ---------------    --------------------  ---------------\n>     > General                             0    CPASXL Decision                     0\n>     > PSLXL Decision                      0    Clear Packet on VPN                 12\n>     > Encryption Failed                   0    Drop Template                       0\n>     > Decryption Failed                   0    Interface Down                      0\n>     > Cluster Error                       0    XMT Error                           0\n>     > Anti-Spoofing                      23    Local Spoofing                      0\n>     > Sanity Error                        0    Monitored Spoofed                   0\n>     > QoS Decision                        0    QoS LLQ Decision                    0\n>     > QoS Packet Rejected                 0    C2S Violation                       0\n>     > S2C Violation                       0    Loop Prevention                     0\n>     > DOS Fragments                       0    DOS IP Options                      0\n>     > DOS Deny Lists                      0    DOS Penalty Box                     0\n>     > DOS Rate Limiting                   0    Syn Attack                          0\n>     > Reorder                             0    Virt Defrag Timeout                 0\n>     > Invalid Interface                   0    Null Routing info                   0\n>     > Unable to get out ifn               0    Resource exhausted                  0\n>     > Conn not found                      0    Failed to del corr                  0\n>     > Corr instead of conn                0    Del zombie conn fail                0\n>     > FW UUID no match                    0    Offload mismatch                    0\n>     > SIM init failed                     0    Null stream init info               0\n>     > Unable to get CGNAT                 0    Null stream app info                0\n>     > Failed get init info                0    Collid conn not found               0\n>     > Del collid conn fail                0    Add conn after collid               0\n>     > SEQ valid                           0    Enqueue QoS failed                  0\n>     > AUX CI null                         0    Link dead                           0\n>     > VPN packet too big                  0    NAT64 failed                        0\n>     > NAT46 failed                        0    Packet &gt; MTU                        0\n>     > NAC validation                      0    TCP state violation                 0\n>     > Enforce packet                      0    GTP check packet                    0\n>     > Bridge route error                  0    Route ifn changed                   0\n>     > IP forwarding                       0    Copy MACS failed                    0\n>     > Fragments Drops                     0    Send Notification                   0\n>     > Conn not found RST                  0    Forward to PPAK fail                0\n>     > Cluster forward fail                0    F2F before encrypt                  0\n>     > Forward dst encrypt                 0    Correction I/S fail                 0\n>     > Do inbound F2F                      0    Packet UDP failed                   0\n>     > F2F not allowed                     0    Do routing                          0\n>     > Fanout won't F2F                    0    SCTP validation fail                0\n>     > SCTP not data                       0    Invalid TCP option                  4\n>     > Invalid MSS option                  0    Invalid MSS value                   0\n>     > Invalid window scale                0    Invalid IP option                   0\n>     > Resume from Host err                0    Invalid ethertype                   0\n>     > ```\n>     \n> 11.  **`cat /proc/ppk/viol_statistics`**\n>     \n>     Background:\n>     \n>     -   Displays violations statistics\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Violation             Packets            Violation             Packets\n>     > --------------------  ---------------    --------------------  ---------------\n>     > pkt is a fragment                   0    pkt has IP options                406\n>     > ICMP miss conn                    932    TCP-SYN miss conn                 169\n>     > TCP-other miss conn                17    UDP miss conn                10305933\n>     > other miss conn                     0    VPN returned F2F                    0\n>     > ICMP conn is F2Fed                  7    TCP conn is F2Fed               23665\n>     > UDP conn is F2Fed             6275273    other conn is F2Fed                 0\n>     > uni-directional viol                0    possible spoof viol                 0\n>     > TCP state viol                      0    out if not def/accl                 0\n>     > bridge, src=dst                     0    routing decision err                0\n>     > sanity checks failed                0    temp conn expired                   0\n>     > fwd to non-pivot                    0    broadcast/multicast                 0\n>     > cluster message                     0    partial conn                        0\n>     > PXL returned F2F                    0    cluster forward                     0\n>     > chain forwarding                    0    general reason                      0\n>     > ```\n>     \n> 12.  **`cat /proc/ppk/mcast_statistics`**\n>     \n>     Background:\n>     \n>     -   Displays SecureXL multicast statistics\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     _Example_:\n>     \n>     > ```\n>     > Name                  Value              Name                  Value\n>     > --------------------  ---------------    --------------------  ---------------\n>     > in packets                        406    out packets                         0\n>     > if restricted                       0    conns with down if                  0\n>     > f2f packets                         0    f2f bytes                           0\n>     > dropped packets                     0    dropped bytes                       0\n>     > accel packets                       0    accel bytes                         0\n>     > mcast conns                         1\n>     > ```\n>     \n\n### (5-5) Advanced diagnostics - CoreXL\n\nShow / Hide advanced diagnostics information\n\n> Refer to [sk98737 - ATRG: CoreXL](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98737).\n> \n> 1.  **`fw -i _FW_INSTANCE_ID_ tab -t connections [_flags_]`**\n>     \n>     Background:\n>     \n>     -   Displays the Connections Table for specified CoreXL FW instance\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     _Example_:\n>     \n>     > `localhost:   -------- connections --------   dynamic, id 8158, attributes: keep, sync, aggressive aging, kbufs 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34, expires 25, refresh, , hashsize 1048576, unlimited   <00000001, ac1e295a, 0000b47d, 54279820, 00000050, 00000006; 00020001, 00046000, 49000000, 00000164, 00000000, 531e03e8, 00000000, 5a291eac, c0000000, ffffffff, ffffffff, ffffffff, 00000001, 00000000, 00000000, 00008000, 49196800, 00000000, 00000000, 00000000, 00000000, 00000000, fb13c000, 00000000, 0f13d800, 00000000, 00000000, 00000000, df175800, 00000000, 00000000; 25/25>   <00000000, ac1e7560, 0000008a, ac1effff, 0000008a, 00000011; 00010001, 00004000, 00000001, 0000018b, 00000106, 531e03da, 00000000, 5a291eac, c0000000, 00000001, ffffffff, ffffffff, ffffffff, 02000000, 00000000, 00000000, 99163800, 00000000, 00000000, 00000000, 00000000, 00000000, 00000000, 00000000, 7a179800, 00000000, 00000000, 00000000, 00000000, 00000000, 00000000; 23/40>`\n>     \n> 2.  **`cat $FWDIR/conf/fwaffinity.conf`**\n>     \n>     Background:\n>     \n>     -   Displays the CoreXL affinity configuration\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status\n>     \n>     Analysis:\n>     \n>     -   Check the affinity settings\n>     \n>     _Example_:\n>     \n>     > ```\n>     > i eth0 1\n>     > n fwd 3\n>     > ```\n>     \n> 3.  **`cat /etc/fw.boot/boot.conf`**\n>     \n>     Background:\n>     \n>     -   Displays the CoreXL FW instances configuration\n>     \n>     Diagnostics:\n>     \n>     -   Collect this output to see the current status if CoreXL configuration is not saved correctly / does not survive reboot\n>     \n>     Analysis:\n>     \n>     -   Check each line under the '`DEFAULT_FILTER_PATH`'\n>     \n>     _Example_:\n>     \n>     > ```\n>     > CTL_IPFORWARDING        1\n>     > DEFAULT_FILTER_PATH     /etc/fw.boot/default.bin\n>     > KERN_INSTANCE_NUM       3\n>     > COREXL_INSTALLED        1\n>     > KERN6_INSTANCE_NUM      2\n>     > IPV6_INSTALLED  0\n>     > ```\n>     \n> 4.  **`cpview`**\n>     \n>     Background:\n>     \n>     -   Displays the CoreXL status and statistics (and many other counters). Refer to [sk101878 - CPView Utility](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101878).\n>     \n>     Diagnostics:\n>     \n>     -   Monitor the CoreXL performance during the problem\n>     \n>     Analysis:\n>     \n>     -   On the '`I/S`' tab, go to '`CoreXL`' menu - go to '`General`' menu\n>     -   On the '`I/S`' tab, go to '`CoreXL`' menu - go to '`Global`' menu\n>     -   On the '`I/S`' tab, go to '`CoreXL`' menu - go to '`Instances`' menu - activate the statistics (!may affect performance)\n\n___\n\n## (6) Command Line syntax\n\n### (6-1) Command Line syntax - SecureXL\n\n-   (6-1-A) FWACCEL (controls acceleration feature)\n    \n    Show / Hide SecureXL '`fwaccel`' syntax\n    \n    > **`[Expert@HostName]# fwaccel <parameter> [-h]`**\n    > \n    > **`[Expert@HostName]# fwaccel6 <parameter> [-h]`**\n    > \n    > |                           Command                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n    > |-------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n    > |                        `fwaccel help`                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Prints the general help message with available parameters                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n    > |                        `fwaccel ehelp`                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Prints the extended help message with available parameters                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n    > |                   `fwaccel <_parameter_> -h`                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Prints the specific help message for given <_parameter_\\>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n    > |                    `fwaccel on [-a] [-q]`                     | Starts acceleration on-the-fly (if Performance Pack is installed)\n    > \n    > -   \"`-q`\" flag suppresses the output\n    > -   \"`-a`\" flag means to start acceleration on all Virtual Systems\n    > \n    > Returned strings:\n    > \n    > -   `SecureXL device is enabled.`\n    > -   `Failed to start SecureXL.`\n    > -   `No license for SecureXL.`\n    > -   `SecureXL is disabled by the firewall. Please try again later.`\n    > -   `The installed SecureXL device is not compatible with the installed firewall (version mismatch).`\n    > -   `The SecureXL device is in the process of being stopped. Please try again later.`\n    > -   `SecureXL cannot be started while \"flows\" are active.`\n    > -   `SecureXL is already started.`\n    > -   `SecureXL will be started after a policy is loaded.`\n    > -   `fwaccel: Failed to check FloodGate-1 status. Acceleration will not be started.`\n    > -   `FW-1: SecureXL acceleration cannot be started while QoS is running in express mode.   Please disable FloodGate-1 express mode or SecureXL`\n    > -   `FW-1: SecureXL acceleration cannot be started while QoS is running with citrix printing rule.   Please remove the citrix printing rule to enable SecureXL.`\n    > -   `FW-1: SecureXL acceleration cannot be started while QoS is running with UAS rule.   Please remove the UAS rule to enable SecureXL.`\n    > -   `FW-1: SecureXL acceleration cannot be started while QoS is running.   Please remove the QoS blade to enable SecureXL.`\n    > -   `Failed to enable SecureXL device`\n    > -   `fwaccel_on: failed to set process context _<VSID>_` |\n    > |                    `fwaccel off [-a] [-q]`                    | Stops acceleration on-the-fly\n    > \n    > -   \"`-q`\" flag suppresses the output\n    > -   \"`-a`\" flag means to stop acceleration on all Virtual Systems\n    > \n    > Returned strings:\n    > \n    > -   `SecureXL device disabled`\n    > -   `SecureXL device is not active`\n    > -   `Failed to disable SecureXL device`\n    > -   `fwaccel_on: failed to set process context _<VSID>_` |\n    > |                         `fwaccel ver`                         | Shows SecureXL FWAccel and FireWall version\n    > \n    > _Example_:\n    > \n    > Firewall version: R77.10 - Build 243\n    > Acceleration Device: Performance Pack\n    > Accelerator Version 2.1\n    > Firewall API version: 2.90NG (13/6/2013)\n    > Accelerator API version: 2.90NG (13/6/2013) |\n    > |                      `fwaccel stat [-a]`                      | Shows SecureXL status\n    > \n    > -   \"`-a`\" flag means to show SecureXL status for all Virtual Systems\n    > \n    > _Example_:\n    > \n    > Accelerator Status : on\n    > Accept Templates   : enabled\n    > Drop Templates     : disabled\n    > NAT Templates      : disabled by user\n    > \n    > Returned strings:\n    > \n    > -   Accelerator Status:\n    >     \n    >     -   `Accelerator Status : on`\n    >     -   `Accelerator Status : off`\n    >     -   `Accelerator Status : disabled by Firewall`\n    >     -   `Accelerator Status : waiting for policy load`\n    >     -   `Accelerator Status : no license for SecureXL`\n    > -   Accept Templates:\n    >     \n    >     -   `Accept Templates : enabled`\n    >     -   `Accept Templates : not supported by the SecureXL device`\n    >     -   `Accept Templates : disabled by Firewall`\n    >     -   `Accept Templates : disabled by user`\n    > -   Drop Templates:\n    >     \n    >     -   `Drop Templates : enabled`\n    >     -   `Drop Templates : disabled`\n    >     -   `Drop Templates : not supported by the SecureXL device`\n    >     -   `Drop Templates : disabled by Firewall`\n    >     -   `Drop Templates : disabled by user`\n    > -   NAT Templates (refer to sk71200):\n    >     \n    >     -   `NAT Templates : enabled`\n    >     -   `NAT Templates : not supported by the SecureXL device`\n    >     -   `NAT Templates : disabled by Firewall`\n    >     -   `NAT Templates : disabled by user` |\n    > |                        `fwaccel stats`                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Prints all acceleration statistics (output is divided into relevant sections)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n    > |                        `fwaccel stats -h`                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Prints the help message with available flags for '`stats`' parameter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n    > |                        `fwaccel stats -s`                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Prints the summary of all acceleration statistics                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n    > |                        `fwaccel stats -d`                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Prints the acceleration statistics for dropped packets                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n    > |                        `fwaccel stats -n`                     | Prints the acceleration statistics for Network Access Control (NAC)\n    > \n    > Note: Refer to the Identity Awareness Administration Guide for your version |\n    > |                        `fwaccel stats -p`                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Prints the acceleration statistics for SecureXL violations (F2F packets)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n    > |                        `fwaccel stats -l`                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Prints all acceleration statistics in Legacy mode (output is _not_ divided into sections)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n    > |                        `fwaccel stats -m`                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Prints the acceleration statistics for multicast traffic                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n    > |                        `fwaccel stats -r`                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Resets all acceleration statistics                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n    > |                        `fwaccel conns`                        | Prints the SecureXL Connections Table ('`cphwd_db`')\n    > \n    > Note: Depending on the number of concurrent connections, might consume memory at very high level\n    > \n    > Returned strings:\n    > \n    > -   `The SecureXL connections table is empty`\n    > -   `Failed to read the SecureXL connections table`\n    > -   `There are _VALUE_ connections in SecureXL connections table   ...   Total number of connections: _VALUE_` |\n    > |                        `fwaccel conns -h`                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Prints the help message with available flags for '`conns`' parameter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n    > |                        `fwaccel conns -s`                     | Prints the summary of SecureXL Connections Table (number of connections)\n    > \n    > Note: Depending on the number of concurrent connections, might consume memory at very high level |\n    > |                  `fwaccel conns -m _max_entries_`                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Prints the SecureXL Connections Table limited to the number of _max\\_entries_                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n    > |                   `fwaccel conns -f <_filter_>`                 | Prints the SecureXL Connections Table entries based on <filter> (run '`fwaccel conns -h`');  \n    > Filtering flag is a single letter (either capital, or small) |\n    > |                      `fwaccel templates`                      | Prints the SecureXL Connections Templates ('`cphwd_tmpl`')\n    > \n    > Note: Depending on the number of current templates, might consume memory at very high level\n    > \n    > Returned strings:\n    > \n    > -   `The SecureXL templates table is empty`\n    > -   `Failed to read the SecureXL templates table`\n    > -   `There are _VALUE_ templates in SecureXL templates table   ...   Total number of templates: _VALUE_` |\n    > |                      `fwaccel templates -h`                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Prints the help message with available flags for '`templates`' parameter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n    > |                      `fwaccel templates -s`                   | Prints the summary of SecureXL Connections Templates (number of templates)\n    > \n    > Note: Depending on the number of current templates, might consume memory at very high level |\n    > |                      `fwaccel templates -d`                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Prints the summary of SecureXL Connections Templates for dropped packets                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n    > |                `fwaccel templates -m _max_entries_`              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Prints the SecureXL Connections Templates limited to the number of _max\\_entries_                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n    > |                     `fwaccel identities`                      | Prints the SecureXL Identities Table ('`cphwd_dev_identity_table`')\n    > \n    > Returned strings:\n    > \n    > -   `The SecureXL identity table is empty`\n    > -   `Failed to read the SecureXL identity table - no memory`\n    > -   `There are _VALUE_ identities in SecureXL identities table   ...   Total number of identities: _VALUE_`\n    > \n    > Notes:\n    > \n    > -   Refer to the Identity Awareness Administration Guide for your version\n    > -   Command is not available for IPv6 |\n    > |                     `fwaccel identities -h`                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Prints the help message with available flags for '`identities`' parameter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n    > |                     `fwaccel identities -s`                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Prints the summary of SecureXL Identities Table (number of entries)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n    > |                `fwaccel identities -m _max_entries_`             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Prints the SecureXL Identities Table limited to the number of _max\\_entries_                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n    > |                     `fwaccel revoked_ips`                     | Prints the SecureXL Revoked IPs Table ('`cphwd_dev_revoked_ips_table`')\n    > \n    > Returned strings:\n    > \n    > -   `The SecureXL templates' revoked IPs table is empty`\n    > -   `Failed to read the SecureXL templates' revoked IPs table - no memory`\n    > -   `There are _VALUE_ revoked IPs in SecureXL templates' revoked IPs table   ...   Total number of templates' revoked IPs:: _VALUE_`\n    > \n    > Notes:\n    > \n    > -   Refer to the Identity Awareness Administration Guide for your version\n    > -   Command is not available for IPv6 |\n    > |                     `fwaccel revoked_ips -h`                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Prints the help message with available flags for '`revoked_ips`' parameter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n    > |                     `fwaccel revoked_ips -s`                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Prints the summary of SecureXL Revoked IPs Table (number of entries)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n    > |                `fwaccel revoked_ips -m _max_entries_`             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Prints the SecureXL Revoked IPs Table limited to the number of _max\\_entries_                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n    > |                         `fwaccel dbg`                         | Controls SecureXL debugging (run '`fwaccel dbg -h`')\n    > \n    > By default, debug messages will be printed to `/var/log/messages` file, therefore you must set the usual kernel debugging options with:\n    > \n    > `[Expert@HostName]# fw ctl debug 0   [Expert@HostName]# fwaccel dbg resetall   [Expert@HostName]# sim dbg resetall   [Expert@HostName]# fw ctl debug -buf 32000   [Expert@HostName]# fwaccel dbg -m _MODULE_ + _FLAG1 FLAG2 ... FLAGn_   [Expert@HostName]# fwaccel dbg list   [Expert@HostName]# sim dbg list   [Expert@HostName]# fw ctl kdebug -T -f > /var/log/debug.txt` |\n    > |                         `fwaccel dbg -h`                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Prints the help message with available options, list of debug modules and their flags                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n    > |                        `fwaccel dbg list`                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Prints all currently enabled debug flags for all modules                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n    > |                      `fwaccel dbg resetall`                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Resets all debug flags for all modules to their default (none)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n    > |                  `fwaccel dbg -m _MODULE_ reset`                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Resets all debug flags for specified module to their default (none)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n    > |                   `fwaccel dbg -m _MODULE_ all`                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Enables all supported debug flags for specified module                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n    > |         `fwaccel dbg -m _MODULE_ + _FLAG1 FLAG2 ... FLAGn_`       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Enables specified debug flags for specified module                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n    > |         `fwaccel dbg -m _MODULE_ - _FLAG1 FLAG2 ... FLAGn_`       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Disables specified debug flags for specified module                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n    > |    `fwaccel dbg -f _Source_IP_,_Source_Port_,_Dest_IP_,_Dest_Port_,_Proto_` | Sets debugging filter - only the specified connection will be printed in the debug output\n    > \n    > Notes:\n    > \n    > -   Only 1 filter can be set at one time\n    > -   You can use the asterisk \"\\*\" as a wildcard for IP/port/proto\n    > \n    > _Example for SSH connection_:\n    > \n    > `[Expert@HostName]# fwaccel dbg -f 172.30.1.1,*,172.30.41.90,22,6` |\n    > |                      `fwaccel dbg -f reset`                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Resets the debugging filter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n    > \n    >   \n    > New 'fwaccel' commands added in R80.20:  \n    > \n    > |         Command          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n    > |--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n    > |         `fwaccel dos`      |  Interface to DOS mitigation techniques in SecureXL.\n    > \n    > Commands:\n    > \n    > -   `blacklist` - Interface to the IP blacklist in SecureXL.\n    > -   `config` - Interface to DOS mitigation configuration in SecureXL.\n    > -   `pbox` -  Interface to the penalty box policy in SecureXL.\n    > -   `rate` - Interface to the rate limiting policy in SecureXL.\n    > -   `stats` - Interface to DOS real-time statistics.\n    > -   `tab` -  Manage DOS tables.\n    > -   `whitelist` - Interface to the IP whitelist in SecureXL. |\n    > |    `fwaccel dos blacklist` | Interface to the IP blacklist in SecureXL..\n    > \n    > Commands:\n    > \n    > -   `add` - Add IPs to the blacklist.\n    > -   `clear` - Remove all IPs from the blacklist.\n    > -   `get` - Print the blacklist.\n    > -   `remove` - Remove IPs from the blacklist. |\n    > |     `fwaccel dos config`   | Interface to DOS mitigation configuration in SecureXL.\n    > \n    > Commands:\n    > \n    > -   `get` - View configuration parameters.\n    > -   `set` - Modify configuration parameters. |\n    > |      `fwaccel dos pbox`    | Interface to the penalty box policy in SecureXL.\n    > \n    > Commands:\n    > \n    > -   `whitelist` -Interface to the penalty box source IP whitelist in SecureXL. |\n    > |      `fwaccel dos rate`    | Interface to the rate limiting policy in SecureXL.\n    > \n    > Commands:\n    > \n    > -   `get` - View rule information in the rate limiting policy.\n    > -   `install` - Manually install a rate limiting policy via stdin. E.g.:\n    >     \n    >     `fw samp get -l -k req_type -t in -v quota | fwaccel dos rate install`\n    >     \n    > \n    > Note: Installing a new rate limiting policy with more than one rule will automatically enable the rate limiting feature. To manually disable the feature after this command, run:\n    > \n    > `fwaccel dos config set --disable-rate-limit`\n    > \n    > In order to delete the current policy, simply install a new policy with zero rules. |\n    > |      `fwaccel dos stats`   |  Interface to DOS real-time statistics.\n    > \n    > Commands:\n    > \n    > -   `clear` - Clear real-time statistics.\n    > -   `get` - View real-time statistics. |\n    > |       `fwaccel dos tab`    |  Manage DOS tables.\n    > \n    > Commands:\n    > \n    > -   `get` - Print contents of the given DOS table. |\n    > |    `fwaccel dos whitelist` | Interface to the IP whitelist in SecureXL.\n    > \n    > Flags:\n    > \n    > -   `-a addr/mask`   - Add entry to whitelist (/mask is optional)\n    > -   `-d addr/mask`   - Delete entry from whitelist (/mask is optional)\n    > -   `-l filename`  \\- Load whitelist from filename\n    > -   `-L`                               - Load whitelist from $FWDIR/conf/dos-whitelist-v4.conf\n    > -   `-s`                              - Show current whitelist entries\n    > -   `-F`                              - Flush all whitelist entries\n    > \n    > -   This whitelist overrides entries in the blacklist. Before using 3rd-party or automatic blacklists, add trusted networks and hosts to the whitelist to avoid outages.\n    > -   This whitelist also unblocks ip options and fragments from trusted sources when the --enable-drop-opts or --enable-drop-frags features are active.\n    > -   For whitelisting of rate limiting policy, refer to the bypass action for the fw samp\\_policy command. I.e.: \"`fw samp -a b ...`\"\n    > -   To replace the current whitelist with the contents of a new file, use both the -F and -l (or -L) options on the same command line.\n    > -   The whitelist file should contain one entry per line in the format of the -a option. Lines beginning with '#' and blank lines are ignored.\n    > -   `fwaccel dos whitelist -L` is automatically run at boot time.\n    > -   The file that the `-L` option loads, does not exist by default.\n    > -   See also:\n    >     \n    >     `fwaccel dos pbox whitelist   fwaccel synatk whitelist   fw samp -a b` |\n    \n-   (6-1-B) SIM (controls acceleration device)\n    \n    Show / Hide SecureXL '`sim`' syntax\n    \n    > **`[Expert@HostName]# sim <parameter> [-h]`**\n    > \n    > **`[Expert@HostName]# sim6 <parameter> [-h]`**\n    > \n    > |                         Command                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n    > |---------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n    > |                        `sim help`                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Prints the general help message with available parameters                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n    > |                      `sim ver [-k]`                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Shows SecureXL SIM version                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n    > |                         `sim if`                          | Prints the list of interfaces used and seen by the SecureXL implementation (Performance Pack)\n    > \n    > Configuration flags  \n    > (sum of the following values in the \"_F_\" column):\n    > \n    > -   0x0001 - If set, the packet should be dropped at the end of the inbound processing, if the packet is \"cut-through\" packet. In outbound, all the packets should ne forwarded to the network.\n    > -   0x0002 - If set, and the SIM \"_tcp_\" feature is enabled (on), then an appropriate notification should be sent whenever a TCP state change occurs (connection established/teared down).\n    > -   0x0004 - If set, then when encapsulating an encrypted packet (UDP encapsulation), the UDP header's checksum field should be set correctly. If flag is not set, then the UDP header's checksum field should be set to zero. It is safe to ignore this flag if it is set to 0 (i.e., still calculate the checksum).\n    > -   0x0008 - If set, then when the Connections Table has reached the specified limit, new connections that match a template should not be created and the packet matching the template should be dropped. If flag is not set, the packet should be forwarded to the firewall.\n    > -   0x0010 - If set, then fragments should be forwarded to the firewall.\n    > -   0x0020 - If set, then connection creation from templates should be disabled. Connection can still be offloaded to the device. This flag disables only the creation of _TCP_ templates.\n    > -   0x0040 - Accelerated connections should periodically be refreshed in the firewall through the notification. The refreshing should be done only if this global flag is set.\n    > -   0x0080 - If set, then connection creation from templates should be disabled. Connection can still be offloaded to the device. This flag disables only the creation of _non-TCP_ templates.\n    > -   0x0100 - If set, then sequence verification violations should be allowed for connections that did not complete the 3-way handshake process (instead of F2F-ing violating packets).\n    > -   00x200 - If set, then sequence verification violations should be allowed for connections that completed the 3-way handshake process (instead of F2F-ing violating packets).\n    > -   0x0400 - If set, then RST TCP packets should be forwarded to firewall.\n    > -   0x0800 - If set, then Path MTU Discovery should not be enforced for IP multicast packets.\n    > -   0x1000 - If set, then SIM \"drop\\_templates\" feature should be disabled.\n    > -   0x2000 - Indicates whether Link Selection Load Sharing feature was enabled by the user.\n    > -   0x4000 - If set, then SecureXL asynchronic notification feature should be disabled.\n    > -   0x8000 - Indicates that Firewall Connections Table capacity is unlimited.\n    > \n    > _Examples_:\n    > \n    > `F=039` means the sum of the following flags:\n    > \n    > -   0x0001\n    > -   0x0008\n    > -   0x0010\n    > -   0x0020\n    > \n    > `F=0x00009a16` means the sum of the following flags:\n    > \n    > -   0x0002\n    > -   0x0004\n    > -   0x0010\n    > -   00x200\n    > -   0x0800\n    > -   0x1000\n    > -   0x8000 |\n    > |                   `sim vpn <on | off>`                    | Enables/Disables acceleration of VPN traffic:  \n    > \n    > -   _sim vpn on_ = enable acceleration of VPN traffic\n    > -   _sim vpn off_ = disable acceleration of VPN traffic |\n    > |                       `sim ranges`                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Prints the loaded ranges                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n    > |                       `sim ranges -l`                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Prints the list of loaded ranges                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n    > |                       `sim ranges -a`                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Prints all loaded ranges                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n    > |                     `sim ranges _range_id_`                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Prints specified loaded range                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n    > |                   `sim ranges -s _range_id_`                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Prints summary for specified loaded range                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n    > |                      `sim affinity`                       | Controls network interfaces' affinity settings  \n    > Note: Command is available only on Linux-based OS |\n    > |                      `sim affinity -h`                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Prints the help message with available options for '`affinity`' parameter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n    > |                      `sim affinity -l`                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Prints the current network interfaces' affinity                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n    > |                      `sim affinity -a`                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Sets the network interfaces' affinity in 'Automatic' mode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n    > |                      `sim affinity -s`                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Sets the network interfaces' affinity in 'Static' ('Manual') mode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n    > |                      `sim tmplquota`                      | Controls SIM module's template quota  \n    > Note: Command is available only on Linux-based OS |\n    > |                      `sim tmplquota -h`                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Prints the help message with available options for '`tmplquota`' parameter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n    > |                  `sim tmplquota -e <1 | 0>`               | Enables/Disables template quota feature:  \n    > \n    > -   _sim tmplquota -e 1_ = enable the template quota feature\n    > -   _sim tmplquota -e 0_ = disable the template quota feature |\n    > |                  `sim tmplquota -q <_quota_>`               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Sets maximum of connections per second per template (quota is allowed)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n    > |              `sim tmplquota -d <_drop_duration_>`           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Sets drop duration (in seconds) for drop state                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n    > |                  `sim tmplquota -m <0 | 1>`               | Controls monitor only mode:  \n    > \n    > -   _sim tmplquota -m 0_ = disable monitor only mode (default)\n    > -   _sim tmplquota -m 1_ = enable monitor only mode |\n    > |                      `sim tmplquota -r`                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Resets SIM module template quota values to their defaults                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n    > |                `sim tmplquota -d <_file_name_>`             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Loads exclusion list of Source IP addresses / Source Subnets from the file                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n    > |                  `sim tab -d templates`                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Prints only templates in drop state (output is printed into `/var/log/messages` files and into Linux kernel ring buffer (output of '`dmesg`' command))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n    > |                    `sim affinityload`                     | Applies SIM Affinity in 'Automatic' mode  \n    > Note: Command is available only on Linux-based OS |\n    > |                       `sim dropcfg`                       | Configures drop parameters (run '`sim dropcfg`')  \n    > Notes:  \n    > \n    > -   Since R80.20 \"sim dropcfg\" is deprecated, replaced by \"fw samp\" (see sk112454)\n    > -   Command is available only on Linux-based OS.\n    > -   Feature is available in R75.40 and above.\n    > -   Refer to sk67861 - Accelerated Drop Rules Feature in R75.40 - R80.10. |\n    > |                       `sim dropcfg -h`                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Prints the help message with available options for '`dropcfg`' parameter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n    > |                       `sim dropcfg -l`                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Prints current drop configuration                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n    > |             `sim dropcfg -f <_/path_to/file_name_>`           | Sets drop configuration file  \n    > Note: The drop rules configuration does not survive the reboot. Therefore, in order to apply the configured drop rules after the reboot, use a startup script (e.g., `/etc/rc.d/rc.local`) to run the '`sim dropcfg -f </path_to/file_name>`' command automatically during each boot) |\n    > |                       `sim dropcfg -e`                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Enforces drop configuration on the external interface only                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n    > |                       `sim dropcfg -y`                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Avoids confirmation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n    > |                       `sim dropcfg -r`                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Resets drop rules                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n    > |                         `sim dbg`                         | **Note:** From R80.20 \"sim dbg\" is deprecated, replaced by \"fwaccel dbg\".\n    > \n    > Controls SecureXL SIM debugging (run '`sim dbg -h`')  \n    > By default, debug messages will be printed to `/var/log/messages` file, therefore you must set the usual kernel debugging options with:  \n    > `[Expert@HostName]# fw ctl debug 0   [Expert@HostName]# sim dbg resetall   [Expert@HostName]# fwaccel dbg resetall   [Expert@HostName]# fw ctl debug -buf 32000   [Expert@HostName]# sim dbg -m _MODULE_ + _FLAG1 FLAG2 ... FLAGn_   [Expert@HostName]# sim dbg list   [Expert@HostName]# fwaccel dbg list   [Expert@HostName]# fw ctl kdebug -T -f > /var/log/debug.txt` |\n    > |                         `sim dbg -h`                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Prints the help message with available options, list of debug modules and their flags                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n    > |                        `sim dbg list`                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Prints all currently enabled debug flags for all modules                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n    > |                      `sim dbg resetall`                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Resets all debug flags for all modules to their default (none)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n    > |                  `sim dbg -m _MODULE_ reset`                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Resets all debug flags for specified module to their default (none)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n    > |                   `sim dbg -m _MODULE_ all`                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Enables all supported debug flags for specified module                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n    > |         `sim dbg -m _MODULE_ + _FLAG1 FLAG2 ... FLAGn_`       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Enables specified debug flags for specified module                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n    > |         `sim dbg -m _MODULE_ - _FLAG1 FLAG2 ... FLAGn_`       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Disables specified debug flags for specified module                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n    > |    `sim dbg -f _Source_IP_,_Source_Port_,_Dest_IP_,_Dest_Port_,_Proto_` | Sets debugging filter - only the specified connection will be printed in the debug output\n    > \n    > Notes:\n    > \n    > -   Only 1 filter can be set at one time\n    > -   You can use the asterisk \"\\*\" as a wildcard for IP/port/proto\n    > \n    > _Example for SSH connection_:\n    > \n    > `[Expert@HostName]# sim dbg -f 172.30.1.1,*,172.30.41.90,22,6` |\n    > |                      `sim dbg -f reset`                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Resets the debugging filter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n    > |                       `sim feature`                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Controls SIM module features                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n    > |                       `sim feature -h`                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Prints the help message with available options for '`feature`' parameter                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n    > |           `sim feature <_feature_name_> <on | off>`         | Enables/Disables the specified SIM module feature  \n    > Available features:  \n    > \n    > -   `anti_spoofing`\n    > -   `delayed`\n    > -   `drop_templates`\n    > -   `dynamic_vpn`\n    > -   `linksel`\n    > -   `linksel_ls`\n    > -   `mcast_route`\n    > -   `mcast_route_v2`\n    > -   `nac`\n    > -   `qos`\n    > -   `routing`\n    > -   `streaming`\n    > -   `tcp`\n    > -   `vpn`\n    > -   `wire` |\n    \n\n### (6-2) Command Line syntax - CoreXL\n\n(6-2-A) Show / Hide CoreXL syntax - in Gateway mode\n\n> **`[Expert@HostName]# fw ctl multik <parameter>`**\n> \n> **`[Expert@HostName]# fw ctl affinity [-flag1] [-flag2] ...`**\n> \n> **`[Expert@HostName]# fw6 ctl multik <parameter>`**\n> \n> **`[Expert@HostName]# fw6 ctl affinity [-flag1] [-flag2] ...`**\n> \n> |                                Command                                |                                                                                            Description                                                                                            |\n> |-----------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n> |                             `fw ctl multik`                             |                                                                                   Controls CoreXL FW instances                                                                                    |\n> |                              `fw ctl multik`                            |                                                                     Prints the general help message with available parameters                                                                     |\n> |                            `fw ctl multik stat`                         |                                                                  Prints the summary table for CPU cores and CoreXL FW instances                                                                   |\n> |                           `fw ctl multik start`                         |                                                                                           Starts CoreXL                                                                                           |\n> |                    `fw -i _Instance_ID_ ctl multik start`                 |                                                                                Starts specific CoreXL FW instance                                                                                 |\n> |                            `fw ctl multik stop`                         |                                                                                           Stops CoreXL                                                                                            |\n> |                    `fw -i _Instance_ID_ ctl multik stop`                  |                                                                                 Stops specific CoreXL FW instance                                                                                 |\n> |                       `fw ctl affinity <_options_>`                       |                                                        Controls CoreXL affinities of interfaces/processes/CoreXL FW instances to CPU cores                                                        |\n> |                             `fw ctl affinity`                           |                                                                          Prints the help message with available options                                                                           |\n> |                      `fw -d ctl affinity -corelicnum`                   |                                                                  Prints the number of system CPU cores allowed by CoreXL license                                                                  |\n> |                            `fw ctl affinity -l`                         |                                      Prints the current CoreXL affinities - output shows affinities of interfaces/processes/CoreXL FW instances to CPU cores                                      |\n> |                          `fw ctl affinity -l -r`                        |                     Prints the current CoreXL affinities in reverse order - output shows CPU cores and which interface/process/CoreXL FW instance is affined to each CPU core                     |\n> |                          `fw ctl affinity -l -a`                        |             Prints all current CoreXL affinities - output shows affinities of interfaces/processes/CoreXL FW instances to CPU cores, and also shows targets without specific affinity             |\n> |                          `fw ctl affinity -l -v`                        | Prints the current CoreXL affinities - verbose output shows affinities of interfaces/processes/CoreXL FW instances to CPU cores (targets are shown as 'Interface' (with IRQ), 'Kernel', 'Process' |\n> |                          `fw ctl affinity -l -q`                        |                          Prints the current CoreXL affinities - output shows affinities of interfaces/processes/CoreXL FW instances to CPU cores, and suppresses errors                           |\n> |                       `fw ctl affinity -l -r -a -v`                     |                                   Prints the current CoreXL affinities - verbose output that combines all possible outputs (shows all targets in reverse order)                                   |\n> |                 `fw ctl affinity -l -p _PID_ [-r] [-a] [-v]`              |                                                         Prints the current CoreXL affinity of the specified process (by PID) to CPU cores                                                         |\n> |             `fw ctl affinity -l -n _Daemon_Name_ [-r] [-a] [-v]`          |                                      Prints the current CoreXL affinity of the specified process (by name \\[maximal length = 255 characters\\]) to CPU cores                                       |\n> |             `fw ctl affinity -l -k _Instance_ID_ [-r] [-a] [-v]`          |                                                        Prints the current CoreXL affinity of the specified CoreXL FW instance to CPU cores                                                        |\n> |           `fw ctl affinity -l -i _Interface_Name_ [-r] [-a] [-v]`         |                                                            Prints the current CoreXL affinity of the specified interface to CPU cores                                                             |\n> |       `fw ctl affinity -s <_target_> { _CPU_ID_ [ _CPU_ID_ ... ] | all }`       |                                                                                       Sets CoreXL Affinity                                                                                        |\n> |         `fw ctl affinity -s -p _PID_ { _CPU_ID_ [ _CPU_ID_ ... ] | all }`       |                                                                Sets CoreXL affinity of the specified process (by PID) to CPU cores                                                                |\n> |     `fw ctl affinity -s -n _Daemon_Name_ { _CPU_ID_ [ _CPU_ID_ ... ] | all }`   |                                             Sets CoreXL affinity of the specified process (by name \\[maximal length = 255 characters\\]) to CPU cores                                              |\n> |     `fw ctl affinity -s -k _Instance_ID_ { _CPU_ID_ [ _CPU_ID_ ... ] | all }`   |                                                               Sets CoreXL affinity of the specified CoreXL FW instance to CPU cores                                                               |\n> |    `fw ctl affinity -s -i _Interface_Name_ { _CPU_ID_ [ _CPU_ID_ ... ] | all }` |                                                                   Sets CoreXL affinity of the specified interface to CPU cores                                                                    |\n\n(6-2-B) Show / Hide CoreXL syntax - in VSX mode\n\n> **`[Expert@HostName]# fw ctl multik <parameter>`**\n> \n> **`[Expert@HostName]# fw ctl affinity [-flag1] [-flag2] ...`**\n> \n> **`[Expert@HostName]# fw6 ctl multik <parameter>`**\n> \n> **`[Expert@HostName]# fw6 ctl affinity [-flag1] [-flag2] ...`**\n> \n> |                                              Command                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n> |---------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n> |                                           `fw ctl multik`                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                        Controls CoreXL FW instances                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n> |                                          `fw ctl multik stat`                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                       Prints the summary table for CPU cores and CoreXL FW instances                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n> |                                          `fw ctl multik stat`                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                         Prints the general help message with available parameters                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n> |                                         `fw ctl multik start`                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                               Starts CoreXL                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n> |                                  `fw -i _Instance_ID_ ctl multik start`                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                     Starts specific CoreXL FW instance                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n> |                                          `fw ctl multik stop`                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                Stops CoreXL                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n> |                                  `fw -i _Instance_ID_ ctl multik stop`                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                     Stops specific CoreXL FW instance                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n> |                                     `fw ctl affinity <_options_>`                                     |                                                                                                                                                                                                                                                                                                                                                                                                                    Controls CoreXL affinities of Virtual Devices/interfaces/processes/CoreXL FW instances to CPU cores                                                                                                                                                                                                                                                                                                                                                                                                                     |\n> |                                           `fw ctl affinity`                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                               Prints the help message with available options                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n> |                                    `fw -d ctl affinity -corelicnum`                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                      Prints the number of system CPU cores allowed by CoreXL license                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n> |                                          `fw ctl affinity -l`                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                    Prints the current CoreXL affinities                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n> |                                        `fw ctl affinity -l -r`                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                           Prints the current CoreXL affinities in reverse order                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n> |                                        `fw ctl affinity -l -a`                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                    Prints all current CoreXL affinities                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n> |                                        `fw ctl affinity -l -v`                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                           Prints the current CoreXL affinities - verbose output                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n> |                                        `fw ctl affinity -l -q`                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                         Prints the current CoreXL affinities and suppresses errors                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n> |                                     `fw ctl affinity -l -r -a -v`                                   |                                                                                                                                                                                                                                                                                                                                                                                                       Prints the current CoreXL affinities - verbose output that combines all possible outputs (shows all targets in reverse order)                                                                                                                                                                                                                                                                                                                                                                                                        |\n> |    `fw ctl affinity -l -x [-vsid _VSID_ranges_] [-cpu _CPU_ID_ranges_] [-flags e|k|t|n|h] [-r] [-a] [-v]` | Prints the current CoreXL affinities - extended output  \n> Notes:  \n> \n> -   If \"`-vsid`\" flag is omitted, the current context will be used (in which the command was issued)\n> -   The \"`-vsid`\" flag accepts either a single VSID (e.g., '`-vsid 7`'), or a range of VSID numbers (e.g., '`-vsid 0-5`'), or a combination (e.g., '`-vsid 0-2 4`')\n> -   The \"`-cpu`\" flag accepts either a single CPU ID (e.g., '`-cpu 7`'), or a range of CPU ID numbers (e.g., '`-cpu 0-5`'), or a combination (e.g., '`-cpu 0-2 4`')\n> -   The \"`-flags`\" requires at least one of the following arguments (multiple arguments must be specified together):\n>     -   `e` - do not print exception processes\n>     -   `k` - do not print kernel threads\n>     -   `t` - print all process threads\n>     -   `n` - print process name instead of `/proc/<_PID_>/cmdline`\n>     -   `h` - print CPU mask in Hex format\n>     -   `o` - print output into the '`/tmp/affinity_list_output`' file (VSX R77.10 and above) |\n> |                                        `fw ctl affinity -s`                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                            Sets CoreXL Affinity                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n> |                           `fw ctl affinity -s -i _Interface_Name_ _CPU_IDs_ | all`                        |                                                                                                                                                                                                                                                                                                                                                                                                                                          Sets affinities of the specified interface to CPU cores                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n> |                               `fw ctl affinity -s -p _PID_ _CPU_IDs_ | all`                             |                                                                                                                                                                                                                                                                                                                                                                                                                                       Sets affinities of the specified process (by PID) to CPU cores                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n> |             `fw ctl affinity -s -d -pname _Daemon_Name_ [-vsid _VSID_ranges_] -cpu _CPU_ID_ranges_`           | Sets affinity of the specified process (by name) to CPU cores  \n> Notes:  \n> \n> -   If \"`-vsid`\" flag is omitted, the current context will be used (in which the command was issued)\n> -   The \"`-vsid`\" flag accepts either a single VSID (e.g., '`-vsid 7`'), or a range of VSID numbers (e.g., '`-vsid 0-5`'), or a combination (e.g., '`-vsid 0-2 4`')\n> -   The \"`-cpu`\" flag accepts either a single CPU ID (e.g., '`-cpu 7`'), or a range of CPU ID numbers (e.g., '`-cpu 0-5`'), or a combination (e.g., '`-cpu 0-2 4`') |\n> |                      `fw ctl affinity -s -d [-vsid _VSID_ranges_] -cpu _CPU_ID_ranges_`                    | Sets affinities of Virtual Devices (VS, VR, VSW) to CPU cores  \n> Notes:  \n> \n> -   If \"`-vsid`\" flag is omitted, the current context will be used (in which the command was issued)\n> -   The \"`-vsid`\" flag accepts either a single VSID (e.g., '`-vsid 7`'), or a range of VSID numbers (e.g., '`-vsid 0-5`'), or a combination (e.g., '`-vsid 0-2 4`')\n> -   The \"`-cpu`\" flag accepts either a single CPU ID (e.g., '`-cpu 7`'), or a range of CPU ID numbers (e.g., '`-cpu 0-5`'), or a combination (e.g., '`-cpu 0-2 4`') |\n> |                     `fw ctl affinity -s -d -inst _Instances_ranges_ -cpu _CPU_ID_ranges_`                  | Sets affinities of the specified FWK instances to CPU cores  \n> Notes:  \n> \n> -   The \"`-inst`\" flag accepts either a single FWK\\_ID (e.g., '`-inst 7`'), or a list of FWK\\_ID numbers (e.g., '`-inst 0 2 4`')\n> -   The \"`-cpu`\" flag accepts either a single CPU ID (e.g., '`-cpu 7`'), or a range of CPU ID numbers (e.g., '`-cpu 0-5`'), or a combination (e.g., '`-cpu 0-2 4`') |\n> |                              `fw ctl affinity -s -d -fwkall _Number_of_CPUs_`                           |                                                                                                                                                                                                                                                                                                                                                                                                                       Sets affinities of all FWK instances to CPU cores (where _Number\\_of\\_CPUs_ is an integer number)                                                                                                                                                                                                                                                                                                                                                                                                                        |\n> |                                `fw ctl affinity -vsx_factory_defaults`                                |                                                                                                                                                                                                                                                                                                                                                                                                                                  Resets all VSX affinity settings (prompts the user) (VSX R77 and above)                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n> |                            `fw ctl affinity -vsx_factory_defaults_no_prompt`                            |                                                                                                                                                                                                                                                                                                                                                                                                                              Resets all VSX affinity settings (does not prompt the user) (VSX R77 and above)                                                                                                                                                                                                                                                                                                                                                                                                                               |\n\n### (6-3) Command Line syntax - Multi-Queue\n\nShow / Hide Multi-Queue '`cpmq`' syntax\n\n> **`[Expert@HostName]# cpmq <parameter>`**\n> \n> |                Command                 |                                                                                                                                                                                          Description                                                                                                                                                                                          |\n> |----------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n> |                `cpmq get`                |                                                                                                                                                                    Shows Multi-Queue status of active supported interfaces                                                                                                                                                                    |\n> |                `cpmq get -a`             |                                                                                                                                   Shows Multi-Queue status of all supported interfaces (those with enabled Multi-Queue and those with disabled Multi-Queue)                                                                                                                                   |\n> |                `cpmq get -v`             |                                                                                                                                                     Shows Multi-Queue status of active supported interfaces with IRQ affinity information                                                                                                                                                     |\n> |            `cpmq get rx_num igb`         |                                                                                                                                                            Shows the number of active RX queues for interfaces that use _igb_ driver                                                                                                                                                            |\n> |           `cpmq get rx_num ixgbe`        |                                                                                                                                                           Shows the number of active RX queues for interfaces that use _ixgbe_ driver                                                                                                                                                           |\n> |             `cpmq set [-f]`              |                                                                                                                                                        Enables/Disables Multi-Queue per interface (the \"-f\" flag forces the operation)                                                                                                                                                        |\n> |     `cpmq set rx_num all default [-f]`   | Sets the number of active RX queues to the number of CPU cores that run as CoreXL SND (CPU cores that are not used by CoreXL FW instances) - for all interfaces (those that use _igb_ driver and those that use _ixgbe_ driver)  \n> Note: This is recommended configuration |\n> |     `cpmq set rx_num igb default [-f]`   |                                                                                                                 Sets the number of active RX queues to the number of CPU cores, which are not used by CoreXL FW instances (recommended) - for interfaces that use _igb_ driver                                                                                                                  |\n> |    `cpmq set rx_num ixgbe default [-f]`  |                                                                                                                Sets the number of active RX queues to the number of CPU cores, which are not used by CoreXL FW instances (recommended) - for interfaces that use _ixgbe_ driver                                                                                                                 |\n> |     `cpmq set rx_num all <_number_> [-f]`  |                                                                                                           Sets the number of active RX queues to the number between 2 and the number of CPU cores - for all interfaces (those that use _igb_ driver and those that use _ixgbe_ driver)                                                                                                            |\n> |     `cpmq set rx_num igb <_number_> [-f]`  |                                                                                                                                 Sets the number of active RX queues to the number between 2 and the number of CPU cores - for interfaces that use _igb_ driver                                                                                                                                  |\n> |    `cpmq set rx_num ixgbe <_number_> [-f]` |                                                                                                                                Sets the number of active RX queues to the number between 2 and the number of CPU cores - for interfaces that use _ixgbe_ driver                                                                                                                                 |\n> |             `cpmq set affinity`          | Sets the IRQ affinity for Multi-Queue interfaces after the following occurs (in the given order):  \n> \n> 1.  Multi-Queue is enabled on an interface\n> 2.  The interface status is changed to 'down'\n> 3.  The machine is rebooted\n> 4.  The interface status is changed back to 'up'\n> \n> Run this command after the interface status is changed back to 'up' to reset the IRQ affinity for this interface. |\n> |           `cpmq reconfigure [-q]`        | Reconfigures the Multi-Queue (the \"-q\" flag suppresses the output):\n> \n> -   After changing the number of CoreXL FW instances\n> -   After changing the physical interfaces on the machine\n> -   After changing the number of CPU cores, to which the _fwk_ processes on VSX are assigned |\n\n___\n\n## (7) Examples\n\nShow / Hide example #1\n\n1.  Output of the '`top`' command shows that '`fw_worker_X`' processes constantly consume the CPU at 100%:\n    \n    ```\n    Cpu0 : 3.3%us, 9.6%sy, 0.0%ni, 0.6%id, 0.0%wa, 0.0%hi, 86.5%si, 0.0%st\n    Cpu1 : 7.6%us, <strong>16.6%sy</strong>, 0.0%ni, <strong>0.5%id</strong>, 0.0%wa, 1.0%hi, <strong>74.2%si</strong>, 0.0%st\n    Cpu2 : 3.0%us, <strong>14.6%sy</strong>, 0.0%ni, <strong>0.6%id</strong>, 0.0%wa, 0.0%hi, <strong>81.8%si</strong>, 0.0%st\n    Cpu3 : 3.0%us, <strong>11.3%sy</strong>, 0.0%ni, <strong>0.5%id</strong>, 0.0%wa, 0.0%hi, <strong>85.2%si</strong>, 0.0%st\n    Cpu4 : 1.0%us, <strong>7.6%sy</strong>, 0.0%ni, <strong>0.7%id</strong>, 0.0%wa, 0.0%hi, <strong>90.7%si</strong>, 0.0%st\n    \n      PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND\n     4083 admin     15   0     0    0    0 S    2  100   <strong>101:01.47 fw_worker_1</strong>\n     4019 admin     15   0     0    0    0 S    2  100   <strong>101:01.47 fw_worker_2</strong>\n     4023 admin     15   0     0    0    0 S    2  100   <strong>101:01.47 fw_worker_5</strong>\n    ```\n    \n2.  The output of the '`fwaccel stats -s`' command shows poor acceleration ratios and a high percentage of packets that are passing through _Medium path_ (PXL):\n    \n    ```\n    <strong>Accelerated conns/Total conns : 364/13215 (2%)</strong>\n    Delayed conns/(Accelerated conns + PXL conns) : 48/12023 (0%)\n    <strong>Accelerated pkts/Total pkts   : 18252/564927 (3%)</strong>\n    F2Fed pkts/Total pkts   : 36776/564927 (6%)\n    <strong>PXL pkts/Total pkts   : 509899/564927 (90%)</strong>\n    QXL pkts/Total pkts   : 0/564927 (0%)\n    ```\n    \n3.  The output of the '`fwaccel stat`' command shows that '`Accept Templates`' are disabled after specific rule:\n    \n    ```\n    Accept Templates   : disabled by Firewall\n                         <strong>disabled from rule #251</strong>\n    ```\n    \n4.  Thorough analysis of Firewall's Connections Table (using '`connstat`' utility from [sk85780](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk85780)) during the issue (~99800 concurrent connections) showed that most matched rules are lower than Rule #251 (after which SecureXL Accept Templates are disabled):\n    \n    ```\n    Top 10 Rules: \n    =============\n    <strong>Rule: 342       Hits: 71463</strong>\n    <strong>Rule: 343       Hits: 16732</strong>\n    <strong>Rule: 356       Hits: 4488</strong>\n    <strong>Rule: 354       Hits: 3126</strong>\n    Rule: 216       Hits: 2249\n    <strong>Rule: 361       Hits: 2003</strong>\n    <strong>Rule: 357       Hits: 1536</strong>\n    Rule: 51        Hits: 722\n    Rule: 25        Hits: 666\n    <strong>Rule: 362       Hits: 426</strong>\n    ```\n    \n5.  The rule base was optimized per [sk32578 - SecureXL Mechanism](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk32578)\n    \n6.  Performance has improved greatly after this change.\n    \n7.  The output of '`fwaccel stats -s`' command showed that '`Accept Templates`' are now disabled after much lower rule:\n    \n    ```\n    Accept Templates   : disabled by Firewall\n                         <strong>disabled from rule #396</strong>\n    ```\n    \n8.  The following steps were taken to decrease the percentage of packets that are passing through _Medium path_ (PXL):\n    \n    1.  Current IPS profile:\n        \n        -   2400 protections in '`Detect`' mode\n        -   870 protections in '`Prevent`' mode\n    2.  Created a new IPS profile according to the environment:\n        \n        -   15 protections in '`Detect`' mode\n        -   570 protections in '`Prevent`' mode\n        -   All other protections were set to '`Inactive`'\n    3.  In the Application Control & URL Filtering policy, disabled the \"Any - Any - Allow\" rule.\n        \n    4.  In the Anti-Virus & Anti-Bot configuration, excluded networks, whose traffic does not have to be inspected.\n9.  Performance has improved greatly after the overall optimization:\n    \n    -   Before the optimization:\n        \n        ```\n        Accelerated pkts/Total pkts   : 18252/564927 <strong>(3%)</strong>\n        PXL pkts/Total pkts   : 509899/564927 <strong>(90%)</strong>\n        ```\n        \n    -   After the optimization:\n        \n        ```\n        Accelerated pkts/Total pkts   : 2454970439/2821805103 <strong>(87%)</strong>\n        PXL pkts/Total pkts   : 282180510/2821805103 <strong>(10%)</strong>\n        ```\n        \n\nShow / Hide example #2\n\nRelevant outputs were collected during a period of time from Security Gateway with the help of the shell script that runs relevant commands every 1 second. All outputs were analyzed and correlated with each other.\n\n1.  The output of the '`vmstat`' command showed that CPU time is consumed by:\n    \n    -   IOWait : min 0% , average 36.6% , **max 82%**\n    -   Kernel Space : min 11% , average 16.2% , **max 45%**\n    -   User Space : min 0% , average 1.8% , **max 36%**\n    \n    This leaves IDLE at **min 0%** , average 45.3% , max 89%\n    \n    _Example_:\n    \n    ```\n    procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu------\n     r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy <strong>id wa</strong> st\n    ......\n     1  7 334816 708020    820  37388 2152    0  3280     4 18012 17602  0 13  <strong>7 80</strong>  0\n    ......\n     0  9 334348 652800    988  29420 1664    0  3944     4 21575 19725  1 13  <strong>5 80</strong>  0\n    ......\n     1 12 291604 723400    884  29696  196    0  4272    12 20799 18273  5 18  <strong>0 77</strong>  0  \n    ```\n    \n2.  The output of the '`cat /proc/stat`' command showed that CPU time is consumed by:\n    \n    -   User Space : min 0% , average 1% , max 7%\n    -   Kernel Space : min 0% , average 1% , max 3%\n    -   Idle : **min 16%** , average 34% , max 54%\n    -   IOWait : min 32% , average 48% , **max 69%**\n    -   IRQ : min 0% , average 1% , max 1%\n    -   SoftIRQ : min 11% , average 14% , max 19\n3.  The output of the '`top`' command showed:\n    \n    -   fw\\_worker\\_0 / fw\\_worker\\_1 / fw\\_worker\\_2 - constantly consume CPU at ~15-20%\n    -   fw\\_worker\\_X spike to 20-25%\n    -   **'fw' spikes up to 50, 60, 80%**\n    -   fwssd , in.asessiond , in.aufpd , in.ufclnt , mdq , igwd , sds , stormd , dtps\n    \n    _Example_:\n    \n    ```\n      PID USER      PR  NI  VIRT  RES  SHR S <strong>%CPU</strong> %MEM    TIME+  COMMAND            \n     6283 root      19   0 54688  16m  12m D   <strong>87</strong>  0.8   0:00.56 <strong>fw</strong>                 \n     2283 root      15   0     0    0    0 R   30  0.0   4844:09 fw_worker_2        \n     2209 root      15   0     0    0    0 R   16  0.0   5254:57 fw_worker_1        \n     2144 root      15   0     0    0    0 S   14  0.0   5227:59 fw_worker_0\n    ```\n    \n4.  The output of the '`ps auxwf`' command correlated to the output of '`top`' command showed that during the spikes of CPU load by '`fw`', the CPD daemon calls the '`sim affinity -c`' command, which calls a series of Check Point shell scripts that calculate the current load by running various '`fw ctl`' commands. These commands process high amount of data - and this causes the spike in CPU load.  \n    The CPD daemon calling the '`sim affinity -c`' command shows that SIM Affinity is configured in Automatic mode:\n    \n    ```\n    root     15829  0.1  1.2 231704 25748 ?        Ssl  Jul23  49:45  \\_ <strong>cpd</strong>\n    root      5153  0.0  0.0   2832  1088 ?        S    12:19   0:00  |   \\_ <strong>sim affinity -c</strong>\n    root      5212  0.0  0.0   1236   564 ?        S    12:19   0:00  |       \\_ sh -c <strong>$FWDIR/scripts/fwaffinity_used_cpus</strong> &gt; /tmp/sim_fw_cpus.tmp\n    root      5213  0.0  0.0   1236   564 ?        S    12:19   0:00  |           \\_ /bin/sh <strong>/opt/CPsuite-R75.20/fw1/scripts/fwaffinity_used_cpus</strong>\n    root      5214  0.0  0.0   1236   424 ?        S    12:19   0:00  |               \\_ /bin/sh <strong>/opt/CPsuite-R75.20/fw1/scripts/fwaffinity_used_cpus</strong>\n    root      5215  0.0  0.0   1236   372 ?        S    12:19   0:00  |                   \\_ /bin/sh <strong>/opt/CPsuite-R75.20/fw1/scripts/fwaffinity_used_cpus</strong>\n    root      5216  0.0  0.8  55636 18080 ?        S    12:19   0:00  |                       \\_ <strong>fw ctl affinity -l -v</strong>\n    root      5226  0.0  0.0   1236   552 ?        S    12:19   0:00  |                       |   \\_ sh -c /bin/netstat -n 2&gt;&amp;1\n    root      5227  0.0  0.0   1668   560 ?        R    12:19   0:00  |                       |       \\_ /bin/netstat -n\n    root      5217  0.0  0.0   1644   476 ?        S    12:19   0:00  |                       \\_ grep -E -v ^Interface.*:\n    root      5218  0.0  0.0   2028   644 ?        S    12:19   0:00  |                       \\_ awk -F: {print $2}\n    root      5219  0.0  0.0   1628   464 ?        S    12:19   0:00  |                       \\_ sed -e s/CPU//\n    root      5220  0.0  0.0   1604   372 ?        S    12:19   0:00  |                       \\_ tr [:space:] \\n\n    root      5221  0.0  0.0   1644   468 ?        S    12:19   0:00  |                       \\_ grep -v ^[:space:]*$\n    root      5222  0.0  0.0  35424   508 ?        S    12:19   0:00  |                       \\_ sort\n    root      5223  0.0  0.0   1592   384 ?        S    12:19   0:00  |                       \\_ uniq\n    ```\n    \n5.  The SIM Affinity was configured from Auto Mode to Static Mode:\n    \n    **`[Expert@HostName]# sim affinity -s`**\n\n___\n\n___\n\n___\n\n## (10) Revision history\n\nShow / Hide revision history\n\n> |     Date     |                                            Description                                            |\n> |--------------|---------------------------------------------------------------------------------------------------|\n> | 26 Nov 2024  |                            Updated section (3-6) SMT (HyperThreading)                             |\n> | 26 Apr 2023  | Improved formatting  \n> Removed links to outdated SK articles  \n> Removed links to outdated documents |\n> | 02 Oct 2017  |                           Added additional related solution (sk120131)                            |\n> | 19 June 2017 |                             Updated definition of \"Medium path (PXL)\"                             |\n> | 18 June 2017 |                           Added additional related solution (sk115072)                            |\n> | 20 Apr 2017  |                           Added additional related solution (sk110351)                            |\n> | 15 Apr 2017  |                                 Added additional related solution                                 |\n> | 08 Feb 2017  |                                Added additional related solutions                                 |\n> | 21 Nov 2016  |                                       Improved HTML design                                        |\n> | 04 Aug 2016  |                              Added instructions for the `sar` command                               |\n> | 11 Jan 2016  |                         Corrected the syntax for using the `pstack` script                          |\n> | 11 Oct 2015  |                             Updated definition of \"Medium path (PXL)\"                             |\n> | 04 July 2015 |                                 Added additional related solution                                 |\n> | 11 June 2015 |                                 Added additional related solution                                 |\n> | 13 May 2015  |                                 Added additional related solution                                 |\n> | 08 Apr 2015  |                                 Added additional related solution                                 |\n> | 02 Mar 2015  |          Updated the best practices for Application Control & URL Filtering optimization          |\n> | 10 Feb 2015  |                                Added additional related solutions                                 |\n> | 14 Jan 2015  |      Corrected the the formula for calculating the maximum number of concurrent connections       |\n> | 20 Nov 2014  |         Corrected the best practices for Application Control & URL Filtering optimization         |\n> | 05 Nov 2014  |                                Added additional related solutions                                 |\n> | 08 Sep 2014  |                                       Added CPView Utility                                        |\n> | 02 July 2014 |                                Added additional related solutions                                 |\n> | 19 May 2014  |                                Added additional related solutions                                 |\n> | 13 May 2014  |                                Added additional related solutions                                 |\n> | 12 Apr 2014  |                                Added additional related solutions                                 |\n> | 16 Mar 2014  | Added additional related solutions  \n> Added SecureXL Penalty box feature to SecureXL Limitations |\n> | 12 Mar 2014  |                           Added instructions for 'pstack' shell script                            |\n> | 11 Mar 2014  |                                  First release of this document                                   |\n","language":"md","time":"14 days ago","created":"2025-05-06T22:56:08.293Z","annotations":[],"updated":"2025-05-06T22:59:15.497Z"},{"title":"IPS Protection for IPS Software Blade","id":"a9cb6eba-4e2f-4e3c-9d69-3c150ea63f02","type":"TEXT","raw":"**Table of Contents**\n\n-   Introduction\n    \n-   How Does It Work\n    \n    -   Passive Streaming Library (PSL)\n        \n    -   Protocol Parsers\n        \n    -   Context Management Infrastructure (CMI) and Protections\n        \n-   IPS Tuning Recommendations\n    \n-   Debug and Troubleshooting\n    \n\n## Introduction\n\nStarting from R80, IPS Software Blade is part of Threat Prevention solution.\n\nCheck Point IPS is an Intrusion Prevention System (IPS). IPS is a complete IPS cyber security solution, for comprehensive protection against malicious and unwanted network traffic, which focuses on application and server vulnerabilities, as well as in-the-wild attacks by exploit kits and malicious attackers.\n\nThe IPS Software Blade delivers complete and proactive intrusion prevention. It delivers 1,000s of signatures, behavioral and preemptive protections. It gives another layer of security on top of Check Point firewall technology. IPS protects both clients and servers, and lets you control the network usage of certain applications. The hybrid IPS detection engine provides multiple defense layers which allows it excellent detection and prevention capabilities of known threats, and in many cases future attacks as well. It also allows unparalleled deployment and configuration flexibility and excellent performance.\n\n### Elements of Protection\n\nIPS protection include:\n\n-   Detection and prevention of specific known exploits. \n-   Detection and prevention of vulnerabilities, including both known and unknown exploit tools, for example protection from specific CVEs. \n-   Detection and prevention of protocol misuse which in many cases indicates malicious activity or potential threat. Examples of commonly manipulated protocols are HTTP, SMTP, POP, and IMAP. \n-   Detection and prevention of outbound malware communications. \n-   Detection and prevention of tunneling attempts. These attempts may indicate data leakage or attempts to circumvent other security measures such as web filtering. \n-   Detection, prevention or restriction of certain applications which, in many cases, are bandwidth consuming or may cause security threats to the network, such as Peer to Peer and Instant Messaging applications. \n-   Detection and prevention of generic attack types without any pre-defined signatures, such as Malicious Code Protector.\n\nCheck Point constantly updates the library of protections to stay ahead of emerging threats.\n\n###   \nCapabilities of IPS\n\nThe unique capabilities of the Check Point IPS engine include:\n\n-   Clear, simple management interface. \n-   Reduced management overhead by using one management console for all Check Point products. \n-   Integrated management with SmartConsole. \n-   Easy navigation from business-level overview to a packet capture for a single attack. \n-   #1 security coverage for Microsoft and Adobe vulnerabilities. \n-   Resource throttling so that high IPS activity will not impact other blade functionality.\n-   Complete integration with Check Point configuration and monitoring tools in SmartConsole, to let you take immediate action based on IPS information.\n\nFor example, some malware can be downloaded by a user unknowingly when he browses to a legitimate web site, also known as a drive-by-download. This malware can exploit a browser vulnerability to create a special HTTP response and sending it to the client. IPS can identify and block this type of attack even though the firewall may be configured to allow the HTTP traffic to pass.\n\n## How Does It Work\n\nIPS uses the CoreXL technology which leverages multi-core. Each firewall instance can run on a separate core and many instances can run in parallel. The IPS code runs in a monolithic part of the firewall kernel. Each such per-core instance runs firewall and IPS and Dispatchers are bound to a network interface using IRQ affinity.\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95193/pic1.jpg)\n\nIn the above example there are 4 dispatchers and 8 instances. Same connections and Data and Control connections are sticky to the same core and decision function to which instance the packet should go, works according to Source and Destination IP addresses and Destination port.\n\nIPS has 4 layers:\n\n-   Passive Streaming Library (PSL)\n-   Protocol Parsers\n-   Context Management Interface layer (CMI)\n-   Protections\n\n## Passive Streaming Library (PSL)\n\nPackets may arrive out of order or may be legitimate retransmissions of packets that have not yet received an acknowledgment. In some cases a retransmission may also be a deliberate attempt to evade IPS detection by sending the malicious payload in the retransmission. Security Gateway ensures that only valid packets are allowed to proceed to destinations. It does this with Passive Streaming Library (PSL) technology.\n\n-   PSL is an infrastructure layer, which provides stream reassembly for TCP connections.\n-   The gateway makes sure that TCP data seen by the destination system is the same as seen by code above PSL.  \n    This layer handles packet reordering, congestion handling and is responsible for various security aspects of the TCP layer such as handling payload overlaps, some DoS attacks and others.\n-   The PSL layer is capable of receiving packets from the firewall chain and from SecureXL module.\n-   The PSL layer serves as a middleman between the various security applications and the network packets. It provides the applications with a coherent stream of data to work with, free of various network problems or attacks\n-   The PSL infrastructure is wrapped with well defined APIs called the Unified Streaming APIs which are used by the applications to register and access streamed data.\n\n## Protocol Parsers\n\nThe Protocol Parsers main functions are to ensure compliance to well-defined protocol standards, detect anomalies if any exist, and assemble the data for further inspection by other components of the IPS engine. They include HTTP, SMTP, DNS, IMAP, Citrix, and many others. In a way, protocol parsers are the heart of the IPS system. They register themselves with the streaming engine (usually PSL), get the streamed data, and dissect the protocol.  \nThe protocol parsers can analyze the protocols on both Client to Server (C2S) and Server to Client (S2C) directions. The outcome of the protocol parsers are contexts. A context is a well defined part of the protocol, on which further security analysis can be made. Examples of such contexts are HTTP URL, FTP command, FTP file name, HTTP response, and certain files.  \n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95193/pic2.jpg)  \nProtocol Parsers Enable IPS Inspection by Dissecting the Protocol for Streamed Data\n\nWhen the protocol parsers discover a certain context, e.g. the HTTP URL, they will use the next layer, the Context Management Interface layer (CMI) to activateall the protections relevant to this specific context.\n\n## Context Management Infrastructure (CMI) and Protections\n\nThe Context Management Infrastructure (CMI) is the \"brain\" of the IPS. It coordinates different components, decides which protections should run on a certain packet, decides the final action to be performed on the packet and issues an event log.  \nCMI separates parsers and protections. Protection is a set of signatures or/and handlers, where\n\n-   Signature - a malicious pattern that is searched for\n-   Handler - INSPECT code that performs more complex inspection\n\nCMI is a way to connect and manage parsers and protections. Since they are separated, protections can be added in updates, while performance does not depend on the number of active protections. Protections are usually written per protocol contexts - they get the data from the contexts and validate it against relevant signatures\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95193/pic3.jpg)\n\nBased on the IPS policy, the CMI determines which protections should be activated on every context discovered by a protocol parser. If policy dictates that no protections should run, then the relevant parsers on this traffic are bypassed in order to improve performance and reduce potential false positives. For example, if the IPS policy is activating server protections only, then the HTTP parser will not analyze the server to client (S2C) traffic.\n\nWhen a protection is activated, it can decide whether the given packet or context is OK or not. It does not decide what to do with this packet. The CMI is responsible for the final action to be performed on the packet, given several considerations.  \nThe considerations include:\n\n-   Activation status of the protection (Prevent, Detect, Inactive)\n-   Exceptions either on traffic or on protection\n-   Bypass mode status (the software fail open capability)\n-   Troubleshooting mode status\n-   Are we protecting the internal network only or all traffic\n\n**Pattern Matcher  \n**\n\nThe Pattern Matcher is a fundamental engine within the new enforcement architecture.\n\n-   Pattern Matcher quickly identifies harmless packets, common signatures in malicious packets, and does a second level analysis to reduce false positives.\n-   Pattern Matcher engine provides the ability to find regular expressions on a stream of data using a two tiered inspection process:\n    -   The first tier quickly filters out the vast majority of traffic which is clearly harmless by looking for signatures that are simple to find at a low CPU cost.\n    If the first tier identifies a common attack signature it passes the connection to the second tier to do a second level analysis, thus increasing the confidence that there is indeed an attack.-   The first tier will never decide on it’s own that a packet is malicious. It can only decide that a packet is clearly harmless.\n    -   The second tier can also be instructed to activate further inspection using INSPECTv2 technology when some patterns are matched.\n\n  \nExample of how IPS inspects traffic and identifies attacks:\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95193/diag4-11509020212.jpg)\n\n## IPS Tuning Recommendations\n\n**IPS Updates**\n\nCheck Point issues a new protections package as required, and at least once a week. It is important to review the Check Point IPS Update when it is published. If a protection against zero-day vulnerability is published, or any other protection that may be judged as urgent for your specific environment, consider deploying it in Prevent immediately. The risk of potential disruption for legitimate traffic exists, of course, but the benefits of protecting against active, on-going attacks may be bigger.\n\n**Software Upgrades**\n\nCheck Point IPS capabilities are a combination of the features of the IPS engine (the core code that parses and inspects the traffic) and the protections that are added on a continuous basis. The engine code is often improved as part of gateway software upgrades, allowing for better protection and performance following an upgrade.  \nFor example, Non-Compliant HTTP was improved for R75.40 while Non-Compliant DNS is improved in R76. Therefore, it is important to review the release notes of new software versions, and install software updates routinely.\n\n**Separate Profiles**\n\nThere are situations where different gateways may benefit from separate profiles, to improve security and/or performance. For example, perimeter gateways should have a separate profile than gateways that protect data centers. Also, if gateways run different software versions, they may require separate profiles.\n\n**IPS Management Tips**\n\n**Working with multiple protections:** For tuning purposes you may want to change the settings of many protections at once (e.g., change the action from 'detect' to 'prevent'.) You can use the 'Follow Up' flag to mark the protections you wish to change the settings for, then sort the protections list by the Follow Up column, easily select the set of flagged protections, and right-click to apply the action to all.Protections flagged for 'Follow Up' can be easily accessed from the left menu in the IPS tab.  \n**Application Control protections:**protections of this type identify and can control the use of specific applications and protocols, e.g., VNC, BitTorrent, Google Talk, TeamViewer, etc. The optimal way to enforce applications use policy is through Check Point Application Control blade, as it offers many more protections, all up-to-date.  \n**Denial of Service protections:** there are several protections that look for extensive use of Web Servers protocols (UDP, HTTP, SSL) that may detect (and protect against) denial of service attacks. We advise customers to activate the denial of service protections and review all other Application Control protections.\n\n**Important note:** To ensure IPS protections are enforced on HTTPS traffic, HTTPS Inspection must be enabled in the Security Gateway/Cluster properties in SmartConsole, with inspection enabled for the respective traffic.\n\n## Debug and Troubleshooting\n\n-   To debug IPS during issues with DCE-RPC traffic, refer to [sk60395](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk60395)[](http://supportcontent.checkpoint.com/solutions?id=sk95134)\n-   Problem: IPS scheduled update fails - refer to [sk93403](http://supportcontent.checkpoint.com/solutions?id=sk93403)","language":"md","time":"14 days ago","created":"2025-05-06T22:56:02.619Z","annotations":[],"updated":"2025-05-06T22:57:56.045Z"},{"title":"ProductHTTPS Inspection","id":"928e93ba-1fd4-4272-8e4d-bbb43b3c8522","type":"TEXT","raw":"ProductHTTPS Inspection\n\nVersionR80.10 (EOS), R80.20 (EOS), R80.20.x, R80.20SP (EOS), R80.30 (EOS), R80.30SP (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.10.x, R81.20, R82\n\nOSGaia\n\nLast Modified2025-01-21\n\n## Symptoms\n\n-   HTTPS Inspection does not inspect traffic that is destined for the Security Gateway / Cluster.\n    \n-   Kernel debug ('_fw ctl debug -m WS + ssl\\_insp_') on the Security Gateway / Cluster Members shows this message:\n    \n    `kfunc_https_inspection_rb_match: source or dest IP is gw IP, don't run SSL inspection`\n    \n\n## Cause\n\nBy design, the Security Gateway / Cluster does not perform HTTPS Inspection on traffic that is destined for it.\n\n## Solution\n\nYou can control the Security Gateway / Cluster behavior in these versions:\n\n-   R80.10 and higher\n-   R77.30 with the [R77.30 Jumbo Hotfix Accumulator](https://support.checkpoint.com/results/sk/sk106162), Take 320 and higher\n-   Quantum Spark R81.10.00 and higher\n-   Quantum Spark R80.20.00 and higher\n\n###   \nTo start HTTPS Inspection on traffic that is destined for the Security Gateway / Cluster\n\nShow / Hide this section\n\n1.  Connect to the command line on the Security Gateway / each Cluster Member.\n    \n2.  Configure the value \"1\" (one) for the kernel parameter \"_ssl\\_inspection\\_inspect\\_traffic\\_to\\_gw_\":\n    \n    -   In versions R80.20 and higher:\n        \n        `fw ctl set -f int ssl_inspection_inspect_traffic_to_gw 1`\n        \n        **Note** - This command configures the value in the current session and permanently in the _$FWDIR/boot/modules/fwkern.conf_ file.\n        \n    -   In versions R80.10 and R77.30 Jumbo Hotfix Accumulator Take 320 (and higher):\n        \n        1.  Log in to the Expert mode.\n            \n        2.  Configure the required value in the current session:\n            \n            `fw ctl set int ssl_inspection_inspect_traffic_to_gw 1`\n            \n        3.  Configure the required value permanently:\n            \n            1.  Back up the current _$FWDIR/boot/modules/fwkern.conf_ file:\n                \n                `cp -v $FWDIR/boot/modules/fwkern.conf{,_Before_sk114574}`\n                \n            2.  Edit the current _$FWDIR/boot/modules/fwkern.conf_ file:\n                \n                `vi $FWDIR/boot/modules/fwkern.conf`\n                \n            3.  Add this line:\n                \n                `ssl_inspection_inspect_traffic_to_gw=1`\n                \n            4.  Save the changes in the file and exit Vi editor.\n                \n\n### To stop HTTPS Inspection on traffic that is destined for the Security Gateway / Cluster\n\nShow / Hide this section\n\n1.  Connect to the command line on the Security Gateway / each Cluster Member.\n    \n2.  Configure the value \"0\" (zero) for the kernel parameter \"_ssl\\_inspection\\_inspect\\_traffic\\_to\\_gw_\":\n    \n    -   In versions R80.20 and higher:\n        \n        `fw ctl set -f int ssl_inspection_inspect_traffic_to_gw 0`\n        \n        **Note** - This command configures the value in the current session and permanently in the _$FWDIR/boot/modules/fwkern.conf_ file.\n        \n    -   In versions R80.10 and R77.30 Jumbo Hotfix Accumulator Take 320 (and higher):\n        \n        1.  Log in to the Expert mode.\n            \n        2.  Configure the required value in the current session:\n            \n            `fw ctl set int ssl_inspection_inspect_traffic_to_gw 0`\n            \n        3.  Configure the required value permanently:\n            \n            1.  Back up the current _$FWDIR/boot/modules/fwkern.conf_ file:\n                \n                `cp -v $FWDIR/boot/modules/fwkern.conf{,_Default_sk114574}`\n                \n            2.  Edit the current _$FWDIR/boot/modules/fwkern.conf_ file:\n                \n                `vi $FWDIR/boot/modules/fwkern.conf`\n                \n            3.  Delete this line:\n                \n                `ssl_inspection_inspect_traffic_to_gw=1`\n                \n            4.  Save the changes in the file and exit Vi editor.\n                \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorAlmog Sasson\n\nTechnical ResourceMatan Giladi\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2016-11-17\n\nLast Modified2025-01-21\n\nEditorAlmog Sasson\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only\n\nThis specific hotfix is for Inbound HTTPS Inspection when the Security Gateway is the Destination IP of the HTTPS packet.\n\nThe fix made for this specific scenario and it should work for Outbound HTTPS Inspection as well, but only if the Security Gateway is the **Destination IP address.**\n\nIf a fix is required when the Security Gateway is the Source IP address, investigation task should be opened with CFG.\n\nUse CR02378466 in case a portfix is required for this specific scenario.\n\nPort fix to take 216 - Task ID: 70991-Inbound https inspection fails for vsec on aws\n\n\\\\\\\\galaxy\\\\ckp\\\\pkg\\\\fw1\\_wrapper\\\\R77\\_30\\_jhf\\_t216\\_311\\\\B990311001\\_1\\\\linux30\n\nKernel parameter that is added and needs to be set.\n\nFix is disabled when ssl\\_inspection\\_inspect\\_traffic\\_to\\_gw=0 (default value) Fix is enabled when ssl\\_inspection\\_inspect\\_traffic\\_to\\_gw=1 for turn on: please run:  \n#fw ctl set int ssl\\_inspection\\_inspect\\_traffic\\_to\\_gw 1  \ncheck it with:  \n#fw ctl get int ssl\\_inspection\\_inspect\\_traffic\\_to\\_gw  \nAlso follow sk26202 - Changing the kernel global parameters for Check Point Security Gateway\n\nThe fix in intergrated in R80.10 as CR02391750.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:12.017Z","annotations":[],"updated":"2025-05-06T22:58:39.023Z"},{"title":"ProductIdentity Awareness","id":"4c82cc36-12bc-4892-bce4-36dea21c6388","type":"TEXT","raw":"ProductIdentity Awareness\n\nVersionR81 (EOS), R81.10, R81.20, R82\n\nLast Modified2025-01-14\n\n## Solution\n\nThis article specifies the troubleshooting steps you can take in a scenario where the Identity Awareness transparent portal is not working and the user is redirected to the captive portal, or when Identity Agent authentication using Kerberos fails and the user is prompted with username-password.\n\n**Prerequisites**\n\n-   Kerberos configuration is done according the Identity Awareness admin guide.\n    \n-   The user receives a proper fallback from Kerberos authentication failure:\n    \n    -   For transparent portal – user is redirected to regular captive portal\n    -   For Identity Agent – User is prompt with username password request\n    \n    If this is not the case, the issue can be related to Kerberos, connectivity issue for example.\n    \n\n**Note:** Kerberos Agent for SMB is not supported! Only browser-based authentication is.\n\n**Troubleshooting steps:**\n\n1.  Active Directory:\n    \n    Using the `setspn` command help to make sure that Active Directory is configured correctly, and that a user account is associated with the Service Principal Name.\n    \n    Run these commands on the Active Directory:\n    \n    -   setspn -Q HTTP/\\*\n    -   setspn -Q ckp\\_pdp/\\*\n    \n    Note: The first command is for transparent portal, and the second is for Identity agent with Kerberos.\n    \n    The expected result should be similar to:  \n     `C:\\Users\\Administrator>setspn -Q HTTP/*    Checking domain DC=example,DC=com    CN=ckpsso,CN=Users,DC= example,DC=com    HTTP/gateway.example.com    Existing SPN found!`\n    \n    Where ckpsso is the dedicated user account, and gateway.example.com is exactly the full DNS name configured at transparent portal URL at the SmartConsole.  \n    In case you didn't receive the expected result check Transparent Kerberos Authentication Configuration section at Identity Awareness admin guide regarding Creating a New User Account and Mapping the User Account to a Kerberos Principal Name.\n    \n    Note: For Identity Agent, the expected result would be _`ckp_pdp/example.com`_ (only domain name is used, not full DNS name like in the transperent portal).\n    \n2.  In SmartConsole:\n    \n    1.  Make sure that the relevant LDAP Account Unit (AU) configuration:\n        \n        Open the relevant LDAP AU, click on Active Directory SSO configuration, make sure Use Kerberos Single Sign On is turned on and that the fields are correct.\n        \n    2.  If you are using Transparent portal, make sure that the feature is turned on, see Enabling Kerberos Authentication section at Identity Awareness admin guide.\n        \n3.  On the end user client:\n    \n    1.  Make sure that the user is connected to Active Directory domain that is configured at the LDAP AU.\n        \n    2.  Make sure that the Security Gateway's portal URL is trusted by the browser, see Browser Configuration section at Identity Awareness admin guide.\n        \n4.  On all the above components:\n    \n    Make sure that there is no clock differences (above 5 minutes), Kerberos protocol is very sensitive to clock differences.\n    \n\nIf all the configuration above is OK and the issue persists, continue to analyze the issue:\n\n1.  **Analyzing user's Kerberos tickets**\n    \n    Confirm that the end user client receives the relevant Kerberos Ticket:\n    \n    Use klist command (available on Windows and Mac) to view all the Kerberos tickets for the current user, look for Kerberos ticket for the relevant SPN, for example:\n    \n     `C:\\Users\\benr> klist    #1> Client: benr @ WOW.COM    Server: HTTP/gateway.wow.com @ WOW.COM    KerbTicket Encryption Type: RSADSI RC4-HMAC(NT)    Ticket Flags 0x40a00000 -> forwardable renewable pre_authent    Start Time: 1/1/2015 17:33:11 (local)    End Time: 1/2/2015 3:33:11 (local)     Renew Time: 1/8/2015 17:33:11 (local)    Session Key Type: RSADSI RC4-HMAC(NT)`\n    \n    If there is a proper Kerberos ticket, it's probably means the browser or the Identity Agent is sending it to the Security Gateway. See below how to troubleshoot the Security Gateway.\n    \n2.  **Analyzing Kerberos ticket granting with packet capture**\n    \n    If there is no Kerberos ticket, debug the client and see the communication with the Active Directory and with the Security Gateway.\n    \n    The most effective troubleshooting is with a clean environment. Close all instances of the browser, or the identity agent, and run this command (which revokes all users' Kerberos tickets):\n    \n    > -   Windows: `klist purge`\n    >     \n    > -   Mac: `kdestroy -a`\n    >     \n    \n    1.  Use Wireshark (or any other traffic capture program) on the end user client to monitor the traffic, turn on Wireshark on relevant interfaces, and then open the browser and go to some websites (in order to troubleshoot transparent portal), or turn on the Identity agent.\n        \n        After the user is prompt with the fallback action (redirect to regular captive portal or prompt with username password), stop the Wireshark.\n        \n    2.  This example shows the flow in the transparent portal.\n        \n        First, look at the HTTP connection that the Security Gateway should redirect:\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104055/ss01.png)\n        \n    3.  Next, the browser opens a new connection to the redirect page - /autoauth/ where the Security Gateway is the host, the Security Gateway returns response code 401 and request Negotiation using Kerberos:\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104055/ss02.png)\n        \n    4.  After this challenge, the browser should contact the Active Directory and get the Kerberos ticket. This connection is on port 88. (In case you do NOT see communication with the Active Directory, clear the browser's cache and restart the browser):\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104055/ss03.png)\n        \n    5.  As we see the ticket request is for HTTP and Security Gateway.wow.com which is where the browser was redirected to by the Security Gateway, this is why the URL of the portal (configure at the SmartConsole) needs to be the same like configured using setspn command on the Active Directory.\n        \n        Next the Active Directory will return a reply with the Kerberos ticket (if successful) with the relevant SPN:\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104055/ss04.png)\n        \n        In such case of success, klist command on the user client will should show the ticket.\n        \n    6.  If the SPN was not configured correctly, the Active Directory returns failure:\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104055/ss05.png)\n        \n        In this case refer to above sections regarding the configuration on the Active Directory and the Security Gateway.\n        \n    7.  If the client receives the Kerberos ticket from the Active Directory the next thing we should see in the packet capture is a connection from the client to the autoauth page at portal:\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104055/ss06.png)\n        \n    8.  If the section in green is long, it is probably a valid Kerberos ticket, but some times you can see that the client sends the following ticket:\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104055/ss07.png)\n        \n        This means that the browser did not get a valid Kerberos ticket, and trying to do a fallback of NTLM (which is writen in Base64 after Negotiate), the Security Gateway cannot validate that ticket and redirects the browser to the regular captive portal.\n        \n        In this case refer to the above sections regarding the configuration on the Active Directory, Security Gateway and the browser, and make sure that the portal URL in trusted by the browser).\n        \n    9.  If the Kerberos ticket looks valid, the Security Gateway received it meaning that in case of failure you should get failed log in log at the SmartView Tracker, for example:\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104055/ss08.png)\n        \n        The description of the message can help to understand the issue. In this example the password configured for the user on the Active Directory for this SPN and the password on the LDAP AU under Use Kerberos Single Sign On doesn't match.\n        \n        In case of failure at the packet capture you should see the Security Gateway redirects the browser to the regular captive portal:\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104055/ss09.png)\n        \n    10.  When the negotiation is successful, you see a redirection to the original website:\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104055/ss10.png)\n        \n\n**Related Solutions:**\n\n-   [sk145772 - Identity Agent Kerberos SSO authentication fails with \"Minor code:Wrong principal in request\"](https://support.checkpoint.com/results/sk/sk145772)\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorBen Rosental\n\nTechnical ResourceRoyi Priov\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2015-01-12\n\nLast Modified2025-01-14\n\nEditorGil Frantsus\n\nLast ApproverGil Frantsus","language":"md","time":"14 days ago","created":"2025-05-06T22:56:09.041Z","annotations":[],"updated":"2025-05-06T22:58:23.572Z"},{"title":"BGP Configuration Action Plan","id":"688f2dc9-a895-42ab-97a1-727b0dcc5a0f","type":"TEXT","raw":"**Table of Contents:**\n\n1.  Objective\n    \n2.  Introduction to BGP\n    \n3.  Network Topology\n    \n4.  BGP Configuration action plan\n    \n5.  Configuring basic BGP in Gaia Portal\n    \n6.  Configuring basic BGP on CLI\n    \n7.  Verifying basic BGP Configuration\n    \n8.  Multi-Exit Discriminator (MED)\n    \n9.  How to avoid common BGP configuration issues\n    \n10.  Documentation\n    \n    -   Product pages\n        \n    -   Check Point Release Notes\n        \n    -   Check Point Administration Guides\n        \n    -   Additional documents\n        \n    -   RFC\n        \n    -   External references\n        \n11.  Related solutions\n    \n\n### (1) Objective\n\nThis article describes how to setup BGP between two Autonomous Systems (AS) in a Standalone environment or in a ClusterXL environment running Check Point Gaia OS.\n\nThis article does not cover all the features of BGP - it focuses on a very basic BGP configuration, such as External BGP (eBGP, or Exterior Border Gateway Protocol), and does not discuss any Internal BGP (iBGP, or Interior Border Gateway Protocol) features like route reflectors or confederations.\n\n### (2) Introduction to BGP\n\nBorder Gateway Protocol (BGP) is an inter-AS protocol, meaning that it can be deployed within and between Autonomous Systems (AS). An Autonomous System is a set of routers under a single technical administration.\n\nAn Autonomous System uses an interior gateway protocol and common metrics to route packets within an Autonomous System; it uses an exterior routing protocol to route packets to other Autonomous Systems.\n\nBGP sends update messages that consist of network number-AS path pairs. The AS path contains the string of Autonomous Systems, through which the specified network can be reached. An AS path has some structure in order to represent the results of aggregating dissimilar routes. These update messages are sent over TCP transport mechanism to ensure reliable delivery. BGP contrasts with IGPs, which build their own reliability on top of a datagram service.\n\n### (3) Network Topology\n\nThe following topology was used for this article:\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95967/Network_Topology_1.png \"Example of network topology between 2 single gateways\")\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95967/Network_Topology_2.png \"Example of network topology between 2 clusters\")\n\n### (4) BGP Configuration action plan\n\nAction plan and notes:\n\n-   If configuring BGP on ClusterXL / VRRP cluster, then use cluster Virtual IP addresses.\n\n### (5) Configuring basic BGP in Gaia Portal\n\n1.  Connect to Gaia Portal on Security Gateway with a web browser at `https://_<Gateway_IP_address>_`.\n2.  Once connected, make sure you are in the '`Advanced Mode`' (check the upper left corner).\n3.  Go to '`Advanced Routing`' section - go to '`BGP`' pane.\n4.  Enter Router-ID:\n    \n    Notes:\n    \n    -   The Router ID uniquely identifies the router in the Autonomous System.\n    -   Router ID can be any IPv4 address (it does not necessarily need to be IP address assigned to the Security Gateway you are configuring).\n    -   If configuring BGP on ClusterXL / VRRP cluster, then use cluster Virtual IP addresses.\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95967/BGP_in_Gaia_Portal_1.png \"To see in full size, open the image in a new tab/window\")\n    \n5.  Click on '`Change Local System Identification`' button - change the local AS number to 65000:\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95967/BGP_in_Gaia_Portal_2.png)\n    \n6.  '`Peers Groups`' section, click on '`Add`' button - in the '`Peer AS Number`' field, enter 65001:\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95967/BGP_in_Gaia_Portal_3.png)\n    \n7.  In '`Peers`' section, click on '`Add Peer`' - select '`Add IPv4 Peer`':\n    1.  When a warning pops up \"Adding a peer will lock the Peer AS Number\", just click on '`OK`' to continue.\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95967/BGP_in_Gaia_Portal_4.png)\n        \n    2.  In the '`Peer`' field, enter 10.10.60.11 and click on '`Save`' to close the '`Add IPv4 Peer`' window.\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95967/BGP_in_Gaia_Portal_5.png)\n        \n    3.  Click on '`Save`' to close the '`Add Peer Group`' window.\n8.  Go to '`Advanced Routing`' section - go to '`Inbound Route Filters`' pane.\n9.  Click on '`Add`' button - select '`Add BGP Policy (Based on AS)`':\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95967/BGP_in_Gaia_Portal_6.png)\n    \n10.  In the '`Add BGP Policy`' line:\n    \n    1.  Enter any number from 512-1024 for BGP policy in the left field.\n    2.  Enter 65001 for AS number in the right field.\n    3.  Click on '`Save`' button.\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95967/BGP_in_Gaia_Portal_7.png)\n    \n11.  Go to '`Advanced Routing`' section - go to '`Route Redistribution`' pane.\n12.  Click on '`Add Redistribution From`' button - select '`Interface`':\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95967/BGP_in_Gaia_Portal_8.png)\n    \n13.  In the '`Add Redistribution From Interface`' window:\n    \n    1.  In the '`To Protocol`' field, select '`BGP AS 65001`' (select the protocol, to which you are redistributing the routes).\n    2.  In the '`Interface`' field, select '`eth2`' (select the interface, which you would like to redistribute into BGP).\n    3.  Metric is an optional value.\n    4.  Click on '`Save`' button.\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95967/BGP_in_Gaia_Portal_9.png)\n    \n14.  Configure the same settings on the other BGP peers (make sure to enter the correct AS number and the Peer IP address).\n\n### (6) Configuring basic BGP on CLI\n\n**Notes:**\n\n-   Basic BGP setup can be configured on the CLI using the commands below.\n-   Inbound route filtering and route redistribution must be configured in Gaia Portal.\n-   Routemaps that can be used for route filtering (not discussed in this article) can also be configured on the CLI.\n-   If configuring BGP on ClusterXL / VRRP cluster, then use cluster Virtual IP addresses.\n-   On VSX Gateway / VSX Cluster Member, the configuration must be performed in the context of Virtual Systm / Virtual Router (_vsenv <VSID>_).\n\n**Procedure:**\n\n1.  Connect to command line on the Gaia OS (over SSH, or console).\n2.  Log in to Clish.\n3.  Configure the BGP:\n    \n    ```\n    BGP-10&gt; set as 65000\n    BGP-10&gt; set router-id 10.10.60.10\n    BGP-10&gt; set bgp external remote-as 65001 on\n    BGP-10&gt; set bgp external remote-as 65001 peer 10.10.60.11 on\n    BGP-10&gt; set bgp external remote-as 65001 peer 10.10.60.11 holdtime 90\n    BGP-10&gt; set bgp external remote-as 65001 peer 10.10.60.11 keepalive 30\n    ```\n    \n4.  Save the configuration:\n    \n    `BGP-10> save config`\n    \n5.  Configure the same settings on the other BGP peers (make sure to enter the correct AS number and the Peer IP address).\n\n### (7) Verifying basic BGP Configuration\n\n```\nBGP-10&gt; <strong>show bgp peers</strong>\n\nFlags: R - Peer restarted, W - Waiting for End-Of-RIB from Peer\n\nPeerID        AS     Routes  ActRts  State             InUpds  OutUpds  Uptime\n10.10.60.11   65001  1       1       Established       1       1        2d19h\nBGP-10&gt;\n```\n\nThe states and their meanings are explained below:\n\n-   **Idle** is the initial state of a BGP connection. The BGP speaker is waiting for a start event, generally either the establishment of a TCP connection or the re-establishment of a previous connection. Once the connection is established, BGP moves to the next state.\n-   **Connect** is the connection phase. If the TCP connection completes, BGP will move to the OpenSent stage. If the connection does not complete, BGP goes to Active.\n-   **Active** indicates that the BGP speaker is continuing to create a peer relationship with the remote router. If this is successful, the BGP state goes to OpenSent. You'll occasionally see a BGP connection flap between Active and Connect. This indicates an issue with the physical cable itself, or with the configuration.\n-   **OpenSent** indicates that the BGP speaker has received an Open message from the peer. BGP will determine whether the peer is in the same AS (iBGP) or a different AS (eBGP) in this state.\n-   **OpenConfirm** indicates the BGP speaker is waiting for a keepalive message.\n-   **Established** is reached once a keepalive is received in the `OpenConfirm` state. Updates should happen here.\n\n```\nBGP-10&gt; <strong>show route bgp</strong>\nCodes: C - Connected, S - Static, R - RIP, B - BGP,\n       O - OSPF IntraArea (IA - InterArea, E - External, N - NSSA)\n       A - Aggregate, K - Kernel Remnant, H - Hidden, P - Suppressed,\n       U - Unreachable, i - Inactive\n\nB         10.10.100.0/24      via 10.10.60.11, eth1, cost -1, age 243289\nBGP-10&gt;\n```\n\n```\nBGP-10&gt; <strong>show bgp stats</strong>\n\nPeer: 10.10.60.11\n                      Received            Sent\n    Opens                    0               1\n    Notifications            0               0\n    Updates                  1               1\n    Keepalives             528             528\n    Route Refresh            0               0\nBGP-10&gt;\n```\n\n### (8) Multi-Exit Discriminator (MED)\n\nMulti-Exit Discriminator (MED) values are used to help external neighbors decide which of the available entry points into an AS are preferred. A lower MED value is preferred over a higher MED value and breaks the tie between two or more preferred paths.\n\n**Note:** A BGP session does not accept MEDs from an external peer unless the Accept MED field is set for an external peer.\n\n_Example_:\n\nThis configuration accepts MED-values from the peer 10.10.60.11 and sets the value of 20 to all route advertisements towards that peer.\n\n```\nBGP-10&gt; set bgp external remote-as 65001 peer 10.10.60.11 accept-med on\nBGP-10&gt; set bgp external remote-as 65001 peer 10.10.60.11 med-out 20\nBGP-10&gt; save config\n```\n\nOutput of the **`show route bgp`** command shows the cost value of 20 that is advertised towards the MED peer:\n\n```\nBGP-10&gt; <strong>show route bgp</strong>\nCodes: C - Connected, S - Static, R - RIP, B - BGP,\n       O - OSPF IntraArea (IA - InterArea, E - External, N - NSSA)\n       A - Aggregate, K - Kernel Remnant, H - Hidden, P - Suppressed,\n       U - Unreachable, i - Inactive\n\nB         10.10.100.0/24      via 10.10.60.11, eth1, <strong>cost 20</strong>, age 815\nBGP-10&gt;\n```\n\n### (9) How to avoid common BGP configuration issues\n\n1.  Confirm the capabilities for BGP peers match exactly to that configured on Check Point Security Gateway.  \n    The Clish command \"_show bgp peers detailed_\" should help you identify the capability mismatch.\n2.  Do _**not**_ enable iBGP sync if you do not need it.  \n    iBGP synchronization is only supposed to be used when the intermediate routers in the AS have no way to reach the prefix being learned.\n3.  BGP graceful restart: Make sure that neighbors are also configured with BGP graceful restart capability.\n4.  Use eBGP multi-hop for peers not connected directly. Do not use BGP routes to establish connections to multi-hop peers.\n5.  iBGP routes learned from one iBGP peer cannot be redistributed to another iBGP peer as per the RFC.\n6.  In BGP, routes are not installed by default, unless an inbound policy (either route map, or route filter) is configured to accept the routes.\n7.  Do not configure a static route for directly connected neighbors. Configuring such route can result in nexthop being resolved to 0.0.0.0 which can result in hidden routes. Refer task 102868. \n8.  When configuring BGP With VR in VSX,  If routes are hidden make sure that routes being received do not have a local nexthop.   BGP RFC does not allow routes to be installed if nexthop is our own IP.\n9.  Route (Static/OSPF/Connected) to reach Multihop BGP peer must always be preferred to a route to reach the same peer via BGP. If not followed then routed can run with high CPU because of the cycling of routes from Static/OSPF/Connected to BGP to Static/OSPF/Connected. .\n\n### (10) Documentation\n\n<table><tbody><tr><td id=\"Documentation - Product pages\" colspan=\"2\">Product pages</td></tr><tr><td>Product pages</td><td><ul><li><a href=\"http://www.checkpoint.com/products/advanced-networking-and-clustering-software-blade/index.html#specs\" target=\"_blank\" rel=\"noopener\">Advanced Networking &amp; Clustering Software Blade</a></li><li><a href=\"http://www.checkpoint.com/gaia/#features\" target=\"_blank\" rel=\"noopener\">Check Point Gaia OS</a></li></ul></td></tr><tr><td id=\"Documentation - Check Point Release Notes\" colspan=\"2\">Check Point Release Notes</td></tr><tr><td>Release Notes</td><td><a href=\"http://supportcontent.checkpoint.com/documentation_download?id=13079\" target=\"_blank\" rel=\"noopener\">R75.40</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=16421\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=18381\" target=\"_blank\" rel=\"noopener\">R75.45</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=23394\" target=\"_blank\" rel=\"noopener\">R75.46</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=25460\" target=\"_blank\" rel=\"noopener\">R75.47</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=22933\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=24827\" target=\"_blank\" rel=\"noopener\">R77</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=30257\" target=\"_blank\" rel=\"noopener\">R77.10</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=31853\" target=\"_blank\" rel=\"noopener\">R77.20</a>,&nbsp;<a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=40107\" target=\"_blank\" rel=\"noopener\">R77.30</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=54802\" target=\"_blank\" rel=\"noopener\">R80.10</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.20_GA/WebAdminGuides/EN/CP_R80.20_RN/html_frameset.htm\" target=\"_blank\" rel=\"noopener\">R80.20</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.30/WebAdminGuides/EN/CP_R80.30_RN/html_frameset.htm\" target=\"_blank\" rel=\"noopener\">R80.30</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.40/WebAdminGuides/EN/CP_R80.40_RN/Default.htm\" target=\"_blank\" rel=\"noopener\">R80.40</a>, <a href=\"https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_RN/Default.htm\" target=\"_blank\" rel=\"noopener\">R81</a></td></tr><tr><td id=\"Documentation - Check Point Administration Guides\" colspan=\"2\">Check Point Administration Guides</td></tr><tr><td>Gaia Advanced Routing Administration Guide</td><td><a href=\"http://supportcontent.checkpoint.com/documentation_download?id=13221\" target=\"_blank\" rel=\"noopener\">R75.40</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=16245\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=22929\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=24803\" target=\"_blank\" rel=\"noopener\">R77.X</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=54803\" target=\"_blank\" rel=\"noopener\">R80.10</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.20_GA/WebAdminGuides/EN/CP_R80.20_Gaia_Advanced_Routing_AdminGuide/html_frameset.htm\" target=\"_blank\" rel=\"noopener\">R80.20</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.30/WebAdminGuides/EN/CP_R80.30_Gaia_Advanced_Routing_AdminGuide/html_frameset.htm\" target=\"_blank\" rel=\"noopener\">R80.30</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.40/WebAdminGuides/EN/CP_R80.40_Gaia_Advanced_Routing_AdminGuide/Default.htm\" target=\"_blank\" rel=\"noopener\">R80.40</a>, <a href=\"https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_Gaia_Advanced_Routing_AdminGuide/Default.htm\" target=\"_blank\" rel=\"noopener\">R81</a></td></tr><tr><td>Gaia Administration Guide</td><td><a href=\"http://supportcontent.checkpoint.com/documentation_download?id=13241\" target=\"_blank\" rel=\"noopener\">R75.40</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=16244\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=22928\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=24828\" target=\"_blank\" rel=\"noopener\">R77.X</a>,&nbsp;<a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=54824\" target=\"_blank\" rel=\"noopener\">R80.10</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.20_GA/WebAdminGuides/EN/CP_R80.20_Gaia_AdminGuide/html_frameset.htm\" target=\"_blank\" rel=\"noopener\">R80.20</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.30/WebAdminGuides/EN/CP_R80.30_Gaia_AdminGuide/html_frameset.htm\" target=\"_blank\" rel=\"noopener\">R80.30</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.40/WebAdminGuides/EN/CP_R80.40_Gaia_AdminGuide/Default.htm\" target=\"_blank\" rel=\"noopener\">R80.40</a>, <a href=\"https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_Gaia_AdminGuide/Default.htm\" target=\"_blank\" rel=\"noopener\">R81</a></td></tr><tr><td>Command Line Interface Reference Guide</td><td><a href=\"http://supportcontent.checkpoint.com/documentation_download?id=13944\" target=\"_blank\" rel=\"noopener\">R75.40</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=16262\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=22909\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=24833\" target=\"_blank\" rel=\"noopener\">R77.X</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.20_GA/WebAdminGuides/EN/CP_R80.20_CLI_ReferenceGuide/html_frameset.htm\" target=\"_blank\" rel=\"noopener\">R80.20</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.30/WebAdminGuides/EN/CP_R80.30_CLI_ReferenceGuide/html_frameset.htm\" target=\"_blank\" rel=\"noopener\">R80.30</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.40/WebAdminGuides/EN/CP_R80.40_CLI_ReferenceGuide/Default.htm\" target=\"_blank\" rel=\"noopener\">R80.40</a>, <a href=\"https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_CLI_ReferenceGuide/Default.htm\" target=\"_blank\" rel=\"noopener\">R81</a></td></tr><tr><td>ClusterXL Administration Guide</td><td><a href=\"http://supportcontent.checkpoint.com/documentation_download?id=13090\" target=\"_blank\" rel=\"noopener\">R75.40</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=16221\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=22910\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=24800\" target=\"_blank\" rel=\"noopener\">R77.X</a>,&nbsp;<a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=54804\" target=\"_blank\" rel=\"noopener\">R80.10</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.20_GA/WebAdminGuides/EN/CP_R80.20_ClusterXL_AdminGuide/html_frameset.htm\" target=\"_blank\" rel=\"noopener\">R80.20</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.30/WebAdminGuides/EN/CP_R80.30_ClusterXL_AdminGuide/html_frameset.htm\" target=\"_blank\" rel=\"noopener\">R80.30</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.40/WebAdminGuides/EN/CP_R80.40_ClusterXL_AdminGuide/Default.htm\" target=\"_blank\" rel=\"noopener\">R80.40</a>, <a href=\"https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_ClusterXL_AdminGuide/Default.htm\" target=\"_blank\" rel=\"noopener\">R81</a></td></tr><tr><td>VSX Administration Guide</td><td><a href=\"http://supportcontent.checkpoint.com/documentation_download?id=16383\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=22932\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=24802\" target=\"_blank\" rel=\"noopener\">R77.X</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=54764\" target=\"_blank\" rel=\"noopener\">R80.10</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.20_GA/WebAdminGuides/EN/CP_R80.20_VSX_AdminGuide/html_frameset.htm\" target=\"_blank\" rel=\"noopener\">R80.20</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.30/WebAdminGuides/EN/CP_R80.30_VSX_AdminGuide/html_frameset.htm\" target=\"_blank\" rel=\"noopener\">R80.30</a>, <a href=\"https://sc1.checkpoint.com/documents/R80.40/WebAdminGuides/EN/CP_R80.40_VSX_AdminGuide/Default.htm\" target=\"_blank\" rel=\"noopener\">R80.40</a>, <a href=\"https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_VSX_AdminGuide/Default.htm\" target=\"_blank\" rel=\"noopener\">R81</a></td></tr><tr><td>600, 700, 1100, 1200R, 1400 Appliances Advanced Routing Guide</td><td><a href=\"http://supportcontent.checkpoint.com/documentation_download?id=26395\" target=\"_blank\" rel=\"noopener\">R75.20</a>, <a href=\"http://supportcontent.checkpoint.com/documentation_download?id=43085\" target=\"_blank\" rel=\"noopener\">R77.20</a></td></tr><tr><td id=\"Documentation - Additional documents\" colspan=\"2\">Additional documents</td></tr><tr><td>Additional documents</td><td><ul><li><a href=\"http://supportcontent.checkpoint.com/documentation_download?id=15942\" target=\"_blank\" rel=\"noopener\">How To Configure Policy Based Routing</a></li></ul></td></tr><tr><td id=\"Documentation - RFC\" colspan=\"2\">RFC</td></tr><tr><td>BGP4</td><td><ul><li><a href=\"http://www.ietf.org/rfc/rfc1771.txt\" target=\"_blank\" rel=\"noopener\">RFC 1771</a>, also refer to <a href=\"http://www.rfc-editor.org/errata_search.php?rfc=1771\" target=\"_blank\" rel=\"noopener\">errata</a></li><li><a href=\"http://www.ietf.org/rfc/rfc1963.txt\" target=\"_blank\" rel=\"noopener\">RFC 1963</a></li><li><a href=\"http://www.ietf.org/rfc/rfc1966.txt\" target=\"_blank\" rel=\"noopener\">RFC 1966</a></li><li><a href=\"http://www.ietf.org/rfc/rfc1997.txt\" target=\"_blank\" rel=\"noopener\">RFC 1997</a>, also refer to <a href=\"http://www.rfc-editor.org/errata_search.php?rfc=1997\" target=\"_blank\" rel=\"noopener\">errata</a></li><li><a href=\"http://www.ietf.org/rfc/rfc2918.txt\" target=\"_blank\" rel=\"noopener\">RFC 2918</a></li><li><a href=\"https://www.ietf.org/rfc/rfc4271.txt\" target=\"_blank\" rel=\"noopener\">RFC-4271</a></li></ul></td></tr><tr><td>BGP4++</td><td><ul><li><a href=\"http://www.ietf.org/rfc/rfc2545.txt\" target=\"_blank\" rel=\"noopener\">RFC 2545</a></li><li><a href=\"http://www.ietf.org/rfc/rfc2858.txt\" target=\"_blank\" rel=\"noopener\">RFC 2858</a> (unicast IPv6), also refer to <a href=\"http://www.rfc-editor.org/errata_search.php?rfc=2858\" target=\"_blank\" rel=\"noopener\">errata</a></li><li><a href=\"http://www.ietf.org/rfc/rfc3392.txt\" target=\"_blank\" rel=\"noopener\">RFC 3392</a></li></ul></td></tr><tr><td id=\"Documentation - External references\" colspan=\"2\">External references</td></tr><tr><td>Wikipedia</td><td><a href=\"http://en.wikipedia.org/wiki/Border_Gateway_Protocol\" target=\"_blank\" rel=\"noopener\">http://en.wikipedia.org/wiki/Border_Gateway_Protocol</a></td></tr></tbody></table>\n\n  \n\n-   [sk100499 - BGP on Gaia OS - configuring Graceful Restart](http://supportcontent.checkpoint.com/solutions?id=sk100499)\n-   [sk100504 - How to configure Equal Cost Multipath (ECMP) over eBGP on Gaia](http://supportcontent.checkpoint.com/solutions?id=sk100504)\n-   [sk86985 - How to configure iBGP to propagate routes](http://supportcontent.checkpoint.com/solutions?id=sk86985)\n-   [sk94465 - Configuring Route Reflection for BGP on Gaia OS](http://supportcontent.checkpoint.com/solutions?id=sk94465)\n-   [sk111000 - How to hide BGP AS Numbers in BGP Route Advertisements](http://supportcontent.checkpoint.com/solutions?id=sk111000)\n-   [sk98909 - How to advertise static routes in Virtual System on Gaia OS](http://supportcontent.checkpoint.com/solutions?id=sk98909)\n-   [sk108548 - Details about BGP timers](http://supportcontent.checkpoint.com/solutions?id=sk108548)\n-   [sk82600 - Graceful restart for OSPF and BGP in Gaia does not work](http://supportcontent.checkpoint.com/solutions?id=sk82600)\n-   [sk92322 - Neighborship for OSPF, BGP, RIP, and PIM in Gaia Cluster is formed with Physical IP addresses upon a reboot](http://supportcontent.checkpoint.com/solutions?id=sk92322)[](http://supportcontent.checkpoint.com/solutions?id=sk100513)\n-   [sk39960 - How to allow Dynamic Routing protocols traffic OSPF, BGP, PIM, RIP, IGRP through Check Point Security Gateway](http://supportcontent.checkpoint.com/solutions?id=sk39960)\n-   [sk93306 - ATRG: ClusterXL R6x and R7x](http://supportcontent.checkpoint.com/solutions?id=sk93306)\n-   [sk92787 - How to debug ClusterXL failovers caused by RouteD daemon on Gaia OS](http://supportcontent.checkpoint.com/solutions?id=sk92787)\n-   [sk101399 - How to debug BGP and RouteD daemon on Gaia](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101399)\n-   [sk109049 - Dynamic Routing Troubleshooting Tips](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk109049)\n-   [sk121380 - BGP routes removed when peer adjacency is lost](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk121380)","language":"md","time":"14 days ago","created":"2025-05-06T22:56:03.166Z","annotations":[],"updated":"2025-05-06T22:58:19.395Z"},{"title":"R80.10 Security Gateway: IPSec VPN Traffic","id":"22b94954-2e09-40ee-a49f-e253e12eaff2","type":"TEXT","raw":"ProductCoreXL, IPSec VPN\n\nVersionR80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nOSGaia\n\nPlatformAll\n\nLast Modified2023-04-26\n\n## Solution\n\nStarting in R80.10 Security Gateway, _**IPsec VPN MultiCore**_ feature allows CoreXL to inspect VPN traffic on all CoreXL FW instances.\n\nThis feature is enabled by default, and it is not supported to disable it.\n\nRun the following commands to monitor the distribution of VPN traffic between CoreXL FW instances:\n\n-   **`[Expert@HostName:0]# vpn tu mstats`**  \n    **`[Expert@HostName:0]# vpn6 tu mstats`**\n    \n    _Example output_:\n    \n    > ```\n    > Instance#     # of inSPIs    # of outSPIs\n    >         0             182             170\n    >         1             184             176\n    >         2             191             174\n    >         3             215             197\n    >         4             237             227\n    >         5             191             176\n    >         6             180             170\n    >         7             190             166\n    >         8             171             160\n    >         9             199             187\n    > -----------------------------------------\n    >   Summary:           1940            1803\n    > ```\n    \n-   **`[Expert@HostName:0]# vpn tu tlist [options]`**  \n    **`[Expert@HostName:0]# vpn6 tu tlist [options]`**\n    \n    Note: Run `vpn tu tlist -h` / `vpn6 tu tlist -h` to see the options.\n    \n    _Example output_:\n    \n    > ```\n    > +--------------------------------------------------------+--------------------------------+---------------------+\n    > | Peer: 172.29.7.134 (b61cef72a222a909)   | MSA: ffffc20020e34530 | i: 2  ref: 11        |\n    > | Methods: ESP Tunnel AES-128 SHA1           |                                            | i: 5  ref:  2         |\n    > | My TS:   0.0.0.0/0                                            |                                            |                            |\n    > | Peer TS: 172.29.7.134                                    |                                            |                            |\n    > | User: user3                                                       |                                            |                            |\n    > | MSPI:      b7 (i:   5)                                           | Out SPI: c95d172c           |                            |\n    > +--------------------------------------------------------+---------------------------------+--------------------+\n    > ```\n    \n\n**Related solutions:**\n\n-   [sk98737 - ATRG: CoreXL](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98737)\n-   [sk104760 - ATRG: VPN Core](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk104760)\n-   [sk101223 - MultiCore Support for SSL](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101223)\n\n## Article Properties\n\nOriginatorSergei Shir\n\nTechnical ResourceEitan Natanian\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2017-06-13\n\nLast Modified2023-04-26\n\nEditorDavid Kornfield\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only\n\n**E-mail thread with RnD:**\n\n```\n----Original Message----\nFrom: Eitan Natanian \nSent: Wednesday, June 14, 2017 11:38 AM\nTo: Sergei Shir; Vitaly Greditor (Timofeev)\nSubject: RE: Multi-Core support for IPsec VPN in R80.10\n\n<strong>Not supported.</strong>\nQA did not test \"multik ipsec off\". \nWe don't know how it will react.\n<strong>Also if you disable it, you are not really using the old flow, it's a new flow that has never been tested. </strong>\n\n----Original Message----\nFrom: Sergei Shir \nSent: Tuesday, June 13, 2017 4:20 PM\nTo: Vitaly Greditor (Timofeev); Eitan Natanian\nSubject: RE: Multi-Core support for IPsec VPN in R80.10\n\nYou wrote below:\nTrue, you cannot disable or have any configuration to control it\n\nWhat about these commands?\n[Expert@HostName:0]# vpn multik ipsec stat \n[Expert@HostName:0]# vpn multik ipsec off \n[Expert@HostName:0]# vpn multik ipsec on\n\nThanks\n\n----Original Message----\nFrom: Vitaly Greditor (Timofeev) \nSent: Monday, June 12, 2017 11:39 AM\nTo: Sergei Shir; Eitan Natanian\nSubject: RE: Multi-Core support for IPsec VPN in R80.10\n\nCorrect.\n\n----Original Message----\nFrom: Sergei Shir \nSent: Monday, June 12, 2017 11:20 AM\nTo: Eitan Natanian; Vitaly Greditor (Timofeev)\nSubject: RE: Multi-Core support for IPsec VPN in R80.10\n\nThank you for the answers.\n\nWe just knew that this feature was finally integrated.\nBut VPN Admin Guide does not say anything about it.\n\nDo I understand this feature correctly \nthat now every CoreXL FW instance is able to process VPN traffic ?\n\n----Original Message----\nFrom: Eitan Natanian\nSent: Mon Jun 12 10:25:17 GMT+03:00 2017\nTo: \"Vitaly Greditor (Timofeev)\", Sergei Shir\nSubject: RE: Multi-Core support for IPsec VPN in R80.10\n\nTrue, you cannot disable or have any configuration to control it.\nBut you do have monitoring capabilities to see in which instance (core) the tunnel is handled:\n \n* vpn tu mstat\n* vpn tu tlist\n\n----Original Message---- \nFrom: Vitaly Greditor (Timofeev) \nSent: Sunday, June 11, 2017 9:42 PM\nTo: Sergei Shir; Eitan Natanian\nSubject: RE: Multi-Core support for IPsec VPN in R80.10\n \nHi Sergei,\n\nCan you please elaborate what specifically do you want to document?\nThe feature is enabled by default and is transparent to the customer.\nIt doesn't have visible controls or CLIs.\n \n----Original Message---- \nFrom: Sergei Shir \nSent: Sunday, June 11, 2017 7:01 PM\nTo: Eitan Natanian; Vitaly Greditor (Timofeev)\nSubject: RE: Multi-Core support for IPsec VPN in R80.10\n \nWho can provide all the relevant information about \nMulti-Core support for IPsec VPN in R80.10 ?\n \nWe need to create an SK article to document it.\n\nThanks\n```","language":"md","time":"14 days ago","created":"2025-05-06T22:56:12.217Z","annotations":[],"updated":"2025-05-06T22:58:55.556Z"},{"title":"Mobile Access Blade Code Snippet","id":"26f02135-7844-405a-9520-a4f01814f5d4","type":"TEXT","raw":"**Table of Contents**\n\n-   Introduction\n    \n-   Process Flow Diagrams and Description\n    \n-   Troubleshooting\n    \n-   Debug Procedures\n    \n\nCollapse the Entire Article\n\n## Introduction\n\nShow / Hide this section\n\n> Check Point Mobile Access Software Blade is the safe and easy solution to connect to corporate applications over the Internet with your Smartphone, tablet or PC. The solution provides enterprise-grade remote access via both Layer-3 VPN and SSL VPN, allowing you simple, safe and secure connectivity to your email, calendar, contacts and corporate applications.\n> \n> **For the most up to date information about new features and troubleshooting information, refer to the [R81 Mobile Access Administration Guide](https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_MobileAccess_AdminGuide/Default.htm).**\n> \n> ## _Motivation for Mobile Access Blade_\n> \n> Remote access market is growing:\n> \n> -   Wireless devices are all over.\n> -   People are working from home or on the road.\n> -   People want access from any type of device.\n> -   Traditional IPSec VPN products do not offer this type of connectivity:  \n>     -   Preinstalled \"fat\" client software\n>     -   Difficult to connect from other local networks (using different port than 80 / 443)\n> \n> ## _What Mobile Access Blade does?_\n> \n> **Using SSL \"Clientless\" VPN**\n> \n> -   Enables using resources from an organization's internal network.\n> -   Only a browser is required on the client side.\n> -   Traffic from the client to Mobile Access Blade gateway is encrypted (using SSL, not IPSec).\n> -   Some features require a thin client (either ActiveX or Java applet) which is deployed automatically (on demand).\n> -   Smartphones can access with dedicated application without establishing VPN tunnel.\n> \n> ## _Feature Overview: Access_\n> \n> -   Provides pure clientless access to applications deployed on the internal network:  \n>     -   Web applications (using Link Translation)\n>     -   Windows file shares (using CIFS mounts)\n>     -   Mail applications (Webmail for IMAP)\n> -   Provides \"thin client\" access to network-level applications:  \n>     -   TCP/UDP (SNX Network Mode)\n>     -   TCP only for non-admin users (SNX Application Mode)\n>     -   Embedded applications (Telnet, SSH, FTP, RDP, Jabber, etc.)\n> \n> ## _Feature Overview: Authentication_\n> \n> -   Provides authentication based on:  \n>     -   Realm based authentication with support for multi-factor authentication\n> -   Provides authorization based on:  \n>     -   User groups (Internal, LDAP/AD, Radius)\n>     -   Resource’s Protection Level  \n>         -   Endpoint Security scan results\n>         -   Authentication strength\n> \n> ## _Feature Overview: Audit and Platforms_\n> \n> -   Provides auditing:  \n>     -   Administrator's actions are logged\n>     -   Traffic events are logged\n> -   Supports different end-user platforms: Windows, Linux, Mac OS X, Android, iOS\n> \n> ## _Feature Overview: Security_\n> \n> -   Provides a unique security solution:  \n>     -   Gateway  \n>         -   FW, IPS, AV\n>         -   'Stateful Inspection' on tunneled traffic\n>         -   Web Intelligence\n>     -   Endpoint Security On Demand (ESOD)  \n>         -   Compliance Scanner (formerly known as ICS)\n>         -   Secure Workspace (formerly known as ISW)\n>     -   Update service (IPS, AV, ESOD)\n> \n> ## _Feature Overview: Reverse Proxy_\n> \n> -   This feature adds support for Reverse Proxy for standard Web Applications on your servers, using Mobile Access. Reverse Proxy users browse to an address (URL) that is resolved to the Mobile Access Gateway's IP address. Then, the Mobile Access Gateway passes the request to an internal server, according to the Reverse Proxy rules. \n> -   Administrator controls the security level (HTTP or HTTPS) of connections between users and resources.\n> \n> ## _Feature Overview: Unified Policy (since R80.10)_\n> \n> -   Mobile Access, in the R80.10 release, supports both Legacy Policy (as in R77.30 and below) and Unified Policy.\n> -   By default, the Mobile Access blade is set to Legacy Policy. The Administrator can switch to Unified Policy (requires policy install).\n> -   For more detailed Troubleshooting information, refer to the Troubleshooting section of this document.\n> -   When you include Mobile Access in the Unified Policy, you configure all rules related to the Mobile Access portal, Capsule Workspace, and on-demand clients in the Access Control Policy.\n> -   In the Access Control Rule Base, you can configure rules that:  \n>     -   Apply to all Mobile Access gateways, or some of them.\n>     -   **Now you can apply to one or more Mobile Access clients, such as the Mobile Access portal or Capsule Workspace.**\n> -   Mobile Access features such as Protection Levels, Secure Workspace, and Endpoint Compliance also apply.\n> -   Note that when you use the Unified Access Policy, some Mobile Access features and settings are still configured in the 'SmartDashboard > Mobile Access tab'.\n> -   For more extensive information about this feature, refer to the \"Mobile Access and the Unified Access Policy\" section in the [Mobile Access R80.10 Administration Guide](https://sc1.checkpoint.com/documents/R80.10/WebAdminGuides/EN/CP_R80.10_MobileAccess_AdminGuide/html_frameset.htm).\n> -   For information about Unified Policy, refer to the \"Creating an Access Control Policy\" section in the [Next Generation Security Gateway R80.10 Guide](https://sc1.checkpoint.com/documents/R80.10/WebAdminGuides/EN/CP_R80.10_NexGenSecurityGateway_Guide/html_frameset.htm).\n> \n> ## _Feature Overview: Application Wrapping (since R80.10)_\n> \n> -   **Capsule Workspace App Wrapping** leverages **Capsule Workspace** and extends it to offer 3rd party apps in a security container that provides multi security layers and access for both iOS and Android apps. \n> -   For more detailed information, refer to [sk111558 - Capsule Workspace App Wrapping](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk111558).\n\n## Process Flow Diagrams and Description\n\nShow / Hide this section\n\n> -   ### Mobile Access Blade Network Deployment\n>     \n>     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/MAB_Blade_Network_Deployment.png \"MAB Blade Network Deployment\")\n>     \n>     In the simplest Mobile Access deployment, one Mobile Access enabled Security Gateway inspects all traffic, including all Mobile Access traffic. IPS and Anti-Virus can be active on all traffic as well. The Security Gateway can be on the network perimeter.\n>     \n>     This is the recommended deployment. It is also the least expensive and easiest to configure, as it only requires one gateway machine for easy and secure remote access.\n>     \n> -   ### Mobile Access Blade as a Reverse HTTP Proxy\n>     \n>     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Reverse_HTTP_Proxy.PNG \"Reverse HTTP Proxy\")\n>     \n>     A reverse proxy appears to the client just like an ordinary web server. No special configuration on the client is necessary.\n>     \n> -   ### Link Translation: Flow\n>     \n>     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Link_Translation.PNG \"Link Translation\")\n>     \n>     Link Translation is the process by which Mobile Access converts internal URLs to public URLs that are valid on the Internet, so that internal resources become accessible via any Internet-connected browser.\n>     \n>     Mobile Access supports different methods of Link Translation:\n>     \n>     -   **URL Translation** (UT) the original link translation method, maintained for backward compatibility.\n>         \n>     -   **Hostname Translation** (HT) provides dramatically improved performance for Mobile Access gateways and end users, resulting in faster Web access and fewer connectivity issues. It gives access a wider range of websites, with enhanced support for HTML pages, JavaScript, VBscript, and Web applications (such as the SAP Portal).\n>         \n>     -   **Path Translation** (PT) is the newest Link Translation method. It offers the same connectivity level as Hostname Translation, without the more difficult and costly configurations. (Hostname Translation requires a more expensive server certificate.)\n>         \n> -   ### File Shares: Protocols Involved\n>     \n>     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/FileSharesProtocols1506302317.png)\n>     \n>     A file share defines a collection of files, made available across the network by means of a protocol, such as SMB for Windows, that enables actions on files, including opening, reading, writing and deleting files across the network.\n>     \n> -   ### Web Mail Support: Protocols Involved\n>     \n>     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/WebMail_Support_Protocols.PNG \"WebMail Support Protocols\")\n>     \n>     Mobile Access supports built-in Web mail. Web mail provides a simple way for remote users, through a web browser interface, to access their email. Employees can access their email from any computer that has access to the Internet, such as a computer in a library, or Internet cafe. There is no need to install special email or remote access software. This is helpful for employees who work outside the office on a regular basis.\n>     \n>     Mobile Access provides a Web front-end for any email application that uses the IMAP protocol for incoming mail, and SMTP for outgoing mail.\n>     \n>     E-mail stored on the IMAP server is manipulated through the browser interface without having to transfer the messages back and forth. Users can connect to several mail servers depending on their authorization.\n>     \n> -   ### Authentication: Single Sign-On (SSO)\n>     \n>     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/SSO.PNG \"SSO\")\n>     \n>     Native applications that you access with SSL Network Extender can use Single Sign-On (SSO) functionality. With SSO support, users connect automatically to native applications that require login. The native application gets the Mobile Access portal login username and password parameters from the internal server. This feature is supported in R77.20 and higher. It requires a SSL Network Extender client upgrade.\n>     \n\n## Troubleshooting\n\nShow / Hide this section\n\n> Refer to [Troubleshooting Mobile Access](https://sc1.checkpoint.com/documents/R77/CP_R77_Mobile_Access_WebAdmin/23036.htm) in the R77 versions Mobile Access Administration Guide for detailed information about:\n> \n> -   [Troubleshooting Web Connectivity](https://sc1.checkpoint.com/documents/R77/CP_R77_Mobile_Access_WebAdmin/23036.htm#o23485)\n> -   [Troubleshooting Outlook Web Access](https://sc1.checkpoint.com/documents/R77/CP_R77_Mobile_Access_WebAdmin/23036.htm#o23486)\n> -   [Common OWA problems](https://sc1.checkpoint.com/documents/R77/CP_R77_Mobile_Access_WebAdmin/23036.htm#o23492)\n> -   [Troubleshooting File Shares](https://sc1.checkpoint.com/documents/R77/CP_R77_Mobile_Access_WebAdmin/23036.htm#o23523)\n> -   [Troubleshooting Citrix](https://sc1.checkpoint.com/documents/R77/CP_R77_Mobile_Access_WebAdmin/23036.htm#o23524)\n> \n> #### Mobile Access Blade Troubleshooting by Topic\n> \n> 1.  Unified Policy (since R80.10)\n>     \n> 2.  Cannot access Mobile Access portal\n>     \n> 3.  Web application appears broken due to\n>     \n> 4.  Application Wrapping (since R80.10)\n>     \n> 5.  File Shares\n>     \n> 6.  ESOD\n>     \n> 7.  SNX\n>     \n> 8.  Capsule Workspace\n>     \n> 9.  ActiveSync\n>     \n> 10.  CVPND process is not starting\n>     \n> 11.  Reverse Proxy\n>     \n> \n> 1.  ### Troubleshooting Topic: Unified Policy (since R80.10)\n>     \n>       \n>     Mobile Access, in the R80.10 release, supports both Legacy Policy (as in R77.30 and below and Unified Policy).\n>     \n>     By default, the Mobile Access blade is set to Legacy Policy. The Administrator can switch to Unified Policy (**requires policy install**).\n>     \n>     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Unified%20Policy_11708210110.png)\n>     \n>     **Notes regarding Unified Policy as the Policy Source:**\n>     \n>     -   A single Gateway cannot be set to both Unified and Legacy. (see screen capture above)\n>     -   You cannot migrate Legacy Policy (i.e. Mobile Access rules) to the Unified Policy.  \n>         -   The Administrator needs to create the rules manually.\n>         -   **The Administrator must enable Mobile Access on each Policy layer, in the unified Policy, that contains Mobile Access rules (applications). (see screen capture below)**\n>         -   The same Mobile Access applications that were used in Legacy Policy can and should be used in Unified Policy.\n>     -   For information on the use of Access Roles and client type in the Access Role, refer to the “Access Roles for Remote Access” section in the [Mobile Access R80.10 Administration Guide](https://sc1.checkpoint.com/documents/R80.10/WebAdminGuides/EN/CP_R80.10_MobileAccess_AdminGuide/html_frameset.htm).\n>     -   For best practice on how to define Mobile Access rules, refer to the “Best Practices for Rules” section in the [Mobile Access R80.10 Administration Guide](https://sc1.checkpoint.com/documents/R80.10/WebAdminGuides/EN/CP_R80.10_MobileAccess_AdminGuide/html_frameset.htm).\n>         \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Unified%20Policy_21708210117.png)\n>         \n>     \n>     **Related Solution**\n>     \n>     -   It is highly recommended to refer to [sk116015 - Publishing applications in Mobile Access configured in \"Unified Access Policy\" mode](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk116015)\n>     -   For more information about Mobile Access limitations in R80.10, refer to the Mobile Access section of [sk110519 - Check Point R80.10 Known Limitations](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk110519)\n>     \n>       \n>     **Unified Policy Logs**\n>     \n>     The Mobile Access Authorization log, in Unified Policy, always contains both Mobile Access and Firewall blades. As a result:\n>     \n>     -   The log's \"blade\" icon will be a Multiple blade icon.![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/sk104577_Multi_Blade_Icon1708230046.png) Example:\n>         \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Mobile%20Access%20log%20in%20Unified%20Policy%20mode1708230054.png)\n>         \n>     \n>       \n>     \n>     -   When you cick on the log line, you wil display the full Unified Policy log. Example:\n>         \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Unified_mode_log1708230059.png)\n>         \n>     \n>       \n>     -   Filtering using 'blade:\"Mobile Access\"', will match such logs if SmartLog indexing is enabled. (In Standalone installation, SmartLog indexing is disabled, by default).\n> \n>   \n> \n> 1.  ### Troubleshooting Topic: Cannot access Mobile Access portal\n>     \n>     -   **_Mobile Access portal does not respond_**\n>         \n>         1.  First check out for any recent configuration changes that may have caused the MAB portal not to respond.\n>             \n>         2.  Look up SmartView Tracker log for any related logs.\n>             \n>         3.  Check for core dumps at : _/var/log/dump/usermode/_\n>             \n>         4.  Check under the 'Portal settings' tab that the gateway has the expected certificate configured.\n>             \n>         5.  If you get the wrong certificate, check in other portals, as we only use one certificate on a given IP address. Note that \"All portals on the same IP address use the same certificate\" (see [sk94965](http://supportcontent.checkpoint.com/solutions?id=sk94965)).\n>             \n>         6.  Try to figure out whether SSL handshake was established (look for the certificate in the address bar, or use Wireshark and look for `client_hello` and `server_hello`).\n>             \n>         7.  In case of an SSL problem, you need to collect kernel debug:  \n>             _\\# fw ctl zdebug -m fw + drop crypt cptls_\n>             \n>         8.  Check VPND debugs, as described in the section \"Debug Procedures\" - \"Debugging the Gateway side\" - \"_vpnd_ process\"\n>             \n>         9.  Check MPDAEMON the 'matching component' that is also responsible for launching HTTPD (its parent process) - see [sk87920](http://supportcontent.checkpoint.com/solutions?id=sk87920).\n>             \n>         10.  Check that the SSLVPN Portal is running: _\\# mpclient status sslvpn_\n>             \n>         11.  Get the HTTPD's high port:\n>             \n>             _\\# mpclient getdata sslvpn_\n>             \n>             For HTTPD:\n>             \n>             _\\# ps -ef |grep httpd |grep sslvpn_  \n>             _\\# telnet localhost \\[HTTPD\\_HIGH\\_PORT\\]_  \n>             _\\# GET /sslvpn_\n>         12.  Check HTTPD's starting log:\n>             \n>             _$CVPNDIR/log/httpd.starlog_\n>         13.  Enable HTTPD debugs, as described in the section \"Debug Procedures\" - \"Debugging the Gateway side\" - \"_httpd_ process\", and check: _$CVPNDIR/log/httpd.log_\n>             \n>         \n>         Related solutions:\n>         \n>         -   [sk92847 (Mobile Access portal is occasionally unresponsive)](http://supportcontent.checkpoint.com/solutions?id=sk92847)\n>         -   [sk100488 (VPND Crash when many applications/rules defined in Mobile Access policy)](http://supportcontent.checkpoint.com/solutions?id=sk100488)\n>     -   _**Mobile Access portal does not respond after upgrade**_\n>         \n>         Common issue at upgrade when DNS is not yet configured or reachable - See [sk98805](http://supportcontent.checkpoint.com/solutions?id=sk98805)\n>         \n>         Related solutions:\n>         \n>         -   [sk78821 (Mobile Access login page is faulty displayed after upgrade)](http://supportcontent.checkpoint.com/solutions?id=sk78821)\n>     -   _**Authentication fails due to:**_\n>         \n>         -   **_Realms configuration (Pre-R80.10)_**\n>             \n>             -   Mistake in realm configuration: if there is a problem, _cvpnd_ is not starting and MAB portal is not accessible, log line in _$CVPNDIR/log/cvpnd.elg_ (Failed to init cvpnauth). Check _$FWDIR/database/authentication\\_objects.C_ (which contains the realms configuration).\n>                 \n>             -   Additional realm was configured but is not shown to the users in the portal (no drop down list/drop down without the new realm).  \n>                 Check that the correct realm is in _$CVPNDIR/conf/cvpnd.C_ - _attribute portalRealmNames_\n>                 \n>         -   **_Multiple Login Options configuration (Since R80.10)_**\n>             \n>             -   The Pre-R80.10 gateway, uses Single Authentication settings only. (Old style UX)\n>                 \n>                 ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/sk104577_Old_UX_Single_Auth1708230115.png)\n>                 \n>             \n>               \n>             \n>             -   The R80.10 gateway, **by default**, uses Single Authentication settings. (New style UX)\n>                 \n>                 ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/sk104577_R80_10_Single_Auth1708230118.png)\n>                 \n>             -   In addition, you can (**and should**) use the Multiple Authentication Option configuration.\n>                 \n>                 ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/sk104577_R80_10_Multi_Login1708230124.png)\n>                 \n>             \n>               \n>             \n>             -   User Look and feel in the Mobile Access Portal, configured with Multiple Login options.\n>                 \n>                 ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/sk104577_R80_10_Multi_login_look1708230127.png)\n>                 \n>             \n>               \n>             \n>             -   R80.10 gateway can prevent Single Authentication clients (i.e. clients not listed in [sk111583](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk111583)), from accessing the gateway.\n>                 \n>                 ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/sk104577_R80_10_Prevent_Single_Auth_Clients1708230132.png)\n>                 \n>             \n>               \n>             \n>             -   R80.10 gateway can prevent authentication done using Single Authentication configuration.\n>                 \n>                 ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/sk104577_R80_10_Prevent_Single_Auth1708230133.png)\n>                 \n>             \n>               \n>             \n>             -   Proxy configuration for DynamicID authentication is now defined in the Gateway's proxy configuration, instead of the Mobile Access Proxy configuration.\n>                 \n>                 ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/sk104577_R80_10_Proxy_Config_for_DynamicID1708230135.png)\n>                 \n>             \n>               \n>             For more information on Multiple Login Options for R80.x Gateways, refer to the “Multiple Login Options for R80.x Gateways” section in the [Mobile Access R80.10 Administration Guide](https://sc1.checkpoint.com/documents/R80.10/WebAdminGuides/EN/CP_R80.10_MobileAccess_AdminGuide/html_frameset.htm).\n>         -   _**User record lookup**_\n>             \n>             -   Looking in wrong directory (symptom might be latency):\n>                 \n>                 -   Might be indicated by log in _$CVPNDIR/log/cvpnd.elg_ / capture of traffic.\n>                     \n>                 -   Look in realm configuration.\n>                     \n>                 -   Make sure that in Security Gateway properties > _Other_ > _User directory_ everything is configured properly.\n>                     \n>             -   Looking with wrong identifier (certificate with DN that contain also the e-mail address, certificate with wrong (old) directory path, directory expects different value like e-mail instead of username):\n>                 \n>                 -   User will get \"`Wrong user name or password`\" / \"`Certificate authentication failed`\"\n>                     \n>                 -   Admin should know which identifier his directory is expecting to get.\n>                     \n>                 -   Most of the problems might be solved by realm configuration, sometimes you also need to configure the directory settings (wide impact) - (both with GuiDbEdit)\n>                     \n>                     -   Example 1 - Microsoft\\_AD > Common > UserLoginAttr\n>                     -   Example 2 - Directory Settings > UserLoginAttr / lookup\\_type\n>         -   _**User group mapping**_\n>             \n>             -   Symptom: user is not allowed to a specific resource (application link is not shown in the portal) / user get \"`User is not authorized`\" after login.\n>                 \n>             -   You could see the groups of the user in _$CVPNDIR/log/cvpnd.elg_ (during Login only) = _au\\_fetchuser\\_callback user obj:_\n>                 \n>             -   Keep in mind, if user was added/removed to/from a group after login, it will take affect only after next login (Known limitation).\n>                 \n>             \n>             Related solutions:\n>             \n>             -   [sk44572 ('No group defined for the user' log for failed user authentication via RADIUS)](http://supportcontent.checkpoint.com/solutions?id=sk44572)\n>         -   _**Credential validation**_\n>             \n>             -   Symptom: user cannot login (Wrong user name or password)\n>                 \n>             -   Check that account is not locked (in the directory).\n>                 \n>             -   Make sure that other users can login.\n>                 \n>             -   Make sure user is not expired and time is allowed (on the user record, mostly for internal users also relevant from templates or generic\\*).\n>                 \n>             -   _$CVPNDIR/log/cvpnd.elg_ might contain details if this is not a problem with the credentials (such as expiration).\n>                 \n>             \n>             Related solutions:\n>             \n>             -   [sk98260 (User sometimes unable to authenticate to Mobile Access Portal and receives \"username or password is incorrect\" message)](http://supportcontent.checkpoint.com/solutions?id=sk98260)\n>             -   [sk61060 (Realms certificate configuration for Client Certificate Authentication)](http://supportcontent.checkpoint.com/solutions?id=sk61060)\n>         -   _**Admin LDAP AU credentials**_\n>             \n>             Related solutions:\n>             \n>             -   [sk97806 (Mobile Access LDAP user fails to connect or is not matched to a relevant policy rule)](http://supportcontent.checkpoint.com/solutions?id=sk97806)\n>         -   _**Client certificate issues**_\n>             \n>             -   CRL is not available (might happen 24 hours after the problem started) - should be stated in SmartView Tracker Log.\n>                 \n>                 -   Internal CA: make sure the Management is available\n>                     \n>                 -   External CA: make sure there is no firewall in the middle that blocks the traffic.\n>                     \n>             -   Certificate is expired - should be stated in SmartView Tracker Log. If not, it is in _$CVPNDIR/log/cvpnd.elg_\n>                 \n>             -   Using the \"wrong\" info from the certificate. Refer to the \"Troubleshooting Topic: Cannot access Mobile Access portal\" - section \"Authentication fails due to:\" - subsection \"User record lookup\".\n>                 \n>         -   _**Multi-challenge issues (AD password remediation, LDAP/RADIUS challenges, SMS OTP, SecurID challenges)**_\n>             \n>             -   Password remediation require LDAPs should be configured on the Account unit (LDAP server properties -> Encryption -> Use Encryption (SSL).\n>                 \n>             -   Server might not be trusted: wrong fingerprint.\n>                 \n>             \n>             Related solutions:\n>             \n>             -   [sk98258 (Username is missing from Mobile Access challenge page)](http://supportcontent.checkpoint.com/solutions?id=sk98258)\n>         -   _**Kerberos**_\n>             \n>             -   Kerberos is an authentication method that is used to identify the user in front of the internal servers.\n>                 \n>             -   Kerberos creates a ticket which it uses to authenticate the user instead of using credentials.\n>                 \n>             -   Inside the ticket, the user name, allowed servers and amount of time for which the ticket is active are listed.\n>                 \n>             -   In order to create a Kerberos ticket, Mobile Access Blade uses the portal credentials (user name and password).THis is done in order to create the ticket and to authenticate to the internal server.\n>                 \n>             -   When a user logs in to Mobile Access Blade without user name and password, e.g. with a certificate. Kerberos Constrained Delegation (KCD) is used. KCD allows you to create tickets for other users based on a delegate ticket which was created from credentials that are allowed.\n>                 \n>             \n>             **Troubleshooting & Debugging Kerberos Constrained Delegation (KCD)**\n>             \n>             -   See if there is a Kerberos Constrained Delegation failure entry in SmartView Tracker or SmartLog. Under Mobile Access logs and run _cvpnrestart_ on the Security Gateway through SSH.\n>                 \n>             -   KCD flow consist of 2 main steps:\n>                 \n>                 1.  Creating a Kerberos ticket for the delegate user (that was configured previously).\n>                     \n>                     1.  In order to see that the ticket was created successfully, see that _$CVPNDIR/tmp/krbcc/krbkt\\_\\*_ and _$CVPNDIR/tmp/krbcc/krbtgt\\_\\*_ exist (_krbkt\\_\\*_ and _krbtgt\\_\\*_ are the prefixes of the files.)\n>                         \n>                     2.  Run the command on the Security Gateway \"_klist $CVPNDIR/tmp/krbcc/krbtgt\\_\\*_\", where _krbtgt\\_\\*_ is the prefix of the file and see that the ticket contains information such as date and user name.\n>                         \n>                     3.  If the ticket does not contain information, please check your AD and SmartDashboard configuration again.\n>                         \n>                 2.  Creating a ticket for the end user.\n>                     \n>                     1.  In order to see that the ticket was created successfully, see that _$CVPNDIR/tmp/krbcc/krbcc\\_\\*_ exists (_krbcc\\_\\*_ is the prefix of the file.)\n>                         \n>                     2.  Run the command on the Security Gateway \"_klist $CVPNDIR/tmp/krbcc/krbcc\\_\\*_\", where _krbcc\\_\\*_ is the prefix of the file and see that the ticket contains information such as date and user name.\n>                         \n>                     3.  If the ticket does not contain information, please check your AD and SmartDashboard configuration again.\n>                         \n>             -   Kerberos relies on symmetric key cryptography and requires a trusted third party, and may use public-key cryptography during certain phases of authentication. Kerberos uses UDP port 88 by default. **Please validate to open UDP port 88 between the gateway and the relevant machines.**\n>                 \n>             -   In case of other problems, please attach the following logs after reproduction of the login problem:\n>                 \n>                 -   Mobile Access httpd log - _$CVPNDIR/log/httpd.log\\*_\n>                     \n>                 -   Mobile Access cvpnd log - _$CVPNDIR/log/cvpnd.elg\\*_\n>                     \n>                 -   KCD logs - _$CVPNDIR/log/KCDUtil.elg_ after enabling them\n>                     \n>                     To enable KCD logs:\n>                     \n>                     1.  Edit the _$CVPNDIR/conf/cvpnd\\_internal\\_settings.C_ on the Security Gateway\n>                         \n>                     2.  Change the value of _EnableKCDDebug_ from \"`false`\" to \"`true`\"\n>                         \n>                     3.  Run _cvpnrestart_\n>                         \n>             \n>             **Known Limitations:**\n>             \n>             -   The Kerberos Constrained Delegation user must be configured on the Account Unit object in SmartDashboard - no UI is available.\n>             \n>             Related solutions:\n>             \n>             -   [sk102194 (Kerberos authentication fails on Mobile Access Gateway)](http://supportcontent.checkpoint.com/solutions?id=sk102194)\n>             -   [sk106848 (Mobile Access web applications using Kerberos authentication do not work)](http://supportcontent.checkpoint.com/solutions?id=sk106848)\n>             -   [sk116246 (Single Sign On with Kerberos Constrained Delegation does not work for Mobile Access users from the same domain with different UPN Suffixes)](http://supportcontent.checkpoint.com/solutions?id=sk116246)\n>             -   [sk108176 (Configuring Mobile Access Gateway to use Kerberos Constrained Delegation (KCD) for a Load-Balanced Web Application / Exchange)](http://supportcontent.checkpoint.com/solutions?id=sk108176)\n>             -   [sk110629 (Kerberos is not supported as SSO method for registration to Exchange Server for Mobile Access Push Notifications)](http://supportcontent.checkpoint.com/solutions?id=sk110629)\n>             -   [sk111134 (Kerberos Authentication fails when Web application sends duplicate \"WWW-Authenticate: Negotiate\" HTTP headers)](http://supportcontent.checkpoint.com/solutions?id=sk111134)\n>             -   [sk116154 (\"connection to Exchange Failed\" error when Business Mail (Capsule Workspace Mail) fails to authenticate with Exchange Server using Kerberos)](http://supportcontent.checkpoint.com/solutions?id=sk116154)\n>     \n>     -   _**'vpnd', server certificate, multi-portal (port conflicts), fw policy, SSL version/ciphersuite, proxies**_\n>         \n>         -   For discussion of possible port conflict, see [sk66607](http://supportcontent.checkpoint.com/solutions?id=sk66607)\n>             \n>         -   For server settings of SSL version: 'Policy menu > Global Properties > SmartDashboard Configuration > Configure > Portal Properties'\n>             \n>         -   Also have a look at: SmartDashboard > 'Policy' menu > 'Global Properties...' > 'Remote Access' > 'SSL Network Extender' > 'Encryption'\n>             \n>         -   For a discussion of the limitation of both MAB and gateway as proxy, see [sk110013](http://supportcontent.checkpoint.com/solutions?id=sk110013).\n>             \n>         \n>         Related solutions:\n>         \n>         -   [sk66607 (Cannot access Mobile Access Blade (MAB) portal since 'vpnd' occupies http port)](http://supportcontent.checkpoint.com/solutions?id=sk66607)\n>         -   [sk94965 (Mobile Access gateway presents wrong certificate to portal users)](http://supportcontent.checkpoint.com/solutions?id=sk94965)\n>         -   [sk98805 (vpnd unresponsive when name resolution not available)](http://supportcontent.checkpoint.com/solutions?id=sk98805)\n>     -   _**Conflicts with SNX setup / proxy replacement**_\n>         \n>         Related solutions:\n>         \n>         -   [sk95592 (SNX Application Mode overwrites proxy information and breaks connectivity to portal)](http://supportcontent.checkpoint.com/solutions?id=sk95592)\n> \n>   \n> \n> 1.  ### Troubleshooting Topic: Web application appears broken due to\n>     \n>     -   **_Link Translation (LT) issues (UT/HT/PT)_**\n>         \n>         See description of Link Translation in the section \"Process Flow Diagrams and Description\" above.\n>         \n>         For detailed information about configuration of LT method per Security Gateway and per application, refer to [R77 versions Mobile Access Administration Guide](https://sc1.checkpoint.com/documents/R77/CP_R77_Mobile_Access_WebAdmin/html_frameset.htm).\n>         \n>         To troubleshoot Link Translation issues:\n>         \n>         -   You need to understand the 4 parts of the Client-to-Server communication:\n>             \n>             -   Request from Client to Security Gateway\n>             -   Request from Security Gateway to Server\n>             -   Response from Server to Security Gateway\n>             -   Response from Security Gateway to Client\n>         -   Check Client-to-Server communication without Mobile Access Blade - is it working?\n>             \n>             Use Fiddler in order to see the original requests and responses. (Important: Use Fiddler only after cleaning the browser cache.)\n>             \n>             You can use the following tools to see the requests from client to Security Gateway and from Security Gateway to Server, in addition to the response from Server to Security Gateway and gateway to client:\n>             \n>             -   Client to Security Gateway requests & responses: Fiddler\n>             -   Server to Security Gateway requests & responses: _trace\\_log_\n>         -   Check Browser JavaScript errors. Pressing F12 key usually opens a console to see JavaScript errors, which can help identify the LT problems.\n>             \n>         -   Various LT problems:\n>             \n>             -   Wrong translation of the strings:\n>                 \n>                 -   When find wrong LT value, then we need to search which rule causes the problem.\n>                     \n>                 -   After finding the rule, understand why we had a match on the original text.\n>                     \n>                     Example: _url == link_ is translated as _url = CP\\_PT\\_TRANS(= link)_\n>             -   Missing translation: the HTML code was not translated by the Security Gateway, which results in bad links\n>                 \n>                 -   Compare the behavior of the server with Mobile Access Blade, and without Mobile Access Blade using Fiddler.\n>         -   When troubleshooting PT issues, you need to understand PT _Substitute.features.conf_ file.\n>             \n>             -   You need to understand how to use and read Apache regular expressions.\n>         -   When troubleshooting LT issues, it is very useful to enable LT logs in Mobile Access Blade:\n>             \n>             -   LT logs appear in the _$CVPNDIR/log/httpd.log_ file after setting the value:\n>                 \n>                 From:\n>                 \n>                 _CvpnLogTDError \"LTFLOW\" 0_  \n>                 _CvpnLogTDError \"LTCONTENT\" 0_\n>                 \n>                 To:\n>                 \n>                 _CvpnLogTDError \"LTFLOW\" 5_  \n>                 _CvpnLogTDError \"LTCONTENT\" 5_\n>                 \n>                 in the _$CVPNDIR/conf/httpd.conf_ file and running the \"_cvpnd\\_admin policy_\" command.\n>                 \n>                 This is especially helpful for UT and HT.\n>                 \n>         \n>         Related solutions:\n>         \n>         -   [sk103685 (Text Formatting issues with OWA on Exchange 2013 SP1 via Mobile Access in Path Translation mode)](http://supportcontent.checkpoint.com/solutions?id=sk103685)\n>         -   [sk101076 (Disabling Mobile Access 'Content-Analyzer' feature for specific host)](http://supportcontent.checkpoint.com/solutions?id=sk101076)  \n>             (Content analyzer is a component for classifying responses according to their content type, to understand whether the Security Gateway can translate their links)\n>     -   **_Cookie management issues (on Security Gateway, on client-side, same origin policy)_**\n>         \n>         **Symptoms:**\n>         \n>         -   Web application not working.\n>         -   User is asked for credentials over and over.\n>         -   Receiving portal error 401 - Unauthorized (this might be SSO issue too).\n>         \n>         **How to know:**\n>         \n>         -   Collect trace log from the Security Gateway, and Fiddler capture of this Web App without Mobile Access Blade.\n>             \n>         -   Check that on the Fiddler requests (no Mobile Access Blade) there is a cookie sent to the server on the request header \"Cookie\".\n>             \n>         -   A cookie should also appear in the parallel trace log requests to the internal server.\n>             \n>         -   If you cannot see the cookie in the trace log, then this is causing the unauthorized response from the server.\n>             \n>         \n>         **Possible solutions:**\n>         \n>         -   If this Web App is configured with PT, try using HT, since cookie handling in HT is different.\n>             \n>         -   If this is already HT, try configuring the app with \"Cookie on browser\" mode:\n>             \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/HT_Settings1506280704.png)\n>         -   Send Mobile Access Logs to [Check Point Support](http://www.checkpoint.com/services/contact/index.html).\n>             \n>     -   _**Authorization configuration (check SmartView Tracker)**_\n>         \n>         **Symptoms:**\n>         \n>         -   User cannot see a link that he should be allowed to see.\n>         -   User receives an \"`Unauthorized`\" message when accessing an app.\n>         \n>         **How to know:**\n>         \n>         -   Configuration issue: Check that one of this user's user groups is mapped in the Mobile Access Blade policy to that specific application.\n>             \n>         -   Check in SmartView Tracker under Mobile Access logs for this user's unauthorized log. The message there might help. (For example: DNS Resolving issue, Certificate problem).\n>             \n>         \n>         **Possible solutions:**\n>         \n>         -   Check Configuration: make sure the user is mapped to the application (check if the user was moved to other user groups.)\n>             \n>         -   Send Mobile Access logs to [Check Point Support](http://www.checkpoint.com/services/contact/index.html).\n>             \n>     -   _**Colliding host names (undefined behavior)**_\n>         \n>         **Symptoms:**\n>         \n>         -   An app that should have SSO is prompting for credentials (SSO not working).\n>         \n>         **How to know:**\n>         \n>         -   Check if the problematic app host name, is also the host name in another web app.\n>             \n>         -   Check if this problem is reproducing for all users or for a specific user.\n>             \n>         -   So, if there are 2 or more apps configured on the same host name with the same directories,  \n>             there might be a mix-up between the apps, since we identify the app according to its authorized locations (host + directories),  \n>             so the other configurations may be mixed (SSO, LT):\n>             \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Authorized_Locations1506280728.png)\n>         \n>         **Possible solutions:**\n>         \n>         -   If you need both apps, try not to have them both for the same users.\n>             \n>         -   If you need 2 applications with the same exact \"Authorized Locations\". you should unite them to one app.\n>             \n>         -   If you want 2 different configurations, try different directories for each app so no mix can happen, for example:  \n>             One with \"`Directories`\" : \"`/example1`\", and the other web app with : \"`/example2`\".\n>             \n>         -   Send Mobile Access logs to [Check Point Support](http://www.checkpoint.com/services/contact/index.html).\n>             \n>     -   _**Browser compatibility (vendor, version, user-agent, mobile device)**_\n>         \n>         **Symptoms:**\n>         \n>         -   Broken web app on one browser (usually IE is more problematic).  \n>             For example: either received Blank page for web app, or web app not displayed correctly.\n>         \n>         **How to know:**\n>         \n>         -   **Clear browser Cache!**\n>             \n>         -   Try to reproduce the issue on other browsers.\n>             \n>         -   See if this web app works fine on the problematic browser without Mobile Access Blade, to check if this is a Mobile Access Blade issue or not.\n>             \n>         \n>         **Possible solutions:**\n>         \n>         -   If this is an IE issue only:\n>             \n>             1.  Try commenting out the following lines in _$CVPNDIR/conf/Web\\_inside.location.conf_ file:\n>                 \n>                 _CvpnAddIECompResponseHeader_  \n>                 _CvpnAddIECompRequestHeader_\n>             2.  **Clear cache!**\n>                 \n>             3.  After commenting out, run _cvpnd\\_admin policy_ command.\n>                 \n>             4.  Try to reproduce.\n>                 \n>         -   If this is a mobile computability issue, try using this web app on any mobile browser and see computability.\n>             \n>         -   Clear browser cache and send Mobile Access logs to [Check Point Support](http://www.checkpoint.com/services/contact/index.html) (with Fiddler also).\n>             \n>     -   _**Large file uploads or POST requests ('httpd' and PHP configuration)**_\n>         \n>         **Symptoms:**\n>         \n>         -   POST requests are failing (timeout / error 500).\n>         -   Usually this happens in file uploads flow.\n>         \n>         **How to know:**\n>         \n>         -   Test Fiddler without Mobile Access Blade, and compare it with trace log with Mobile Access Blade, and file the problematic upload request (in both).\n>             \n>         -   Check if there is informative info on the response (example: missing cookie, not completed).\n>             \n>         -   Is the Problematic POST request received from the browser with the header \"Transfer-Encoding\" \"chunked\" ? What is the \"Content-length\"?\n>             \n>             -   NOTE: If it is \"chunked\" with \"content-length 0\", there was a bug recently discovered, where this type of request causes _libcurl_ to not set an upload size. Servers may react differently to this.\n>                 \n>             -   Example for \"chunked\" issue: without Mobile Access Blade - the request is chunked, with Mobile Access Blade request is not chunked (The Security Gateway changed it). Maybe the internal server cannot handle such requests/ did not expect it.\n>                 \n>         \n>         **Possible solutions:**\n>         \n>         -   In the file _$CVPNDIR/conf/includes/Web\\_inside.location.conf_ file, try to increase the value of _CvpnMaxPostStoredSize_ (default is \"10,000\") - maybe try \"50,000\".\n>             \n>         -   See if request without Mobile Access Blade is \"chunked\" or not.\n>             \n>         -   If this is a timeout issue: maybe there is a mismatch between \"_KeepAliveTimeout_\" on the Security Gateway and the server. If you know what the \"keep alive\" of the server is, try increasing the one on the Security Gateway to match it.\n>             \n>         -   Clear browser cache and send Mobile Access Logs to [Check Point Support](http://www.checkpoint.com/services/contact/index.html) (with Fiddler also).\n>             \n>     -   _**SSO does not work**_\n>         \n>         **Symptoms:**\n>         \n>         -   SSO is not working.\n>         \n>         **How to know:**\n>         \n>         -   If Web Form, is it automatic detect? if \"Yes\", try configuring a specific criterion, if you know what is the exact request:\n>             \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/SSO_for_Web_Form1506280810.png)\n>         \n>         **Notes:**\n>         \n>         -   Citrix Storefront WF SSO is still not supported automatically - you will need to configure it with the following parameters:\n>             \n>             -   Sign in URL: _https:///Citrix/StoreWeb/ExplicitAuth/Login_\n>             -   Post URL: _https:///Citrix/StoreWeb/ExplicitAuth/LoginAttempt_\n>             -   Post data: _username=$USERNAME&password=$PASSWORD&loginBtn=Log+On&StateContext_\n>         -   If regular SSO, make sure the internal server auth protocol is standard, and that the server is returning HTTP error \"401\".\n>             \n>             In _libcurl_ trace logs, the authentication request to the internal should return HTTP error \"401\" with the header \"WWW-Authenticate\",  \n>             check if this exists or we did not even get here (for example HTTP error \"403\" - not allowed to get this page).\n>             \n>             If HTTP error \"401\" is received from the server, then check that we sent a request again with the header \"Authentication\" to the internal server.  \n>             This header should include the credentials somehow (or Kerberos ticket), then check the response.  \n>             If \"200 OK\": this means SSO worked, but something else ruined the SSO (see example below).  \n>             For example: Security Gateway did not pass the \"200 OK\" to the browser and failed the request.\n>             \n>         -   If Security Gateway did not get \"200 OK\": Check if credentials forwarded are invalid.\n>             \n>         -   Check that the authentication method the Security Gateway is trying is also supported by the server:\n>             \n>             The server returns on the header \"WWW-Authentication\" all the supported methods.  \n>             Check that the Security Gateway is trying one that is supported on the header \"Authentication\".\n>             \n>             Options: the server changed its supported authentication methods, but the Security Gateway is still trying to use a cached auth method.\n>             \n>         -   SSO success means we get a cookie from the server and \"200 OK\". If yes, that means something after that caused the problem.\n>             \n>             -   Which SSO is configured:\n>                 \n>                 ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/SSO1506280811.png)\n>             -   If invalid credentials are used: does it reproduce for all users or specific ones. If for one user, try to clear the credentials in the portal:\n>                 \n>                 ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Web_creds1506280813.png)\n>                 \n>                 ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Web_creds_21506280814.png)\n>                 \n>             -   If this is a mismatch issue of the authentication method with the server: See [sk98215](http://supportcontent.checkpoint.com/solutions?id=sk98215).\n>                 \n>             -   _**Web forms vs. HTTP SSO**_\n>                 \n>                 Related solutions:\n>                 \n>                 -   [sk102308 (HTTP Based SSO authentication fails to internal Web / Application servers if Single Sign On (SSO) is disabled in the application properties)](http://supportcontent.checkpoint.com/solutions?id=sk102308)\n>                 -   [sk100557 (\"Error: Page cannot be displayed. An error occurred while processing the request.\" when accessing an internal HTTPS server via Mobile Access using NTLM)](http://supportcontent.checkpoint.com/solutions?id=sk100557)\n>     -   **_Popular Web applications requiring special configuration_**\n>         \n>         -   _**OWA/iNotes/DWA (Domino Web Access)**_\n>             \n>             Regular Web Applications configuration but with tagging in the application configuration.\n>             \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/OWA1506280357.png)\n>             \n>             Related solutions:\n>             \n>             -   [sk98744 (iNotes reply to e-mail does not work in Mobile Access Blade)](http://supportcontent.checkpoint.com/solutions?id=sk98744)\n>         -   _**SharePoint**_\n>             \n>             Regular Web Applications configuration, but also need steps provided in [sk32086 - Is Microsoft SharePoint supported by Mobile Access Blade ?](http://supportcontent.checkpoint.com/solutions?id=sk32086).\n>             \n>             Related solutions:\n>             \n>             -   [sk32086 - Is Microsoft SharePoint supported by Mobile Access Blade ?](http://supportcontent.checkpoint.com/solutions?id=sk32086)\n>         -   _**Citrix (partially Web)**_\n>             \n>             Citrix is configured as Citrix Services: adding a new Citrix application.\n>             \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Citrix1506280357.png)\n>             \n>             Secure Ticketing authority (STA) servers in Citrix application are the configuration of matching between STA server and ID.\n>             \n>             When Mobile Access Blade is working side by side with Citrix Access Gateway, the Secure Ticketing Authority should be configured in ordered that Mobile Access Blade will convert the Ticket ID from the ICA file to the Ticketing server.\n>             \n>             More information can be found in the [R77 versions Mobile Access Administration Guide](https://sc1.checkpoint.com/documents/R77/CP_R77_Mobile_Access_WebAdmin/html_frameset.htm).\n>             \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/STA_server_11506280531.png)\n>             \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/STA_server_31604260302.png)\n>             \n>     -   _**An exception or daemon crash (\"Error while processing request\")**_\n>         \n>         **Symptoms:**\n>         \n>         -   Change was made in a configuration file in _$CVPNDIR/conf/_ directory\n>         -   Core dump files for _cvpnd_ or _httpd_ appear in _/var/log/dump/usermode/_ directory\n>         \n>         **How to know**\n>         \n>         -   This kind of issue is usually harder to track, without looking in the code, but if this a configuration issue that caused the _httpd_ to crash with a core dump file - open the file _$CVPNDIR/log/httpd.startlog_ and in the last line you should see a log describing why it failed.\n>             \n>         -   Core dump files require code investigations. But try to understand what is causing the crash? Can you reproduce the core? If yes, what is the exact flow (example: web application link causes the crash / adding favorites / ...)?\n>             \n>         \n>         **Possible solutions**\n>         \n>         -   Turn on Mobile Access Blade logs, and try to reproduce the crash with core dump file and logs - send the logs and the core dump files to [Check Point Support](http://www.checkpoint.com/services/contact/index.html).\n>             \n>         -   If the core dump files are not generated / reproduced, send them with information on how it happened (if you know).\n>             \n> 2.  ### Troubleshooting Topic: Application Wrapping\n>     \n>       \n>     **To check whether the feature is enabled:**\n>     \n>     1.  Connect to the command line on the Mobile Access Gateway.\n>     2.  Login to Expert mode.\n>     3.  Backup the current _$CVPNDIR/conf/includes/Web\\_inside.location.conf_ file:  \n>         _\\[Expert@HostName:0\\]# cp -v $CVPNDIR/conf/includes/Web\\_inside.location.conf{,\\_ORIGINAL}_\n>     4.  Edit the current _$CVPNDIR/conf/includes/Web\\_inside.location.conf_ file:  \n>         _\\[Expert@HostName:0\\]# vi $CVPNDIR/conf/includes/Web\\_inside.location.conf_\n>     5.  To enable the feature, configure: _CvpnClientSideLinkTrans on_\n>     6.  To disable the feature, configure: _CvpnClientSideLinkTrans off_\n>     7.  Save the changes and exit from the Vi editor.\n>     8.  Restart the Mobile Access software blade: _\\[Expert@HostName:0\\]# cvpnstop ; cvpnstart_\n>     \n>       \n>     **To check whether the application is recognized by the gateway as a wrapped application:**\n>     \n>     1.  Enable trace log collection for the relevant user (instructions under \"Debugging the Gateway side\" in the Debug Procedures section).\n>     2.  In the _apache\\_request_ files, search for the _X-CPCVPN-ClientSideTrans_ header and verify that its value is _App_.\n>     \n>       \n>     For additional troubleshooting information, refer to [sk111558 - Capsule Workspace App Wrapping](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk111558).\n> \n>   \n> \n> 1.  ### Troubleshooting Topic: File Shares\n>     \n>     -   _**General Troubleshooting:**_\n>         \n>         Example: We have configured _`\\\\server\\path1`_\n>         \n>         -   Server may be configured as host name or DNS. If DNS entry, may not be resolved (DNS server not configured). **(Mounting issue)**\n>             \n>             -   Trace Log error > Mobile Access Category 'File Shares' : unresolved server name\n>         -   Debug, when we do not know what is causing the permissions/authorization issues:\n>             \n>             -   Check the _$CVPNDIR/log/cvpnd.elg_ file - look for ERROR. We can see from the log if the problem is configuration, or a problem in the File Shares server.\n>                 \n>             -   Advanced:\n>                 \n>                 -   Try to run 'Mount' locally in the shell and it will give us a clue where the problem is.\n>                     \n>                 -   Send Wireshark packet capture to [Check Point Support](http://www.checkpoint.com/services/contact/index.html).\n>                     \n>                 -   Debug the _CvpnProc_:\n>                     \n>                     1.  _\\[Expert@HostName:0\\]# cvpnstop_\n>                     2.  _\\[Expert@HostName:0\\]# ps aux | grep cvpnproc_\n>                     3.  _\\[Expert@HostName:0\\]# kill -KILL $(pidof cvpnproc)_\n>                     4.  _\\[Expert@HostName:0\\]# export TDERROR\\_ALL\\_ALL=5_\n>                     5.  _\\[Expert@HostName:0\\]# $CVPNDIR/bin/cvpnproc $CVPNDIR/log/cvpnproc.elg $CVPNDIR/conf/cvpnproc.C &_\n>                     6.  _\\[Expert@HostName:0\\]# cvpnstart_\n>                     7.  Replicate the issue\n>                     8.  _\\[Expert@HostName:0\\]# unset TDERROR\\_ALL\\_ALL_\n>                     9.  _\\[Expert@HostName:0\\]# cvpnstop_\n>                     10.  _\\[Expert@HostName:0\\]# kill -TERM $(pidof cvpnproc)_\n>                     11.  _\\[Expert@HostName:0\\]# kill -KILL $(pidof cvpnproc)_\n>                     12.  _\\[Expert@HostName:0\\]# cvpnstart_\n>                     13.  Analyze _$CVPNDIR/log/cvpnproc.elg\\*_\n>     -   _**SSO doesn't work (for most cases, see Web applications SSO) (Mounting issue)**_\n>         \n>         Check if expected to work with SSO, and if user is prompted to reenter his/her credentials. Check the configuration.\n>         \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/SSO1506280602.png)\n>         \n>     -   _**Cannot authenticate to new Windows File Share servers (NTLMv2/SSP) (Mounting issue)**_\n>         \n>         Admin might have configured File Share servers we are not supporting, e.g. NTLMv2/SSP.\n>         \n>         Error will be \"`server unreachable/no permissions`\".  \n>         The server admin should give us details regarding the server.\n>         \n>     -   _**Directory/file permission issues (File Access issue)**_\n>         \n>         -   Error: \"`Access denied. The destination of your request has not been configured, or you do not have authorization to access it. (403) - Check configuration of your host:`\"\n>             \n>             -   Trace Log error > Mobile Access Category 'File Shares' : The requested destination is not configured for this user's group in the Mobile Access policy.\n>                 \n>         -   Error: \"`Access denied. The destination of your request has not been configured, or you do not have authorization to access it. (403)`\"\n>             \n>             -   Configuration: make sure that the path is not limited, that the path you are trying to reach was included. Error will show that you do not have permissions.\n>                 \n>             -   There could be an error in the link, and it is not matching the configured path.\n>                 \n>     -   _**DFS links do not work (File Access issue)**_\n>         \n>         Admin might have configured DFS links that we are not supporting.\n>         \n>         Error will be \"`server unreachable/no permissions`\".  \n>         The server admin should know if these are DFS links.\n>         \n>     -   **Related solutions:**\n>         \n>         -   [sk65051 (Mobile Access / Connectra file share appliaction with Unix / Linux Samba backend server)](http://supportcontent.checkpoint.com/solutions?id=sk65051)\n> 2.  ### Troubleshooting Topic: ESOD\n>     \n>     -   _**Scanner platform support**_\n>         \n>         Related solutions:\n>         \n>         -   [sk93665 (Endpoint Security On Demand (ESOD) scan does not support native firewall on RedHat-based Linux distributions)](http://supportcontent.checkpoint.com/solutions?id=sk93665)\n>     -   _**Secure Workspace does not load or crashes**_\n>         \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/SecureWorkspace_Troubleshooting_1_redone1604260441.png)\n>         \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/SecureWorkspace_Troubleshooting_2_redone1604260442.png)\n>         \n> 3.  ### Troubleshooting Topic: SNX\n>     \n>     -   _**SNX fails to install**_\n>         \n>         Related solutions:\n>         \n>         -   [sk96106 (ActiveX component fails to load in Windows 7 / Windows 8 / Windows 8.1 Internet Explorer 11)](http://supportcontent.checkpoint.com/solutions?id=sk96106)\n>         -   [sk61040 (CLI SNX Installation Fails)](http://supportcontent.checkpoint.com/solutions?id=sk61040)\n>         -   [sk76700 (SNX R75.X fresh installation via SecureWorkSpace fails on Windows 7 x86/x64)](http://supportcontent.checkpoint.com/solutions?id=sk76700)\n>         -   [sk26747 (Windows XP SP2 pop-up blocker blocking SSL Network Extender window from opening)](http://supportcontent.checkpoint.com/solutions?id=sk26747)\n>     -   _**SNX does not connect**_\n>         \n>         Related solutions:\n>         \n>         -   [sk50440 (SSL Network Extender on Windows 7 Professional x64 fails to connect)](http://supportcontent.checkpoint.com/solutions?id=sk50440)\n>         -   [sk43827 (SSL Network Extender (SNX) fails to connect to SNX Portal after Internet Explorer / Chrome update)](http://supportcontent.checkpoint.com/solutions?id=sk43827)\n>         -   [sk101588 (SNX connection from command line fails with \"SNX: Authentication failed\" when using a certificate)](http://supportcontent.checkpoint.com/solutions?id=sk101588)\n>         -   [sk65086 (SNX connection failed using SSL VPN with error \"Authentication failed\")](http://supportcontent.checkpoint.com/solutions?id=sk65086)\n>         -   [sk30772 (Browser error message: \"Cannot Establish Connection to SSL Network Extender Gateway. Try to Reconnect. (#32)\")](http://supportcontent.checkpoint.com/solutions?id=sk30772)\n>     -   _**SNX connects, but cannot access internal site or the portal itself**_\n>         \n>         Related solutions:\n>         \n>         -   [sk63302 (Cannot connect to SNX portal after some cookies are added to the browser)](http://supportcontent.checkpoint.com/solutions?id=sk63302)\n>         -   [sk101365 (\"No access rules defined for user\" error)](http://supportcontent.checkpoint.com/solutions?id=sk101365)\n>         -   [sk97771 (SNX portal fails to load on 1100 Appliance)](http://supportcontent.checkpoint.com/solutions?id=sk97771)\n>         -   [sk97811 (Traffic initiated from internal host towards SSL VPN client is dropped with \"Unauthorized SSL VPN traffic\" log)](http://supportcontent.checkpoint.com/solutions?id=sk97811)\n>     -   _**SNX performance issues**_\n>         \n>         Related solutions:\n>         \n>         -   [sk94946 (Latency with remote access client when using simultaneously both Endpoint Connect and SNX)](http://supportcontent.checkpoint.com/solutions?id=sk94946)\n> 4.  ### Troubleshooting Topic: Capsule Workspace\n>     \n>     -   **_Report a Problem to Check Point RnD:_**\n>         \n>         **Use case:** User want to report general problem or give feedback. The logs will automatically reach R&D.\n>         \n>         **How to perform:**\n>         \n>         1.  Tap the (i) button, top right (in login or passcode screen), or bottom right in home screen. About screen is displayed.\n>             \n>         2.  In the \"About\" screen, tap \"Report a Problem\".\n>             \n>         3.  Add feedback and send.\n>             \n>         \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Report_Problem_21507060654.png)\n>     -   **_Send logs by e-mail:_**\n>         \n>         **Use case:** User want to send logs to specific person by e-mail.\n>         \n>         **How to perform:**\n>         \n>         1.  Go to iOS setting > Capsule Workspace > turn on \"Send As Mail\".\n>             \n>         2.  Go back to the application.\n>             \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Send%20Logs1506300205.png)\n>         3.  Tap the (i) button, top right (in login or passcode screen), or bottom right in home screen. \"About\" screen is displayed.\n>             \n>         4.  In the \"About\" screen, tap \"Report a Problem\". Native mail compose screen will open with logs zip file as attachment.\n>             \n>         5.  Send this mail to the desired e-mail.\n>             \n>     -   **_Send HAR (traffic) logs (iOS):_**\n>         \n>         **Use case:** The user would like to send traffic logs. Usually instructed by Check Point Support / RnD to do so.\n>         \n>         **How to perform:**\n>         \n>         1.  Tap the (i) button, top right (in login or passcode screen), or bottom right in home screen. About screen is displayed.\n>             \n>             1.  Double-tap on the logo.\n>                 \n>                 ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/About1506300203.png)\n>         2.  Determine the log capacity and the amount of time to capture the traffic values, as instructed by Check Point Support / RnD.\n>             \n>         3.  **Caution: Only turn on \"log sensitive data\" if certain. It will then contain full traffic body.  \n>             Be aware that the log may contain e-mail data, passwords, and more.**\n>             \n>         4.  Tap on \"Start\".\n>             \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/Advanced1506300203.png)\n>         5.  When you finish reproducing your issue, as instructed, proceed to \"_Send logs by e-mail_\" (above).\n>             \n>     -   **_Cannot reach site:_**\n>         \n>         **How to identify (iOS):**\n>         \n>         -   **Pop up:** Connection error, Network error during site creation.\n>             \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/IMG_47771506300019.png)\n>         -   **Log:** Look for \"Site creation error of type\" string.\n>             \n>         \n>         **How to resolve:**\n>         \n>         -   Check for typo in site address\n>         -   Check Internet connectivity using Safari to **any** web site - fix if needed.\n>         -   Check connectivity using Safari to **wanted** site - fix if needed.\n>     -   **_Wireless / 3G and DNS issues:_**\n>         \n>         -   Check Internet connectivity.\n>         -   Check using native browser to Mobile Access Web Portal.\n>     -   **_Wrong QR-code type:_**\n>         \n>         **How to identify:**\n>         \n>         -   **Pop up:**\n>             \n>             `Enrollment Failed`\n>             \n>             `Failed to establish trust   ...   Reject ID: ...`\n>             \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk104577/IMG_47781506300019.png)\n>         -   **Log:** Look for \"`Entered activation key is not valid`\" string.\n>             \n>         \n>         **How to resolve:**\n>         \n>         -   Make sure this is not \"already used\" QR code.\n>         -   Check the reject ID in SmartLog.\n>         -   Can validate the QR format (See [sk102796](http://supportcontent.checkpoint.com/solutions?id=sk102796)).\n>     -   **_Cannot browse to a Web application:_**\n>         \n>         **How to identify:**\n>         \n>         -   All web apps are greyed out and disabled.\n>         -   **Log:** You will see setting site's state from `SITE_STATE_CONNECTED` to `SITE_STATE_CONNECTED_OFFLINE` at the relevant time.\n>         \n>         **How to resolve:**\n>         \n>         -   Make sure that you have connectivity to site.\n>         -   If you have connectivity to site, then [contact Check Point Support](http://www.checkpoint.com/services/contact/index.html).\n>     -   **_Cannot sync mail/calendar/contact:_**\n>         \n>         -   Check Connectivity to 3G/Wireless\n>         -   Check Connectivity to Site.\n>         -   Check that Calendar is working and syncing.\n>         -   Check that the user is not locked.\n>         -   Check that the mailbox is not full.\n>         -   Check that Outlook is syncing.\n>         -   If nothing helps so far: Clear Persistent Storage.\n>         -   If nothing helps: Delete and create new site.\n>         -   If nothing helps: Delete and re-install the application.\n>         -   If nothing helps: [Contact Check Point Support](http://www.checkpoint.com/services/contact/index.html).\n>     -   **_Push messages:_**\n>         \n>         User does not receive mail updates (items added or deleted):\n>         \n>         Are we talking about push notifications or also in-app pull to refresh?\n>         \n>         **For push notifications only:**\n>         \n>         1.  Check in the app settings that \"Push Notifications\" is on, and if unavailable that the policy allows it.\n>         2.  Check in iOS 'Settings' > 'Capsule' > 'Notifications' that the OS allows notifications.\n>         3.  Check logs for lines with the \"_PUSH::_\" prefix for possible errors.\n>         \n>         Related solutions:\n>         \n>         -   [sk109039 (How to troubleshoot Mobile Access Push Notifications)](http://supportcontent.checkpoint.com/solutions?id=sk109039)\n>         -   [sk101467 (Push notifications are not working after changing the gateway IP or MAB portal URL)](http://supportcontent.checkpoint.com/solutions?id=sk101467)\n>         -   [sk103080 (Push Notifications are not received on the mobile phones due to IPS protection \"Secure Socket Layer (SSL) v3.0\")](http://supportcontent.checkpoint.com/solutions?id=sk103080)\n>     \n>     -   **_Remote wipe:_**\n>         \n>         Push may not work - check push flow:\n>         \n>         -   Token registration failed:\n>             \n>             -   [Contact Check Point Support](http://www.checkpoint.com/services/contact/index.html).\n>         -   Push may be turned off on the client side:\n>             \n>             -   iOS Settings > Push notifications.\n>             -   iOS Settings > Capsule > app background.\n>         -   User may be 'offline':\n>             \n>             -   Check Internet connectivity.\n>             -   Check using native browser to Mobile Access Web Portal.\n>     -   **_Performance issues:_**\n>         \n>         The application is slow:\n>         \n>         -   Narrow the sync window (Gateway or Client).\n>             \n>         -   Consider performing \"Clear Persistent Storage\" (iOS Settings/General Settings).\n>             \n>             Application should be killed post toggling Clear Persistent storage\n>         -   Check performance for the same user on another device.\n>             \n>         -   [Contact Check Point Support](http://www.checkpoint.com/services/contact/index.html).\n>             \n>         \n>         Related solutions:\n>         \n>         -   [sk91280 (Slow Mobile Access connectivity from wireless or lossy networks)](http://supportcontent.checkpoint.com/solutions?id=sk91280)\n> 5.  ### Troubleshooting Topic: ActiveSync\n>     \n>     **What is ActiveSync?**\n>     \n>     -   Additional client that can connect to the Mobile Access SSL VPN portal in addition to browser and capsule.\n>         \n>     -   Provides secure mail through the mobile device native mail client.\n>         \n>     -   Configuration is with ActiveSync application (see [R77 versions Mobile Access Administration Guide](https://sc1.checkpoint.com/documents/R77/CP_R77_Mobile_Access_WebAdmin/html_frameset.htm)).\n>         \n>     -   Once you click on ActiveSync configuration in Check Point Capsule, a new window will open and the ActiveSync profile will appear.\n>         \n>     -   ActiveSync profile configuration sets a new profile on the mobile device with the gateway properties.\n>         \n>     -   Once you finish the ActiveSync profile configuration, the mail will be synced into the native mail client.\n>         \n>     \n>     **Troubleshooting:**\n>     \n>     -   The ActiveSync application does not appear in the Capsule application list:\n>         \n>         -   Check Mobile Access Blade policy, is user allowed?\n>         -   Check that ActiveSync is enabled in Capsule properties.\n>     -   After ActiveSync profile configuration, mail is not synced into the native mail client:\n>         \n>         -   Check ActiveSync configuration on SmartDashboard.\n>             \n>         -   Check configured authentication method\\\\Port Number\\\\ https? etc.\n>             \n>         -   Check connectivity between mobile device and gateway and ActiveSync server.\n>             \n>         -   Check SmartLog for errors: could be failed authentication problem.\n>             \n>         -   In case of authentication problem, in R77.20 and R77.30 check user name and domain format  \n>             (See [R77 versions Mobile Access Administration Guide](https://sc1.checkpoint.com/documents/R77/CP_R77_Mobile_Access_WebAdmin/html_frameset.htm) for more information).\n>             \n>             For example, the default value is `domainName\\UserName` (for example, `AD\\user`) and the ActiveSync server expects to get aa@AD.\n>             \n>             In Mobile Access Gateway R77.10 and lower, the user name is just user name.\n>             \n>     -   Connectivity / session management issues\n>         \n>         -   MAB session opens for each of the following clients: Portal, Capsule, ActiveSync.\n>         -   Each new session is identified in a Login log in SmartLog.\n>         \n>         Related solutions:\n>         \n>         -   [sk68120 (When using an ActiveSync app on an Android phone or an iPhone connected to R75.X Security Gateway, multiple sessions could be established for each user)](http://supportcontent.checkpoint.com/solutions?id=sk68120)\n>         -   [sk103286 (iOS ActiveSync application does not send / receive e-mails while downloading a file from an e-mail on Exchange server)](http://supportcontent.checkpoint.com/solutions?id=sk103286)\n>         -   [sk106607 (ActiveSync users get authentication pop-ups every few minutes after upgrading to R77.30)](http://supportcontent.checkpoint.com/solutions?id=sk106607)\n> \n> 1.  ### Troubleshooting Topic: CVPND process is not starting\n>     \n>     To get more details about why _cvpnd_ process is not starting:\n>     \n>     1.  Empty the CVPND process's log file:\n>         \n>         _\\[Expert@HostName:0\\]# echo '' > $CVPNDIR/log/cvpnd.elg_\n>     2.  Set the debug environment variable:\n>         \n>         _\\[Expert@HostName:0\\]# export TDERROR\\_ALL\\_ALL=5_\n>     3.  Manually start the CVPND process:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnd $CVPNDIR/log/cvpnd.elg $CVPNDIR/conf/cvpnd.C_\n>     4.  Wait until you get the prompt back.\n>         \n>     5.  Unset the debug environment variable:\n>         \n>         _\\[Expert@HostName:0\\]# unset TDERROR\\_ALL\\_ALL_\n>     6.  Analyze the _$CVPNDIR/log/cvpnd.elg_ file\n>         \n> 2.  ### Troubleshooting Topic: Reverse Proxy\n>     \n>       \n>     For troubleshooting and debugging refer to [sk110348 - Mobile Access Reverse Proxy](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk110348).\n\n## Debug Procedures\n\nShow / Hide this section\n\n> _**What to debug?**_\n> \n> <table><tbody><tr><td>Issue area</td><td>What to debug</td></tr><tr><td>Login / Portal traffic, Web traffic, Link Translation, DNS,<br>SSO (partial), Web Intelligence, CSRF protection</td><td><em>httpd</em> process</td></tr><tr><td>Configuration from policy, Authentication, Authorization,<br>Session management, cluster sync, kernel tables, SSO (partial)</td><td><em>cvpnd</em> process</td></tr><tr><td>SNX, SSL termination, client certificate verification</td><td><em>vpnd</em> process +<br><em>VPN kernel</em> module</td></tr></tbody></table>\n> \n> _**How to debug Mobile Access, SSL VPN?**_\n> \n> 1.  Debugging the Gateway side\n>     \n>     -   _httpd_ process\n>         \n>     -   _cvpnd_ process\n>         \n>     -   _vpnd_ process\n>         \n>     -   _cvpnproc_ process\n>         \n>     -   _pinger_ process\n>         \n> 2.  Debugging MAB in Unified Policy Mode\n>     \n> 3.  Debugging the user side\n>     \n>     -   Problems with web application\n>         \n>     -   Problems with Secure WorkSpace (SWS)\n>         \n>     -   Problems with Native Applications\n>         \n>     -   Thin-client deployment mechanism (C-Shell)\n>         \n> 4.  Debugging Policy Installation (FWD and CPD)\n>     \n> \n> ### (1) Debugging the Gateway side\n> \n> -   #### Debugging the Gateway side - _httpd_ process\n>     \n>     **To start the debug:**\n>     \n>     1.  Backup the current _$CVPNDIR/conf/httpd.conf_ file:\n>         \n>         _\\[Expert@HostName:0\\]# cp -v $CVPNDIR/conf/httpd.conf $CVPNDIR/conf/httpd.conf\\_ORIGINAL_\n>     2.  Edit the current _$CVPNDIR/conf/httpd.conf_ file:\n>         \n>         _\\[Expert@HostName:0\\]# vi $CVPNDIR/conf/httpd.conf_\n>     3.  Change the \"_LogLevel_\" from _\"emerg\"_ to _\"debug\"_.\n>         \n>     4.  In order to enable trace log collection:\n>         \n>         <table><tbody><tr><td>Version</td><td>Instructions</td></tr><tr><td>R75.40 and higher</td><td><p>Trace log is now collected for a specific user.</p><p>Save the changes and exit from Vi editor. Then run:</p><em>[Expert@HostName:0]# cvpnd_admin debug trace users=&lt;USERNAME&gt;</em></td></tr><tr><td>R75.X (up to R75.30)</td><td><p>Remove the # sign in front of this line:</p><em>LoadModule trace_logger /opt/CPcvpn-R75/lib/libModTrace.so</em></td></tr><tr><td>R71.X</td><td><p>Remove the # sign in front of this line:</p><em>LoadModule trace_logger /opt/CPcvpn-R71/lib/libModTrace.so</em></td></tr><tr><td>R66.1 and older</td><td><p>Remove the # sign in front of these lines:</p><p><em>LoadModule trace_logger /opt/CPcvpn-R66/lib/libModTrace.so</em><br><em>CvpnTraceLogDir /opt/CPcvpn-R66/log/trace_log/</em><br><em>CvpnTraceLogMaxByte 10000000</em></p></td></tr></tbody></table>\n>         \n>     5.  Save the changes and exit from Vi editor.\n>         \n>     6.  Remove the rotated _$CVPNDIR/log/httpd.log.\\*_ files, if they exist:\n>         \n>         _\\[Expert@HostName:0\\]# rm -i $CVPNDIR/log/httpd.log.\\*_\n>     7.  Empty the _$CVPNDIR/log/httpd.log_ file:\n>         \n>         _\\[Expert@HostName:0\\]# echo '' > $CVPNDIR/log/httpd.log_\n>         \n>         **IMPORTANT: Do not delete this log file!**\n>     8.  If trace log was enabled, then make sure to delete all content from _$CVPNDIR/log/trace\\_log/_ directory\n>         \n>         **IMPORTANT: Do not delete the directory itself!**\n>     9.  Reload the Mobile Access policy:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnd\\_admin policy_\n>         \n>         **Note:**\n>         \n>         -   If you see that the debug is not being collected in the _$CVPNDIR/log/httpd.log_ file, the run: _cvpnrestart_  \n>             (This will restart the _cvpnd_ and _httpd_ processes - all existing Mobile Access web connections will be disconnected, but the Mobile Access sessions will remain open)\n>     \n>     **To stop the debug:**\n>     \n>     1.  Disable the trace log collection in R75.40 and higher:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnd\\_admin debug off_\n>     2.  Restore the original _$CVPNDIR/conf/httpd.conf_ file:\n>         \n>         _\\[Expert@HostName:0\\]# cp -v $CVPNDIR/conf/httpd.conf $CVPNDIR/conf/httpd.conf\\_DEBUG_\n>         \n>         _\\[Expert@HostName:0\\]# cp -v -f $CVPNDIR/conf/httpd.conf\\_ORIGINAL $CVPNDIR/conf/httpd.conf_\n>     3.  Reload the Mobile Access policy:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnd\\_admin policy_\n>         \n>         Notes:\n>         \n>         -   This might disconnect the current users\n>         -   If you see that the debug is still being collected, then run _cvpnrestart_  \n>             (This will restart the _cvpnd_ and _httpd_ processes - all existing Mobile Access connections will be disconnected)\n>     \n>     **Enabling Apache server status page:**\n>     \n>     1.  Backup the current _$CVPNDIR/conf/httpd.conf_ file:\n>         \n>         _\\[Expert@HostName:0\\]# cp -v $CVPNDIR/conf/httpd.conf $CVPNDIR/conf/httpd.conf\\_ORIGINAL_\n>     2.  Edit the current _$CVPNDIR/conf/httpd.conf_ file:\n>         \n>         _\\[Expert@HostName:0\\]# vi $CVPNDIR/conf/httpd.conf_\n>     3.  Add the following lines:\n>         \n>         _LoadModule status\\_module /opt/CPshrd-R<version>/web/Apache/2.2.0/modules/libmod\\_status.so_  \n>         _ExtendedStatus On_  \n>         _<Location /Login/server-status>_  \n>         _SetHandler server-status_  \n>         _</Location>_\n>         \n>         Examples:\n>         \n>         -   For R77.X: `/opt/CPshrd-R77/web/...`\n>         -   For R76: `/opt/CPshrd-R76/web/...`\n>         -   For R75.40VS: `/opt/CPshrd-R75.40VS/web/...`\n>         -   For R75.4x: `/opt/CPshrd-R75.40/web/...`\n>         -   For R75.20 / R75.30: `/opt/CPshrd-R75.20/web/...`\n>         -   For R75 / R75.10: `/opt/CPshrd-R75/web/...`\n>         -   For R71.X: `/opt/CPshrd-R71/web/...`\n>         -   For R70.X: `/opt/CPshrd-R70/web/...`\n>     4.  Save the changes and exit from Vi editor.\n>         \n>     5.  Reload the Mobile Access policy:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnd\\_admin policy_\n>         \n>         Notes:\n>         \n>         -   This might disconnect the current users\n>         -   If you see that the debug is not being collected, then run _cvpnrestart_  \n>             (This will restart the _cvpnd_ and _httpd_ processes - all existing Mobile Access connections will be disconnected)\n>     6.  To view the status page, browse to:\n>         \n>         -   On Mobile Access gateways:\n>             \n>             _https://<IP\\_of\\_MAB\\_GW>/sslvpn/Login/server-status_\n>         -   On Connectra gateways:\n>             \n>             _https://<IP\\_of\\_MAB\\_GW>/Login/server-status_\n>     7.  Known Issue ID 00922556: Experiencing a gradual slowdown in Mobile Access Blade performance, and on the status page there are many processes with \"G\" status that cannot be actually found running on the Mobile Access Gateway.\n>         \n>         Refer to [sk92847 - Mobile Access portal is occasionally unresponsive](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92847).\n>     \n>     **Enabling generation of Apache core dumps:**\n>     \n>     1.  Backup the current _$CVPNDIR/conf/httpd.conf_ file:\n>         \n>         _\\[Expert@HostName:0\\]# cp -v $CVPNDIR/conf/httpd.conf $CVPNDIR/conf/httpd.conf\\_ORIGINAL_\n>     2.  Edit the current _$CVPNDIR/conf/httpd.conf_ file:\n>         \n>         _\\[Expert@HostName:0\\]# vi $CVPNDIR/conf/httpd.conf_\n>     3.  Add the following line:\n>         \n>         _CoreDumpDirectory /var/log/dump/usermode_\n>     4.  Restart the Mobile Access:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnrestart_\n>         \n>         Notes:\n>         \n>         -   This will restart the _cvpnd_ and _httpd_ processes - all existing Mobile Access connections will be disconnected\n>     5.  If running a version older than R76, then run (refer to [sk53363](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk53363)):\n>         \n>         _\\[Expert@HostName:0\\]# um\\_core enable_  \n>         _\\[Expert@HostName:0\\]# reboot_\n>     \n>     **To test that core dump files are indeed created:**\n>     \n>     1.  Manually crash the _httpd_ process:\n>         \n>         (IMPORTANT: all existing Mobile Access connections will be disconnected)\n>         \n>         _\\[Expert@HostName:0\\]# kill -11 <httpd pid>_\n>         \n>     2.  Check if a core dump file was created for the _httpd_ process:\n>         \n>         _\\[Expert@HostName:0\\]# ls -l /var/log/dump/usermode/httpd\\*_\n>     3.  In addition, the following line should appear in the _$CVPNDIR/log/httpd.log_ file:\n>         \n>         _child pid <pid> exit signal Segmentation fault (11), possible coredump in /var/log/dump/usermode_\n> -   #### Debugging the Gateway side - _cvpnd_ process\n>     \n>     **To start the debug:**\n>     \n>     1.  It is recommended to enable the _httpd_ debug every time you collect the _cvpnd_ debug.\n>         \n>         **Important:** The _cvpnrestart_ command will stop the _cvpnd_ debug. So you need to initiate the _httpd_ debug before the _cvpnd_ debug.\n>     2.  Remove the rotated logs _$CVPNDIR/log/cvpnd.elg.\\*_, if they exist:\n>         \n>         _\\[Expert@HostName:0\\]# rm -i $CVPNDIR/log/cvpnd.elg.\\*_\n>     3.  Empty the log _$CVPNDIR/log/cvpnd.elg_ file:\n>         \n>         _\\[Expert@HostName:0\\]# echo '' > $CVPNDIR/log/cvpnd.elg_\n>         \n>         **IMPORTANT: Do not delete this log file!**\n>     4.  Start the debug:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnd\\_admin debug set TDERROR\\_ALL\\_ALL=5_\n>     \n>     **To stop the debug:**\n>     \n>     _\\[Expert@HostName:0\\]# cvpnd\\_admin debug off_\n> -   #### Debugging the Gateway side - _vpnd_ process\n>     \n>     The debug of _vpnd_ process is needed if there is a problem with SNX / SecureClient / EndpointConnect client.\n>     \n>     **To start the debug:**\n>     \n>     1.  Remove rotated logs _$FWDIR/log/vpnd.elg.\\*_, if they exist:\n>         \n>         _\\[Expert@HostName:0\\]# rm -i $FWDIR/log/vpnd.elg.\\*_\n>     2.  Empty the log file _$FWDIR/log/vpnd.elg_:\n>         \n>         _\\[Expert@HostName:0\\]# echo '' > $FWDIR/log/vpnd.elg_\n>         \n>         **IMPORTANT: Do not delete this log file!**\n>         \n>     3.  Make sure the logs are not corrupted by the log rotation issue. Read [sk52120 (Log files can become corrupted when running debug of Check Point daemons on SecurePlatform / Gaia OS)](http://supportcontent.checkpoint.com/solutions?id=sk52120) about this issue.\n>         \n>     4.  Start the debug:\n>         \n>         -   For any other client except SNX:\n>             \n>             _\\[Expert@HostName:0\\]# vpn debug on ALL\\_ALL=5_\n>         -   For SNX client:\n>             \n>             _\\[Expert@HostName:0\\]# vpn debug on slim=5_\n>     \n>     **To stop the debug:**\n>     \n>     _\\[Expert@HostName:0\\]# vpn debug off_\n> -   #### Debugging the Gateway side - _cvpnproc_ process\n>     \n>     The _cvpn_ process uses the _cvpnproc_ process for asynchronous jobs that may take a long time to complete. This process is responsible for sending SMS, e-mails and access to files via file share.\n>     \n>     **Currently, there is no easy way to collect the _cvpnproc_ debugs. The only option is to start it in debug mode.**\n>     \n>     **To start the debug:**\n>     \n>     1.  Stop Mobile Access services:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnstop_\n>     2.  Empty the log file _$CVPNDIR/log/cvpnproc.elg_:\n>         \n>         _\\[Expert@HostName:0\\]# echo '' > $CVPNDIR/log/cvpnproc.elg_\n>         \n>         **IMPORTANT: Do not delete this log file!**\n>     3.  Make sure _procserver_ is down:\n>         \n>         _\\[Expert@HostName:0\\]# ps aux | grep proc_\n>         \n>         If _procserver_ is still running, then kill it manually:  \n>         _\\[Expert@HostName:0\\]# kill -KILL <PID\\_of\\_procserver>_\n>         \n>     4.  Set the debug environment variable:\n>         \n>         _\\[Expert@HostName:0\\]# export TDERROR\\_ALL\\_ALL=5_\n>     5.  Start the _procserver_ process in the background:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnproc $CVPNDIR/log/cvpnproc.elg $CVPNDIR/conf/cvpnproc.C &_\n>     6.  Start the Mobile Access services:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnstart_\n>     \n>     **To stop the debug:**\n>     \n>     1.  Stop Mobile Access services:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnstop_\n>     2.  Kill the _procserver_:\n>         \n>         _\\[Expert@HostName:0\\]# ps aux | grep proc_  \n>         _\\[Expert@HostName:0\\]# kill -KILL <PID\\_of\\_procserver>_\n>     3.  Start the Mobile Access services:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnstart_\n> -   #### Debugging the Gateway side - _pinger_ process\n>     \n>     The _Pinger_ process was introduced in R75.40 and its main purpose is to reduce the number of _httpd_ processes performing ActiveSync. By default, all ActiveSync traffic in Mobile Access Blade is done via the _Pinger_ process.\n>     \n>     **If you suspect the problem is in _Pinger_ process, then try to disable it.  \n>     Then, the regular _httpd_ processes will handle the ActiveSync.**  \n>     Follow these steps:\n>     \n>     1.  Backup the current _$CVPNDIR/conf/httpd.conf_ file:\n>         \n>         _\\[Expert@HostName:0\\]# cp -v $CVPNDIR/conf/httpd.conf $CVPNDIR/conf/httpd.conf\\_ORIGINAL_\n>     2.  Edit the current _$CVPNDIR/conf/httpd.conf_ file:\n>         \n>         _\\[Expert@HostName:0\\]# vi $CVPNDIR/conf/httpd.conf_\n>     3.  Remove the # sign in front of the following line:\n>         \n>         _\\# CvpnUsePinger Off_\n>     4.  Save the changes and exit from Vi editor.\n>         \n>     5.  Restart Mobile Access services:\n>         \n>         _\\[Expert@HostName:0\\]# cvpnrestart_\n>         \n>         (This will restart the _cvpnd_ and _httpd_ processes - all existing Mobile Access connections will be disconnected)\n>     \n>     **To start the debug:**\n>     \n>     **Important: Since Jumbo Hotfix Accumulator for R77.30 Takes 2xx and R80.10, there are two 'Pinger' processes running on the gateway.**\n>     \n>     One is simply called 'Pinger' and handles WebSocket and Outlook Anywhere traffic.\n>     \n>     The other is called 'IdlePinger' and handles OWA and ActiveSync 'push mail' functionality.\n>     \n>     All 'PingerAdmin' commands below remain the same for 'Pinger'.\n>     \n>     For 'IdlePinger', add the word 'idle' as the first argument of each 'PingerAdmin' command.\n>     \n>     **For example:** _PingerAdmin idle debug on_\n>     \n>     1.  _Verify that Pinger_ process is running:\n>         \n>         _\\[Expert@HostName:0\\]# ps aux | grep Pinger_\n>     2.  Enable debug for relevant users:\n>         \n>         _\\[Expert@HostName:0\\]# PingerAdmin debug users <user1>,<user2>,<user3>_\n>     3.  Set the debug level:\n>         \n>         _\\[Expert@HostName:0\\]# PingerAdmin debug set TDERROR\\_ALL\\_Pinger=3_  \n>         or  \n>         _\\[Expert@HostName:0\\]# PingerAdmin debug set TDERROR\\_ALL\\_ALL=5_\n>     4.  Set the debug type:\n>         \n>         _\\[Expert@HostName:0\\]# PingerAdmin debug type All_\n>     5.  Delete all files from _$CVPNDIR/log/trace\\_log/_ directory:\n>         \n>         _\\[Expert@HostName:0\\]# rm -i $CVPNDIR/log/trace\\_log/\\*_\n>         \n>         **Note: Do not delete the directory itself!**\n>     6.  Enable trace log:\n>         \n>         Warning: This might print passwords to local files! _\\[Expert@HostName:0\\]# PingerAdmin debug trace on_\n>     7.  Empty the log file _$CVPNDIR/log/Pinger.log_:\n>         \n>         _\\[Expert@HostName:0\\]# echo '' > $CVPNDIR/log/Pinger.log_\n>         \n>         **IMPORTANT: Do not delete this log file!**\n>     8.  Start the debug:\n>         \n>         _\\[Expert@HostName:0\\]# PingerAdmin debug on_\n>     \n>     **To stop the debug:**\n>     \n>     1.  Stop debug:\n>         \n>         _\\[Expert@HostName:0\\]# PingerAdmin debug off_\n>     2.  Disable the trace log:\n>         \n>         _\\[Expert@HostName:0\\]# PingerAdmin debug trace off_\n>     3.  Reset the debug:\n>         \n>         _\\[Expert@HostName:0\\]# PingerAdmin debug reset_\n> \n> ### (2) Debugging MAB in Unified Policy Mode\n> \n> **How to debug Authorization in the kernel - Rulebase matching**\n> \n> **More comprehensive:**\n> \n> _fw ctl debug -buf 16384; fw ctl debug -m UP + all; fw ctl kdebug -t -f >& /var/tmp/kernel\\_debug.txt_\n> \n> **Less comprehensive, including only MAB modules, without rulebase matching debugging:**\n> \n> _fw ctl debug -buf 16384; fw ctl debug -m UP + mab info; fw ctl kdebug -t -f >& /var/tmp/kernel\\_mab.txt_\n> \n> **Stop debugging:**\n> \n> _fw ctl debug 0_\n> \n> **Important Note: Debugging MAB in Unified Policy Mode also requires debugging _cvpnd_ process.**\n> \n> ### (3) Debugging the user side\n> \n> -   #### Debugging the user side - _Problems with web application_\n>     \n>     1.  Install the Fiddler web debugger ([http://www.telerik.com/fiddler](http://www.telerik.com/fiddler))\n>     2.  Make sure that you enabled _https_ capturing and decoding ([http://docs.telerik.com/fiddler/configure-fiddler/tasks/decrypthttps](http://docs.telerik.com/fiddler/configure-fiddler/tasks/decrypthttps))\n>     3.  Make sure to empty the browser cache before starting the debug.\n>     4.  Collect the same capture on a PC connected to the internal network (without Mobile Access Blade in the middle).\n>     \n>     Related solutions:\n>     \n>     -   [sk99053 (How to debug Mobile Access Web Applications)](http://supportcontent.checkpoint.com/solutions?id=sk99053)\n> -   #### Debugging the user side - _Problems with Secure Workspace (SWS)_\n>     \n>     **To enable the SWS debug:**\n>     \n>     1.  Go to _Start_ menu - _Run..._ - paste the following command - click on OK:  \n>         _\"%WINDIR%\\\\system32\\\\rundll32.exe\" sysdm.cpl,EditEnvironmentVariables_\n>         \n>         Alternatively:\n>         \n>         1.  Desktop - right-click on the \"_My Computer_\" icon - click on \"_Properties_\"\n>         2.  Windows Vista/7/2012: In the left pane, click on \"_Advanced system settings_\".\n>         3.  Go to \"_Advanced_\" tab.\n>         4.  At the bottom, click on \"_Environment Variables..._\" button.\n>     2.  In the \"_System variables_\" section, add a new variable with the name _ISWLOG_ and the desired value:\n>         \n>         <table><tbody><tr><td>Logged category</td><td>Value</td></tr><tr><td>Success</td><td>0 (most verbose)</td></tr><tr><td>Info</td><td>1</td></tr><tr><td>Warning</td><td>2</td></tr><tr><td>Error</td><td>3</td></tr><tr><td>Important</td><td>4</td></tr><tr><td>Dump</td><td>5 (least verbose)</td></tr></tbody></table>\n>         \n>     3.  Verify that the new environment variable was applied - run this command in Windows Command Prompt:\n>         \n>         _C:\\\\> set | findstr ISWLOG_\n>         \n>         Output should show \"`ISWLOG=<integer_value>`\"\n>     4.  Reproduce the relevant issue.\n>         \n>     5.  The debug output file(s) will appear in _%Temp%\\\\IswTmp\\\\Logs\\\\_ directory.\n>         \n>     \n>     **To turn off debug output:**\n>     \n>     1.  Remove the variable \"_ISWLOG_\" from the list of \"System variables\".\n>         \n>     2.  Verify that the environment variable was removed - run this command in Windows Command Prompt:\n>         \n>         _C:\\\\> set | findstr ISWLOG_\n>         \n>         Output should be empty\n> -   #### Debugging the user side - _Problems with Native Applications_\n>     \n>     In order to fully debug an SNX session, debug output must be simultaneously enabled on the SNX client and Mobile Access Gateway before the issue is reproduced. The following are the instructions for enabled the debug for each side of the connection.\n>     \n>     **_On the Mobile Access Gateway_**\n>     \n>     1.  Start the debug of _vpnd_ process as described in the \"Debugging the Gateway side - _vpnd_ process\" section above.\n>         \n>     2.  Start the VPN kernel debug:\n>         \n>         _\\[Expert@HostName:0\\]# fw ctl debug 0_  \n>         _\\[Expert@HostName:0\\]# fw ctl debug -buf 32000_  \n>         _\\[Expert@HostName:0\\]# fw ctl debug -m fw + crypt_  \n>         _\\[Expert@HostName:0\\]# fw ctl debug -m fw_  \n>         _\\[Expert@HostName:0\\]# fw ctl debug -m VPN + tcpt_  \n>         _\\[Expert@HostName:0\\]# fw ctl debug -m VPN_  \n>         _\\[Expert@HostName:0\\]# fw ctl kdebug -T -f > /var/log/snx\\_debug.txt_\n>     \n>     **_SNX client in Network Mode on Windows OS_**\n>     \n>     1.  Change the value of the following registry key to \"5\":\n>         \n>         HKEY\\_CURRENT\\_USER > Software > CheckPoint > SSL Network Extender > parameters > dbg level\n>     2.  Change the value of the following registry key to \"5\":\n>         \n>         HKEY\\_LOCAL\\_MACHINE > System > ControlSet001 > Services > cpextender > parameters > dbg\\_level\n>     3.  Restart the SNX service by running the following commands in Windows Command Prompt:\n>         \n>         _net stop cpextender_  \n>         _net start cpextender_\n>     4.  Two debug output files will be created:\n>         \n>         -   _C:\\\\Program Files\\\\checkpoint\\\\SSL Network Extender\\\\slimsvc.log_\n>         -   _%appdata%\\\\check point\\\\extender\\\\activex.log_\n>     \n>     **_SNX client in Application Mode on Windows OS_**\n>     \n>     1.  Go to _Start_ menu - _Run..._ - paste the following command - click on OK:  \n>         _\"%WINDIR%\\\\system32\\\\rundll32.exe\" sysdm.cpl,EditEnvironmentVariables_\n>         \n>         Alternatively:\n>         \n>         1.  Desktop - right-click on the \"_My Computer_\" icon - click on \"_Properties_\"\n>         2.  Windows Vista/7/2012: In the left pane, click on \"_Advanced system settings_\".\n>         3.  Go to \"_Advanced_\" tab.\n>         4.  At the bottom, click on \"_Environment Variables..._\" button.\n>     2.  In the \"_System variables_\" section, add a new variable with the name _TDERROR\\_ALL\\_ALL_ and the value _5_.\n>         \n>     3.  Verify that the new environment variable was applied - run this command in Windows Command Prompt:\n>         \n>         _C:\\\\> set | findstr TDERROR\\_ALL\\_ALL_\n>         \n>         Output should show \"`TDERROR_ALL_ALL=5`\"\n>     4.  Two debug output files will be created:\n>         \n>         -   _%TEMP%\\\\SNXAC\\\\stap.txt_\n>         -   _%TEMP%\\\\SNXAC\\\\STALog.txt_\n>     \n>     **_SNX client in Network Mode on Linux OS_**\n>     \n>     1.  SNX Network Mode may be run from the command line in debug mode:\n>         \n>         _snx -s <server> -u <user\\_name> -g_\n>     2.  The debug output file will be created in _$HOMEDIR/snx.elg_\n>     \n>     **_SNX client in Network Mode on Mac OS X_**\n>     \n>     1.  In Terminal, create a file in the user's home directory named _.snxrc_:\n>         \n>         _touch ~/.snxrc_\n>     2.  Add the line \"_debug yes_\" to the _~/.snxrc_ file:\n>         \n>         _echo 'debug yes' > ~/.snxrc_  \n>         _cat ~/.snxrc_\n>     3.  The debug output file will be created in _$HOMEDIR/snx.elg_\n>         \n>     \n>     **_SNX client in Application Mode on Linux OS and Mac OS X_**\n>     \n>     1.  Create a file named _/tmp/stadebug_:\n>         \n>         _touch /tmp/stadebug_\n>     2.  Two debug output files will be created:\n>         \n>         -   _/tmp/stalog.txt_\n>         -   _/tmp/SNXAC/stap.elg_ (always created, regardless of the _/tmp/stadebug_ file)\n> -   #### _Thin-client deployment mechanism (C-Shell)_\n>     \n>     C-Shell has a JavaScript component and a binary component that is either ActiveX or Java, depending on the client machine's environment. In order to debug each of the components, follow the instructions below:\n>     \n>     **In order to debug the JavaScript component**\n>     \n>     This is needed if ActivX or Java component is not launched correctly by the portal.\n>     \n>     1.  Backup the current _$CVPNDIR/phpincs/SNXController.php_ file:\n>         \n>         _\\[Expert@HostName:0\\]# cp -v $CVPNDIR/phpincs/SNXController.php $CVPNDIR/phpincs/SNXController.php\\_ORIGINAL_\n>     2.  Edit the current _$CVPNDIR/phpincs/SNXController.php_ file:\n>         \n>         _\\[Expert@HostName:0\\]# vi $CVPNDIR/phpincs/SNXController.php_\n>     3.  Find the following line (approximately, line 162):\n>         \n>         _////////////////DEBUGGING UTILITY///////////////////_\n>     4.  Change the _Function.DEBUG_ line:\n>         \n>         from:\n>         \n>         _Function.DEBUG=Function.**DEBUG\\_MODE\\_OFF**;_\n>         \n>         to:\n>         \n>         _Function.DEBUG=Function.**DEBUG\\_MODE\\_ON\\_ALL**;_\n>     5.  Save the changes and exit from Vi editor.\n>         \n>     \n>     **In order to debug the ActiveX component**\n>     \n>     1.  Change the value of the following registry key to \"5\":\n>         \n>         HKEY\\_CURRENT\\_USER > Software > CheckPoint > SNX Components Shell > parameters > dbg\\_level\n>         \n>         If _dbg\\_level_ is missing, then create it (the type is \"REG\\_DWORD\").\n>     2.  The debug output file is _%temp%\\\\CShell\\\\SNXComponentsShell.log_\n>         \n>         If the debug file is missing, then make sure the following registry key exists:\n>         \n>         HKEY\\_CURRENT\\_USER > Software > CheckPoint > SNX Components Shell > parameters > dbg\\_file\n>         \n>         Create it (the type is \"REG\\_SZ\"), if needed, and set its value to _%temp%\\\\CShell\\\\SNXComponentsShell.log_.\n>     \n>     **In order to debug the Java component**\n>     \n>     Java is debugged according to the JVM installed on the client machine. Usually, the JVM is either Microsoft's or Oracle's.\n>     \n>     -   **For Microsoft's JVM:**  \n>         From Internet Explorer's main menu, go to Tools > Options > Advanced > Microsoft VM, and check all the Java debugging related checkboxes.\n>     -   **For Oracle's JVM:**  \n>         Go to Start menu > Settings > Control Panel > Java > Advanced, and check all debugging related checkboxes (especially in Java Console and Debugging).\n> \n> ### (4) Debugging Policy Installation\n> \n> -   To debug the FWD process\n>     \n>     Refer to [sk86321 - How to debug FWD daemon](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk86321)\n> -   To debug the CPD process\n>     \n>     Refer to [sk86320 - How to debug CPD daemon](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk86320)","language":"md","time":"14 days ago","created":"2025-05-06T22:56:09.291Z","annotations":[],"updated":"2025-05-06T22:58:33.657Z"},{"title":"Troubleshooting Check Point SmartConsole Certificate Issues","id":"84a0488e-83a1-428e-91a0-678fd37c317e","type":"TEXT","raw":"ProductSmartConsole\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2024-12-08\n\n#### For internal users only\n\n## Symptoms\n\n-   Login to the Security Management server via R80 SmartConsole fails with error: `\"Certificate revoked\"` or `\"certificate expired\"`.\n-   Get the Serial number of the SIC certificate by running: `\"cpopenssl pkcs12 -in $CPDIR/conf/sic_cert.p12 -nokeys -nomacver -passin pass: | cpopenssl x509 -noout -text | grep Ser\"` Assuming the Serial is xxxxx, please run: `\"cpca_client lscert -ser xxxxx\"` Certificate's status should be in \"Revoked\" or \"Expired\" status.\n-   The `\"cpwd_admin list\"` command shows all processes are running.\n-   All statuses are showing X sign.\n\n## Cause\n\nCertificate Database inconsistencies.\n\n## Solution\n\nConnect to the Security Management server via SSH and follow [sk20905](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk20905) (you may need to wait for the CPU usage to drop before connecting)\n\nAfter performing the aforementioned steps, there is no need to renew SICs, Security Gateway certificates, or take any other action.\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorIlija Altiparmakov\n\nTechnical ResourceDan Raworth\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2016-10-06\n\nLast Modified2024-12-08\n\nEditorDavid Kornfield\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only\n\nThe issue happens because for some reason, The SIC certificate was revoked or expired  \nTo get the Serial number of the SIC certificate by running: <code>\"cpopenssl pkcs12 -in $CPDIR/conf/sic\\_cert.p12 -nokeys -nomacver -passin pass: | cpopenssl x509 -noout -text | grep Ser\"</code>  \nAssuming the Serial is xxxxx, please run:  \n<code>\"cpca\\_client lscert -ser xxxxx\"</code>  \nCertificate's status should be revoked or expired.\n\nIf it isn't valid you need to re-create the certificate  \nPlease backup $CPDIR/conf/sic\\_cert.p12  \nThen on the Mgmt/(Domain) machine run:  \ncpca\\_client create\\_cert -n \"CN=cp\\_mgmt\" -f $CPDIR/conf/sic\\_cert.p12\n\nIf the Status is Valid and you still see \"Certificate revoked\" error, create a replication environment and open a CFG task to MGMT team.\n\n**Multiple SIC certificates**\n\nBy running <code>\"cpca\\_client search cp\\_mgmt\"</code> you will see all SIC certificates for SmartConsole login  \nMultiple cp\\_mgmt certificates is not a problem at all in the functionality.  \nThe only cp\\_mgmt certificate that the SmertCenter cares for is the physical copy of $CPDIR/conf/sic\\_cert.p12.  \nThis is the only certificate it validates against the cpca.\n\n**RC analysis**\n\nSome MGMT code revoked the SIC certificate (cp\\_mgmt certificate)  \nReplication setup after the issue already occurred wouldn't help   \nTo assist with the investigation of the revoked certificate, Crypto team added a print of the caller function that initiated the revoke request:  \nYou can track the released take using the parent issue: PMTR-61384  \nThe fix was delivered to R80.40 JHF and R81 but not released yet   \nThe caller function that initiate the revocation is the RC for this issue  \nIn case RC will not found in TM-15169, I suggest to add constant prints when cp\\_mgmt is revoked, so the next time the issue will reproduce it would easy to investigate why\n\n**MGMT HA  \n**per TM-14651, The revoked sic certificate on the primary caused the secondary MDS upgrade failure, During Post Upgrade Import 'sicRenew'. The SIC certificate of the secondary is revoked on the primary and this is the reason for 'sicRenew' failure. \n\nThe certificate was valid till 2024, but some MGMT code 'decided' to revoke it. RC should be investigated and fixed","language":"md","time":"14 days ago","created":"2025-05-06T22:56:12.459Z","annotations":[],"updated":"2025-05-06T22:58:44.293Z"},{"title":"Product Cluster and OSPF Configuration","id":"1a29a26d-ecb1-4c40-9c51-325bb4d7d411","type":"TEXT","raw":"ProductCluster - 3rd-party, ClusterXL, Quantum Security Gateways, VSX (Traditional)\n\nVersionR77.20 (EOS), R80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nOSGaia\n\nLast Modified2024-07-14\n\n## Solution\n\n**Table of Contents:**\n\n-   Objective\n    \n-   Introduction to OSPF\n    \n-   Network Topology\n    \n-   OSPF Configuration action plan\n    \n-   Configuring basic OSPF in Gaia Portal\n    \n-   Configuring basic OSPF on CLI\n    \n-   Verifying OSPF Configuration\n    \n-   Support for OSPF in a cluster\n    \n    -   Background\n        \n    -   ClusterXL\n        \n    -   VRRP\n        \n    -   Configuring OSPF on a cluster in Gaia Portal\n        \n    -   Configuring OSPF on a cluster in CLI\n        \n    -   Notes Regarding OSPF Graceful Restart\n        \n-   Troubleshooting\n    \n\n-   Random OSPF Outages\n    \n-   OSPF Errors and Explanations\n    \n\n-   Documentation\n    \n    -   Product pages\n        \n    -   Check Point Release Notes\n        \n    -   Check Point Administration Guides\n        \n    -   Additional documents\n        \n    -   RFC\n        \n    -   External references\n        \n-   Related solutions\n    \n\n## Objective\n\nThis article describes how to configure OSPF on Check Point Security Gateway running Gaia OS.\n\nThis article focuses on the basic configuration of OSPF and does not discuss any OSPF features in details.\n\n## Introduction to OSPF\n\nOpen Shortest Path First (OSPF) is an interior gateway protocol (IGP) used to exchange routing information between routers within a single Autonomous System (AS).\n\nOSPF calculates the best path based on true costs using a metric assigned by a network administrator. OSPF is efficient, has a quick convergence, and provides equal-cost multipath routing where packets to a single destination can be sent using more than one interface.\n\nOSPF is suitable for complex networks with many routers.\n\n## Network Topology\n\nThe topology below is used in this article:\n\n_Example of network topology between 2 single gateways_:\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95968/Network_Topology.png)\n\n## OSPF Configuration action plan\n\nAction plan and notes:\n\n-   If configuring OSPF on ClusterXL / VRRP cluster, then use cluster Virtual IP addresses.\n\n## Configuring basic OSPF in Gaia Portal\n\n1.  Connect to Gaia Portal on Security Gateway with a web browser at `https://_<Gateway_IP_addess>_`.\n2.  Once connected, make sure you are in the '`Advanced Mode`' (check the upper left corner).\n3.  Go to '`Advanced Routing`' section - go to '`OSPF`' pane.\n4.  Enter Router-ID:\n    \n    **Important Note:** In a cluster environment, all cluster members must have the same OSPF Router ID value.\n    \n    Notes:\n    \n    -   The Router ID uniquely identifies the router in the Autonomous System.\n    -   Router ID can be any IPv4 address (it does not necessarily need to be the IP address assigned to the Security Gateway you are configuring). You can keep these values default. It is strongly recommended to set the Router ID rather than relying on the default setting. This prevents the Router ID from changing if the interface used for the Router ID goes down. You can use an IP address of a Loopback interface (other than 127.0.0.1).\n        \n        **Note:** Currently, using a loopback interface for OSPF in a ClusterXL running on Gaia OS is not supported (see [sk117794](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk117794)).\n        \n    -   If configuring OSPF on ClusterXL / VRRP cluster, then use cluster Virtual IP addresses.\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95968/OSPF_in_Gaia_Portal_1.png)\n    \n5.  **Optional:** Define OSPF Areas in addition to the **backbone** area:\n    \n    In the '`Areas`' section, click on '`Add`' button.\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95968/OSPF_in_Gaia_Portal_2.png \"To see in full size, open the image in a new tab/window\")\n    \n6.  Add interface(s), whose network(s) should be advertised:\n    \n    In the '`Interfaces`' section, click on '`Add`' button.\n    \n    Notes:\n    \n    -   Assign the appropriate OSPF Area to each interface.\n    -   If needed, change the OSPF Intervals.\n    -   All intervals and authentication methods must be the identical for all routers on the OSPF link.\n    -   In ClusterXL, do NOT check the box \"_Use Virtual Address_\" (the Virtual IP address is always used).\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95968/OSPF_in_Gaia_Portal_3.png \"To see in full size, open the image in a new tab/window\")\n    \n7.  Configure the same settings on the other OSPF peers (make sure to enter the correct Area number).\n\n## Configuring basic OSPF on CLI\n\n**Notes:**\n\n-   In a cluster environment, all cluster members must have the same OSPF Router ID value.\n-   Basic OSPF setup can be configured on the CLI using the commands below.\n-   Inbound route filtering and route redistribution must be configured in Gaia Portal.\n-   Routemaps that can be used for route filtering (not discussed in this article) can also be configured on the CLI.\n-   If configuring OSPF on ClusterXL / VRRP cluster, then use cluster Virtual IP addresses.\n-   On VSX Gateway / VSX Cluster Member, the configuration must be performed in the context of Virtual System / Virtual Router (_vsenv <VSID>_).\n\n**Procedure:**\n\n1.  Connect to command line on the Gaia OS (over SSH, or console).\n2.  Log in to Clish.\n3.  Configure the OSPF:\n    \n    ```\n    HostName&gt; set router-id 41.41.1.1\n    HostName&gt; set ospf interface eth-s4p4 area backbone on\n    ```\n    \n4.  Save the configuration:\n    \n    `HostName> save config`\n    \n5.  Configure the same settings on the other OSPF peers (make sure to enter the correct Area number).\n\n## Verifying OSPF Configuration\n\n```\nHostName&gt; <strong>show ospf summary</strong>\n\nOSPF Router with ID  41.41.1.1  Instance  default\n\nSPF schedule delay: 2 secs\nHold time between two SPFs: 5 secs\nNumber of Areas in this router: 1\n    Normal: 1      Stub: 0      NSSA: 0\nRFC1583 compability mode is on\nNumber of Virtual Links in this router: 0\nNumber of UpEvents: 3  Number of DownEvents: 2\nDefault ASE Cost: 1\nDefault ASE Type: 1\n\nArea: 0.0.0.0\n\n    Number of Interfaces in this area:  1\n    Number of ABRs: 0      Number of ASBRs:  0\n    Number of times SPF Algorithm executed: 7\n    No Area Ranges Configured\n    No Area Stubnets Configured\n\nHostName&gt;\n```\n\n`HostName> **show ospf neighbors**`\n\n_Example of network topology between 2 single gateways_:\n\n[![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95968/OSPF_Verify.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95968/OSPF_Verify.png \"Click the image to see it in full size in a new tab/window\")\n\n## Support for OSPF in a cluster\n\n-   **Background**\n    \n    Gaia OS supports the OSPF protocol in cluster environment - either ClusterXL (High Availability New mode, both Load Sharing modes), or VRRP.\n    \n    In this configuration, the cluster becomes a Virtual Router, which is seen by neighboring routers as a single OSPF router that has an IP address that is the same as the Virtual IP address of the cluster.\n    \n    Note: If configuring OSPF on ClusterXL / VRRP cluster, then use cluster Virtual IP addresses.\n    \n-   **ClusterXL**\n    \n    ClusterXL advertises its Virtual IP address as the Router ID (If the Router ID was configured as instructed above. Otherwise, it will advertise a random IP address.)  \n    The OSPF routes database of the Active member (Master) is synchronized between all cluster members. The OSPF instance of each Standby member (Backup) obtains routing state and information from the Active member (Master) and installs the routes in the kernel as the Active member (Master) does.\n    \n    **Important Note:** In cluster environment, in OSPFv2 all cluster members must have the same OSPF Router ID value.\n    \n    During a failover, one of the Standby members (Backup) becomes the new Active member (Master) and then continues where the former Active member (Master) failed.\n    \n    As a result, there should be no traffic outage and no need for OSPFv2 graceful restart.\n    \n    The above-mentioned sync of OSPF database does not happen in OSPFv3. Therefore, Graceful Restart is needed and supported for OSPFv3 with ClusterXL.\n    \n-   **VRRP**\n    \n    You can configure OSPF to advertise the cluster Virtual IP address rather than the physical IP address of the interface. If you enable this option, OSPF runs only on the VRRP Master member.\n    \n    During a failover, OSPF stops being active on the former VRRP Master member and then becomes active on the new VRRP Master member (former VRRP Backup member). Because the OSPF routes database of the VRRP Master member is not synchronized between all cluster members, a traffic break may occur during the time it takes the OSPF instance to become active on the new VRRP Master and the OSPF protocol to learn routes again.\n    \n    The larger the network, the more time it takes OSPF to synchronize its database and install routes again.\n    \n    Refer to [sk104441 - OSPF Graceful Restart with VRRP in R77.30 and above](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk104441).\n    \n-   **Configuring OSPF on a cluster in Gaia Portal**\n    \n    ClusterXL uses Virtual IP address **by default** (and this cannot be disabled). Therefore, no configuration is required in Gaia Portal for Virtual IP Address (do NOT check the box \"_Use Virtual Address_\" in the interface's settings).\n-   **Configuring OSPF on a cluster in CLI**\n    \n    ClusterXL uses Virtual IP address **by default** (and this cannot be disabled). Therefore, no configuration is required in Clish for Virtual IP Address.\n\n-   **Notes Regarding OSPF Graceful Restart**\n    \n    -   MVC upgrade from versions R81 or lower to R81.10 or higher with OSPF Graceful Restart configured with ClusterXL is not supported. Attempting an MVC upgrade from pre-R81.10 to a newer version while OSPF Graceful Restart is configured result in a failure to sync OSPF routes between cluster members. To do an MVC upgrade from a pre-R81.10 version to a newer version on a cluster configured with OSPF Graceful Restart, first remove the OSPF Graceful Restart configuration and perform the MVC upgrade.\n    -   A change in topology can cause an unsuccessful exit of OSPF GR.  To prevent this, make sure there are no route or topology changes during the process.\n    -   A Restart or failover during GR is not supported.  This is because, according to the RFC if you are a helper you cannot be a restarter at the same time. In such a case, VRRP fails-back preemptively, causing the role of GR helper to be terminated and hence routes are deleted.\n    -   In VRRP mode, the OSPF state is not synchronized, and a new master cannot take the helper responsibility from the previous master.  To prevent this, do not fail over members if an OSPF neighbor is in the process of restart.\n\n##   \nTroubleshooting\n\n###   \nRandom OSPF Outages\n\n> **Symptoms:**\n> \n> > Random OSPF outages might be experienced in the following scenarios:\n> > \n> > -   OSPF timers are reduced from default 10/40\n> > -   Number of OSPF neighbors increases\n> > -   Number of OSPF routes increases\n> > -   On VPN Security Gateways configured for MEP that redistribute RIM routes into OSPF, the OSPF database contains duplicate entries for the same RIM route that comes from both MEP Security Gateways (see [sk115117](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk115117))\n> \n> **Root Cause:**\n> \n> > The root cause of all of these symptoms is that Gaia OS is not able to send out OSPF Hello packets in timely manner when it is busy running SPF calculation or performing other tasks.\n> \n> **Solution:**\n> \n> > Check Point offers these hotfixes to improve OSPF scalability:\n> > \n> > **Note** - All these fixes were integrated starting from\n> > \n> > -   [Check Point R80.10](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk111841)\n> > -   [Jumbo Hotfix Accumulator for R77.30](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk106162) - _Take\\_210_\n> > \n> > <table><tbody><tr><td>#</td><td>ID</td><td>Description</td></tr><tr><td>1</td><td><p>02367866,</p><p>01993919</p></td><td><p>Force OSPF Hello packets to be sent out even when RouteD daemon is busy processing the LS Updates, SPF calculation or synchronizing OSPF routes to other cluster member</p></td></tr><tr><td>2</td><td>02367871</td><td><p>Wait at least 15 seconds after the routes are synchronized to between cluster members to bring the Critical Device \"<code>routed</code>\" back to the \"up\" state.<br>This gives RouteD daemon enough time to run the SPF calculation and push OSPF routes down to the kernel.</p></td></tr><tr><td>3</td><td>02367867</td><td><p>Improve stability of RouteD daemon on Standby cluster member.</p></td></tr></tbody></table>\n> \n> **Notes:**\n> \n> > -   The recommended timers for OSPF are default settings of 10/40.  \n> >     The absolute minimum settings of timers for OSPF are 5/20.\n> >     \n> > -   The OSPF forced Hello timer should be set to 1 Hello interval to a maximum of 10 seconds.\n> >     \n\n###   \nOSPF Errors and Explanations\n\n> The tables below provide explanations of OSPF errors. Wrong configuration or unusual behavior on the OSPF peers create these OSPF errors.\n> \n> **OSPF Global - IP Errors**\n> \n> > <table><tbody><tr><td>Error</td><td>Description</td></tr><tr><td>Protocol</td><td>IP protocol of the packet is not 89</td></tr><tr><td>BadSource</td><td>Bad packet source IP</td></tr><tr><td>BadDestination</td><td>Bad packet destination IP</td></tr><tr><td>Size</td><td>Packet size is too small</td></tr><tr><td>NoSuchIndex</td><td>This error does not actually count anything in the code, so it will always be 0</td></tr><tr><td>OwnPacket</td><td>Received own packet</td></tr></tbody></table>\n> \n> **OSPF Global - Protocol Errors**\n> \n> **OSPF Instance - Hello Protocol Errors**\n> \n> > <table><tbody><tr><td>Error</td><td>Description</td></tr><tr><td>Bad Size</td><td>Hello list corrupt</td></tr><tr><td>Network Mask Mismatch</td><td>Peer does not have the same network mask</td></tr><tr><td>Dead Interval Mismatch</td><td>Peer does not have the same dead interval</td></tr><tr><td>Hello Duplicate Router ID</td><td>A peer has the same router ID</td></tr><tr><td>External Option Mismatch</td><td>Stub area received non-stub hello pkt / non-stub area received stub hello pkt</td></tr><tr><td>NSSA Option Mismatch</td><td>NSSA received pkt with N-bit not set / non-NSSA received pkt without N-bit set</td></tr><tr><td>Runt</td><td>Packet size is too small</td></tr><tr><td>Hello Timer Mismatch</td><td>Peer does not have the same hello interval</td></tr></tbody></table>\n> \n> **OSPF Instance - Link State Update Errors**\n> \n> > <table><tbody><tr><td>Error</td><td>Description</td></tr><tr><td>Runt</td><td>Packet size is too small</td></tr><tr><td>LSU Duplicate Router ID</td><td>A peer has the same router ID</td></tr><tr><td>LSU TooLow</td><td>Neighbor state is too low to accept this packet type</td></tr><tr><td>BadCSum</td><td>Bad checksum</td></tr><tr><td>BadLSType</td><td>LSU contained an LSA with an unknown LS type</td></tr><tr><td>ASEinStub</td><td>ASE LSA in NSSA/Stub area</td></tr><tr><td>Type7inNonNSSA</td><td>Type 7 LSA in non NSSA</td></tr><tr><td>LSU TooNew</td><td>We just installed this LSA less than one second ago</td></tr><tr><td>BadLSReq</td><td>The LSA we received is on the neighbor's request list (the nbr sent us an LSA it requested from us)</td></tr><tr><td>SeqNumWrap</td><td>Sequence number wrapping</td></tr><tr><td>Invalid SeqNum</td><td>Invalid sequence number</td></tr><tr><td>SummaryinTotalStub</td><td>Summary LSA in total stub area</td></tr><tr><td>BadRouterLSASize</td><td>Bad router (type 1) LSA size</td></tr><tr><td>BadNetworkLSASize</td><td>Bad network (type 2) LSA size</td></tr><tr><td>BadSummaryLSASize</td><td>Bad summary (type 3) LSA size</td></tr><tr><td>BadASELSASize</td><td>Bad ASE (type 5) LSA size</td></tr><tr><td>BadType7LSASize</td><td>Bad NSSA (type 7) LSA size</td></tr></tbody></table>\n> \n> **OSPF Instance - Link State ACK Errors**\n> \n> > <table><tbody><tr><td>Error</td><td>Description</td></tr><tr><td>LSAck Duplicate Router ID</td><td>A peer has the same router ID as us</td></tr><tr><td>LSAck TooLow</td><td>Neighbor state is too low to accept this packet type</td></tr><tr><td>BadSize</td><td>LSAck LSA list corrupt</td></tr><tr><td>QuestionAck</td><td>The LSAck packet had a different sequence number, age, or checksum than what we expected</td></tr><tr><td>BadLSType</td><td>LSAck contained an LSA with an unknown LS type</td></tr></tbody></table>\n> \n> **OSPF Instance - Link State Request Errors**\n> \n> **OSPF Instance - Database Description Errors**\n> \n> > <table><tbody><tr><td>Error</td><td>Description</td></tr><tr><td>ASEinStub</td><td>ASE LSA in stub area</td></tr><tr><td>Type7inNonNSSA</td><td>Type 7 LSA in non-NSSA</td></tr><tr><td>MTU</td><td>Peer has a larger MTU configured</td></tr><tr><td>BadLSType</td><td>DD contained an LSA with an unknown LS type</td></tr><tr><td>NotDuplicate</td><td>Received non-duplicate DD in Loading or Full state</td></tr><tr><td>BadSize</td><td>DD LSA list corrupt (wrong size)</td></tr><tr><td>OptionsMismatch</td><td>DD options do not match neighbor</td></tr><tr><td>DuplicateLSA</td><td>Received an LSA that we already enqueued on our request list</td></tr><tr><td>DD Duplicate Router ID</td><td>A peer has the same router ID as us</td></tr><tr><td>InitSet</td><td>Received DD packet with the init bit set in Exchange, Loading or Full states</td></tr><tr><td>Runt</td><td>Packet size too small</td></tr><tr><td>MasterMismatch</td><td>Both us and the peer want to be master</td></tr><tr><td>SlaveSeq</td><td>Out of sequence DD for slave</td></tr><tr><td>MasterSeq</td><td>Out of sequence DD for master</td></tr><tr><td>DD TooLow</td><td>Neighbor state is too low to accept this packet type</td></tr></tbody></table>\n> \n> **OSPF Instance - Protocol Errors**\n> \n> > <table><tbody><tr><td>Error</td><td>Description</td></tr><tr><td>Bad Area ID</td><td>Unknown Area ID in packet</td></tr><tr><td>Area ID Mismatch</td><td>Virtual interface transit area mismatch</td></tr><tr><td>AuthCryptoSeq</td><td>Bad authentication crypto sequence number</td></tr><tr><td>AuthKey</td><td>Bad authentication key</td></tr><tr><td>AuthKeyId</td><td>Could not find the authentication key ID</td></tr><tr><td>AuthKeyTime</td><td>Current time is not within the authentication key's start and stop accept times</td></tr><tr><td>AuthKeyType</td><td>Bad authentication type</td></tr><tr><td>BadDestination</td><td>Received packet send to the AllDR multicast group, but our interface is not DR or BDR</td></tr><tr><td>Checksum</td><td>Received packet with bad checksum</td></tr><tr><td>NoNeighbor</td><td>Received a packet from a source that is not our neighbor</td></tr><tr><td>Size</td><td>Received a packet with a bad packet size</td></tr><tr><td>Version</td><td>Received a packet that has an unsupported OSPF version (meaning not version 2 or 3)</td></tr><tr><td>NonLocal</td><td>Packet source is not from the same network as the interface it was received on</td></tr><tr><td>VirtualLink</td><td>Received packet over virtual link, but we're not an ABR</td></tr><tr><td>NoVirtualNeighbor</td><td>Virtual interface is not up / cannot locate NBR on virtual interface</td></tr><tr><td>IfDown</td><td>Attempting to send a packet on a down interface</td></tr><tr><td>PacketType</td><td>Unknown packet type</td></tr><tr><td>Passive Interface</td><td>Received packet on passive interface</td></tr><tr><td>TX</td><td>Error sending packet</td></tr><tr><td>ZeroRID</td><td>Received packet with router ID 0</td></tr></tbody></table>\n\n##   \nDocumentation\n\n<table><tbody><tr><td id=\"Documentation - Product pages\" colspan=\"2\">Product pages</td></tr><tr><td>Product pages</td><td><a href=\"http://www.checkpoint.com/gaia/#features\" target=\"_blank\" rel=\"noopener\">Check Point Gaia OS</a></td></tr><tr><td id=\"Documentation - Check Point Release Notes\" colspan=\"2\">Check Point Release Notes</td></tr><tr><td>Release Notes</td><td><a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=13079\" target=\"_blank\" rel=\"noopener\">R75.40</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=16421\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=18381\" target=\"_blank\" rel=\"noopener\">R75.45</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=23394\" target=\"_blank\" rel=\"noopener\">R75.46</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=25460\" target=\"_blank\" rel=\"noopener\">R75.47</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=22933\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=24827\" target=\"_blank\" rel=\"noopener\">R77</a>,&nbsp;<a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=30257\" target=\"_blank\" rel=\"noopener\">R77.10</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=31853\" target=\"_blank\" rel=\"noopener\">R77.20</a>&nbsp;/&nbsp;<a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=31854\" target=\"_blank\" rel=\"noopener\">Appendix</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=40107\" target=\"_blank\" rel=\"noopener\">R77.30</a>&nbsp;/ <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=40108\" target=\"_blank\" rel=\"noopener\">Appendix</a>,&nbsp;<a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=54802\" target=\"_blank\" rel=\"noopener\">R80.10</a></td></tr><tr><td id=\"Documentation - Check Point Administration Guides\" colspan=\"2\">Check Point Administration Guides</td></tr><tr><td>Gaia Advanced Routing Administration Guide</td><td><a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=13221\" target=\"_blank\" rel=\"noopener\">R75.40</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=16245\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=22929\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=24803\" target=\"_blank\" rel=\"noopener\">R77.X</a>,&nbsp;<a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=54803\" target=\"_blank\" rel=\"noopener\">R80.10</a></td></tr><tr><td>Gaia Administration Guide</td><td><a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=13241\" target=\"_blank\" rel=\"noopener\">R75.40</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=16244\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=22928\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=24828\" target=\"_blank\" rel=\"noopener\">R77.X</a>,&nbsp;<a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=54824\" target=\"_blank\" rel=\"noopener\">R80.10</a></td></tr><tr><td>Command Line Interface Reference Guide</td><td><a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=13944\" target=\"_blank\" rel=\"noopener\">R75.40</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=16262\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=22909\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=24833\" target=\"_blank\" rel=\"noopener\">R77.X</a></td></tr><tr><td>ClusterXL Administration Guide</td><td><a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=13090\" target=\"_blank\" rel=\"noopener\">R75.40</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=16221\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=22910\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=24800\" target=\"_blank\" rel=\"noopener\">R77.X</a>,&nbsp;<a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=54804\" target=\"_blank\" rel=\"noopener\">R80.10</a></td></tr><tr><td>VSX Administration Guide</td><td><a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=16383\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=22932\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=24802\" target=\"_blank\" rel=\"noopener\">R77.X</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=54764\" target=\"_blank\" rel=\"noopener\">R80.10</a></td></tr><tr><td>600 / 700 / 1100 / 1200R / 1400 Appliances Advanced Routing Reference Guide</td><td><a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=26395\" target=\"_blank\" rel=\"noopener\">R75.20</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=43085\" target=\"_blank\" rel=\"noopener\">R77.20</a></td></tr><tr><td id=\"Documentation - Additional documents\" colspan=\"2\">Additional documents</td></tr><tr><td>Additional document</td><td><a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=15942\" target=\"_blank\" rel=\"noopener\">How To Configure Policy Based Routing</a><ul></ul></td></tr><tr><td id=\"Documentation - RFC\" colspan=\"2\">RFC</td></tr><tr><td>Clarifications and Extensions for the Bootstrap Protocol</td><td><a href=\"http://tools.ietf.org/html/rfc1542\" target=\"_blank\" rel=\"noopener\">RFC 1542</a>, also refer to <a href=\"http://www.rfc-editor.org/errata_search.php?rfc=1542\" target=\"_blank\" rel=\"noopener\">errata</a><ul></ul></td></tr><tr><td>OSPFv2</td><td><a href=\"https://www.ietf.org/rfc/rfc2328.txt\" target=\"_blank\" rel=\"noopener\">RFC 2328</a>, also refer to <a href=\"http://www.rfc-editor.org/errata_search.php?rfc=2328\" target=\"_blank\" rel=\"noopener\">errata</a><ul></ul></td></tr><tr><td>OSPFv3 (IPv6)</td><td><a href=\"http://www.ietf.org/rfc/rfc2740.txt\" target=\"_blank\" rel=\"noopener\">RFC 2740</a>, also refer to <a href=\"http://www.rfc-editor.org/errata_search.php?rfc=2740\" target=\"_blank\" rel=\"noopener\">errata</a><ul></ul></td></tr><tr><td>OSPF Not-So-Stubby Area (NSSA) Option</td><td><a href=\"http://www.ietf.org/rfc/rfc3101.txt\" target=\"_blank\" rel=\"noopener\">RFC 3101</a><ul></ul></td></tr><tr><td id=\"Documentation - External references\" colspan=\"2\">External references</td></tr><tr><td>Wikipedia</td><td><a href=\"http://en.wikipedia.org/wiki/Ospf\" target=\"_blank\" rel=\"noopener\">http://en.wikipedia.org/wiki/Ospf</a></td></tr><tr><td>Cisco Document ID 13685</td><td><a href=\"http://www.cisco.com/c/en/us/support/docs/ip/open-shortest-path-first-ospf/13685-13.html\" target=\"_blank\" rel=\"noopener\">OSPF Neighbor States</a></td></tr></tbody></table>\n\n-   [sk106842 - OSPF Hello packets stop being sent for several seconds every 30-45 minutes in VRRP cluster on Gaia OS](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk106842)\n    \n-   [sk109092 - OSPF with enabled MD5 authentication is not establishing adjacency due to MTU mismatch](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk109092)\n    \n-   [sk100502 - How to configure Equal Cost Multipath (ECMP) over OSPF on Gaia OS](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk100502)\n    \n-   [sk84520 - How to debug OSPF and RouteD daemon on Gaia](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk84520)\n    \n-   [sk39960 - How to allow Dynamic Routing protocols traffic OSPF, BGP, PIM, RIP, IGRP through Check Point Security Gateway](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk39960)\n    \n-   [sk92322 - Neighborship for OSPF, BGP, RIP, and PIM in Gaia Cluster is formed with Physical IP addresses upon a reboot](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92322)\n    \n-   [sk74700 - Unable to establish OSPF Neighbor State](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk74700)\n    \n-   [sk98909 - How to advertise static routes in Virtual System on Gaia OS](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98909)\n    \n-   [sk110115 - Unable to restrict imported OSPF routes using routemaps](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk110115)\n    \n-   [sk115314 - RouteD daemon might crash upon receiving OSPF LSA of Type 10 and Type 11](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk115314)\n    \n-   [sk116500 - OSPF routes from the peer are added to OSPF database, but not to the kernel routing table when the peer is configured to use OSPF Point-to-Point network](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk116500)\n    \n-   [sk98226 - Dynamic Routing and VRRP Features on Gaia OS](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98226)\n    \n-   [sk115055 - \"The router ID cannot be changed while OSPF is configured and active\" error in Gaia Portal when trying to changing the OSPF Router ID](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk115055)\n    \n-   [sk91481 - OSPF is inactive state after deleting static route/default route](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk91481)\n    \n-   [sk93306 - ATRG: ClusterXL R6x and R7x](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk93306)\n    \n-   [sk92787 - How to debug ClusterXL failovers caused by RouteD daemon on Gaia OS](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92787)\n    \n-   [sk109049 - Dynamic Routing Troubleshooting Tips](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk109049)\n    \n\n## Article Properties\n\nOriginatorNilesh Siddhapura\n\nTechnical ResourceSundeep Mudgal\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2013-10-27\n\nLast Modified2024-07-14\n\nEditorGil Frantsus\n\nLast ApproverGil Frantsus\n\n## Comments\n\n#### Internal only\n\nCheck Point offers the following hotfixes to improve OSPF scalability (Task 62425):\n\nThese fixes have been tested in extreme failover conditions and aggressive OSPF LS Updates with following configuration:\n\n-   42 neighbors\n-   40 interfaces\n-   500 routes along with frequent failovers\n-   OSPF timers of 5/20 seconds\n\n<table><tbody><tr><td>#</td><td>ID</td><td>Description</td><td>Hotfixes<br>(\\\\galaxy\\ckp\\pkg\\SecurePlatform\\)</td></tr><tr><td>1</td><td>02367866</td><td>Force OSPF Hello packets to be sent out even when RouteD daemon is busy processing the LS Updates, SPF calculation or synchronizing OSPF routes to other cluster member.</td><td><p><strong>R77.10</strong></p><p>CR02369477 - gypsy_hf_021_470</p><p>CR02369599 - gaia_gypsy_372_011</p><p><strong>R77.20</strong></p><p>CR02378527 - R77_20_jhf_t150_798</p><p><strong>R77.30</strong></p><p>CR02367866 - R77_30_jhf_t159_MADA</p><p>CR02367883 - R77_30_jhf_t145_012</p><p>CR02367904 - <em>Take_210</em>&nbsp;of sk106162 (R77.30 Jumbo Hotfix)</p></td></tr><tr><td>2</td><td>02367871</td><td>Wait at least 15 seconds after the routes are synchronized between cluster members to bring the Critical Device \"<code>routed</code>\" back to the \"up\" state.<br>This gives RouteD daemon enough time to run the SPF calculation and push OSPF routes down to the kernel.</td><td><p><strong>R77.10</strong></p><p>CR02369480 - gypsy_hf_021_470</p><p>CR02369774 - gaia_gypsy_372_011</p><p><strong>R77.20</strong></p><p>CR02378536 - R77_20_jhf_t150_798</p><p><strong>R77.30</strong></p><p>CR02367885 - R77_30_jhf_t145_012</p><p>CR02367871 - R77_30_jhf_t159_MADA</p><p>CR02369379 - Take_198 of sk106162 (R77.30 Jumbo Hotfix)</p><p><strong>R80.10</strong></p><p>CR02369375 - integrated</p></td></tr><tr><td>3</td><td>02367867</td><td>Improve stability of RouteD daemon on Standby cluster member.</td><td><p><strong>R77.10</strong></p><p>CR02369782 - gaia_gypsy_372_011</p><p>CR02369487 - gypsy_hf_021_470</p><p><strong>R77.20</strong></p><p>CR02378565 - R77_20_jhf_t150_798</p><p><strong>R77.30</strong></p><p>CR02367884 - R77_30_jhf_t145_012</p><p>CR02367867 - R77_30_jhf_t159_MADA</p><p>CR02369381 - Take_198 of sk106162 (R77.30 Jumbo Hotfix)</p><p><strong>R80.10</strong></p><p>CR02369380 - integrated</p></td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:03.402Z","annotations":[],"updated":"2025-05-06T22:58:19.753Z"},{"title":"IPSec Encryption for Check Point Security Gateway","id":"7adfeb2b-8abf-4c39-aea3-a8f365a23a80","type":"TEXT","raw":"**This article is dedicated to VPN Core (Site-to-Site) only.** \n\nCheck Point Security Gateway performs IPSec encryption using the following two components:\n\n-   VPN is supported by all modes of Check Point cluster.\n    \n-   In addition to synchronizing the connections and various inspection tables, cluster members also synchronize the SA kernel tables, which contain information about both the IKE SAs and IPSec SAs.\n    \n-   All IKE SAs and IPSec SAs will always be assigned to the Cluster VIP address.\n    \n-   If a cluster member gets an encrypted packet with an SPI it does not know (even if the other cluster member does), the packet would be dropped on \"unknown SPI\".\n    \n-   If the IKE negotiation is initiated from VPN peer to the cluster, the stickiness of the internal cluster decision function ensures that the entire negotiation is performed against the same cluster member.\n    \n    If the IKE negotiation is initiated by the cluster in Load Sharing mode, then IKE packets from VPN peer might be assigned by internal cluster decision function to another cluster member that is not yet aware of this IKE negotiation. For this reason, IKE forwarding mechanism is used to ensure that the entire IKE negotiation is performed against one cluster member (and if IKE packets get to the \"wrong\" cluster member, they will be forwarded to the \"right\" cluster member).\n    \n-   The IKE Forwarding mechanism uses the kernel table _SEP\\_my\\_IKE\\_packet_ that records each unknown first IKE packet.\n    \n-   In IKE negotiation between Check Point gateways, each side has a unique cookie that is valid and used during the entire IKE Phase 1 validation time. Each IKE packet contains that cookie and also a Message ID (in Phase 1 packets, this ID equals zero; in Phase 2 packets, this ID is unique for each Phase 2 negotiation).\n    \n-   Inbound IKE flow:\n    \n    1.  Cluster member gets IKE packet.\n        \n    2.  If this High Availability cluster mode, then the Active cluster member takes ownership on that IKE negotiation by writing in the _SEP\\_my\\_IKE\\_packet_ table the \"cookie + msg\\_id\" of the IKE packet, with its own IP address as the cluster peer.\n        \n    3.  If this Load Sharing cluster mode, then the member resolves the cookie and the Message ID from the IKE packet (in Phase 1 the Message ID is simply zero).\n        \n    4.  Cluster member searches in the _SEP\\_my\\_IKE\\_packet_ table for entry that matches to that key (\"cookie + msg\\_id\").\n        \n    5.  If such entry already exists, it means that this is not the first IKE packet in that IKE negotiation. Therefore, cluster member checks in the _SEP\\_my\\_IKE\\_packet_ table what is the cluster peer - the member that manages the IKE negotiation.\n        \n    6.  If cluster member that manages the IKE negotiation is the local machine, then cluster member just keeps handling the IKE packet as usual. Otherwise, cluster member changes the destination on the IKE packet according the cluster peer that is written in the _SEP\\_my\\_IKE\\_packet_ table and forwards the IKE packet to that peer member at the end of the chain's treatment (this forwarded IKE packet does not need to pass the chains again on the peer member).\n        \n    7.  If such entry does not exist in the _SEP\\_my\\_IKE\\_packet_ table yet, it means that this is the first IKE packet of the IKE negotiation. Therefore, this cluster member takes ownership on that IKE negotiation by writing in the _SEP\\_my\\_IKE\\_packet_ table the \"cookie + msg\\_id\" of the IKE packet, with its own IP address as the cluster peer.\n        \n-   Outbound IKE flow:\n    \n    1.  When cluster member needs to initiate IKE negotiation, it checks that there is no entry in the _SEP\\_my\\_IKE\\_packet_ table with that key \"cookie + msg\\_id\", and sets new entry in the table with its own IP address as the cluster peer.\n        \n-   When IKE negotiation is performed with a 3rd party cluster, the unique IP address that written in the _SEP\\_my\\_IKE\\_packet_ table is the IP address of the Sync interface of the 3rd party cluster member (because in 3rd party cluster, the cluster VIP could be identical the physical member IP address).\n    \n-   In Load Sharing cluster, it could be case that IKE Phase 2 packets get to a member that does not have the IKE Phase 1 keys yet, because the SAs from IKE Phase 1 were not synchronized yet. Therefore, IKE Phase 2 packets are forwarded to the member that performed the IKE Phase 1 negotiation. When IKE Phase 2 packet is received, cluster member gets its cookie and checks if IKE SA exists in the table _IKE\\_SA\\_table_. If this key is found, then cluster member handles that IKE negotiation. If such key does not exist yet, then cluster member checks which cluster peer member performed the IKE Phase 1 negotiation checking the _SEP\\_my\\_IKE\\_packet_ table and forwards the IKE packet to that cluster peer member. If the relevant entry does not exist in the _SEP\\_my\\_IKE\\_packet_ table for this cookie or the cluster member that performed IKE Phase 1 negotiation is the current cluster member, then something is not working correctly.\n    \n-   In Load Sharing cluster mode, only the _inbound SAs_ are synchronized. The _outbound SAs_ are not synchronized (created separately on each cluster member) to prevent IKE replay attack. However, cluster members still store an entry in the _outbound\\_SPI_ table (with \"0\" value), for a case that SA deletion request is received on the cluster member that does not own this outbound SA.\n    \n    If this entry is not stored on all cluster members, and a cluster member is not able to find the entry in his _outbound\\_SPI_ table, then it will do nothing and this outbound SA will continue to exist on the cluster member that does own this outbound SA. Therefore, all the SAs are stored on all cluster members, and if the deletion request gets to one of the cluster members, it deletes the entry of this SA and synchronizes the table to all cluster peer members. Each cluster member uses only in his own outbound SA.\n    \n\nKernel tables (also known as State tables) are used to keep state information, which the FireWall Virtual Machine, and other components of the Security Gateway need to correctly inspect the packet.\n\nThe tables are actually the 'memory' of the Virtual Machine in the kernel, and are the key component of Check Point Stateful Inspection technology.\n\nState tables are implemented as dynamic hash tables in kernel memory.\n\nAll field values are in hexadecimal (for some tables can be converted to decimal), apart from the time-out value at the end of the entry, when present.\n\n<table><tbody><tr><td>Parameter/Flag</td><td>Description</td></tr><tr><td><code>TABLE</code></td><td>Either the name, or ID number of the kernel table</td></tr><tr><td><code>-s</code></td><td>Displays a short summary of the table's information (the current total number and peak number of connections)</td></tr><tr><td><code>-f</code></td><td>Displays a formatted version of the table's contents (every table may have its own specific format style).</td></tr><tr><td><code>-r</code></td><td>Used with \"-f\" flag. Resolves IP addresses in formatted output.</td></tr><tr><td><code>-u</code></td><td>Displays an unlimited output (entire table's contents).</td></tr><tr><td><code>-m MaxValues</code></td><td>Displays table's contents limited to \"MaxValues\" entries.</td></tr></tbody></table>\n\n<table id=\"KernelTablesTable\"><tbody><tr><td>Table Name</td><td>Description</td></tr><tr><td><code>connections</code></td><td><p>Main table that holds data on all active connections. For more information, refer to <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk65133\" target=\"_blank\" rel=\"noopener\">sk65133 - Connections Table Format</a>.</p></td></tr><tr><td><code>crypt_resolver_db</code></td><td><ul type=\"circle\"><li><p>Maintains a list of VPN links and their status (alive, dead, or unknown).</p></li><li><p>A probing protocol (RDP packets on UDP port 259) is used to determine the link's status.</p></li><li><p>This table is used in case of multi-homed configuration, dynamic interface resolving and MEP configurations.</p></li><li><p>The table is used in order to find out which link to use (according to the links' status and the configured priority).</p></li><li><p>Default expiration time is 30 seconds.</p></li><li><p>Not synchronized between cluster members.</p></li><li><p>Table entry: &lt;<em>Dest_IP, Source_IF, Next_Hop_IP; Status</em>&gt;, where:</p><ul type=\"square\"><li><p>Dest_IP - The destination IP address of the link we query</p></li><li><p>Source_IF - The source interface index of the link we query (\"-1\" if multi-homed is not used)</p></li><li><p>Next_Hop_IP - The next hop IP address of the link we query (\"0\" if multi-homed is not used)</p></li><li><p>Status - Status of a link (0=unknown, 1=alive, or 2=dead)</p></li></ul></li></ul></td></tr><tr><td><code>cluster_connections_nat</code></td><td><ul type=\"circle\"><li><p>On the inbound chain when we are at the decrypt chain handler we check whether the incoming packet is destined to the IKE port. If this is the case, along with the fact that we are in a cluster configuration we do need to NAT the connection (this is required for the IKE negotiation - it must see a specific IP with which it negotiates).</p></li><li><p>On the decrypt chain, a message is written, so when the policy chain sees it it will write to this table. In this manner, DoS attacks with spoofed packets that write to this table are avoided.</p></li><li><p>The policy chain checks if there is a message for us from the decrypt chain, which tells that this packet was NATed in the inbound direction. If so, we set this table to contain the pre-NAT destination IP address, to be used in the outbound direction, in order to return from that IP address.</p></li><li><p>Default expiration time is 600 seconds.</p></li><li><p>Not synchronized between cluster members.</p></li><li><p>Table entry: &lt;<em>Source_IP, Source_Port, Dest_IP, Dest_Port, Protocol; Original_IP_Address</em>&gt;, where:</p><ul type=\"square\"><li><p>Source_IP - The source IP address</p></li><li><p>Dest_IP - The destination IP address</p></li><li><p>Source_Port - The source port</p></li><li><p>Dest_Port - The destination port</p></li><li><p>Protocol - Protocol number</p></li><li><p>Original_IP_Address - The source IP address as seen on outbound packets</p></li></ul></li></ul></td></tr><tr><td><code>cryptlog_table</code></td><td><ul type=\"circle\"><li><p>Used to record kernel events - to indicate that a trap was issued to the vpnd daemon. The vpnd daemon will subsequently handle the request.</p></li><li><p>Default expiration time is 120 seconds.</p></li><li><p>Not synchronized between cluster members.</p></li><li><p>Table entry: &lt;<em>Source_IP, Source_Port, Dest_IP, Dest_Port, Protocol</em>&gt;, where:</p><ul type=\"square\"><li><p>Source_IP - The source IP address</p></li><li><p>Dest_IP - The destination IP address</p></li><li><p>Source_Port - The source port</p></li><li><p>Dest_Port - The destination port</p></li><li><p>Protocol - Protocol number</p></li></ul></li></ul></td></tr><tr><td><code>DAG_ID_to_IP</code></td><td><ul type=\"circle\"><li><p>Used when DAIP gateways have achieved IKE negotiation with the Security Gateway. For each such DAIP gateway, an association is kept between the ID, also called the \"bogus IP\", of the DAIP gateway as it appears in the database, to the real IP address, from which the negotiation was received. Each time a new negotiation is finalized from a DAIP gateway, the corresponding entry is created, or updated.</p></li><li><p>No expiration time.</p></li><li><p>Synchronized in cluster.</p></li><li><p>Table entry: &lt;<em>DAG_ID; DAG_IP</em>&gt;, where:</p><ul type=\"square\"><li><p>DAG_ID - ID of the DAIP gateway (a bogus IP address in the form 0.0.x.x)</p></li><li><p>DAG_IP - IP address that is currently assigned to the DAIP gateway</p></li></ul></li></ul></td></tr><tr><td><code>DAG_IP_to_ID</code></td><td><ul type=\"circle\"><li><p>Used when DAIP gateways have finalized IKE negotiations with the Security Gateway. This table contains the same information as <em>DAG_ID_to_IP</em>, but with the current IP address of the DAIP gateway as the key.</p></li><li><p>No expiration time.</p></li><li><p>Synchronized in cluster.</p></li><li><p>Table entry: &lt;<em>DAG_IP; DAG_ID</em>&gt;, where:</p><ul type=\"square\"><li><p>DAG_IP - IP address that is currently assigned to the DAIP gateway</p></li><li><p>DAG_ID - ID of the DAIP gateway (a bogus IP in the form 0.0.x.x)</p></li></ul></li></ul></td></tr><tr><td><code>decryption_pending</code></td><td><ul type=\"circle\"><li>Obsolete in R77.10 and higher.</li><li><p>Stores a connection 5-tuple for a connection, whose RDP negotiation has been completed and is ready.</p></li><li><p>Default expiration time is 120 seconds.</p></li><li><p>Not synchronized between cluster members.</p></li><li><p>Table entry: &lt;<em>Source_IP, Source_Port, Dest_IP, Dest_Port, Protocol; Key, Entry</em>&gt;, where:</p><ul type=\"square\"><li><p>Source_IP - The source IP address</p></li><li><p>Dest_IP - The destination IP address</p></li><li><p>Source_Port - The source port</p></li><li><p>Dest_Port - The destination port</p></li><li><p>Protocol - Protocol number</p></li><li><p>Key - Key that was generated from the FWZ key exchange protocol</p></li><li><p>Entry - Flags for logging purpose</p></li></ul></li></ul></td></tr><tr><td><code>encryption_requests</code></td><td><ul type=\"circle\"><li><p>Stores a connection 5-tuple of connections, for which traps are sent to the vpnd daemon to initiate the encryption. This is performed, to avoid sending multiple traps to the vpnd daemon for the same issue.</p></li><li><p>In the initiation phase of the encryption, connections that are to be encrypted are stored in this table, up to the point of actual encryption.</p></li><li><p>Default expiration time is 90 seconds.</p></li><li><p>Not synchronized between cluster members.</p></li><li><p>Table entry: &lt;<em>Source_IP, Source_Port, Dest_IP, Dest_Port, Protocol; Key, VPNConnType, ActionType, LogType, Error</em>&gt;, where:</p><ul type=\"square\"><li><p>Source_IP - The source IP address</p></li><li><p>Dest_IP - The destination IP address</p></li><li><p>Source_Port - The source port</p></li><li><p>Dest_Port - The destination port</p></li><li><p>Protocol - Protocol number</p></li><li><p>Key - Key generated by the FWZ key exchange protocol</p></li><li><p>VPNConnType - VPN Connection Type</p></li><li><p>ActionType - Action Type</p></li><li><p>LogType - VPN log level</p></li><li><p>Error - Error string if any</p></li></ul></li></ul></td></tr><tr><td><code>IKE_SA_table</code></td><td><ul type=\"circle\"><li><p>Contains information about all ISAKMP SAs.</p></li><li><p>Entries from this table are used to conduct IKE Quick Mode negotiation of IPsec SA.</p></li><li><p>Entries are extracted from this table when the vpnd daemon is trapped for IPsec SA renewal.</p></li><li><p>Default expiration time is 3600 seconds.</p></li><li><p>Synchronized in cluster.</p></li><li><p>Table entry is:</p><p>either<br>&lt;<em>Peer_IP ,0 , CookieI, CookieR; IKE_SA, IKE_SA_flag, RenegotiationTime; Timeout</em>&gt;</p><p>or</p><p>&lt;<em>Peer_IP, 0; IKE_SA, CookieI, CookieR, IKE_SA_flag, RenegotiationTime; Timeout</em>&gt;</p><p>where:</p><ul type=\"square\"><li><p>Peer_IP - IP address of IKE peer</p></li><li><p>CookieI - initiator cookie (8 bytes in host byte order)</p></li><li><p>CookieR - responder cookie (8 bytes in host byte order)</p></li><li><p>IKE_SA - ISAKMP SA data in Check Point code</p></li><li><p>IKE_SA_flag - one of these values: 0x01=mobile, 0x02=initiator, 0x03=DAIP</p></li><li><p>RenegotiationTime - The renegotiation time of the SA</p></li><li><p>Timeout - How much time remained to expiration time</p></li></ul></li></ul></td></tr><tr><td><code>ike2esp</code></td><td><ul type=\"circle\"><li><p>Holds IKE-to-ESP mappings for cookies.</p></li><li><p>No expiration time.</p></li><li><p>Not synchronized between cluster members.</p></li></ul></td></tr><tr><td><code>ike2peer</code></td><td><ul type=\"circle\"><li><p>Holds IKE-to-Peer mappings for cookies.</p></li><li><p>No expiration time.</p></li><li><p>Not synchronized between cluster members.</p></li></ul></td></tr><tr><td><code>inbound_SPI</code></td><td><ul type=\"circle\"><li><p>Contains all Inbound IPSec SAs (IKE negotiation results in such a SA).</p></li><li><p>Default expiration time is 3600 seconds.</p></li><li><p>Synchronized in cluster.</p></li><li><p>Table entry: &lt;<em>SPI; SA, Host_IP, UserPeer_Method, Peer_IP; Timeout</em>&gt;, where:</p><ul type=\"square\"><li><p>SPI - The inbound SPI</p></li><li><p>SA - The inbound SA that is pointed by the inbound SPI</p></li><li><p>Host_IP - The host IP address</p></li><li><p>UserPeer_Method - The User Peer method</p></li><li><p>Peer_IP - The peer IP address, with which the SA was established</p></li><li><p>Timeout - How much time remained to expiration time</p></li></ul></li></ul></td></tr><tr><td><code>initial_contact_pending</code></td><td><ul type=\"circle\"><li><p>Holds IKE cookies.</p></li><li><p>If we cannot establish an IKE-to-Peer mapping yet, these IKE cookies are marked for later processing. When an IPSEC SA for these IKE cookies is later written, they will be processed.</p></li><li><p>Default expiration time is 240 seconds.</p></li><li><p>Not synchronized between cluster members.</p></li></ul></td></tr><tr><td><code>ipalloc_tab</code></td><td><ul type=\"circle\"><li><p>This table is used to issue IP address lease extensions requests.</p></li><li><p>This can be done from either DHCP Server, or the IP Pool mechanism.</p></li><li><p>This table is used only by the L2TP modules, for which the Security Gateway is responsible for issuing the lease-extension requests, rather than the client.</p></li><li><p>Each entry in the table has the IP address lease time as the timeout of the entry.</p></li><li><p>When we see that half of the lease time has elapsed, a trap is given to the vpnd daemon to issue new extension request.</p></li><li><p>Default expiration time is 2147483647 seconds (2<sup>31</sup>-1), i.e., never expires.</p></li><li><p>Synchronized in cluster.</p></li><li><p>Table entry: &lt;<em>Client_MAC, IP_Alloc_Method, Last_Trap_Time;</em>&gt;, where:</p><ul type=\"square\"><li><p>Client_MAC - The client MAC address</p></li><li><p>IP_Alloc_Method - IP address allocation method (IP Pool, DHCP, etc.)</p></li><li><p>Last_Trap_Time - Time when the last trap to the vpnd daemon was made (to request IP address lease extension)</p></li></ul></li></ul></td></tr><tr><td><code>IPSEC_mtu_icmp</code></td><td><ul type=\"circle\"><li>Holds the source IP address and the destination IP address as found in packet that we want to encrypt for a predefined time, but the \"Don't Fragment\" Bit (DF) of the packet is set and the packet's expected size is larger than the host's MTU.</li><li>The above values are entered to this table in order to mark the MTU behavior of this source host.</li><li>The kernel will fragment packets as long as there is no need to send back ICMP Need-To-Fragment and that Src and Dst in the table match the one on the \"problematic\" packet.</li><li>The above behavior is desired in order to avoid as much as possible packet fragmentation in the kernel since it is a very resource-consuming task.</li><li>This table is tightly coupled with the <em>IPSEC_mtu_icmp_wait</em> table.</li><li>Default expiration time is 600 seconds.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>Source_IP, Dest_IP</em>&gt;, where:<br><ul type=\"square\"><li>Source_IP - The source IP address</li><li>Dest_IP - The destination IP address</li></ul></li></ul></td></tr><tr><td><code>IPSEC_mtu_icmp_wait</code></td><td><ul type=\"circle\"><li>This table was introduced to solve a behavior where we opened an IPsec connection from the machine itself (be it a FW machine or Remote Access machine), if the packet is too big and has the \"Don't Fragment\" Bit (DF), the VPN kernel sends an ICMP Need-To-Fragment packet to the machine's TCP/IP stack. This packet might not be processed correctly. The end result is the connection being stuck.</li><li>Holds the source IP address and the destination IP address as found in packet that we want to encrypt for a predefined time, but the \"Don't Fragment\" Bit (DF) of the packet is set and the packet's expected size is larger than the host's MTU.</li><li>The entries are held for a predefined time where within this time frame, we do generate ICMP Need-To-Fragment packet (for packets that had this DF bit and MTU limitation conflict). Those packets are rejected.</li><li>The above values are entered to this table in order to mark the MTU behavior of this source host.</li><li>This table is tightly coupled with the <em>IPSEC_mtu_icmp</em> table.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>Source_IP, Dest_IP</em>&gt;, where:<br><ul type=\"square\"><li>Source_IP - The source IP address</li><li>Dest_IP - The destination IP address</li></ul></li></ul></td></tr><tr><td><code>L2TP_lookup</code></td><td><ul type=\"circle\"><li>Represents an established L2TP session, with the lookup in reverse.</li><li>No expiration time.</li><li>Synchronized in cluster.</li><li>Table entry: &lt;<em>Assigned_IP; Peer_Port, Tunnel_ID, Session_ID, Peer_Tunnel_ID, Peer_Session_ID</em>&gt;, where:<br><ul type=\"square\"><li>Assigned_IP - IP address assigned to the peer</li><li>Peer_Port - UDP port of the peer (always 1701)</li><li>Tunnel_ID - Tunnel identifier assigned by us</li><li>Session_ID - Session identifier assigned by us</li><li>Peer_Tunnel_ID - Tunnel identifier assigned by peer</li><li>Peer_Session_ID - Session identifier assigned by peer</li></ul></li></ul></td></tr><tr><td><code>L2TP_MSPI_cluster_update</code></td><td><ul type=\"circle\"><li>Used in cluster to map MSPIs to peer, methods, IDs so that the matching MSPIs can be found.</li><li>Default expiration time is 600 seconds.</li><li>Synchronized in cluster.</li></ul></td></tr><tr><td><code>L2TP_sessions</code></td><td><ul type=\"circle\"><li>Represents an L2TP session.</li><li>No expiration time.</li><li>Synchronized in cluster.</li><li>Table entry: &lt;<em>Peer_IP, Peer_Port, Tunnel_ID, Session_ID; Status, Peer_Tunnel_ID, Peer_Session_ID, Timestamp, Assigned_IP, IPsec_MSPI, L2TP_MSPI, My_Object_IP, Cluster_Member_ID</em>&gt;, where:<br><ul type=\"square\"><li>Peer_IP - IP address assigned to the peer</li><li>Peer_Port - UDP port of the peer (always 1701)</li><li>Tunnel_ID - Tunnel identifier assigned by us</li><li>Session_ID - Session identifier assigned by us</li><li>Status - Status of session</li><li>Peer_Tunnel_ID - Tunnel identifier assigned by peer</li><li>Peer_Session_ID - Session identifier assigned by peer</li><li>Timestamp - Approximate time of last packet</li><li>Assigned_IP - Assigned IP address</li><li>IPsec_MSPI - MSPI used for decrypting messages</li><li>L2TP_MSPI - MSPI used for the session</li><li>My_Object_IP - My IP address (used for sync)</li><li>Cluster_Member_ID - Cluster member ID</li></ul></li></ul></td></tr><tr><td><code>L2TP_tunnels</code></td><td><ul type=\"circle\"><li>Represents an L2TP tunnel.</li><li>Default expiration time is 60 seconds.</li><li>Synchronized in cluster.</li><li>Table entry: &lt;<em>Peer_IP, Peer_Port, Tunnel_ID; Status, Peer_Tunnel_ID, Peer_Session_ID, Timestamp, Next_Outbound, Next_Expected_Outbound, Last_Inbound, Session_ID, IPsec_MSPI, My_Object_IP, Owner_IP, Cluster_Member_ID</em>&gt;, where:<br><ul type=\"square\"><li>Peer_IP - IP address assigned to the peer</li><li>Peer_Port - UDP port of the peer (always 1701)</li><li>Tunnel_ID - Tunnel identifier assigned by us</li><li>Status - Status of session</li><li>Peer_Tunnel_ID - Tunnel identifier assigned by peer</li><li>Peer_Session_ID - Session identifier assigned by peer</li><li>Timestamp - Approximate time of last packet</li><li>Next_Outbound - Message ID of next outbound message</li><li>Next_Expected_Outbound - Message ID of next outbound message expected by peer</li><li>Last_Inbound - Message ID of last received message</li><li>Session_ID - Session identifier assigned by us</li><li>IPsec_MSPI - MSPI used for decrypting messages</li><li>My_Object_IP - My IP address (used for sync)</li><li>Owner_IP - Owner's IP address</li><li>Cluster_Member_ID - Cluster member ID</li></ul></li></ul></td></tr><tr><td><code>MSPI_by_methods</code><p>In R80.10, this table<br>was replaced by the<br>global table called<br><code>meta_sas</code><br>(that also uses a<br>local cache table<br><code>local_meta_sas</code>)</p></td><td><ul type=\"circle\"><li>This table provides a way to access an actual SA, through MSA, which is pointed to by the MSPI.</li><li>Used by the vpnd daemon to decide whether a Meta SA (MSA) exists for a given set of methods, peers, and IDs.</li><li>For cluster synchronization, the Meta SPI (MSPI) is stored and not the MSA.</li><li>For mobile users, the user name on the MSA should also be verified to determine if the MSA is appropriate, and not just the peer, methods, and IDs.</li><li>Default expiration time is 2147483647 seconds (2<sup>31</sup>-1), i.e., never expires.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>Peer_IP, Method1, Method2, MyRangeFirstIP, MyRangeLastIP, PeerRangeFirstIP, PeerRangeLastIP; MSPI</em>&gt;, where:<br><ul type=\"square\"><li>Peer_IP - The peer IP address for which we want the MSPI (for SecuRemote - internal IP)</li><li>Method1 - The encryption and authentication methods for this peer gateway</li><li>Method2 - The encryption and authentication methods for this peer G</li><li>MyRangeFirstIP - The subnet's first IP address</li><li>MyRangeLastIP - The subnet's last IP address</li><li>PeerRangeFirstIP - The subnet's first IP address</li><li>PeerRangeLastIP - The subnet's last IP address</li><li>MSPI - The MSPI on this peer</li></ul></li></ul></td></tr><tr><td><code>MSPI_cluster_map</code></td><td><ul type=\"circle\"><li>Maps between MSPI on cluster peer members, to the MSPI on this cluster member.</li><li>This table is important in High Availability Single Entry Point (SEP) configurations.</li><li>Default expiration time is 2147483647 seconds (2<sup>31</sup>-1), i.e., never expires.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>Cluster_Peer_IP, My_MSPI; Peer_MSPI</em>&gt;, where:<br><ul type=\"square\"><li>Cluster_Peer_IP - The IP address of the cluster peer member</li><li>My_MSPI - The MSPI on this cluster member</li><li>Peer_MSPI - The MSPI on the cluster peer member</li></ul></li></ul></td></tr><tr><td><code>MSPI_cluster_update</code></td><td><ul type=\"circle\"><li>Used for synchronization of the MSPI numbers between the cluster members.</li><li>Each member has internal MSPI number that does not necessarily correspond to the MSPI number of the cluster peer members.<br>Therefore, MSPI needs to be translated from the MSPI of cluster peer member to the local MSPI.</li><li>When one of the cluster members creates a new MSPI, it writes it to this table.</li><li>Default expiration time is 600 seconds.</li><li>Synchronized in cluster.</li><li>Table entry: &lt;<em>Peer_Member_IP, Peer_Member_ID, Peer_MSPI; Methods</em>&gt;, where:<br><ul type=\"square\"><li>Peer_Member_IP - The IP address of cluster peer member</li><li>Peer_Member_ID - The ID cluster peer member</li><li>Peer_MSPI - MSPI of cluster peer member</li><li>Methods - Attribute of the methods that was used to create that MSPI on that cluster member</li></ul></li></ul></td></tr><tr><td><code>MSPI_cluster_reverse_map</code></td><td><ul type=\"circle\"><li>Used to map between MSPI on this cluster member to MSPI on cluster peer member.</li><li>This table is important in High Availability Single Entry Point (SEP) configurations.</li><li>Default expiration time is 2147483647 seconds (2<sup>31</sup>-1), i.e., never expires.</li><li>Synchronized in cluster.</li><li>Table entry: &lt;<em>Peer_Member_IP, My_MSPI; Peer_MSPI</em>&gt;, where:<br><ul type=\"square\"><li>Peer_Member_IP - The IP address of cluster peer member</li><li>My_MSPI - MSPI of this cluster member</li><li>Peer_MSPI - MSPI of cluster peer member</li></ul></li></ul></td></tr><tr><td><code>MSPI_req_connections</code></td><td><ul type=\"circle\"><li>Used with <em>MSPI_requests</em> table. A packet that arrives for a connection that has issued a request for an MSPI, either because it does not exist, or the underlying SA is expired, is dropped.</li><li>Entries are entered to this table when the first request is issued for an MSPI for a connection.</li><li>Default expiration time is 60 seconds.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>Source_IP, Source_Port, Dest_IP, Dest_Port, Protocol; Timeout</em>&gt;, where:<br><ul type=\"square\"><li>Source_IP - The source IP address</li><li>Dest_IP - The destination IP address</li><li>Source_Port - The source port</li><li>Dest_Port - The destination port</li><li>Protocol - Protocol number</li><li>Timeout - How much time remained to expiration time</li></ul></li></ul></td></tr><tr><td><code>MSPI_requests</code></td><td><ul type=\"circle\"><li>Holds a linked list of packet IDs, which are on hold for an MSPI.</li><li>This table records deferred packets, one per connection, which require an MSA that has not been received.</li><li>Default expiration time is 60 seconds.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>MSPI; PktIDList</em>&gt;, where:<br><ul type=\"square\"><li>MSPI - MSPI on this VPN peer</li><li>PktIDList - linked list of packet IDs</li></ul></li></ul></td></tr><tr><td><code>outbound_SPI</code></td><td><ul type=\"circle\"><li>Contains all Outbound IPSec SAs.</li><li>This table stores MSPI and initiator cookie. These value are accessed according to peer and SPI.</li><li>Default expiration time is 3600 seconds.</li><li>Synchronized in cluster.</li><li>Table entry: &lt;<em>Peer_IP, OutSPI; MSPI, CookieI, CookieR, SA_ID, UserPeerID, Cluster_Member_IP; Timeout</em>&gt;, where:<br><ul type=\"square\"><li>Peer_IP - The IP address of VPN peer</li><li>OutSPI - Outbound SPI</li><li>MSPI - The MSPI, with which this outbound SA is associated</li><li>CookieI - initiator cookie - helps identify the IKE SA used to negotiate the SA (this is useful when SA is about to expire and we want to renew it simply by employing IKE Phase 2 negotiation) (8 bytes in host byte order)</li><li>CookieR - responder cookie (8 bytes in host byte order)</li><li>SA_ID - outbound SA ID (it is <em>not</em> synchronized in Load Sharing mode, but created separately on each cluster member)</li><li>UserPeerID - user peer ID</li><li>Cluster_Member_IP - The IP address of cluster member that wrote the table entry</li><li>Timeout - How much time remained to expiration time</li></ul></li></ul></td></tr><tr><td><code>peer2ike</code></td><td><ul type=\"circle\"><li>Holds Peer-to-IKE mappings for cookies.</li><li>No expiration time.</li><li>Not synchronized between cluster members.</li></ul></td></tr><tr><td><code>peers_count</code></td><td><ul type=\"circle\"><li>Used store all the Gateway-to-Gateway peers, with which the local gateway maintains IPsec tunnels.</li><li>The table is mainly used by the licensing of VPN - to enforce the licensed number of IPsec tunnels.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>Peer_IP; Ref_Count</em>&gt;, where:<br><ul type=\"square\"><li>Peer_IP - The IP address of VPN peer</li><li>Ref_Count - Number of MSPIs with this VPN peer</li></ul></li></ul></td></tr><tr><td><code>persistent_tunnels</code></td><td><ul type=\"circle\"><li>Holds MSPIs of persistent IPsec tunnels.</li><li>This kernel table is related to \"<em>persistent_tunnels_ranges</em>\" table that is defined in <em>$FWDIR/lib/user.def</em> file on the Management Server (refer to <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk98239\" target=\"_blank\" rel=\"noopener\">sk98239</a>).</li><li>Default expiration time is 600 seconds.</li><li>Not synchronized between cluster members.</li></ul></td></tr><tr><td><code>rdp_dont_trap</code></td><td><ul type=\"circle\"><li>The VPN kernel picks up RDP packets on the outbound direction of the external interface. If the RDP packets carry an encryption command, this may lead to trapping the vpnd daemon. When a vpnd daemon is trapped for the RDP request, this is marked, to avoid sending multiple traps on the same issue.</li><li>Default expiration time is 60 seconds.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>Source_IP, Tag</em>&gt;, where:<br><ul type=\"square\"><li>Source_IP - The source IP address as appears in the RDP packet</li><li>Tag - The tag that is found in the RDP packet header</li></ul></li></ul></td></tr><tr><td><code>rdp_table</code></td><td><ul type=\"circle\"><li>Holds RDP connections in the following specific case: when two VPN peers perform encryption with one another, and there is a Security Gateway in the middle that needs to forward these RDP connections.</li><li>All RDP connections are inserted into this table on that Security Gateway in the middle.</li><li>Default expiration time is 60 seconds.</li><li>Not synchronized between cluster members.</li><li>Table entry is:<br>either<br>&lt;<em>Source_IP, Source_Port, Dest_IP, Dest_Port, Protocol</em>&gt;<br>or (format used by Remote Access clients)<br>&lt;<em>Source_IP, Dest_IP</em>&gt;<br>where:<br><ul type=\"square\"><li>Source_IP - The source IP address as appears in the RDP packet</li><li>Source_Port - The source port as appears in the RDP packet</li><li>Dest_IP - The destination IP address as appears in the RDP packet</li><li>Dest_Port - The destination port as appears in the RDP packet</li><li>Protocol - Protocol number as appears in the RDP packet</li></ul></li></ul></td></tr><tr><td><code>resolved_link</code></td><td><ul type=\"circle\"><li>This table holds the resolved link to the peer gateway.</li><li>The data in the table is always updated, i.e., the resolved link is always the best known alive link.</li><li>The resolved link is calculated using one of the following mechanisms: Single IP for VPN, topology calculation, DNS resolution, one time RDP probing, ongoing RDP probing (the probing is performed in the vpnd daemon).</li><li>Each one of the above configurations defined on the peer object can be combined with multi-homed configuration defined on the resolving initiator's object.</li><li>Note that the resolved link and the source IP address are updated at the end of successful IKE in case the resolving configuration is final and 'reply from same IP' is configured.</li><li>The peer's status (unknown, alive, or dead) is also set in this table (the status is known in multi-homed and in ongoing probing configurations).</li><li>Default expiration time is 2147483647 seconds (2<sup>31</sup>-1), i.e., never expires.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>Peer_IP; Source_IP, Dest_IP, Source IF, NextHop_IP, ExpectedPeer_IP, ExpectedPeer_Port, Flag, Status</em>&gt;, where:<br><ul type=\"square\"><li>Peer_IP - The main IP address of peer gateway</li><li>Source_IP - The source IP address set on the packet</li><li>Dest_IP - The destination IP address of resolved link to the peer gateway</li><li>Source IF - The source interface of resolved link to the peer gateway (\"-1\" if multi-homed is not used)</li><li>NextHop_IP - The next hop IP of resolved link to the peer gateway (\"0\" if multiple ISP is not used)</li><li>ExpectedPeer_IP - The expected IP address of the peer gateway</li><li>ExpectedPeer_Port - The expected port on the peer gateway</li><li>Flag - \"1\" = the resolved link is final, \"0\" = the resolved link may change</li><li>Status - Status of a link (0=unknown, 1=alive, or 2=dead)</li></ul></li></ul></td></tr><tr><td><code>Sep_my_IKE_packet</code></td><td><ul type=\"circle\"><li>Used for IKE forwarding in Load Sharing mode clusters.</li><li>If one cluster member initiates IKE negotiation, and another cluster member receives the answer, the IKE packet should be forwarded to the cluster member that initiated the IKE negotiation.</li><li>This table holds the IKE Initiator cookie including IKE Message ID (Message ID \"0\" means this is IKEv1 Phase 1).</li><li>When sending the IKE packet, the table is checked. If no entry exists, a new entry is set, and the table is synchronized.</li><li>When receiving the IKE packet, the table is checked. If no entry exists, the entry is set. Otherwise, the packet belongs to another cluster member, so it is forwarded according to the addresses set in the table.</li><li>Default expiration time is 120 seconds.</li><li>Synchronized in cluster.</li><li>Table entry: &lt;<em>CookieI, Message_ID; Cluster_Peer, IKE_Peer</em>&gt;, where:<br><ul type=\"square\"><li>CookieI - initiator cookie of the IKE negotiation (8 bytes in host byte order)</li><li>Message_ID - Message ID of the IKE negotiation</li><li>Cluster_Peer - Cluster member that handled the first IKE packet of this IKE negotiation</li><li>IKE_Peer - the VPN peer, with whom the cluster is performing IKE negotiation</li></ul></li></ul></td></tr><tr><td><code>SPI_requests</code></td><td><ul type=\"circle\"><li>Used by the VPN kernel to mark requests for SPI on behalf of a connection.</li><li>Requests for SPI result in IPsec SA negotiation, or renegotiation.</li><li>It is not necessary to trap the vpnd daemon more than once. The vpnd daemon is checked to see if it was already trapped for SPI, by querying this table.</li><li>This table is manipulated for scenarios where an SA is about to expire, already expired, or an SPI is received for which there is no SA yet. This can happen if packets arrive with an SPI, for which the daemon hasn't updated the tables with the corresponding SPI-to-SA.</li><li>Default expiration time is 60 seconds.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>Source_IP, SPI, SA_Type</em>&gt;, where:<br><ul type=\"square\"><li>Source_IP - The source IP address</li><li>SPI - The SPI request</li><li>SA_Type - Indicates whether it is IPSEC_AH_SA or IPSEC_ESP_SA request</li></ul></li></ul></td></tr><tr><td><code>udp_enc_cln_table</code></td><td><ul type=\"circle\"><li>Maintains a list of the destination ports and the IP address used for UDP encapsulation.</li><li>UDP encapsulation is agreed on during SA negotiation in the IKE daemon (vpnd).</li><li>When decrypting UDP encapsulated packet, the Security Gateway saves the port and the IP address of UDP packet for using it in encrypting process.</li><li>The parameters are saved on the MSPI, and when encrypting the outbound packet, the port and the IP address will be set on the UDP packet.</li><li>In cluster, the parameters should be synchronized to all cluster members. Since MSA is not synchronized, the parameters will be set in this table. The cluster members, during post-sync, will find the local MSPI according to the key of the table and will set the port and IP address into the local MSPI.</li><li>The values are entered to the table during decryption whenever the port and IP address are changed on the MSA. Therefore, there is always a fresh instance of the destination port for the encapsulating UDP packets.</li><li>Default expiration time is 900 seconds.</li><li>Synchronized in cluster.</li><li>Table entry: &lt;<em>MSPI, GW_IP; Source_Port, NAT_IP</em>&gt;, where:<br><ul type=\"square\"><li>MSPI - The MSPI on the cluster member</li><li>GW_IP - The IP address of Gateway that set the entry</li><li>Source_Port - The source port that the client uses</li><li>NAT_IP - The NATed IP address that is used for encapsulation (peer IP address)</li></ul></li></ul></td></tr><tr><td><code>udp_response_nat</code></td><td><ul type=\"circle\"><li>Enables translation of outbound IKE and RDP packets, so that their source IP address appears to be the same as the destination IP address of the original packets (previous inbound from the same peer).</li><li>Default expiration time is 30 seconds.</li><li>Synchronized in cluster.</li><li>Table entry: &lt;<em>Peer_IP, Peer_Port; My_IP</em>&gt;, where:<br><ul type=\"square\"><li>Peer_IP - The IP address of Security Gateway that assigned the IP address</li><li>Peer_Port - The source port of IKE or RDP request</li><li>My_IP - My IP address, taken from the inbound packet</li></ul></li></ul></td></tr><tr><td><code>VIN_SA_to_delete</code></td><td><ul type=\"circle\"><li>Holds the IPsec NIC SA data until the packet's reference countdown reaches 0.</li><li>Default expiration time is 30 seconds.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>VIN_SA_ID; NIC_Enc_Data</em>&gt;, where:<br><ul type=\"square\"><li>VIN_SA_ID - Running index</li><li>NIC_Enc_Data - IPsec NIC encryption data</li></ul></li></ul></td></tr><tr><td><code>vpn_active</code></td><td><ul type=\"circle\"><li>Maintains a flag indicating if the VPN module is active.</li><li>The table is created upon the initialization of the VPN module (policy installation).</li><li>No expiration time.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>Active_Flag</em>&gt;, where:<br><ul type=\"square\"><li>Active_Flag - \"1\" = active</li></ul></li></ul></td></tr><tr><td><code>vpn_routing</code></td><td><ul type=\"circle\"><li>Holds all the possible ranges that were defined for all Security Gateways.</li><li>This table is used in inbound and outbound policy chains when handling the first packet, to determine the peer gateway (peer + IDs) for IKE negotiation.</li><li>Community properties provide the methods, and <em>MSPI_by_methods</em> table provides the MSPI.</li><li>No expiration time.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>Range_From, Range_To; Peer_GW, Allowed_Peers_Table_ID, GW_Conf, Community_ID, Subnet_Support, Range_From, Range_To</em>&gt;, where:<br><ul type=\"square\"><li>Range_From - The range \"from\" IP address</li><li>Range_To - The range \"to\" IP address</li><li>Peer_GW - The peer gateway for this IP range</li><li>Allowed_Peers_Table_ID - Table ID of <em>allowed_peers</em> table</li><li>GW_Conf - Gateway configuration: Single gateway, MEP gateway, or DAIP gateway</li><li>Community_ID - The community ID common to the peer and installed on Security Gateway</li><li>Subnet_Support - is subnet supported</li><li>Range_From - The range \"from\" IP address</li><li>Range_To - The range \"to\" IP address</li></ul></li></ul></td></tr><tr><td><code>XPO_names</code></td><td><ul type=\"circle\"><li>Used when extranet partners are defined. It maps, for each partner, the XPO_ID, a UUID that is automatically assigned to each partner in the extranet, to a string ID that is used internally to write the name of the partner in the logs.</li><li>This table is initialized during the first policy load, and is updated each time a new policy is installed.</li><li>No expiration time.</li><li>Not synchronized between cluster members.</li><li>Table entry: &lt;<em>XPO_ID; Log_ID</em>&gt;, where:<br><ul type=\"square\"><li>XPO_ID - Extranet partner UUID</li><li>Log_ID - Log ID</li></ul></li></ul></td></tr></tbody></table>\n\n-   **Virtual Private Network (VPN)** \\- Technology that extends a private network across a public network, such as the Internet. It enables a computer or network-enabled device to send and receive data across shared or public networks as if it were directly connected to the private network, while benefiting from the functionality, security and management policies of the private network. A VPN is created by establishing a virtual point-to-point connection through the use of dedicated connections, virtual tunneling protocols, or traffic encryption.\n-   _**Encryption**_ - Process of encoding messages or information in such a way that only authorized parties can read it. _To encrypt a packet_ - means changing the contents of the packet using a cipher, so that only entities that knows it will be able to restore the contents of the packet to its original form. The cipher is created using encryption keys.\n-   _**Symmetric-key algorithm**_ - One key is used for both encryption and decryption of the information.\n-   _**Asymmetric-key algorithm**_ - Public-key cryptography, also known as asymmetric cryptography, is a form of cryptography, in which each party has a pair of cryptographic keys - a public key and a private key.\n    \n    The private key is kept secret, while the public key may be widely distributed:\n    \n    1.  So that other parties can send traffic encrypted and have the assurance that only the holder of the private key can open it (as opposed to sharing our private data).  \n        Note: Asymmetric encryption can thus be used for exchanging a symmetric key - the other party will generate it and send it to us encrypted with our public key.\n    2.  If data is encrypted with a private key, other parties can have assurance that the data was encrypted by a specific entity - the only holder of the private key. This is not for confidentiality purposes, as potentially everyone may hold the public key that can decrypt the data, but, rather, for the purpose of a digital signature.\n    \n      \n    The keys are related mathematically, but the private key cannot be practically derived from the public key. A message encrypted with the public key can be decrypted only with the corresponding private key.\n-   _**Security Association (SA)**_ - Establishment of shared security attributes between two network entities to support secure communication. An SA may include attributes such as: cryptographic algorithm and mode; traffic encryption key; and parameters for the network data to be passed over the connection. The framework for establishing security associations is provided by the Internet Security Association and Key Management Protocol (ISAKMP). Protocols such as Internet Key Exchange and Kerberized Internet Negotiation of Keys provide authenticated keying material. An SA is a simplex (one-way channel) and logical connection which endorses and provides a secure data connection between the network devices.\n-   _**Internet Protocol Security (IPsec)**_ - Protocol suite for securing Internet Protocol (IP) communications by authenticating and encrypting each IP packet of a communication session. IPsec includes protocols for establishing mutual authentication between agents at the beginning of the session and negotiation of cryptographic keys to be used during the session. IPsec uses cryptographic security services to protect communications over Internet Protocol (IP) networks.\n    \n    IPsec supports network-level peer authentication, data origin authentication, data integrity, data confidentiality (encryption), and replay protection. IPsec is an end-to-end security scheme operating in the Internet Layer of the Internet Protocol Suite, while some other Internet security systems in widespread use, such as Transport Layer Security (TLS) and Secure Shell (SSH), operate in the upper layers at Application layer. Hence, only IPsec protects any application traffic over an IP network.\n    \n    IPsec can be implemented in a host-to-host transport mode, as well as in a network tunneling mode:\n    \n    -   _Transport mode_ - Encrypting only the data layer of the original packet - only the payload of the IP packet is usually encrypted and/or authenticated. The routing is intact, since the IP header is neither modified nor encrypted. However, when the authentication header is used, the IP addresses cannot be translated, as this always will invalidate the hash value. The OSI Transport and OSI Application layers are always secured by hash, so they cannot be modified in any way (for example by translating the port numbers).  \n        A means to encapsulate IPsec messages for [NAT traversal (NAT-T)](https://en.wikipedia.org/wiki/NAT_traversal) has been defined by RFC documents describing the NAT-T mechanism.  \n        Summary:  \n        -   Protects Layers 4-7.\n        -   Keeps the original IP header.\n        -   Protects a connection between VPN peers.\n        -   Does not make sense for a perimeter gateway.\n    -   _Tunnel mode_ - the entire IP packet is encrypted and/or authenticated. It is then encapsulated into a new IP packet with a new IP header.  \n        Tunnel mode is used to create VPNs for network-to-network communications (e.g., between routers to link sites), host-to-network communications (e.g., remote user access) and host-to-host communications (e.g., private chat).  \n        Tunnel mode supports NAT traversal (NAT-T).  \n        Tunnel mode is used in Check Point Site-to-Site VPN and Check Point Client-to-Site VPN.  \n        Summary:  \n        -   Protects Layers 3-7.\n        -   Adds an encapsulating IP header.\n        -   Protects networks behind the VPN peers.\n-   _**Encapsulating Security Payload (ESP)**_ - Member of the IPsec protocol suite. In IPsec it provides origin authenticity, integrity and confidentiality protection of packets. ESP also supports encryption-only and authentication-only configurations.\n    \n    ESP operates directly on top of IP, using IP protocol number 50. ESP is a _portless_ protocol.  \n    ESP header contains the SPI and Sequence Number that must be incremented (by 1 for every packet sent) to allow the VPN peer to defend itself from \"Replay Attack\".\n-   _**NAT traversal (NAT-T)**, also known as **UDP Encapsulation**_ - Computer networking methodology with the goal to establish and maintain Internet protocol connections across gateways that implement network address translation (NAT). NAT traversal techniques are required for certain client-to-client network applications, such as peer-to-peer file sharing and Voice over IP. IPsec VPN clients use NAT-T in order to have Encapsulating Security Payload (ESP) packets traverse NAT.\n    \n    The ability to traverse NAT is achieved by UDP encapsulation of the ESP packets, which are portless by default.\n    \n    Using NAT-T will also encapsulate the IKE Quick Mode exchange packets, so they will be exchanged over UDP port 4500.\n    \n    To establish NAT-T, the initiator of the IKE negotiation must send a _NAT-D_ (NAT Discovery) payload (refer to [RFC 3947](https://tools.ietf.org/html/rfc3947#section-3.2) - Section 3.2) in the first packet and then the responder will do the same. This payload contains interface information to help the parties understand if their peer is behind NAT (if the source, from which the packets came is one of the peer's interfaces or not).\n    \n    Check Point VPN clients and SMB appliances (600/700/1100/1200R/1400/Edge), will initiate a negotiation with NAT-D payload, so NAT-T can be agreed on. However, Security Gateways currently support responding to negotiation with NAT-D payload, but do not initiate NAT-D themselves (The practical note is that if you have SMB appliance behind NAT - it should be behind _Hide_ NAT, so that the Central Gateway cannot initiate IKE connections to it, rather the Central Gateway would have to wait for the SMB appliance to start the IKE negotiation).\n-   _**IPsec SA**_ - The IP security architecture uses the concept of a security association as the basis for building security functions into IP. A security association is simply the bundle of algorithms and parameters (such as keys) that is being used to encrypt and authenticate a particular flow in one direction. In short, IPsec SA is a set of encryption and decryption keys, as well as other information that identifies the VPN tunnel. Therefore, in normal bi-directional traffic, the flows are secured by a pair of security associations.\n-   _**Security Parameter Index (SPI)**_ - Identification tag added to the header while using IPsec for tunneling the IP traffic. This tag helps the kernel discern between two traffic streams where different encryption rules and algorithms may be in use.  \n    The SPI (as per [RFC 2401](https://tools.ietf.org/html/rfc2401)) is an essential part of an IPsec Security Association (SA) because it enables the receiving system to select the SA under which a received packet will be processed. An SPI has only local significance, since it is defined by the creator of the SA; an SPI is generally viewed as an opaque bit string. However, the creator of an SA may interpret the bits in an SPI to facilitate local processing.  \n    In order to decide what protection is to be provided for an outgoing packet, IPsec uses the SPI, an index to the security association database (SADB), along with the destination address in a packet header, which together uniquely identify a security association for that packet. A similar procedure is performed for an incoming packet, where IPsec gathers decryption and verification keys from the security association database.\n-   _**MSPI**_ - \"Meta SPI\" = peer + methods + IDs.\n    \n    -   MSPI is not a standard concept and exists only in Check Point VPN kernel.\n    -   MSPI is actually a tunnel identifier. It is a local counter that uniquely identifies a tunnel on the _given_ machine.  \n        In cluster topology it needs to be translated from the MSPI of peer cluster member to the local MSPI.\n    -   MSPI is an index to the MSA (Meta SA), which contains fields common to all SAs with the same peer, methods, IDs, where:  \n        -   Peer - peer gateway IP address\n        -   Methods - per rule (community) parameters\n        -   IDs - client/server or their containing subnets\n    -   When a new IPsec tunnel is established, a new MSPI is created by, it get the next free MSPI number, and the MSPI counter is increased.\n    -   When an IPsec tunnel is closed, the MSPI counter is decreased.\n-   _**MSA**_ - \"Meta SA\".\n    \n    -   Contains:  \n        -   Methods\n        -   Encapsulation scheme (ESP, AH, UDP)\n        -   Encryption algorithm\n        -   Data integrity algorithm\n        -   Peer identity\n        -   Peer address\n        -   User name (for Remote Access client)\n        -   Intended use (IPsec IDs)\n        -   Access to Current usable SA (outbound only)\n    -   MSA is bi-directional.\n    -   Inbound SAs point to the MSA.\n    -   The MSA points to an outbound SA.\n    -   When SAs are rekeyed and replaced, the MSA is not. It is just updated.\n    -   An encrypted connection is marked with an MSPI (handle for the MSA).\n-   **Internet Key Exchange (IKE)** - Protocol used to set up a Security Association (SA) in the IPsec protocol suite. This process requires that the IPsec systems first authenticate themselves to each other and establish ISAKMP (IKE) shared keys. IKE builds upon the Oakley protocol and ISAKMP. IKE uses X.509 certificates for authentication - either pre-shared, or distributed using DNS (preferably with DNSSEC) and a Diffie-Hellman key exchange - to set up a shared session secret, from which cryptographic keys are derived. In addition, a security policy for every peer, which will connect must be manually maintained.\n    \n    All IKE packets are exchanged over UDP port 500. Some variations of the IKE protocol can be exchanged over TCP port 500.\n    \n    IKEv1 Phases (performed by _**vpnd**_ daemon):\n    \n    1.  **IKEv1 Phase 1** is where the two ISAKMP peers establish a secure, authenticated channel with which to communicate. This is called the ISAKMP Security Association (SA).\n        \n        The basic purpose of IKEv1 Phase 1 is to authenticate the IPsec peers and to set up a secure channel between the peers to enable IKEv1 exchanges. IKEv1 Phase 1 performs the following functions:\n        \n        -   Authenticates and protects the identities of the IPsec peers\n        -   Negotiates a matching IKE SA policy between peers to protect the IKE exchange\n        -   Performs an authenticated Diffie-Hellman exchange with the end result of having matching shared secret keys\n        -   Sets up a secure tunnel to negotiate IKEv1 Phase 2 parameters\n        \n        This negotiation results in one single bi-directional ISAKMP Security Association (SA). The authentication can be performed using either pre-shared key (shared secret), signatures, or public key encryption.\n        \n        Phase 1 operates in either _Main Mode_ (protects the identity of the peers), or _Aggressive Mode_ (does not protect the identity of the peers):\n        \n        -   _Main Mode_ is an instantiation of the ISAKMP Identity Protect Exchange. Main Mode has 3 two-way exchanges between the initiator and the receiver:\n            \n            -   First exchange:  \n                The 1st and the 2nd messages negotiate policy. The algorithms and hashes used to secure the IKE communications are agreed upon in matching IKE SAs in each peer.  \n                The 1st message is sent from the VPN peer (_initiator_), which initiates the IKE SA negotiation to VPN peer (_responder_), with which the VPN tunnel should be established.\n            -   Second exchange:  \n                The 3rd and the 4th messages exchange Diffie-Hellman public values and ancillary data (e.g., nonces) necessary for the exchange. Uses a Diffie-Hellman exchange to generate shared secret keying material used to generate shared secret keys and to pass nonces—random numbers sent to the other party and then signed and returned to prove their identity.\n            -   Third exchange:  \n                The 5th and the 6th messages authenticate the Diffie-Hellman Exchange. Verifies the other side's identity. The identity value is the IPsec peer's IP address in encrypted form. The main outcome of main mode is matching IKE SAs between peers to provide a protected pipe for subsequent protected ISAKMP exchanges between the IKE peers. The IKE SA specifies values for the IKE exchange: the authentication method used, the encryption and hash algorithms, the Diffie-Hellman group used, the lifetime of the IKE SA in seconds or kilobytes, and the shared secret key values for the encryption algorithms. The IKE SA in each peer is bi-directional.\n            \n            Main Mode packets:\n            \n            1.  MM packet 1 (sent in clear-text, not encrypted):  \n                Contains one or more propositions for IKE SA methods, including key length and strength (i.e., AES-256 bit encryption), IKE SA hash algorithms for securing IKE packets, authentication method (usually shared secret or certificate, relevant for Main Mode packets 5 and 6), Diffie-Helman group range for public key creation, and IKE SA lifespan - how long this SA will be valid\n            2.  MM packet 2 (sent in clear-text, not encrypted):  \n                Contains the chosen proposition from the list of propositions offered in Main Mode packet 1\n            3.  MM packet 3 (sent in clear-text, not encrypted):  \n                Contains the public key of the VPN gateway, generated according to the Diffie-Helman group range, as well as a request for certificate signed by a trusted Certificate Authority (if authentication type is by using certificates, decided in Main Mode packet 1 and Main Mode packet 2)\n            4.  MM packet 4 (sent in clear-text, not encrypted):  \n                Contains the public key of the VPN gateway - as well as a request for certificate signed by a trusted Certificate Authority (if authentication type is by using certificates, decided in Main Mode packet 1 and Main Mode packet 2)\n            5.  MM packet 5 (sent encrypted using the IKE SA):  \n                Used to authenticate the VPN peers to each other. Contains the authentication method (certificate-based or shared-secret based), and the authentication details themselves (a certificate or the shared passphrase).  \n                Also contains _ID_ field used for identification, in addition to the certificate/passphrase - ID is either the IP address, or the FQDN of the VPN gateway, which sent the packet (this field is _not_ used by Check Point; but can be used by some 3rd party vendors).  \n                -   If the IKE SA is authenticated using certificate, then MM packet 5 contains the VPN gateway's certificate and CRL list, if the VPN gateways authenticate to each other using a certificate signed by different CAs.\n                -   If the IKE SA is authenticated using shared secret, then in MM packet 5 the shared secret configured on each VPN gateway will be used.\n            6.  MM packet 6 (sent encrypted using the IKE SA):  \n                Contains the same data as MM packet 5.\n        -   _Aggressive Mode_ is an instantiation of the ISAKMP Aggressive Exchange. In Aggressive Mode, fewer exchanges are made, and with fewer packets. On the first exchange, almost everything is squeezed into the proposed IKE SA values: the Diffie-Hellman public key; a nonce that the other party signs; and an identity packet, which can be used to verify identity via a third party. The receiver sends everything back that is needed to complete the exchange. The only thing left is for the initiator to confirm the exchange. The weakness of using the Aggressive Mode is that both sides have exchanged information before there is a secure channel. Therefore, it is possible to \"sniff\" the wire and discover who formed the new SA. However, it is faster than Main Mode.\n            \n            Messages:\n            \n            -   1st and the 2nd messages:  \n                Negotiate policy, exchange Diffie-Hellman public values and ancillary data necessary for the exchange, and identities. In addition, the 2nd message authenticates the responder.\n            -   3rd message:  \n                Authenticates the initiator and provides a proof of participation in the exchange.\n    2.  **IKEv1 Phase 2** is where Security Associations are negotiated on behalf of services such as IPsec or any other service, which needs key material and/or parameter negotiation.\n        \n        During IKEv1 Phase 2, the IKE peers use the secure channel established in IKEv1 Phase 1 to negotiate Security Associations on behalf of other services like IPsec. The negotiation results in a minimum of two unidirectional Security Associations - one _inbound_ and one _outbound_:\n        \n        -   Inbound SA: How do I decrypt packets coming to me from the VPN peer?\n        -   Outbound SA: How do I encrypt packets going from me to the VPN peer?\n        \n        IKEv1 Phase 2 performs the following functions:\n        \n        -   Negotiates IPsec SA parameters protected by an existing IKE SA\n        -   Establishes IPsec security associations\n        -   Periodically renegotiates IPsec SAs to ensure security\n        -   Optionally performs an additional Diffie-Hellman exchange\n        \n        IKEv1 Phase 2 has one mode, called _Quick Mode_, which occurs after IKE has established the secure tunnel in IKEv1 Phase 1. It negotiates a shared IPsec policy, derives shared secret keying material used for the IPsec security algorithms, and establishes IPsec SAs. Quick Mode exchanges nonces that provide replay protection. The nonces are used to generate new shared secret key material and prevent replay attacks from generating bogus SAs:\n        \n        1.  Quick Mode packet 1:  \n            Contains one or propositions for IPsec SA. Similar to the Main Mode packet 1, here the VPN gateway proposes the key length and encryption type. By default, the key used in the IPsec SA is symmetric, but can be asymmetric, when Perfect Forward Secrecy (PFS) is enabled. If it is, than the keys will be asymmetric - and QM packet 1 will contain, similar to MM packet 1, a Diffie-Helman group type and a public key from that group. A hash algorithm proposal will also be sent. In addition to encryption details and methods, the QM contains subnet (IDs) of the hosts, to which that data should be encrypted / from which the data should be decrypted.\n        2.  Quick Mode packet 2:  \n            Contains the chosen proposition from the list of propositions offered in QM packet 1. By default, it also contains a symmetric key length and type, which the peer chose from the proposed list in QM 1 (i.e., AES 256-bit). If Perfect Forward Secrecy (PFS) is enabled, then the public key is sent here. In addition to encryption details and methods, the QM contains subnet (IDs) of the hosts, to which that data should be encrypted / from which the data should be decrypted.\n        3.  Quick Mode packet 3:  \n            Contains no real data; used for acknowledgment.\n        \n        Quick Mode is also used to renegotiate a new IPsec SA when the IPsec SA lifetime expires. Base Quick Mode is used to refresh the keying material used to create the shared secret key based on the keying material derived from the Diffie-Hellman exchange in IKEv1 Phase 1.\n        \n        Like the IKE SA, the IPsec SAs are unique between a pair of VPN gateways.\n    \n    Improvements with IKEv2:\n    \n    -   Fewer RFCs\n    -   Standard Mobility support\n    -   NAT traversal\n    -   SCTP support\n    -   Simple message exchange\n    -   Fewer cryptographic mechanisms\n    -   Reliability and State management\n    -   Denial of Service (DoS) attack resilience\n    \n    RFC:\n    \n    -   For IKEv1, refer to [RFC 2409](https://tools.ietf.org/html/rfc2409) and [RFC 4109](https://tools.ietf.org/html/rfc4109).\n    -   For IKEv2, refer to [RFC 7296](https://tools.ietf.org/html/rfc7296) and [RFC 7427](https://tools.ietf.org/html/rfc7427).\n-   _**IKE Security Association (IKE SA)**_ - Includes the following information:\n    \n    -   Encryption methods - key length and encryption algorithm - to use for encrypting the IPSEC SA negotiations - as well as type of hash algorithm for IKE packets authenticating\n    -   Peer IP - with which VPN gateway this IKE SA is valid\n    -   Authentication method - how the VPN gateways have authenticated to each other\n    -   Lifespan (life duration) - for how long the IKE SA, in seconds, will be valid. When an IKE SA will expire, it will be deleted and never used again\n    \n      \n    Unlike IPsec SAs, there can only be _one_ IKE SA between a pair of VPN peers (it is unique between the two VPN peers).\n-   _**IKE Authentication Methods**_ - Authentication methods used by VPN peers to authenticate themselves to each other during the IKEv1 Main Mode (generation of an IKE SA) negotiation:\n    \n    -   _Pre-Shared Secret_: A mutual password or pass phrase, which is configured in each VPN gateway.\n    -   _Certificate-based (RSA Signatures)_: Each VPN peer presents a certificate signed by a trusted Certificate Authority (CA).If the VPN peer trusts the CA, it will trust the VPN peer who presents a certificate signed by that CA. This is considered the most secured Authentication Method.\n    -   _Hybrid Mode (Hybrid init-RSA)_: A combination of both, also known as \"Challenge/Response\". Used primarily for Remote Access VPN sessions - VPN between a remote user and a VPN gateway. The VPN gateway presents a certificate to the user to identify itself, while the client is allowed to authenticate via some other means, such as username/password, SecurID, etc.\n-   _**Certificate**_ - Public key certificate (also known as a _digital certificate_ or _identity certificate_) is an electronic document used to prove ownership of a public key. The certificate includes information about the key, information about its owner's identity, and the digital signature of an entity that has verified the certificate's contents are correct. If the signature is valid, and the person examining the certificate trusts the signer, then they know they can use that key to communicate with its owner.\n-   _**Certificate Authority**_ - an entity that issues digital certificates. A digital certificate certifies the ownership of a public key by the named subject of the certificate. This allows others (relying parties) to rely upon signatures or on assertions made by the private key that corresponds to the certified public key. In this model of trust relationships, a CA is a trusted third party - trusted both by the subject (owner) of the certificate and by the party relying upon the certificate.\n    \n    Every deployment of Check Point Security Management Server / Multi-Domain Security Management Server server includes an Internal Certificate Authority (ICA) that issues VPN certificates for the VPN Gateways it manages. These VPN certificates simplify the definition of VPNs between these gateways.\n    \n    If the Security Gateways use certificates, the certificates can be issued either by the Internal Certificate Authority (ICA) on the Security Management Server, or by a third party OPSEC certified CA.  \n    The Internal CA makes it very easy to use PKI for Check Point applications such as site-to-site and remote access VPNs. However, an administrator may prefer to continue using a CA that is already used within the organization, for generalized applications such as secure email, and disk encryption.  \n    If the Security Gateways are both internally managed and use certificates for authentication, the easiest strategy is for both Security Gateways to present a certificate signed by the Internal CA.\n-   _**Certificate Revocation List (CRL)**_ - List of certificates (or more specifically, a list of serial numbers for certificates) that have been revoked, and therefore, entities presenting those (revoked) certificates should no longer be trusted. VPN can retrieve the CRL from either an HTTP server, or an LDAP server.\n    \n    Since the retrieval of CRL can take a long time (in comparison to the entire IKE negotiation process), VPN stores the CRLs in a CRL cache, so that later IKE negotiations do not require repeated CRL retrievals.  \n    The cache is pre-fetched:  \n    \n    -   every two hours\n    -   on policy installation\n    -   when the cache expires\n    \n      \n    If the pre-fetch fails, the previous cache is not erased.  \n    Note: The ICA requires the use of a CRL cache, and should never be disabled.\n-   _**Simple Certificate Enrollment Protocol (SCEP)**_ - Protocol used by numerous manufacturers of network equipment and software who are developing simplified means of handling certificates for large-scale implementation to everyday users, as well as being referenced in other industry standards.  \n    The protocol is designed to make the issuing of digital certificates as scalable as possible. The idea is that any standard network user should be able to request their digital certificate electronically and as simply as possible. These processes have usually required intensive input from network administrators, and so have not been suited to large scale deployments.  \n    SCEP is a Public Key Infrastructure (PKI) communication protocol used for communicating with Certificate Authorities. SCEP is the evolution of an enrollment protocol developed by VeriSign for Cisco Systems, and now enjoys wide support in both client and Certificate Authority implementations.  \n    SCEP is the most popular, widely available and most tested certificate enrollment protocol.\n-   _**Online Certificate Status Protocol (OCSP)**_ - Enables applications to identify the state of a certificate. OCSP may be used for more timely revocation information than is possible with CRLs and may also be used to obtain additional status information. When OCSP client issues a status request to an OCSP server, acceptance of the certificate in question is suspended until the server provides a response.  \n    In order to use OCSP, the root CA must be configured to use this method instead of CRL. This setting is inherited by the subordinate CA's.\n-   _**Perfect Forward Secrecy (PFS)**_ - Property of key-agreement protocols ensuring that a session key derived from a set of long-term keys cannot be compromised if one of the long-term keys is compromised in the future. The key used to protect transmission of data must not be used to derive any additional keys, and if the key used to protect transmission of data is derived from some other keying material, then that material must not be used to derive any more keys. In this way, compromise of a single key permits access only to data protected by that single key.  \n    If PFS is specified in the IPsec policy, a new Diffie-Hellman exchange is performed with each Quick Mode, providing keying material that has greater entropy (key material life) and thereby greater resistance to cryptographic attacks. Each Diffie-Hellman exchange requires large exponentiations, thereby increasing CPU utilization and exacting a performance cost.\n-   _**VPN Community**_ - Collection of VPN-enabled gateways capable of communicating via VPN tunnels (collection of VPN tunnels/links and their attributes).\n-   _**VPN Community member**_ - VPN Gateway that resides at one end of a VPN tunnel.\n-   _**VPN Site**_ - VPN Community member plus VPN Domain. A typical VPN site would be the branch office of a bank.\n-   _**VPN Domain (Encryption Domain)**_ - Refers to the hosts behind the VPN Gateway. The VPN Domain can be either the whole network that lies behind the VPN Gateway, or just a section of that network:\n    \n    -   The whole network behind the VPN-1 Gateway or just a section of that network.\n    -   Group of objects allowed to use VPN tunnel established by VPN-1 Gateway.\n    -   Allowed to be accessed by external peers using VPN tunnel.\n    -   Access to these objects is being managed by Security rulebase and VPN Community.\n    \n    The terms \"VPN Domain\" and \"Encryption Domain\" mean the same thing. Usually:\n    \n    -   \"VPN Domain\" is used in the context of Simplified Mode policies.\n    -   \"Encryption Domain\" for Traditional Mode policies.\n-   _**VPN Topology:**_\n    \n    -   _Meshed_ - VPN Community, in which VPN tunnels can be created between VPN gateway pairs. This means that every gateway communicates with every other gateway. Typical for Intranet gateways.\n    -   _Star_ - VPN Community composed of two types of peer, Central (Hub) and Satellite (Spoke), where:\n        -   Each central gateway can establish VPN tunnel with each satellite gateway\n        -   Satellite gateways cannot establish VPN tunnels with each other\n        -   Central gateways cannot establish VPN tunnel with each other by default, but this is configurable on the Central Gateways page\n-   _**VPN Modes:**_\n    \n    -   _Simplified VPN Mode_ - Interactions between Check Point Security Gateways are defined through VPN Communities. Access Control between Check Point Security Gateways is defined with regular Firewall Rule Base. The \"VPN\" column in the security policy is used to specify connections that pass through Community Members.  \n        Simplified Mode makes it possible to maintain and create simpler, and therefore less error prone and more secure VPNs.  \n        Simplified Mode separates the VPN definitions from the Access Control Security Policy - the Security Rule Base deals only with access control. In other words, the Rule Base determines only what is allowed. VPN properties, on the other hand, are dealt with per VPN community. This makes it easier to understand the VPN topology of an organization, and to understand which users are allowed to securely communicate with each other.  \n        In addition, _VPN Routing_ is supported only with a Simplified VPN Mode Security Policy.\n    -   _Traditional VPN Mode_ - VPN attributes are defined on the Check Point Security Gateways and Access Control between Check Point Security Gateways is configured by the rules governing encryption in the Firewall Rule Base. A single rule, with the \"Encrypt\" rule action, deals with both access control and encryption. VPN properties are defined per Security Gateway.  \n        Traditional policies allow VPNs to be created with greater granularity than Simplified policies, because:  \n        -   Whether or not to encrypt can be defined per rule (source, destination and service).\n        -   Simplified policies requires all the connections between two Security Gateways to encrypted using the same methods, using the Community definitions.\n-   _**Link Selection**_ - Method used to determine which interface is used for incoming and outgoing VPN traffic as well as the best possible path for the traffic.\n    \n    Link Selection mechanism helps the administrator define how two peer VPN gateways find the path to establishing a tunnel between them. Link Selection was designed to answer these questions:\n    \n    1.  Which IP address of the peer gateway should be used to establish the tunnel?\n    2.  Which interface and next hop gateway should be used to reach that IP address?\n    3.  Which IP address of the local gateway should be used as the source IP on the outgoing tunneled traffic (i.e. the encapsulating tunnel headers and tunnel establishment packets)?\n    \n      \n    Link Selection has many configuration options to enable you to control VPN traffic.  \n    Note: The administrator can choose, which IP addresses are used for _IKE_ and _RDP_ traffic, but not for the actual encrypted traffic (ESP).\n-   _**VPN Routing**_ - Way of directing communication through a specific VPN tunnel in order to enhance existing connectivity or security. In addition, VPN routing can be used to reduce connectivity costs.\n    \n    -   _Domain Based VPN_ - VPN traffic is routed within the VPN community based on the encryption domain behind each Security Gateway in the community.  \n        In a Star community, this allows satellite Security Gateways to communicate with each other through central Security Gateways.  \n        Configuration for Domain Based VPN is performed directly through SmartDashboard.\n    -   _Route Based VPN_ - VPN traffic is routed within the VPN community based on the routing information, static or dynamic, configured on the Operating Systems of the Security Gateways.\n    \n    SmartDashboard configuration allows routing the traffic between Satellites via the Center and between Satellites and the Internet (route all traffic via the center). \"Manual\" routing configuration is available via the _$FWDIR/conf/vpn\\_route.conf_ file on the Security Management Server.\n    \n    Notes:\n    \n    -   VPN Routing is supported only with a Simplified VPN Mode Security Policy.\n    -   If both Domain Based VPN and Route Based VPN are configured, then _Domain Based VPN_ will take precedence.\n-   _**$FWDIR/conf/vpn\\_route.conf**_ - configuration file on Security Management Server / Domain Management Server used for granular control over Domain Based VPN routing between Security Gateways.\n    \n    Notes:\n    \n    -   The file format is: _Destination_, _Next hop router_, _Install on Security Gateway_, _Force Override_ (optional field)\n    -   Fields must be separated by _tabs_.\n    -   All entries must be objects that exist in the Management database. The names must match object names exactly.\n-   _**Directional VPN**_ - VPN Match Condition in security policy that enables VPN traffic in one direction only.\n-   _**Internally Security Gateway and Externally Managed Security Gateway**_ - The Security Gateways at each end of a VPN tunnel can be managed by the same Security Management Server or by different Security Management Servers:\n    \n    -   A Security Gateway that is managed by the given Security Management Server is called an _internal_ Security Gateway.\n    -   A Security Gateway that is managed by a different Security Management Server is called an _external_ Security Gateway.\n-   _**Permanent Tunnel**_ - VPN tunnel that is constantly kept active and as a result, make it easier to recognize malfunctions and connectivity problems. Administrators can monitor the two sides of a VPN tunnel, and identify problems without delay.\n-   _**Tunnel Testing**_ - Check Point uses a proprietary protocol to test if VPN tunnels are active, and supports any Site-to-Site VPN configuration. Tunnel testing requires two Security Gateways, and uses UDP port 18234.  \n    Note: Check Point tunnel testing protocol is supported only by Check Point gateway.  \n    Tunnel Testing protocol packet types:  \n    -   Tunnel Test (type 1) - \"ping\" (if RIM is configured, then this packet tells the MEP member that it is the \"chosen one\", so it knows to inject the routes accordingly)\n    -   Tunnel Test Reply (type 2) - reply to the \"ping\"\n    -   Tunnel Test Connect (type 3) - used to initiate IKE by SecuRemote/SecureClient\n    -   Tunnel Test Connected (type 4) - indicates tunnel establishment\n-   _**Dead Peer Detection (DPD)**_ - In addition to _Tunnel Testing_, Dead Peer Detection (DPD) is a different method to test if VPN tunnels are active. Dead Peer Detection does support 3rd party Security Gateways and supports Permanent Tunnels with interoperable devices based on either IKEv1 DPD (based on [RFC 3706](https://tools.ietf.org/html/rfc3706)), or IKEv2 DPD. It uses IPsec traffic patterns to minimize the number of messages required to confirm the availability of a peer.\n    \n    The Tunnel Testing mechanism is the recommended keepalive mechanism for \"Check Point\"-to-\"Check Point\" VPN gateways because it is based on IPsec traffic and requires an IPsec established tunnel. DPD is based on IKE encryption keys only.\n    \n    DPD has two modes:\n    \n    -   _DPD responder mode_ - Check Point gateway sends the IKEv1 DPD Vendor ID to VPN peers, from which the DPD Vendor ID was received.\n    -   _Permanent tunnel mode based on DPD_ - DPD can monitor remote peers with the permanent tunnel feature. All related behavior and configurations of permanent tunnels are supported.  \n        To configure DPD for a permanent tunnel, the permanent tunnel must be in the VPN community. After you configure the permanent tunnel, configure Permanent Tunnel mode Based on DPD.  \n        There are different possibilities for permanent tunnel mode:  \n        \n        -   _tunnel\\_test_ (default) - The permanent tunnel is monitored by Tunnel Test (as in earlier versions). It works between Check Point gateways only. Keepalive packets are always sent.\n        -   _dpd_ - The active DPD mode. A VPN peer receives DPD requests at regular intervals (10 seconds). DPD requests are only sent when there is no traffic from the VPN peer.\n        -   _passive_ - The passive DPD mode. VPN peers do not send DPD requests to this VPN peer. Tunnels with passive peers are monitored only if there is IPsec traffic and incoming DPD requests.\n        \n          \n        Notes:  \n        -   Requires a Security Gateway R77.10 and higher.\n        -   Requires a Security Management Server / Multi-Domain Security Management Server R77.10 and higher.\n        -   This feature is supported in R75.40VS with LTE Hotfix / R76 with LTE Hotfix.\n        -   To use this mode for only some gateways, enable the DPD Responder Mode on Check Point remote peers.\n-   _**Route Injection Mechanism (RIM)**_ - Enables a Security Gateway to use a Dynamic Routing protocol to propagate the encryption domain of a VPN peer Security Gateway to the internal network. When a VPN tunnel is created, RIM updates the local routing table of the Security Gateway to include the encryption domain of the VPN peer.\n    \n    RIM is used to:\n    \n    -   Route return packets through the correct VPN link or VPN gateway\n    -   Overcome VPN link down time\n    \n    RIM is based both on the ability of the Security Gateway to update its local routing table, and the presence of the a Dynamic Routing protocol to distribute the change to the network behind the Security Gateway. There is little sense in enabling RIM on the Security Gateway if a Dynamic Routing protocol is not available to distribute changes.\n    \n    For example, when a VPN link becomes unavailable, an alternative path is added or \"injected\" to the local routing table on the VPN gateway. If a Dynamic Routing protocol is then configured, this change is propagated to the network behind the VPN gateway. Route injection can be integrated with MEP functionality, providing an alternative to IP Pool NAT in situations where large numbers of static IP addresses are not available.\n    \n    There are two possible methods to configure RIM:\n    \n    -   _Automatic RIM_ - RIM automatically injects the route to the encryption domain of the peer Security Gateways.\n    -   _Custom Script_ - Specify tasks for RIM to perform according to specific needs.\n    \n    Injecting Peer Security Gateway Interfaces (the _RIM\\_inject\\_peer\\_interfaces_ flag) is used to inject into the routing tables the IP addresses of the peer Security Gateway in addition to the networks behind the Security Gateway.\n    \n    Notes:\n    \n    -   Route Injection is _not_ supported with 3rd party gateways.\n    -   Route Injection is _not_ currently supported for IPv6.\n    -   RIM is _not_ available when MEP Selection Method is set to \"Random Selection\".\n-   _**Single Entry Point (SEP) VPN**_ - There is a single entry point from the Internet to the internal network, at which two or more Security Gateways are situated (these Security Gateways are members of a cluster with enabled state synchronization).\n    \n    SEP VPN provides a High Availability and Load Sharing solution for VPN connections at single entry point.\n-   _**Multiple Entry Points (MEP) VPN**_ - There are multiple geographically-separated entry points from the Internet to the internal networks, with a Security Gateway at each entry point.\n    \n    MEP VPN provides a High Availability and Load Sharing solution for VPN connections. Integral part of a VPN Star community. Any Star Community with more than one central gateway can enable MEP, providing multiple entry points to the core network behind the VPN gateways.\n    \n    There are four MEP Selection Methods of selecting to entry point to the core network:\n    \n    -   _First to Respond_ - Select the closest gateway to source - the first Security Gateway to reply to the peer Security Gateway is chosen.\n    -   _VPN Domain_ - Select the closest gateway to destination - when the destination IP address belongs to a particular VPN domain, the Security Gateway of that domain becomes the chosen entry point.\n    -   _Random Selection_ - different Security Gateway is randomly selected as an entry point for incoming traffic (for load distribution).\n    -   _Manually set priority list_ - Security Gateway priorities can be set manually for the entire community or for individual satellite Security Gateways (MEP rules).\n    \n    MEP is implemented via a proprietary Check Point Reliable Datagram Protocol (RDP) packets sent to UDP port 259 to discover whether an IP address is reachable (these UDP RDP packets are not encrypted, and only test the availability of a peer). This protocol does _not_ conform to RDP as specified in RFC 908/1151. The _**vpnd**_ daemon is in charge of the probing and path choosing operations.\n    \n    There are two available methods to implement MEP:\n    \n    -   _Explicit MEP_ - Only Star communities with more than one central Security Gateway can enable explicit MEP, providing multiple entry points to the network behind the Security Gateways. When available, Explicit MEP is the recommended method.  \n        In a site to site Star VPN community, explicit MEP is configured via the community object. When MEP is enabled, the satellites consider the \"unified\" VPN domain of all the Security Gateways as the VPN domain for each Security Gateway. This unified VPN domain is considered the VPN domain of each Security Gateway.  \n        Explicit MEP supports four MEP Selection Methods:  \n        -   First to Respond\n        -   VPN Domain\n        -   Random Selection\n        -   Manually set priority list\n    -   _Implicit MEP_ - Implicit MEP is supported in all scenarios where fully or partially overlapping encryption domains exist or where Primary-Backup Security Gateways are configured.  \n        Implicit MEP is supported if the Security Gateways with overlapping encryption domains are in the same community. If they are located in different communities, only one of the Security Gateways will be used for this encryption domain.  \n        Implicit MEP supports three MEP Selection Methods:  \n        -   First to Respond\n        -   Primary-Backup\n        -   Load Distribution (Random Selection)\n-   _**IP Pool NAT**_ - Type of NAT, in which source IP addresses from remote VPN domains are mapped to an IP address drawing from a pool of registered IP addresses.  \n    In order to maintain symmetric sessions using MEPed Security Gateways, the MEPed Security Gateway performs NAT using a range of IP addresses dedicated to that specific Security Gateway and should be routed within the internal network to the originating Security Gateway.  \n    When the returning packets reach the Security Gateway, the Security Gateway restores the original source IP address and forwards the packets to the source.\n-   _**Wire Mode**_ - Allows traffic to be encrypted, but avoid inspection between peers of the VPN community. Using Wire Mode, the FireWall can be bypassed for VPN connections by defining internal interfaces and communities as \"trusted\".\n    \n    When a packet reaches a Security Gateway, the Security Gateway asks itself two questions regarding the packet(s):\n    \n    -   Is this information coming from a \"trusted\" source?\n    -   Is this information going to a \"trusted\" destination?\n    \n      \n    If the answer to both questions is _yes_, and the VPN Community to which both Security Gateways belong is designated as \"Wire Mode enabled\", stateful inspection is not enforced and the traffic between the trusted interfaces bypasses the firewall. Since no stateful inspection takes place, no packets can be discarded.\n-   _**Large Scale VPN (LSV)**_ - Lets the administrator define a VPN with many VPN peers without defining a network object for each VPN peer. Administrator defines one LSV Profile for all potential VPN peers. It is possible to create more than one LSV profile, one for each CA. The LSV Profile and the Security Gateways must be members of the same VPN community.  \n    (Note: Refer to section \"Limitations related to VPN\")\n-   _**VPN Tunnel Interface (VTI)**_ - Virtual Interface on a Security Gateway that is related to a VPN tunnel and connects to a remote VPN peer. You create a VTI on each Security Gateway that connects to the VTI on a remote VPN peer. Traffic routed from the local Security Gateway via the VTI is transferred encrypted to the associated peer Security Gateway.\n    \n    A Virtual Interface behaves like a Point-to-Point interface directly connected to the remote VPN peer. Traffic between network hosts is routed into the VPN tunnel using the IP routing mechanism of the Operating System.  \n    Security Gateway objects are still required, as well as VPN communities (and access control policies) to define which tunnels are available. However, VPN encryption domains for each peer Security Gateway are no longer necessary. The decision whether or not to encrypt depends on whether the traffic is routed through a virtual interface.  \n    The routing changes dynamically if a dynamic routing protocol (OSPF/BGP) is available on the network.\n    \n    The VTI can be configured in two ways:\n    \n    -   _Numbered_ - Local IP address and remote IP address are configured for each numbered VPN Tunnel Interface (VTI). For each Security Gateway, the following are configured: a local IP address, a remote address, and the local IP address source for outbound connections to the tunnel. The remote IP address must be the local IP address on the remote peer Security Gateway. More than one VTI can use the same IP Address, but they cannot use an existing physical interface IP address.\n    -   _Unnumbered_ - For unnumbered VTIs, a proxy interface is defined for each Security Gateway. Each Security Gateway uses the proxy interface IP address as the source for outbound traffic. Unnumbered interfaces let administrator assign and manage one IP address for each interface. Proxy interfaces can be physical or loopback interfaces.\n    \n    VTIs allow the ability to use Dynamic Routing Protocols to exchange routing information between Security Gateways. The supported Dynamic Routing Protocols are:\n    \n    -   OSPF\n    -   BGP4\n    \n    For more information, see the [Gaia Administration Guide](https://support.checkpoint.com/product/73) for the relevant version > \"Network Management\" > \"Network Interfaces\" > \"VPN Tunnel Interfaces\".\n    \n\n<table><tbody><tr><td>Feature / Configuration</td><td>Limitation</td></tr><tr><td>IPv6</td><td><ul type=\"circle\"><li>Refer to <a href=\"https://sc1.checkpoint.com/documents/R77/CP_R77_VPN_AdminGuide/13868.htm#o95044\" target=\"_blank\" rel=\"noopener\">this list</a>.</li><li>On 40000 / 60000 Security System with VPN, you must configure IPv6 for at least one interface when IPv6 is enabled.</li></ul></td></tr><tr><td>VPN Routing</td><td><ul type=\"circle\"><li>Supported <em>only</em> with a Simplified VPN Mode Security Policy.</li></ul></td></tr><tr><td>Traditional Mode VPN</td><td><ul type=\"circle\"><li><em>Not</em> supported by CoreXL (if configured in SmartConsole, then CoreXL acceleration will be automatically disabled on the Security Gateway).</li><li><em>Not</em> supported on 40000 / 60000 Security System.</li><li><em>Not</em> supported in 1100 / 1200R / 1400 appliances running R77.20.X firmware (applies only to Centrally Managed).</li></ul></td></tr><tr><td>Check Point Tunnel Testing protocol</td><td><ul type=\"circle\"><li>Supported <em>only</em> for Check Point gateways and appliances.</li></ul></td></tr><tr><td>Externally managed Check Point gateway</td><td><ul type=\"circle\"><li>In VPN with an externally managed Check Point gateway with disabled \"supernetting\", IPsec SA is created per host, but not per-subnet.</li></ul></td></tr><tr><td>Dead Peer Detection (DPD)</td><td><ul type=\"circle\"><li>In \"<em>Permanent tunnel mode based on DPD</em>\" mode:<br><ul type=\"square\"><li>Requires a Security Gateway R77.10 and higher.</li><li>Requires a Security Management Server / Multi-Domain Security Management Server R77.10 and higher.</li><li>This feature is supported in R75.40VS with LTE Hotfix / R76 with LTE Hotfix.</li></ul></li><li><em>Not</em> supported in 600 / 700 / 1100 / 1200R / 1400 appliances running R75.20.X / R77.20.X firmware (applies to both Locally and Centrally Managed).</li></ul></td></tr><tr><td>Route Injection Mechanism (RIM)</td><td><ul type=\"circle\"><li>RIM is <em>not</em> supported with 3rd party gateways.</li><li>RIM is <em>not</em> supported for IPv6.</li><li>RIM is <em>not</em> available when MEP Selection Method is set to \"Random Selection\".</li></ul></td></tr><tr><td>Large Scale VPN (LSV)</td><td><ul type=\"circle\"><li>Supported in R81</li><li>Supported in R80.40</li><li>Not supported in R80.10, R80.20, and R80.30</li><li>Supported in R77.30.</li><li>Supported in R77.10 LTE Hotfix (<a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk100446\" target=\"_blank\" rel=\"noopener\">sk100446</a>).</li><li>Supported in R76 LTE Hotfix (<a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk95768\" target=\"_blank\" rel=\"noopener\">sk95768</a>).</li></ul></td></tr><tr><td>VPN Tunnel Interface (VTI)</td><td><ul type=\"circle\"><li>Numbered VTI is supported&nbsp;</li><li>Unnumbered VTI is supported&nbsp;</li><li>Unnumbered VTI is <em>not</em> supported in 600 / 1100 appliances running R75.20.X firmware.</li><li>VTI is <em>not</em> supported on 40000 / 60000 Security System.</li><li>VTI interfaces are not supported in VSX mode.</li><li>QoS is <em>not</em> supported (<a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk34086\" target=\"_blank\" rel=\"noopener\">sk34086</a>).</li></ul></td></tr><tr><td>VPN Shell for creating VTI</td><td><ul type=\"circle\"><li><em>Not</em> supported (use <em>show vpn</em>, <em>add vpn</em>, and <em>delete vpn</em> commands).</li></ul></td></tr><tr><td>40000 / 60000 Security Systems</td><td><ul type=\"circle\"><li>Traditional VPN mode is <em>not</em> supported.</li><li>Per-gateway VPN is <em>not</em> supported.</li><li>Virtual Tunnel Interfaces (VTI) are <em>not</em> supported.</li><li>IPSec VPN Link Selection Limitations:<br><ul type=\"square\"><li>IP Selection by Remote Peer - supports only the 'Selected address from topology table' option.</li><li>Outgoing Route Selection - supports only the 'Operating system routing table' option.</li><li>Route based probing configuration is not supported for VPN Link Selection High Availability.</li></ul></li><li>For VPN, you must configure IPv6 for at least one interface when IPv6 is enabled.</li><li>SecureXL Templates for encrypted traffic are not supported.</li></ul></td></tr><tr><td>600 / 700 / 1100 / 1200R / 1400 appliances<br>running <em><strong>R77.20.X</strong></em> firmware</td><td><ul type=\"circle\"><li>Traditional VPN mode is <em>not</em> supported in Centrally Managed mode.</li><li>Dead Peer Detection (DPD) is <em>not</em> supported in Centrally Managed and Locally Managed modes of the appliances.</li><li>The combined use of IKEv2 and IKEv1 Aggressive Mode is <em>not</em> supported.</li><li>Permanent Tunnels are <em>not</em> available when the VPN Site-to-Site configuration uses IKEv2 and one of the VPN sites has a dynamically allocated IP address (DAIP).</li><li>When the external interface is used as a Bridge to local networks, VPN Site-to-Site traffic is <em>not</em> supported.</li><li>For more information, refer to <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk105380\" target=\"_blank\" rel=\"noopener\">sk105380 - Check Point R77.20 for 600 / 700 / 1100 / 1200R / 1400 Appliance Known Limitations</a></li></ul></td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:09.736Z","annotations":[],"updated":"2025-05-06T22:58:39.376Z"},{"title":"Check Point Threat Emulation File Analyzer Configuration","id":"9a14667e-f5d5-47ab-a71d-6ae38c766da2","type":"TEXT","raw":"ProductThreat Emulation\n\nVersionR77.30 (EOS), R80.10 (EOS), R80.20 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nOSGaia\n\nLast Modified2022-12-06\n\n## Solution\n\n### Introduction:\n\nStarting in [Engine Update 6.1](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk95235) (released on 25 Sep 2016), File Analyzer was added to Threat Emulation blade.\n\n### Threat Emulation File Analyzer functions are:\n\n-   Inspection of embedded files and links\n-   Blocking encrypted documents\n-   Blocking documents that contain sensitive links\n-   Blocking documents that contain macros and code\n-   Blocking specific embedded file types\n\n### Threat Emulation File Analyzer features:\n\n-   Inspection of embedded files and links - enabled by default.\n-   Blocking encrypted documents - disabled by default.\n-   Blocking documents that contain sensitive links (links to local or network path) - disabled by default.\n-   Blocking documents that contain macros and code - disabled by default.\n-   Blocking specific embedded file types - disabled by default.\n\n### Threat Emulation File Analyzer limitations:\n\n-   Supported from R77.30 version and above.\n-   Supported on Gaia OS only.\n\n### Configuration:\n\nThe File Analyzer is configured using the _tecli advanced analyzer_ commands.\n\n-   _tecli advanced analyzer show_ = displays the current configuration of the file analyzer\n-   _tecli advanced analyzer enable <1|0>_ = enables (1) or disables (0) the file analyzer investigator\n-   _tecli advanced analyzer max\\_embedded\\_files\\_limit_ = sets the maximal number of embedded files to be scanned\n-   _tecli advanced analyzer max\\_embedded\\_links\\_limit_ = set the maximal number of embedded links to be scanned\n-   _tecli advanced analyzer prohibited ..._ = controls blocking of various documents  \n    -   _tecli advanced analyzer prohibited encrypted <1|0>_ = enables (1) or disables (0) blocking of encrypted documents\n    -   _tecli advanced analyzer prohibited sensitive <1|0>_ = enables (1) or disables (0) blocking of documents that contain sensitive links (links to local, or network path)\n    -   _tecli advanced analyzer prohibited macro <1|0>_ = enables (1) or disables (0) blocking of documents that contain macros and code\n    -   _tecli advanced analyzer prohibited word <1|0>_ = enables (1) or disables (0) blocking of documents with embedded Word file type\n    -   _tecli advanced analyzer prohibited excel <1|0>_ = enables (1) or disables (0) blocking of documents with embedded Excel file type\n    -   _tecli advanced analyzer prohibited power\\_point <1|0>_ = enables (1) or disables (0) blocking of documents with embedded Power Point file type\n    -   _tecli advanced analyzer prohibited executable <1|0>_ = enables (1) or disables (0) blocking of documents with embedded executable `*.exe` file type\n    -   _tecli advanced analyzer prohibited zip\\_em <1|0>_ = enables (1) or disables (0) blocking of documents with embedded `*.zip` file type\n    -   _tecli advanced analyzer prohibited flash <1|0>_ = enables (1) or disables (0) blocking of documents with embedded Flash file type\n    -   _tecli advanced analyzer prohibited pdf <1|0>_ = enables (1) or disables (0) blocking of documents with embedded `*.pdf` file type\n    -   _tecli advanced analyzer prohibited js <1|0>_ = enables (1) or disables (0) blocking of documents with embedded JavaScript `*.js` file type\n\n**Instructions:**\n\nNote: In cluster environment, this procedure must be performed on _all_ members of the cluster.\n\n1.  Connect to the command line on Security Gateway\n2.  Log in to the Gaia Clish\n3.  Configure the desired setting  \n    Example: _tecli advanced analyzer prohibited encrypted 1_\n4.  Save the changes in Gaia Database:  \n    _save config_\n\n## Article Properties\n\nOriginatorDima Kupershmidt\n\nTechnical ResourceGil Geron\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2016-07-11\n\nLast Modified2022-12-06\n\nEditorGil Frantsus\n\nLast ApproverAlexander Goldberg\n\n## Comments\n\n#### Internal only\n\nSK is referenced in output of \"tecli advanced\" on R81.10 as well:\n\nCommand: root->advanced  \nAvailable options:  \n  \\[...\\]  \n  analyzer        - file analyzer menu - inspection of embedded files and links **(sk112312)**  \n  \\[...\\]","language":"md","time":"14 days ago","created":"2025-05-06T22:56:12.771Z","annotations":[],"updated":"2025-05-06T22:58:51.029Z"},{"title":"Table of Contents","id":"f57cadf2-4600-4045-a751-2608962a2671","type":"TEXT","raw":"**Table of Contents:**\n\n-   (1) Introduction\n    \n    -   (1-1) Check Point Security Gateway\n        \n    -   (1-2) SIP\n        \n        -   (1-2-A) SIP Description\n            \n        -   (1-2-B) SIP Entities\n            \n        -   (1-2-C) Types of SIP Messages\n            \n        -   (1-2-D) SIP Requests\n            \n        -   (1-2-E) SIP Responses\n            \n        -   (1-2-F) SIP Messages\n            \n        -   (1-2-G) Session Description Protocol (SDP)\n            \n        -   (1-2-H) SIP Architecture\n            \n        -   (1-2-I) SIP Example\n            \n    -   (1-3) H.323\n        \n        -   (1-3-A) H.323 Description\n            \n        -   (1-3-B) H.323 Architecture\n            \n        -   (1-3-C) H.323 Communication\n            \n        -   (1-3-D) Real-Time Transport Protocol (RTP)\n            \n        -   (1-3-E) Real-Time Transport Control Protocol (RTCP)\n            \n        -   (1-3-F) RAS - Registration, Admission, and Status\n            \n        -   (1-3-G) H.323 Typical Stack\n            \n        -   (1-3-H) H.323 Supported Protocols\n            \n        -   (1-3-I) H.323 Example\n            \n    -   (1-4) MGCP\n        \n        -   (1-4-A) MGCP Description\n            \n        -   (1-4-B) MGCP Characteristics\n            \n        -   (1-4-C) MGCP Components\n            \n        -   (1-4-D) MGCP and SIP / H.323\n            \n        -   (1-4-E) MGCP Example\n            \n    -   (1-5) SCCP (Skinny)\n        \n        -   (1-5-A) SCCP (Skinny) Description\n            \n    -   (1-6) Windows Messenger\n        \n        -   (1-6-A) Windows Messenger Description\n            \n-   (2) Check Point Specifications\n    \n-   (3) Check Point Definitions\n    \n-   (4) Relevant ports\n    \n    -   (4-1) SIP\n        \n    -   (4-2) H.323\n        \n    -   (4-3) H.245 Call Parameters\n        \n    -   (4-4) MGCP\n        \n    -   (4-5) SCCP (Skinny)\n        \n    -   (4-6) Windows Messenger\n        \n-   (5) Supported VoIP Deployments\n    \n    -   (5-1) SIP\n        \n    -   (5-2) H.323\n        \n    -   (5-3) MGCP\n        \n    -   (5-4) SCCP (Skinny)\n        \n-   (6) Relevant Check Point services\n    \n    -   (6-1) SIP\n        \n    -   (6-2) H.323\n        \n    -   (6-3) MGCP\n        \n    -   (6-4) SCCP (Skinny)\n        \n    -   (6-5) MSNMS (Windows Messenger)\n        \n    -   (6-6) UDP\n        \n-   (7) Relevant Check Point Security rules\n    \n    -   (7-1) SIP\n        \n        -   (7-1-A) Peer-to-Peer No-Proxy Topology\n            \n        -   (7-1-B) Proxy in an External Network\n            \n        -   (7-1-C) Proxy-to-Proxy Topology\n            \n        -   (7-1-D) Proxy in DMZ Topology\n            \n    -   (7-2) H.323\n        \n        -   (7-2-A) Endpoint to Endpoint\n            \n        -   (7-2-B) Gatekeeper to Gatekeeper\n            \n        -   (7-2-C) Gateway to Gateway\n            \n        -   (7-2-D) Gatekeeper in External Network\n            \n        -   (7-2-E) Gateway in External Network\n            \n        -   (7-2-F) Gatekeeper in DMZ\n            \n        -   (7-2-G) Gateway in DMZ\n            \n    -   (7-3) MGCP\n        \n        -   (7-3-A) Call Agent in External Network\n            \n        -   (7-3-B) Call Agent in DMZ\n            \n        -   (7-3-C) Call Agent to Call Agent\n            \n    -   (7-4) SCCP (Skinny)\n        \n        -   (7-4-A) SCCP over TCP\n            \n        -   (7-4-B) Secure SCCP\n            \n-   (8) Relevant Check Point NAT rules\n    \n    -   (8-1) SIP\n        \n    -   (8-2) H.323\n        \n    -   (8-3) MGCP\n        \n    -   (8-4) SCCP (Skinny)\n        \n-   (9) Relevant Check Point kernel tables\n    \n    -   (9-1) SIP\n        \n    -   (9-2) H.323\n        \n    -   (9-3) MGCP\n        \n-   (10) Check Point Security Gateway and VoIP traffic\n    \n    -   (10-1) SecureXL\n        \n    -   (10-2) CoreXL\n        \n    -   (10-3) ClusterXL\n        \n    -   (10-4) SIP interoperability with NAT\n        \n    -   (10-5) VoIP protections and IPS\n        \n-   (11) Troubleshooting VoIP traffic on Check Point Security Gateway\n    \n    -   (11-1) Things that can go wrong\n        \n    -   (11-2) General action plan\n        \n-   (12) Debugging Check Point Security Gateway\n    \n    -   (12-1) Syntax\n        \n    -   (12-2) Action plan\n        \n    -   (12-3) Modules and Flags\n        \n-   (13) Debug instructions\n    \n    -   (13-1) Issues with SIP over UDP traffic\n        \n    -   (13-2) Issues with SIP over TCP traffic\n        \n    -   (13-3) Issues with H.323 traffic\n        \n    -   (13-4) Issues with SCCP (Skinny) traffic\n        \n    -   (13-5) Issues with Windows Messenger traffic\n        \n-   (14) Overview of SmartView Tracker logs\n    \n    -   (14-1) All protocols\n        \n    -   (14-2) SIP\n        \n    -   (14-3) H.323\n        \n    -   (14-4) MGCP\n        \n    -   (14-5) SCCP (Skinny)\n        \n    -   (14-6) MSN over SIP\n        \n-   (15) Documentation\n    \n    -   (15-1) Check Point Release Notes\n        \n    -   (15-2) Check Point Administration Guides\n        \n    -   (15-3) RFC\n        \n    -   (15-4) External references\n        \n-   (16) Related solutions and documents\n    \n    -   (16-1) Configuration\n        \n    -   (16-2) Troubleshooting\n        \n    -   (16-3) Additional references\n        \n-   (17) Revision history\n    \n\n## (1) Introduction\n\nFor more details, refer to the Documentation section.\n\n**Note:** For Locally Managed 600, 700, 1100, 1200R, 1400 appliances, refer to [sk113573 - Configuring VoIP on Locally Managed 600 / 700 / 1100 / 1200R / 1400 appliances](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk113573).\n\n### (1-1) Check Point Security Gateway\n\nCheck Point Security Gateway secures VoIP traffic in SIP, H.323, MGCP and SCCP environments. VoIP calls involve a whole series of complex protocols, each of which can carry potentially threatening information through many ports.\n\nCheck Point Security Gateway verifies that caller and receiver addresses are located where they are supposed to be, and that the caller and receiver are allowed to make and receive VoIP calls. In addition, Check Point Security Gateway examines the contents of the packets passing through every allowed port, to verify that they contain proper information. Full stateful inspection on SIP, H.323, MGCP and SCCP commands ensure that all VoIP packets are structurally valid, and that they arrive in a valid sequence.\n\nThe following figure is a general overview of the VoIP protocols supported by Check Point Security Gateway:\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_Securing_VoIP.png \"To see the image in full size, open it in a new tab/window\")\n\n### (1-2) SIP\n\n**(1-2-A) SIP Description**\n\nSIP (Session Initiation Protocol) is a Voice over IP protocol, transported over UDP and TCP. It is an Application Layer control protocol used for creating, modifying, and terminating sessions with one or more participants.\n\nSIP employs design elements similar to the HTTP request/response transaction model. Each transaction consists of a client request that invokes a particular method or function on the server and at least one response. SIP reuses most of the header fields, encoding rules and status codes of HTTP, providing a readable text-based format.\n\nEach resource of a SIP network, such as a user agent or a voice mail box, is identified by a uniform resource identifier (URI), based on the general standard syntax also used in Web services and e-mail. A typical SIP URI is of the form '`sip:username:password@host:port`'. The URI scheme used for SIP is '`sip:`'.\n\nIf secure transmission is required, the scheme '`sips:`' is used and mandates that each hop, over which the request is forwarded up to the target domain, must be secured with Transport Layer Security (TLS).\n\nSIP works in concert with several other protocols and is only involved in the signaling portion of a communication session.\n\nSIP is primarily used in setting up and tearing down voice or video calls. It also allows modification of existing calls.\n\nSIP clients typically use TCP or UDP on port numbers 5060 and/or 5061 to connect to SIP servers and other SIP endpoints. Port 5060 is commonly used for non-encrypted signaling traffic, whereas port 5061 is typically used for traffic encrypted with Transport Layer Security (TLS).\n\n**(1-2-B) SIP Entities**\n\n-   SIP User Agents (SIP Phones)\n    -   Client - initiates SIP signalling (UAC)\n    -   Server - responds to the SIP signalling from the Client (UAS)\n-   SIP Gateways\n    -   To PSTN for telephony interworking\n    -   To H.323 for IP telephony interworking\n    -   etc.\n-   SIP Servers (Proxy, Registrar, Redirect, Location, etc.)\n    -   Proxy server - decides next hop and forwards request\n    -   Registrar server - accepts `REGISTER` requests from clients\n    -   Redirect server - receives connection requests from the User Agents and sends them back to the requester including destination data instead of sending them to the calling party (or another proxy server if the particular station is not in its administration)\n    -   Location Server - receives registration requests from the User Agents and updates the terminal database with them (server is used to locate SIP users or to forward messages)\n\nAll server sections (Proxy, Redirect, Location) are typically available on a single physical machine called proxy server, which is responsible for client database maintenance, connection establishing, maintenance and termination, and call directing.\n\n**(1-2-C) Types of SIP Messages**\n\nThere are two types of SIP messages:\n\n-   Requests - Sent from the Client to the Server.\n-   Responses - Sent from the Server to the Client.\n\nRequest + Response = Transaction. Transactions are identified by the value in the '`Cseq`' (Command Sequence) header field.\n\n**(1-2-D) SIP Requests**\n\n-   `REGISTER` - Registers / un-registers a specific address with the SIP server.\n-   `INVITE` - Initiates a call.\n-   `ACK` - Confirms a final response for `INVITE`.\n-   `BYE` - Terminates (and transfers) a call.\n-   `CANCEL` - Cancels pending requests (searches and \"ringing\").\n-   `OPTIONS` - Queries the capabilities of the other side.\n-   `SUBSCRIBE` - Subscribes / un-subscribes to a particular state.\n-   `NOTIFY` - Returns current state information.\n-   `INFO` - Sends mid-session information (`ISUP`). Does not modify session state.\n-   `UPDATE` - Updates the remote target of a dialog (re-`INVITE`).\n-   `MESSAGE` - Carries instant messages in the request body.\n-   `REFER` - Asks recipient to issue a SIP request (call transfer).\n-   etc.\n\n**(1-2-E) SIP Responses**\n\n-   `1xx: Provisional` - Request received, continuing to process the request (e.g.: _100 Trying, 180 Ringing, 181 Call Forwarded, 182 Queued, 183 Session Progress_)\n-   `2xx: Success` - Action was successfully received, understood, and accepted (e.g.: _200 OK_)\n-   `3xx: Redirection` - Further action needs to be taken in order to complete the request (e.g.: _301 Moved Permanently, 302 Moved Temporarily, 305 Use Proxy, 380 Alternative Server_)\n-   `4xx: Client-Error` - The request contains bad syntax or cannot be fulfilled at this server (e.g.: _400 Bad Request, 401 Unauthorized, 403 Forbidden, 404 Not Found, 405 Bad Method, 407 Proxy Authentication Required, 415 Unsupported Content, 420 Bad Extensions, 486 Busy Here_)\n-   `5xx: Server-Error` - The server failed to fulfill an apparently valid request (e.g.: _500 - Server Internal Error, 501 Not Implemented, 503 Unavailable, 504 Timeout, 513 Message Too Large_)\n-   `6xx: Global-Failure` - The request cannot be fulfilled at any server (e.g.: _600 Busy Everwhere, 603 Decline, 604 Does Not Exist Anywhere, 606 Not Acceptable_)\n\nAdditional details:\n\n-   Final Response - Terminates a SIP transaction. 2xx, 3xx, 4xx, 5xx and 6xx responses are final. Exactly one non-2xx final response may be sent for a request.\n-   Provisional response - Does not terminate a SIP transaction, followed by a final response. Multiple provisional responses may arrive before final response is received. Provisional responses for an INVITE request can create \"early dialogs\". 1xx is a provisional response.\n\n**(1-2-F) SIP Messages**\n\nSIP messages comprise the following three parts:\n\n1.  Start Line\n    -   Request-line (requests) - Includes a Request URI, which indicates the user or service, to which this request is being addressed (e.g., _INVITE sip:1234@10.0.0.1:5060 SIP/2.0_).\n    -   Status-line (responses) - Holds the numeric Status-code and its associated textual phrase (e.g., _SIP/2.0 200 ok_).\n2.  Headers\n    -   SIP header fields are similar in syntax and semantics to HTTP header fields. Each header take the format of '`<name>: <value> \\r\\n`' (e.g., _Call-ID: 11269877456  Cseq: 3 REGISTER_).\n    -   The headers ends with '`\\r\\n\\r\\n`'.\n3.  Body (Content) - optional\n    \n    -   The body of the SIP message starts after headers (`\\r\\n\\r\\n`).\n    -   The body of the SIP message may be used to contain opaque data from any kind.\n    -   Its length and type are presented in the '`Content Length`' and '`Content Type`' header fields (e.g., _Content Type: application\\\\sdp  Content Length: 220_).\n    \n    Content type:\n    \n    -   SDP (Session Description Protocol) - Used to describe the session to be initiated (audio and video codec types, sampling rates, etc.).\n    -   Text - The Message body may be used to contain opaque textual data. For example, in case of SIP Message.\n    -   Others (e.g., attachments).\n\n**(1-2-G) Session Description Protocol (SDP)**\n\nSDP is the protocol used to describe multimedia session announcement, multimedia session invitation and other forms of multimedia session initiation. A multimedia session is defined, for these purposes, as a set of media streams that exist for a duration of time.\n\nSDP packets usually include the following information:\n\n-   Session information  \n    \n    -   Session name and purpose\n    -   Time(s) the session is active\n    \n    Since the resources necessary for participating in a session may be limited, it would be useful to include the following additional information:  \n    -   Information about the bandwidth to be used by the session\n    -   Contact information for the person responsible for the session\n-   Media Information  \n    -   Type of media, such as video and audio\n    -   Transport protocol, such as RTP/UDP/IP and H.320\n    -   Media format, such as H.261 video and MPEG video\n    -   Multicast address and Transport Port for media (IP multicast session)\n    -   Remote address for media and Transport port for contact address (IP unicast session)\n\n**(1-2-H) SIP Architecture**\n\n-   Peer-to-Peer\n    \n    [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Architecture_Peer-to-Peer.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Architecture_Peer-to-Peer.png \"Click the image to see it in full size in a new tab/window\")\n    \n-   Outbound Proxy\n    \n    [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Architecture_Outbound_Proxy.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Architecture_Outbound_Proxy.png \"Click the image to see it in full size in a new tab/window\")\n    \n-   VoIP to PSTN\n    \n    [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Architecture_VoIP-to-PSTN.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Architecture_VoIP-to-PSTN.png \"Click the image to see it in full size in a new tab/window\")\n    \n-   PSTN to VoIP\n    \n    [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Architecture_PSTN-to-VoIP.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Architecture_PSTN-to-VoIP.png \"Click the image to see it in full size in a new tab/window\")\n    \n-   Proxy mode\n    \n    [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Architecture_Proxy_Mode.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Architecture_Proxy_Mode.png \"Click the image to see it in full size in a new tab/window\")\n    \n-   Redirect mode\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Architecture_Redirect_Mode.png)\n    \n\n**(1-2-I) SIP Example**\n\n-   _Example 1_:\n    \n    Connection establishing and terminating procedures in the SIP proxy server environment:\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Example_1.png)\n    \n-   _Example 2_:\n    \n    Very simplified form how some of SIP logical entities use messages to interact - in this case to set up a voice call from a PC (softphone) to a hardware SIP VoIP phone.\n    \n    <table><tbody><tr><td><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Example_2.png\" alt=\"\"></td></tr><tr><td><ol><li>User Agent: '<code>X in SIP domain A wants to call Y in SIP domain B</code>'</li><li>Proxy Server: '<code>Where to call setup requests for domain B go?</code>'</li><li>Redirect Server: '<code>Send call setup requests to domain B Proxy Server<br>at address enclosed in this response message</code>'</li><li>Proxy Server: '<code>Call setup request for B</code>'</li><li>Proxy Server: '<code>Where is B?</code>'</li><li>Registrar Server: '<code>B is at address enclosed in this response message</code>'</li><li>Proxy Server: '<code>Call notification</code>'</li><li><code>Response</code></li><li><code>Response</code></li><li><code>Response</code></li></ol>If the call setup is successful (Y is free to take the call), then a media path<br>using RTP is established between X and Y and the connected parties can start to talk.</td></tr></tbody></table>\n    \n\n### (1-3) H.323\n\n**(1-3-A) H.323 Description**\n\nH.323 is an ITU (International Telecommunication Union) standard that specifies the components, protocols and procedures that provide multimedia communication services, real-time audio, video, and data communications over packet networks, including Internet Protocol (IP) based networks.\n\nH.323 call signaling is based on the ITU-T Recommendation Q.931 protocol and is suited for transmitting calls across networks using a mixture of IP, PSTN, ISDN, and QSIG over ISDN. A call model, similar to the ISDN call model, eases the introduction of IP telephony into existing networks of ISDN-based PBX systems, including transitions to IP-based PBXs.\n\nH.323 registration and alternate communication occurs on UDP port 1719, and H.323 Call signalling occurs on TCP port 1720.\n\n**(1-3-B) H.323 Architecture**\n\nThe H.323 components are _terminal_, _gateway_, _gatekeeper_, _Multipoint Control Units_ (MCUs) and _Border Elements_:\n\nNote: _terminal_, _gateway_, _gatekeeper_ are referred to as \"endpoints\".\n\n-   _Terminals_ represent the endpoints of each H.323 connection and can be realized in hardware or software. The audio transmission via G.711 and support by the control protocols H.245, H.225 and RAS are mandatory. The use of other audio codes and the option to transfer video and data are optional. If these additional services are offered, certain codes have to be used.\n    \n    If several codecs are available for the same kind of data, the codec to be used is negotiated at the beginning of a connection via H.245. Each communication begins and ends with an H.323 terminal, whereby several audio and video connections are possible simultaneously. Coding and decoding can take place in asymmetric operation even with various codecs.\n    \n    _Examples_:\n    \n    -   Telephones\n    -   Video phones\n    -   IVR devices\n    -   Voicemail Systems\n    -   \"Soft phones\"\n-   _Gateways_ establish the connection in other networks, i.e., gateways connect the H.323 network with the switched network of PBXs and Central Office switches. Gateways are optional components of H.323 topology. The function of the gateways is to convert the various data formats in transport, process control and audio/video processing. Data communication of the gateways with the terminals is via H.245 and H.225. Some of the gateway functions are not exactly specified in H.323 and are left up to the manufacturer, for example, the maximum number of connected terminals, the maximum number of connections to other networks, the number of simultaneously independent conferences as well as the supported conversion and multipoint functions.\n-   _Gatekeepers_ take over the task of translating between telephone number, e.g., in accordance to the E.164 numbering standard, and IP addresses. Gatekeepers take over various control and management functions within an H.323 zone and also belong to the optional components. If a gatekeeper exists, its services have to be used by the terminals. Per H.323 zone only one gatekeeper is permitted. The two main tasks of the gatekeeper are address conversion and bandwidth management. The address conversion function serves to control the connection; bandwidth management is designed to avoid overload situations. Both functions are realized via the RAS protocol defined in H.225.0. The network administrator is able to allocate a part of the total bandwidth to H.323 connections and release the rest for other applications. If the preset limit has been reached, the gatekeeper rejects further connection requests from terminals or an increase in bandwidth for already existing connections, and prevents network overloads. The criteria to determine whether bandwidth is available is not the subject matter of H.323.\n    \n    As the gatekeeper also takes over access control of the terminals via RAS, it can also reject connections if individual terminals are not authorized.\n    \n    Finally the gatekeeper can also play a role by receiving and routing the H.245 channels in connections between two users. If the conference is extended to three or more users the gatekeeper routes the H.245 control channels to a multipoint controller which then takes over the task of controlling the conference.\n    \n    The H.323 standard defines _mandatory_ and _optional_ gatekeeper functions as described below:\n    \n    1.  Mandatory functions  \n        -   Address Translation - Translate H.323 IDs (such as gwy1@doamin.com) and E.164 numbers (standard telephones numbers) to endpoint IP addresses\n        -   Admission Control - Controls endpoint admission into the H.323 network. To achieve this, the gatekeeper uses the following:  \n            -   H.225 Registration, Admission, and Status (RAS) messages\n            -   Admission Request (`ARQ`)\n            -   Admission Confirm (`ACF`)\n            -   Admission Reject (`ARJ`)\n        -   Bandwidth Control - Consist of managing endpoint bandwidth requirements. To achieve this, the.gatekeeper uses the following H.225 RAS messages:  \n            -   Bandwidth Request (`BRQ`)\n            -   Bandwidth Confirm (`BCF`)\n            -   Bandwidth Reject (`BRJ`)\n        -   Zone Management - The gateway provides zone management for all registered endpoints in the zone. For example, controlling the endpoint registration process.\n    2.  Optional functions  \n        -   Call Authorization - With this option, the gateway can restrict access to certain terminals or gateways and/or have time-of-day policies restrict access.\n        -   Call Management - With this option, the gateway maintains active call information and uses it to indicate busy endpoints or redirect calls.\n        -   Bandwidth Management - With this option, the gateway can reject admission when the required bandwidth is not available.\n        -   Call Control Signaling - With this option, the gateway can route call-signaling messages between H.323 endpoints using the _Gatekeeper-Routed Call Signaling_ (`GKRCS`) model. Alternatively, it allows endpoints to send H.225 call-signaling messages directly to each other.\n    \n    Each Gatekeeper involved in the call can choose one of the two possible routing modes:\n    \n    -   Direct - During the Admission the Gatekeeper indicates that the endpoints can exchange call-signaling messages directly. .The endpoints exchange the call signaling on the call-signaling channel.\n    -   Gatekeeper routed - The admission messages are exchanged between the endpoint and the Gatekeeper on the RAS channel. The Gatekeeper receives the call-signaling messages from one endpoint and routes them to the other endpoint.\n-   _Multipoint Control Units_ (MCUs) are used in the case of conferences with more than two users. They ensure that connections are properly setup and released, that audio and video are mixed, and that the data are distributed among the conference. Each of the H.323 terminals sends its data to the MCU. An MCU consists of a _Multipoint Controller_ (MC) and any number of _Multipoint Processors_ (MP). The Multipoint Controller (MC) takes care of the H.245 and negotiating the general functions for audio and video processing and controls the resources by determining which data flows are to be transmitted by the MP(s). Multipoint Processors (MPs) receive media streams from conference participants, processes them and distributes media streams to the terminals in the conference. Video processing refers to all algorithms and formats, audio processing only to the algorithms, data processing only to the flows. In video processing by Multipoint Processors (MP), switching and mixing is also required. Switching ensures that a certain data flow is sent if several data flows are available (for example, with the matching video sequences, if the speaker in a conference changes identified by an audio signal, or if a change is requested via H.245). Mixing allows several data flows to be combined, whereby the image created is split into several segments and re-coded.\n    \n    Multipoint Processors (MPs) also perform audio switching and mixing. Incoming signals are decoded in a standard procedure according to Pulse-Code Modulation (PCM) or analogously, combined in a suitable way and then coded in the desired audio format. In this combination interference signals and ancillary noises can be diminished.\n    \n    An individual combination of the incoming audio data can be supplied to each user whereby private communication is enabled within conferences. The audio data transmitted should not be contained in the audio data received. Multipoint Controller (MC) and Multipoint Processor (MP) can be co-located with other components, e.g., with H.323 terminals.\n    \n    The H.323 standard makes the distinction between callable and addressable end devices: all components are addressable; gatekeepers are, however, not callable.\n    \n-   _Border Elements_, which are often co-located with a Gatekeeper, exchange addressing information and participate in call authorization between administrative domains. Border Elements may aggregate address information to reduce the volume of routing information passed through the network, may assist in call authorization/authentication directly between two administrative domains or via a clearinghouse.  \n    Peer elements are like \"border elements\", but reside within the interior of the administrative domain.\n-   _Zone_ is the collection of H.323 nodes such as Gateways, Terminals, and MCUs registered with the Gatekeeper.  \n    -   There may be more than one physical Gatekeeper device that provides the logical Gatekeeper functionality for a zone.\n    -   There can only be one active Gatekeeper per zone.\n    -   These zones can overlay subnets and one Gatekeeper can manage Gateways in one or more of these subnets.\n    -   The physical location of the Gatekeeper with respect to its endpoints is immaterial.\n\nH.323 Components summary:\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_H323_Components_Summary.png)\n\n**(1-3-C) H.323 Communication**\n\nThe four components (_terminal_, _gateway_, _gatekeeper_, _Multipoint Control Units_ (MCUs)) communicate by exchanging information flows among each other. These are split into five categories:\n\n-   Audio (digitized and coded) voice\n-   Video (digitized and coded full-motion image communication)\n-   Data (files such as text documents or images)\n-   Communication control (exchange of supported functions, controlling logical channels, etc.)\n-   Controlling connections (connection setup and connection release, etc.)\n\nThe key function of H.323 components is to exchange information flows. A distinction is made between _audio_, _video_ and _data_ flows, which are processed with certain codecs. All three information flows are transmitted via logic channels in accordance with H.225.0 standard:\n\n-   _Audio_ transmission has to be supported by the H.323 terminals via G.711 codec. G.711 was originally designed for ISDN networks with fixed transmission rates, and has an output of 64 kbit/s. Although feasible in most LAN environments, G.711 cannot be used on low bandwidth links. Therefore, ITU-T specified G.723 is a preferred codec due to its exceptional compression of voice to 5.3-6.3 kbit/s. Further optional audio codecs are G.722, G.728, G.729 and MPEG1, all of them offering benefits for certain environments and applications.\n    \n    The H.323 endpoints can support any of these codecs, and can advertise and negotiate the usage of these codecs in communications to other endpoints.\n    \n-   _Video_ transmission is an optional function of H.323 terminals. If it is supported it has to be handled via the ITU-T standards H.261 and optionally via H.263. The H.261 standard uses transmission rates of N x 64 kBit/s (N = 1, 2, ... 30) and can therefore for example use several ISDN channels. H.261 uses intra- and inter-frame coding similar to MPEG. Motion compensation is an optional function.\n    \n    The more recent H.263 standard is compatible with H.261, but features by far better image quality as a result of 1/2 Pixel Motion Estimation, Predicted Frames and is also suitable for lower transmission rates. H.263 defines five image formats. The interaction with H.261 takes place via the QCIF format supported by both.\n    \n-   For a transmission of _data_ between endpoints, the H.323 standard refers to the ITU-T T.120 standard that can be used for various applications in the field of Collaborative Work, such as White-boarding, Application Sharing, and joint document management. T.120 is independent of the operating system and transport protocol and is supported by more than 100 companies.\n    \n    The characteristics of T.120 comprise:\n    \n    -   Multipoint data conferences\n    -   Transmission with error correction and acknowledgement of receipt, control of certain package sequences at the receiving station - also from different transmitting stations\n    -   Independent of the underlying transmission layer (LAN, modem ...) and of the network (POTS, ISDN, CSDN, LAN)\n    -   Interoperability and platform independence\n    -   Support of heterogeneous topologies (star, cascading, series connection ...)\n    -   Scalability (PC to multiprocessor), standard compatibility (e.g., to H.320) and future reliability (ATM, Frame-Relay, security aspects)\n    \n    T.120 utilizes layer architecture similar to the ISO/OSI layer model: top layers (T.126, T.127) are based on the services of lower layers (T.121 to T.125) and contain protocols for special conference applications such as common notebook (White-board) or multipoint file transmission.\n    \n\n**(1-3-D) Real-Time Transport Protocol (RTP)**\n\nH.323 is directed at networks without special service quality. For the transmission of real-time data, such as audio or video, additional mechanisms are introduced to guarantee successful communication. H.225.0 protocol therefore refers to the Real-time Transport Protocol (RTP) from the Internet Engineering Task Force (IETF). RTP is specified in RFC 1889 and 1890, and enables ascertain real time compatibility. If used under the TCP/IP protocol family RTP is based on UDP, and marks the UDP/IP packets with a time stamp and a sequence number. The receiving station is therefore able to sort incoming packets and play them in the correct sequences. In case a packet gets lost during transmission, RTP can play the previous packet instead of re-transmitting. Since voice and video are time critical applications, re-transmitting packets would take too long and be of no use. RTP also identifies duplicated packets, and plays only one of the copies.\n\nTo distinguish between different RTP connections the contents of the package can be described via the field Payload Type. An optimal supplement to RTP is the Real-time Transport Control Protocol (RTCP) which contains all control functions of RTP. RTP was designed as open and versatile protocol and therefore functions not only with IP, but also with other protocols, such as IPX, CLNP or ATM (AAL5). RTP supports not only Unicast, but also Multicast, e.g., it can be employed in multicast enabled networks.\n\nIt is important to underline the fact that RTP neither guarantees certain transmission rates nor voice quality or an error-free transmission. The receiving station is enabled to identify faulty or incomplete transmissions and reacts to them with suitable methods.  \nThese are, for example:\n\n-   Omitting faulty data\n-   Balancing package errors by duplicating the previous packets\n-   Renewed request if too many missing packets are received via RTCP\n\n**(1-3-E) Real-Time Transport Control Protocol (RTCP)**\n\nReal-time Transport Control Protocol (RTCP) is the counterpart of Real-Time Transport Protocol (RTP) that provides control services. The primary function of RTCP is to provide feedback on the quality of the data distribution. Other RTCP functions include carrying a transport-level identifier for an RTP source, called a canonical name, which is used by receivers to synchronize audio and video.\n\n**(1-3-F) RAS - Registration, Admission, and Status**\n\nRAS is used between the endpoint and its Gatekeeper in order to:\n\n-   Allow the Gatekeeper to manage the endpoint\n-   Allow the endpoint to request admission for a call\n-   Allow the Gatekeeper to provide address resolution functionality for the endpoint\n\nRAS signaling is required when a Gatekeeper is present in the network (i.e., the use of a Gatekeeper is conditionally mandatory).\n\nRAS messages generally have three types:\n\n-   Request (`_x_RQ`)\n-   Reject (`_x_RJ`)\n-   Confirm (`_x_CF`)\n\n> Exceptions are:  \n> \n> -   Information Request (`IRQ`) / Information Response (`IRR`) / Ack / Nak\n> -   The \"`nonStandardMessage`\"\n> -   The \"`unknownMessage`\" response\n> -   Request In Progress (`RIP`)\n> -   Resource Availability Indicate (`RAI`) / Resource Availability Confirm (`RAC`)\n> -   Service Control Indication (`SCI`) / Service Control Response (`SCR`)\n\nTypically, RAS communications is carried out via UDP through port 1719 (unicast) and 1718 (multicast). For backward compatibility sake, an endpoint should be prepared to receive a unicast message on port 1718 or 1719. Only UDP is defined for RAS communications. Gatekeeper Request (`GRQ`) and Location Request (`LRQ`) may be send multicast, but are generally sent unicast. All other RAS messages are sent unicast.\n\nLet us review some RAS messages:\n\n-   _Gatekeeper Request_ - `GRQ`\n    -   When an endpoint comes to life, it should try to “discover” a gatekeeper by sending a GRQ message to a Gatekeeper:  \n        -   Address of a Gatekeeper may be provisioned\n        -   The endpoint may send a multicast GRQ\n        -   Address of a Gatekeeper may be found through DNS queries (Annex O/H.323)\n    -   There may be multiple Gatekeepers that could service an endpoint, thus an endpoint should look through potentially several GCF/GRJ messages for a reply.\n-   _Gatekeeper Reject_ - `GRJ`\n    -   If a Gatekeeper does not wish to provide service to the endpoint, it will generally send a `GRJ` message to the endpoint:  \n        -   As a security consideration to avoid DoS attacks, one might want to consider ignoring requests from unknown endpoints\n    -   The `GRJ` message will carry one of several rejection reasons.\n-   _Gatekeeper Confirm_ - `GCF`\n    -   If the Gatekeeper wishes to provide service to the endpoint, it will return a `GCF` message.\n    -   The `GCF` message will contain a number of data elements that will later be used by the endpoint.\n-   _Gatekeeper Registration_ - `RRQ`\n    -   Once a Gatekeeper has been \"discovered\", the endpoint will then register with the Gatekeeper in order to receive services.\n    -   Communication is exclusively via port 1719 (unicast).\n    -   endpoint will send an `RRQ` and expect to receive either an `RCF` or `RRJ`.\n    -   Reception of an `RRJ` simply means that the endpoint will not receive services from the Gatekeeper, not that the endpoint cannot communicate on the network.\n    -   During the registration process, the Gatekeeper will assign an \"endpoint identifier\" to the endpoint, which is to be used during subsequent communications with the Gatekeeper.\n    -   The endpoint will supply a list of endpoint alias addresses and the Gatekeeper will indicate which ones it accepts.\n    -   The Gatekeeper may grant the endpoint permission to place calls without using the ARQ/ACF exchange (called \"pre-granted ARQs\").\n    -   The endpoint will indicate a \"time to live\" and the Gatekeeper may accept that or a lower TTL value.\n    -   _Lightweight RRQs_:  \n        -   The \"time to live\" indicated in the `RRQ` tells the Gatekeeper when it may freely unregister the endpoint due to inactivity.\n        -   The endpoint may renew its registration by sending either a full `RRQ` message or a \"lightweight RRQ\" (`LW RRQ`).\n        -   The `LW RRQ` message only contains a few elements and is only intended to refresh the endpoint's registration.\n-   _Admission Request_ - `ARQ`\n    \n    -   Once registered with a Gatekeeper, the endpoint may only initiate or accept a call after first requesting \"admission\" to the Gatekeeper via the ARQ message (except in the case that \"pre-granted ARQs\" is in use).\n    -   The Gatekeeper may accept (`ACF`) or reject (`ARJ`) the request to place or accept a call.\n    -   The endpoint will indicate the destination address(es) and the Gatekeeper may (if \"`canMapAlias`\" is true) return an alternate set of destination addresses.\n    -   The endpoint uses a unique Call Reference Value (`CRV`) between itself and the Gatekeeper to refer to this call (link significant).\n    -   The endpoint will provide a Call Identifier (`CallID`), which is a globally unique value.\n    -   The endpoint will indicate a Conference Identifier (`CID`), or 0 if the Conference Identifier is not known:  \n        -   This is unique if the call is point to point\n        -   This value is shared by all participants in the same multipoint conference\n        -   Some devices do not properly handle `CID=0`\n    -   The endpoint will indicate the desired bandwidth and the Gatekeeper may adjust that value to a lower value.\n    -   The endpoint will indicate whether it is originating or answering a call.\n    \n    Reference Values:\n    \n    -   Call Reference Value - `CRV`\n        -   16 bit integer that is link significant\n        -   Most significant bit indicates the direction of the call (0=originator, 1=terminator)\n        -   CRV used in the `ARQ` to originate a call must be the subsequent SETUP message (interoperability with version 1)\n        -   CRV used in `ARQ` to answer a call does not have to be the same as that received in `SETUP`\n    -   Conference Identifier - `CID`\n        -   A Globally unique (`UUID` or `GUID`) identifier that is shared by all participants in the same conference\n    -   Call Identifier - `CallID`\n        -   A globally unique (`UUID` or `GUID`) identifier that is unique to that particular call\n-   _Location Request_ - `LRQ`\n    -   The `LRQ` message is sent by either an endpoint or a Gatekeeper to a Gatekeeper in order to resolve the address of an alias address (e.g., to turn a telephone number into an IP address).\n    -   While `LRQs` may be sent by endpoints, they are almost exclusively sent by Gatekeepers.\n-   _Bandwidth Request_ - `BRQ`\n    -   Subsequent to initial call setup, the endpoint may wish to to use more or less bandwidth than previously indicated via the `BRQ`.  \n        Note: While it is syntactically legal for the Gatekeeper to send a `BRJ` to a request asking for less bandwidth, this makes no sense and should not be done.\n    -   An endpoint must send a `BRQ` subsequent to initial call establishment if the actual bandwidth utilized is less than initially requested.\n-   _Disengage Request_ - `DRQ`\n    -   Once a call completes, the endpoint sends a `DRQ` message to the Gatekeeper.  \n        Note: The Gatekeeper may send a `DRJ`, but this is strongly discouraged...if an endpoint is sending a `DRQ`, it means the call is over and cannot be \"rejected\"!\n    -   The `DRQ` is an opportunity for the endpoint to report information useful for billing.\n    -   The Gatekeeper may also send a `DRQ` to force the endpoint to disconnect the call.\n-   _Information Request_ - `IRQ`\n    -   The `IRQ` is sent by the Gatekeeper to the endpoint to request information about one or all calls.\n    -   There are many details about each call that are reported to the Gatekeeper in the _Information Response_ (`IRR`) message.\n    -   There are provisions in H.323 to allow the endpoint to provide call information periodically and unsolicited.\n    -   The Gatekeeper may acknowledge or provide negative acknowledgement to an unsolicited _Information Response_ (`IRR`).\n-   _Request In Progress_ - `RIP`\n    -   A `RIP` message may be sent by the endpoint or the Gatekeeper to acknowledge receive of a RAS message that cannot be responded to in normal processing time.\n-   _Resource Availability Indicate_ - `RAI`\n    -   The `RAI` message is sent by an endpoint to indicate when it has neared resource limits or is no longer near a resource limit.\n    -   The Gatekeeper replies with _Resource Availability Confirm_ (`RAC`).\n-   _Service Control Indication_ - `SCI`\n    -   This message is sent by either the endpoint or the Gatekeeper to invoke some type of service.\n    -   The responding entity replies with _Service Control Response_ (`SCR`).\n    -   The `SCI`/`SCR` messages are used for specific services that are and will be defined for H.323, including Gatekeeper requested tones and announcements and \"stimulus control\" (Annex K/H.323).\n-   Miscellaneous Messages\n    -   \"_Unknown Message Response_\" is sent to an unrecognized message.\n    -   \"_Non-Standard Message_\" is used to allow Gatekeepers and endpoints to exchange messages that are not standard.\n\nRAS Timers and Retries:\n\n<table><tbody><tr><td>RAS message</td><td>Time-out value (sec)</td><td>Retry count</td></tr><tr><td>Gatekeeper Request (<code>GRQ</code>)</td><td>5</td><td>2</td></tr><tr><td>Gatekeeper Registration (<code>RRQ</code>)</td><td>3</td><td>2</td></tr><tr><td>Admission Request (<code>ARQ</code>)</td><td>5</td><td>2</td></tr><tr><td>Location Request (<code>LRQ</code>)</td><td>5</td><td>2</td></tr><tr><td>Bandwidth Request (<code>BRQ</code>)</td><td>3</td><td>2</td></tr><tr><td>Disengage Request (<code>DRQ</code>)</td><td>3</td><td>2</td></tr><tr><td>Information Request (<code>IRQ</code>)</td><td>3</td><td>1</td></tr><tr><td>Information Response (<code>IRR</code>)</td><td>5</td><td>2</td></tr><tr><td>Resource Availability Indicate (<code>RAI</code>)</td><td>3</td><td>2</td></tr><tr><td>Service Control Indication (<code>SCI</code>)</td><td>3</td><td>2</td></tr><tr><td>Unregistration Request (<code>URQ</code>)</td><td>3</td><td>1</td></tr></tbody></table>\n\n**(1-3-G) H.323 Typical Stack**\n\n[![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_H323_Typical_Stack.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_H323_Typical_Stack.png \"Click the image to see it in full size in a new tab/window\")\n\n**(1-3-H) H.323 Supported Protocols**\n\nThe relation between supported H.323 protocols:\n\n<table><tbody><tr><td>#</td><td><a href=\"http://www.itu.int/rec/T-REC-H.323\" target=\"_blank\" rel=\"noopener\">H.323</a></td><td><a href=\"http://www.itu.int/rec/T-REC-H.225.0/en\" target=\"_blank\" rel=\"noopener\">H.225</a></td><td><a href=\"http://www.itu.int/rec/T-REC-H.245\" target=\"_blank\" rel=\"noopener\">H.245</a></td></tr><tr><td>1</td><td>v2</td><td>v2</td><td>v3</td></tr><tr><td>2</td><td>v3</td><td>v3</td><td>v5</td></tr><tr><td>3</td><td>v4</td><td>v4</td><td>v7</td></tr><tr><td>4</td><td>v5</td><td>v5</td><td>v9</td></tr><tr><td>5</td><td>v6</td><td>v6</td><td>v13</td></tr><tr><td>6</td><td>v7</td><td>v7</td><td>v15</td></tr></tbody></table>\n\nExamples:\n\n-   If you support both v6 of H.225 and v13 of H.245, then you support v6 of H.323\n-   If you support v7 of H.323, then you support both v7 of H.225 and v15 of H.245\n\n**(1-3-I) H.323 Example**\n\n<table><tbody><tr><td><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_H323_Example.png\" alt=\"\"></p></td><td><p>An H.323 call has four different processes:</p><p>1. SETUP</p><ul><li>Terminal 1 register itself with the gatekeeper using the RAS protocol (register, admission, status) sending an <code>ARQ</code> message and receiving an <code>ACF</code> message.</li><li>Using H.225 protocol (used for setup and release of the call) terminal T1 sends a <code>SETUP</code> message to T2 requesting a connection. This message contains the IP address, port and alias of the calling user or the IP address and port of the called user.</li><li>T2 sends a <code>CALL PROCEEDING</code> message warning on the attempt to establish a call.</li><li>Now, T2 terminal must register itself in the gatekeeper as T1 previously did.</li><li>Alerting message indicates the beginning of tone generation phase.</li><li>And finally, <code>CONNECT</code> message shows the beginning of the connection.</li></ul><p>2. CONTROL SIGNALLING</p><p>In this phase a negotiation using H.245 protocol is opened (conference control), the interchange of the messages (request and answer) between both terminals establishes who will be the primary and who the subordinate, the capacities of the participants and the audio and video codecs to be used. When the negotiation finishes the communication channel is opened (IP addresses, port).</p><p>The main H.245 messages used in this step are:</p><ul><li><code>TerminalCapabilitySet</code> (<code>TCS</code>). Message capabilities supported by the terminals that take part in a call.</li><li><code>OpenLogicalChannel</code> (<code>OLC</code>). Message to open the logical channel which contains information to allow the reception and codification of the data. It contains information of the data type that will be sent.</li></ul><p>3. AUDIO</p><p>Terminals start the communication using the RTP / RTCP protocol.</p><p>4. CALL RELEASE</p><ul><li>The calling or the called terminal can initiate the ending process using the <code>CloseLogicalChannel</code> and <code>EndSessionComand</code> messages to finish the call using again H.245.</li><li>Then using H.225 the connection is closed with the <code>RELEASE COMPLETE</code> message.</li><li>And finally the registration of the terminals in the gatekeeper are cleared using RAS protocol.</li></ul></td></tr></tbody></table>\n\n### (1-4) MGCP\n\n**(1-4-A) MGCP Description**\n\nMedia Gateway Control Protocol (MGCP) is a protocol for controlling telephony gateways from external call control devices called Call Agents (also known as Media Gateway Controllers).\n\nMGCP is a primary/subordinate protocol, which means it assumes limited intelligence at the edge (endpoints) and intelligence at the core (Call Agent). In this it differs from SIP and H.323, which are peer-to-peer protocols.\n\nAn MGCP packet is either a command or a response. Every issued MGCP command has a transaction ID and receives a response. Commands begin with a four-letter verb (there are 9 command verbs - `AUEP, AUCX, CRCX, DLCX, EPCF, MDCX, NTFY, RQNT, RSIP`). Responses begin with a three number response code.\n\nMGCP packets are usually wrapped in UDP port 2427.\n\n**(1-4-B) MGCP Characteristics**\n\nCharacteristics:\n\n-   A primary/subordinate protocol\n-   Assumes limited intelligence at the edge (endpoints) and intelligence at the core (call agent)\n-   Used between call agents and media gateways\n-   Differs from SIP and H.323, which are peer-to-peer protocols\n-   Interoperates with SIP and H.323\n\n**(1-4-C) MGCP Components**\n\n-   Call Agent or Media Gateway Controller (MGC)  \n    -   Provides call signaling, control and processing intelligence to the gateway\n    -   Sends and receives commands to/from the gateway\n-   Gateway  \n    -   Provides translations between circuit-switched networks and packet-switched networks\n    -   Sends notification to the Call Agent about endpoint events\n    -   Executes commands from the Call Agents\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_MGCP_Components.png)\n\n**(1-4-D) MGCP and SIP / H.323**\n\n-   MGCP divides call setup/control and media establishment functions.\n-   MGCP does not replace SIP or H.323. SIP and H.323 provide symmetrical or peer-to-peer call setup/control.\n-   MGCP interoperates with H.323 and SIP. For example:  \n    -   A call agent accepts SIP or H.323 call setup requests\n    -   The call agent uses MGCP to control the media gateway\n    -   The media gateway establishes media sessions with other H.323 or SIP endpoints\n\n**(1-4-E) MGCP Example**\n\n<table><tbody><tr><td><p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_MGCP_Simplified_Call_Flow.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_MGCP_Simplified_Call_Flow.png\" alt=\"\" width=\"50%\"></a></p></td><td>Simplified Call Flow:<ol><li>When Phone A goes off hook, Gateway A sends a signal to the Call Agent.</li><li>Gateway A generates dial tone and collects the dialed digits.</li><li>The digits are forwarded to the Call Agent.</li><li>The Call Agent determines how to route the call.</li><li>The Call Agent sends commands to Gateway B.</li><li>Gateway B rings Phone B.</li><li>The Call Agent sends commands to both gateways to establish RTP/RTCP sessions.</li></ol></td></tr></tbody></table>\n\n### (1-5) SCCP (Skinny)\n\n**(1-5-A) SCCP (Skinny) Description**\n\nSkinny Client Control Protocol (SCCP) has a centralized call-control architecture. The Call Manager manages SCCP clients (VoIP endpoints), which can be IP Phones or Cisco ATA analog phone adapters.\n\nA SCCP client uses TCP/IP port 2000 to communicate with one or more Call Manager applications in a cluster. It uses the Real-time Transport Protocol (RTP) over UDP-transport for the bearer traffic (real-time audio stream) with other Skinny clients, or an H.323 terminal.\n\nSCCP is a stimulus-based protocol and is designed as a communications protocol for hardware endpoints and other embedded systems, with significant CPU and memory constraints.\n\n### (1-6) Windows Messenger\n\n**(1-6-A) Windows Messenger Description**\n\nWindows Messenger can work in two modes. Either using the SIP protocol, or using the native MSNMS protocol.\n\n## (2) Check Point Specifications\n\n<table><tbody><tr><td>Protocols</td><td>Details</td></tr><tr><td>Signaling protocols</td><td><ul><li>Session Initiation Protocol (SIP)</li><li>H.323</li><li>Media Gateway Control Protocol (MGCP)</li><li>Skinny Client Control Protocol (SCCP)</li></ul></td></tr><tr><td>Media protocols</td><td><ul><li>Real-time Transport Protocol (RTP)</li><li>Real Time Control Protocol (RTCP)</li></ul></td></tr><tr><td>Session Initiation Protocol (SIP)</td><td><ul><li>RFC 3261 - Latest SIP RFC</li><li>RFC 3372 - SIP-T</li><li>RFC 3311 - <code>UPDATE</code> message</li><li>RFC 2976 - <code>INFO</code> message</li><li>RFC 3515 - <code>REFER</code> message</li><li>RFC 3265 - SIP Events</li><li>RFC 3266 - IPv6 in SDP</li><li>RFC 3262 - Reliability of Provisional responses</li><li>RFC 3428 - <code>MESSAGE</code> message, MSN messenger over SIP, SIP over TCP, SIP over UDP, SIP early media</li></ul></td></tr><tr><td>H.323</td><td><ul><li>H.323 v.2, v.3, v.4</li><li>H.225 v.2, v.3, v.4</li><li>H.245 v.3, v.5, v.7</li></ul></td></tr><tr><td>Media Gateway Control Protocol (MGCP)</td><td><ul><li>RFC 3435 - MGCP v1.0</li><li>J.171 - Trunking Gateway Control Protocol (TGCP)</li></ul></td></tr><tr><td>Skinny Client Control Protocol (SCCP)</td><td><ul><li>Supported</li></ul></td></tr></tbody></table>\n\n## (3) Check Point Definitions\n\n<table><tbody><tr><td>Term</td><td>Definition</td></tr><tr><td>Early NAT</td><td>SIP normally works on UDP port 5060 regardless to the state of the call. This causes several calls to use the same signaling connection. In order to distinguish between signaling connections of different transactions, Security Gateway translates the source port to \"10000 and above/UDP\". This translation is called \"Early NAT\". This translation is needed to distinguish between connections of different transactions for internal needs, such as closing the relevant connections when a call is terminated, without closing connections of other calls.<p>Early NAT is part of Check Point's SIP support. It translates the source port according to SIP protocol information. It is a stateful SIP-oriented translation of the source port of SIP traffic that is used in order deal with IP phones that change their source port on every packet. This internal port translation allows to increase the Security Gateway's performance and save memory resources. It is also used to manage the call's state reaching strong protocol enforcement and to gain strong NAT capabilities allowing incoming calls to an IP phone network hidden behind a single IP address.</p><p>Early NAT is performed even when no NAT is configured for VoIP traffic.</p><p>This is ports-only translation, which is usually done on the source port of the packet.</p><p>In Bi-directional SIP configuration, the Early NAT is performed on the destination port of the packet.</p><p>Early NAT is performed only for SIP over UDP.</p><p>The packet should leave the Security Gateway (Post-Outbound 'O') with the same port it was intercepted (Pre-Inbound 'i').</p></td></tr><tr><td>Late NAT</td><td>Security Gateway translates the SIP port from \"10000 and above/UDP\" back to \"5060\". This translation is called \"Late NAT\".<p>Late NAT is performed even when no NAT is configured for VoIP traffic.</p><p>This is ports-only translation, which is usually done on the source port of the packet.</p><p>In Bi-directional SIP configuration, the Late NAT is performed on the destination port of the packet.</p><p>Late NAT is performed only for SIP over UDP.</p><p>The packet should leave the Security Gateway (Post-Outbound 'O') with the same port it was intercepted (Pre-Inbound 'i').</p></td></tr><tr><td>Check Point Active Streaming (CPAS)</td><td>Check Point technology that sends streams of data to be inspected in Check Point kernel, since more than a single packet at a time is needed in order to understand the application that is running (such as HTTP data). This technology works as a transparent proxy (FireWall maintains two separate conversations: 1) with a Client, \"pretending\" to be a Server, 2) with a Server, \"pretending\" to be a Client).<br>Connections that pass through Active Streaming can not be accelerated by SecureXL.<br>Active Streaming is '<code>Read</code>' and '<code>Write</code>'.</td></tr><tr><td>Check Point Passive Streaming</td><td>Check Point technology that sends streams of data to be inspected in Check Point kernel, since more than a single packet at a time is needed in order to understand the application that is running (such as HTTP data).<br>Connections that pass through Passive Streaming are accelerated by SecureXL.<br>Passive Streaming is '<code>Read</code>' only and it cannot hold packets.</td></tr><tr><td>Passive Streaming Library / Layer (PSL)</td><td>Check Point technology that assembles the streams and passes ordered data to the protocol parsers, which parse the traffic to find contexts and protocol compliance anomalies. When context is found, then the Content Management Infrastructure (CMI) is called to coordinate IPS protections relevant for each context.</td></tr></tbody></table>\n\n## (4) Relevant ports\n\n<table><tbody><tr><td id=\"Relevant ports - SIP\" colspan=\"2\">(4-1) SIP</td></tr><tr><td>UDP 5060<br>TCP 5060<br>TCP 5061</td><td>SIP clients typically use TCP or UDP on port numbers 5060 and/or 5061 to connect to SIP servers and other SIP endpoints.<br>Port 5060 is commonly used for non-encrypted signaling traffic.<br>Port 5061 is typically used for traffic encrypted with Transport Layer Security (TLS).</td></tr><tr><td id=\"Relevant ports - H.323\" colspan=\"2\">(4-2) H.323</td></tr><tr><td>UDP 1718 multicast (Gatekeeper)</td><td>Gatekeeper Discovery.</td></tr><tr><td>UDP 1719 unicast (Gatekeeper)</td><td>H.225 RAS - between terminals and gatekeepers. Gatekeeper RAS (Registration, Admission and Status).</td></tr><tr><td>TCP 1720 (Client)</td><td><ul><li>H.225 - between terminals (Q.931). Call signaling and setup.</li><li>H.245 - between terminals. Exchanging terminal capabilities and creation of media channels. May be tunneled inside H.225 call signaling channel.</li></ul></td></tr><tr><td>TCP 1731 (Client)</td><td>Audio Call Control.</td></tr><tr><td id=\"Relevant ports - H.245 Call Parameters\" colspan=\"2\">(4-3) H.245 Call Parameters</td></tr><tr><td>TCP 1502<br>TCP 1503</td><td>T.120 (optional).</td></tr><tr><td>TCP 389</td><td>ILS (Internet Locator Service) Registration (LDAP) (optional).</td></tr><tr><td>TCP 80</td><td>HTTP Interface (optional).</td></tr><tr><td>TCP 8080</td><td>HTTP Server Push (optional).</td></tr><tr><td id=\"Relevant ports - MGCP\" colspan=\"2\">(4-4) MGCP</td></tr><tr><td>UDP 2427</td><td>MGCP packets are usually wrapped in UDP port 2427.</td></tr><tr><td id=\"Relevant ports - SCCP\" colspan=\"2\">(4-5) SCCP (Skinny)</td></tr><tr><td>TCP 2000</td><td>SCCP client uses this port to communicate with one or more Call Manager applications.</td></tr><tr><td id=\"Relevant ports - Windows Messenger\" colspan=\"2\">(4-6) Windows Messenger</td></tr><tr><td>UDP 5060<br>TCP 5060<br>TCP 5061</td><td>IM and presence information are carried over Session Initiation Protocol (SIP) signaling. The SIP signaling can be carried over Transmission Control Protocol (TCP) in clear text. Or, the SIP signaling can be encrypted in a Transport Layer Security (TLS) session.</td></tr><tr><td>TCP 1503</td><td>The Whiteboard and Application Sharing components of Windows Messenger use the T.120 protocol.</td></tr><tr><td>UDP 5350</td><td>Specifies the lowest port that is used for Audio and Video signaling (min 1024, max 65535). Audio uses a pair of User Datagram Protocol (UDP) ports for a Real-time Protocol (RTP) stream to transmit data. Video uses Real-time Transport Protocol (RTCP) to control the session stream.</td></tr><tr><td>UDP 5353</td><td>Specifies the highest port that is used for Audio and Video signaling (min 1024, max 65535). Audio uses a pair of User Datagram Protocol (UDP) ports for a Real-time Protocol (RTP) stream to transmit data. Video uses Real-time Transport Protocol (RTCP) to control the session stream.</td></tr></tbody></table>\n\n## (5) Supported VoIP Deployments\n\n**Note:** Refer to the Relevant Check Point Security rules section and to the Relevant Check Point NAT rules section.\n\n### **(5-1) SIP Deployment**\n\n**Note:** Refer to the Relevant Check Point Security rules - SIP section and to the Relevant Check Point NAT rules - SIP section.\n\n### **(5-2) H.323 Deployment**\n\n**Note:** Refer to the Relevant Check Point Security rules - H.323 section and to the Relevant Check Point NAT rules - H.323 section.\n\n### **(5-3) MGCP Deployment**\n\n**Note:** Refer to the Relevant Check Point Security rules - MGCP section and to the Relevant Check Point NAT rules - MGCP section.\n\n### **(5-4) SCCP (Skinny) Deployment**\n\n**Note:** Refer to the Relevant Check Point Security rules - SCCP (Skinny) section and to the Relevant Check Point NAT rules - SCCP (Skinny) section.\n\n## (6) Relevant Check Point services\n\nThe following predefined services are available for use in Security and NAT rules. They can be used to limit the protocols that are permitted during each stage of the call. Separate rules can be defined for the different protocols.\n\n<table><tbody><tr><td id=\"Relevant services - SIP\" colspan=\"4\">(6-1) SIP</td></tr><tr><td>Service</td><td>Port</td><td>Protocol Type</td><td>Explanation</td></tr><tr><td><code>sip</code></td><td>UDP 5060</td><td><code>SIP_UDP</code></td><td>Used for SIP over UDP. This service is used to enforce signal routing. Use a VoIP Domain in the source or destination of the rule, together with this service. When this service is used, registration message are tracked and a database is maintained that includes the details of the IP phones and the users. If an incoming call is made to a Hide NATed address, Security Gateway verifies that the user exists in the SIP registration database. This can prevent DoS attacks.<p><strong>Do not use this service in the same rule with the '<code>sip_any</code>' service</strong> (because they contradict each other).</p></td></tr><tr><td><code>sip-tcp</code></td><td>TCP 5060</td><td><code>SIP_TCP_PROTO</code></td><td>Used for SIP over TCP.</td></tr><tr><td><code>sip-tcp-ipv6</code></td><td>TCP 5060</td><td><em>not set</em></td><td>Used for SIP over TCP IPv6.</td></tr><tr><td><code>sip_any</code></td><td>UDP 5060</td><td><code>SIP_UDP_ANY</code></td><td><strong>Only for Security Gateways R75.40 and lower</strong>.<br>Used for SIP over UDP. This service is used <em>if not enforcing</em> signal routing. In that case, do not place a VoIP Domain in the source or destination of the rule. Instead, use '<code>Any</code>' or a network object, together with the '<code>sip_any</code>' service.<br>Note: If a VoIP Domain is used with this service, the packet is dropped.<p><strong>Do not use this service in the same rule with the '<code>sip</code>' service</strong> (because they contradict each other).</p></td></tr><tr><td><code>sip_any-tcp</code></td><td>TCP 5060</td><td><code>SIP_ANY_TCP_PROTO</code></td><td><strong>Only for Security Gateways R75.40 and lower</strong>.<br>Used for SIP over TCP. This service is used <em>if not enforcing</em> signal routing. In that case, do not place a VoIP Domain in the source or destination of the rule. Instead, use '<code>Any</code>' or a network object, together with the '<code>sip_any-tcp</code>' service.<br>Note: If a VoIP Domain is used with this service, the packet is dropped.<p><strong>Do not use this service in the same rule with the '<code>sip-tcp</code>' service</strong> (because they contradict each other).</p></td></tr><tr><td><code>sip_any-tcp-ipv6</code></td><td>TCP 5060</td><td><em>not set</em></td><td><strong>Only for Security Gateways R75.40 and lower with IPv6 Support</strong>.<br>Used for SIP over TCP IPv6. This service is used <em>if not enforcing</em> signal routing. In that case, do not place a VoIP Domain in the source or destination of the rule. Instead, use '<code>Any</code>' or a network object, together with the '<code>sip_any-tcp-ipv6</code>' service.<br>Note: If a VoIP Domain is used with this service, the packet is dropped.<p><strong>Do not use this service in the same rule with the '<code>sip-tcp-ipv6</code>' service</strong> (because they contradict each other).</p></td></tr><tr><td><code>sip_tls</code></td><td>TCP 5061</td><td><code>SIP_TCP_PROTO</code></td><td><strong>Supported only in R65.2.100 version</strong>.<br>SIP over encrypted Transport Layer Security (TLS).</td></tr><tr><td><code>sip_tls_authentication</code></td><td>TCP 5061</td><td><code>SIP_TCP_PROTO</code></td><td>SIP over non-encrypted Transport Layer Security (that is, authenticated only).<br>NAT is <strong>not</strong> supported for connections of this type.</td></tr><tr><td><code>sip_tls_not_inspected</code></td><td>TCP 5061</td><td><code>None</code></td><td>Insecure way of allowing SIP over Transport Layer Security (TLS) to pass without inspection.<br>Requires opening of media ports <strong>manually</strong>.</td></tr><tr><td><code>sip_dynamic_ports</code></td><td><em>not set</em></td><td><em>not set</em></td><td>This service allows SIP connection to be opened on a dynamic port and not on the SIP well-known port.</td></tr><tr><td id=\"Relevant services - H.323\" colspan=\"4\">(6-2) H.323</td></tr><tr><td>Service</td><td>Port</td><td>Protocol Type</td><td>Explanation</td></tr><tr><td><code>H323</code></td><td>TCP 1720</td><td><code>H.323</code></td><td>This service allows a Q.931 to be opened, followed by a H.245 port, which in turn opens ports for RTP/RTCP.<p><strong>Do not use this service in the same rule with the '<code>H323_any</code>' service</strong> (refer to <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk20371\" target=\"_blank\" rel=\"noopener\">sk20371</a>).<br>In general, use the '<code>H.323</code>' service and the '<code>H.323_ras</code>' service in security rules.</p></td></tr><tr><td><code>H323_any</code></td><td>TCP 1720</td><td><code>H.323_ANY</code></td><td><strong>Only for Security Gateways R76 and lower</strong>.<br>This service is like the '<code>H.323</code>' service, but also allows the Source and Destination in the rule to be ANY rather than a network object. Only use '<code>H.323_any</code>' service if you do not know the location of the endpoints and are not enforcing signal routing using a VoIP Domain.<p><strong>Do not use this service in the same rule with the '<code>H323</code>' service</strong> (refer to <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk20371\" target=\"_blank\" rel=\"noopener\">sk20371</a>).</p></td></tr><tr><td><code>H323_ras</code></td><td>UDP 1719</td><td><code>H.323_RAS</code></td><td>This service allows a RAS port to be opened, followed by a Q.931 port. Q.931 then opens a H.245 port, which in turn opens ports for RTP/RTCP.<p><strong>Do not use this service in the same rule with the '<code>H.323_ras_only</code>' service</strong>.<br>In general, use the '<code>H.323</code>' service and the '<code>H.323_ras</code>' service in security rules.</p></td></tr><tr><td><code>H323_ras_only</code></td><td>UDP 1719</td><td><em>not set</em></td><td>This service allows only RAS. Use for call registration only. Cannot be used to make calls. If this service is used, no IPS Application Intelligence checks are made.<p><strong>Do not use this service in the same rule with the '<code>H.323_ras</code>' service</strong>.</p></td></tr><tr><td id=\"Relevant services - MGCP\" colspan=\"4\">(6-3) MGCP</td></tr><tr><td>Service</td><td>Port</td><td>Protocol Type</td><td>Explanation</td></tr><tr><td><code>mgcp_CA</code></td><td>UDP 2727</td><td><code>MGCP_UDP</code></td><td>Call Agent (Media Gateway Controller) port.</td></tr><tr><td><code>mgcp_MG</code></td><td>UDP 2427</td><td><code>MGCP_UDP</code></td><td>Media Gateway port.</td></tr><tr><td><code>MGCP_dynamic_ports</code></td><td><em>not set</em></td><td><em>not set</em></td><td>Allows MGCP connection to be opened on a dynamic port and not on the MGCP well-known ports.<br>Refer to <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk32474\" target=\"_blank\" rel=\"noopener\">sk32474</a>.</td></tr><tr><td id=\"Relevant services - SCCP\" colspan=\"4\">(6-4) SCCP</td></tr><tr><td>Service</td><td>Port</td><td>Protocol Type</td><td>Explanation</td></tr><tr><td><code>SCCP</code></td><td>TCP 2000</td><td><code>SCCP_TCP</code></td><td>SCCP over TCP.</td></tr><tr><td><code>Secure_SCCP</code></td><td>TCP 2443</td><td><code>Secure_SCCP_Proto</code></td><td>Secure SCCP - encrypted SCCP over TCP (TLS).<br><strong>Note:</strong> Supported only on Security Gateways / Security Management Servers running R75.40VS / R76 / R77 and above.</td></tr><tr><td><code>high_udp_for_secure_SCCP</code></td><td>-</td><td>-</td><td>Secure SCCP - media to or from Secure SCCP phones on IP Protocol 17, ports above 1024.<br><strong>Note:</strong> Supported only on Security Gateways / Security Management Servers running R75.40VS / R76 / R77 and above.</td></tr><tr><td id=\"Relevant services - MSNMS\" colspan=\"4\">(6-5) MSNMS (Windows Messenger)</td></tr><tr><td>Service</td><td>Port</td><td>Protocol Type</td><td>Explanation</td></tr><tr><td><code>MSNMS</code></td><td>TCP 1863</td><td><code>MSNMS_PROTOCOL</code></td><td>Native MSNMS.</td></tr><tr><td id=\"Relevant services - UDP\" colspan=\"4\">(6-6) UDP</td></tr><tr><td>Service</td><td>Port</td><td>Protocol Type</td><td>Explanation</td></tr><tr><td><code>udp-high-ports</code></td><td>UDP &gt; 1023</td><td><em>not set</em></td><td>UDP ports 1024-65535.</td></tr></tbody></table>\n\n## (7) Relevant Check Point security rules\n\n**Note:** Refer to the Supported VoIP Deployments section and to the Relevant Check Point NAT rules section.\n\nTo allow VoIP calls, you must create rules that let VoIP control signals pass through the Security Gateway. It is not necessary to define a media rule that specifies which ports to open and which endpoints can talk. The Security Gateway derives this information from the signaling. For a given VoIP signaling rule, the Security Gateway automatically opens ports for the endpoint-to-endpoint RTP/RTCP media stream.\n\n**Important Note:** Before configuring security rules for VoIP, makes sure that Anti-Spoofing is configured on the Security Gateway interfaces.\n\n### **(7-1) SIP Security Rules**\n\n**Note:** Refer to the Supported VoIP Deployments - SIP section and to the Relevant Check Point NAT rules - SIP section.\n\nImportant guidelines:\n\n-   SIP entities on which NAT is configured must reside behind the gateway's internal interfaces.\n-   Do not define special Network objects to allow SIP signaling. Use regular Network objects. The Security Gateway dynamically opens ports for data connections (RTP/RTCP and other). Security Gateway supports up to four different media channels per SIP SDP message.\n-   Security rules can be defined that allow bidirectional calls, or only incoming or outgoing calls.\n\n**_(7-1-A) SIP Security Rule for Peer-to-Peer No-Proxy Topology:_**\n\n[![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Rule_Peer_to_Peer_No_Proxy_Topology.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Rule_Peer_to_Peer_No_Proxy_Topology.png \"Click the image to see it in full size in a new tab/window\")\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>Net_B</code></td><td><code>Net_A</code><br><code>Net_B</code></td><td><code>sip</code></td><td><code>Accept</code></td><td>Gateway</td><td>SIP over UDP.<br>Bidirectional calls</td></tr></tbody></table>\n\nor\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>Net_B</code></td><td><code>Net_A</code><br><code>Net_B</code></td><td><code>sip-tcp</code><br>or<br><code>sip_tls_authentication</code><br>or<br><code>sip_tls_not_inspected</code></td><td><code>Accept</code></td><td>Gateway</td><td>SIP over TCP.<br>Bidirectional calls</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for IP Phones.  \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Configure the VoIP security rules.\n3.  Define Hide NAT (or Static NAT) for the phones in the internal network, edit the network object for '`Net_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method ('`Hide`' or '`Static`').\n4.  Install the security policy.\n\n**_(7-1-B) SIP Security Rule for Proxy in an External Network:_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Rule_Proxy_in_External_Network.png)\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>SIP_Proxy</code></td><td><code>Net_A</code><br><code>SIP_Proxy</code></td><td><code>sip</code></td><td><code>Accept</code></td><td>Gateway</td><td>SIP over UDP.<br>Bidirectional calls</td></tr></tbody></table>\n\nor\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>SIP_Proxy</code></td><td><code>Net_A</code><br><code>SIP_Proxy</code></td><td><code>sip-tcp</code><br>or<br><code>sip_tls_authentication</code><br>or<br><code>sip_tls_not_inspected</code></td><td><code>Accept</code></td><td>Gateway</td><td>SIP over TCP.<br>Bidirectional calls</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for IP Phones that are:  \n    \n    -   Managed by the SIP Proxy or Registrar.\n    -   Permitted to make calls, and those calls inspected by the Security Gateway.\n    \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Define the network object for the SIP Proxy or Registrar.  \n    In the above figure, this is '`SIP_Proxy`'.  \n    -   If the Proxy and Registrar are on a server that has one IP address, then define only one object.\n    -   If the Proxy and server are on the same server, but have different IP addresses, define an object for each IP address.\n3.  Configure the VoIP security rules.\n4.  Define Hide NAT (or Static NAT) for the phones in the internal network, edit the network object for '`Net_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method ('`Hide`' or '`Static`').\n5.  Install the security policy.\n\n**_(7-1-C) SIP Security Rule for Proxy-to-Proxy Topology:_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Rule_Proxy_to_Proxy_Topology.png)\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Proxy_A</code><br><code>Proxy_B</code></td><td><code>Proxy_A</code><br><code>Proxy_B</code></td><td><code>sip</code></td><td><code>Accept</code></td><td>Gateway</td><td>SIP over UDP.<br>Bidirectional calls</td></tr></tbody></table>\n\nor\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Proxy_A</code><br><code>Proxy_B</code></td><td><code>Proxy_A</code><br><code>Proxy_B</code></td><td><code>sip-tcp</code><br>or<br><code>sip_tls_authentication</code><br>or<br><code>sip_tls_not_inspected</code></td><td><code>Accept</code></td><td>Gateway</td><td>SIP over TCP.<br>Bidirectional calls</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for IP Phones.  \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Define the network object for the SIP Proxies  \n    In the above figure, these are '`Proxy_A`' and '`Proxy_B`'.  \n    -   If the Proxy and Registrar are on a server that has one IP address, then define only one object.\n    -   If the Proxy and server are on the same server, but have different IP addresses, define an object for each IP address.\n3.  Configure the VoIP security rules.\n4.  Define Hide NAT (or Static NAT) for the phones in the internal network - edit the network object for '`Net_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method ('`Hide`' or '`Static`').\n5.  Define Static NAT or the Proxy in the internal network - edit the network object for '`Proxy_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method '`Static`'.\n6.  Install the security policy.\n\n**_(7-1-D) SIP Security Rule for Proxy in DMZ Topology:_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_SIP_Rule_Proxy_in_DMZ_Topology.png)\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>Net_B</code><br><code>Proxy_DMZ</code></td><td><code>Net_A</code><br><code>Net_B</code><br><code>Proxy_DMZ</code></td><td><code>sip</code></td><td><code>Accept</code></td><td>Gateway</td><td>SIP over UDP.<br>Bidirectional calls</td></tr></tbody></table>\n\nor\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>Net_B</code><br><code>Proxy_DMZ</code></td><td><code>Net_A</code><br><code>Net_B</code><br><code>Proxy_DMZ</code></td><td><code>sip-tcp</code><br>or<br><code>sip_tls_authentication</code><br>or<br><code>sip_tls_not_inspected</code></td><td><code>Accept</code></td><td>Gateway</td><td>SIP over TCP.<br>Bidirectional calls</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for IP Phones.  \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Define the network object for the SIP Proxy.  \n    In the above figure, this is '`Proxy_DMZ`'.\n3.  Configure the VoIP security rules.\n4.  Define Hide NAT (or Static NAT) for the phones in the internal network - edit the network object for '`Net_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method ('`Hide`' or '`Static`').\n5.  Define Static NAT or the Proxy in the internal network - edit the network object for '`Proxy_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method '`Static`'.\n6.  Install the security policy.\n\n### **(7-2) H.323 Security Rules**\n\n**Note:** Refer to the Supported VoIP Deployments - H.323 section and to the Relevant Check Point NAT rules - H.323 section.\n\nImportant guidelines:\n\n-   To allow H.323 traffic, create rules that allow the H.323 control signals through the Security Gateway.\n-   It is not necessary to define a rule that specifies which ports to open and which endpoints can talk. The Security Gateway derives this information from the signaling. For a given H.323 signaling rule (with RAS and/or H.323 services), the Security Gateway automatically opens ports for the H.245 connections and RTP/RTCP media stream connections.\n-   Dynamic ports will be opened only if the port is not used by a different service. For example: if the '`Connect`' message identifies port 80 as the H.245 port, the port will not be opened. This prevents well-known ports from being used illegally.\n-   To allow H.323 traffic in the Security Rule Base, use regular Network objects. It is not necessary to define special Network objects.\n\n**_(7-2-A) H.323 Security Rule for Endpoint to Endpoint:_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_H323_Rule_Endpoint_to_Endpoint_Communication.png)\n\n**Important Note:** No incoming calls can be made when Hide NAT is configured for the internal phones.\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>Net_B</code></td><td><code>Net_A</code><br><code>Net_B</code></td><td><code>H323</code></td><td><code>Accept</code></td><td>Gateway</td><td>&nbsp;</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for IP Phones.  \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Configure the VoIP security rules.\n3.  Define Hide NAT (or Static NAT) for the phones in the internal network, edit the network object for '`Net_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method ('`Hide`' or '`Static`').\n4.  Install the security policy.\n\n**_(7-2-B) H.323 Security Rule for Gatekeeper-to-Gatekeeper Topology:_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_H323_Rule_Gatekeeper_to_Gatekeeper.png)\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>GK_A</code><br><code>GK_B</code></td><td><code>GK_A</code><br><code>GK_B</code></td><td><code>H323</code><br>and<br><code>H323_ras</code></td><td><code>Accept</code></td><td>Gateway</td><td>Bidirectional calls</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for  \n    \n    -   Phones that use the Gatekeeper for registration.\n    -   Allowed to make calls and their calls tracked by the Security Gateway.\n    \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Define the network objects for the Gatekeepers.  \n    In the above figure, these are '`GK_A`' and '`GK_B`'.\n3.  Configure the VoIP security rules.\n4.  Define Hide NAT (or Static NAT) for the phones in the internal network, edit the network object for '`Net_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method ('`Hide`' or '`Static`').\n5.  Define Static NAT for the Gatekeeper (or Gateway) in the internal network, edit the network object for '`GK_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method '`Static`'.\n6.  Set the Session Timeout of the '`H323_ras`' service equal to, or greater than the Gatekeeper's registration time-out.  \n    Right-click on the '`H323_ras`' service - '`Edit...`' - click on '`Advanced...`' button - in '`Session Timeout`' section, click on '`Other`' - set the desired value - click on '`OK`' to apply the changes.\n7.  Install the security policy.\n\n**_(7-2-C) H.323 Security Rule for Gateway-to-Gateway Topology:_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_H323_Rule_Gateway_to_Gateway.png)\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>GW_A</code><br><code>GW_B</code></td><td><code>GW_A</code><br><code>GW_B</code></td><td><code>H323</code></td><td><code>Accept</code></td><td>Gateway</td><td>Bidirectional calls</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for IP Phones.  \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Define the network objects for the Gateways.  \n    In the above figure, these are '`GW_A`' and '`GW_B`'.\n3.  Configure the VoIP security rules.\n4.  Define Hide NAT (or Static NAT) for the phones in the internal network, edit the network object for '`Net_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method ('`Hide`' or '`Static`').\n5.  Define Static NAT for the Gatekeeper/Gateway in the internal network, edit the network object for '`GW_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method '`Static`'.\n6.  Install the security policy.\n\n**_(7-2-D) H.323 Security Rule for Gatekeeper in the External Network:_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_H323_Rule_Gatekeeper_in_External_Network.png)\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>Net_B</code><br><code>GK_B</code></td><td><code>Net_A</code><br><code>GK_B</code></td><td><code>H323</code><br>and<br><code>H323_ras</code></td><td><code>Accept</code></td><td>Gateway</td><td>Bidirectional calls</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for the phones that  \n    \n    -   Use the Gatekeeper for registration\n    -   Are allowed to make calls and their calls tracked by the Security Gateway\n    \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Define the network objects for the Gatekeeper.  \n    In the above figure, this is '`GK_B`'.\n3.  Configure the VoIP security rules.\n4.  Define Hide NAT (or Static NAT) for the phones in the internal network, edit the network object for '`Net_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method ('`Hide`' or '`Static`').\n5.  Define Static NAT for the Gatekeeper/Gateway in the internal network, edit the network object for '`GW_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method '`Static`'.\n6.  Set the Session Timeout of the '`H323_ras`' service equal to, or greater than the Gatekeeper's registration time-out.  \n    Right-click on the '`H323_ras`' service - '`Edit...`' - click on '`Advanced...`' button - in '`Session Timeout`' section, click on '`Other`' - set the desired value - click on '`OK`' to apply the changes.\n7.  Install the security policy.\n\n**_(7-2-E) H.323 Security Rule for Gateway in the External Network:_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_H323_Rule_Gateway_in_External_Network.png)\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>Net_B</code><br><code>GW_B</code></td><td><code>Net_A</code><br><code>GW_B</code></td><td><code>H323</code></td><td><code>Accept</code></td><td>Gateway</td><td>Bidirectional calls</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for the phones that  \n    \n    -   Use the Gatekeeper for registration\n    -   Are allowed to make calls and their calls tracked by the Security Gateway\n    \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Define the network objects for the Gateway.  \n    In the above figure, this is '`GW_B`'.\n3.  Configure the VoIP security rules.\n4.  Define Hide NAT (or Static NAT) for the phones in the internal network, edit the network object for '`Net_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method ('`Hide`' or '`Static`').\n5.  Install the security policy.\n\n**_(7-2-F) H.323 Security Rule for Gatekeeper in DMZ_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_H323_Rule_Gatekeeper_in_DMZ.png)\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>Net_B</code><br><code>GK_DMZ</code></td><td><code>Net_A</code><br><code>Net_B</code><br><code>GK_DMZ</code></td><td><code>H323</code><br>and<br><code>H323_ras</code></td><td><code>Accept</code></td><td>Gateway</td><td>Bidirectional calls</td></tr></tbody></table>\n\nIn addition, the following Static NAT rules should be configured for the Gatekeeper in the DMZ:\n\n<table><tbody><tr><td colspan=\"3\">ORIGINAL PACKET</td><td colspan=\"3\">TRANSLATED PACKET</td><td rowspan=\"2\">COMMENT</td></tr><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td></tr><tr><td><code>GK_DMZ</code></td><td><code>Net_B</code></td><td><code>Any</code></td><td><code>GK_DMZ</code><br>(Static)</td><td><code>= Original</code></td><td><code>= Original</code></td><td>Outgoing calls</td></tr><tr><td><code>Net_B</code></td><td><code>GK_DMZ_NATed</code></td><td><code>Any</code></td><td><code>= Original</code></td><td><code>GK_DMZ</code><br>(Static)</td><td><code>= Original</code></td><td>Incoming calls</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for  \n    \n    -   Phones that use the Gatekeeper for registration.\n    -   Allowed to make calls and their calls tracked by the Security Gateway.\n    \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Define the network objects for the Gatekeeper.  \n    In the above figure, this is '`GK_DMZ`'.\n3.  Create the network object for the Static NATed IP address of the Gatekeeper.  \n    In the above example, this is `GK_DMZ_NATed`).\n4.  Configure the VoIP security rules.\n5.  Define Hide NAT (or Static NAT) for the phones in the internal network, edit the network object for '`Net_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method ('`Hide`' or '`Static`').\n6.  Define manual Static NAT rules for the Gatekeeper in the DMZ.\n    1.  Go to the '`NAT`' pane.\n    2.  Create the NAT rules as shown above.\n7.  Configure Proxy ARP per [sk30197](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk30197).  \n    You must associate the NATed IP address of the Gatekeeper with the MAC address of the Security Gateway's interface that is on the same network as the NATed IP address.\n8.  Set the Session Timeout of the '`H323_ras`' service equal to, or greater than the Gatekeeper's registration time-out.  \n    Right-click on the '`H323_ras`' service - '`Edit...`' - click on '`Advanced...`' button - in '`Session Timeout`' section, click on '`Other`' - set the desired value - click on '`OK`' to apply the changes.\n9.  Install the security policy.\n\n**_(7-2-G) H.323 Security Rule for Gateway in DMZ_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_H323_Rule_Gateway_in_DMZ.png)\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>Net_B</code><br><code>GW_DMZ</code></td><td><code>Net_A</code><br><code>Net_B</code><br><code>GW_DMZ</code></td><td><code>H323</code></td><td><code>Accept</code></td><td>Gateway</td><td>Bidirectional calls</td></tr></tbody></table>\n\nIn addition, the following Static NAT rules should be configured for the Security Gateway in the DMZ:\n\n<table><tbody><tr><td colspan=\"3\">ORIGINAL PACKET</td><td colspan=\"3\">TRANSLATED PACKET</td><td rowspan=\"2\">COMMENT</td></tr><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td></tr><tr><td><code>GW_DMZ</code></td><td><code>Net_B</code></td><td><code>Any</code></td><td><code>GW_DMZ</code><br>(Static)</td><td><code>= Original</code></td><td><code>= Original</code></td><td>Outgoing calls</td></tr><tr><td><code>Net_B</code></td><td><code>GW_DMZ_NATed</code></td><td><code>Any</code></td><td><code>= Original</code></td><td><code>GW_DMZ</code><br>(Static)</td><td><code>= Original</code></td><td>Incoming calls</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for  \n    \n    -   Phones that use the Gatekeeper for registration.\n    -   Allowed to make calls and their calls tracked by the Security Gateway.\n    \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Define the network objects for the Security Gateway.  \n    In the above figure, this is '`GW_DMZ`'.\n3.  Create the network object for the Static NATed IP address of the Gatekeeper.  \n    In the above example, this is `GW_DMZ_NATed`).\n4.  Configure the VoIP security rules.\n5.  Define Hide NAT (or Static NAT) for the phones in the internal network, edit the network object for '`Net_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method ('`Hide`' or '`Static`').\n6.  Define manual Static NAT rules for the Security Gateway in the DMZ.\n    1.  Go to the '`NAT`' pane.\n    2.  Create the NAT rules as shown above.\n7.  Configure Proxy ARP per [sk30197](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk30197).  \n    You must associate the NATed IP address of the Gatekeeper with the MAC address of the Security Gateway's interface that is on the same network as the NATed IP address.\n8.  Install the security policy.\n\n### **(7-3) MGCP Security Rules**\n\n**Note:** Refer to the Supported VoIP Deployments - MGCP section and to the Relevant Check Point NAT rules - MGCP section.\n\n**_(7-3-A) MGCP Security Rule for a Call Agent in the External Network:_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_MGCP_Rule_Call_Agent_in_External_Network.png)\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>MGCP_Call_Agent</code></td><td><code>Net_A</code><br><code>MGCP_Call_Agent</code></td><td><code>mgcp_CA</code><br>or<br><code>mgcp_MG</code><br>or<br><code>mgcp_dynamic_ports</code></td><td><code>Accept</code></td><td>Gateway</td><td>&nbsp;</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for IP Phones managed by the MGCP Call Agent.  \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Define the network object for the Call Agent.  \n    In the above figure, this is '`MGCP_Call_Agent`'.\n3.  Configure the VoIP security rules.\n4.  Define Hide NAT (or Static NAT) for the phones in the internal network, edit the network object for '`Net_A`':\n    1.  On the '`NAT`' tab, check the box '`Add Automatic Address Translation Rules`'.\n    2.  Select the Translation method ('`Hide`' or '`Static`').\n5.  Install the security policy.\n\n**_(7-3-B) MGCP Security Rule for a Call Agent in the DMZ:_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_MGCP_Rule_Call_Agent_in_DMZ.png)\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>Net_B</code><br><code>MGCP_Call_Agent</code></td><td><code>Net_A</code><br><code>Net_B</code><br><code>MGCP_Call_Agent</code></td><td><code>mgcp_CA</code><br>or<br><code>mgcp_MG</code></td><td><code>Accept</code></td><td>Gateway</td><td>Bidirectional calls</td></tr></tbody></table>\n\n1.  Define the network objects (Nodes or Networks) for IP Phones managed by the MGCP Call Agent.  \n    In the above figure, these are '`Net_A`' and '`Net_B`'.\n2.  Define the network object for the Call Agent.  \n    In the above figure, this is '`MGCP_Call_Agent`'.\n3.  Configure the VoIP security rules.\n4.  Install the security policy.\n\n**_(7-3-C) MGCP Security Rule for a Call Agent to Call Agent:_**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_MGCP_Rule_Call_Agent_to_Call_Agent.png)\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td>Call_Agent_Int<br>Call_Agent_Ext</td><td>Call_Agent_Int<br>Call_Agent_Ext</td><td><code>mgcp_CA</code><br>or<br><code>mgcp_MG</code></td><td><code>Accept</code></td><td>Gateway</td><td>Bidirectional calls</td></tr></tbody></table>\n\n1.  Define the network objects for for the Proxy objects.  \n    In the above figure, these are '`Call_Agent_Int`' and '`Call_Agent_Ext`'.\n2.  Configure the VoIP security rules.\n3.  Install the security policy.\n\n### **(7-4) SCCP Security Rules**\n\n**Note:** Refer to the Supported VoIP Deployments - SCCP (Skinny) section and to the Relevant Check Point NAT rules - SCCP (Skinny) section.\n\n**_(7-4-A) SCCP Security Rule for SCCP over TCP:_**\n\n<table><tbody><tr><td>SOURCE</td><td>DESTINATION</td><td>SERVICE</td><td>ACTION</td><td>INSTALL ON</td><td>COMMENT</td></tr><tr><td><code>Net_A</code><br><code>Net_B</code><br><code>Call_Manager</code></td><td><code>Net_A</code><br><code>Net_B</code><br><code>Call_Manager</code></td><td><code>SCCP</code></td><td><code>Accept</code></td><td>Gateway</td><td>Incoming and<br>Outgoing calls</td></tr></tbody></table>\n\n**_(7-4-B) SCCP Security Rule for Secure SCCP - encrypted SCCP over TCP (TLS):_**\n\n**Note:** Supported only on Security Gateways / Security Management Servers running R75.40VS / R76 / R77 and above.\n\n1.  Define Network objects (Nodes or Networks) for SCCP endpoints (Cisco ATA devices or IP Phones) controlled by the Call Managers.\n2.  Define a Host object that represents the Call Manager.\n3.  Define the SCCP VoIP security rules.\n4.  Define other security rules for SCCP and the other VoIP protocols (SCCP interoperates with other VoIP protocols).\n    \n    This rule lets all phones in '`Net_A`' and '`Net_B`' make calls to each other:\n    \n    -   '`Net_A`' is the internal IP phone network\n    -   '`Net_B`' is the external IP phone network\n    -   The Call Manager (Call\\_Manager) can be in:  \n        -   The internal or external network.\n        -   A DMZ connected to a different interface of the gateway.\n5.  To secure encrypted SCCP over TCP connections:\n    1.  Create an identical security rule.\n    2.  In the '`Service`' column, add only the following service:  \n        -   For encrypted SCCP over TCP (TLS): **`Secure_SCCP`**\n        -   For media to or from Secure SCCP phones: **`high_udp_for_secure_SCCP`**\n6.  Install the security policy.\n\n## (8) Relevant Check Point NAT rules\n\n**Note:** Refer to the Supported VoIP Deployments section and to the Relevant Check Point Security rules section.\n\n### **(8-1) SIP NAT Rules**\n\n**Note:** Refer to the Supported VoIP Deployments - SIP section and to the Relevant Check Point Security rules - SIP section.\n\nImportant guidelines:\n\n-   When using Hide NAT for SIP over UDP, you must include the hiding IP address in the destination of the SIP rule.\n-   When using Hide NAT for SIP over TCP, you must include the hiding IP address in the destination of the SIP rule.  \n    Doing this allows the initiation of TCP handshake from the external network to the hiding IP address.\n-   NAT is performed for all connection in the call - SIP and RTP/RTCP packets.\n-   NAT is performed on the IP headers and payload (SIP and SDP).\n-   Throughout a call, a combination of specific \\[IP address + port\\] should be translated in the same way each time they are detected.\n-   For NAT on SIP entities, it is strongly recommended that you enable the IPS protection **Strict SIP Protocol Flow Enforcement**.\n\n### **(8-2) H.323 NAT Rules**\n\n**Note:** Refer to the Supported VoIP Deployments - H.323 section and to the Relevant Check Point Security rules - H.323 section.\n\nImportant guidelines:\n\n-   NAT ('`Hide`' or '`Static`') can be configured for the phones in the internal network, and (where applicable) for the Gatekeeper.\n-   NAT is **not** supported on IP addresses behind an external Security Gateway interface.\n-   Manual NAT rules are supported only in environments where the Gatekeeper is in the DMZ.\n-   When using Hide NAT for H.323 traffic, include the hiding IP address in the '`Destination`' column of the H.323 NAT rule. This allows the initiation of a TCP handshake from the external network to the hiding IP address.\n\n<table><tbody><tr><td>Supported H.323 Topology</td><td>No NAT</td><td>NAT for Internal Phones<br>(Hide/Static)</td><td>NAT for Gatekeeper<br>(Static)</td><td>Notes</td></tr><tr><td>H.323 Endpoint to Endpoint</td><td>Yes</td><td>Static NAT only</td><td>Not applicable</td><td>The IP Phones communicate directly, without a Gatekeeper or an H.323 Gateway.<br>Static NAT can be configured for the phones on the internal side of the Security Gateway.</td></tr><tr><td>Gatekeeper or H.323 Gateway in External Network</td><td>Yes</td><td>Yes</td><td>Not applicable</td><td>The IP Phones use the services of a Gatekeeper or H.323 Gateway on the external side of the Security Gateway.<br>This topology enables using the services of a Gatekeeper or an H.323 Gateway that is maintained by another organization.<br>It is possible to configure Hide NAT / Static NAT / no NAT for the phones on the internal side of the Security Gateway.</td></tr><tr><td>H.323 Gatekeeper/<br>Gateway to Gatekeeper/<br>Gateway</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Each Gatekeeper or H.323 Gateway controls a separate endpoint domain.<br>Static NAT can be configured for the internal Gatekeeper.<br>For the internal phones, Hide NAT / Static NAT can be configured.</td></tr><tr><td>Gatekeeper or H.323 Gateway in the DMZ</td><td>Yes</td><td>Yes</td><td>Yes</td><td>Each Gatekeeper or H.323 Gateway controls a separate endpoint domain.<br>Static NAT / no NAT can be configured for the Gatekeeper or H.323 Gateway.<br>Hide NAT / Static NAT / no NAT can be configured for the phones on the internal side of the Security Gateway.</td></tr></tbody></table>\n\n### **(8-3) MGCP NAT Rules**\n\n**Note:** Refer to the Supported VoIP Deployments - MGCP section and to the Relevant Check Point Security rules - MGCP section.\n\nImportant guidelines:\n\n-   It is possible to configure NAT ('`Hide`' or '`Static`') for the phones in the internal network.\n-   NAT is **not** supported on IP addresses behind an external Security Gateway interface.\n-   The SmartDashboard configuration depends on the MGCP topology.\n\n<table><tbody><tr><td>Supported MGCP Topology</td><td>No NAT</td><td>NAT for Internal Phones<br>(Hide/Static)</td><td>Notes</td></tr><tr><td>Call Agent in External network</td><td>Yes</td><td>Yes</td><td>The IP Phones use the services of a Call Agent on the external side of the Security Gateway.<br>This topology enables using the services of a Call Agent that is maintained by another organization.<br>It is possible to configure Hide NAT (or Static NAT or no NAT) for the phones on the internal side of the Security Gateway.</td></tr><tr><td>Call Agent in DMZ</td><td>Yes</td><td>No</td><td>The same Call Agent controls both endpoint domains.<br>This topology makes it possible to provide Call Agent services to other organizations.</td></tr><tr><td>Call Agent to Call Agent</td><td>Yes</td><td>No</td><td>Each Call Agent controls a separate endpoint domain.<br>Where there is one or more Call Agents, the signaling passes through each Call Agent. Once the call has been set up, the media can pass endpoint to endpoint.</td></tr></tbody></table>\n\n**Additional Conditions for Using NAT in MGCP Networks**\n\nYou can use MGCP with Network Address Translation (NAT), but:\n\n-   Manual NAT rules are not supported. Use Automatic NAT.\n-   Calls cannot be made from an external source to two endpoints on the trusted side of a gateway if one of the endpoints is NATed and the other is not.\n-   Bidirectional NAT of VoIP calls is not supported.\n\n**Important Note:** Hide NAT can be used for all types of calls (incoming, outgoing, internal and external). For security reasons, when using Hide NAT for incoming calls, the **Destination** of the VoIP call in the Rule Base cannot be **Any**.\n\n### **(8-4) SCCP NAT Rules**\n\n**Note:** Refer to the Supported VoIP Deployments - SCCP (Skinny) section and to the Relevant Check Point Security rules - SCCP (Skinny) section.\n\nNAT on SCCP devices is **not** supported.\n\n## (9) Relevant Check Point kernel tables\n\nNotes:\n\n-   All SIP kernel tables are synchronized in cluster environment.\n-   In order to increase the size limit of a kernel table, edit the relevant '`table.def`' file on the Management Server - change the value of the '`limit`' attribute (for locations of the relevant '`table.def`' files, refer to [sk31832 (How to prevent ClusterXL / VRRP / IPSO IP Clustering from hiding its own traffic behind Virtual IP address](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk31832)).\n-   For additional information about the sizes of relevant SIP kernel tables, refer to [Enlarging kernel tables for concurrent SIP calls](http://downloads.checkpoint.com/dc/download.htm?ID=10333).\n-   Refer to _Command Line Interface Reference Guide_ ([R70](http://downloads.checkpoint.com/dc/download.htm?ID=8713), [R71](http://downloads.checkpoint.com/dc/download.htm?ID=10324), [R75](http://downloads.checkpoint.com/dc/download.htm?ID=11657), [R75.20](http://downloads.checkpoint.com/dc/download.htm?ID=12264), [R75.40](http://downloads.checkpoint.com/dc/download.htm?ID=13944), [R75.40VS](http://downloads.checkpoint.com/dc/download.htm?ID=16262), [R76](http://downloads.checkpoint.com/dc/download.htm?ID=22909), [R77](http://downloads.checkpoint.com/dc/download.htm?ID=24833)) - Chapter 'Security Management Server and Firewall Commands' - fw - fw tab.\n\nTables:\n\n<table><tbody><tr><td id=\"Relevant Check Point kernel tables - SIP\" colspan=\"2\">(9-1) SIP</td></tr><tr><td><code>sip_registration</code></td><td>Holds one entry for each registered phones (internal phones). An entry is inserted when the registration is completed (200 OK). Timeout - the value from the expires header field or default.<p>To view a list of the online IP phones, run this command:<br><strong><code>[Expert@HostName]# fw tab -t sip_registration -f</code></strong></p></td></tr><tr><td><code>sip_state</code></td><td>Holds one entry for each SIP call (call-id + users' tags). An entry is inserted with the first packet of the call. Each SIP call has 2-4 SIP connections. Calls entries should remain until call is terminated. Timeout - 180 seconds, and is refreshed as long as RTP is alive (for non-Int2Int calls). Note that the entries are per Call-ID, B2BUA may set 2 entries per call.<p>To view information on the current calls, run this command:<br><strong><code>[Expert@HostName]# fw tab -t sip_state -f</code></strong></p><p>The following output appears:</p><ul><li>Control connection (source, destination).</li><li>RTP connection (endpoint IP addresses).</li><li>Call state (established, ended, registration).</li><li>Media type (audio, video, audio/video, application).</li><li>Number of reinvites (number of participants in a conference call).</li></ul></td></tr><tr><td><code>sip_cseq</code></td><td>Holds one entry per Transaction (SIP request + SIP response). An entry is inserted with the SIP Request. Timeout - 40 seconds, 20 for retransmissions.</td></tr><tr><td><code>sip_services</code></td><td>Holds all the services that are defined as SIP in the rulebase.</td></tr><tr><td><code>sip_dynamic_port</code></td><td>Holds entries for SIP communication for non-5060 port. Relevant only if '<code>sip_dynamic_port</code>' service is used. Timeout - the value from the expires header field or default.</td></tr><tr><td><code>fwx_sticky_port</code></td><td>Holds port allocation entries, only when using NAT and sticky mechanism. Used in order to translate the port consistently. Call entries should remain until call is terminated.</td></tr><tr><td><code>fwx_alloc</code></td><td>Holds port allocation entries, only when using NAT. Same entries that are displayed in the '<code>fwx_sticky_port</code>' kernel table. Call entries should remain until call is terminated.</td></tr><tr><td><code>fwx_pending</code></td><td>Used to store pending NAT instructions.</td></tr><tr><td><code>earlynat_sport</code></td><td>Holds 5 entries for each SIP UDP connection (1 entry and 1 link for each direction of the connection and 1 link for Bi-Directional SIP).</td></tr><tr><td id=\"Relevant Check Point kernel tables - H.323\" colspan=\"2\">(9-2) H.323</td></tr><tr><td><code>h323_registration</code></td><td>Holds one entry for each registered phones (internal phones).</td></tr><tr><td><code>fwx_sticky_port</code></td><td>Holds port allocation entries, only when using NAT and sticky mechanism. Used in order to translate the port consistently. Call entries should remain until call is terminated.</td></tr><tr><td id=\"Relevant Check Point kernel tables - MGCP\" colspan=\"2\">(9-3) MGCP</td></tr><tr><td><code>mgcp_registration</code></td><td>Holds one entry for each registered phones (internal phones).</td></tr><tr><td><code>mgcp_services</code></td><td>Holds all the services that are defined as SIP in the rulebase.</td></tr><tr><td><code>mgcp_dynamic_port</code></td><td>Holds entries for MGCP communication for non MGCP well-known ports - only if mgcp_dynamic_port service is used.</td></tr><tr><td><code>mgcp_cmd</code></td><td>Holds all the MGCP commands that can take place in the protocol. In MGCP SD you can add new MGCP commands, new entry supposed to be added to this table.</td></tr><tr><td><code>mgcp_conn</code></td><td>Holds MGCP control connections (like the '<code>sip_state</code>' kernel table). Has an entry for each MGCP call. Call entries should remain until call is terminated.</td></tr><tr><td><code>mgcp_tid</code></td><td>Every command or transaction has its own TID (Transaction ID). Every new TIF is added to this kernel table. There is verification that every request has a matched response.</td></tr></tbody></table>\n\n## (10) Check Point Security Gateway and VoIP traffic\n\n**(10-1) SecureXL**\n\n-   Media connections are accelerated.\n-   Signaling connections are **not** accelerated.\n-   NAT on IP header is accelerated.\n\n**(10-2) CoreXL**\n\n-   When CoreXL is enabled, VoIP control connections are processed only in global CoreXL FW instance #0 (fw\\_worker\\_0). By design, global CoreXL FW instance #0 (fw\\_worker\\_0) always runs on the CPU core with highest ID (as allowed by the current CoreXL license).\n    \n    **Note:** This is relevant for H323 and Skinny (SCCP), but not for SIP - in R80.40 and higher versions.\n    \n\n**(10-3) ClusterXL**\n\n-   Not 100% (for TCP, for example, only after call establishment).\n\n**(10-4) SIP interoperability with NAT**\n\nWhen NAT is configured, it is applied on all the section of the call - SIP and RTP (RTCP). NAT will be applied accordingly to the IP header and to the SIP payload. For example: on an _Invite_ packet (going out from the internal network), the IP address will be NATed to the external public IP address along with the SDP inside. The values will be changed to public IP addresses.\n\nPotential NAT issues (some examples):\n\n-   Phone communicates with the proxy:  \n    The phone will initialize a registration from a random destination port to 5060 and close the connection. When the proxy redirects a new call, where should it be connected (reg or new call)? What if the port is closed by a Security Gateway? The client on the other side sent the request to port 5060; should we translate it (and then translate is back)?\n-   Proxy to proxy communications:  \n    Inter-proxy communications will be performed continually. Obviously, port 5060 will be used for any SIP communication. How will the servers react to a large number of calls that are coming from different destination ports?\n-   The issue gets more and more complicated when a whole SIP network is active with phones and proxies on different sides of the Security Gateway.\n\nUsing one port presented a difficulty for Security Gateway:\n\n-   Hide NAT issues:  \n    More than one connection could not be hidden behind port 5060. Further more incoming connection could not be routed correctly.\n-   Logging issues:  \n    How can the FW log different calls on the same connections. Usually one connection per log but in this case every call should be logged separately.\n\nThe solution - apply internal _Early NAT_ and internal _Late NAT_ on the SIP connections:\n\nNote: Refer to the Check Point Definitions section.\n\n-   Every incoming SIP connection will undergo an internal NAT mechanism in Check Point Security Gateway, in which the ports will be NATed to a high port (over 10 000) after the Pre-Inbound chain \"i\" (Early NAT) and then NATed back to the original port 5060 before the Post-Outbound chain \"O\" (Late NAT).\n-   Early NAT and Late NAT are performed even when no NAT is configured.\n-   This is ports-only translation, which is usually performed on the Source port of the packet. In Bi-Directional SIP configuration (2 RTP ports), the Early NAT / Late NAT is performed on the Destination port of the packet.\n-   Performed only on SIP over UDP.\n\n**(10-5) VoIP protections and IPS**\n\n-   In Management Server R77.30 and lower, VoIP protections are configured in the IPS.\n    \n-   In Management Server R80 and above, VoIP protections are _no longer_ configured in the IPS:\n    \n    Note: These VoIP protections can be configured without VoIP license.\n    \n    1.  In SmartConsole, on the left Navigation Toolbar, click on the \"_**MANAGE & SETTINGS**_\"\n    2.  In the upper middle section, click on the _**Blades**_\n    3.  In the _**General**_ section, click on the _**Inspection Settings...**_ button\n    \n    _Example_:\n    \n    [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_Example_from_R80_10_SmartConsole_Inspection_Settings.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95369/sk95369_Example_from_R80_10_SmartConsole_Inspection_Settings.png \"Click the image to see it in full size in a new tab/window\")\n\n## (11) Troubleshooting VoIP traffic on Check Point Security Gateway\n\n### (11-1) Things that can go wrong\n\n-   Illegal redirection.\n-   Entry in the kernel table '`sip_state`' disappears before the call is terminated.\n-   Early NAT / Late NAT is not performed.\n-   RTP is translated to an odd port.\n-   RTCP != RTP+1.\n-   Ports are not translated consistently.\n-   Ports leak (entries in the kernel table '`fwx_sticky_port`' that are not deleted after entries in the kernel table '`fwx_pending`' and connections entries in the kernel table '`connections`' are expired).\n-   Internal IP addresses are seen by the external host.\n-   No un-NAT when needed (Int2Int calls).\n-   Content length is incorrect after NAT.\n-   Memory leaks.\n-   SIP tables are not synchronized between cluster members.\n-   TCP connections do not survive failover in cluster.\n-   SIP / RTP is not encrypted even though a VPN is configured.\n-   Calls do not survive policy installation.\n\n### (11-2) General action plan\n\n-   Classify the problem - Signaling or Media connections.\n-   Check whether it is a Known Limitation (refer to 'Known Limitations' pages on SecureKnowledge).\n-   Check the VoIP Administration Guide.\n-   Disable all special/advanced features and Software Blades and re-test:\n    -   NAT\n    -   SecureXL\n    -   ClusterXL\n    -   VPN\n    -   etc.\n-   Collect the relevant debugs - refer to the Debugging Check Point Security Gateway section and to the Debug instructions section.\n-   [Contact Check Point Support](http://www.checkpoint.com/services/contact/index.html) to for assistance.\n    \n    Provide all the required information about the environment:\n    \n    -   Involved protocols (UDP, TCP, video, audio, etc.).\n    -   All IP addresses and ports, including NAT.\n    -   SmartView Tracker logs.\n    -   Clients and Server types.\n    -   Rule base configuration (Security and NAT).\n    -   IPS configuration.\n    -   Additional Software Blades (NAT, SecureXL, CoreXL, VPN, etc.).\n    -   Topology diagram that depicts all machines involved in this VoIP issue.\n    -   CPinfo file from all involved Security Gateways.\n    -   CPinfo file from all involved Management Server.\n    -   Kernel Debug and Traffic Captures - from the beginning of the VoIP session.\n\n## (12) Debugging Check Point Security Gateway\n\nIn order to see how the Security Gateway processes the traffic, and how the internal components are working, a debug of Check Point kernel should be run on this Security Gateway (depending on the issue, it might also be required to run a debug of the relevant user space daemon).\n\nSome debugs print so much information, that the load on CPU might increase to 100% and render the Security Gateway unresponsive.\n\n**Note:** It is always recommended to run the kernel debug during a scheduled maintenance window in order to minimize the impact on production traffic and on users.\n\n### (12-1) Debugging syntax\n\n```\n<strong>[Expert@GW_HostName]# fw ctl debug -h</strong>\nfw ctl debug [-d &lt;strings&gt;] [-s \"&lt;string&gt;\"] [-v (\"&lt;VSIDs&gt;\"|all)] [-k] [-x] [-m &lt;module&gt;] [-e expr |-i &lt;filter-file|-&gt; | -u] [+|-] &lt;options | all | 0&gt;\nOr: fw ctl debug [-t (NONE|ERR|WRN|NOTICE|INFO)] [-f (RARE|COMMON)]\nOr: fw ctl debug -buf [buffer size][-v (\"&lt;VSIDs&gt;\"|all)][-k]\n-h - for help\n-e - Set debug filter to expr (inspect script)\n-i - Set debug filter from filter-file (- is the standard input)\n-u - Unset debug filtering\n```\n\n-   To display **all** kernel debugging modules and **all** their flags that this machine **supports**:\n    \n    **`[Expert@GW_HostName]# fw ctl debug -m`**\n    \n-   To display **all** kernel debugging modules and their flags **that were turned on**:\n    \n    **`[Expert@GW_HostName]# fw ctl debug`**\n    \n-   To display **all** debugging flags **that were turned on** for **this** kernel debugging module:\n    \n    **`[Expert@GW_HostName]# fw ctl debug -m _MODULE_`**\n    \n-   To set **default** kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug 0`**\n    \n    > Notes:  \n    > \n    > -   Some debug flags are enabled by default (`error`, `warning`) in various kernel debugging modules, so that some generic messages are printed into Operating System log (Linux OS: `/var/log/messages`; Windows OS: `Event Viewer`).\n    > -   This command should be issued before starting any kernel debug.\n    > -   This command must be issued to stop the kernel debug.\n    \n-   To unset all kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug -x`**\n    \n    > Note:  \n    > \n    > -   This unsets all debug flags, which means that none of the relevant messages will be printed. Default debug flags should be enabled.\n    \n-   To set kernel debugging buffer:\n    \n    **`[Expert@GW_HostName]# fw ctl debug -buf 32000`**\n    \n    > Notes:  \n    > \n    > -   Default size of the debugging buffer is 50 KB\n    > -   Maximal size of the debugging buffer is 32768 KB\n    > -   **Unless the size of the debugging buffer is increased from default 50 KB, the debug will not be redirected to a file (debug messages will be printed into Operating System log)**\n    > -   Debug messages are collected in this buffer, and a user space process (`$FWDIR/bin/fw`) collects them and prints into the output file.\n    \n-   To print debug messages into the output file (start the kernel debug):\n    \n    **`[Expert@GW_HostName]# fw ctl kdebug -T -f > /var/log/debug.txt`**\n    \n    > Note:  \n    > \n    > -   If you need to use this command in shell scripts, then add an ampersand at the end to run the command in the background (fw ctl kdebug -T -f > /var/log/debug.txt &).\n    \n-   To stop the kernel debug:\n    \n    Press CTRL+C and set the default kernel debug options  \n    **`[Expert@GW_HostName]# fw ctl debug 0`**\n    \n    > Note:  \n    > \n    > -   If you started the kernel debug via shell script, the you should just set the default kernel debug options.\n    \n\n**Important Notes about '`cpstop`' and '`cpstart`':**\n\n-   When running the '`cpstop`' command, all Check Point services are stopped - and the kernel debug will stop printing debug messages.\n-   When running the '`cpstart`' command (after the '`cpstop`'), the kernel debug will continue printing debug messages.\n\n**Important Notes about Security Gateway in VSX mode:**\n\n-   In **VSX NGX / VSX R6x**, the kernel debug commands can be run from context of any Virtual Device.\n-   In **VSX R6x**, if you wish to filter the debug for messages only from specific Virtual Devices, then use specify the relevant VSID in the syntax when setting flags:\n    \n    **`[Expert@GW_HostName:0]# fw ctl debug -v _<VSID1>_, _<VSID2>_ -m _MODULE_ + flags`**\n    \n    Note: Refer to [_VSX NGX R65 Administration Guide_](http://downloads.checkpoint.com/dc/download.htm?ID=7944) - 'Per Virtual System Debugging'.\n    \n-   In **R75.40VS and above**, you have to switch to the context of the specific Virtual Device, and then run the usual debugging commands:\n    \n    **`[Expert@GW_HostName:0]# vsenv _<VSID>_`**  \n    **`[Expert@GW_HostName:_<VSID>_]# fw ctl debug ...`**\n    \n\n### (12-2) Debugging action plan\n\n1.  Prepare the kernel debug options:\n    1.  Set default kernel debug options:\n        \n        **`[Expert@GW_HostName]# fw ctl debug 0`**\n        \n        Should get this message:  \n        `Defaulting all kernel debugging options`\n        \n    2.  Set kernel debug buffer:\n        \n        **`[Expert@GW_HostName]# fw ctl debug -buf 32000`**\n        \n        Should get this message:  \n        `Initialized kernel debugging buffer to size 32000K`\n        \n        **Note:**\n        \n        -   Any other message means that there was a problem allocating the buffer, and you should not continue until that issue is resolved (e.g., \"`Failed to allocate kernel debugging buffer`\").\n    3.  Set relevant kernel debug flags in relevant kernel debugging modules:\n        \n        **`[Expert@GW_HostName]# fw ctl debug -m _MODULE_ + _FLAG1 FLAG2 ... FLAGn_`**  \n        or  \n        **`[Expert@GW_HostName]# fw ctl debug -m _MODULE_ all`**\n        \n        Should get this message:  \n        `Updated kernel's debug variable for module _MODULE_`\n        \n        **Note:**\n        \n        -   Pay close attention to the name of the kernel debug module.\n2.  Verify the kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug -m _MODULE_`**\n    \n    Should get this output:  \n    `Kernel debugging buffer size: **32000KB**   Module: **_MODULE_**   Enabled Kernel debugging options: **_LIST OF FLAGS_**`\n    \n    **Notes:**\n    \n    -   Pay close attention to the size of the kernel debugging buffer.\n    -   Pay close attention to the name of the kernel debugging module.\n    -   The order of the flags in this output does not matter - just all the flags you set have to be here.\n3.  Start the kernel debug:\n    \n    **`[Expert@GW_HostName]# fw ctl kdebug -T -f > /var/log/debug.txt`**\n    \n    Should see the blinking cursor - the debug has started.\n    \n    You can open a new shell and verify that the information is written into the output file:  \n    **`[Expert@GW_HostName]# tail -f /var/log/debug.txt`**\n    \n4.  If needed, start capturing the relevant traffic:\n    \n    1.  Start Check Point FW Monitor (refer to [sk30583](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk30583)).\n    2.  Start TCPdump on relevant interfaces (refer to [TCPdump manual page](http://linux.die.net/man/8/tcpdump)).\n    \n    **Note:**\n    \n    -   It is strongly recommended to filter only the relevant traffic.\n5.  Replicate the issue:\n    1.  Initiate the problematic traffic (write down exact times, IP addresses, ports, etc).\n    2.  Repeat the steps that lead to unwanted behaviour.\n    3.  Make sure the issue was replicated.\n6.  Stop the kernel debug and set default kernel debug options:\n    \n    **Press CTRL+C**  \n    **`[Expert@GW_HostName]# fw ctl debug 0`**\n    \n7.  Stop the traffic captures:\n    \n    **Press CTRL+C**\n    \n8.  Collect the debug output files (from kernel debug and traffic captures) and all other related files (OS logs, CPinfo files, daemons' logs, SmartView Tracker logs, etc).\n\n### (12-3) Debugging Modules and Flags\n\nThis section covers the **most relevant** kernel parameters and debugging modules.\n\n**Note:** [Contact Check Point Support](http://www.checkpoint.com/services/contact/index.html) to get more precise debug instructions that are relevant to your specific issue.\n\n**Global Kernel parameters**\n\nBefore starting the kernel debug itself, pay attention to the following global kernel parameters relevant to relevant to cluster issues (after debug, set the default values):\n\n-   Disable this kernel parameter to disable the limit on the debug messages time window (default - 60 ; zero - disables the limit):\n    \n    **`[Expert@Member_HostName]# fw ctl set int fw_kdprintf_limit_time 0`**\n    \n-   Disable this kernel parameter to disable the limit on the amount of debug messages (default - 30 ; zero - disables the limit) that are printed within specified time (`fw_kdprintf_limit_time`):\n    \n    **`[Expert@Member_HostName]# fw ctl set int fw_kdprintf_limit 0`**\n    \n-   Set this kernel parameter to print the dump of each packet when '`packet`' flag is enabled in '`fw`' module (very helpful for Check Point RnD):\n    \n    **`[Expert@Member_HostName]# fw ctl set int fw_debug_dump_packet 1`**\n    \n    Notes:\n    \n    -   This parameter is available only in R75.40VS, in R76, in R77 and above.\n    -   Enabling the debug with flag '`packet`' in '`fw`' module creates high load on CPU.\n    -   Enabling the parameter '`fw_debug_dump_packet`' creates high load on CPU.\n\n**Kernel debugging modules and debug flags**\n\n-   _**Firewall**_ module: `fw ctl debug -m **fw** + _flag1 flag2 ... flagN_`\n    \n    <table><tbody><tr><td>Flag</td><td>Explanation</td></tr><tr><td><code>conn</code></td><td>Connections Table issues</td></tr><tr><td><code>drop</code></td><td>Associates a reason for (almost) every dropped packet</td></tr><tr><td><code>error</code></td><td>Various general error messages (enabled by default)</td></tr><tr><td><code>hold</code></td><td>Holding mechanism and all packets being held / released</td></tr><tr><td><code>ld</code></td><td>Kernel dynamic tables infrastructure - reads and writes to the tables (<em>machine can hang!</em>)</td></tr><tr><td><code>link</code></td><td>Link creation in Connections Table</td></tr><tr><td><code>log</code></td><td>Everything related to creating of logs</td></tr><tr><td><code>mgcp</code></td><td>Media Gateway Control Protocol (complementary to H.323 and SIP)</td></tr><tr><td><code>msnms</code></td><td>MSN over MSMS (MSN Messenger protocol) - always include '<code>sip</code>' flag</td></tr><tr><td><code>nat</code></td><td>NAT issues - basic information</td></tr><tr><td><code>sip</code></td><td>VoIP traffic - SIP and H.323</td></tr><tr><td><code>sync</code></td><td>ClusterXL - state synchronization operations</td></tr><tr><td><code>ua</code></td><td>VoIP traffic - Universal Alcatel \"UA\" Protocol</td></tr><tr><td><code>vm</code></td><td>Virtual Machine chain decisions</td></tr><tr><td><code>warning</code></td><td>Various general warning messages (enabled by default)</td></tr><tr><td><code>xlate</code></td><td>NAT issues - basic information</td></tr><tr><td><code>xltrc</code></td><td>NAT issues - additional information - going through NAT rulebase</td></tr></tbody></table>\n    \n-   _**Check Point Active Streaming**_ module: `fw ctl debug -m **CPAS** + _flag1 flag2 ... flagN_`\n    \n    <table><tbody><tr><td>Flag</td><td>Explanation</td></tr><tr><td><code>api</code></td><td>Interface layer messages</td></tr><tr><td><code>conns</code></td><td>Detailed description of connections, and connection's limit-related messages</td></tr><tr><td><code>error</code></td><td>Errors: the connection is probably rejected</td></tr><tr><td><code>events</code></td><td>Event-related messages</td></tr><tr><td><code>glue</code></td><td>Glue layer messages</td></tr><tr><td><code>pkts</code></td><td>Packets handling messages (allocation, splitting, resizing, etc.)</td></tr><tr><td><code>skinny</code></td><td>SCCP (Skinny Client Control Protocol) - Cisco proprietary VoIP protocol</td></tr><tr><td><code>sync</code></td><td>ClusterXL - state synchronization operations</td></tr><tr><td><code>tcp</code></td><td>TCP processing messages</td></tr><tr><td><code>tcpinfo</code></td><td>TCP processing messages - more detailed description</td></tr><tr><td><code>timer</code></td><td>Reports of timer ticks (pours many messages, without real content)</td></tr><tr><td><code>warning</code></td><td>Warnings: may affect connection's behavior</td></tr></tbody></table>\n    \n-   _**H.323**_ module: `fw ctl debug -m **h323** + _flag1 flag2 ... flagN_`\n    \n    <table><tbody><tr><td>Flag</td><td>Explanation</td></tr><tr><td><code>align</code></td><td>VoIP debug general messages (e.g., VoIP infrastructure)</td></tr><tr><td><code>cpas</code></td><td>CPAS TCP debug messages - since H323 : H225 and H245 are over TCP ;<br>Note: this flag is <strong>not</strong> included when debug is run with \"<code>all</code>\" flag (<code>fw ctl debug -m h323 all</code>)</td></tr><tr><td><code>decode</code></td><td>H.323 decoder messages</td></tr><tr><td><code>error</code></td><td>Various general error messages (enabled by default)</td></tr><tr><td><code>h225</code></td><td>H.225 call signaling messages (<code>SETUP</code>, <code>CONNECT</code>, <code>RELEASE COMPLETE</code>, etc.)</td></tr><tr><td><code>h245</code></td><td>H.245 control signaling messages (<code>OPEN LOGICAL CHANNEL</code>, <code>END SESSION COMMAND</code>, etc.)</td></tr><tr><td><code>init</code></td><td>Used for internal errors</td></tr><tr><td><code>ras</code></td><td>H225 RAS messages (<code>REGISTRATION</code>, <code>ADMISSION</code>, and <code>STATUS REQUEST / RESPONSE</code>)</td></tr></tbody></table>\n    \n-   _**Cluster**_ module: `fw ctl debug -m **cluster** + _flag1 flag2 ... flagN_`\n    \n    Refer to [sk93306 - ATRG: ClusterXL R6x and R7x](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk93306) - chapter 'ClusterXL Debugging'.\n    \n    <table><tbody><tr><td>Flag</td><td>Explanation</td></tr><tr><td><code>accel</code></td><td>Related to status and support of SecureXL (use with '<code>conf</code>')</td></tr><tr><td><code>conf</code></td><td>Configuration and policy installation</td></tr><tr><td><code>df</code></td><td>Decision Function - decides, which member will handle each packet in a Load Sharing mode</td></tr><tr><td><code>drop</code></td><td>Connections dropped by the CXL Decision Function (DF) module - excluding CCP packets</td></tr><tr><td><code>forward</code></td><td>Forwarding Layer messages - sending and receiving a forwarded packet</td></tr><tr><td><code>log</code></td><td>Creating and sending of logs by cluster (should be used in parallel with '<code>log</code>' flag in '<code>fw</code>' module)</td></tr><tr><td><code>pivot</code></td><td>All decisions made in ClusterXL Load Sharing Unicast</td></tr><tr><td><code>pnote</code></td><td>Related to registering and monitoring of critical devices (pnotes)</td></tr><tr><td><code>select</code></td><td>Packet selection - including Decision Function (DF)</td></tr><tr><td><code>stat</code></td><td>Related to state of cluster members (state machine)</td></tr></tbody></table>\n    \n\n## (13) Debug instructions\n\n**General** debug instructions are provided below\n\n**Note:** [Contact Check Point Support](http://www.checkpoint.com/services/contact/index.html) to get more precise debug instructions that are relevant to your specific issue.\n\n### (13-1) Issues with SIP over UDP traffic\n\n1.  Prepare the kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug 0`**  \n    **`[Expert@GW_HostName]# fw ctl debug -buf 32000`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m fw + mgcp sip conn drop vm nat xlate xltrc`**\n    \n    Note: It is also recommended to enable the '`ld`' flag in the '`fw`' module. Warning: this flag causes **high** CPU load.\n    \n2.  Verify the kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug -m fw`**\n    \n3.  Start the kernel debug:\n    \n    **`[Expert@GW_HostName]# fw ctl kdebug -T -f > /var/log/debug.txt`**\n    \n4.  Start the traffic capture in another shell\n    \n    **`[Expert@GW_HostName]# fw monitor -e \"host(X.X.X.X), accept;\" -o /var/log/fw_mon.cap`**\n    \n5.  Replicate the issue.\n6.  Stop the kernel debug:\n    \n    **Press CTRL+C**  \n    **`[Expert@GW_HostName]# fw ctl debug 0`**\n    \n7.  Stop the traffic capture in another shell:\n    \n    **Press CTRL+C**\n    \n8.  Collect the debug output files:\n9.  /var/log/debug.txt\n\n11.  /var/log/fw\\_mon.cap\n\n### (13-2) Issues with SIP over TCP traffic\n\n1.  Prepare the kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug 0`**  \n    **`[Expert@GW_HostName]# fw ctl debug -buf 32000`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m fw + mgcp sip conn drop vm nat xlate xltrc`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m CPAS all`**\n    \n    Note: It is also recommended to enable the '`ld`' flag in the '`fw`' module. Warning: this flag causes **high** CPU load.\n    \n2.  Verify the kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug -m fw`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m CPAS`**\n    \n3.  Start the kernel debug:\n    \n    **`[Expert@GW_HostName]# fw ctl kdebug -T -f > /var/log/debug.txt`**\n    \n4.  Start the traffic capture in another shell\n    \n    **`[Expert@GW_HostName]# fw monitor -e \"host(X.X.X.X), accept;\" -o /var/log/fw_mon.cap`**\n    \n5.  Replicate the issue.\n6.  Stop the kernel debug:\n    \n    **Press CTRL+C**  \n    **`[Expert@GW_HostName]# fw ctl debug 0`**\n    \n7.  Stop the traffic capture in another shell:\n    \n    **Press CTRL+C**\n    \n8.  Collect the debug output files:\n9.  /var/log/debug.txt\n\n11.  /var/log/fw\\_mon.cap\n\n### (13-3) Issues with H.323 traffic\n\n1.  Prepare the kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug 0`**  \n    **`[Expert@GW_HostName]# fw ctl debug -buf 32000`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m fw + mgcp sip conn drop vm nat xlate xltrc`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m h323 all`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m CPAS all`**\n    \n    Note: It is also recommended to enable the '`ld`' flag in the '`fw`' module. Warning: this flag causes **high** CPU load.\n    \n2.  Verify the kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug -m fw`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m h323`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m CPAS`**\n    \n3.  Start the kernel debug:\n    \n    **`[Expert@GW_HostName]# fw ctl kdebug -T -f > /var/log/debug.txt`**\n    \n4.  Start the traffic capture in another shell\n    \n    **`[Expert@GW_HostName]# fw monitor -e \"host(X.X.X.X), accept;\" -o /var/log/fw_mon.cap`**\n    \n5.  Replicate the issue.\n6.  Stop the kernel debug:\n    \n    **Press CTRL+C**  \n    **`[Expert@GW_HostName]# fw ctl debug 0`**\n    \n7.  Stop the traffic capture in another shell:\n    \n    **Press CTRL+C**\n    \n8.  Collect the debug output files:\n9.  /var/log/debug.txt\n\n11.  /var/log/fw\\_mon.cap\n\n### (13-4) Issues with SCCP (Skinny) traffic\n\n1.  Prepare the kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug 0`**  \n    **`[Expert@GW_HostName]# fw ctl debug -buf 32000`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m fw + conn drop vm nat xlate xltrc`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m CPAS all`**\n    \n    Note: It is also recommended to enable the '`ld`' flag in the '`fw`' module. Warning: this flag causes **high** CPU load.\n    \n2.  Verify the kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug -m fw`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m CPAS`**\n    \n3.  Start the kernel debug:\n    \n    **`[Expert@GW_HostName]# fw ctl kdebug -T -f > /var/log/debug.txt`**\n    \n4.  Start the traffic capture in another shell\n    \n    **`[Expert@GW_HostName]# fw monitor -e \"host(X.X.X.X), accept;\" -o /var/log/fw_mon.cap`**\n    \n5.  Replicate the issue.\n6.  Stop the kernel debug:\n    \n    **Press CTRL+C**  \n    **`[Expert@GW_HostName]# fw ctl debug 0`**\n    \n7.  Stop the traffic capture in another shell:\n    \n    **Press CTRL+C**\n    \n8.  Collect the debug output files:\n9.  /var/log/debug.txt\n\n11.  /var/log/fw\\_mon.cap\n\n### (13-5) Issues with Windows Messenger traffic\n\n1.  Prepare the kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug 0`**  \n    **`[Expert@GW_HostName]# fw ctl debug -buf 32000`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m fw + mgcp sip msnms conn drop vm nat xlate xltrc`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m CPAS all`**\n    \n    Note: It is also recommended to enable the '`ld`' flag in the '`fw`' module. Warning: this flag causes **high** CPU load.\n    \n2.  Verify the kernel debug options:\n    \n    **`[Expert@GW_HostName]# fw ctl debug -m fw`**  \n    **`[Expert@GW_HostName]# fw ctl debug -m CPAS`**\n    \n3.  Start the kernel debug:\n    \n    **`[Expert@GW_HostName]# fw ctl kdebug -T -f > /var/log/debug.txt`**\n    \n4.  Start the traffic capture in another shell\n    \n    **`[Expert@GW_HostName]# fw monitor -e \"host(X.X.X.X), accept;\" -o /var/log/fw_mon.cap`**\n    \n5.  Replicate the issue.\n6.  Stop the kernel debug:\n    \n    **Press CTRL+C**  \n    **`[Expert@GW_HostName]# fw ctl debug 0`**\n    \n7.  Stop the traffic capture in another shell:\n    \n    **Press CTRL+C**\n    \n8.  Collect the debug output files:\n9.  /var/log/debug.txt\n\n11.  /var/log/fw\\_mon.cap\n\n## (14) Overview of SmartView Tracker logs\n\n-   ### (14-1) All protocols\n    \n    <table><tbody><tr><td>Log Message</td><td>Possible Cause</td><td>Suggested solution</td><td>IPS protection</td></tr><tr><td><code>Illegal redirect X.X.X.X -&gt; X.X.X.X</code></td><td><ul><li>A VoIP Domain object was defined, but was not included in the rulebase.</li><li>These IP addresses do not belong to the related endpoints.</li></ul></td><td><ol><li>If a VoIP domain is not required, delete the VoIP domain object.</li><li>If a hand over domain is required, add the hand over domain to the rulebase.</li><li>If a hand over domain is required, add the related endpoints' IP addresses to the corresponding hand over domain.</li></ol></td><td>&nbsp;</td></tr><tr><td><code>Host exceeded call limit (possible spam or DoS attack)</code></td><td>The number of call attempts exceeded the number defined in the IPS \"<code>VoIP Denial of Service</code>\" protection. Further packets were rejected.</td><td><ul><li>Either increase the number of allowed call attempts in the IPS \"<code>VoIP Denial of Service</code>\" protection,</li><li>Or disable the IPS \"<code>VoIP Denial of Service</code>\" protection.</li></ul></td><td>'IPS' tab - Protections - By Protocol - Application Intelligence - VoIP - VoIP Denial of Service - select the relevant IPS Profile</td></tr></tbody></table>\n    \n-   ### (14-2) SIP\n    \n    <table><tbody><tr><td>Log Message</td><td>Possible Cause</td><td>Suggested solution</td><td>IPS protection</td></tr><tr><td><code>NOTIFY message out of state</code></td><td>This message can appear for numerous messages, not only for <code>NOTIFY</code>. It usually indicates a problem in the SIP state machine.</td><td><a href=\"http://www.checkpoint.com/services/contact/index.html\" target=\"_blank\" rel=\"noopener\">Contact Check Point Support</a> after you collect the <span targetid=\"Debug instructions - SIP\">relevant SIP debug</span>.</td><td>&nbsp;</td></tr><tr><td><code>Violated unidirectional connection</code></td><td>Trying to use bi-directional SIP connections.</td><td>In the rulebase, add the '<code>sip_dynamic_ports</code>' service (located in the '<code>Other</code>' group) to the corresponding SIP rule.</td><td>&nbsp;</td></tr><tr><td><code>Connection contains real IP of NATed address</code></td><td>A real IP address appeared instead of the NATed IP address.</td><td><a href=\"http://www.checkpoint.com/services/contact/index.html\" target=\"_blank\" rel=\"noopener\">Contact Check Point Support</a> after you collect the <span targetid=\"Debug instructions - SIP\">relevant SIP debug</span>.</td><td>&nbsp;</td></tr><tr><td><code>Malformed SIP datagram, invalid SIP headers</code></td><td>Security Gateway expected a certain field in the SIP packet, but the field is missing.</td><td><a href=\"http://www.checkpoint.com/services/contact/index.html\" target=\"_blank\" rel=\"noopener\">Contact Check Point Support</a> after you collect the <span targetid=\"Debug instructions - SIP\">relevant SIP debug</span>.</td><td>&nbsp;</td></tr><tr><td><code>Enforcing major security - reinvents rejected</code></td><td>The destination tries to reinvent a call.</td><td>Disable the \"<code>Block the destination from re-inviting calls</code>\" setting in the relevant IPS profile.<p>Note: This setting prevents the destination from opening additional data connections with IP addresses that are not the same as the first data connection while a call is still active.</p></td><td><p>Follow these steps:</p><ol><li>Close all SmartConsole windows (SmartDashboard, SmartView Tracker, SmartView Monitor, etc.).</li><li>Connect to Security Management Server with <a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk13009\" target=\"_blank\" rel=\"noopener\">GuiDBedit Tool</a>.</li><li>In the left upper pane, go to '<strong><code>Table</code></strong>' - '<strong><code>Managed Objects</code></strong>' - '<strong><code>asm</code></strong>'.</li><li>In the right upper pane, select the relevant IPS profile (Class Name = <code>advanced_security</code>).</li><li>Press CTRL+F (or go to '<code>Search</code>' menu - '<code>Find</code>') - paste <strong><code>sip_enforce_security_reinvite</code></strong> - click on '<code>Find Next</code>'.</li><li>In the lower pane, right-click on the <strong><code>sip_enforce_security_reinvite</code></strong> - '<code>Edit...</code>' - choose \"<strong><code>false</code></strong>\" - click on '<code>OK</code>'.</li><li>Save the changes: go to '<code>File</code>' menu - click on '<code>Save All</code>'.</li><li>Close the GuiDBedit Tool.</li><li>Connect to Security Management Server with SmartDashboard.</li><li>Install the policy onto the relevant Security Gateway / Cluster object.</li></ol></td></tr><tr><td><code>Reinvents exceeds the limit</code></td><td>The number of maximum allowed invitations per call has been exceeded.</td><td>Increase the value of \"<code>Maximum invitations per call (from both directions)</code>\" in the IPS \"<code>SIP Protections</code>\" protection.</td><td>'IPS' tab - Protections - By Protocol - Application Intelligence - VoIP - SIP - SIP Protections - select the relevant IPS Profile</td></tr></tbody></table>\n    \n-   ### (14-3) H.323\n    \n    <table><tbody><tr><td>Log Message</td><td>Possible Cause</td><td>Suggested solution</td><td>IPS protection</td></tr><tr><td><code>Received Unregistration request without prior registration</code></td><td>The '<code>h323_registration</code>' kernel table is empty and the phone executed an '<code>Unregistration</code>' request.</td><td><ol><li>Reopen the H.323 client to register the new details again.</li><li>Adjust the '<code>Virtual Session Timeout</code>' values in the '<code>Advanced Service Properties</code>' window of the <code>H323_ras</code> service.</li></ol></td><td>&nbsp;</td></tr><tr><td><code>Invalid H.225 session. Not initialized with Setup Message</code></td><td>H.225 packets were received without a '<code>Setup</code>' message.</td><td>Check the network / routing configuration on the network.</td><td>&nbsp;</td></tr><tr><td><code>Confirm to unknown request</code></td><td><code>ACF/GRQ/GCF/LRQ/LCF</code> were received without a prior '<code>ARQ</code>'.</td><td>Check the network / routing configuration on the network.</td><td>&nbsp;</td></tr><tr><td><code>Malformed RAS message. No source phone number found</code></td><td>Security Gateway supports the phone number in an E.164 format.</td><td>Verify that the destination/source number are in an E.164 format.</td><td>&nbsp;</td></tr></tbody></table>\n    \n-   ### (14-4) MGCP\n    \n    <table><tbody><tr><td>Log Message</td><td>Possible Cause</td><td>Suggested solution</td><td>IPS protection</td></tr><tr><td><code>Unallowed MGCP datagram, command blocked</code></td><td>This message is not in the list of allowed commands in the IPS \"<code>MGCP</code>\" protection.</td><td>Add the command to the list of Allowed Commands in the IPS \"<code>MGCP</code>\" protection.</td><td>'IPS' tab - Protections - By Protocol - Application Intelligence - VoIP - MGCP - select the relevant IPS Profile</td></tr><tr><td><code>broadcast/multicast addresses are not accepted (client)</code><br><code>broadcast/multicast addresses are not accepted (server)</code><br>Note: This log does not exist in R76, R77 and above.</td><td>The IPS \"<code>MGCP</code>\" protection was configured to drop multicast RTP connections.</td><td>Disable the \"<code>Drop multicast RTP connections</code>\" option in IPS \"<code>MGCP</code>\" protection.</td><td>'IPS' tab - Protections - By Protocol - Application Intelligence - VoIP - MGCP - select the relevant IPS Profile</td></tr><tr><td><code>Connection contains real IP of NATed address</code></td><td>A message between the Call Manager and the Security Gateway should be NATed, but contains the real IP address.</td><td>Check that your configuration and topology is supported by Check Point.</td><td>&nbsp;</td></tr></tbody></table>\n    \n-   ### (14-5) SCCP (Skinny)\n    \n    <table><tbody><tr><td>Log Message</td><td>Possible Cause</td><td>Suggested solution</td><td>IPS protection</td></tr><tr><td><code>Unknown SCCP message type</code></td><td>The specific SCCP protocol is not supported by the Security Gateway.</td><td><a href=\"http://www.checkpoint.com/services/contact/index.html\" target=\"_blank\" rel=\"noopener\">Contact Check Point Support</a>.</td><td>'IPS' tab - Protections - By Protocol - Application Intelligence - VoIP - SCCP (Skinny) - select the relevant IPS Profile</td></tr><tr><td><code>Connection contains real IP of NATed address</code></td><td>A message between the Call Manager and the Security Gateway should be NATed, but contains the real IP address.</td><td>NAT for SCCP service is not supported by Security Gateway. NAT should not be applied on the Call Manager and its related endpoints.</td><td>&nbsp;</td></tr></tbody></table>\n    \n-   ### (14-6) MSN over SIP\n    \n    <table><tbody><tr><td>Log Message</td><td>Possible Cause</td><td>Suggested solution</td><td>IPS protection</td></tr><tr><td><code>File Transfer is not allowed by the security policy</code></td><td><ul><li>The service '<code>MSN_Messenger_File_Transfer</code>' is not allowed explicitly in the rulebase.</li><li>\"<code>Block file transfer</code>\" option is enabled in the \"<code>MSN Messenger over SIP</code>\" protection.</li></ul></td><td><ul><li>Use the service '<code>MSN_Messenger_File_Transfer</code>' explicitly in the rulebase.</li><li>Disable the \"<code>Block file transfer</code>\" option in the \"<code>MSN Messenger over SIP</code>\" protection.</li></ul></td><td>'IPS' tab - Protections - By Protocol - Application Intelligence - Instant Messengers - MSN Messenger over SIP - select the relevant IPS Profile</td></tr><tr><td><code>Application Sharing is not allowed by the security policy</code></td><td>\"<code>Block application sharing</code>\" option is enabled in the \"<code>MSN Messenger over SIP</code>\" protection.</td><td>Disable the \"<code>Block application sharing</code>\" option in the \"<code>MSN Messenger over SIP</code>\" protection.</td><td>'IPS' tab - Protections - By Protocol - Application Intelligence - Instant Messengers - MSN Messenger over SIP - select the relevant IPS Profile</td></tr><tr><td><code>Whiteboard is not allowed by the security policy</code></td><td>\"<code>Block white board</code>\" option is enabled in the \"<code>MSN Messenger over SIP</code>\" protection.</td><td>Disable the \"<code>Block white board</code>\" option in the \"<code>MSN Messenger over SIP</code>\" protection.</td><td>'IPS' tab - Protections - By Protocol - Application Intelligence - Instant Messengers - MSN Messenger over SIP - select the relevant IPS Profile</td></tr><tr><td><code>Remote Assistance is not allowed by the security policy</code></td><td>\"<code>Block remote assistant</code>\" option is enabled in the \"<code>MSN Messenger over SIP</code>\" protection.</td><td>Disable the \"<code>Block remote assistant</code>\" option in the \"<code>MSN Messenger over SIP</code>\" protection.</td><td>'IPS' tab - Protections - By Protocol - Application Intelligence - Instant Messengers - MSN Messenger over SIP - select the relevant IPS Profile</td></tr><tr><td><code>Instant Messaging is not allowed by the security policy</code></td><td>\"<code>Block SIP-based Instant Messaging</code>\" option is enabled in the IPS \"<code>SIP Filtering</code>\" protection.</td><td>Disable the \"<code>Block SIP-based Instant Messaging</code>\" option in the IPS \"<code>SIP Filtering</code>\" protection.</td><td>'IPS' tab - Protections - By Protocol - Application Intelligence - VoIP - SIP - SIP Filtering - select the relevant IPS Profile</td></tr><tr><td><code>Illegal redirect X.X.X.X -&gt; X.X.X.X</code></td><td>\"<code>Block calls using a proxy or a redirect server</code>\" option is enabled in the IPS \"<code>SIP Custom Properties</code>\" protection.</td><td>Disable the \"<code>Block calls using a proxy or a redirect server</code>\" option in the IPS \"<code>SIP Custom Properties</code>\" protection.</td><td>'IPS' tab - Protections - By Protocol - Application Intelligence - VoIP - SIP - SIP Custom Properties - select the relevant IPS Profile</td></tr></tbody></table>\n    \n\n## (15) Documentation\n\n<table><tbody><tr><td id=\"Documentation - Check Point Release Notes\" colspan=\"2\">(15-1) Check Point Release Notes</td></tr><tr><td>Release Notes</td><td><a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=8712\" target=\"_blank\" rel=\"noopener\">R70</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=10067\" target=\"_blank\" rel=\"noopener\">R70.10</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=10515\" target=\"_blank\" rel=\"noopener\">R70.20</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=10694\" target=\"_blank\" rel=\"noopener\">R70.30</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=10770\" target=\"_blank\" rel=\"noopener\">R70.40</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=12742\" target=\"_blank\" rel=\"noopener\">R70.50</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=10330\" target=\"_blank\" rel=\"noopener\">R71</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=10909\" target=\"_blank\" rel=\"noopener\">R71.10</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=11238\" target=\"_blank\" rel=\"noopener\">R71.20</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=11714\" target=\"_blank\" rel=\"noopener\">R71.30</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=11894\" target=\"_blank\" rel=\"noopener\">R71.40</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=12271\" target=\"_blank\" rel=\"noopener\">R71.45</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=12639\" target=\"_blank\" rel=\"noopener\">R71.50</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=11647\" target=\"_blank\" rel=\"noopener\">R75</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=12081\" target=\"_blank\" rel=\"noopener\">R75.10</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=12414\" target=\"_blank\" rel=\"noopener\">R75.20</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=12964\" target=\"_blank\" rel=\"noopener\">R75.30</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=13079\" target=\"_blank\" rel=\"noopener\">R75.40</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=16421\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=18381\" target=\"_blank\" rel=\"noopener\">R75.45</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=23394\" target=\"_blank\" rel=\"noopener\">R75.46</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=25460\" target=\"_blank\" rel=\"noopener\">R75.47</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=22933\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=24827\" target=\"_blank\" rel=\"noopener\">R77</a></td></tr><tr><td id=\"Documentation - Check Point Administration Guides\" colspan=\"2\">(15-2) Check Point Administration Guides</td></tr><tr><td>Firewall Administration Guide</td><td><a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=8738\" target=\"_blank\" rel=\"noopener\">R70</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=10309\" target=\"_blank\" rel=\"noopener\">R71</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=11660\" target=\"_blank\" rel=\"noopener\">R75</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=12267\" target=\"_blank\" rel=\"noopener\">R75.20</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=13088\" target=\"_blank\" rel=\"noopener\">R75.40</a></td></tr><tr><td>VoIP Administration Guide</td><td><a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=16881\" target=\"_blank\" rel=\"noopener\">R75.40VS</a> , <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=22905\" target=\"_blank\" rel=\"noopener\">R76</a> , <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=24855\" target=\"_blank\" rel=\"noopener\">R77</a></td></tr><tr><td>Command Line Interface Reference Guide</td><td><a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=8713\" target=\"_blank\" rel=\"noopener\">R70</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=10324\" target=\"_blank\" rel=\"noopener\">R71</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=11657\" target=\"_blank\" rel=\"noopener\">R75</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=12264\" target=\"_blank\" rel=\"noopener\">R75.20</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=13944\" target=\"_blank\" rel=\"noopener\">R75.40</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=16262\" target=\"_blank\" rel=\"noopener\">R75.40VS</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=22909\" target=\"_blank\" rel=\"noopener\">R76</a>, <a href=\"http://downloads.checkpoint.com/dc/download.htm?ID=24833\" target=\"_blank\" rel=\"noopener\">R77</a></td></tr><tr><td id=\"Documentation - RFC\" colspan=\"2\">(15-3) RFC</td></tr><tr><td>Session Initiation Protocol (SIP)</td><td><ul><li><a href=\"http://www.ietf.org/rfc/rfc3261.txt\" target=\"_blank\" rel=\"noopener\">RFC 3261</a> - Latest SIP RFC</li><li><a href=\"http://www.ietf.org/rfc/rfc3372.txt\" target=\"_blank\" rel=\"noopener\">RFC 3372</a> - SIP-T</li><li><a href=\"http://www.ietf.org/rfc/rfc3311.txt\" target=\"_blank\" rel=\"noopener\">RFC 3311</a> - UPDATE message</li><li><a href=\"http://www.ietf.org/rfc/rfc2976.txt\" target=\"_blank\" rel=\"noopener\">RFC 2976</a> - INFO message</li><li><a href=\"http://www.ietf.org/rfc/rfc3515.txt\" target=\"_blank\" rel=\"noopener\">RFC 3515</a> - REFER message</li><li><a href=\"http://www.ietf.org/rfc/rfc3265.txt\" target=\"_blank\" rel=\"noopener\">RFC 3265</a> - SIP Events</li><li><a href=\"http://www.ietf.org/rfc/rfc3266.txt\" target=\"_blank\" rel=\"noopener\">RFC 3266</a> - IPv6 in SDP</li><li><a href=\"http://www.ietf.org/rfc/rfc3262.txt\" target=\"_blank\" rel=\"noopener\">RFC 3262</a> - Reliability of Provisional responses</li><li><a href=\"http://www.ietf.org/rfc/rfc3428.txt\" target=\"_blank\" rel=\"noopener\">RFC 3428</a> - MESSAGE message, MSN messenger over SIP, SIP over TCP, SIP over UDP, SIP early media</li></ul></td></tr><tr><td>Media Gateway Control Protocol (MGCP)</td><td><ul><li><a href=\"http://www.ietf.org/rfc/rfc3435.txt\" target=\"_blank\" rel=\"noopener\">RFC 3435</a> - MCGP v1.0</li><li><a href=\"http://www.itu.int/rec/T-REC-J.171.2-200511-I/en\" target=\"_blank\" rel=\"noopener\">J.171</a> - Trunking Gateway Control Protocol (TGCP) Profile 2</li><li><a href=\"http://www.ietf.org/rfc/rfc3661.txt\" target=\"_blank\" rel=\"noopener\">RFC 3661</a> - Media Gateway Control Protocol (MGCP) Return Code Usage</li></ul></td></tr><tr><td id=\"Documentation - External references\" colspan=\"2\">(15-4) External references</td></tr><tr><td>SIP</td><td><ul><li>Wikipedia: <a href=\"http://en.wikipedia.org/wiki/Session_Initiation_Protocol\" target=\"_blank\" rel=\"noopener\">Session Initiation Protocol</a></li><li>IANA: <a href=\"http://www.iana.org/assignments/sip-parameters/sip-parameters.xhtml\" target=\"_blank\" rel=\"noopener\">IANA: SIP Parameters</a></li><li>Packetizer®: <a href=\"http://www.packetizer.com/ipmc/sip/\" target=\"_blank\" rel=\"noopener\">http://www.packetizer.com/ipmc/sip/</a></li></ul></td></tr><tr><td>SDP</td><td><ul><li>Wikipedia: <a href=\"http://en.wikipedia.org/wiki/Session_Description_Protocol\" target=\"_blank\" rel=\"noopener\">Session Description Protocol</a></li></ul></td></tr><tr><td>H.323</td><td><ul><li>Wikipedia: <a href=\"http://en.wikipedia.org/wiki/H.323\" target=\"_blank\" rel=\"noopener\">H.323</a></li><li>Cisco: <a href=\"http://www.cisco.com/en/US/tech/tk652/tk701/tk309/tsd_technology_support_sub-protocol_home.html\" target=\"_blank\" rel=\"noopener\">H.323</a></li><li>Packetizer®: <a href=\"http://www.packetizer.com/ipmc/h323/\" target=\"_blank\" rel=\"noopener\">http://www.packetizer.com/ipmc/h323/</a></li><li>H.323 Forum: <a href=\"http://www.h323forum.org/\" target=\"_blank\" rel=\"noopener\">http://www.h323forum.org</a></li></ul></td></tr><tr><td>RTP</td><td><ul><li>Wikipedia: <a href=\"http://en.wikipedia.org/wiki/Real-time_Transport_Protocol\" target=\"_blank\" rel=\"noopener\">Real-time Transport Protocol</a></li></ul></td></tr><tr><td>RTCP</td><td><ul><li>Wikipedia: <a href=\"http://en.wikipedia.org/wiki/RTP_Control_Protocol\" target=\"_blank\" rel=\"noopener\">RTP Control Protocol</a></li></ul></td></tr><tr><td>MGCP</td><td><ul><li>Wikipedia: <a href=\"http://en.wikipedia.org/wiki/Media_Gateway_Control_Protocol\" target=\"_blank\" rel=\"noopener\">Media Gateway Control Protocol</a></li><li>Cisco: <a href=\"http://www.cisco.com/en/US/tech/tk652/tk701/tk419/tsd_technology_support_sub-protocol_home.html\" target=\"_blank\" rel=\"noopener\">Media Gateway Control Protocol (MGCP)</a></li></ul></td></tr><tr><td>SCCP (Skinny)</td><td><ul><li>Wikipedia: <a href=\"http://en.wikipedia.org/wiki/Skinny_Call_Control_Protocol\" target=\"_blank\" rel=\"noopener\">Skinny Call Control Protocol (SCCP)</a></li><li>Cisco: <a href=\"http://www.cisco.com/en/US/tech/tk652/tk701/tk589/tsd_technology_support_sub-protocol_home.html\" target=\"_blank\" rel=\"noopener\">Skinny Call Control Protocol (SCCP)</a></li></ul></td></tr><tr><td>Windows Messenger</td><td><ul><li>Wikipedia: <a href=\"http://en.wikipedia.org/wiki/Windows_Messenger\" target=\"_blank\" rel=\"noopener\">Windows Messenger</a></li><li>Microsoft: <a href=\"http://support.microsoft.com/kb/903056\" target=\"_blank\" rel=\"noopener\">Description of the Windows Messenger client basic protocol port usage for instant messaging, file transfer, audio, and video</a></li><li>Microsoft: <a href=\"http://support.microsoft.com/kb/927847\" target=\"_blank\" rel=\"noopener\">Network ports and URLs that are used by Windows Live Messenger</a></li></ul></td></tr></tbody></table>\n\n## (17) Revision history","language":"md","time":"14 days ago","created":"2025-05-06T22:56:03.653Z","annotations":[],"updated":"2025-05-06T22:58:12.480Z"},{"title":"Security Management Server with VPN Certificate","id":"d9b1fad8-d5f6-412f-8e13-6f3ca65fbe9a","type":"TEXT","raw":"---\ncreated: 2025-04-29T19:04:56 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk108064\nauthor: \n---\n\n# sk108064 - Renewing or deleting VPN certificate fails for Security Gateway object\n\n> ## Excerpt\n> Applies to: IPSec VPN\n\n---\nProductIPSec VPN\n\nVersionR81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-04-29\n\n## Symptoms\n\n-   In SmartConsole > Security Gateway object > **IPsec VPN** section, after users select a certificate and click **Renew**, the Security Gateway does not renew the certificate.\n-   After users click **Remove**, the Security Gateway does not remove the certificate from the table. This error message appears in SmartConsole:  \n    \"_This certificate is used in IKE authentication. Prior to deleting this certificate, define an alternative certificate, or remove the 'public key signature' authentication method._\"\n\n## Cause\n\nThe VPN certificate for the Security Gateway object is corrupted.\n\n## Solution\n\nIn the database of the Security Management Server/ relevant domain Management Server, reset the `ssl_certificate` parameter.\n\n#### Procedure\n\n1.  Back up the Security Management Server / relevant Domain Management Server.\n    \n    Refer to:\n    \n    -   [sk108902 - Best Practices - Backup on Gaia OS](https://support.checkpoint.com/results/sk/sk108902)\n    -   [sk91400 - System Backup and Restore feature in Gaia](https://support.checkpoint.com/results/sk/sk91400)\n    -   [sk98153 - How to take a snapshot of Endpoint Security Management Server database](https://support.checkpoint.com/results/sk/sk98153)\n2.  Close **all** SmartConsole windows that are connected to the Security Management Server.\n    \n    On a Multi-Domain Server, this applies to both the Global Domain and the relevant Domain Management Server.\n    \n    Verify by running the \"_cpstat mg_\" command on the Security Management Server / in the context of the relevant Domain Management Server.\n    \n3.  Connect with [Database Tool (GuiDBedit Tool)](https://support.checkpoint.com/results/sk/sk13009) to the Security Management Server / relevant Domain Management Server.\n    \n4.  In the upper left pane, go to _**Network Objects > network\\_objects**_\n    \n5.  In the upper right pane, select <**Gateway/Cluster object name**\\>.\n    \n6.  Press CTRL+F (or go to _**Search**_ menu > _**Find**_) > paste _**ssl\\_certificate**_ > click _**Find Next**_.\n    \n7.  In the lower pane, right-click the field _**ssl\\_certificate**_ \\> select **_Reset_**.\n    \n8.  Save the changes: go to the _**File**_ menu > click _**Save All**_.\n    \n9.  Close the Database Tool (GuiDBedit Tool).\n    \n10.  Connect with SmartConsole to the Security Management Server / Domain Management Server.\n    \n11.  Install the Security Policy onto the applicable Security Gateway / Cluster / VSX Virtual System object\n12.  In SmartConsole > Security Gateway object > **IPsec VPN** section, select the certificate and click **Renew**.\n    \n13.  Install the Security Policy onto the applicable Security Gateway / Cluster / VSX Virtual System object\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorErik Lagzdins\n\nTechnical ResourceJames Brunsting\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2015-10-18\n\nLast Modified2025-04-29\n\nEditorErik Lagzdins\n\nLast ApproverSergei Shir\n","language":"md","time":"14 days ago","created":"2025-05-06T22:56:10.030Z","annotations":[],"updated":"2025-05-06T22:58:28.342Z"},{"title":"ProductCloudGuard Controller","id":"6975cbfb-582b-4ade-9860-f4f0b4226a43","type":"TEXT","raw":"ProductCloudGuard Controller\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2024-10-28\n\n## Solution\n\n**Introduction  |  Glossary  |  Architecture  |  Configuration Options   \nError Handling  |  Logging  |  Troubleshooting** \n\nClick Here to Collapse the Entire Article\n\n  \n\n##   \nIntroduction\n\nThe CloudGuard Network Security solution delivers advanced threat protection to private or public cloud infrastructures.  \n\nWith trusted APIs, the CloudGuard Controller connects to the Software-Defined Data Center (SDDC) and integrates the virtual cloud environment with Check Point Security Gateways.\n\nAfter using the vendor's API to connect to the Software-Defined Data Center (SDDC), CloudGuard Controller regularly polls connected environments for changes in objects and object attributes used in the Security Policy. Changes are automatically pushed to the Security Gateway.\n\nFor additional information, refer to the [CloudGuard Controller Administration Guide](https://support.checkpoint.com/product/573) of your version. \n\n  \n\n## Glossary\n\nShow / Hide the Glossary Section\n\nThis section provides definitions of the main terms used in the CloudGuard Controller documentation.\n\n<table><tbody><tr><td scope=\"col\">Term</td><td scope=\"col\">Definition</td></tr><tr><td>CMS</td><td>The Cloud Management Server is the main process of the CloudGuard Controller.</td></tr><tr><td>Scanner</td><td>This CMS component regularly retrieves objects from the Data Center.</td></tr><tr><td>DC Repository</td><td>This CMS component enables in-memory storage of scan results.</td></tr><tr><td>Enforcement</td><td>This CMS component sends Data Center updates to the Security Gateways based on the Policy.</td></tr><tr><td>Notifier<br>(Auto-update)</td><td>This CMS component updates the Check Point Management (CPM) process with changes made to Data Center objects.</td></tr><tr><td>CPM</td><td>A separate Check Point Management process.</td></tr><tr><td>Import window</td><td>In this SmartConsole window, you can view the scan results from a Data Center. You can also select Data Center Objects to import and use in the security policy.</td></tr></tbody></table>\n\n  \n\n## Architecture\n\nShow / Hide the Architecture Section\n\nThese are the main components of the CloudGuard Controller:\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk115657/Pic1202408281044451.png)\n\n  \n\n## Configuration Options\n\nShow / Hide the Configuration Options Section\n\nCloudGuard Controller uses only one configuration file – `vsec.conf`:\n\n-   On a Security Management Server, the file is located at `$FWDIR/conf/vsec.conf`.\n    \n-   On a Multi-Domain Server, the file is located at `$MDSDIR/conf/vsec.conf`.\n    \n\nAfter making changes to the file, you must restart the process to apply the new values by running `vsec stop ; vsec start`. \n\nThe file contains documentation for each configuration option. \n\nWhen you upgrade the Security Management Server or a Multi-Domain Server, the original file is preserved to keep the user's settings. \n\nFor more details, refer to the [Configuration Parameters](https://sc1.checkpoint.com/documents/R81.20/WebAdminGuides/EN/CP_R81.20_CloudGuard_Controller_AdminGuide/Content/Topics-CGRDG/Configuration-Parameters.htm?TocPath=_____9) section in the CloudGuard Controller Administration Guide. \n\n  \n\n## Error Handling\n\nShow / Hide the Error Handling Section\n\n  \n\n## Logging\n\nShow / Hide the Entire Logging Section\n\nCloudGuard Controller has two types of logs for monitoring and troubleshooting purposes:\n\n1.  Logs that are sent to SmartConcole.\n    \n    -   To view these logs, filter them using `blade:\"CloudGuard IaaS\"`.\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk115657/Pic4202408281049194.png)\n        \n    -   To focus on failures, filter the logs using `blade:\"CloudGuard IaaS\" AND severity:Critical`.\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk115657/Pic5202408281050365.png)\n        \n    \n    Many of the monitoring capabilities are build around the \"Severity\" field. Refer to the [Monitoring](https://sc1.checkpoint.com/documents/R81.20/WebAdminGuides/EN/CP_R81.20_CloudGuard_Controller_AdminGuide/Content/Topics-CGRDG/Monitoring.htm?TocPath=CloudGuard%20Controller%20Monitoring%7C_____0%22%20\\l%20%22CloudGuard_Controller_Monitoring) section in the CloudGuard Controller Administration Guide for more information.\n    \n2.  Runtime logs for troubleshooting.\n    \n    -   These logs are written to the file `$MDS_FWDIR/log/cloud_proxy.elg`.\n        \n    -   To focus on failures or errors, search the file for the keyword \"ERROR\".\n        \n\n  \n\n## Troubleshooting\n\n**Table of Contents:  \n**\n\n-   **Enforcement Update Issues**\n    \n-   **DCQ Issues**\n    \n\nClick Here to Show the Entire Troubleshooting Section\n\n  \n\n### Enforcement Update Issues\n\n-   Scenario 1: Shorten Security Gateway update time on environments with many Security Gateways.  \n    \n    > **Cause:**  \n    > For each management Domain, there is a dedicated thread that updates the Security Gateways in that Domain. After each update cycle, there is a 10-second delay before the next cycle, as specified by the `enforcementUpdateIntervalTime` value in `vsec.conf`.\n    > \n    > The update cycle updates multiple Security Gateways simultaneously according to the `enforcementThreadPool` value.\n    > \n    > **Solution:**\n    > \n    > You can increase the value of `enforcementThreadPool` to update more Security Gateways simultaneously.\n    \n-   Scenario 2: \"Failed to update the GW...” error message in the `cloud_proxy.elg` file.  \n    \n    > **Symptoms:  \n    > **\n    > \n    > 1.  The CloudGuard Controller fails to update the Security Gateway.\n    >     \n    > 2.  The `cloud_proxy.elg` file contains multiple `cprid_util` failures on the `putfile` command, indicating a failure to send the script file to the Security Gateway:\n    >     \n    >     `ERROR datacenter.util.CommandExec [gateway-updater_****]: Command '[/opt/CPshrd-R81.20/bin/cprid_util, -server, *.*.*.*, putfile, -local_file, /opt/CPsuite-R81.20/fw1/tmp/****_vsecUpdate.sh, -remote_file, /etc/fw/tmp/****_vsecUpdate.sh]' failed …`    \n    >        \n    >     `ERROR ida.api.IDACpridRequestSenderClient [gateway-updater_****]: Failure 3/3 to send script file to gateway …`\n    >     \n    > \n    > **Cause:** `cprid_util` errors on the `putfile` command are usually caused by connectivity issues.**\n    > \n    > Solution:\n    > \n    > **\n    > \n    > 1.  Test connectivity with the Security Gateway by running the command:\n    >     \n    >     `$CPDIR/bin/cprid_util -server getarch <Security Gateway IP address>`\n    >     \n    >     The expected result should be \"gaia\". If the output is \"unknown\", then check the connectivity on CPRID port 18208 using the telnet command.\n    >     \n    > 2.  Enable `cprid_util` debug according to [sk174346](https://support.checkpoint.com/results/sk/sk174346) and try sending a dummy file.\n    >     \n    >     Example:  \n    >     1.  Run: `touch /home/admin/test.txt`\n    >         \n    >     2.  Transfer the `test.txt` file from the Security Management Server to the Security Gateway using the CPRID command:\n    >         \n    >         `$CPDIR/bin/cprid_util -server <Security Gateway IP address> putfile -local_file /home/admin/test.txt -remote_file /tmp/test.txt`\n    >         \n    \n-   Scenario 3: The IP address is not enforced.  \n    \n    > **Symptom:** Traffic to or from an IP address is not correctly enforced by the Security Gateway.**\n    > \n    > Causes:\n    > \n    > **\n    > \n    > -   The Data Center scan did not detect the IP address.\n    >     \n    > -   The IP address does not match the rule base definitions and was not sent to the Security Gateway. For example:\n    >     \n    >     -   The IP address does not match a Data Center Query used in the policy.\n    >         \n    >     -   The IP address does not match a Tag used in the policy.\n    >         \n    > -   The IP address was sent to the Security Gateway but was later deleted. \n    >     \n    > \n    > **Troubleshooting steps:**\n    > \n    > To troubleshoot this issue, start from the Security Gateway and work backward to the CloudGuard Controller on the Security Management Server:\n    > \n    > 1.  Check if the IP address is in the PEP tables on the Security Gateway by running:\n    >     \n    >     `# pep show user query cid <IP address>`\n    >     \n    > 2.  Check if the IP address is in the PDP tables on the Security Gateway by running:\n    >     \n    >     `# pdp m ip <IP Address>`\n    >     \n    > 3.  Search for this IP address in `cloud_proxy.elg` files on the Security Management Server to see if it was sent to the Security Gateway: \n    >     \n    >     `# zgrep <the IP> $FWDIR/log/cloud_proxy.elg*`\n    >     \n    >     Then open each location and see if it related to the problematic Security Gateway. The log line will contain the Security Gateway name and IP address.\n    >     \n    >     For example, when searching for 10.11.12.13 we can see that it was pushed to the Security Gateway 10.200.200.110 at 29/03/24 19:29:18: \n    >     \n    >     `29/03/24 19:29:18,230  INFO ida.api.IDACpridRequestSenderClient [gateway-updater_domainA_Cloudguard_GW]: Sending update to gw 10.200.200.110: #!/bin/bash`    \n    >     `quote=\\'`   \n    >     `response=$(curl_cli -s -H \"Content-Type: application/json\" -w \"%{response_code}\" -X POST  http://localhost:5908/_IA_API/idasdk/add-identity -d @-<< EOF`   \n    >     `{`   \n    >       `\"empty\" : false,`   \n    >       `\"addRequestsNum\" : 42,`   \n    >       `\"shared-secret\" : \"$2\",`   \n    >       `\"requests\" : [ {`   \n    >         `\"ip-address\" : \"10.11.12.13\",`   \n    >         `\"machine\" : \"$(echo 'i-123abc123abc123a (fronend-web-server)')\",`   \n    >         `\"machine-groups\" : [ \"$(echo 'chkp:aws:service:prod=allow')\" ],`   \n    >         `\"roles\" : [ \"Ve2f4f0c6-844a-4312-8824-b6ff55ff7707\" ],`   \n    >         `\"session-timeout\" : 604800,`   \n    >         `\"fetch-machine-groups\" : false,`   \n    >         `\"calculate-roles\" : false,`   \n    >         `\"identity-source\" : \"CloudGuard Controller\"`   \n    >       `}` \n    >     \n    >     And after 2 seconds we see a correct response from the Security Gateway for that IP address:  \n    >     \n    >     `29/03/24 19:29:20,008 INFO ida.api.IDACpridRequestSenderClient [gateway-updater_domainA_Cloudguard_GW]: Response from gw 10.200.200.110 is '   {     \"http_code\" : 200,     \"raw_response\":{       \"responses\" : [ {         \"count\" : \"1\",         \"ipv4-address\" : \"10.11.12.13\",         \"message\" : \"Association sent to PDP.\"   }`\n    >     \n    > 4.  If the requested IP address is not found in `cloud_proxy.elg`, the next step is to check if it appears in the Data Center scan results. \n    >     \n    > 5.  Right-click on the relevant Data Center and select \"Import\". Then, search for the IP address. \n    >     \n    >     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk115657/Pic6202408281052046.png)\n    >     \n    > 6.  Connecting to and scanning AWS, Azure, GCP, and OCI Data Centers is done using a Python script (`vsec.py`), which can be run manually. Redirect the script's output to a file and search for the requested IP address within that file.\n    >     \n    >     1.  First, verify that the output is a valid JSON file. If it is not, the scan did not complete correctly. This could be due to authentication or authorization issues. The errors will be present in the output.\n    >         \n    >     2.  How to manually run the vsec.py:\n    >         \n    >         **Examples**  \n    >         \n    >         **AWS using Access and Secret keys:**\n    >         \n    >         `# AWS_API_DEBUG=true AWS_ACCESS_KEY=<access key> AWS_SECRET_KEY=<secret key> $FWDIR/Python/bin/python3 $VSECDIR/scripts/aws/vsec.py <region code>`\n    >         \n    >         **AWS using the Management server IAM role:**\n    >         \n    >         `# AWS_API_DEBUG=true AWS_KEY_FILE=IAM $FWDIR/Python/bin/python3 $VSECDIR/scripts/aws/vsec.py <region code>`\n    >         \n    >         **AWS using STS Assume Role (R81.10 and higher):**\n    >         \n    >         `# AWS_API_DEBUG=true AWS_ACCESS_KEY_ID=<access key> AWS_SECRET_ACCESS_KEY=<secret key> AWS_STS_ROLE=<full role arn> AWS_STS_SESSION=test AWS_STS_EXTERNAL_ID=<external id> $FWDIR/Python/bin/python3 $VSECDIR/scripts/aws/vsec.py <region>`\n    >         \n    >         **GCP (Google Cloud Platform):**\n    >         \n    >         `# export GCP_CREDENTIALS=$(cat <PATH_TO_GCP_CREDENTIALS_JSON_FILE>); GCP_DEBUG=true $FWDIR/Python/bin/python3 $VSECDIR/scripts/google/vsec.py __ALL__` \n    >         \n    >         **Azure:**\n    >         \n    >         `# AZURE_REST_DEBUG=true AZURE_CREDENTIALS='{\"client_id\": \"<client id>\",\"client_secret\": \"<client secret>\",\"grant_type\": \"client_credentials\",\"tenant\": \"<tenant>\"}' $FWDIR/Python/bin/python3 $VSECDIR/scripts/azure/vsec.py`\n    >         \n    >         The Azure credentials can also be written in a file with the same format as above:\n    >         \n    >         `# AZURE_REST_DEBUG=true AZURE_CREDENTIALS=creds.json $FWDIR/Python/bin/python3 $VSECDIR/scripts/azure/vsec.py`\n    >         \n    > 7.  If the IP addresses is expected to be part of a DCQ (Data Center Query), open the DCQ object, click \"Preview\", and search for the IP address:\n    >     \n    >     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk115657/Pic7202408281057317.png)\n    >     \n    > 8.  Check for errors when updating the relevant Security Gateway:\n    >     \n    >     -   Check SmartConsole logs – see the Logging section above.\n    >         \n    >     -   Check for `cprid_util ‘rexec’` errors in the `cloud_proxy.elg` file: \n    >         \n    >         `20/02/24 03:51:18,959 ERROR datacenter.util.CommandExec [gateway-updater_domainA_Cloudguard_GW]: Failed to execute '[/opt/CPshrd-R81.20/bin/cprid_util, -server, 10.200.200.110, -timeout, 120, -verbose, rexec, -rcmd, /bin/bash, /etc/fw/tmp/Cloudguard_GW_vsecUpdate.sh, Cloudguard_GW, PassC0d3]' from domain 10.20.30.40`\n    >         \n    > \n    > If there are errors related to `cprid_util`, follow these troubleshooting steps:\n    > \n    > 1.  Connect to the Security Gateway using SSH.\n    >     \n    > 2.  Backup the `vsecUpdate.sh` file:\n    >     \n    >     `# cp /etc/fw/tmp/<GW_NAME>_vsecUpdate.sh /etc/fw/tmp/<GW_NAME>_vsecUpdate_test.sh`\n    >     \n    > 3.  Add executable permissions to the file:\n    >     \n    >     `# chmod +x /etc/fw/tmp/<GW_NAME>_vsecUpdate_test.sh`\n    >     \n    > 4.  Run the script with the bash debugging flag -x:\n    >     \n    >     \\# /bin/bash -x /etc/fw/tmp/<GW\\_NAME>\\_vsecUpdate\\_test.sh <GW\\_NAME> <shared secret>  >  vsec\\_out.txt 2>&1\n    >     \n    >     The shared secret is found in the `cloud_proxy.elg` log line – ‘PassC0d3’ in the example above.\n    >     \n    > \n    > Examine the output in the `vsec_out.txt` file. The expected output is a valid JSON file with the `http_code` field equal to `200`.\n    > \n    > If the output is not a valid JSON file or if the value of the `http_code` field in this JSON file (which comes from the PDP process running on the Security Gateway) is not `200`:\n    > \n    > 1.  Enable PDP debugging on the Security Gateway:\n    >     \n    >     \\# pdp d s IDP all  \n    >     \\# pdp d s IDA\\_API all\n    >     \n    > 2.  Repeat the step above to re-run the `vsecUpdate.sh` file located at `/etc/fw/tmp/<GW_NAME>_vsecUpdate_test.sh`\n    >     \n    > 3.  Disable PDP debugging:\n    >     \n    >     \\# pdp d u IDP  \n    >     \\# pdp d u IDA\\_API\n    >     \n    > 4.  Collect the `$FWDIR/log/pdpd.elg*` files and the `vsec_out.txt` file, then contact Support.\n    >     \n    \n-   Scenario 4: Scan failures after changing Data Center credentials.  \n    \n    > **Symptoms**:  \n    > \n    > -   After changing Data Center credentials, “Test Connection” in SmartConsole shows \"connected\", but logs show scan failures.\n    >     \n    > -   After changing Data Center credentials, “Test Connection” in SmartConsole shows \"connected\", but Security Gateways are not updated with the correct data.\n    >     \n    > \n    > **Cause**: The Data Center credentials are not updated for all Security Gateways.  \n    > \n    >   \n    > **Solution**:  \n    > \n    > -   For versions before R81.20 Jumbo Take 43: Install the policy on all Security Gateways that include assets from the affected Data Center. \n    >     \n    > -   For versions after R81.20 Jumbo Take 43: Install the policy on one of the Security Gateways that include assets from the affected Data Center.\n    >     \n    \n\n### DCQ Issues\n\n-   Scenario 1: IP addresses associated to DCQ are not enforced.  \n    \n    > **Symptom:** IP Addresses are not sent to the Security Gateway or not enforced by the Security Gateway even though they are seen in the **DCQ > Preview**.\n    > \n    > **Cause:  \n    > **\n    > \n    > -   The DCQ is using the “All Data Centers” option.\n    >     \n    > -   The relevant Data Center was added after the policy was installed on the Security Gateway.\n    >     \n    >     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk115657/Pic8202408281127008.png)\n    >     \n    > \n    > **Solution:** Install the policy on all Security Gateways that have this DCQ in their policy.\n    \n\n## Article Properties\n\nOriginatorDavid Kornfield\n\nTechnical ResourceGil Sudai\n\nAccess LevelGeneral\n\nStatusApproved\n\nDate Created2017-10-21\n\nLast Modified2024-10-28\n\nEditorGil Frantsus\n\nLast ApproverGil Frantsus\n\n## Comments\n\n#### Internal only\n\n**Many thanks to Daniel Morris (Ottawa TAC) and Merav Sapir (R&D) for their assistance.**","language":"md","time":"14 days ago","created":"2025-05-06T22:56:13.295Z","annotations":[],"updated":"2025-05-06T22:59:50.847Z"},{"title":"ProductCluster - 3rd-party, ClusterXL, IPSec VPN","id":"f3795cf6-7d3a-43a0-a563-d0fb51003852","type":"TEXT","raw":"ProductCluster - 3rd-party, ClusterXL, IPSec VPN, Mobile Access / SSL VPN, SSL Network Extender, VSX (Traditional)\n\nVersionR80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-01-16\n\n## Solution\n\nThis article provides general performance guidelines for working with VPN in Security Gateway\n\n**Table of Contents:**\n\n1.  Interfaces Affinity\n    \n2.  VPN and SecureXL\n    \n3.  Choosing an encryption algorithm and AES-NI\n    \n4.  Insights into SSL VPN Gateway Performance\n    \n5.  Related documentation\n    \n\n### Interface Affinity\n\n-   Interface Affinity\n    \n    Configuring interfaces affinity manually is usually not needed.  \n    As an example, we will use a 12600 appliance with a default CoreXL configuration of \"2:10\":\n    \n    -   2 CPU cores are used for Secure Network Distributor (SND), and\n    -   10 CPU cores are used for CoreXL Firewall instances, and\n    -   2 NICs - 1 LAN, 1 WAN.\n-   Enabling Multi-Queue is recommended when a single interface receives too much traffic for a single CoreXL SND to handle (refer to \"Related documentation\" section). If the CPU utilization on the CPU cores running as CoreXL SND instances is high, while the CPU utilization on CPU cores running as CoreXL Firewall instances is relatively idle, then administrator should consider reducing the number of CoreXL Firewall instances from 10 to 8, to release more CPU cores to run as CoreXL SND instances.\n    \n    This is relevant only if you have 2 NICs with Multi-Queue enabled, or 4 NICs.\n\n### VPN and SecureXL (relevant to Site-to-Site and IPSec Remote Access)\n\nWhen SecureXL is enabled, Encrypt-Decrypt actions usually take place on SecureXL level (on CPU cores running as CoreXL SND instances). All VPN traffic will be handled on the CPU cores running as CoreXL SND instances under the following conditions:\n\n-   Only \"Firewall\" and \"IPSec VPN\" Software Blades are enabled\n-   There are no fragmented packets\n-   SecureXL acceleration is not disabled by any of the security rules (see [sk32578](https://support.checkpoint.com/results/sk/sk32578))\n-   VPN features that are disqualified from SecureXL (see below) are disabled\n\nIf all the above conditions are met, all VPN traffic will be handled on CPU cores running as CoreXL SND with minimum traffic being forwarded to the CoreXL Firewall instances, resulting in multi-core processing of VPN traffic (depending on the number of CPU cores running as CoreXL SND).\n\nThe following VPN features are handled by CPU cores running as CoreXL Firewall instances:\n\n-   Any compression algorithms (go to IPSec VPN Community properties - \"Advanced Settings\" page - \"Advanced VPN Properties\")\n-   Any transport mode SA (used in L2TP clients and GRE tunnels)\n-   Multicast IPsec (GDOI)\n-   \"Monitoring\" Software Blade - if in addition to \"System Counters\", also \"Traffic\" counters are enabled in the Security Gateway object (in such a case, connections are flagged with the \"Accounting\" flag in the output of the \"`fwaccel conns`\" command)\n-   Any Software Blades other than \"Firewall\" are enabled\n\n### Choosing an encryption algorithm and AES-NI\n\nBetter throughput can be achieved by selecting a faster encryption algorithm. For a comparison of encryption algorithm speeds, refer to [sk73980 - Relative speeds of algorithms for IPsec and SSL](https://support.checkpoint.com/results/sk/sk73980).\n\n[AES-NI](https://software.intel.com/en-us/articles/intel-advanced-encryption-standard-instructions-aes-ni) is Intel's dedicated instruction set, which significantly improves the speed of Encrypt-Decrypt actions and allows one to increase VPN throughput (Site-to-Site, Remote Access and Mobile Access). The general speed of the system depends on additional parameters.\n\n**Check Point supports AES-NI on these appliance models:**\n\nNotes:\n\n-   **All Appliance Models released in the year 2024 and later, support AES-NI.**\n-   Gaia OS must run with the 64-bit kernel (this is the default in R80.40 and higher).\n-   For the End of Support dates for appliance models, see [Support Life Cycle Policy](http://www.checkpoint.com/support-services/support-life-cycle-policy/).\n\nEnter the string to filter this table:\n\n<table id=\"Unique_ID1Table\"><tbody><tr><td>Appliance Model</td><td>Home Page SK</td><td>Starting From</td></tr><tr><td><p>Quantum Force 29000</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk180520\" target=\"_blank\" rel=\"noopener\">sk180520</a></td><td>R81.20</td></tr><tr><td><p>28000, 28600</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk152733\" target=\"_blank\" rel=\"noopener\">sk152733</a></td><td>R80.40</td></tr><tr><td><p>26000</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk152733\" target=\"_blank\" rel=\"noopener\">sk152733</a></td><td>R80.40</td></tr><tr><td><p>23500, 23800, 23900</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk107516\" target=\"_blank\" rel=\"noopener\">sk107516</a></td><td>R77.30</td></tr><tr><td><p>21400, 21600, 21700, 21800</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk68701\" target=\"_blank\" rel=\"noopener\">sk68701</a></td><td>R76</td></tr><tr><td><p>Quantum Force 19000</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk180520\" target=\"_blank\" rel=\"noopener\">sk180520</a></td><td>R81.20</td></tr><tr><td><p>16000, 16200, 16600HS</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk152733\" target=\"_blank\" rel=\"noopener\">sk152733</a></td><td>R80.40</td></tr><tr><td><p>15400, 15600</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk107516\" target=\"_blank\" rel=\"noopener\">sk107516</a></td><td>R77.30</td></tr><tr><td><p>13500, 13800</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk93470\" target=\"_blank\" rel=\"noopener\">sk93470</a></td><td>R77.30</td></tr><tr><td><p>12400, 12600</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk68700\" target=\"_blank\" rel=\"noopener\">sk68700</a></td><td>R77.30</td></tr><tr><td><p>Quantum Force 9000</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk181698\" target=\"_blank\" rel=\"noopener\">sk181698</a></td><td>R81.20</td></tr><tr><td><p>7000</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk139932\" target=\"_blank\" rel=\"noopener\">sk139932</a></td><td>R80.40</td></tr><tr><td><p>6400, 6700</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk139932\" target=\"_blank\" rel=\"noopener\">sk139932</a></td><td>R80.40</td></tr><tr><td><p>6200, 6500, 6600, 6800, 6900</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk139932\" target=\"_blank\" rel=\"noopener\">sk139932</a></td><td>R80.30</td></tr><tr><td><p>5600, 5800, 5900</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk110053\" target=\"_blank\" rel=\"noopener\">sk110053</a></td><td>R77.30</td></tr><tr><td><p>3800</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk110052\" target=\"_blank\" rel=\"noopener\">sk110052</a></td><td>R80.40</td></tr><tr><td><p>3600</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk110052\" target=\"_blank\" rel=\"noopener\">sk110052</a></td><td>R80.30</td></tr><tr><td><p>3100, 3200</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk110052\" target=\"_blank\" rel=\"noopener\">sk110052</a></td><td>R77.30</td></tr><tr><td><p>LightSpeed<br>QLS250, QLS450,<br>QLS650, QLS800,<br>MLS200, MLS400</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk176466\" target=\"_blank\" rel=\"noopener\">sk176466</a></td><td>R81.10</td></tr><tr><td><p>Scalable Chassis 44000 / 64000</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk65305\" target=\"_blank\" rel=\"noopener\">sk65305</a></td><td>R76SP.50</td></tr><tr><td><p>Scalable Chassis 41000 / 61000</p></td><td><a href=\"https://support.checkpoint.com/results/sk/sk65305\" target=\"_blank\" rel=\"noopener\">sk65305</a></td><td>R76SP</td></tr></tbody></table>\n\nOn these appliances, AES-NI is _enabled_ by default. AES-NI is also supported on Open Servers. Make sure that Gaia OS runs in the 64-bit mode.\n\n**Note:** Refer to [sk110549 - vSEC Virtual Edition (VE) Gateway support for AES-NI on VMware ESX](https://support.checkpoint.com/results/sk/sk110549).\n\nAffected encryption algorithms include:\n\n-   AES-CBC (128-bit and 256-bit)\n-   AES-GCM (128-bit and 256-bit), which shows the most significant improvement - with AES-NI, it is faster than AES-CBC, when both sides support AES-NI. Without AES-NI support, it is slightly slower than AES-CBC + HMAC-SHA1.\n\nAES-GCM is **not** recommended in these scenarios:\n\n-   Check Point Appliances, which do not support AES-NI - 12200 model, all 4000 series, all 2000 series (in addition, Gaia OS in the 32-bit mode does not support AES-NI).\n-   VPN Communities that contain Check Point SMB 600 / SMB 1100 / SMB Security Gateway 80 Appliances - best throughput can be achieved with AES-128.\n\nAES-GCM is **not** supported by the SAM card in 21000 appliances ([sk68701](https://support.checkpoint.com/results/sk/sk68701)) - best throughput can be achieved with AES-128.\n\n#### Visitor Mode\n\n-   Visitor Mode is supported by the legacy SecureClient and by Endpoint Security Client / Endpoint Connect Client.\n    \n    Each packet in Visitor Mode is processed in user space, which causes a load on CPU on the Security Gateway (only several hundred Visitor Mode clients can be handled by the Security Gateway).\n    \n    In SecureClient, if enabled by the user, Visitor Mode is never automatically turned off. It is recommended that users enable Visitor Mode only when essential (typical to Airport and Hotel Wi-Fi spots), and disable it afterwards.\n    \n    Large-Scale support for Visitor Mode is included in:\n    \n    -   R81 and higher\n    -   [R80.40 Jumbo Hotfix Accumulator](https://sc1.checkpoint.com/documents/Jumbo_HFA/R80.40/Default.htm), Take 53 and higher (see PRJ-12102)\n\n### Insights into SSL VPN Gateway Performance\n\n-   #### Hardware\n    \n    -   It is recommended to use a dedicated Check Point appliance as the SSL VPN Gateway.\n    -   A Load Sharing cluster is preferable to a stronger appliance in most cases.  \n        -   In the Load Sharing mode, Sticky Decision Function (SDF) is enabled automatically. By design, SDF disables SecureXL, which decreases the overall performance and the performance of IPsec clients. You may disable Sticky Decision Function (SDF) in the cluster object in SmartConsole. When Mobile Access Software Blade is enabled, Sticky Decision Function (SDF) is forced and cannot be disabled.\n-   #### General\n    \n    -   Simultaneous Logins - lowering the number of simultaneous logins increases capacity.\n    -   Web compression - saves bandwidth, but increases load on Security Gateway's CPU.\n    -   Logging in security rules - increases the load on the Security Gateway's CPU.\n-   #### Sizing\n    \n    -   The appliance sizing tool ([sk88160](https://support.checkpoint.com/results/sk/sk88160)) should only be used for 5000 users or less.\n    -   It is important to understand the web application complexity when using sizing tools. Tunneled applications, such as Remote Desktop users, consume considerably more bandwidth than Outlook Web Access (OWA). In turn, OWA consumes more bandwidth than simple web applications.\n-   #### Security\n    \n    -   IPS - disabling some Web Intelligence protections may decrease CPU utilization on the Security Gateway.\n    -   Traditional Anti-Virus causes throughput and concurrent connections degradations in SSL VPN.\n    -   Client Authentication - using client certificate for authentication increases CPU utilization the most.\n-   #### Network Configuration\n    \n    -   To improve latency, verify short response time of internal servers, DNS servers, and Proxy server.\n-   #### SSL Termination\n    \n    -   Starting from R76, increasing the number of CoreXL Firewall instances linearly increases the SSL session rate.\n-   #### Web Applications\n    \n    -   Apache Keep-Alive\n        \n        HTTP requests are served by Apache Web Server processes. Due to the fact that these processes are _not_ multi-threaded, each Apache process serves _one_ HTTP request at a time. Each Apache process consumes approximately 2 Megabytes of RAM per HTTP request. In order not to exhaust the machine's RAM, there is a cap of ~15% of machine's RAM for Apache processes.\n        \n        For example, a machine with 2GB RAM will have up to 148 Apache processes. The 15% cap is for Mobile Access Software Blade.\n        \n        It is possible to configure Mobile Access as a single Software Blade running on a dedicated Security Gateway (refer to [sk53003](https://support.checkpoint.com/results/sk/sk53003)). However, in R75.30 and lower, the total number of Apache processes could not exceed 990 - even if there was enough RAM.\n        \n        Usually, an Apache process can serve up to 4 users. Therefore, if _\\[number of users\\] < \\[4 x number of Apache process\\]_, then consider reducing the cap to free memory for other uses.\n        \n        When an HTTP request is served, the connection may not be immediately closed. Apache has the possibility to keep the connection open for a configurable period of time though keep-alives. The keep-alive configuration is used to reduce web browser request latency by allowing subsequent requests on the same connection to be served by this Apache process instead of spawning a new instance.\n        \n        Due to the fact that there is a cap for the number of Apache processes, this configuration could cause HTTP requests to be dropped because Apache processes are \"waiting\" for requests before handling other connections.\n        \n        By default the keep-alive is sent every 2 seconds.\n        \n        -   For maximum capacity, _disable_ Apache keep-alive.\n        -   For minimum latency, _increase_ the Apache keep-alive\n            \n            -   Avoid SSL on internal traffic\n            -   Prefer Kerberos over NTLM for authentication, because NTLM authentication is re-done for every TCP connection.  \n                Using Kerberos reduces bandwidth between the Security Gateway and the internal server, and reduces latency for end users.\n            -   Hostname Translation is preferred over Link Translation because Hostname Translation configuration reduces CPU and RAM utilization, improves throughput and latency, and reduces bandwidth.\n            -   Link Translation Domain - remove external websites from the list of websites that will be translated for improved performance and capacity.\n            -   More than 700 concurrent ActiveSync clients are supported.\n-   #### SNX Application Mode\n    \n    -   There can be up to 512 simultaneous SNX Application Mode connections (limit of file descriptors in the operating system).\n    -   Throughput is limited by one CPU core for SSL processing.\n\n-   [sk104760 - ATRG: VPN Core](https://support.checkpoint.com/results/sk/sk104760)\n-   [sk98737 - ATRG: CoreXL](https://support.checkpoint.com/results/sk/sk98737)\n-   [sk98722 - ATRG: SecureXL for R80.20 and higher](https://support.checkpoint.com/results/sk/sk153832)\n-   [sk93000 - SMT (HyperThreading) Feature Guide](https://support.checkpoint.com/results/sk/sk93000)\n-   [sk118097 - MultiCore Support for IPsec VPN](https://support.checkpoint.com/results/sk/sk118097)\n-   Also see the [ClusterXL Administration Guide](https://support.checkpoint.com/product/531#f-commonsource=C.%20Documentation) for the relevant version.\n\n## Article Properties\n\nOriginatorAdam Narkunski\n\nTechnical ResourceEitan Natanian\n\nAccess LevelGeneral\n\nStatusApproved\n\nDate Created2015-05-04\n\nLast Modified2025-01-16\n\nEditorLiron Rubin\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only\n\nThis SK applies to R82.10 as well\n\nFor more information re AES-NI support on 5900 / 6000 appliances, refer to SR # 6-0001526493.\n\n\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n\n**Statement from RnD regarding VPN multicore:**\n\n> ```\n> ----Original Message----\n> From: Adam Narkunski \n> Sent: Wednesday, May 13, 2015 4:37 PM\n> To: Sergei Shir; Oral Mohan\n> Cc: Tzvi Katz; Igor Roytman\n> Subject: RE: sk105119 - Best Practices - VPN Performance == VPN is not multicore in R77.20\n> \n> Hello Oral!\n> \n> The situation outlined here is when there are multiple CoreXL <em><strong>SND</strong></em> cores (SecureXL) \n> that encrypt/decrypt traffic, with minimum traffic forwarded to the (single) CoreXL FW instance. \n> \n> This is \"de-facto\" multicore, by having the SND cores handle most of the VPN traffic.\n> It applies only to situations outlined in the bullets (\"If all conditions are met...). \n> \n> This is different from \"true\" IPsec multicore, where there are <em><strong>multiple</strong></em> VPN CoreXL instances.\n> \n> ----Original Message----\n> From: Oral Mohan \n> Sent: Wednesday, May 13, 2015 4:09 PM\n> To: Sergei Shir\n> Subject: RE: sk105119 - Best Practices - VPN Performance\n> \n> Sergei,\n> \n> There seems  to be a conflict in this SK. \n> The note below indicates that VPN is not multicore in R77.20, which is my understanding as well, but the SK says:\n> ```\n> \n> > When SecureXL is enabled, Encrypt-Decrypt actions usually take place on SecureXL level (on CPU cores running as CoreXL SND). _**All VPN traffic will be handled on the CPU cores running as CoreXL SND**_ under the following conditions:\n> > \n> > -   Only \"Firewall\" and \"IPSec VPN\" software blades are enabled\n> > -   There are no fragmented packets\n> > -   SecureXL acceleration is not disabled by any of the security rules (refer to sk32578)\n> > -   VPN features that are disqualified from SecureXL (see below) are disabled\n> > \n> > If all the above conditions are met, all VPN traffic will be handled on CPU cores running as CoreXL SND with minimum traffic being forwarded to the CoreXL FW instances, _**resulting in multi-core processing of VPN traffic**_ (depending on the number of CPU cores running as CoreXL SND).\n> \n> ```\n> Oral Mohan\n> Principal Consultant, Professional Services \n> ```\n\n___\n\n**Statement from RnD regarding \"[sk93000 - SMT (HyperThreading)](http://supportcontent.checkpoint.com/solutions?id=sk93000)\" feature:**\n\n> ```\n> ----Original Message----\n> From: Kfir Ziv \n> Sent: Wednesday, May 13, 2015 11:26\n> To: Adam Narkunski; Eyal Sher\n> Cc: Igor Roytman; Tzvi Katz\n> Subject: RE: sk105119 - Best Practices - VPN Performance\n> \n> There is no point to add SMT, since VPN isn’t Multicore on R77.20.\n> You’ll still have only 1 fw-instance for the VPN, actually with SMT it can be worse, \n> since logical core is less powerful than real core.\n> \n> Thanks,\n> Kfir Ziv\n> Team Leader - Performance Team\n> \n> ----Original Message----\n> From: Sergei Shir \n> Sent: Tuesday, May 05, 2015 19:26\n> To: Tzvi Katz; Adam Narkunski\n> Subject: RE: sk105119 - Best Practices - VPN Performance\n> \n> Could you please provide some best practice for VPN when using the SMT (HyperThreading) feature in our appliances ?\n> \n> SMT is described in sk93000:\n> When enabled, SMT doubles the number of logical CPUs on the Security Gateway, which enhances physical processor utilization. \n> When SMT is disabled, the number of logical CPUs equals the number of physical cores.\n> SMT improves performance up to 30% in NGFW software blades such as IPS, Application &amp; URL Filtering and Threat Prevention \n> by increasing the number of CoreXL FW instances based on the number of logical CPUs\n> ```\n\n___\n\n**Monitoring Software Blade disables traffic acceleration - if in addition to \"System Counters\", also \"Traffic\" counters are activated**\n\nDuring troubleshooting session with customer due to high CPU load on the CoreXL FW instance handling VPN Traffic, output of \"fwaccel conns\" command showed sessions with \"Accounting\" flag.\n\nAccounting was not used in the security policy.\n\nDisabling \"Traffic\" counters in the Monitoring Software Blade (in the Security Gateway object) moved traffic to accelerated path.\n\n-   \"Traffic\" counters are enabled in the Monitoring Software Blade:\n    \n    ```\n    [Expert@HostName:0]# fwaccel conns\n    \n    Source          SPort Destination     DPort PR Flags     C2S i/f S2C i/f Inst Identity\n    --------------- ----- --------------- ----- -- ----------- ------- ------- ---- -------\n    10.55.107.49      161     10.55.1.178 53127 17 ...<span>A</span>C...... 1/8     8/-      0        0\n    10.55.40.146    30005     10.55.0.107 58698 17 ...<span>A</span>C...... 1/8     8/1      0        0\n    10.23.5.4         161      10.55.1.30 54977 17 ...<span>A</span>C...... 1/8     -/-      0        0\n    ```\n    \n-   \"Traffic\" counters are disabled in the Monitoring Software Blade:\n    \n    ```\n    [Expert@HostName:0]# fwaccel conns\n    \n    Source          SPort Destination     DPort PR Flags     C2S i/f S2C i/f Inst Identity\n    --------------- ----- --------------- ----- -- ----------- ------- ------- ---- -------\n    10.55.217.200   64390     10.55.1.162 49159  6 ....C...... 10/4    4/10     0        0\n    10.55.1.162     56944    10.55.171.26   161 17 ....C...... 4/10    10/-     0        0\n    10.55.1.41       8080    10.55.217.72 52423  6 ....C...... 10/4    4/10     0        0\n    ```","language":"md","time":"14 days ago","created":"2025-05-06T22:56:10.267Z","annotations":[],"updated":"2025-05-06T22:59:00.755Z"},{"title":"Threat Prevention to Threat Emulation Solution","id":"67616659-a9e3-46da-97a5-e38449ec99a3","type":"TEXT","raw":"**Table of Contents:**\n\n1.  Introduction to Threat Prevention\n    \n2.  Introduction to Threat Emulation solution\n    \n3.  Supported Configuration and Requirements\n    \n4.  Limitations and current design\n    \n5.  File emulation location - ThreatCloud vs Local / Remote Threat Emulation Appliance\n    \n6.  Deployment options\n    \n7.  Emulation Workflow\n    \n8.  Emulation Connection Handling Mode\n    \n9.  User Space\n    \n10.  The _tecli_ command (Threat Emulation Command Line Tool)\n    \n    -   _tecli show ..._ commands\n        \n    -   _tecli control ..._ commands\n        \n    -   _tecli set ..._ commands\n        \n    -   _tecli advanced ..._ commands\n        \n    -   _tecli cache ..._ commands\n        \n    -   _tecli debug ..._ commands\n        \n11.  The _cpstat threat-emulation_ command\n    \n12.  Factors that limit the number of Virtual Machines that can be started\n    \n13.  Static Analysis\n    \n14.  Detection Rules\n    \n15.  Scanning of Archives\n    \n16.  File Reclassifier\n    \n17.  Detection of a malicious file\n    \n18.  Emulation of multiple files of the same type on the same virtual machine\n    \n19.  Threat Emulation API\n    \n20.  Performance considerations and Best practices\n    \n21.  Configuring multiple Threat Emulation Appliances for redundancy and load sharing\n    \n22.  Mail Transfer Agent (MTA) redundancy\n    \n23.  Monitoring\n    \n24.  Troubleshooting\n    \n25.  Debug\n    \n\n### (1) Introduction to Threat Prevention\n\nTo challenge today's malware landscape, Check Point's comprehensive Threat Prevention solution offers a multi-layered, pre-infection and post-infection defense approach and a consolidated platform that enables enterprise security to deal with modern malware:\n\n<table><tbody><tr><td>Software Blade</td><td>Description</td><td>Reference</td></tr><tr><td>Threat Emulation</td><td><p>Stops unknown malware, targeted attacks, and zero-day attacks.</p><p>Works by:</p><ol type=\"A\"><li>Identifying files in e-mail attachments (SMTP &amp; SMTP/TLS) and<br>downloads over the web (HTTP &amp; HTTPS)</li><li>Uploading the suspicious files to virtual sandbox<br>(in the cloud, or on local appliance) for further emulation and analysis</li><li>Emulating the suspicious files in various OS environments<br>by opening the files and monitoring abnormal behavior (related to<br>file system, system registry, network connections, system processes, etc.)</li><li>Stopping the malicious files, and prevent the from getting to the end user</li><li>Sharing data (in real-time) about the detected malicious files with ThreatCloud</li></ol></td><td>Described in this article</td></tr><tr><td>Threat Extraction</td><td>Pro-actively cleans potential threats from incoming files</td><td><a href=\"https://support.checkpoint.com/results/sk/sk114807\" target=\"_blank\" rel=\"noopener\">sk114807 - ATRG: Threat Extraction</a></td></tr><tr><td>Anti-Bot</td><td><p>Post-infection bot detection, prevention, and threat visibility</p><p>Works by:</p><ul><li>Identifying Bot-infected devices (based on reputation, patterns, etc.)</li><li>Stopping traffic to remote operators</li></ul></td><td><a href=\"https://support.checkpoint.com/results/sk/sk92264\" target=\"_blank\" rel=\"noopener\">sk92264 - ATRG: Anti-Bot and Anti-Virus</a></td></tr><tr><td>Anti-Virus</td><td><p>Pre-infection blocking of known viruses and file transfers.</p><p>Works by:</p><ul><li>Looking for specific patterns</li><li>Enforcing compliance of protocols to standards</li><li>Detecting variations from the protocols</li></ul></td><td><a href=\"https://support.checkpoint.com/results/sk/sk92264\" target=\"_blank\" rel=\"noopener\">sk92264 - ATRG: Anti-Bot and Anti-Virus</a></td></tr></tbody></table>\n\n  \nEach Threat Prevention Software Blade gives unique network protections and they can be combined to supply a strong malware solution.  \nData from malicious attacks are shared between the Threat Prevention Software Blades and help keep your network safe.  \nFor example, the signature from threat that is identified by the Threat Emulation is added to the Anti-Virus database.\n\nThe Threat Prevention Software Blades use a separate policy installation to minimize risk and operational impact.  \nThey are also integrated with other Software Blades on the Security Gateway to detect and stop threats.\n\n### (2) Introduction to SandBlast Threat Emulation solution\n\n1.  [SandBlast Threat Emulation (Sandboxing)](https://www.checkpoint.com/products/threat-emulation-sandboxing/) can protect your network against new malware, zero-day vulnerabilities and targeted attacks.\n    \n    Threat Emulation gives networks the necessary protection against unknown threats in files that are downloaded from the Internet or attached to e-mails.  \n    When emulation is done on a file:\n    \n    -   The file is opened on more than one virtual computer with different operating system environments.\n    -   The virtual computers are closely monitored for unusual and malicious behavior, such as an attempt to change registry keys or run an unauthorized process.\n    -   Any malicious behavior is immediately logged and you can use Prevent mode to block the file from the internal network.\n    -   The cryptographic hash of a new malicious file is saved to a database and the internal network is protected from that malware.\n    -   Information about malicious files and malware is shared with the Check Point ThreatCloud (administrator can disable this) and helps protect all ThreatCloud users.\n2.  The goal of sandboxing:\n    \n    -   Inspect all incoming files to an organization and send them to a safe virtual environment\n    -   Open the files in the virtual environment to see what would happen if someone inside of the organization would open this file\n    -   Prevent the malicious files from entering the organization\n    \n      \n    \n    <table><tbody><tr><td>Sandboxing Type</td><td>Description</td><td>Works by</td></tr><tr><td>CPU-Level Emulation</td><td><ul><li>New leading edge technology unique to Check Point</li><li>Next generation of sandboxing to catch more malware<br><ul><li>No guesswork required, detection is definitive</li><li>Not based on heuristics or statistics</li></ul></li><li>Resistant to evasions</li><li>Fast and effective</li></ul>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk107333\" target=\"_blank\" rel=\"noopener\">sk107333 - Support for CPU Level sandboxing on<br>Threat Emulation appliances TE100X, TE250X, TE1000X, TE2000X</a></td><td><ul><li>Monitoring CPU buffer</li><li>Finding exploits</li><li>Preventing malware before it executes</li></ul></td></tr><tr><td>OS-Level Emulation</td><td><ul><li>Traditional sandboxing technology</li><li>Will give a very good emulation report</li><li>Most times effective, but are susceptible to evasions</li><li>The longer you emulate the file, the better catch rate you will get</li></ul></td><td><ul><li>Monitoring System Registry</li><li>Monitoring Network Connections</li><li>Monitoring File System Activity</li><li>Monitoring System Processes</li></ul></td></tr></tbody></table>\n    \n3.  Anyone can submit files for Check Point Threat Emulation and receive a detailed report:\n    \n    -   Send an e-mail with attached file to [threats@threats.checkpoint.com](mailto:threats@threats.checkpoint.com)\n    -   Submit the file on [https://threatemulation.checkpoint.com/teb/upload.jsp](https://threatemulation.checkpoint.com/teb/upload.jsp)\n\n### (3) Supported Configuration (Deployments) and Requirements\n\n<table><tbody><tr><td>Emulation Location</td><td>Gateway mode</td><td>VSX mode (<a href=\"https://support.checkpoint.com/results/sk/sk79700\" target=\"_blank\" rel=\"noopener\">sk79700</a>)</td></tr><tr><td><p>ThreatCloud emulation</p>(in Check Point cloud)</td><td><ul><li>R77 and above</li><li>R76SP.40 and above</li><li>Only Gaia OS / SecurePlatform OS / X-Series XOS</li><li>DNS Server(s) must be configured in the object of<br>Security Gateway / Cluster</li><li>Proxy Server) must be configured in the object of<br>Security Gateway / Cluster</li></ul></td><td><ul><li>R77.20 and above</li><li>R76SP.40 and above</li><li>Only Gaia OS / X-Series XOS</li><li>Threat Emulation blade is enabled only<br>in the object of Virtual System</li><li>DNS Server(s) must be configured in the object of<br>VSX Gateway / VSX Cluster</li><li>Proxy Server) must be configured in the object of<br>VSX Gateway / VSX Cluster</li></ul></td></tr><tr><td><p>Local emulation</p>(on the local<br>Threat Emulation<br>appliance<br>in your network)</td><td><ul><li>R77 and above</li><li>R76SP.40 and above</li><li>Only Gaia OS 64-bit</li><li>Only on Threat Emulation Private Cloud Appliance</li><li>DNS Server(s) must be configured in the object of<br>Security Gateway / Cluster</li><li>Proxy Server) must be configured in the object of<br>Security Gateway / Cluster</li></ul></td><td><ul><li>Not supported</li></ul></td></tr><tr><td><p>Remote emulation</p>(on the remote<br>Threat Emulation<br>appliance<br>in your network)</td><td><ul><li>R77 and above</li><li>R76SP.40 and above</li><li>Only Gaia OS / SecurePlatform OS</li><li>DNS Server(s) must be configured in the object of<br>Security Gateway / Cluster</li><li>Proxy Server) must be configured in the object of<br>Security Gateway / Cluster</li></ul></td><td><ul><li>R77.20 and above</li><li>R76SP.40 and above</li><li>Only Gaia OS</li><li>Threat Emulation blade is enabled only<br>in the object of Virtual System</li><li>DNS Server(s) must be configured in the object of<br>VSX Gateway / VSX Cluster</li><li>Proxy Server) must be configured in the object of<br>VSX Gateway / VSX Cluster</li></ul></td></tr></tbody></table>\n\n**Important Notes:**\n\n-   On **R77.30** Security Management Server / Multi-Domain Security Management Server, the [R77.30 Add-On](https://support.checkpoint.com/results/sk/sk105412) must be installed and enabled.  \n    Otherwise, some relevant settings will not be available in SmartDashboard R77.30.\n-   Refer to [sk111080 - How to configure Check Point software to upload data to Check Point / download data from Check Point](https://support.checkpoint.com/results/sk/sk111080)\n-   Refer to [sk94508 - Recommended Internet Access Settings for Automatic Downloads](https://support.checkpoint.com/results/sk/sk94508)\n-   Refer to [sk94509 - Recommended Internet Access Settings for Uploading Data](https://support.checkpoint.com/results/sk/sk94509)\n-   Refer to [sk106123 - File types supported by SandBlast Threat Emulation](https://support.checkpoint.com/results/sk/sk106123)\n-   Refer to [sk111405: 60000 / 40000 Appliances - How to enable Threat Emulation blade on R76SP.40 and R76SP.50](https://support.checkpoint.com/results/sk/sk111405)\n\n### (4) Limitations and current design\n\n<table><tbody><tr><td>Blade / Feature / Configuration</td><td>Limitation / Current Design</td></tr><tr><td>Security Gateway in <em>Gateway</em> mode</td><td><ul><li><p>ThreatCloud emulation</p><ul><li>Only Gaia OS / SecurePlatform OS / X-Series XOS are supported</li></ul></li><li><p>Local emulation</p><ul><li>Only Gaia OS running kernel 64-bit is supported</li></ul></li><li><p>Remote emulation:</p><ul><li>Only Gaia OS and SecurePlatform OS are supported</li></ul></li></ul></td></tr><tr><td>Security Gateway in <em>VSX</em> mode</td><td><ul><li><p>ThreatCloud emulation:</p><ul><li>Mail Transfer Agent (MTA) is supported in R80.10 and above</li><li>Not supported on Virtual Systems in Bridge Mode as it has no IP address<ul><li>In R81 and higher versions there is an option to define a regular Virtual System (not in Bridge Mode) and add bridge interfaces to it. Refer to the <a href=\"https://support.checkpoint.com/product/359#f-commonsource=C.%20Documentation\" target=\"_blank\" rel=\"noopener\">VSX Administration Guide</a> for your version &gt; Adding a Bridge Interface to a Virtual System.</li></ul></li><li>Virtual System Load Sharing clusters with more than two members are supported in R80.10 and above</li></ul></li><li><p>Local emulation</p><ul><li>Threat Emulation is <em>not</em> supported at all</li></ul></li><li><p>Remote emulation:</p><ul><li>X-Series XOS is <em>not</em> supported</li><li>Mail Transfer Agent (MTA) is supported in R80.10 and above</li><li>Not supported on Virtual Systems in Bridge Mode as it has no IP address</li><ul><li>In R81 and higher versions there is an option to define a regular Virtual System (not in Bridge Mode) and add bridge interfaces to it. Refer to the <a href=\"https://support.checkpoint.com/product/359#f-commonsource=C.%20Documentation\" target=\"_blank\" rel=\"noopener\">VSX Administration Guide</a> for your version &gt; Adding a Bridge Interface to a Virtual System.</li></ul><li>Virtual System Load Sharing clusters with more than two members are supported in R80.10 and above</li></ul></li></ul></td></tr><tr><td>Cluster</td><td><ul><li>Threat Emulation local cache is <em>not</em> synchronized.</li></ul></td></tr><tr><td>UserCheck</td><td><ul><li><p>When processing a file received over HTTP, UserCheck can <em>not</em> send messages to the browser <em>after</em> the download has started</p><ul><li>New malicious files need UserCheck agent to display the UserCheck message</li><li>For known (by Threat Emulation) malicious files, a UserCheck message <em>can</em> be displayed in the browser</li></ul></li><li><p>SMTP has no interface to display the UserCheck message</p><ul><li>UserCheck agent is supported <em>only</em> if a client uses SMTP to send an e-mail to the SMTP server</li><li>UserCheck message via e-mail is <em>not</em> supported for any of the Threat Prevention blades - only for DLP</li><li>To provide a user-friendly notification, Security Gateway must be configured as a Mail Transfer Agent (MTA) -<br>the malicious attachment will be replaced with a text file</li></ul></li></ul></td></tr><tr><td>Web Portals</td><td><ul><li>Threat Emulation uses port 8080 and requires that it is free and available. No portal is allowed to use port 8080 when Threat Emulation blade is enabled, including WebUI.</li><li>This is relevant only for Sandblast Appliances or Firewall that is performing local emulation.<br>Output of TE debug:<br><code>[TE (TD::Surprise)] te::NetworkEventParser::_parse_data: NetworkEventParser Error: could not parse first line. data: 'Traceback (most recent call last): File \"FakeServer.py\", line 519, in &lt;module&gt;<br>File \"FakeServer.py\", line 486, in run_servers<br>File \"/etc/fw/Python/lib/python2.7/SocketServer.py\", line 419, in server_bind<br>File \"/etc/fw/Python/lib/python2.7/socket.py\", line 224, in meth<br>socket.error: [Errno 98] Address already in use</code></li></ul></td></tr><tr><td>Monitor (SPAN / TAP) deployment</td><td><ul><li>\"Prevent\" action in the Threat Prevention policy is <em>not</em> supported</li><li>HTTPS Inspection is <em>not</em> supported</li><li>SMTPS over TLS inspection is <em>not</em> supported</li></ul></td></tr><tr><td>SMB Appliances on Gaia Embedded OS</td><td><ul><li>Cloud mode and Private cloud mode are supported in the R77.20.51 firmware.<br>For more details, see <a href=\"https://support.checkpoint.com/results/sk/sk114815\" target=\"_blank\" rel=\"noopener\">sk114815</a>.<br>Note: It is not supported to upgrade from the R77.20.51 firmware.</li></ul></td></tr><tr><td>Security Gateway on IPSO OS</td><td><ul><li>Threat Emulation is <em>not</em> supported at all</li></ul></td></tr><tr><td>Security Gateway on Windows OS</td><td><ul><li>Threat Emulation is <em>not</em> supported at all</li></ul></td></tr></tbody></table>\n\n**Note:**  Starting from **R81** these appliances are no longer supported:  \nSmart-1 205/210, 2200, 4200, 4400, 4600, 4800, 12200, 12400, 12600, 13500, 13800, 21400, 21600, 21700, 21800.\n\n###   \n(5) File emulation location - ThreatCloud vs Local / Remote Threat Emulation Appliance\n\n<table><tbody><tr><td>Item</td><td><em>Cloud Emulation</em>:<br>Check Point ThreatCloud<br>(Public)</td><td><em>Local Emulation</em>:<br>Threat Emulation<br>Private Cloud Appliance</td><td><em>Remote Emulation</em>:<br>Threat Emulation<br>Appliance</td></tr><tr><td>Where files are emulated</td><td><p>In Check Point ThreatCloud</p><br><em>Example topology</em>:<br><a target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/Sample_ThreatCloud_Deployment.png\" alt=\"ThreatCloud Public topology\"></a></td><td><p>On the local Threat Emulation<br>appliance in your network</p><em>Example topology</em>:<br><a target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/Sample_Local_Deployment.png\" alt=\"Local Emulation topology\"></a></td><td><p>On the remote Threat Emulation<br>appliance in your network</p><em>Example topology</em>:<br><a target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/Sample_Remote_Deployment.png\" alt=\"Remote Emulation topology\"></a></td></tr><tr><td>Available policy actions</td><td>\"Prevent\" and \"Detect\"</td><td>\"Prevent\" and \"Detect\"</td><td>\"Prevent\" and \"Detect\"</td></tr><tr><td>Machine resources<br>(CPU, RAM, HDD)</td><td>Impact is similar to AV/Deep Scan</td><td>High usage of CPU And RAM for running the sandboxing environment.</td><td>Impact is similar to AV/Deep Scan</td></tr><tr><td>ThreatCloud License</td><td>Required to send files for emulation. For more details, see: <a href=\"https://support.checkpoint.com/results/sk/sk119133\" target=\"_blank\" rel=\"noopener\">sk119133</a></td><td>Depends on configuration, see <a href=\"https://support.checkpoint.com/results/sk/sk119133\" target=\"_blank\" rel=\"noopener\">sk119133</a></td><td>Required to send files for emulation. For more details, see: <a href=\"https://support.checkpoint.com/results/sk/sk119133\" target=\"_blank\" rel=\"noopener\">sk119133</a></td></tr><tr><td>Custom OS images</td><td>Not possible</td><td>Possible but not recommended. The recommended configuration provide significant performance and detection superiority due to the nature of the sandbox to provide a good host for the malware.</td><td>Possible but not recommended. The recommended configuration provide significant performance and detection superiority due to the nature of the sandbox to provide a good host for the malware.</td></tr><tr><td>Alternative OS images</td><td>Possible, with licensing.</td><td>Not possible</td><td>Not possible</td></tr><tr><td>Data samples</td><td>Huge data sample set</td><td>Your appliance knows your files best,<br>but has smaller data sample set.</td><td>Your appliance knows your files best,<br>but has smaller data sample set.</td></tr><tr><td>Latency</td><td>Can be noticeable.</td><td>Low</td><td>Can be noticeable.</td></tr><tr><td>Privacy</td><td>Files must be shared.</td><td>Files are kept on-site,<br>control what is shared.</td><td>Files are kept on-site,<br>control what is shared.</td></tr><tr><td>Update of OS images</td><td>Automatic and Transparent</td><td>Images must be downloaded, and<br>update must be scheduled to not disrupt scanning.</td><td>Images must be downloaded, and<br>update must be scheduled to not disrupt scanning.</td></tr><tr><td>Shared threat database</td><td>Real-time data</td><td>Takes time until data is updated.</td><td>Takes time until data is updated.</td></tr><tr><td>Multi-Site deployment</td><td>ThreatCloud can work with Security Gateway of any \"size\".<br>Does not require additional hardware.</td><td>Depending on the amount of emulated files, a local appliance might be required.<br>Threat Emulation Appliances for all business sizes can be offered.<br>Threat Emulation can be load balanced.</td><td>Depending on the amount of emulated files, a local appliance might be required.<br>Threat Emulation Appliances for all business sizes can be offered.<br>Threat Emulation can be load balanced.</td></tr></tbody></table>\n\nNote - Refer to [sk93598 - Threat Emulation Sizing Mode: how to measure the required inspections at an organization](https://support.checkpoint.com/results/sk/sk93598).\n\n### (6) Deployment options\n\nNote: All the deployment options require an additional NGTX license (also see [sk119133](https://support.checkpoint.com/results/sk/sk119133)).\n\nDeployment options are:\n\n-   _Inline_\n    \n-   _Monitor_ (SPAN / TAP)\n    \n-   _Remote_ (recommended)\n    \n\n<table><tbody><tr><td>Deployment<br>option</td><td>Description</td></tr><tr><td id=\"Deployment options - Inline\">Inline</td><td><ul type=\"disc\"><li><p>Background:</p><p>Allows to use \"<code>Prevent</code>\" action and \"<code>Ask</code>\" action (with UserCheck) in the Threat Prevention policy<br>to block traffic <em>before</em> it goes to the internal computer.</p></li><li><p>Basic Emulation Workflow:</p><ol type=\"A\"><li>The ThreatCloud or Emulation appliance gets a file from the Security Gateway.</li><li>Emulation is run on the file.<br><ul type=\"square\"><li>The file is safe, and it is sent to the computer in the internal network.</li><li>If the file contains malware, it is quarantined and logged.</li></ul></li></ol></li><li><p>Deployment with a Mail Transfer Agent (MTA):</p><p>Mail Transfer Agent (MTA) is needed:</p><ul><li>If you need to inspect SMTP over TLS traffic</li><li>If you need to use the \"Prevent\" action for SMTP over TLS traffic</li><li>If you need to perform Threat Extraction on SMTP traffic</li></ul></li><li><p>Deployment in Bridge Mode:</p><p>SandBlast Threat Emulation Appliance is connected in Bridge Mode performs emulation.<br>Other existing Security Gateway perform FireWall, NAT and other functions.</p><p><em>Example topology</em>:<br><a target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/Sample_Bridge_mode_Deployment.png\" alt=\"Threat Emulation Bridge Mode\"></a></p><p>Related solutions:</p><a href=\"https://support.checkpoint.com/results/sk/sk101371\" target=\"_blank\" rel=\"noopener\">sk101371 - Bridge Mode on Gaia OS and SecurePlatform OS</a></li><li><p>Deployment with Proxy / ICAP Server:</p><p>A Proxy / ICAP Server collects files and sends then via ICAP to SandBlast TE Appliance for emulation.</p><p>Note: Sandblast TE Appliance can act as MTA to emulate e-mail traffic at the same time.</p><p><em>Example topology</em>:<br><a target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/Sample_Proxy_ICAP_Deployment.png\" alt=\"Threat Emulation Proxy Server and ICAP Server\"></a></p></li><li><p>Software Subscription requirement:</p><p>This deployment option <em>requires</em> a Software Subscription on the SandBlast TE Appliance.</p></li></ul></td></tr><tr><td id=\"Deployment options - Monitor\">Monitor<br>(SPAN / TAP)</td><td><ul type=\"disc\"><li><p>Background:</p><p>Allows to use only the \"<code>Detect</code>\" action in the Threat Prevention policy.</p><p>SPAN / TAP / Monitor Port configuration is used to duplicate the network traffic.<br>The files are sent directly to Threat Emulation <em><strong>and</strong></em> to the computer in the internal network.<br>If Threat Emulation discovers that a file contains malware, the corresponding log is generated.</p><p><em>Example topology</em>:<br><a target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/Sample_SPAN_TAP_Deployment.png\" alt=\"Threat Emulation Monitor Span Tap Mode\"></a></p></li><li><p>Basic Emulation Workflow:</p><ol type=\"A\"><li>The ThreatCloud or Threat Emulation appliance receives a copy of a file from the Security Gateway.<br>The original file goes to the computer in the internal network.</li><li>Emulation is run on the file.<br><ul type=\"square\"><li>The file is safe, no other action is done.</li><li>If the file is identified as malware, it is logged according to the \"<code>Track</code>\" action of the Threat Prevention rule.</li></ul></li></ol></li><li><p>Notes:</p><ul><li><p>The default behavior of Threat Emulation blade in this deployment option is to <em><strong>inspect all traffic</strong></em>,<br>even if the Topology is configured in the Threat Emulation Gateway.</p></li><li><p>A kernel parameter can be enabled to configure the Threat Emulation Gateway to use<br>the \"Protected Scope\" settings (from the Threat Prevention Profile - \"Threat Emulation Settings\" pane)<br>also for SPAN / TAP / Monitor Port and use the Topology configured in the Threat Emulation Gateway object:</p><ul><li><p>To check the current value of this kernel parameter:</p><strong><code>[Expert@HostName:0]# fw ctl get int te_handle_span_port_interfaces_according_to_topology</code></strong></li><li><p>To set the desired value for this kernel parameter <em>on-the-fly</em> (does not survive reboot):</p><strong><code>[Expert@HostName:0]# fw ctl set int te_handle_span_port_interfaces_according_to_topology 1</code></strong></li><li><p>To set the desired value for this kernel parameter <em>permanently</em>:</p><p>In R80.20 and above:</p><p><code>fw ctl set -f int te_handle_span_port_interfaces_according_to_topology 1</code></p><p>In R80.10 and lower:</p><p>Follow <a href=\"http://supportcontent.checkpoint.com/solutions?id=sk26202\" target=\"_blank\" rel=\"noopener\">sk26202 - Changing the kernel global parameters on Check Point Security Gateways</a>.</p><ol type=\"A\"><li><p>Create the <em>$FWDIR/boot/modules/fwkern.conf</em> file (if it does not already exit):</p><strong><code>[Expert@HostName:0]# touch $FWDIR/boot/modules/fwkern.conf</code></strong></li><li><p>Edit the <em>$FWDIR/boot/modules/fwkern.conf</em> file in Vi editor:</p><strong><code>[Expert@HostName:0]# vi $FWDIR/boot/modules/fwkern.conf&lt;</code></strong></li><li><p>Add the following line (spaces and comments are not allowed):</p><strong><code>te_handle_span_port_interfaces_according_to_topology=1</code></strong></li><li><p>Save the changes and exit from Vi editor.</p></li><li><p>Check the contents of the <em>$FWDIR/boot/modules/fwkern.conf</em> file:</p><strong><code>[Expert@HostName:0]# cat $FWDIR/boot/modules/fwkern.conf</code></strong></li><li><p>Reboot the Security Gateway.</p></li><li><p>Verify that the new value was set:</p><strong><code>[Expert@HostName:0]# fw ctl get int te_handle_span_port_interfaces_according_to_topology</code></strong></li></ol></li></ul></li><li><p>Not defining the Topology in the Threat Emulation Gateway object may cause:</p><ul><li>Internal files being sent to the cloud</li><li>ThreatCloud Quota overuse</li><li>Impact on performance since more files are emulated</li></ul></li><li><p>The following features are <em>not</em> supported in Monitor (SPAN / TAP) deployment:</p><ul><li>HTTPS Inspection</li><li>SMTPS over TLS inspection</li><li>\"Prevent\" action</li></ul></li><li><p>SPAN ports tend to lose packets, according to the switch capabilities and the actual network throughput.</p><p>This can cause Threat Emulation (and the rest of the blades) not to inspect some traffic.<br>Take this into consideration - if some files are not shown in logs, make sure (e.g., using <code>tcpdump</code>)<br>that all of the packets indeed arrived correctly.</p></li><li><p>The SPAN port must be configured to support the combined overall throughput of the uplink and downlink seen.</p><p>For example, 100Mbps span port can not span a 60Mbps sync connection - as it needs to pass 120Mbps to the device.<br>Make sure the SPAN port can handle the traffic load.<br>Prefer TAP deployment if possible.</p></li></ul></li><li><p>Software Subscription requirement:</p><p>This deployment option does <em>not</em> require a Software Subscription on the SandBlast TE Appliance.</p></li></ul></td></tr><tr><td id=\"Deployment options - Remote\">Remote<br>(recommended)</td><td><ul type=\"disc\"><li><p>Background:</p><p>Security Gateway sends files to the remote Threat Emulation Private Cloud Appliance(s) on the network.</p><p>Allows to use \"<code>Prevent</code>\" action and \"<code>Ask</code>\" action (with UserCheck) in the Threat Prevention policy<br>to block traffic <em>before</em> it goes to the internal computer.</p></li><li><p>How to configure:</p><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk102309\" target=\"_blank\" rel=\"noopener\">sk102309 - Threat Emulation support for Multiple Private Cloud Appliances</a>.</p></li></ul></td></tr></tbody></table>\n\n### (7) Emulation Workflow\n\n-   The process begins with traffic arriving to the protocol parsers, and Threat Emulation File aggregation kernel part decides that file needs to be scanned (according to the policy).  \n    If this file needs to be scanned (and Threat Emulation is _not_ in the Bypass mode), then the file part will be sent to the Threat Emulation Daemon ('TED') process, which will send it to the correlating 'DLPU' process instance.  \n    The DLPU process instance will handle the actual file reassembly.\n    \n-   DLPU process instance (per the allowed number of CPU cores) reassembles files from parsers in CoreXL FW Instances  \n    Temporary file parts are kept in `$FWDIR/tmp/te/dlpu_tmp_files_X-Y/{zzz}` directories.\n    \n-   Threat Emulation Daemon (TED) process on Local Emulation Appliance:\n    \n    -   Receives the complete file and processes it through file type checks to understand if emulation is needed (due to advanced features).\n    -   Checks Threat Emulation local cache if the file was already emulated.\n    -   Checks system resources (CPU/Memory) to create an emulation queue if needed.\n    -   Performs static analysis.\n    -   Executes emulation according to policy settings.\n    -   Collects forensics details from the VM activity agent.\n    -   Collects statistics of the emulation environment.\n    -   Performs local logging/reporting and shares data with ThreatCloud.\n-   Flow on Local Emulation Appliance:\n    \n    1.  File arrives at the CoreXL FW instance.\n    2.  Decision is made whether to scan it or not (according to the policy).\n    3.  The file is sent by the TED process to the correlating DLPU process instance in the user space.  \n        The DLPU process handles the file reassembly.  \n        Temporary file parts are kept in `$FWDIR/tmp/te/dlpu_tmp_files_<X-Y>/` directories.\n    4.  Once DLPU process finishes file reassembly, it sends the file back to the TED process.\n-   Malicious files are stored in a repository on the Threat Emulation Appliance in the **`/var/log/mal_files/`** directory (applies to all emulation deployments).\n    \n-   Malicious files are stored in a repository on the Security Gateway in `/var/log/mal_files/` directory.\n    \n-   If a file detected as malicious in Anti-Virus blade, and the rule contains the \"Prevent\" action, then file will always generate a Threat Emulation \"`Detect`\" log.\n    \n-   Inspection Flow:\n    \n    <table><tbody><tr><td>Streaming</td><td>MTA</td></tr><tr><td><p>Parser in CoreXL FW Instance -&gt; DLPU -&gt; TED:</p><p><a target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/File_Processing_Streaming.png\" alt=\"Threat Emulation inspection flow for Streaming\"></a></p>Temp file parts are kept in these directories:<br><code>$FWDIR/tmp/te/dlpu_tmp_files_&lt;X-Y&gt;/</code></td><td><p>Parser in CoreXL FW Instance -&gt; Postfix -&gt; in.emaild.mta -&gt; TED -&gt; in.emaild.mta -&gt; Postfix:</p><p><a target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/File_Processing_MTA.png\" alt=\"Threat Emulation inspection flow for MTA\"></a></p>Temp file parts are kept in this directory:<br><code>$FWDIR/tmp/email_tmp/</code></td></tr></tbody></table>\n    \n\nEmulation Workflow per Emulation Scenario:\n\n<table><tbody><tr><td>Emulation Scenario</td><td>Emulation Workflow</td></tr><tr><td><p>When sending files to<br>the Check Point ThreatCloud</p></td><td><ol><li><p>Customer's Security Gateway detects that a file was received from the Internet or an external network.</p></li><li><p>The Security Gateway compares the cryptographic hash of the file with the database.</p><ul><li>If the file is already in the database, no additional emulation is necessary</li><li>If the file is not in the database, it is necessary to send it to the ThreatCloud</li></ul></li><li><p>Customer's Security Gateway encrypts the file and sends (over an SSL connection) to the ThreatCloud.</p></li><li><p>Frontend servers at the ThreatCloud Pod perform Support Contract verification against Check Point User Center.</p><p>Each Security Gateway has its own UUID (identifier), which is used to identify the Security Gateway in ThreatCloud (this UUID is derived from the MAC Address of the Mgmt interface).</p></li><li><p>ThreatCloud Pod transfers the file (over an SSL connection) to a Check Point Emulator located on a dedicated protected Check Point site.</p></li><li><p>Check Point Emulators decrypts the file and runs emulation on the file.</p></li><li><p>Check Point Emulator sends a report (over an SSL connection) to a ThreatCloud Pod, which saves it in the shared database.</p></li><li><p>ThreatCloud Pod sends a report (over an SSL connection) to the customer's Security Gateway for the applicable action.</p></li></ol><p>Geo Restriction:</p><ul><li><p>Geo DNS is used to refer the Security Gateway to the closest ThreatCloud Pod:<br>Security Gateway queries the DNS \"SRV\" record of the <code>te.checkpoint.com</code> to find the available ThreatCloud Pod:</p><ul><li><code>te-eu.checkpoint.com</code> - located in Europe</li><li><code>te-na.checkpoint.com</code> - located in USA</li><li><code>te.checkpoint.com.cn</code> - located in China</li><li><code>te-ap.iaas.checkpoint.com</code> - located in Australia</li><li><code>te-uk.iaas.checkpoint.com</code> - located in United Kingdom</li><li><code>te-in.iaas.checkpoint.com</code> - located in India</li><li><code>te-ca.iaas.checkpoint.com</code> - located in Canada</li><li><code>te-em.iaas.checkpoint.com</code> - located in UAE</li></ul></li><li><p>Priority of locations depends on the Geo location of the DNS server performing the recursive lookup.</p></li><li><p>Using an upstream DNS forwarder located in a different region can result in using an emulation centre in the \"wrong\" region.</p></li><li><p>When in doubt, run the following command:<br><code>nslookup -query=SRV te-eu.checkpoint.com</code></p></li><li><p>In some cases, due to regulations, it might be necessary to use a ThreatCloud Pod in specific region.</p><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk97877\" target=\"_blank\" rel=\"noopener\">sk97877 - Cloud Geo Restriction support in Threat Emulation Cloud mode</a>.</p><ol type=\"A\"><li><p>By default, all the sites are allowed:</p><p><strong><code>[Expert@HostName:0]# tecli advanced cloud geo status</code></strong></p><pre>|Country        |State\n----------------|----------\n|Australia      |allowed\n|China          |allowed\n|Europe         |allowed\n|India          |allowed\n|UK             |allowed\n|USA            |allowed\n|Canada         |allowed\n|UAE            |allowed\n</pre></li><li><p>To restrict the use of a ThreatCloud Pod to the specific region only:</p><p>Note: Either all, or only one location can be selected.</p><p><strong><code>[Expert@HostName:0]# tecli advanced cloud geo restrict &lt;Germany|Israel|USA&gt;</code></strong></p><em>Example - use ThreatCloud Pod only in the USA</em>:<br><pre>[Expert@HostName:0]# tecli advanced cloud geo restrict USA\nCloud Geo Restriction will be enforced for USA location.\n|Australia      |forbidden\n|China          |forbidden\n|Europe         |forbidden\n|India          |forbidden\n|UK             |forbidden\n|USA            |allowed\n|Canada         |forbidden\n|UAE            |forbidden\n</pre>Note: This configuration is saved in the <code>$FWDIR/conf/te_cloud_geo_restrict.conf</code> file.</li><li><p>Restart the TED daemon to reload the modified settings:</p><strong><code>[Expert@HostName:0]# fw kill ted</code></strong></li></ol></li></ul></td></tr><tr><td><p>When emulating files on<br>the Local Threat Emulation<br>Appliance installed<br>on your network</p></td><td><ol><li><p>The Local Emulation appliance receives the files for emulation.</p></li><li><p>The Local Emulation appliance compares the cryptographic hash of the file with the database.</p><ul><li>The file is already in the database, no more emulation is necessary.</li><li>If the file is not in the database, the virtual computers in the Emulation appliance run full emulation on the file.</li></ul></li><li><p>The file is inspected in Threat Emulation engine, including static analysis, resource checking on the appliance to see that the appliance can accommodate the scanning, checking the metadata of the file for intelligence and then emulating the file in the sandbox environment.</p><p>The file is emulated according to policy on the relevant OS. During the emulation, there are behaviour indicators that allow Threat Emulation to determine whether the file is malicious or benign. When the investigation ends, a verdict is returned to sending Security Gateway.</p></li></ol></td></tr><tr><td><p>When sending files to<br>a Remote Threat Emulation<br>Private Cloud Appliance<br>installed on your network</p></td><td><ol><li><p>The Remote Emulation appliance receives the files for emulation.</p></li><li><p>The Remote Emulation appliance compares the cryptographic hash of the file with the database.</p><ul><li>The file is already in the database, no more emulation is necessary.</li><li>If the file is not in the database, the virtual computers in the Emulation appliance run full emulation on the file.</li></ul></li><li><p>The file is inspected in Threat Emulation engine, including static analysis, resource checking on the appliance to see that the appliance can accommodate the scanning, checking the metadata of the file for intelligence and then emulating the file in the sandbox environment.</p><p>The file is emulated according to policy on the relevant OS. During the emulation, there are behaviour indicators that allow Threat Emulation to determine whether the file is malicious or benign. When the investigation ends, a verdict is returned to sending Security Gateway.</p></li></ol></td></tr></tbody></table>\n\nIn MTA mode, a PostFix server is receiving and handling the e-mails. E-mails are forwarded to the _in.emaild.mta_ daemon, which parses the e-mails (e.g., Base64 decode), and passes them to TED process if needed (based on the configuration of supported file types).\n\n### (8) Emulation Connection Handling Mode\n\nWhile Threat Emulation processes the file,  \nit can apply the following handling modes: Rapid Delivery, Maximum Prevention, and Custom. \n\n1.  In SmartConsole, go to **Security Policies** > **Threat Prevention** > **Custom Policy**.  \n2.  Right-click the profile in the **Action** column,   and click **Edit**.\n3.  In the profile editor, go to **Threat Emulation** > **Advanced**. \n4.  Go to **Emulation Connection Handling Mode**. \n\n<table><tbody><tr><td>Handling Mode</td><td>Description</td></tr><tr><td>Rapid Delivery</td><td><p>This is mode is configured by default.</p><p>The connection over HTTP / SMTP is allowed and the file is sent to the destination even if the Threat Emulation analysis is not finished.</p><p>Note: If the \"<code>Prevent</code>\" action is used in the Threat Prevention policy, then a file that Threat Emulation has already identified as malware in the past, is <em>blocked</em>. File is not sent to the destination even in the \"<code>Rapid Delivery</code>\" mode.</p><p>It is important to monitor the \"<code>Detect</code>\" events to catch the first downloads that probably caused the user's machine to get infected (not automatically notified!)</p></td></tr><tr><td>Maximum Prevention</td><td><p>A connection over HTTP / SMTP that must have emulation is blocked and Threat Emulation holds the file until the Threat Emulation analysis is finished .</p><p>For configurations that use the \"<code>Maximum Prevention</code>\" mode for SMTP traffic, to decrease the delay in receiving the e-mails, it is recommended to use a Mail Transfer Agent (MTA) deployment, which also supports SMTP/TLS.</p><p>Note: This mode can create a time-delay for users to receive e-mails and files.</p></td></tr><tr><td>Custom</td><td>Allows configuration of \"<code>Rapid Delivery</code>\" and \"<code>Maximum Prevention</code>\" modes independently for HTTP and SMTP protocols.</td></tr></tbody></table>\n\n### (9) User Space\n\n<table><tbody><tr><td>Daemon</td><td>Section</td><td>Description / Paths / Notes / Stop and Start Commands / Debug</td></tr><tr><td rowspan=\"8\"><p>ted</p></td><td>Description</td><td><p>Threat Emulation daemon engine - responsible for emulating files and communication with the cloud.</p><ul><li>Receives the complete file and processes it through file type checks to understand if emulation is needed (due to advanced features)</li><li>Checks Threat Emulation local cache if the file was already emulated</li><li>Checks system resources (CPU / RAM) to create an emulation queue if needed</li><li>Executes emulation according to policy settings</li><li>Collects forensic details from the VM activity agent</li><li>Collects statistics of the emulation environment</li><li>Local logging/reporting and shares data with ThreatCloud</li></ul></td></tr><tr><td>Path</td><td><em>$FWDIR/teCurrentPack/temain</em></td></tr><tr><td>Log file</td><td><em>$FWDIR/log/ted.elg</em><br><em>$FWDIR/log/te_file_downloader.elg</em><br><em>$FWDIR/log/te_engine_log_file.elg</em><br><em>$FWDIR/log/te_image_prep_util.elg</em></td></tr><tr><td>Configuration file</td><td><em>$FWDIR/conf/cloud_connector.conf</em></td></tr><tr><td>To Restart</td><td><em>[Expert@HostName:0]# fw kill ted</em></td></tr><tr><td>To Stop</td><td><em>[Expert@HostName:0]# cpstop</em></td></tr><tr><td>To Start</td><td><em>[Expert@HostName:0]# cpstart</em></td></tr><tr><td>Debug</td><td>\"<em>tecli debug</em>\" - refer to the \"<span targetid=\"tecli\">(10) The <em>tecli</em> command (Threat Emulation Command Line Tool)</span>\" section and to the Threat Prevention Administration Guide.</td></tr><tr><td rowspan=\"7\"><p>dlpu</p></td><td>Description</td><td>DLP process - receives data from Check Point kernel.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/dlpu</em></td></tr><tr><td>Log file</td><td><em>$FWDIR/log/dlpu.elg</em></td></tr><tr><td>Notes</td><td>\"<em>cpwd_admin list</em>\" command shows the process as \"<em>DLPU_&lt;N&gt;</em>\".</td></tr><tr><td>To Stop</td><td><em>[Expert@HostName:0]# cpstop</em></td></tr><tr><td>To Start</td><td><em>[Expert@HostName:0]# cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk73660\" target=\"_blank\" rel=\"noopener\">sk73660</a>:</p><ol><li>Start debug:<br><em>fw debug dlpu on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug dlpu off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/dlpu.elg*</em></li></ol></td></tr><tr><td rowspan=\"9\"><p>usrchkd</p></td><td>Description</td><td>Main UserCheck daemon, which deals with UserCheck requests (from CLI / from the user) that are sent from the UserCheck Web Portal.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchkd</em></td></tr><tr><td>Log file</td><td><em>$FWDIR/log/usrchkd.elg</em></td></tr><tr><td>Configuration file</td><td><ul><li><em>$FWDIR/conf/usrchkd.conf</em></li><li><em>$FWDIR/orig/UCPortal/fwdir_conf/usrchkd.conf</em></li><li><em>$FWDIR/conf/fwauthd.conf</em></li></ul></td></tr><tr><td>Notes</td><td><ul><li>This daemon is not monitored by Check Point WatchDog (\"<em>cpwd_admin list</em>\")</li><li>This daemon is spawned by the FWD daemon</li></ul></td></tr><tr><td>To Restart</td><td><em>[Expert@HostName:0]# killall usrchkd</em></td></tr><tr><td>To Stop</td><td><em>[Expert@HostName:0]# cpstop</em></td></tr><tr><td>To Start</td><td><em>[Expert@HostName:0]# cpstart</em></td></tr><tr><td>Debug</td><td><p>Note: It might also be required to collect the relevant kernel debug.</p><ol><li>Start debug:<br><em>usrchk debug set all all</em></li><li>Verify:<br><em>usrchk debug stat</em></li><li>Replicate the issue.</li><li>Stop debug:<br><em>usrchk debug off</em></li><li>Analyze:<br><em>$FWDIR/log/usrchkd.elg*</em></li></ol></td></tr><tr><td rowspan=\"3\"><p>usrchk</p></td><td>Description</td><td>The CLI client for the UserCheck daemon USRCHKD (this process runs only when it is called explicitly).</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/usrchk</em></td></tr><tr><td>Log file</td><td><em>$FWDIR/log/usrchk.elg</em></td></tr><tr><td rowspan=\"6\"><p>in.emaild.mta</p></td><td>Description</td><td>When enabling the Mail Transfer Agent (MTA) on the Security Gateway, this E-Mail Security Server receives e-mails sent by user and sends them to their destinations.</td></tr><tr><td>Path</td><td><em>$FWDIR/bin/fwssd</em></td></tr><tr><td>Log file</td><td><em>$FWDIR/log/emaild.mta.elg</em><br><em>/var/log/maillog</em></td></tr><tr><td>To Stop</td><td><em>[Expert@HostName:0]# cpstop</em></td></tr><tr><td>To Start</td><td><em>[Expert@HostName:0]# cpstart</em></td></tr><tr><td>Debug</td><td><p>Refer to <a href=\"https://support.checkpoint.com/results/sk/sk60387\" target=\"_blank\" rel=\"noopener\">sk60387</a>:</p><ol><li>Start debug:<br><em>fw debug in.emaild.mta on TDERROR_ALL_ALL=5</em></li><li>Replicate the issue</li><li>Stop debug:<br><em>fw debug in.emaild.mta off TDERROR_ALL_ALL=0</em></li><li>Analyze:<br><em>$FWDIR/log/emaild.mta.elg*</em></li></ol></td></tr></tbody></table>\n\n### (10) The _tecli_ command (Threat Emulation Command Line Tool)\n\n**Important Notes:**\n\n-   The commands listed below are for _general reference only_.\n-   These commands are updated from time to time (via Engine Update).  \n    Therefore, the commands on your Security Gateway might not match the commands documented below.  \n    Run the _tecli_ command to see the commands that exist in your version of Threat Emulation Engine.\n-   Some commands are intended only for Check Point internal use.\n\nUse the _tecli_ commands to:\n\n-   Show information about the Threat Emulation system\n-   Show status of emulation downloads, statistics and processes\n-   Control Threat Emulation local cache\n-   Set Threat Emulation advanced options\n-   Configure affinity for TED (Threat Emulation Daemon)\n\nSyntax:\n\n**`[Expert@HostName:0]# tecli [show ...] [control ...] [set ...] [advanced ...] [cache ...] [debug ...]`**\n\nNotes:\n\n-   The _tecli_ command does not support the \\[Tab\\] key.\n-   Shortened unique sub-commands can be used (e.g., \"`tecli s s`\" for \"`tecli show statistics`\").\n\nWhere:\n\n-   **`tecli show ...`** commands\n    \n    These commands display information about the threat emulation system.\n    \n    The available sub-commands are (for engine version 54.990001309):\n    \n    `tecli show emulator ...` = displays information about the emulator  \n      `tecli show emulator emulations` = information about the current status of the emulation queue (pending emulating requests, running virtual machines, number of emulated files)  \n      `tecli show emulator queue` = information about emulator's queue  \n      `tecli show emulator vm ...` = information about the VMs  \n        `tecli show emulator vm synopsis` = summary of the VMs (pending emulating requests, average request wait time, running emulation vms)  \n        `tecli show emulator vm detailed` = detailed information about the VMs  \n        `tecli show emulator vm id <ID>` = detailed information for the VM with this ID\n    \n    `tecli show throughput ...` = displays Threat Emulation current throughput  \n      `tecli show throughput minute` = how many files completed emulation for each minute  \n      `tecli show throughput hour` = how many files completed emulation for each hour  \n      `tecli show throughput day` = how many files completed emulation for each day  \n      `tecli show throughput month` = how many files completed emulation for each month\n    \n    `tecli show statistics` = displays Threat Emulation current statistics (threat emulation engine version, scanned files, resend files, malicious files, average process time, etc.)\n    \n    `tecli show unit ...` = displays information on the threat emulation system units - all the parts of file emulation  \n      `tecli show unit all` = the chain of units that process a file emulation (shows the number of files for each task in the emulation part)\n    \n    `tecli show downloads ...` = displays statistics about downloads  \n      `tecli show downloads all` = status of all downloads  \n      `tecli show downloads images` = download status of operating system images for VMs  \n      `tecli show downloads dr` = download status of malware detection rules (white lists for documents, etc.)  \n      `tecli show downloads sa` = download status of static analysis rules (pre-processing Python rules for PDF and Office documents)  \n      `tecli show downloads raw` = download status of general (raw) Threat Emulation files (engine binary updates)  \n      `tecli show downloads types` = mapping of detected file types to real extension used in Windows OS  \n      `tecli show downloads ea` = download status of analyzer executables  \n      `tecli show downloads java` = download status of Java  \n      `tecli show downloads gu` = shows gradual update group id  \n      `tecli show downloads dump` = shows dump of statuses of downloads files  \n      `tecli show downloads fakefiles` = shows status of fake server files  \n      `tecli show downloads scanengine` = shows status of scan engine package files\n    \n    `tecli show cloud ...` = displays data and statistics about your ThreatCloud account  \n      `tecli show cloud identity` = data about how this gateway connects to the ThreatCloud  \n      `tecli show cloud quota` = data about your ThreatCloud monthly emulation quota  \n      `tecli show cloud queue` = information about ThreatCloud emulation queue\n    \n    `tecli show affinity` = displays current Threat Emulation CPU affinity (number of CoreXL FW instances and of CPU cores for TED / TEMAIN daemon)\n    \n    `tecli show remote ...` = displays information about emulation on Remote Threat Emulation appliance  \n      `tecli show remote queue` = information about emulation queue on Remote Threat Emulation appliance\n    \n    Note: The \"`tecli show ...`\" commands display various statuses of Virtual Machines:\n    \n    <table><tbody><tr><td>Status</td><td>Explanation</td></tr><tr><td><code>Uninitialized</code></td><td>VM was allocated</td></tr><tr><td><code>Creation In Process</code></td><td>VM is being created (uploading signature files)</td></tr><tr><td><code>Initialized</code></td><td>VM was initialized</td></tr><tr><td><code>Configured</code></td><td>VM was configured</td></tr><tr><td><code>Ready for Emulation</code></td><td>VM is ready to emulate a file</td></tr><tr><td><code>Asked for Execution</code></td><td>VM was asked to execute a file</td></tr><tr><td><code>Emulating</code></td><td>VM is currently emulating a file</td></tr><tr><td><code>Emulating + Locked</code></td><td>VM is locked with a reason</td></tr><tr><td><code>Emulating + Digesting</code></td><td>File is being uploaded to the VM</td></tr><tr><td><code>Emulating + Ready</code></td><td>VM is ready to receive files</td></tr><tr><td><code>Done</code></td><td>Emulation is done</td></tr><tr><td><code>Terminating</code></td><td>Emulation stopped without any errors</td></tr><tr><td><code>Terminating with Error</code></td><td>Emulation stopped with errors</td></tr></tbody></table>\n    \n-   **`tecli control ...`** commands\n    \n    These commands control the state of threat emulation system.\n    \n    The available sub-commands are (for engine version 54.990001309):\n    \n    `tecli control suspend` = suspends threat emulation system  \n    `tecli control resume` = resumes threat emulation system  \n    `tecli control status` = retrieves status of threat emulation system  \n    `tecli control sizing ...` = modifies sizing mode - see [sk93598](https://support.checkpoint.com/results/sk/sk93598) for more details  \n    `tecli control sizing status` = displays the current status of the sizing mode  \n    `tecli control sizing enable` = enables the sizing mode  \n    `tecli control sizing disable` = disables the sizing mode\n    \n-   **`tecli set ...`** commands\n    \n    These commands set parameters of threat emulation system.\n    \n    The available sub-commands are (for engine version 54.990001309):\n    \n    `tecli set affinity ...` = sets Threat Emulation CPU affinity  \n      `tecli set affinity <number_of_CoreXL_FW_instances> <number_of_CPUs_for_TED_daemon>`  \n      `tecli set affinity <number_of_CoreXL_FW_instances> <number_of_CPUs_for_TEMAIN_daemon>`\n    \n    Related solution - [sk109818](https://support.checkpoint.com/results/sk/sk109818).\n-   **`tecli advanced ...`** commands\n    \n    These commands controls advanced parameters.\n    \n    The available sub-commands are (for engine version 54.990001309):\n    \n    `tecli advanced analyzer ...` = Threat Emulation File Analyzer in R77.30 and above (refer to [sk112312](https://support.checkpoint.com/results/sk/sk112312))  \n      `tecli advanced analyzer show` = displays analyzer state and configured values of its attributes  \n      `tecli advanced analyzer enable <1|0>` = enables (1) or disables (0) analyzer investigator  \n      `tecli advanced analyzer max_embedded_files_limit <value>` = sets maximal limit for number of embedded files  \n      `tecli advanced analyzer max_embedded_links_limit <value>` = sets maximal limit for number of embedded links  \n      `tecli advanced analyzer prohibited` = prohibited objects menu  \n        `tecli advanced analyzer prohibited encrypted` = blocks encrypted documents - **Deprecated**, use `tecli advanced error show` and relate to `doc_pass_protected` instead.  \n        `tecli advanced analyzer prohibited sensitive` = blocks documents that contain sensitive links (links to local or network path)  \n        `tecli advanced analyzer prohibited macro` = blocks documents that contain macros and code  \n        `tecli advanced analyzer prohibited word` = blocks documents with embedded MS Word file type  \n        `tecli advanced analyzer prohibited excel` = blocks documents with embedded MS Excel file type  \n        `tecli advanced analyzer prohibited power_point` = blocks documents with embedded MS Power Point file type  \n        `tecli advanced analyzer prohibited executable` = blocks documents with embedded executable file type  \n        `tecli advanced analyzer prohibited zip_em` = blocks documents with embedded ZIP file type  \n        `tecli advanced analyzer prohibited flash` = blocks documents with embedded Flash file type  \n        `tecli advanced analyzer prohibited pdf` = blocks documents with embedded PDF file type  \n        `tecli advanced analyzer prohibited js` = blocks documents with embedded JavaScript file type  \n        `tecli advanced analyzer prohibited unsafe_docs`\\= block documents with potentially unsafe content ( such as documents contains macros, database queries, etc.)  \n        `tecli advanced analyzer prohibited all_types`\\= block documents with any embedded files\n    \n    `tecli advanced clear` = resets the Threat Emulation statistics\n    \n    `tecli advanced engine ...` = Threat Emulation Engine Update actions  \n      `tecli advanced engine version` = displays the engine version  \n      `tecli advanced engine revert` = reverts to the original (out of the box) version  \n      `tecli advanced engine retry` = retries the engine update\n    \n    `tecli advanced schema ...` = displays schema attributes  \n      `tecli advanced schema all` = displays all schema attributes  \n      `tecli advanced schema general` = displays schema general attributes  \n      `tecli advanced schema emulation` = displays schema emulation attributes  \n      `tecli advanced schema cloud` = displays cloud emulation attributes  \n      `tecli advanced schema profiles` = displays profiles emulation attributes\n    \n    `tecli advanced downloads ...` = downloads actions  \n      `tecli advanced downloads update ...` = initiates Threat Emulation engine update  \n        `tecli advanced downloads update all` = Threat Emulation engine update of all components  \n        `tecli advanced downloads update images` = Threat Emulation update of images  \n        `tecli advanced downloads update rules` = Threat Emulation engine update of malware detection and static analysis rules ([sk117672](https://support.checkpoint.com/results/sk/sk117672))  \n        `tecli advanced downloads update file types map` = mapping of file types to real extension used in Windows OS  \n        `tecli advanced downloads update raw` = Threat Emulation engine update of raw files (engine binary updates)\n    \n    `tecli advanced forensics ...` = Threat Emulation forensics data actions  \n      `tecli advanced forensics clean <UID>` = cleans the forensics data of a given UID  \n      `tecli advanced forensics limit stat` = prints the status of forensics limit activities  \n      `tecli advanced forensics limit set <1|0>` = enables (1) / disables (0) the forensics limit activities mode\n    \n    `tecli advanced archive extract ...` = controls file types that are extracted from archive files (e.g., refer to [sk108373](https://support.checkpoint.com/results/sk/sk108373))  \n      `tecli advanced archive extract all ...` = displays the current status and enables / disables extraction of all file types from archive files  \n        `tecli advanced archive extract all stat` = displays the current status (enabled / disabled) of extraction of all file types from archive files  \n        `tecli advanced archive extract all enable` = enables extraction of all file types from archive files  \n        `tecli advanced archive extract all disable` = disables extraction of all file types from archive files \n    \n    `tecli advanced instrumentation ...` = controls VM instrumentation  \n      `tecli advanced instrumentation on` = turns on instrumentation  \n      `tecli advanced instrumentation off` = turns off instrumentation\n    \n    `tecli advanced cloud ...` = controls actions with ThreatCloud  \n      `tecli advanced cloud geo ...` = cloud geo restrictions (control which ThreatCloud Pods are allowed / forbidden) - refer to [sk97877](https://support.checkpoint.com/results/sk/sk97877)  \n        `tecli advanced cloud geo status` = shows current restriction status  \n        `tecli advanced cloud geo default` = sets automatic Cloud Geographic location (all ThreatCloud Pods are allowed)  \n        `tecli advanced cloud geo restrict <Germany|Israel|USA|Canada|Australia|India|UK|UAE>` = restricts to a specific location (only that specific ThreatCloud Pod is allowed)  \n      `tecli advanced cloud request ...` = shows and sets maximal number of objects in cloud request  \n        `tecli advanced cloud request show` = shows maximal number of objects in cloud request  \n        `tecli advanced cloud request set <value>` = sets maximal number of objects in cloud request  \n      `tecli advanced cloud timeout ...` = shows and sets timeout of file processing time (hours)  \n        `tecli advanced cloud timeout show` = shows timeout of file processing time (hours)  \n        `tecli advanced cloud timeout set <value>` = sets timeout of file processing time (hours)  \n      `tecli advanced cloud connectivity ...` = displays the current status and enables / disables cloud connectivity  \n        `tecli advanced cloud connectivity stat` = displays the current ThreatCloud connectivity status  \n        `tecli advanced cloud connectivity allow` = allows the access to ThreatCloud, if needed  \n        `tecli advanced cloud connectivity deny` = denies any access to ThreatCloud ([sk109854](https://support.checkpoint.com/results/sk/sk109854))\n    \n    `tecli advanced attributes ...` = special attributes (should be changed _only_ if instructed by Check Point)  \n      `tecli advanced attributes show` = displays special attributes and their values  \n      `tecli advanced attributes set ...` = sets special attributes and their values  \n        `tecli advanced attributes set static_cloud <1|0>` = enables (1) or disables (0) static analysis on cloud server  \n        `tecli advanced attributes set trusted_source <1|0>` = enables (1) or disables (0) trusted source domains  \n        `tecli advanced attributes set reclassifier <1|0>` = enables (1) or disables (0) files reclassification (refer to \"(16) File Reclassifier\" section)  \n        `tecli advanced attributes set file_type_logs <1|0>` = enables (1) or disables (0) monitoring logs per file type  \n        `tecli advanced attributes set archive_timeout <value>` = sets archive tool timeout (in seconds)  \n        `tecli advanced attributes set archive_max_size <value>` = sets archive tool maximum inflate size (in MB)  \n        `tecli advanced attributes set prohibited_file_types <file_type1>,<file_type2>,...` = configures file types that are prohibited in archives ([sk123140](https://support.checkpoint.com/results/sk/sk123140))  \n        `tecli advanced attributes set prohibited_file_types -` = resets all file types prohibited in archives  \n        `tecli advanced attributes set wait_queue_max_size <value>` = sets the maximum size of Cloud Error Handling wait queue (default is 5000)  \n        `tecli advanced attributes set wait_queue_timeout <value>` = sets timeout (in minutes) for retrying to send a file to the ThreatCloud after an error (default is 360)  \n        `tecli advanced attributes set save_all_files <1|0>` = enables (1) or disables (0) saving all the files processed by TED  \n        `tecli advanced attributes set cloud_dns_name <hostname>` = overrides the default hostname _te.checkpoint.com_ with specified hostname (requires installation of Threat Prevention policy)  \n        `tecli advanced attributes set cloud_dns_name -` = restores the default hostname _te.checkpoint.com_ (requires installation of Threat Prevention policy)  \n        `tecli advanced attributes set emulation_upload_chunk_size <value>` = configures emulation upload chunk size  \n        `tecli advanced attributes set emulation_enable_upload_split <1|0>` = enables (1) or disables (0) emulation upload split  \n        `tecli advanced attributes set whitening_mode <1|0>` = enables (1) or disables (0) whitening mode  \n        `tecli advanced attributes set max_size_per_log_file <size_in_bytes>` = sets maximal size per log file (requires restart of TED daemon; default is 10 MB)  \n        `tecli advanced attributes set number_of_log_files <number>` = sets number of log files (requires restart of TED daemon; default is 10 files)  \n        `tecli advanced attributes set http_failure_until_dns_failover <value>` = sets number of HTTP failures until DNS failover (default is 3)  \n        `tecli advanced attributes set false_positive_guard_file_types <all|executables>` = sets false-positive guard file types (requires installation of Threat Prevention policy)  \n        `tecli advanced attributes set domains_threshold_enabled <1|0>` = enables (1) or disables (0) the domains threshold  \n        `tecli advanced attributes set domains_threshold_time_frame_in_minutes <value>` = sets time frame in minutes for domains threshold (requires restart of TED daemon)  \n        `tecli advanced attributes set domains_threshold_max_consuming_files_in_frame <value>` = sets maximal number of files in frame for domains threshold (requires restart of TED daemon)  \n        `tecli advanced attributes set api_log_path </path_to/>` = sets path to API logs  \n        `tecli advanced attributes set api_log_path -` = restores the path to API logs to its default _/var/log/huntress\\_api\\_logs_  \n        `tecli advanced attributes set db_purge_interval <value>` = sets interval (in minutes) for purging the database  \n        `tecli advanced attributes set db_purge_max_records <value>` = sets maximal number of purged records  \n        `tecli advanced attributes set calc_sha256 <1|0>` = enables (1) or disables (0) calculation of SHA256 hash for files  \n        `tecli advanced attributes set disable_monitoring <1|0>` = enables (1) or disables (0) VM documents monitoring - effective only if prior to this command, you ran the \"`tecli advanced instrumentation off ; tecli advanced download reinitialize`\" commands  \n        `tecli advanced attributes set monitored_events_limit <value>` = sets limit for number of monitored events  \n        `tecli advanced attributes set memory_dump <1|0>` = enables (1) or disables (0) memory dump (requires restart of TED daemon)  \n        `tecli advanced attributes set pcap_enable <1|0>` = enables (1) or disables (0) traffic capture from logs (will save only when report is created)  \n        `tecli advanced attributes set pcap_number_of_packets <value>` = sets number of packets to be captured from logs  \n        `tecli advanced attributes set enable_cpu_level_detection <1|0>` = enables (1) or disables (0) CPU-Level Detection (refer to [sk107333](https://support.checkpoint.com/results/sk/sk107333))  \n        `tecli advanced attributes set screen_dumps <1|0>` = enables (1) or disables (0) the Screen Dumps  \n        `tecli advanced attributes set emulation_mode <legacy|experimental|aggressive|balanced>` = sets the Emulation Mode  \n        `tecli advanced attributes set appready_verify <1|0>` = enables (1) or disables (0) App-Ready Verification  \n        `tecli advanced attributes set appready_optimization <1|0>` = enables (1) or disables (0) App-Ready Optimization  \n        `tecli advanced attributes set wem_verify <1|0>` = enables (1) or disables (0) the Web Emulation (WEM) images verification  \n        `tecli advanced attributes set sha1_collision_attack_detection <1|0>` = enables (1) or disables (0) the SHA-1 Collision Attack detection ([sk116141](https://support.checkpoint.com/results/sk/sk116141))  \n        `tecli advanced attributes set max_vm <number>` = sets the maximal number of concurrently running VMs  \n        `tecli advanced attributes set max_create <value>` = sets the maximal number of VMs that can be created concurrently  \n        `tecli advanced attributes set disable_ted_pnote <1|0>` = enables (1) or disables (0) notifications from the Critical Device \"ted\" in ClusterXL ([sk107542](https://support.checkpoint.com/results/sk/sk107542))  \n        `tecli advanced attributes set fake_html_response_timeout <value>` = sets timeout (in seconds) for fake HTML response  \n        `tecli advanced attributes set max_scratch_file_size <value>` = sets maximal size (in MB) for scratch file  \n        `tecli advanced attributes set classifier_second_emulation <1|0>` = enables (1) or disables (0) second emulation after re-classification  \n        `tecli advanced attributes set icon_similarity_status <1|0>` = enables (1) or disables (0) icon similarity status  \n        `tecli advanced attributes set enable_hps_retry <1|0>` = enables (1) or disables (0) HPS retry  \n        `tecli advanced attributes set tc_advisory_num_consumers <value>` = sets TC advisory number of consumers  \n        `tecli advanced attributes set file_uploader_num_consumers <value>` = sets file uploader number of consumers  \n        `tecli advanced attributes set static_macro_analyzer_status <1|0>` = enables (1) or disables (0) Static Macro Analyzer  \n        `tecli advanced attributes set reports_version_number <1|2>` = sets the reports version number - default (1) or new reports (2) - refer to [sk120357](https://support.checkpoint.com/results/sk/sk120357)\n    \n    `tecli advanced remote ...` = configures the Security Gateway to use multiple remote Threat Emulation Private Cloud Appliances ([sk102309](https://support.checkpoint.com/results/sk/sk102309))  \n      `tecli advanced remote show` = shows the list of configured remote Threat Emulation Private Cloud Appliances  \n      `tecli advanced remote activate` = activates the support for multiple remote Threat Emulation Private Cloud Appliances  \n      `tecli advanced remote deactivate` = deactivates (default) the support for multiple remote Threat Emulation Private Cloud Appliances  \n      `tecli advanced remote add <IP Address of Appliance>` = adds the specified remote Threat Emulation Private Cloud Appliance  \n      `tecli advanced remote remove <Appliance ID>` = removes the specified remote Threat Emulation Private Cloud Appliance  \n      `tecli advanced remote add_ssl` = adds new Private Cloud Appliance for emulation using SSL  \n      `tecli advanced remote emulator ...` = controls actions with remote Threat Emulation Private Cloud Appliance  \n        `tecli advanced remote emulator logs ...` = controls logs for remote Threat Emulation Private Cloud Appliance  \n          `tecli advanced remote emulator logs status` = shows logs status for remote emulator  \n          `tecli advanced remote emulator logs enable` = enables logs for remote emulator  \n          `tecli advanced remote emulator logs disable` = disables (default) logs for remote emulator\n    \n    `tecli advanced persistency ...` = configures persistency mode  \n      `tecli advanced persistency queue_size` = shows persistency queue size  \n      `tecli advanced persistency show` = shows current configured values  \n      `tecli advanced persistency default` = resets persistency parameters to default  \n      `tecli advanced persistency set ...` = sets persistency configuration  \n        `tecli advanced persistency set enable <1|0>` = enables (1; default) or disables (0) persistency mode feature  \n        `tecli advanced persistency set inject_interval <value>` = sets interval (in seconds; default is 10) for injection of event profile to TED daemon  \n        `tecli advanced persistency set file_for_fetch <value>` = sets the number of files to fetch from the database for recovery (default is 50,000)  \n        `tecli advanced persistency set file_for_working_batch <value>` = sets the number of files of working batch from the database for recovery (default is 360)  \n        `tecli advanced persistency set max_retries <value>` = sets the number of maximum retries for recovery (default is 3)  \n        `tecli advanced persistency set retries_interval <value>` = sets the maximal number of minutes allowed for recovery retries (default is 120)  \n        `tecli advanced persistency set try_again <value>` = sets the number of minutes for trying the recovery mechanism again after a failure (default is 1440)  \n        `tecli advanced persistency set clean_period <value>` = sets the time period (in minutes) between database cleanup checks (default is 10)  \n        `tecli advanced persistency set max_keep <value>` = sets how old (in minutes) the files should be kept in the database (default is 720)  \n      `tecli advanced persistency clear` = deletes all the records from the persistency table\n    \n    `tecli advanced part_response ...` = configures the Threat Emulation Early Verdict for Prevent ([sk117168](https://support.checkpoint.com/results/sk/sk117168))  \n      `tecli advanced part_response local ...` = manages local partial response configuration  \n        `tecli advanced part_response local stat` = shows the current status of the local partial response  \n        `tecli advanced part_response local enable` = activates the local partial response  \n        `tecli advanced part_response local disable` = deactivates the local partial response  \n      `tecli advanced part_response remote ...` = manages remote partial response configuration on the sender side  \n        `tecli advanced part_response remote stat` = shows the current status of the remote partial response on the sender side  \n        `tecli advanced part_response remote enable` = activates the remote partial response on the sender side  \n        `tecli advanced part_response remote disable` = deactivates the remote partial response on the sender side  \n      `tecli advanced part_response cloud ...` = manages cloud partial response configuration on the sender side  \n        `tecli advanced part_response cloud stat` = shows the current status of the cloud partial response on the sender side  \n        `tecli advanced part_response cloud enable` = activates the cloud partial response on the sender side  \n        `tecli advanced part_response cloud disable` = deactivates the cloud partial response on the sender side\n    \n    `tecli advanced multiplier ...` = shows and sets images clock multiplier  \n      `tecli advanced multiplier show` = shows images clock multiplier  \n      `tecli advanced multiplier set <Image_UID> <value>` = sets images clock multiplier\n    \n    `tecli advanced dropped ...` = configures actions for dropped files (files created by the emulation file)  \n      `tecli advanced dropped max_files <value>` = sets maximal number of dropped files to download from QEMU  \n      `tecli advanced dropped remove_dropped <1|0>` = enables (1) or disables (0) removal of dropped files directory (requires installation of Threat Prevention policy)\n    \n    `tecli advanced url ...` = controls URL Reputation actions  \n      `tecli advanced url show` = displays URL Reputation current configuration values  \n      `tecli advanced url default` = resets URL Reputation parameters to their default values  \n      `tecli advanced url cache ...` = control URL Reputation cache  \n        `tecli advanced url cache size` = counts all the URL Reputation cache records  \n        `tecli advanced url cache clean` = deletes all the URL Reputation cache records  \n      `tecli advanced url set ...` = configures URL Reputation cache parameters  \n        `tecli advanced url set cache_purge_interval <value>` = sets the interval (in minutes, from 10 to 60) to purge the URL Reputation cache  \n        `tecli advanced url set max_request_size <value>` = sets the number (from 50 to 1000) of maximum URLs per cloud request  \n        `tecli advanced url set cloud_scan_interval <value>` = sets the interval (in seconds, from 5 to 10) to scan URLs at cloud  \n        `tecli advanced url set cloud_num_consumers <value>` = sets the number (from 3 to 10) of cloud message queue consumers (required restart of TED daemon)  \n        `tecli advanced url set cloud_request_timeout <value>` = sets the timeout (in seconds, from 60 to 300) for cloud request\n    \n    `tecli advanced urls ...` = displays information about and configures URL requests   `tecli advanced urls show` = displays information about URL requests queue, counters, URLs cache TTL, timout and concurrent requests number  \n      `tecli advanced urls concurrent_requests <value>` = sets concurrent requests limit (default is 5)  \n      `tecli advanced urls reset` = resets URLs counters  \n      `tecli advanced urls cache` = lists all the records in the URLs cache  \n      `tecli advanced urls ttl <value>` = sets TTL for URLs cache entries (default is 1440 minutes)  \n      `tecli advanced urls timeout <value>` = sets maximal time (in seconds) to wait while downloading file by link from e-mail (default is 120 seconds)\n    \n    `tecli advanced av_mode ...` = configures Anti-Virus mode parameters  \n      `tecli advanced av_mode show` = shows current configuration values  \n      `tecli advanced av_mode set status <1|0>` = enables (1) or disables (0) Anti-Virus mode (requires installation of Threat Prevention policy; might impact performance)\n    \n    `tecli advanced scanengine ...` = shows and sets scan engine options  \n      `tecli advanced scanengine show` = show scan engine configuration  \n      `tecli advanced scanengine restart` = restarts scan engine process   `tecli advanced scanengine set ...` = sets scan engine configuration  \n        `tecli advanced scanengine set debugs <1|0>` = enables (1) or disables (0) full debugs - effective after scan engine restart  \n        `tecli advanced scanengine set heuristics <shallow|medium|detail|maximum>` = sets heuristics level for scan engine - effective after scan engine restart  \n        `tecli advanced scanengine set updates <value>` = sets interval in minutes for updates (requires restart of TED daemon)  \n        `tecli advanced scanengine set suspicious_behaviour <1|0>` = treats suspicious files as clean (1) or as malicious (0) (requires restart of TED daemon)\n    \n    `tecli advanced wem ...` = manages Web Emulation  \n      `tecli advanced wem status` = show current status  \n      `tecli advanced wem show-config` = shows all configuration variables  \n      `tecli advanced wem config ...` = configures Web Emulation parameters  \n        `tecli advanced wem config enable <1|0>` = enables (1) or disables (0) Web Emulation  \n        `tecli advanced wem config domain_thrsh <true|false>` = enables (true) or disables (false) domain threshold with Web Emulation (default is 'false')  \n        `tecli advanced wem config scan_time_ms` = sets Web Emulation scan time (default is 5000 millisec)  \n        `tecli advanced wem config skip_phase1 <true|false>` = skips (true) or does not skip (0) Web Emulation Phase1 to go directly to Phase2 (default is 'false')  \n        `tecli advanced wem config strict_embedded_mode <true|false>` = enables (true) or disables (false) Web Emulation strict embedded mode (default is 'false')\n    \n    `tecli advanced vmres ...` = manages VM Resources  \n      `tecli advanced vmres show` = show running state (memory limit, memory usage, number of running VMs)  \n      `tecli advanced vmres adptive_delay_util_thrsh` = internal  \n      `tecli advanced vmres delay_factor` = internal  \n      `tecli advanced vmres ht_factor` = internal  \n      `tecli advanced vmres mhz_req_per_vm` = internal  \n      `tecli advanced vmres max_ram_util` = internal\n    \n-   **`tecli cache ...`** commands\n    \n    These commands control Threat Emulation Local Cache.\n    \n    Note: In cluster environment, the Threat Emulation local cache is _not_ synchronized between cluster members.\n    \n    The available sub-commands are (for engine version 54.990001309):\n    \n    `tecli cache enable` = enables (1) or disables (0) the Local Cache\n    \n    `tecli cache size` = displays the number of all records in Local Cache\n    \n    `tecli cache clean` = deletes all the records in the Local Cache  \n      Note: Do _not_ clear the whole cache - this will have a negative impact on performance!\n    \n    `tecli cache sha1 <sha1_string>` = shows records with specific SHA1 hash\n    \n    `tecli cache filename </path_to/file>` = shows records for specific file\n    \n    `tecli cache remove ...` = removes files from Local Cache  \n      `tecli cache remove sha1 <sha1_string>` = removes records based on a specific hash  \n      `tecli cache remove filename </path_to/file>` = removes records based on a specific file path  \n      `tecli cache remove extension <extension>` = removes records of a specific file extension  \n      `tecli cache remove benign` = removes specific benign records  \n      `tecli cache remove malicious` = removes specific malicious records\n    \n    `tecli cache dump ...` = dumps Local Cache contents  \n      `tecli cache dump all` = lists all the records  \n      `tecli cache dump benign` = lists all the benign records  \n      `tecli cache dump malicious` = lists all the malicious records  \n      `tecli cache dump archives ...` = lists all the records about archive files  \n        `tecli cache dump archives table` = lists all archive records in the Local Cache in a table format  \n        `tecli cache dump archives csv` = lists all archive records the in Local Cache in a CSV format  \n      `tecli cache dump settings ...` = controls results for Local Cache dump commands  \n        `tecli cache dump settings limited ...` = controls number of dump commands results  \n          `tecli cache dump settings limited display` = displays the status of Local Cache dump limit mode  \n          `tecli cache dump settings limited set <1|0>` = enables (1) or disables (0) the Local Cache dump limit mode  \n        `tecli cache dump settings max-records ...` = controls records limit for each dump command  \n          `tecli cache dump settings max-records display` = shows the maximal number of rows retrieved for each dump command  \n          `tecli cache dump settings max-records <value>` = sets the maximal number of rows retrieved for each dump command (default is 20)\n    \n    `tecli cache ttl ...` = controls the files' TTL in the Local Cache  \n      `tecli cache ttl display` = displays the current TTL  \n      `tecli cache ttl default` = sets the TTL to default (168 hrs, i.e., 7 days)  \n      `tecli cache ttl set <hours>` = sets the TTL to specified number of hours\n    \n-   **`tecli debug ...`** commands\n    \n    These commands controls debug parameters.\n    \n    The available sub-commands are (for engine version 54.990001309):\n    \n    `tecli debug set <TOPIC1> <SEVERITY1> <TOPIC2> <SEVERITY2> ...` = sets specific debug topic with specified severity  \n      **Note:** Currently, only the \"`tecli debug set TE all`\" command should be used.\n    \n    `tecli debug unset <TOPIC>` = unsets a specific debug topic (currently, only the \"`tecli debug defaults`\" command should be used)\n    \n    `tecli debug on` = turns on debug (first, the debug topics have to be set)\n    \n    `tecli debug off` = turns off debug\n    \n    `tecli debug reset` = resets all debug topics (currently, only the \"`tecli debug defaults`\" command should be used)\n    \n    `tecli debug defaults` = resets all debug topics to their default values\n    \n    `tecli debug stat` = shows current debug status\n    \n    `tecli debug rotate` = rotates the current TED daemon's log file `$FWDIR/log/ted.elg` (moves the current file to `$FWDIR/log/ted.elg.<N>` and opens a new one)\n    \n    `tecli debug memory` = displays the memory consumption by Threat Emulation\n    \n    `tecli debug spaces <N>` = sets number of spaces in identical logs \\[0..5\\] - indentation for each level\n    \n    `tecli debug scan ...` = connections scanning debug options  \n      `tecli debug scan local stat` = shows the status of local connections scanning  \n      `tecli debug scan local enable` = enables the scan of local connections  \n      `tecli debug scan local disable` = disables the scan of local connections\n    \n    `tecli debug clean` = cleans all TED daemon's log files (`$FWDIR/log/ted.elg`)\n    \n    `tecli debug partreq ...` = counter of partial file request (HTTP 206)  \n      `tecli debug partreq get` = gets the value of kernel parameter _g\\_ci\\_av\\_te\\_http\\_206\\_file\\_request_  \n      `tecli debug partreq set <value>` = sets the value of kernel parameter _g\\_ci\\_av\\_te\\_http\\_206\\_file\\_request_ (up to 2<sup>32</sup>\\-1)  \n      `tecli debug partreq init` = initializes the value of kernel parameter _g\\_ci\\_av\\_te\\_http\\_206\\_file\\_request_\n    \n    `tecli debug incfile ...` = counter of incomplete files  \n      `tecli debug incfile get` = gets the value of kernel parameter _g\\_ci\\_av\\_te\\_file\\_cut_  \n      `tecli debug incfile set <value>` = sets the value of kernel parameter _g\\_ci\\_av\\_te\\_file\\_cut_ (up to 2<sup>32</sup>\\-1)  \n      `tecli debug incfile init` = initializes the value of kernel parameter _g\\_ci\\_av\\_te\\_file\\_cut_\n    \n    `tecli debug sptrack` = displays the SmartPtr Bookkeeping information\n    \n    `tecli debug dep` = dumps bookkeeping of event profile\n    \n\n### (11) The _cpstat threat-emulation_ command\n\nThe _cpstat_ command displays various counters and statistical information about Check Point Software Blades.\n\nFor Threat Emulation blade, you can run either the \"**`cpstat threat-emulation -f <flag>`**\" command, or the \"**`cpstat -f <flag> threat-emulation`**\" command.\n\n-   **`cpstat threat-emulation -f default`**\n    \n    -   Displayed information:\n        \n        > Current Threat Emulation status and Engine versions:\n        > \n        > ```\n        > Status:                   &lt;N&gt;\n        > Status short description: &lt;XXXXXX&gt;\n        > Status long description:  &lt;XXXXXX&gt;\n        > Engine Major Version:     &lt;N&gt;\n        > Engine Minor Version:     &lt;N&gt;\n        > ```\n        > \n        > _Example_:\n        > \n        > > ```\n        > > Status:                   2\n        > > Status short description: error\n        > > Status long description:  Threat Emulation update failed, cannot download Raw Files. Failed running download process. \n        > > Engine Major Version:     54\n        > > Engine Minor Version:     990001309\n        > > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.29\n        > .1.3.6.1.4.1.2620.1.49.30\n        > .1.3.6.1.4.1.2620.1.49.101\n        > .1.3.6.1.4.1.2620.1.49.102\n        > .1.3.6.1.4.1.2620.1.49.103\n        > ```\n        \n-   **`cpstat threat-emulation -f contract`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation Contract and Quota:\n        > \n        > ```\n        > TE Contract Name:                          &lt;XXXXXX&gt;\n        > TE Subscription Expire Date:               &lt;XXXXXX&gt;\n        > TE Cloud Hourly Quota:                     &lt;N&gt;\n        > TE Cloud Monthly Quota:                    &lt;N&gt;\n        > TE Cloud Remaining Quota:                  &lt;N&gt;\n        > TE Maximal VMs Number:                     &lt;N&gt;\n        > TE Subscription Status:                    &lt;XXXXXX&gt;\n        > TE Cloud Quota Status:                     &lt;XXXXXX&gt;\n        > TE Subscription Description:               &lt;XXXXXX&gt;\n        > TE Cloud Quota Description:                &lt;XXXXXX&gt;\n        > TE Cloud Quota Identifier:                 &lt;XXXXXX&gt;\n        > TE Cloud Monthly Quota Period Start:       &lt;XXXXXX&gt;\n        > TE Cloud Monthly Quota Period End:         &lt;XXXXXX&gt;\n        > TE Cloud Monthly Quota Usage for This GW:  &lt;N&gt;\n        > TE Cloud Hourly Quota Usage for this GW:   &lt;N&gt;\n        > TE Cloud Monthly Quota Usage for Quota ID: &lt;N&gt;\n        > TE Cloud Hourly Quota Usage for Quota ID:  &lt;N&gt;\n        > TE Cloud Monthly Quota Exceeded:           &lt;N&gt;\n        > TE Cloud Hourly Quota Exceeded:            &lt;N&gt;\n        > TE Cloud Last Quota Update GMT Time:       &lt;XXXXXX&gt;\n        > ```\n        > \n        > _Example_:\n        > \n        > > ```\n        > > TE Contract Name:                          temu_local\n        > > TE Subscription Expire Date:               1533190420\n        > > TE Cloud Hourly Quota:                     0\n        > > TE Cloud Monthly Quota:                    0\n        > > TE Cloud Remaining Quota:                  0\n        > > TE Maximal VMs Number:                     4294967295\n        > > TE Subscription Status:                    valid\n        > > TE Cloud Quota Status:                     ok\n        > > TE Subscription Description:               Subscription is up to date\n        > > TE Cloud Quota Description:                Cloud emulation is not used\n        > > TE Cloud Quota Identifier:                 N/A\n        > > TE Cloud Monthly Quota Period Start:       0\n        > > TE Cloud Monthly Quota Period End:         0\n        > > TE Cloud Monthly Quota Usage for This GW:  0\n        > > TE Cloud Hourly Quota Usage for this GW:   0\n        > > TE Cloud Monthly Quota Usage for Quota ID: 0\n        > > TE Cloud Hourly Quota Usage for Quota ID:  0\n        > > TE Cloud Monthly Quota Exceeded:           0\n        > > TE Cloud Hourly Quota Exceeded:            0\n        > > TE Cloud Last Quota Update GMT Time:       0\n        > > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.19\n        > .1.3.6.1.4.1.2620.1.49.20\n        > .1.3.6.1.4.1.2620.1.49.21\n        > .1.3.6.1.4.1.2620.1.49.22\n        > .1.3.6.1.4.1.2620.1.49.23\n        > .1.3.6.1.4.1.2620.1.49.24\n        > .1.3.6.1.4.1.2620.1.49.25\n        > .1.3.6.1.4.1.2620.1.49.26\n        > .1.3.6.1.4.1.2620.1.49.27\n        > .1.3.6.1.4.1.2620.1.49.28\n        > .1.3.6.1.4.1.2620.1.49.31\n        > .1.3.6.1.4.1.2620.1.49.32\n        > .1.3.6.1.4.1.2620.1.49.33\n        > .1.3.6.1.4.1.2620.1.49.34\n        > .1.3.6.1.4.1.2620.1.49.35\n        > .1.3.6.1.4.1.2620.1.49.37\n        > .1.3.6.1.4.1.2620.1.49.38\n        > .1.3.6.1.4.1.2620.1.49.39\n        > .1.3.6.1.4.1.2620.1.49.40\n        > .1.3.6.1.4.1.2620.1.49.41\n        > ```\n        \n-   **`cpstat threat-emulation -f update_status`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation update status:\n        > \n        > _Example 1_:\n        > \n        > > ```\n        > > TE Update Status:      up-to-date\n        > > TE Update Description: Initializing\n        > > ```\n        > \n        > _Example 2_:\n        > \n        > > ```\n        > > TE Update Status:      downloading\n        > > TE Update Description: Download started at Sun Sep  3 16:35:57 2017\n        > > ```\n        > \n        > _Example 3_:\n        > \n        > > ```\n        > > TE Update Status:      failed\n        > > TE Update Description: Threat Emulation update failed, cannot download Raw Files. Failed running download process.\n        > > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.16\n        > .1.3.6.1.4.1.2620.1.49.17\n        > ```\n        \n-   **`cpstat threat-emulation -f general_statuses`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation general counters:\n        > \n        > ```\n        > TE Email Scanned:                    &lt;N&gt;\n        > TE Downloaded Files Scanned:         &lt;N&gt;\n        > TE Files In Queue:                   &lt;N&gt;\n        > TE Number Of Emulation Environments: &lt;N&gt;\n        > TE Is First Download:                &lt;N&gt;\n        > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.12\n        > .1.3.6.1.4.1.2620.1.49.13\n        > .1.3.6.1.4.1.2620.1.49.14\n        > .1.3.6.1.4.1.2620.1.49.15\n        > .1.3.6.1.4.1.2620.1.49.36\n        > ```\n        \n-   **`cpstat threat-emulation -f malware_detected`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters of detected malware on this appliance:\n        > \n        > ```\n        > TE Malware Detected:            &lt;N&gt;\n        > TE Malware Detected Last Day:   &lt;N&gt;\n        > TE Malware Detected Last Week:  &lt;N&gt;\n        > TE Malware Detected Last Month: &lt;N&gt;\n        > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.5.1\n        > .1.3.6.1.4.1.2620.1.49.5.2\n        > .1.3.6.1.4.1.2620.1.49.5.3\n        > .1.3.6.1.4.1.2620.1.49.5.4\n        > ```\n        \n-   **`cpstat threat-emulation -f malware_on_cloud`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters of detected malware on ThreatCloud:\n        > \n        > ```\n        > TE Malware Detected On Threat Cloud:            &lt;N&gt;\n        > TE Malware Detected On Threat Cloud Last Day:   &lt;N&gt;\n        > TE Malware Detected On Threat Cloud Last Week:  &lt;N&gt;\n        > TE Malware Detected On Threat Cloud Last Month: &lt;N&gt;\n        > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.7.1\n        > .1.3.6.1.4.1.2620.1.49.7.2\n        > .1.3.6.1.4.1.2620.1.49.7.3\n        > .1.3.6.1.4.1.2620.1.49.7.4\n        > ```\n        \n-   **`cpstat threat-emulation -f queue_size`**\n    \n    -   Displayed information:\n        \n        Threat Emulation counters for queue size:\n        \n        ```\n        TE Queue Size:            &lt;N&gt;\n        TE Queue Size Last Day:   &lt;N&gt;\n        TE Queue Size Last Week:  &lt;N&gt;\n        TE Queue Size Last Month: &lt;N&gt;\n        ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.10.1\n        > .1.3.6.1.4.1.2620.1.49.10.2\n        > .1.3.6.1.4.1.2620.1.49.10.3\n        > .1.3.6.1.4.1.2620.1.49.10.4\n        > ```\n        \n-   **`cpstat threat-emulation -f queue_table`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation queue:\n        > \n        > ```\n        > Threat-Emulation Queue Files Table\n        > -----------------------------------------------------------------\n        > |File Name|Time In Queue|Analyzed On|Image|File Size|File Source|\n        > -----------------------------------------------------------------\n        > ... ...\n        > -----------------------------------------------------------------\n        > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.1.1.1.2\n        > .1.3.6.1.4.1.2620.1.49.1.1.1.3\n        > .1.3.6.1.4.1.2620.1.49.1.1.1.4\n        > .1.3.6.1.4.1.2620.1.49.1.1.1.5\n        > .1.3.6.1.4.1.2620.1.49.1.1.1.6\n        > .1.3.6.1.4.1.2620.1.49.1.1.1.7\n        > ```\n        \n-   **`cpstat threat-emulation -f scanned_files`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters of scanned files on this appliance:\n        > \n        > ```\n        > TE Scanned Files:            &lt;N&gt;\n        > TE Scanned Files Last Day:   &lt;N&gt;\n        > TE Scanned Files Last Week:  &lt;N&gt;\n        > TE Scanned Files Last Month: &lt;N&gt;\n        > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.4.1\n        > .1.3.6.1.4.1.2620.1.49.4.2\n        > .1.3.6.1.4.1.2620.1.49.4.3\n        > .1.3.6.1.4.1.2620.1.49.4.4\n        > ```\n        \n-   **`cpstat threat-emulation -f scanned_on_cloud`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters of scanned files on ThreatCloud:\n        > \n        > ```\n        > TE Scanned Files On Threat Cloud:            &lt;N&gt;\n        > TE Scanned Files On Threat Cloud Last Day:   &lt;N&gt;\n        > TE Scanned Files On Threat Cloud Last Week:  &lt;N&gt;\n        > TE Scanned Files On Threat Cloud Last Month: &lt;N&gt;\n        > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.6.1\n        > .1.3.6.1.4.1.2620.1.49.6.2\n        > .1.3.6.1.4.1.2620.1.49.6.3\n        > .1.3.6.1.4.1.2620.1.49.6.4\n        > ```\n        \n-   **`cpstat threat-emulation -f peak_size`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters for peak size of the queue:\n        > \n        > ```\n        > TE Peak Size:            &lt;N&gt;\n        > TE Peak Size Last Day:   &lt;N&gt;\n        > TE Peak Size Last Week:  &lt;N&gt;\n        > TE Peak Size Last Month: &lt;N&gt;\n        > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.11.1\n        > .1.3.6.1.4.1.2620.1.49.11.2\n        > .1.3.6.1.4.1.2620.1.49.11.3\n        > .1.3.6.1.4.1.2620.1.49.11.4\n        > ```\n        \n-   **`cpstat threat-emulation -f average_process_time`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters for average emulation time:\n        > \n        > ```\n        > TE Average Process Time:            &lt;N&gt;\n        > TE Average Process Time Last Day:   &lt;N&gt;\n        > TE Average Process Time Last Week:  &lt;N&gt;\n        > TE Average Process Time Last Month: &lt;N&gt;\n        > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.8.1\n        > .1.3.6.1.4.1.2620.1.49.8.2\n        > .1.3.6.1.4.1.2620.1.49.8.3\n        > .1.3.6.1.4.1.2620.1.49.8.4\n        > ```\n        \n-   **`cpstat threat-emulation -f downloading_file_information`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation information about file download:\n        > \n        > ```\n        > Average Download Percentage: - &lt;N&gt;\n        > \n        > Threat-Emulation Downloading Files Table\n        > ---------------------------------------------------------------------------------------------------------------------\n        > |Type|Downloading File Revision|Downloading File Size|Downloading File Down Start Time|Downloading File Down Percent|\n        > ---------------------------------------------------------------------------------------------------------------------\n        > ... ... ...\n        > ---------------------------------------------------------------------------------------------------------------------\n        > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.2.1.2\n        > .1.3.6.1.4.1.2620.1.49.2.1.9\n        > .1.3.6.1.4.1.2620.1.49.2.1.10\n        > .1.3.6.1.4.1.2620.1.49.2.1.11\n        > .1.3.6.1.4.1.2620.1.49.2.1.12\n        > .1.3.6.1.4.1.2620.1.49.3\n        > ```\n        \n-   **`cpstat threat-emulation -f downloads_information_current`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation information about current file download:\n        > \n        > ```\n        > Average Download Percentage: - &lt;N&gt;\n        > \n        > Threat-Emulation Current Files Table\n        > -----------------------------------------------------------\n        > |Type|UUID|Name|Revision|Size|Start Down Time|Down Percent|\n        > -----------------------------------------------------------\n        > ... ...\n        > -----------------------------------------------------------\n        > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.2.1.2\n        > .1.3.6.1.4.1.2620.1.49.2.1.3\n        > .1.3.6.1.4.1.2620.1.49.2.1.4\n        > .1.3.6.1.4.1.2620.1.49.2.1.5\n        > .1.3.6.1.4.1.2620.1.49.2.1.6\n        > .1.3.6.1.4.1.2620.1.49.2.1.7\n        > .1.3.6.1.4.1.2620.1.49.2.1.8\n        > .1.3.6.1.4.1.2620.1.49.3\n        > ```\n        \n-   **`cpstat threat-emulation -f emulated_file_size`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters of emulated files size:\n        > \n        > ```\n        > TE Emulated File Size:            &lt;N&gt;\n        > TE Emulated File Size Last Day:   &lt;N&gt;\n        > TE Emulated File Size Last Week:  &lt;N&gt;\n        > TE Emulated File Size Last Month: &lt;N&gt;\n        > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.9.1\n        > .1.3.6.1.4.1.2620.1.49.9.2\n        > .1.3.6.1.4.1.2620.1.49.9.3\n        > .1.3.6.1.4.1.2620.1.49.9.4\n        > ```\n        \n-   **`cpstat threat-emulation -f file_type_stat_cache_hit_rate`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters for cache hit rate per file type.\n        > \n        > _Example_:\n        > \n        > > ```\n        > > Threat-Emulation Statistics, Cache Hit Rate\n        > > -----------------------------------------------------------------------------------------------------\n        > > |File Type|Cache Hit Rate|Cache Hit Rate Last Day|Cache Hit Rate Last Week|Cache Hit Rate Last Month|\n        > > -----------------------------------------------------------------------------------------------------\n        > > |doc      |             0|                      0|                       0|                        0|\n        > > |docx     |             0|                      0|                       0|                        0|\n        > > |pdf      |             0|                      0|                       0|                        0|\n        > > |ppt      |             0|                      0|                       0|                        0|\n        > > |pptx     |             0|                      0|                       0|                        0|\n        > > |xls      |             0|                      0|                       0|                        0|\n        > > |xlsx     |             0|                      0|                       0|                        0|\n        > > -----------------------------------------------------------------------------------------------------\n        > > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.2\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.23\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.24\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.25\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.26\n        > ```\n        \n-   **`cpstat threat-emulation -f file_type_stat_cloud_malware_scanned`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters for files scanned on ThreatCloud and detected as containing malware per file type:\n        > \n        > _Example_:\n        > \n        > > ```\n        > > Threat-Emulation Statistics, Threatcloud Malware Scanned\n        > > ---------------------------------------------------------------------------------------------------------------------------------\n        > > |File Type|Scanned|Threatcloud Malware|Threatcloud Malware Last Day|Threatcloud Malware Last Week|Threatcloud Malware Last Month|\n        > > ---------------------------------------------------------------------------------------------------------------------------------\n        > > |doc      |      0|                  0|                           0|                            0|                             0|\n        > > |docx     |      0|                  0|                           0|                            0|                             0|\n        > > |pdf      |      0|                  0|                           0|                            0|                             0|\n        > > |ppt      |      0|                  0|                           0|                            0|                             0|\n        > > |pptx     |      0|                  0|                           0|                            0|                             0|\n        > > |xls      |      0|                  0|                           0|                            0|                             0|\n        > > |xlsx     |      0|                  0|                           0|                            0|                             0|\n        > > ---------------------------------------------------------------------------------------------------------------------------------\n        > > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.2\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.3\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.15\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.16\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.17\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.18\n        > ```\n        \n-   **`cpstat threat-emulation -f file_type_stat_cloud_scanned`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters for files scanned on ThreatCloud per file type.\n        > \n        > _Example_:\n        > \n        > > ```\n        > > Threat-Emulation Statistics, Threatcloud Scanned\n        > > -------------------------------------------------------------------------------------------------------------------------\n        > > |File Type|Threatcloud Scanned|Threatcloud Scanned Last Day|Threatcloud Scanned Last Week|Threatcloud Scanned Last Month|\n        > > -------------------------------------------------------------------------------------------------------------------------\n        > > |doc      |                  0|                           0|                            0|                             0|\n        > > |docx     |                  0|                           0|                            0|                             0|\n        > > |pdf      |                  0|                           0|                            0|                             0|\n        > > |ppt      |                  0|                           0|                            0|                             0|\n        > > |pptx     |                  0|                           0|                            0|                             0|\n        > > |xls      |                  0|                           0|                            0|                             0|\n        > > |xlsx     |                  0|                           0|                            0|                             0|\n        > > -------------------------------------------------------------------------------------------------------------------------\n        > > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.11\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.12\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.13\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.14\n        > ```\n        \n-   **`cpstat threat-emulation -f file_type_stat_error_count`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters for emulation errors per file type.\n        > \n        > _Example_:\n        > \n        > > ```\n        > > Threat-Emulation Statistics, Error Count\n        > > -----------------------------------------------------------------------------------------\n        > > |File Type|Error Count|Error Count Last Day|Error Count Last Week|Error Count Last Month|\n        > > -----------------------------------------------------------------------------------------\n        > > |doc      |          0|                   0|                    0|                     0|\n        > > |docx     |          0|                   0|                    0|                     0|\n        > > |pdf      |          0|                   0|                    0|                     0|\n        > > |ppt      |          0|                   0|                    0|                     0|\n        > > |pptx     |          0|                   0|                    0|                     0|\n        > > |xls      |          0|                   0|                    0|                     0|\n        > > |xlsx     |          0|                   0|                    0|                     0|\n        > > -----------------------------------------------------------------------------------------\n        > > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.2\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.27\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.28\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.29\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.30\n        > ```\n        \n-   **`cpstat threat-emulation -f file_type_stat_file_scanned`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters for scanned files per file type.\n        > \n        > _Example_:\n        > \n        > > ```\n        > > Threat-Emulation Statistics, Scanned Files\n        > > -------------------------------------------------------------------------\n        > > |File Type|Scanned|Scanned Last Day|Scanned Last Week|Scanned Last Month|\n        > > -------------------------------------------------------------------------\n        > > |doc      |      0|               0|                0|                 0|\n        > > |docx     |      0|               0|                0|                 0|\n        > > |pdf      |      0|               0|                0|                 0|\n        > > |ppt      |      0|               0|                0|                 0|\n        > > |pptx     |      0|               0|                0|                 0|\n        > > |xls      |      0|               0|                0|                 0|\n        > > |xlsx     |      0|               0|                0|                 0|\n        > > -------------------------------------------------------------------------\n        > > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.2\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.3\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.4\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.5\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.6\n        > ```\n        \n-   **`cpstat threat-emulation -f file_type_stat_filter_by_analysis`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters for files filtered by static analysis per file type.\n        > \n        > _Example_:\n        > \n        > > ```\n        > > Threat-Emulation Statistics, Filter By Analysis\n        > > ---------------------------------------------------------------------------------------------------------------------\n        > > |File Type|Filter By Analysis|Filter By Analysis Last Day|Filter By Analysis Last Week|Filter By Analysis Last Month|\n        > > ---------------------------------------------------------------------------------------------------------------------\n        > > |doc      |                 0|                          0|                           0|                            0|\n        > > |docx     |                 0|                          0|                           0|                            0|\n        > > |pdf      |                 0|                          0|                           0|                            0|\n        > > |ppt      |                 0|                          0|                           0|                            0|\n        > > |pptx     |                 0|                          0|                           0|                            0|\n        > > |xls      |                 0|                          0|                           0|                            0|\n        > > |xlsx     |                 0|                          0|                           0|                            0|\n        > > ---------------------------------------------------------------------------------------------------------------------\n        > > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.2\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.19\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.20\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.21\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.22\n        > ```\n        \n-   **`cpstat threat-emulation -f file_type_stat_malware_detected`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters for files detected as containing malware per file type.\n        > \n        > _Example_:\n        > \n        > > ```\n        > > Threat-Emulation Statistics, Malware Detected\n        > > -------------------------------------------------------------------------------------------------------------\n        > > |File Type|Malware Detected|Malware Detected Last Day|Malware Detected Last Week|Malware Detected Last Month|\n        > > -------------------------------------------------------------------------------------------------------------\n        > > |doc      |               0|                        0|                         0|                          0|\n        > > |docx     |               0|                        0|                         0|                          0|\n        > > |pdf      |               0|                        0|                         0|                          0|\n        > > |ppt      |               0|                        0|                         0|                          0|\n        > > |pptx     |               0|                        0|                         0|                          0|\n        > > |xls      |               0|                        0|                         0|                          0|\n        > > |xlsx     |               0|                        0|                         0|                          0|\n        > > -------------------------------------------------------------------------------------------------------------\n        > > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.2\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.7\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.8\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.9\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.10\n        > ```\n        \n-   **`cpstat threat-emulation -f file_type_stat_no_resource_count`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters for files filtered by static analysis without resource count per file type.\n        > \n        > _Example_:\n        > \n        > > ```\n        > > Threat-Emulation Statistics, No Resource Count\n        > > -----------------------------------------------------------------------------------------------------------------\n        > > |File Type|No Resource Count|No Resource Count Last Day|No Resource Count Last Week|No Resource Count Last Month|\n        > > -----------------------------------------------------------------------------------------------------------------\n        > > |doc      |                0|                         0|                          0|                           0|\n        > > |docx     |                0|                         0|                          0|                           0|\n        > > |pdf      |                0|                         0|                          0|                           0|\n        > > |ppt      |                0|                         0|                          0|                           0|\n        > > |pptx     |                0|                         0|                          0|                           0|\n        > > |xls      |                0|                         0|                          0|                           0|\n        > > |xlsx     |                0|                         0|                          0|                           0|\n        > > -----------------------------------------------------------------------------------------------------------------\n        > > ```\n        \n    -   Which Threat Emulation SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.2\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.31\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.32\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.33\n        > .1.3.6.1.4.1.2620.1.49.18.1.1.34\n        > ```\n        \n-   **`cpstat threat-emulation -f history_te_comp_hosts`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters for compromised hosts.\n        > \n        > _Example_:\n        > \n        > > ```\n        > > Threat-Emulation Compromised hosts (last hour in 10 minutes resolution)\n        > > --------------------------\n        > > |Low|Medium|High|Critical|\n        > > --------------------------\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > --------------------------\n        > > \n        > > Threat-Emulation Compromised hosts (last day in 4 hours resolution)\n        > > --------------------------\n        > > |Low|Medium|High|Critical|\n        > > --------------------------\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > --------------------------\n        > > \n        > > Threat-Emulation Compromised hosts (last week in 1 day resolution)\n        > > --------------------------\n        > > |Low|Medium|High|Critical|\n        > > --------------------------\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > --------------------------\n        > > \n        > > Threat-Emulation Compromised hosts (last month in 5 days resolution)\n        > > --------------------------\n        > > |Low|Medium|High|Critical|\n        > > --------------------------\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > --------------------------\n        > > ```\n        \n    -   Which SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.47.1.7.1.10\n        > .1.3.6.1.4.1.2620.1.47.1.7.1.11\n        > .1.3.6.1.4.1.2620.1.47.1.7.1.12\n        > .1.3.6.1.4.1.2620.1.47.1.7.1.13\n        > .1.3.6.1.4.1.2620.1.47.1.8.1.10\n        > .1.3.6.1.4.1.2620.1.47.1.8.1.11\n        > .1.3.6.1.4.1.2620.1.47.1.8.1.12\n        > .1.3.6.1.4.1.2620.1.47.1.8.1.13\n        > .1.3.6.1.4.1.2620.1.47.1.9.1.10\n        > .1.3.6.1.4.1.2620.1.47.1.9.1.11\n        > .1.3.6.1.4.1.2620.1.47.1.9.1.12\n        > .1.3.6.1.4.1.2620.1.47.1.9.1.13\n        > .1.3.6.1.4.1.2620.1.47.1.10.1.10\n        > .1.3.6.1.4.1.2620.1.47.1.10.1.11\n        > .1.3.6.1.4.1.2620.1.47.1.10.1.12\n        > .1.3.6.1.4.1.2620.1.47.1.10.1.13\n        > ```\n        \n-   **`cpstat threat-emulation -f history_te_incidents`**\n    \n    -   Displayed information:\n        \n        > Threat Emulation counters for incidents.\n        > \n        > _Example_:\n        > \n        > > ```\n        > > Threat-Emulation Incidents (last hour in 10 minutes resolution)\n        > > --------------------------\n        > > |Low|Medium|High|Critical|\n        > > --------------------------\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > --------------------------\n        > > \n        > > Threat-Emulation Incidents (last day in 4 hours resolution)\n        > > --------------------------\n        > > |Low|Medium|High|Critical|\n        > > --------------------------\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > --------------------------\n        > > \n        > > Threat-Emulation Incidents (last week in 1 day resolution)\n        > > --------------------------\n        > > |Low|Medium|High|Critical|\n        > > --------------------------\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > --------------------------\n        > > \n        > > Threat-Emulation Incidents (last month in 5 days resolution)\n        > > --------------------------\n        > > |Low|Medium|High|Critical|\n        > > --------------------------\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > |  0|     0|   0|       0|\n        > > --------------------------\n        > > ```\n        \n    -   Which SNMP OIDs are queried?\n        \n        > ```\n        > .1.3.6.1.4.1.2620.1.47.1.1.1.10\n        > .1.3.6.1.4.1.2620.1.47.1.1.1.11\n        > .1.3.6.1.4.1.2620.1.47.1.1.1.12\n        > .1.3.6.1.4.1.2620.1.47.1.1.1.13\n        > .1.3.6.1.4.1.2620.1.47.1.2.1.10\n        > .1.3.6.1.4.1.2620.1.47.1.2.1.11\n        > .1.3.6.1.4.1.2620.1.47.1.2.1.12\n        > .1.3.6.1.4.1.2620.1.47.1.2.1.13\n        > .1.3.6.1.4.1.2620.1.47.1.3.1.10\n        > .1.3.6.1.4.1.2620.1.47.1.3.1.11\n        > .1.3.6.1.4.1.2620.1.47.1.3.1.12\n        > .1.3.6.1.4.1.2620.1.47.1.3.1.13\n        > .1.3.6.1.4.1.2620.1.47.1.4.1.10\n        > .1.3.6.1.4.1.2620.1.47.1.4.1.11\n        > .1.3.6.1.4.1.2620.1.47.1.4.1.12\n        > .1.3.6.1.4.1.2620.1.47.1.4.1.13\n        > ```\n        \n\n### (12) Factors that limit the number of Virtual Machines that can be started\n\nThe number of Virtual Machines that can be started is bound by the **installed license**, the **CPU load** and the **RAM utilization**.\n\n<table><tbody><tr><td>Bounding factor</td><td>Explanation</td></tr><tr><td>License</td><td><p>The installed license limits the number of allowed VMs:</p><ul><li>4 VMs on TE100X appliance</li><li>8 VMs on TE250X appliance</li><li>28 VMs on TE1000X appliance</li><li>40 VMs on TE2000X appliance</li><li>56 VMs on TE2000X HPP appliance</li><li>Unlimited number (2<sup>32</sup>-1=4294967295) of VMs with Evaluation license</li></ul><p>Run the \"<code>cpstat threat-emulation -f contract</code>\" command and refer to the counter \"<code>TE Maximal VMs Number:</code>\".</p><p>Note: This license includes Microsoft Windows and Office license.</p></td></tr><tr><td>RAM utilization</td><td><p>When Local Emulation is configured, by default, up to 70% of the RAM will be used by VMs.</p><p>Recommendations:</p><ul><li>You can <em>increase</em> the memory allocation limit, if Security Gateway serves as \"emulation only\" TE appliance.</li><li>You should <em>decrease</em> the memory allocation limit, if the memory is needed for other purposes.</li></ul><p>Follow these steps to configure this limit:</p><ol type=\"A\"><li><p>In SmartConsole, go to the <strong><em>Gateways &amp; Servers</em></strong> view, double-click the object of the Threat Emulation Gateway.</p></li><li><p>In the gateway editor, go to <em><strong>Threat Emulation</strong></em> &gt; <em><strong>Advanced</strong></em>.&nbsp;</p></li><li><p>In the <em><strong>Resource Allocation</strong></em> section, click the <em><strong>Configure</strong></em>&nbsp;button.</p></li><li><p>Configure the limit for memory usage.</p></li><li><p>Click <em><strong>OK</strong></em> &gt;<em><strong>OK</strong></em>.</p></li><li><p>Install the Threat Prevention policy.</p></li></ol></td></tr><tr><td>CPU load</td><td><ul><li><p>By default, if the CPU cores allocated for emulation are more than 90% busy, no more VMs will start until the CPU load drops below that limit.</p><p>Follow these steps:</p><ol type=\"A\"><li><p>Connect with SmartDahsboard / SmartConsole to the Security Management Server / Domain Management Server.</p></li><li><p>For R77.x versions, go to <em><strong>File</strong></em> menu - click on <em><strong>Database Revision Control...</strong></em> - create a revision snapshot.</p><p>Note: Database Revision Control is not supported for VSX objects (<a href=\"https://support.checkpoint.com/results/sk/sk65420\" target=\"_blank\" rel=\"noopener\">sk65420</a>).</p><p>In addition, refer to:</p><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk108902\" target=\"_blank\" rel=\"noopener\">sk108902 - Best Practices - Backup on Gaia OS</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk91400\" target=\"_blank\" rel=\"noopener\">sk91400 - System Backup and Restore feature in Gaia</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk54100\" target=\"_blank\" rel=\"noopener\">sk54100 - How to back up your system on SecurePlatform</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk98153\" target=\"_blank\" rel=\"noopener\">sk98153 - How to take a snapshot of Endpoint Security Management Server database</a></li></ul><p>For R80.x versions, each session is saved automatically. To see the saved sessions, go to <strong>Manage &amp; Settings</strong> &gt; <strong>Sessions</strong> &gt; <strong>Revisions</strong>.</p></li><li><p>Close all SmartDashboard / SmartConsole windows.</p><p>Verify by running the \"<em>cpstat mg</em>\" command on Security Management Server / in the context of <em>each</em> Domain Management Server.</p></li><li><p>Connect with <a href=\"https://support.checkpoint.com/results/sk/sk13009\" target=\"_blank\" rel=\"noopener\">GuiDBedit Tool</a> to Security Management Server / Domain Management Server.</p></li><li><p>In the upper left pane, go to <em><strong>Table</strong></em> - <em><strong>Anti-Malware</strong></em> - <em><strong>antimalware_misc</strong></em>.</p></li><li><p>In the upper right pane, select the relevant Threat Emulation profile - <em><strong>TESettings_&lt;GW_UID&gt;</strong></em><br>(e.g., <code>TESettings_2AC82C3A-073F-4F9D-9A85-FA8FAE751BD9</code>).</p><p>The UID of Security Gateway / StandAlone object can be found in the <strong><code>$FWDIR/conf/objects_5_0.C</code></strong> file on the Security Management Server / Domain Management Server:</p><pre>: (<em>Name_of_GW_or_StandAlone_Object</em>\n        :AdminInfo (\n                :chkpf_uid (\"{<em>This is the UID</em>}\")\n                :ClassName (gateway_ckp)\n</pre><em>Example</em>:<pre>: (R77-30-SA\n        :AdminInfo (\n                :chkpf_uid (\"{EF4AB4D2-4D16-5849-91F2-DB52B740EC8E}\")\n                :ClassName (gateway_ckp)\n</pre></li><li><p>In the lower pane, right-click on the <em><strong>busy_cpu_threshold</strong></em> - select <em><strong>Edit...</strong></em> - delete the current value - enter the new value - click on <em><strong>OK</strong></em>.</p></li><li><p>Save the changes: go to <em><strong>File</strong></em> menu - click on <em><strong>Save All</strong></em>.</p></li><li><p>Close the GuiDBedit Tool.</p></li><li><p>Connect with SmartDashboard R77.X to Security Management Server / Domain Management Server.</p></li><li><p>Install the Security policy and the Threat Prevention policy.</p></li></ol></li><li><p>Enabling SMT (HyperThreading) Feature will improve emulation performance on the SandBlast TE Appliances.</p>The TE250X / TE1000X / TE2000X appliances are already shipped with enabled SMT feature in the BIOS.<br>It is only required to enable the SMT feature in the '<code>cpconfig</code>' menu as described in the <a href=\"https://support.checkpoint.com/results/sk/sk93000#To%20enable%20SMT\" target=\"_blank\" rel=\"noopener\">sk93000 - SMT (HyperThreading) Feature Guide</a>.</li></ul></td></tr></tbody></table>\n\n### (13) Static Analysis\n\nFiles range from very simple (e.g., plain text files) to ultra complex (e.g., Office documents with embedded files).  \nUsually, the risk factor of a file varies according to the number of advanced features it utilizes (e.g., JavaScript in PDF file).\n\nThe pre-emulation static analysis allows skipping files that contain only safe features.\n\nNotes:\n\n-   Static Analysis Filters are constantly updated.\n    \n-   Tests show that Static Analysis allows to filter ~70-80% of the received files (depending on the environment and on file types):\n    \n    -   run the \"`tecli show statistics`\" command and refer to the counter \"`Files filtered by static analysis`\"\n    -   run the \"`cpstat threat-emulation -f file_type_stat_filter_by_analysis`\" command\n\nStatic Analysis is relatively \"heavy\" in terms of Input/Output (yet \"cheaper\" than full emulation).  \nIt is _**not**_ recommended to disable the Static Analysis.  \nDisabling it should be done only under extreme circumstance with explicit instructions from Check Point Support.\n\n**Important Note:** If you disable this setting, it can significantly impact the network performance because every file will be sent to emulation.\n\n1.  In SmartConsole, go to the **Security Policies** view > _**Threat Prevention** > **Custom Policy**._\n2.  Right-click the relevant profile in the _**Action**_ column, and click **_Edit_**.\n3.  In the left navigation pane, go to **_Threat Emulation_** > **_Advanced_**. \n4.  In the **_Static Analysis_** section ,select **_Disable static analysis for filtering files_**.\n5.  Click **_OK_**.\n6.  Install the Threat Prevention policy.\n\n \n\n### (14) Detection Rules\n\n-   Each OS image has a list of regular expressions representing events that its applications generate and that are considered as normal actions  \n    (using \"whitelist\" method - it is easier to define what is allowed, than what is forbidden).\n    \n    Note: This whitelist is dynamically updated from the ThreatCloud.\n-   These white events are filtered during execution of the document/applet (the matching/parsing engine is similar to IPS/Anti-Bot engines).\n    \n-   All events that were not filtered by the detection (whitelist) rules are considered malicious:\n    \n    -   This applies to _documents_\n    -   Machine Learning is used for _executable_ files\n-   Detection Rules are image-specific, but are updated separately from the OS images.\n    \n-   Detection Rules are located in the `/var/log/files_repository/images/<Image_ID>/detection_rules/` directories.\n    \n\nRelated solutions:\n\n-   [sk117672 - How to update the Threat Emulation malware detection rules](https://support.checkpoint.com/results/sk/sk117672)\n\n### (15) Scanning of Archives\n\nEach entry in the archive file is scanned and emulated (if necessary).  \nThe archive file's verdict is determined according to the verdict of its entries.\n\nOnce a single malicious file is found inside an archive file, a log is generated,  \nand the entire archive file is marked as malicious.\n\nRelated solutions:\n\n-   [sk108373 - Threat Emulation blade sends unsupported file types from an archive for emulation](https://support.checkpoint.com/results/sk/sk108373)\n\n### (16) File Reclassifier\n\nFile type is determined based on the file \"magic number\" (header/footer), stream parsing (content type) and more indicators that assist Threat Emulation decide what is the true type of the file being sent.\n\nThe purpose of the File Classifier is two-fold:\n\n-   try to detect whether the file is malicious\n-   mimic as much as possible the behavior the user will experience when the file is executed / opened on Windows OS.\n\nIt is important to understand that Threat Emulation is _not_ signature-based detection engine. Therefore, a file that will not trigger in the Host OS can be considered a futile attack attempt. That being said, the classifier will still try to re-classify the file to allow it to \"detonate\" in the sandbox.\n\nBefore injecting the file into the VM, file extension is changed to the correct extension.  \nThen the file is emulated based on that extension.\n\nIt is possible to disable / enable the File Reclassifier with the \"`tecli advanced attributes set reclassifier <value>`\" command.\n\n_Examples of renamed malicious files_:\n\n```\n[Expert@HostName:0]# file test_file<em><strong>.doc</strong></em>\ntest_file.doc: MS-DOS executable PE  for MS Windows (console) Intel 80386 32-bit\n\n[Expert@HostName:0]# file test_file<em><strong>.exe</strong></em>\ntest_file.exe: Microsoft Office Document\n```\n\n### (17) Detection of a malicious file\n\nA file could be emulated up to 3 times.\n\n1.  On the first run - files of the same format are emulated together in the same VM\n    \n    -   If NOT detected as malicious, then emulation will stop  \n        -   No further emulation takes place\n        -   All files will be considered benign\n    -   If detected as malicious, then emulation will be run once more\n2.  On second run - each file from the previous step is emulated on its own in a different \"clean\" VM\n    \n    -   If detected as malicious, then it is considered malicious (emulation will stop)  \n        -   No further emulation takes place\n        -   Screenshots / Forensics are gathered during this emulation run\n    -   If NOT detected as malicious, then emulation will run once more\n3.  On the third run - file is emulated on its own in another \"clean\" VM\n    \n    -   If detected as malicious, then it is considered as malicious (emulation will stop)\n        -   No further emulation takes place\n        -   Screenshots / Forensics are gathered during this emulation run\n    -   If the file is NOT detected as malicious, then it is NOT considered as malicious (emulation will stop)  \n        -   No further emulation takes place\n\nRelated solutions:\n\n-   [sk115418 - Threat Emulation support for Malicious Macro detection](https://support.checkpoint.com/results/sk/sk115418)\n\n### (18) Emulation of multiple files of the same type on the same virtual machine\n\n-   In order to boost performance, multiple files of the same type (e.g., PDF) are sent to the same virtual machine for emulation\n    \n-   For each file that is sent to the virtual machine for emulation, a new instance of the emulated program (e.g. Adobe Reader) is executed\n    \n-   In case a file was flagged as malicious during multiple file execution, it will be emulated again at a dedicated instance and the current instance will be reverted\n    \n-   Multiple File Execution is _not_ supported with executable files, or CPU-Level images\n    \n-   To see the effectiveness of multiple file execution, run the \"`tecli show emulator vm synopsis`\" command and refer to the columns \"`Cur Files`\" and \"`Total Files`\"\n    \n    _Examples_:\n    \n\n### (19) Threat Emulation API\n\nThe Threat Emulation RESTful API is available on any Check Point appliance with enabled Threat Emulation blade and in the ThreatCloud.\n\nThe Threat Emulation RESTful API allows you to:\n\n-   Query for emulation results\n-   Download reports\n-   Upload files for emulation/extraction\n\nRefer to [Threat Prevention API Reference Guide](https://sc1.checkpoint.com/documents/TPAPI/CP_1.0_ThreatPreventionAPI_APIRefGuide/html_frameset.htm).\n\n### (20) Performance considerations and Best practices\n\n<table><tbody><tr><td>Factor / Configuration</td><td>Recommendations / Guidelines</td></tr><tr><td>Threat Emulation Sizing</td><td><p>Refer to:</p><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk93598\" target=\"_blank\" rel=\"noopener\">sk93598 - Threat Emulation Sizing Mode: how to measure the required inspections at an organization</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk88160\" target=\"_blank\" rel=\"noopener\">sk88160 - The Check Point Performance Sizing Utility</a></li></ul></td></tr><tr><td>Protected Scope</td><td><ul><li><p>Limit the <strong><em>Protected Scope</em></strong>&nbsp;in the Threat Prevention policy (do not use \"<code>Any</code>\").</p></li><li><p>Limit the <strong><em>Protected Scope</em></strong>, <strong><em>Protocol</em></strong> and <strong><em>File Types</em></strong> in the Threat Prevention profile.</p></li></ul></td></tr><tr><td>Threat Emulation Cache</td><td><p>Normally, there is no need for tuning the cache.</p><p>To change the relevant settings:</p><ol type=\"A\"><li><p>In SmartConsole, go to the <strong><em>Manage &amp; Settings</em></strong> view.</p></li><li><p>Go to <strong><em>Blades</em></strong> &gt; <strong><em>Threat Prevention</em></strong> &gt; <strong><i>Advanced Settings</i></strong>.<br>The <strong><em>Threat Prevention Engine Settings</em></strong> window opens.</p></li><li><p>Go to <strong><em>Threat Emulation</em></strong> &gt; <strong><em>Emulation Limits</em></strong>. Set the desired limits:</p><ul><li><p><strong>Maximum Emulation Time - </strong>The maximum time that Threat Emulation does analysis on a file (used only for a Local Emulation).</p></li><li><strong>Maximum File Size for emulation</strong> - &nbsp;Files that are larger than this value are not sent for emulation (because large files can reduce network performance).</li><li><code>Maximum file time in queue</code> - The maximal time that a file waits for Threat Emulation analysis.</li></ul></li><li><strong>Number of file hashes to save in local cache</strong> - Number of file hashes that are stored in the Threat Emulation local cache</li><li><p>Click <strong>OK</strong>.</p></li><li><p>Install the Threat Prevention policy.</p></li></ol></td></tr><tr><td>Static Analysis</td><td><p>Files range from very simple (e.g., plain text files) to ultra complex (e.g., Office documents with embedded files).<br>Usually, the risk factor of a file varies according to the number of advanced features it utilizes (e.g., JavaScript in PDF file).</p><p>The pre-emulation static analysis allows skipping files that contain only safe features.</p><p>Static Analysis is relatively heavy in terms of Input/Output (yet cheaper than full emulation).<br>It is <em><strong>not</strong></em> recommended to disable the Static Analysis.<br>Disabling it should be done only under extreme circumstance with direction from Check Point Support.</p><p><strong>Important Note:</strong> If you disable this setting, it can significantly impact the network performance because every file will be sent to emulation.</p><ol><li>In SmartConsole, go to the <em><strong>Security Policies</strong></em> view &gt; <strong><em>Threat Prevention</em></strong> &gt; <strong><em>Custom Policy</em></strong>.</li><li>Right-click the relevant profile in the <strong><em>Action</em></strong> column, and click <strong><em>Edit</em></strong>.</li><li>In the left navigation pane, go to <strong><em>Threat Emulation</em></strong> &gt; <strong><em>Advanced</em></strong>.&nbsp;</li><li>In the <strong><em>Static Analysis</em></strong> section ,select <strong><em>Disable static analysis for filtering files</em></strong>.</li><li>Click <strong><em>OK</em></strong>.</li><li>Install the Threat Prevention policy.</li></ol></td></tr><tr><td>CPU</td><td><p>By default, if the CPU cores allocated for emulation are more than 90% busy, no more VMs will start until the CPU load drops below that limit.</p><p>Follow these steps:</p><ol type=\"A\"><li><p>Connect with SmartDashboard / SmartConsole to the Security Management Server / Domain Management Server.</p></li><li><p>Go to <em>File</em> menu - click on <em>Database Revision Control...</em> - create a revision snapshot.</p><p>Note: Database Revision Control is not supported for VSX objects (<a href=\"https://support.checkpoint.com/results/sk/sk65420\" target=\"_blank\" rel=\"noopener\">sk65420</a>).</p><p>In addition, refer to:</p><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk108902\" target=\"_blank\" rel=\"noopener\">sk108902 - Best Practices - Backup on Gaia OS</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk91400\" target=\"_blank\" rel=\"noopener\">sk91400 - System Backup and Restore feature in Gaia</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk54100\" target=\"_blank\" rel=\"noopener\">sk54100 - How to back up your system on SecurePlatform</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk98153\" target=\"_blank\" rel=\"noopener\">sk98153 - How to take a snapshot of Endpoint Security Management Server database</a></li></ul><p>For R80.x versions, each session is saved automatically. To see the saved sessions, go to <strong>Manage &amp; Settings</strong> &gt; <strong>Sessions</strong> &gt; <strong>Revisions</strong>.</p></li><li><p>Close all SmartDashboard / SmartConsole windows.</p><p>Verify by running the \"<em>cpstat mg</em>\" command on Security Management Server / in the context of <em>each</em> Domain Management Server.</p></li><li><p>Connect with <a href=\"https://support.checkpoint.com/results/sk/sk13009\" target=\"_blank\" rel=\"noopener\">GuiDBedit Tool</a> to Security Management Server / Domain Management Server.</p></li><li><p>In the upper left pane, go to <em>Table</em> - <em>Anti-Malware</em> - <em>antimalware_misc</em>.</p></li><li><p>In the upper right pane, select the relevant Threat Emulation profile - <em>TESettings_&lt;GW_UID&gt;</em><br>(e.g., <code>TESettings_2AC82C3A-073F-4F9D-9A85-FA8FAE751BD9</code>).</p></li><li><p>In the lower pane, right-click on the <em><strong>busy_cpu_threshold</strong></em> - select <em>Edit...</em> - delete the current value - enter the new value - click on <em>OK</em>.</p></li><li><p>Save the changes: go to <em>File</em> menu - click on <em>Save All</em>.</p></li><li><p>Close the GuiDBedit Tool.</p></li><li><p>Connect with SmartDashboard R77.X to Security Management Server / Domain Management Server.</p></li><li><p>Install the Security policy and the Threat Prevention policy.</p></li></ol></td></tr><tr><td id=\"Performance_consideration_RAM\">RAM</td><td><p>Additional RAM might be required on Security Gateway with enabled Threat Emulation (depending on the amount of emulated files / files sent for emulation).</p><p>When Local Emulation is configured, by default, up to 70% of the RAM will be used by VMs.</p><ul><li>You can <em>increase</em> the memory allocation limit, if this Security Gateway serves as \"emulation only\" TE appliance.</li><li>You should <em>decrease</em> the memory allocation limit, if the memory is needed for other purposes.</li></ul><p>Follow these steps to configure this limit:</p><ol type=\"A\"><li><p>In SmartConsole, open the object of the Threat Emulation Gateway.</p></li><li><p>In the gateway editor, go to <strong><em>Threat Emulation</em></strong> &gt;&nbsp;<strong><em>Advanced</em></strong>.</p></li><li><p>In the <strong><em>Resource Allocation</em></strong> section, select <em><strong>Limit memory allocation</strong></em>, and click <strong>Configure</strong>.</p></li><li><p>Configure the limit for memory usage:</p><em>Example</em>:<br><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/Memory_Allocation_Configuration.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/Memory_Allocation_Configuration.png\" alt=\"\" width=\"20%\"></a></li><li><p>Click <em><strong>OK</strong></em>.</p></li><li><p>Install the Security policy and the Threat Prevention policy.</p></li></ol></td></tr><tr><td>Hyper-Threading</td><td>Enabling Hyper-Threading will improve emulation performance on the Check Point appliances.<br>Follow <a href=\"https://support.checkpoint.com/results/sk/sk93000\" target=\"_blank\" rel=\"noopener\">sk93000 - SMT (HyperThreading) Feature Guide</a>.</td></tr><tr><td>Clustering of Threat<br>Emulation appliances</td><td>Clustering of Threat Emulation appliances is supported, but <em>not</em> recommended.<br>Refer to the \"<span targetid=\"Configuring multiple Threat Emulation Appliances for redundancy and load sharing\">(21) Configuring multiple Threat Emulation Appliances for redundancy and load sharing</span>\" section.</td></tr><tr><td>Anti-Virus blade</td><td>If Anti-Virus blade is also enabled, then there is an expected degradation in Threat Emulation performance of ~5-10% (because most of the work is already done by the Anti-Virus)</td></tr><tr><td>StandAlone</td><td>Running the Local Threat Emulation appliance as a StandAlone (both Security Management Server and Security Gateway are installed on the same machine) is <em>not </em>supported.<br>This is due to the resources required for emulating files in the virtual machines, particularly when a new VM needs to be created to emulate the next file.</td></tr><tr><td>Logging</td><td>To forward Mail Transfer Agent (MTA) logs from Security Gateway into SmartView Tracker / SmartLog, follow the instructions in<br><a href=\"https://support.checkpoint.com/results/sk/sk102995\" target=\"_blank\" rel=\"noopener\">sk102995 - How to export syslog messages from Security Gateway on Gaia OS to a Log Server and view them in SmartView Tracker</a></td></tr></tbody></table>\n\nThreat Emulation resource intensive processes:\n\n1.  File Aggregation (kernel, dlpu):\n    \n    1.  The parsers (Web, Mail), which deeply inspect the connections for traffic\n    2.  The DLPK (DLP Kernel module), which transfers the file parts to the DLPU daemon (1 such daemon per CoreXL FW instance)\n    3.  DLPU daemon writes the file parts to `$FWDIR/tmp/te` and passes the reassembled file to TED daemon  \n        [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/File_Processing_Streaming.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/File_Processing_Streaming.png \"Click the image to see it in full size in a new tab/window\")\n2.  Threat Emulation Cache\n    \n    -   The cache is very lightweight, but has an enormous positive effect on the performance\n    -   From the initial configuration and policy installation, it takes several days for the cache to build up\n    -   Run the \"`tecli show statistics`\" command and refer to the counter \"`Files filtered by local cache`\"\n3.  Static Analysis\n    \n    -   The pre-emulation static analysis allows skipping files that contain only safe features\n    -   Static Analysis is relatively heavy in terms of Input/Output (yet cheaper than full emulation)\n    -   Run the \"`tecli show statistics`\" command and refer to the counter \"`Files filtered by static analysis`\"\n    -   Run the \"`cpstat threat-emulation -f file_type_stat_filter_by_analysis`\" command\n4.  File emulation\n    \n\n### (21) Configuring multiple Threat Emulation Appliances for redundancy and load sharing\n\nIt is possible to install multiple Threat Emulation Private Cloud Appliances on your network (for redundancy and load sharing), and configure each Security Gateway (with enabled Threat Emulation blade) that sends files for a Remote Emulation to use multiple Threat Emulation Private Cloud Appliances.\n\nNote: SmartDashboard R77.X allows selecting only a single Remote Threat Emulation Private Cloud Appliance.  \n_Example_:  \n[![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/Security_Gateway_Properties_Threat_Emulation_Analysis_Location.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/Security_Gateway_Properties_Threat_Emulation_Analysis_Location.png \"Click the image to see it in full size in a new tab/window\")\n\nFollow [sk102309 - Threat Emulation support for Multiple Private Cloud Appliances](https://support.checkpoint.com/results/sk/sk102309) to configure each relevant Security Gateway (\"traffic collector\" / \"harvester\"):\n\n1.  Connect to the command line on the Security Gateway that sends files for a Remote Emulation.\n    \n2.  Log in to the Expert mode.\n    \n3.  Run the \"_tecli advanced remote ..._\" commands:\n    \n    -   To show the list of configured Threat Emulation Private Cloud Appliances:\n        \n        **`[Expert@HostName:0]# tecli advanced remote show`**\n    -   To activate the support for multiple Threat Emulation Private Cloud Appliances:\n        \n        **`[Expert@HostName:0]# tecli advanced remote activate`**\n    -   To add new Threat Emulation Private Cloud Appliance:\n        \n        **`[Expert@HostName:0]# tecli advanced remote add <IP Address>`**\n    \n    Additional commands:\n    \n    -   To removes the configured Threat Emulation Private Cloud Appliance:\n        \n        **`[Expert@HostName:0]# tecli advanced remote remove <Appliance ID>`**\n    -   To deactivate the support for multiple Threat Emulation Private Cloud Appliances:\n        \n        **`[Expert@HostName:0]# tecli advanced remote deactivate`**\n4.  Install the Threat Emulation policy.\n    \n\nNotes:\n\n-   Security Gateway makes the decision to which remote Threat Emulation Private Cloud Appliance  \n    the file should be sent for emulation based on the file's hash:  \n    `[Appliance ID] = [SHA1 of the file] [modulo](https://en.wikipedia.org/wiki/Modulo_operation) [number of configured remote Threat Emulation Private Cloud Appliance]`\n    \n-   If the selected remote Threat Emulation Private Cloud Appliance is down, then the file will be sent to the next on the list (\"`tecli advanced remote show`\").\n    \n\n### (22) Mail Transfer Agent (MTA) redundancy\n\n<table><tbody><tr><td>MTA on Threat Emulation Gateways<br>(recommended)</td><td>MTA on Check Point cluster</td></tr><tr><td><p><em>Example topology</em>:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/MTA_Redundancy_MTA_on_Sandblast_appliances.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/MTA_Redundancy_MTA_on_Sandblast_appliances.png\" alt=\"MTA topology on Threat Emulation Gateway\" width=\"30%\"></a><ul><li>First hop should be customer's Anti-Spam solution (to solve Backscatter/RBL problem)</li><li>MTA is running on Threat Emulation Gateways, so we can control SMTP connections to the MTA via the Check Point cluster's security rules</li><li>First hop uses, e.g., DNS to round-robin e-mails to Threat Emulation Gateway</li><li>Perimeter Check Point cluster runs all Threat Prevention blades and can offload HTTP/HTTPS emulation to Threat Emulation Gateway(s) if needed</li><li>After emulation, Threat Emulation Gateway's MTA forwards the e-mails to the internal Mail Server</li></ul></td><td><p><em>Example topology</em>:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/MTA_Redundancy_MTA_on_Cluster.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/MTA_Redundancy_MTA_on_Cluster.png\" alt=\"MTA topology on Threat Emulation Cluster\" width=\"30%\"></a><ul><li>First hop should be customer's Anti-Spam solution (to solve Backscatter/RBL problem)</li><li>MTA is running on Threat Emulation Gateways, so we can control SMTP connections to the MTA via the Check Point cluster's security rules</li><li>The Check Point cluster is running the MTA</li><li>Perimeter Check Point cluster runs all Threat Prevention blades and MTA and can offload HTTP/HTTPS emulation to Threat Emulation Gateway(s) if needed</li><li>Threat Emulation Gateways have internal IP addresses.</li><li>After emulation, Check Point cluster's MTA forwards the e-mails to the internal Mail Server</li></ul><p>Notes:</p><ul><li>Such deployment is needed if Check Point cluster sends files for emulation to ThreatCloud (there is no on-premise Threat Emulation Appliance)</li><li>Such deployment is needed if MTA should be used with ThreatCloud emulation</li><li>Such deployment requires manual editing of implied rules to be able to configure security rules to control traffic to the MTA on a Check Point cluster</li></ul><p>Related solutions:</p><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk107093\" target=\"_blank\" rel=\"noopener\">sk107093 - E-mails do not reach the client after selecting Cluster Virtual Interface(s) in MTA \"Advanced Settings\"</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk109198\" target=\"_blank\" rel=\"noopener\">sk109198 - E-mail client receives timeout error, e-mails do not reach their destinations, and SmartView Tracker shows duplicated Threat Emulation logs from a cluster</a></li></ul></td></tr></tbody></table>\n\n### (23) Monitoring\n\n-   Check the Threat Emulation counters using the _tecli_ command and the _cpstat threat-emulation_ command - refer to these sections:\n    \n    -   \"(10) The _tecli_ command (Threat Emulation Command Line Tool)\"\n    -   \"(11) The _cpstat threat-emulation_ command\"\n-   Monitor the Threat Emulation counters over SNMP:\n    \n    The Check Point OID tree .1.3.6.1.4.1.2620.1.49 (`.iso.org.dod.internet.private.enterprises.checkpoint.products.te`) contains the Threat Emulation counters.\n    \n    <table><tbody><tr><td>Object</td><td>OID</td></tr><tr><td>Threat Emulation Queue Files Table</td><td>.1.3.6.1.4.1.2620.1.49.1</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Queue Files Table - Index</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.1.1</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Queue Files Table - File Name</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.1.2</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Queue Files Table - Time In Queue</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.1.3</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Queue Files Table - Analyzed On</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.1.4</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Queue Files Table - Image</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.1.5</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Queue Files Table - File Size</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.1.6</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Queue Files Table - File Source</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.1.7</td></tr><tr><td>Threat Emulation Downloading Files Table</td><td>.1.3.6.1.4.1.2620.1.49.2</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Downloading Files Table - Index</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.2.1</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Downloading Files Table - File Type</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.2.2</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Downloading Files Table - File UUID</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.2.3</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Downloading Files Table - File Name</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.2.4</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Downloading Files Table - Current File Revision</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.2.5</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Downloading Files Table - Current File Size</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.2.6</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Downloading Files Table - Current File Download Start Time</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.2.7</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Downloading Files Table - Current File Download Percent</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.2.8</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Downloading Files Table - Downloading File Revision</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.2.9</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Downloading Files Table - Downloading File Size</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.2.10</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Downloading Files Table - Downloading File Download Start Time</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.2.11</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Downloading Files Table - Downloading File Download Percent</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.2.12</td></tr><tr><td>Threat Emulation Average Download Percentage</td><td>.1.3.6.1.4.1.2620.1.49.3</td></tr><tr><td>Threat Emulation Scanned Files (Quantity)</td><td>.1.3.6.1.4.1.2620.1.49.4</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Scanned Files Total Count</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.4.1</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Scanned Files Count Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.4.2</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Scanned Files Count Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.4.3</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Scanned Files Count Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.4.4</td></tr><tr><td>Threat Emulation Malware Detected (Quantity)</td><td>.1.3.6.1.4.1.2620.1.49.5</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Malware Detected Total Count</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.5.1</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Malware Detected Count Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.5.2</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Malware Detected Count Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.5.3</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Malware Detected Count Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.5.4</td></tr><tr><td>Threat Emulation Scanned Files On Threat Cloud (Quantity)</td><td>.1.3.6.1.4.1.2620.1.49.6</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Scanned Files On Threat Cloud Total Count</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.6.1</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Scanned Files On Threat Cloud Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.6.2</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Scanned Files On Threat Cloud Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.6.3</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Scanned Files On Threat Cloud Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.6.4</td></tr><tr><td>Threat Emulation Malware Detected On ThreatCloud (Quantity)</td><td>.1.3.6.1.4.1.2620.1.49.7</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Malware Detected On ThreatCloud Total Count</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.7.1</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Malware Detected On ThreatCloud Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.7.2</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Malware Detected On ThreatCloud Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.7.3</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Malware Detected On ThreatCloud Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.7.4</td></tr><tr><td>Threat Emulation Average Process Time (Quantity)</td><td>.1.3.6.1.4.1.2620.1.49.8</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Average Process Time Total Count</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.8.1</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Average Process Time Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.8.2</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Average Process Time Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.8.3</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Average Process Time Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.8.4</td></tr><tr><td>Threat Emulation Emulated File Size (in Bytes)</td><td>.1.3.6.1.4.1.2620.1.49.9</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Emulated File Size Total</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.9.1</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Emulated File Size Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.9.2</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Emulated File Size Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.9.3</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Emulated File Size Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.9.4</td></tr><tr><td>Threat Emulation Queue Size (Quantity)</td><td>.1.3.6.1.4.1.2620.1.49.10</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Queue Size Total Count</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.10.1</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Queue Size Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.10.2</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Queue Size Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.10.3</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Queue Size Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.10.4</td></tr><tr><td>Threat Emulation Peak Size (Quantity)</td><td>.1.3.6.1.4.1.2620.1.49.11</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Peak Size Total Count</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.11.1</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Peak Size Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.11.2</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Peak Size Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.11.3</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Peak Size Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.11.4</td></tr><tr><td>Threat Emulation Emails Scanned</td><td>.1.3.6.1.4.1.2620.1.49.12</td></tr><tr><td>Threat Emulation Downloaded Files Scanned</td><td>.1.3.6.1.4.1.2620.1.49.13</td></tr><tr><td>Threat Emulation Files In Queue</td><td>.1.3.6.1.4.1.2620.1.49.14</td></tr><tr><td>Threat Emulation Number Of Emulation Environments</td><td>.1.3.6.1.4.1.2620.1.49.15</td></tr><tr><td>Threat Emulation Update Status</td><td>.1.3.6.1.4.1.2620.1.49.16</td></tr><tr><td>Threat Emulation Update Status Description</td><td>.1.3.6.1.4.1.2620.1.49.17</td></tr><tr><td>Threat Emulation Statistics, Scanned Files</td><td>.1.3.6.1.4.1.2620.1.49.18</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Index</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.1</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - File Type</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.2</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Total Files Scanned</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.3</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Total Files Scanned Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.4</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Total Files Scanned Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.5</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Total Files Scanned Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.6</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Total Malware Detected</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.7</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Total Malware Detected Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.8</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Total Malware Detected Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.9</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Total Malware Detected Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.10</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Threatcloud Scanned</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.11</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Threatcloud Scanned Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.12</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Threatcloud Scanned Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.13</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Threatcloud Scanned Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.14</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Threatcloud Malware</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.15</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Threatcloud Malware Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.16</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Threatcloud Malware Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.17</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Threatcloud Malware Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.18</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Filter By Analysis</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.19</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Filter By Analysis Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.20</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Filter By Analysis Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.21</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Filter By Analysis Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.22</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Cache Hit Rate</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.23</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Cache Hit Rate Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.24</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Cache Hit Rate Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.25</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Cache Hit Rate Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.26</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Error Count</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.27</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Error Count Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.28</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Error Count Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.29</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - Error Count Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.30</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - No Resource Count</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.31</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - No Resource Count Last Day</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.32</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - No Resource Count Last Week</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.33</td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Threat Emulation Statistics - No Resource Count Last Month</td><td>&nbsp;&nbsp;&nbsp;&nbsp;.1.3.6.1.4.1.2620.1.49.18.34</td></tr><tr><td>Threat Emulation Contract Name</td><td>.1.3.6.1.4.1.2620.1.49.19</td></tr><tr><td>Threat Emulation Contract Cloud Subscription Expiration Date</td><td>.1.3.6.1.4.1.2620.1.49.20</td></tr><tr><td>Threat Emulation Contract Cloud Hourly Quota</td><td>.1.3.6.1.4.1.2620.1.49.21</td></tr><tr><td>Threat Emulation Contract Cloud Monthly Quota</td><td>.1.3.6.1.4.1.2620.1.49.22</td></tr><tr><td>Threat Emulation Contract Cloud Remaining Quota</td><td>.1.3.6.1.4.1.2620.1.49.23</td></tr><tr><td>Threat Emulation Contract Maximal VMs Number</td><td>.1.3.6.1.4.1.2620.1.49.24</td></tr><tr><td>Threat Emulation Contract Subscription Status</td><td>.1.3.6.1.4.1.2620.1.49.25</td></tr><tr><td>Threat Emulation Contract Cloud Quota Status</td><td>.1.3.6.1.4.1.2620.1.49.26</td></tr><tr><td>Threat Emulation Contract Subscription Description</td><td>.1.3.6.1.4.1.2620.1.49.27</td></tr><tr><td>Threat Emulation Contract Cloud Quota Description</td><td>.1.3.6.1.4.1.2620.1.49.28</td></tr><tr><td>Threat Emulation Engine Major Version</td><td>.1.3.6.1.4.1.2620.1.49.29</td></tr><tr><td>Threat Emulation Engine Minor Version</td><td>.1.3.6.1.4.1.2620.1.49.30</td></tr><tr><td>Threat Emulation Contract Cloud Quota Identifier</td><td>.1.3.6.1.4.1.2620.1.49.31</td></tr><tr><td>Threat Emulation Contract Cloud Monthly Quota Period Start</td><td>.1.3.6.1.4.1.2620.1.49.32</td></tr><tr><td>Threat Emulation Contract Cloud Monthly Quota Period End</td><td>.1.3.6.1.4.1.2620.1.49.33</td></tr><tr><td>Threat Emulation Contract Cloud Monthly Quota Usage for This GW</td><td>.1.3.6.1.4.1.2620.1.49.34</td></tr><tr><td>Threat Emulation Contract Cloud Hourly Quota Usage for this GW</td><td>.1.3.6.1.4.1.2620.1.49.35</td></tr><tr><td>Threat Emulation Is First Download</td><td>.1.3.6.1.4.1.2620.1.49.36</td></tr><tr><td>Threat Emulation Contract Cloud Monthly Quota Usage for Quota ID</td><td>.1.3.6.1.4.1.2620.1.49.37</td></tr><tr><td>Threat Emulation Contract Cloud Hourly Quota Usage for Quota ID</td><td>.1.3.6.1.4.1.2620.1.49.38</td></tr><tr><td>Threat Emulation Contract Cloud Monthly Quota Exceeded</td><td>.1.3.6.1.4.1.2620.1.49.39</td></tr><tr><td>Threat Emulation Contract Cloud Hourly Quota Exceeded</td><td>.1.3.6.1.4.1.2620.1.49.40</td></tr><tr><td>Threat Emulation Contract Cloud Last Quota Update GMT Time</td><td>.1.3.6.1.4.1.2620.1.49.41</td></tr><tr><td>Threat Emulation Status</td><td>.1.3.6.1.4.1.2620.1.49.101</td></tr><tr><td>Threat Emulation Status - Short Description</td><td>.1.3.6.1.4.1.2620.1.49.102</td></tr><tr><td>Threat Emulation Status - Long Description</td><td>.1.3.6.1.4.1.2620.1.49.103</td></tr></tbody></table>\n    \n-   Monitor the MTA queue on Gaia OS over SNMP:\n    \n    Follow the following action plan (for detailed instructions, refer to  \n    [sk90860 - How to configure SNMP on Gaia OS](https://support.checkpoint.com/results/sk/sk90860#Advanced%20SNMP%20configuration%20-%20Extend%20SNMP) - section \"(IV-6) Advanced SNMP configuration - Extend SNMP with shell script\"):\n    \n    1.  Create the following shell script - `/home/admin/mailqueue.sh`:\n        \n        ```\n        #!/bin/bash\n        # Extract Postfix queue size value\n        MAILQ=$(/opt/postfix/usr/sbin/postqueue -c /opt/postfix/etc/postfix/ -p | egrep '^--.*Request|^Mail.*empty')\n        if [[ $MAILQ =~ \"empty\" ]] ; then\n        RESPONSE=0\n        echo $RESPONSE\n        elif [[ $MAILQ =~ \"Request\" ]] ; then\n        RESPONSE=$(echo $MAILQ|awk '{print $5}')\n        echo $RESPONSE\n        else\n        RESPONSE=error\n        fi\n        ```\n        \n    2.  Create the following shell script - `/home/admin/emaild_tmpdir.sh`:\n        \n        ```\n        #!/bin/bash\n        # Extract emaild temp file queue amount\n        . /opt/CPshared/5.0/tmp/.CPprofile.sh\n        ls -l $FWDIR/tmp/email_tmp/ |grep emailtemp | wc -l\n        ```\n        \n    3.  Create the following shell script - `/home/admin/running_vm.sh`:\n        \n        ```\n        # Extract amount of running VM Instances\n        #!/bin/bash\n        . /opt/CPshared/5.0/tmp/.CPprofile.sh\n        tecli show emulator emulations | grep \"Running virtual machines\" | awk '{print $4}'\n        ```\n        \n    4.  Select free OIDs - e.g., .1.3.6.1.4.1.2620.1.25x.y\n        \n    5.  Disable the SNMP Agent\n        \n    6.  Add the following lines to the `/etc/snmp/userDefinedSettings.conf` file:\n        \n        ```\n        extend .1.3.6.1.4.1.2620.1.250.1 postfix_queue /bin/sh /home/admin/mailqueue.sh\n        extend .1.3.6.1.4.1.2620.1.250.2 emaild_queue /bin/sh /home/admin/emaild_tmpdir.sh\n        extend .1.3.6.1.4.1.2620.1.250.3 vm /bin/sh /home/admin/running_vm.sh\n        ```\n        \n    7.  Enable the SNMP Agent\n        \n    8.  Save the changes in Gaia Database\n        \n    9.  Test the new OIDs:\n        \n        -   Postfix queue:  \n            `snmpwalk -v 2c -c <community> localhost .1.3.6.1.4.1.2620.1.250.1`\n        -   in.emaild.mta queue:  \n            `snmpwalk -v 2c -c <community> localhost .1.3.6.1.4.1.2620.1.250.2`\n        -   Number of running virtual machines:  \n            `snmpwalk -v 2c -c <community> localhost .1.3.6.1.4.1.2620.1.250.3`\n\n### (24) Troubleshooting\n\n<table><tbody><tr><td>Emulation Scenario</td><td>What to check</td></tr><tr><td><p>When sending files to<br>the Check Point ThreatCloud</p></td><td><ol><li><p>Check that Security Gateway is up and running.</p></li><li><p>Check that all required processes on the Security Gateway are up and running</p><strong><code>[Expert@HostName:0]# cpwd_admin list</code></strong></li><li><p>Check that the Date and Time are set correctly on the Security Gateway.</p></li><li><p>Check that the DNS Server(s) are defined on the Security Gateway.</p></li><li><p>Check that the Proxy Server is defined in the Security Gateway object in SmartConsole.</p></li><li><p>Check that the Proxy Server is defined in the Global Properties in SmartConsole.</p></li><li><p>Check that the Security Gateway is able to connect to the Internet.</p></li><li><p>Check the Threat Emulation configuration in the Security Gateway object in SmartConsole.</p></li><li><p>Install the Security policy and the Threat Prevention policy.</p></li><li><p>Check the logs from Threat Emulation blade in the Logs &amp; Events view in SmartConsole.</p></li><li><p>Check that the Security Gateway is able to resolve the ThreatCloud Pod addresses:</p><strong><code>[Expert@HostName:0]# nslookup -query=SRV te.checkpoint.com</code></strong></li><li><p>Check on the Security Gateway which ThreatCloud Pods are allowed:</p><strong><code>[Expert@HostName:0]# tecli advanced cloud geo status</code></strong></li><li><p>Check on the Security Gateway that the Threat Emulation Quota is not reached:</p><strong><code>[Expert@HostName:0]# tecli show cloud quota</code></strong></li><li><p>Check the logs of relevant processes on the Security Gateway (refer to the \"<span targetid=\"User Space\">(9) User Space</span>\" section).</p></li><li><p>Collect the relevant debugs (of processes and of kernel) on the Security Gateway - refer to the \"<span targetid=\"Debug\">(25) Debug</span>\" section and <a href=\"http://www.checkpoint.com/support-services/contact-support/index.html\" target=\"_blank\" rel=\"noopener\">consult Check Point Support</a>.</p></li></ol></td></tr><tr><td><p>When emulating files on<br>the Local Threat Emulation<br>Private Cloud Appliance<br>installed on your network</p></td><td><ol><li><p>Check that Threat Emulation Appliance is up and running.</p></li><li><p>Check that all required processes on the Threat Emulation Appliance are up and running</p><strong><code>[Expert@HostName:0]# cpwd_admin list</code></strong></li><li><p>Check that the Date and Time are set correctly on the Security Gateway.</p></li><li><p>Check that the DNS Server(s) are defined on the Security Gateway.</p></li><li><p>Check that the Proxy Server is defined in the Security Gateway object in SmartConsole.</p></li><li><p>Check that the Proxy Server is defined in the Global Properties in SmartConsole.</p></li><li><p>Check that the Threat Emulation Appliance is able to connect to the Internet.</p></li><li><p>Check that the Threat Emulation Appliance is able to connect to Check Point update servers:</p><strong><code>[Expert@HostName:0]# curl_cli [--proxy &lt;IP_or_HostName:Port&gt;] –vk http://te.checkpoint.com</code></strong></li><li><p>Check the Threat Emulation configuration (including the Resource Allocation) in the Threat Emulation Appliance object in SmartConsole.</p></li><li><p>Install the Security policy and the Threat Prevention policy.</p></li><li><p>Check the logs from Threat Emulation blade in the Logs &amp; Events view in SmartConsole.</p></li><li><p>Check on the Threat Emulation Appliance how the emulation works:</p><ol type=\"A\"><li><p><strong><code>[Expert@HostName:0]# tecli show statistics</code></strong></p><ul><li>Do the emulation work?</li><li>How many files do you see?</li><li>Do you have any hits by cache?</li><li>What is the average processing time?</li></ul></li><li><p><strong><code>[Expert@HostName:0]# tecli cache dump all</code></strong></p><ul><li>Do you have files with verdicts?</li></ul></li><li><p><strong><code>[Expert@HostName:0]# tecli show emulator emulations</code></strong></p><ul><li>Are emulations happening at this moment?</li></ul></li></ol></li><li><p>Check that the Threat Emulation Appliance has the latest OS images, detection rules, and engine revisions:</p><p><strong><code>[Expert@HostName:0]# tecli show downloads all</code></strong><br><strong><code>[Expert@HostName:0]# tecli advanced engine version</code></strong></p><ul><li>Are the OS images in \"Ready\" state?</li><li>Does the Threat Emulation Appliance have the latest revisions (per <a href=\"https://support.checkpoint.com/results/sk/sk92509\" target=\"_blank\" rel=\"noopener\">sk92509</a> and <a href=\"https://support.checkpoint.com/results/sk/sk95235\" target=\"_blank\" rel=\"noopener\">sk95235</a>)?</li><li>If the components are not up-to-date, or the OS images are not in the \"Ready\" state, then:<br><ol type=\"A\"><li>Delete the old images:<br><strong><code>[Expert@HostName:0]# rm -rf /var/log/files_repository/images</code></strong></li><li>Kill the TED daemon:<br><strong><code>[Expert@HostName:0]# fw kill ted</code></strong></li><li>Update all the components:<br><strong><code>[Expert@HostName:0]# tecli advanced downloads update all</code></strong></li><li>Check again:<br><strong><code>[Expert@HostName:0]# tecli show downloads all</code></strong><br><strong><code>[Expert@HostName:0]# tecli advanced engine version</code></strong></li></ol></li></ul></li><li><p>Check the logs of relevant processes on the Threat Emulation Appliance (refer to the \"<span targetid=\"User Space\">(9) User Space</span>\" section).</p></li><li><p>Collect the relevant debugs (of processes and of kernel) on the Threat Emulation Appliance - refer to the \"<span targetid=\"Debug\">(25) Debug</span>\" section and <a href=\"http://www.checkpoint.com/support-services/contact-support/index.html\" target=\"_blank\" rel=\"noopener\">consult Check Point Support</a>.</p></li></ol></td></tr><tr><td><p>When sending files to<br>a Remote Threat Emulation<br>Private Cloud Appliance<br>installed on your network</p></td><td><ol><li><p>Check that Security Gateway and the Remote Threat Emulation Private Cloud Appliance are up and running.</p></li><li><p>Check that all required processes on the Security Gateway and on the Remote Threat Emulation Private Cloud Appliance are up and running</p><strong><code>[Expert@HostName:0]# cpwd_admin list</code></strong></li><li><p>Check that the Date and Time are set correctly on the Security Gateway and on the Remote Threat Emulation Private Cloud Appliance.</p></li><li><p>Check that the DNS Server(s) are defined on the Security Gateway.</p></li><li><p>Check that the Proxy Server is defined in the Security Gateway object and in the Remote Threat Emulation Private Cloud Appliance object in SmartConsole.</p></li><li><p>Check that the Proxy Server is defined in the Global Properties in SmartConsole.</p></li><li><p>Check that the Remote Threat Emulation Private Cloud Appliance is able to connect to the Internet.</p></li><li><p>Check the Threat Emulation configuration in the Security Gateway object and in the Remote Threat Emulation Private Cloud Appliance (including the Resource Allocation) object in SmartConsole.</p></li><li><p>Install the Security policy and the Threat Prevention policy.</p></li><li><p>Check the logs from Threat Emulation blade in the Logs &amp; Events view in SmartConsole.</p></li><li><p>Check on the Security Gateway how the emulation works:</p><ol type=\"A\"><li><p><strong><code>[Expert@HostName:0]# tecli show statistics</code></strong></p><ul><li>Do the emulation work?</li><li>How many files do you see?</li><li>Do you have any hits by cache?</li><li>What is the average processing time?</li></ul></li><li><p><strong><code>[Expert@HostName:0]# tecli cache dump all</code></strong></p><ul><li>Do you have files with verdicts?</li></ul></li></ol></li><li><p>Check the logs of relevant processes on the Security Gateway and on the Remote Threat Emulation Private Cloud Appliance (refer to the \"<span targetid=\"User Space\">(9) User Space</span>\" section).</p></li><li><p>Collect the relevant debugs (of processes and of kernel) on the Security Gateway and on the Remote Threat Emulation Private Cloud Appliance - refer to the \"<span targetid=\"Debug\">(25) Debug</span>\" section and <a href=\"http://www.checkpoint.com/support-services/contact-support/index.html\" target=\"_blank\" rel=\"noopener\">consult Check Point Support</a>.</p></li></ol></td></tr></tbody></table>\n\nAdditional Troubleshooting steps:\n\n-   To resolve problems for the upstream MTA delivering e-mails to Check Point Security Gateway configured as MTA,  \n    disable the TCP timestamps on Check Point MTA per [sk62700 - How to disable TCP timestamps (RFC 1323)](https://support.checkpoint.com/results/sk/sk62700).  \n    Note: This change will be applied only to local connections (connections where the source or destination is the Security Gateway).\n    \n-   Useful MTA/Postfix commands:\n    \n    Refer to [http://www.postfix.org](http://www.postfix.org/) and [http://www.postfix.org/postqueue.1.html](http://www.postfix.org/postqueue.1.html).\n    \n    -   Restart postfix:  \n        `[Expert@HostName:0]# /opt/postfix/usr/sbin/postfix -c /opt/postfix/etc/postfix reload`\n    -   Stop postfix:  \n        `[Expert@HostName:0]# /opt/postfix/usr/sbin/postfix -c /opt/postfix/etc/postfix stop`\n    -   Show current queue:  \n        `[Expert@HostName:0]# /opt/postfix/usr/sbin/postqueue -c /opt/postfix/etc/postfix/ -p`\n    -   Show one mail from queue (e.g., with Queue ID 5632E28B0044):  \n        `[Expert@HostName:0]# /opt/postfix/usr/sbin/postcat -c /opt/postfix/etc/postfix/ -q 5632E28B0044 | less`\n    -   Attempt immediate delivery of queue content:  \n        `[Expert@HostName:0]# /opt/postfix/usr/sbin/postqueue -c /opt/postfix/etc/postfix/ -f`\n    -   Delete one message from queue (e.g., with Queue ID 5632E28B0044):  \n        `[Expert@HostName:0]# /opt/postfix/usr/sbin/postsuper -c /opt/postfix/etc/postfix/ -d 5632E28B0044`\n    -   Delete all messages from queue:  \n        `[Expert@HostName:0]# /opt/postfix/usr/sbin/postsuper -c /opt/postfix/etc/postfix/ -d ALL`\n    -   Show postfix configuration:  \n        `[Expert@HostName:0]# /opt/postfix/usr/sbin/postconf -c /opt/postfix/etc/postfix/`\n    -   Pipe text (\" ThisIsAMaillogEntry\") into /var/log/maillog:  \n        `[Expert@HostName:0]# /opt/postfix/usr/sbin/postlog -c /opt/postfix/etc/postfix/ ThisIsAMaillogEntry`\n    -   Get postfix version:  \n        `[Expert@HostName:0]# /opt/postfix/usr/sbin/postconf -c /opt/postfix/etc/postfix/ | grep mail_version`\n\n### (25) Debug\n\n**Important Note:** Since the required debugs are quite extensive, it is necessary to schedule a maintenance window (to minimize the impact on the Security Gateway).\n\n**Note:** In cluster environment, this procedure must be performed on _all_ members of the cluster.\n\n-   **If Mail Transfer Agent (MTA) is _not_ used:**\n    \n    > Example flow:\n    > \n    > [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/File_Processing_Streaming.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/File_Processing_Streaming.png \"Click the image to see it in full size in a new tab/window\")\n    > \n    > 1.  Rotate the _$FWDIR/log/ted.elg_ files:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug rotate`**\n    > 2.  Add a mark to the log files:\n    >     \n    >     **`[Expert@HostName:0]# echo \"==debug_start==\" >> $FWDIR/log/dlpu.elg`**  \n    >     **`[Expert@HostName:0]# echo \"==debug_start==\" >> $FWDIR/log/ted.elg`**\n    > 3.  Start the debug of the DLPU process:\n    >     \n    >     **`[Expert@HostName:0]# fw debug dlpu on TDERROR_ALL_ALL=5`**\n    > 4.  Set the TED debug options:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug set TE all`**\n    > 5.  Enable the debug of the TED process:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug on`**\n    > 6.  Check the debug status of the TED process:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug stat`**\n    > 7.  Prepare the kernel debug:\n    >     \n    >     **Important Note:** [Consult Check Point Support](http://www.checkpoint.com/support-services/contact-support/index.html) to minimize the CPU load on the Security Gateway caused by this debug.\n    >     \n    >     **`[Expert@HostName:0]# fw ctl debug 0`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -buf 320000`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m fw + conn drop malware te ioctl mail cmi vm tcpstr`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m dlpk all`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m cmi_loader all`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m WS all`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m CI all`**\n    >     \n    > 8.  Verify the kernel debug:\n    >     \n    >     **`[Expert@HostName:0]# fw ctl debug -m fw`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m dlpk`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m cmi_loader`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m WS`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m CI`**\n    >     \n    > 9.  Start the kernel debug:\n    >     \n    >     **`[Expert@HostName:0]# fw ctl kdebug -f -T > /var/log/kernel_debug.txt`**\n    > 10.  Replicate the issue.\n    >     \n    >     Make sure the issue was replicated - save all the relevant outputs, take all the relevant screenshots.\n    > 11.  Stop the kernel debug:\n    >     \n    >     Press CTRL+C, and run  \n    >     **`[Expert@HostName:0]# fw ctl debug 0`**\n    > 12.  Disable the debug of the TED process:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug off`**\n    > 13.  Reset the TED debug options to their defaults:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug defaults`**\n    > 14.  Check the debug status of the TED process:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug stat`**\n    > 15.  Stop the debug of the DLPU process:\n    >     \n    >     **`[Expert@HostName:0]# fw debug dlpu off TDERROR_ALL_ALL=0`**\n    > 16.  Add a mark to the log files:\n    >     \n    >     **`[Expert@HostName:0]# echo \"==debug_stop==\" >> $FWDIR/log/dlpu.elg`**  \n    >     **`[Expert@HostName:0]# echo \"==debug_stop==\" >> $FWDIR/log/ted.elg`**\n    > 17.  Collect these files from the Security Gateway:\n    >     \n    >     -   `$FWDIR/log/dlpu.elg*`\n    >     -   `$FWDIR/log/ted.elg*`\n    >     -   `/var/log/kernel_debug.txt`\n    >     -   `/var/log/messages*`\n    >     -   all the relevant outputs\n    >     -   all the relevant screenshots\n    >     -   [CPinfo](https://support.checkpoint.com/results/sk/sk92739) file\n    >     \n    >     In addition, collect the [CPinfo](https://support.checkpoint.com/results/sk/sk92739) file from the Security Management Server / Domain Management Server that manages this Security Gateway\n    \n-   **If Mail Transfer Agent (MTA) _is_ configured:**\n    \n    > Example flow:\n    > \n    > [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/File_Processing_MTA.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk114806/File_Processing_MTA.png \"Click the image to see it in full size in a new tab/window\")\n    > \n    > 1.  Rotate the _$FWDIR/log/ted.elg_ files:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug rotate`**\n    > 2.  Add a mark to the log files:\n    >     \n    >     **`[Expert@HostName:0]# echo \"==debug_start==\" >> $FWDIR/log/emaild.mta.elg`**  \n    >     **`[Expert@HostName:0]# echo \"==debug_start==\" >> $FWDIR/log/ted.elg`**\n    > 3.  Start the debug of the IN.EMAILD.MTA process:\n    >     \n    >     **`[Expert@HostName:0]# fw debug in.emaild.mta on TDERROR_ALL_ALL=5`**\n    > 4.  Set the TED debug options:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug set TE all`**\n    > 5.  Enable the debug of the TED process:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug on`**\n    > 6.  Check the debug status of the TED process:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug stat`**\n    > 7.  Prepare the kernel debug:\n    >     \n    >     **Important Note:** [Consult Check Point Support](http://www.checkpoint.com/support-services/contact-support/index.html) to minimize the CPU load on the Security Gateway caused by this debug.\n    >     \n    >     **`[Expert@HostName:0]# fw ctl debug 0`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -buf 320000`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m fw + conn drop malware te ioctl mail cmi vm tcpstr`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m dlpk all`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m cmi_loader all`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m WS all`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m CI all`**\n    >     \n    > 8.  Verify the kernel debug:\n    >     \n    >     **`[Expert@HostName:0]# fw ctl debug -m fw`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m dlpk`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m cmi_loader`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m WS`**  \n    >     **`[Expert@HostName:0]# fw ctl debug -m CI`**\n    >     \n    > 9.  Start the kernel debug:\n    >     \n    >     **`[Expert@HostName:0]# fw ctl kdebug -f -T > /var/log/kernel_debug.txt`**\n    > 10.  Replicate the issue.\n    >     \n    >     Make sure the issue was replicated - save all the relevant outputs, take all the relevant screenshots.\n    > 11.  Stop the kernel debug:\n    >     \n    >     Press CTRL+C, and run  \n    >     **`[Expert@HostName:0]# fw ctl debug 0`**\n    > 12.  Disable the debug of the TED process:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug off`**\n    > 13.  Reset the TED debug options to their defaults:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug defaults`**\n    > 14.  Check the debug status of the TED process:\n    >     \n    >     **`[Expert@HostName:0]# tecli debug stat`**\n    > 15.  Stop the debug of the IN.EMAILD.MTA process:\n    >     \n    >     **`[Expert@HostName:0]# fw debug in.emaild.mta off TDERROR_ALL_ALL=0`**\n    > 16.  Add a mark to the log files:\n    >     \n    >     **`[Expert@HostName:0]# echo \"==debug_stop==\" >> $FWDIR/log/emaild.mta.elg`**  \n    >     **`[Expert@HostName:0]# echo \"==debug_stop==\" >> $FWDIR/log/ted.elg`**\n    > 17.  Collect these files from the Security Gateway:\n    >     \n    >     -   `/var/log/maillog`\n    >     -   `$FWDIR/log/emaild.mta.elg*`\n    >     -   `$FWDIR/log/ted.elg*`\n    >     -   `/var/log/kernel_debug.txt`\n    >     -   `/var/log/messages*`\n    >     -   all the relevant outputs\n    >     -   all the relevant screenshots\n    >     -   [CPinfo](https://support.checkpoint.com/results/sk/sk92739) file\n    >     \n    >     In addition, collect the [CPinfo](https://support.checkpoint.com/results/sk/sk92739) file from the Security Management Server / Domain Management Server that manages this Security Gateway","language":"md","time":"14 days ago","created":"2025-05-06T22:56:13.533Z","annotations":[],"updated":"2025-05-06T23:00:01.681Z"},{"title":"ProductMulti-Domain Security Management, Quantum Security Management","id":"6f9446c9-d9b0-4a54-b9a8-599517657e8c","type":"TEXT","raw":"ProductMulti-Domain Security Management, Quantum Security Management\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-04-22\n\n## Solution\n\n<table><tbody><tr><td><ul><li><strong></strong><p><strong>Introduction</strong></p></li><li><p><strong>High Level Flow</strong></p></li><li><p><strong>Downloads and Documentation</strong></p></li><li><p><strong>List of improvements per CDT version&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</strong></p></li></ul></td><td><ul><li><p><strong>FAQ</strong></p></li><li><p><strong>Known Limitations</strong></p></li><li><p><strong>Troubleshooting</strong></p></li><li><p><strong>Revision History</strong></p></li></ul></td></tr></tbody></table>\n\nClick Here to Show the Entire Article\n\n### Important: Effective April 22, 2025, Central Deployment Tool has been updated to v2.1.\n\n## Introduction\n\n**Central Deployment Tool (CDT)** is a utility that runs on Security Management Servers and Multi-Domain Security Management Servers running Gaia OS.  This utility lets you manage a deployment of software packages from your Management Server to the multiple managed Security gateways and cluster members at the same time:\n\n-   Installation of software packages\n-   Perform various actions - take snapshots, run shell scripts, push/pull files, etc.\n-   Automate the RMA backup and restore process\n\nCDT handles cluster upgrades automatically, including Connectivity Upgrade (CU).\n\n### Basic flow of using CDT\n\n![](https://sc1.checkpoint.com/sc//SolutionsStatics/sk122204/CDT-Flow1801170122.png)\n\n## High Level Flow\n\n**Workflow for upgrading a Security Gateway:**\n\n**  \nWorkflow for Upgrading Cluster Members in High Availability mode:**\n\n**  \nWorkflow for installing a Hotfix on a Security Gateway or Cluster:**\n\n## Downloads and Documentation \n\n_[Software Subscription or Active Support plan](https://www.checkpoint.com/support-services/support-plans/) is required to download this package._\n\n**Notes**:\n\n-   For CPUSE Online Identifier, use _Check\\_Point\\_CDT\\_Bundle\\_T<**Take Number**\\>\\_FULL.tgz_\n-   This CDT package does _not_ contain the RPM package of the CPUSE Agent.\n-   CDT files can be copied to other locations (as long as they all are copied to one place).\n-   **To check what CDT build you are using, run in the Expert mode:  \n    `$CDTDIR/CentralDeploymentTool -v`  \n    **\n\n**  \nInstallation Instructions:**\n\n**Documentation:**\n\n-   [Central Deployment Tool (CDT) Administration Guide](https://sc1.checkpoint.com/documents/CDT/Unified/Default.htm)\n-   For cloud clusters, refer to [sk181606 - CloudGuard Network Security Clusters solutions upgrade using Central Deployment Tool](https://support.checkpoint.com/results/sk/sk181606) \n\n**CDT versions and Management Server versions:**\n\n## List of improvements per CDT version\n\n## FAQ\n\nClick Here to Show the Entire FAQ\n\n1.  What is the impact CDT has on CPU usage and traffic bandwidth of the Management Server?  \n    \n2.  What user permissions on the Management Server do I need to run the CDT?  \n    \n3.  What will happen if the CDT is executed over an SSH connection and that connection is disconnected?  \n    \n4.  My maintenance window is short. How can CDT help me?  \n    \n5.  What manual actions should I take on the Management Server before / after running the CDT?  \n    \n6.  Why does the CDT query all the Network Objects in the database during the installation/preparation?  \n    \n7.  Does the Preparations/Extended Preparations mode cause connectivity loss on the Security Gateways?  \n    \n8.  After generating the Candidates List, CDT marked some of the Security Gateways as \"`N/A`\" in the \"`Upgrade order`\" column.  \n    Should I replace that value with a hyphen (\"`-`\")?  \n    \n9.  How can I execute a custom shell script on the Management Server before or after running the CDT?  \n    \n10.  Why does the CPUSE Agent on Security Gateways become unavailable/disabled for short periods of time during a CDT installation process?  \n    \n11.  Is it possible to run several CDT processes in parallel?  \n    \n12.  Is it possible to copy the package to the gateway manually to shorten CDT installation time?  \n    \n13.  Does CDT support VSX?  \n    \n14.  Is Fast Deployment (Blink) supported with CDT and VRRP Clusters?  \n    \n\n## Known Limitations\n\n## Troubleshooting\n\nClick Here to Show the Entire Section\n\n1.  Scenario 1: RMA restore fails on Multi-Domain Server with the \"_The backup file for Object: <name> does bot exist._\" error  \n    \n2.  Scenario 2: CDT leaves the following files on the Management Server: _CKP\\_mutex\\*, ICA\\_MDS\\*, sysFilecdt\\_\\*, RmaTool\\_<object\\_name>.xml\\_cdt.lock_  \n    \n3.  Scenario 3: The gateway did not boot up after running RMA restore  \n    \n4.  Scenario 4: CDT failed in _pull\\_file_ action due to wrong md5sum after pulling the file.  \n    \n5.  Scenario 5: Pull file action fails with \"_Error code 32_\" error message\n6.  Scenario 6: Error: \"_Member roles are not supported – installation is not allowed\"_  \n    \n7.  Scenario 7: \"_Error code XX_\" Message from CDT  \n    \n8.  Scenario 8: \"_Error code 39 - Package importation failed on the remote machine_\" Message from CDT during major upgrade to R80.10  \n    \n9.  Scenario 9: \"_Error code 50 - Package installation on the remote machine failed due to timeout_\" message from CDT during major upgrade to R80.10  \n    \n10.  Scenario 10: When CDT runs, it shows that the Candidates List file is invalid and should be regenerated\n11.  Scenario 11: Installation or preparations fail after CDT executes a user shell script on the Security Gateway.  \n    \n12.  Scenario 12: Problems with Candidates List generation occur due to the current licenses  \n    \n13.  Scenario 13: Importing and installation problems occur due to CPUSE requirements and limitations.  \n    \n14.  Scenario 14: Installation of a software package (Hotfix or upgrade) fails on one cluster member and succeeds on another.  \n    \n15.  Scenario 15: CDT does not perform the actions listed in a provided Deployment Plan file. Instead, it installs a single package.  \n    \n16.  Scenario 16: After RMA restore, Gaia Portal is not accessible on the Security Gateway.  \n    \n17.  Scenario 17: \"_Error code 22 - Error loading configurations from the configurations file_\" message from CDT.  \n    \n18.  Scenario 18: \"_Cannot run multiple, simultaneous instances of CentralDeploymentTool <for the same Domain Management Server>_\" after stopping a previous instant of CentralDeploymentTool with Ctrl + C  \n    \n19.  Scenario 19: _TDERROR_ messages from _CPRID_ appear in the active session of the Security Gateway while running CDT.  \n    \n20.  Scenario 20: RMA backup fails during the \"_save configuration_\" command due to Segmentation fault.  \n    \n21.  Scenario 21: ERROR: Cluster state of <member IP and name> is invalid. To fix it, refer to the CDT SK.  \n    \n22.  Scenario 22: Error code 81 - The firewall policy on the remote machine is invalid. Make sure that the policy on the machine is installed.  \n    \n23.  Scenario 23: \"Failed to generate candidates list\" error when using the \"execute\\_command\" action with CDT version 1.6 build 990180509.  \n    \n24.  Scenario 24: Error code 48 - Package installation on the remote machine failed due to timeout. Reboot the remote machine and try again.  \n    \n25.  Scenario 25: \"Error Code 85 – Error retrieving package information\" message during RMA Restore  \n    \n\n## Revision History\n\n## Article Properties\n\nOriginatorMahmod Sbehat\n\nTechnical ResourceBoaz Orshav\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2016-04-25\n\nLast Modified2025-04-22\n\nEditorStella Shteinbuk\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only\n\n**This SK should never be deleted - referenced in the code and Admin Guide**\n\nvalid for R82.10","language":"md","time":"14 days ago","created":"2025-05-06T22:56:10.454Z","annotations":[],"updated":"2025-05-06T22:58:33.248Z"},{"title":"ProductMulti-Domain Security Management, Quantum Security Management","id":"02f230a5-32af-4b1f-acfb-d0af0099ca23","type":"TEXT","raw":"ProductMulti-Domain Security Management, Quantum Security Management\n\nVersionR80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nLast Modified2025-01-22\n\n## Solution\n\n## Introduction\n\nCheck Point Updatable Objects are used for allowing or blocking network access (IP's/URL's) of known external services such as Office365 and Amazon Web Services.\n\nThis is performed dynamically and updated periodically from the service providers themselves, with no policy installation required.\n\nUpdatable Objects update occurs on first time initialization of the service or periodically (default: every hour).\n\n## Troubleshooting\n\nIf you receive an error message during an action, check the following:\n\n-   Internet connectivity - make sure there is connectivity to the Internet from the Security Management Server.\n-   Make sure HTTP and HTTPS are allowed in the policy.\n-   Proxy settings - configure proxy settings, if necessary.\n-   DNS servers - make sure DNS servers are configured properly (changing DNS configuration in Gaia OS requires a restart of Check Point services with the \"cpstop ; cpstart\" commands).\n-   Insufficient access permissions to the Internet\\\\Proxy.\n-   Downloading content from Check Point is not allowed (see [sk111080](https://support.checkpoint.com/results/sk/sk111080)).\n\n  \n**An \"_Update failed_\" warning message appears in the Updatable Objects picker window.**\n\nThe Security Management Server uses Check Point Download Center to download and update Updatable Objects packages. This requires Internet connectivity.\n\nCheck these items on the Management Server (in the Expert mode):\n\n1.  Ping the Check Point server:  \n    `ping updates.checkpoint.com`   \n    Your server must resolve this hostname.  \n    You might not get a reply. It is OK.\n2.  If there is no DNS resolving, check the DNS server configuration and connectivity to the DNS server.\n3.  Check the connectivity to the Check Point server:  \n    `curl_cli --cacert $CPDIR/conf/ca-bundle.crt https://updates.checkpoint.com/WebService/services/DownloadMetaDataService?wsdl`\n4.  Check that a proxy server is configured, if needed.\n\nIf the problem persists, [contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/) with log files, as specified below.\n\n##   \nLog Files\n\nThese logs files contain information about the download process:\n\n**FWM Logs**\n\nPackage download (Download Center) logs. You can find these logs in:\n\n-   **Single Domain Server:** _$MDS\\_FWDIR/log/fwm.elg_\n-   **Multi-Domain Server:** _$MDS\\_FWDIR/log/mds.elg_\n\n### **Enabling extended logs for Updatable Objects**\n\nFor additional information, see [sk97638](https://support.checkpoint.com/results/sk/sk97638).\n\n<table><tbody><tr><td>Category</td><td>To Start Debug</td><td>To Stop Debug</td><td>Log Files</td></tr><tr><td>Updatable Objects process in FWM (Single Domain Server)</td><td><code>fw debug fwm on TDERROR_ALL_OSAU=5</code></td><td><code>fw debug fwm off TDERROR_ALL_ALL=0</code></td><td><code>$FWDIR/log/fwm.elg*</code></td></tr><tr><td>Updatable Objects process in MDS (Multi-Domain Server)</td><td><code>fw debug mds on TDERROR_ALL_OSAU=5</code></td><td><code>fw debug mds off TDERROR_ALL_ALL=0</code></td><td><code>$MDS_TEMPLATE/log/mds.elg*</code></td></tr><tr><td>FDT logs (Single Domain Server)</td><td><code>fw debug fwm on TDERROR_ALL_FDT=5</code></td><td><code>fw debug fwm off TDERROR_ALL_ALL=0</code></td><td><code>$FWDIR/log/fwm.elg*</code></td></tr><tr><td>FDT logs (Multi-Domain Server)</td><td><code>fw debug mds on TDERROR_ALL_FDT=5</code></td><td><code>fw debug mds off TDERROR_ALL_ALL=0</code></td><td><code>$MDS_TEMPLATE/log/mds.elg*</code></td></tr><tr><td>CPM debug for online services</td><td><code>$MDS_FWDIR/scripts/cpm_debug.sh -t Online_Services -s DEBUG</code></td><td><ol><li><code>$MDS_FWDIR/scripts/cpm_debug.sh -t Online_Services -s INFO</code></li><li><code>fw debug mds off TDERROR_ALL_ALL=0</code></li></ol></td><td><code>$FWDIR/log/cpm.elg*</code></td></tr></tbody></table>\n\n**Note -** Updatable Objects are not supported by the HTTPS Inspection policy in R80.20.\n\n## Additional Information\n\nCloudGuard Controller Updatable Objects use CloudGuard to automatically update the Security Management Server.\n\nThe CloudGuard log file: `$MDS_FWDIR/log/cloud_proxy.elg` \n\nProxy settings are saved in this file: `_$CPDIR/tmp/umis_objects.C_`  \nNote - On a Multi-Domain Server, go to the content of the relevant Domain.\n\nThe log level are configured in this file: `$VSECDIR/lib/log4j.properties`\n\nThese entries are Online Services specific:\n\n-   `log4j.logger.com.cp.online_services_scanner` - Updatable Objects main scanner package.\n-   `log4j.logger.com.cp.cms_proxy.CMS.onlineServices` - Package file parser and creation of intermediate objects to be used in the scanner.\n\nRun this command in the Expert mode to check last update status:  \n`psql_client cpm postgres -c \"select * from onlineservicespackagestatus;\"`\n\nExample (copy from this article and paste into a plain-text editor):\n\n> `psql_client cpm postgres -c \"select * from onlineservicespackagestatus;\"`\n> \n> `objid                                 | checkpointobjid | color | comments | customfields | displayname | dlesession | domainid                             | downloaddomain | featurespreset | folder                               | fwmcheckstatus | icon              | lastcheckdate           | lastcheckmessage    | lastdownloaddate        | lastrevision | name | permissionpr imitivepresetid          | readprimitiveid                      | tags                     | creationtime            | creator | deletable | lastmodifier | lastmodifytime          | newobject | renameable | validationstate   --------------------------------------+-----------------+-------+----------+--------------+-------------+------------+--------------------------------------+----------------+----------------+--------------------------------------+----------------+-------------------+-------------------------+---------------------+-------------------------+--------------+------+---------------------------------------+--------------------------------------+--------------------------+-------------------------+---------+-----------+--------------+-------------------------+-----------+- -----------+-----------------   c5a229c0-9edf-4409-aa0c-405ab358d0f7  |                 | BLACK |          |              |             | 0          | a0eebc99-afed-4ef8-bb6d-fedfedfedfed |                |                | a3a104fc-3987-4d22-9bf1-3fdbec0af39e | 2              | General/globalsNa | 2019-05-03 03:00:33.736 | Update check failed | 2019-02-27 16:25:09.356 | 270219160034 |      | 9f251382-3ecc-39 45-a568-f5cb417ab65f | 32565dd2-1954-42e6-99c2-e42fae141000 | [\"java.util.HashSet\",[]] | 2019-02-27 16:24:49.933 | System  | t         | System       | 2019-05-03 03:00:33.739 | f         | t          | 0 (1 row)`\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorRoi Caspy\n\nTechnical ResourceAmiad Stern\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2018-04-24\n\nLast Modified2025-01-22\n\nEditorRonit Segal\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only\n\n**SK SHOULD NOT BE DELETED - referenced in SmartConsole**\n\n**This SK applies to R82.10 as well**\n\nFrom: Lior Tamim  \nSent: Monday, January 28, 2019 17:28  \nTo: Tamir Shriki; Micky Michaeli  \nCc: Rajai Aweidah; Amir Yacoby; Meital Natanson  \nSubject: RE: R80.20 Office365 objects in the https policy\n\nYes, this limitation is true, updatable objects are not supported in HTTPS Inspection policy in R80.20.\n\nYou need to open RFE to get this ability.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:13.992Z","annotations":[],"updated":"2025-05-06T22:59:10.700Z"},{"title":"ProductAnti-Spam, Threat Emulation, Threat Extraction","id":"de54e340-89ec-4108-be10-366940f6463f","type":"TEXT","raw":"ProductAnti-Spam, Threat Emulation, Threat Extraction\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2024-10-27\n\n## Solution\n\n**Table of Contents:**\n\n1.  Introduction\n    \n2.  Configuration\n    \n3.  Limitations\n    \n4.  Postfix\n    \n5.  E-mail flow in MTA\n    \n6.  Control intervals and thresholds for MTA logs\n    \n7.  CPview integration (Monitoring Threat-Emulation MTA related statistics)\n    \n8.  Troubleshooting\n    \n9.  Related documentation\n    \n10.  Related solutions\n    \n11.  Revision history\n    \n\n### (1) Introduction\n\nMail Transfer Agent (MTA) can be enabled on the Security Gateway to manage the emulation of SMTP traffic.\n\nIt is possible that during file emulation, the e-mail server cannot keep the connection open for the time that is necessary for full emulation. When this happens, there is a timeout for the e-mail. A Threat Emulation deployment with an MTA avoids this problem - the MTA completes and closes the connection with the source e-mail server and then sends the file for emulation. After the emulation is complete, the MTA sends the e-mail to the mail server on the internal network.\n\nMTA deployment has various advantages:\n\n-   Decryption of TLS traffic - Threat Emulation must use an MTA to decrypt e-mails for emulation.\n-   Prevention of e-mail traffic - It is recommended to use Threat Emulation profile settings that prevent SMTP traffic. It is possible that during file emulation, the e-mail server cannot keep the connection open for the time that is necessary for full emulation. When this happens, there is a timeout for the e-mail, and 'Fail Mode' would be used.\n-   Removal of malicious attachments - When Threat Emulation identifies that an e-mail attachment is malicious, the MTA removes the attachment and sends the safe e-mail.\n\n### (2) Configuration\n\nThis section describes how to configure MTA for Threat Emulation.\n\n1.  Configure the Security Gateway as an MTA:\n    \n    1.  Connect with SmartDashboard to Security Management Server / Domain Management Server.\n        \n    2.  Double-click on the Security Gateway object.\n        \n    3.  Click on the _**Mail Transfer Agent**_ pane - check the box _**Enable as a Mail Transfer Agent (MTA)**_.\n        \n        _Example_:\n        \n        ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/Enable%20as%20a%20Mail%20Transfer%20Agent.png)\n    4.  In the _**Mail Forwarding**_ section, add one or more rules:\n        \n        1.  Click on the add rule button.\n            \n            ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/Add%20rule.png)\n        2.  Right-click the _**Domain**_ cell - select _**Edit...**_\n            \n            ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/Edit%20rule.png)\n        3.  Enter the domain for the SMTP traffic for this rule (accepting all traffic by default). Add a rule with a wildcard (\"\\*\") as the domain to configure the Next Hop for all emails destined for non-configured domains. A common usage for a wildcard rule is to control bounced emails sent back to the original email sender. \n            \n        4.  Click on OK.\n            \n        5.  Left-click in the _**Next Hop**_ cell - select the node object that represents the mail server for this rule.\n            \n            _Example_:\n            \n            [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/Next%20Hop.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/Next%20Hop.png \"Click the image to see it in full size in a new tab/window\")\n    5.  **Optional**: Check the box _**Sign scanned e-mails**_ and enter the message to add to each e-mail when emulation is finished.\n        \n    6.  In the _**SMTP/TLS**_ section, configure the MTA to support TLS inspection:\n        \n        1.  In **Step 1**, click on _**Import certificate for SMTP/TLS**_ link. (**Important Note**: The imported certificate should be a trusted certificate.)\n            \n        2.  Click on _**Browse**_ - select the certificate file.\n            \n        3.  Enter the Private Key password for the certificate.\n            \n        4.  Click on OK.\n            \n        5.  In **Step 2**, check the box _**Enable SMTP/TLS**_. \n            \n    7.  Click on OK to close Security Gateway properties.\n        \n    8.  Install the policy.\n        \n2.  Configure the network to forward e-mails to the MTA:\n    \n    After configuring the Security Gateway as an MTA, there are 3 options to configure it in the existing topology.  \n    Choose the correct option according to the topology of the organization and the security needs.\n    \n    -   **Check Point MTA as the organization MX record**\n        \n        > Each organization has an MX record that points to the internal mail server, or to a different MTA.  \n        > The MX record defines the next hop for SMTP traffic that is sent to the organization.\n        > \n        > In this configuration, the MTA receives all e-mails directed to the organization and sends them to the internal mail server.\n        > \n        > After configuring the Security Gateway as an MTA, change the settings to send SMTP traffic from external networks to the Security Gateway.\n        > \n        > **Important Note:** If it is necessary to disable the MTA on the Security Gateway, then _first_ change the SMTP settings or MX records. Failure to do so can result in lost e-mails.\n        > \n        > To configure an MTA for e-mail that is sent to the internal mail server:\n        > \n        > 1.  Edit the DNS settings for the network.\n        >     \n        > 2.  Change the MX records and define the Security Gateway as the next hop.\n        >     \n        > \n        > Traffic flow and logical topology:\n        \n    -   **Check Point MTA as an internal MTA**\n        \n        > The MTA receives e-mails from a preliminary MTA and sends them to the next hop, usually the internal mail server.\n        > \n        > If there is an existing MTA used as the preliminary MTA (e.g., as an Anti-Spam solution), then this configuration will suit the best.\n        > \n        > To configure an MTA for e-mail that is sent to a different MTA:\n        > \n        > 1.  Edit the SMTP settings on the MTA that sends e-mails to the internal mail server.\n        >     \n        > 2.  Change the SMTP settings and define the Security Gateway as the next hop.\n        >     \n        > \n        > Traffic flow and logical topology:\n        > \n        > [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/CP%20MTA%20as%20internal%20MTA.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/CP%20MTA%20as%20internal%20MTA.png \"Click the image to see it in full size in a new tab/window\")\n        \n    -   **Check Point MTA in BCC Mode**\n        \n        > The MTA can be used for monitoring the SMTP traffic. Configure the MTA to send e-mails only for emulation, but not to forward them to the mail server.\n        > \n        > **Note:** Make sure that the mail relay in the network can send a copy of the e-mails to the Check Point MTA.\n        > \n        > To configure the MTA not to forward e-mails:\n        > \n        > 1.  Double-click on the Security Gateway object.\n        >     \n        > 2.  Click on the _**Mail Transfer Agent**_ pane.\n        >     \n        > 3.  Delete all Mail Forwarding rules (right-click on each rule - go to _**Rule Actions**_ menu - click on _**Delete Rule**_ - confirm)\n        >     \n        > 4.  Create a new rule:\n        >     \n        >     -   _**Domain**_ cell - leave the default asterisk (**\\***)\n        >         \n        >     -   _**Next Hop**_ cell - left-click in the cell - click on _**New...**_ button - assign a desired name (e.g., _No\\_Forward_) - assign IPv4 address _**0.0.0.0**_ - click on OK\n        >         \n        >     \n        >     [![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/No%20Forward%20Rule.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/No%20Forward%20Rule.png \"Click the image to see it in full size in a new tab/window\")\n        > 5.  Click on OK.\n        >     \n        > 6.  Install the policy.\n        >     \n        \n\n### (3) Limitations\n\n-   **Threat Prevention rule base**\n    \n    The Threat Prevention rule that is matched for the MTA will be the first rule with “Any” source, that matched the IP address of the MTA in its _Protected Scope / Destination_ column (“Any” will also match).\n    \n    Notes:\n    \n    -   The match is static, and the MTA will use the same rule for all e-mails.\n    -   The matched rule must include Threat Emulation/Threat Extraction inspection. Otherwise, the attachments will not be scanned.\n    -   The MTA rule must be rule 1 in the Threat Prevention ruleset. \n-   **Single certificate**\n    \n    There is no option to use multiple certificates for different mail servers.\n    \n-   **Anti-Virus over MTA**\n    \n    Anti-Virus is supported on MTA in R80.10 and R80.20 with the latest engine update. Refer to [sk123174](https://supportcenter.checkpoint.com/supportcenter/portal?action=portlets.SearchResultMainAction&eventSubmit_doGoviewsolutiondetails=&solutionid=sk123174) to see if your Take supports Anti-Virus. \n    \n-   **Dynamically resolved next hop for the MTA**\n    \n    By default, in versions R80 and lower, there is no option to dynamically resolve the next hop for redundancy/load sharing.  \n    The next hop should be a host with a static IP address.\n    \n    Refer to [sk110369 - How to configure load balancing / high availability based on the DNS configuration for Mail Transfer Agent (MTA)](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk110369) .\n-   **Anti-Spam over MTA**\n    \n    MTA can function as an Anti-Spam starting in [R77.10](http://supportcontent.checkpoint.com/solutions?id=sk97617) - Check Point Security Gateway takes the role of the Exchange Server, and, therefore, is able to decrypt the encrypted e-mails.  \n    For performance reasons, it is recommended to use _different_ Security Gateways - one as _MTA for Anti-Spam_ and another as _MTA for Threat Emulation and Extraction_.  \n    MTA is used by Threat Emulation and Threat Extraction blades for TLS decryption, better threat prevention, etc.\n    \n    Related solution: [sk105482 - Some spam e-mails pass through the Security Gateway even when the Anti-Spam blade is enabled](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk105482).\n    \n-   **MTA over cluster deployment**\n    \n    Do not select Cluster Virtual Interface(s) in MTA \"_Advanced Settings_\" (when clicking on \"_Configure Settings..._\" button - in \"_Select on which interfaces to listen_\" section, selecting \"_Use specific_\").  \n    Refer to [sk107093 - E-mails do not reach the client after selecting Cluster Virtual Interface(s) in MTA \"Advanced Settings\"](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk107093).\n    \n\n### (4) Postfix\n\n[Postfix](https://support.checkpoint.com/results/sk/www.postfix.org) is an open source mail server that is used by Check Point software to route and deliver e-mails in the MTA implementation.\n\nPostfix is configured using two main configuration files:\n\nNote: Both files are generated on Security Gateway during policy installation by the process _in.emaild.mta_.\n\n-   _/opt/postfix/etc/postfix/master.cf_\n    \n    This file configures the communication between Postfix processes and Check Point processes, ports, protocols, and so on.  \n    This file should _**not**_ be changed.\n    \n-   _/opt/postfix/etc/postfix/main.cf_\n    \n    Administrator must be fully aware of implications resulting from manual configuration of Postfix (refer to [http://www.postfix.org/postconf.5.html](http://www.postfix.org/postconf.5.html)).  \n    Related solution: [sk101870 - How to change Postfix configuration for Threat Emulation MTA](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk101870)\n-   Important note regarding _main.cf_: _main.cf_ is not editable, as it will be overwritten on policy install. Use this procedure:\n    -   From the Security Gateway CLI, create the file: t_ouch $FWDIR/conf/mta\\_postfix\\_options.cf_\n    -   Edit the file and add the definitions.\n    -   Save the file.\n    -   Install the Threat Prevention policy.\n\n###   \n(5) E-mail flow in MTA\n\n1.  An e-mail is sent to the MTA on Security Gateway to TCP port 25. (Port 25 is no longer the the only supported port, see [sk142932](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk142932)).\n    \n2.  Postfix on Security Gateway receives all e-mails (clear and encrypted) and responds to the sender.\n    \n3.  Postfix on Security Gateway decrypts the e-mail (if needed) and saves on the incoming queue (marked as _PF<sup>1</sup>_ on the diagram below).\n    \n4.  The _in.emaild.mta_ process is configured to be Postfix content filter.  \n    Each e-mail is sent by Postfix to _in.emaild.mta_ process to TCP port 10025.  \n    The e-mail is parsed by the MIME parser and the attachments (if any) are sent to Threat Emulation Daemon _ted_ for emulations.\n    \n\nNote: All e-mails are handled by Postfix - regardless whether they contain attachments, or not.\n\nE-mail flow through the MTA components:\n\n[![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/Flow%20Diagram%201.png)](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/Flow%20Diagram%201.png \"Click the image to see it in full size in a new tab/window\")\n\n### (6) Control intervals and thresholds for MTA logs\n\nAdministrator can configure the desired intervals and thresholds for logs from the Mail Transfer Agent (MTA) when processing e-mails. This will allow to generate logs in the following cases:\n\n-   too many e-mails are waiting to be processed\n-   e-mails are being delayed\n-   e-mails are deferred\n-   e-mails are bounced\n\n**Note:** This feature (ID 02009776) is available only in the following Security Gateways:\n\n-   R77.30 with _Take\\_221_ and higher of [R77.30 Jumbo Hotfix Accumulator](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk106162)\n-   R80.10 and higer\n\nThe configuration is performed on the Security Gateway configured as Mail Transfer Agent (MTA) in the _**$FWDIR/conf/mail\\_security\\_config**_ file by setting the desired values for the corresponding parameters (described below).\n\n**Important Notes:**\n\n-   Before any change - Backup the current file\n-   After any change in the file - it is mandatory to restart Check Point services with the \"`cpstop ; cpstart`\" commands.  \n    Note: In cluster, this will cause a fail-over.\n-   In cluster environment, the procedure must be performed on _all_ members of the cluster.\n\nThe following tables provide the description of the most relevant configuration parameters.\n\n**Configuring log intervals:**\n\nNote: These parameters are located in the _$FWDIR/conf/mail\\_security\\_config_ file in the \"`[mta_log_alerts]`\" section - under the comment \"`#Log alerts intervals`\".\n\n<table><tbody><tr><td>Parameter</td><td>Description</td><td>Default value</td></tr><tr><td><code>queues_check_interval</code></td><td>Controls how often to check the incoming e-mails in Postfix queues. These checks might result in the new System Alert logs from Mail Transfer Agent (MTA) being displayed in SmartView Tracker / SmartLog.</td><td>8<br>minutes</td></tr><tr><td><code>alerts_mode_queues_check_interval</code></td><td>Controls how long to wait from the time of sending one of the MTA System Alert logs until the next check of the incoming e-mails in Postfix queues.</td><td>14<br>minutes</td></tr></tbody></table>\n\n**Configuring log thresholds:**\n\nNote: These parameters are located in the _$FWDIR/conf/mail\\_security\\_config_ file in the \"`[mta_log_alerts]`\" section - under the comment \"`#Log alerts thresholds`\".\n\n<table><tbody><tr><td>Parameter</td><td>Description</td><td>Default value</td><td>Notes</td></tr><tr><td><code>num_of_waiting_mails_low_svr_th</code></td><td><p>Controls the minimal number of e-mails that are waiting to be processed - if at least this number of e-mails are waiting, then a corresponding System Alert log is generated with Severity \"<em>Low</em>\".</p><p>Example of a System Alert log with Severity \"<em>Low</em>\" when e-mails are waiting to be processed:</p><ul><li><p>From R8x SmartLog after setting the value of 4:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Amount_Alert1703270814.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Amount_Alert1703270814.png\" alt=\"\" width=\"20%\"></a></li><li><p>From R77.x SmartView Tracker after setting the value of 5:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Amount_Alert1703270814.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Amount_Alert1703270814.png\" alt=\"\" width=\"20%\"></a></li></ul></td><td>250<br>e-mails</td><td><ul><li><p>System Alert log will be generated with Severity \"<em>Low</em>\" as long as the number of e-mails that are waiting to be processed is between this value and the value of next threshold parameter \"<code>num_of_waiting_mails_med_svr_th</code>\".</p></li><li><p>If the number of e-mails that are waiting to be processed decreases below the value of this parameter, then a Control log is generated (\"relax\" message).</p><p>Example of a log when there are no more e-mails waiting to be processed:</p><ul><li><p>From R8x SmartLog:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Amount_Relax1703270812.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Amount_Relax1703270812.png\" alt=\"\" width=\"20%\"></a></li><li><p>From R77.x SmartView Tracker:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Amount_Relax1703270811.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Amount_Relax1703270811.png\" alt=\"\" width=\"20%\"></a></li></ul></li></ul></td></tr><tr><td><code>num_of_waiting_mails_med_svr_th</code></td><td>Controls the minimal number of e-mails that are waiting to be processed - if at least this number of e-mails are waiting, then a corresponding System Alert log is generated with Severity \"<em>Medium</em>\".</td><td>500<br>e-mails</td><td>System Alert log will be generated with Severity \"<em>Medium</em>\" as long as the number of e-mails that are waiting to be processed is between the value of this parameter and the value of next threshold parameter \"<code>num_of_waiting_mails_hgh_svr_th</code>\".</td></tr><tr><td><code>num_of_waiting_mails_hgh_svr_th</code></td><td>Controls the minimal number of e-mails that are waiting to be processed - if at least this number of e-mails are waiting, then a corresponding System Alert log is generated with Severity \"<em>High</em>\".</td><td>1000<br>e-mails</td><td>System Alert log will be generated with Severity \"<em>High</em>\" as long as the number of e-mails that are waiting to be processed is between this value and any larger number.</td></tr><tr><td><code>delay_time_low_svr_th</code></td><td><p>Controls how long to wait from the time of receiving at least one e-mail before generating a System Alert log with Severity \"<em>Low</em>\" about a delay in the mails queue (e-mails are waiting to be processed).</p><p>Example of a System Alert log with Severity \"<em>Low</em>\" when there is a delay in mails queue:</p><ul><li><p>From R8x SmartLog after setting the value of 5:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Delay_Alert1703270808.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Delay_Alert1703270808.png\" alt=\"\" width=\"20%\"></a></li><li><p>From R77.x SmartView Tracker after setting the value of 6:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Delay_Alert1703270807.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Delay_Alert1703270807.png\" alt=\"\" width=\"20%\"></a></li></ul></td><td>10<br>minutes</td><td><ul><li><p>System Alert log will be generated with Severity \"<em>Low</em>\" as long as the waiting time is between this value and the value of next threshold parameter \"<code>delay_time_med_svr_th</code>\".</p></li><li><p>If the waiting time decreases below the value of this parameter, then a Control log is generated (\"relax\" message).</p><p>Example of a log when there is no more delay in mails queue:</p><ul><li><p>From R8x SmartLog:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Delay_Relax1703270806.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Delay_Relax1703270806.png\" alt=\"\" width=\"20%\"></a></li><li><p>From R77.x SmartView Tracker:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Delay_Relax1703270806.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Delay_Relax1703270806.png\" alt=\"\" width=\"20%\"></a></li></ul></li></ul></td></tr><tr><td><code>delay_time_med_svr_th</code></td><td>Controls how long to wait from the time of receiving at least one e-mail before generating a System Alert log with Severity \"<em>Medium</em>\" about a delay in the mails queue (e-mails are waiting to be processed).</td><td>15<br>minutes</td><td>System Alert log will be generated with Severity \"<em>Medium</em>\" as long as the waiting time is between this value and the value of next threshold parameter \"<code>delay_time_hgh_svr_th</code>\".</td></tr><tr><td><code>delay_time_hgh_svr_th</code></td><td>Controls how long to wait from the time of receiving at least one e-mail before generating a System Alert log with Severity \"<em>High</em>\" about a delay in the mails queue (e-mails are waiting to be processed).</td><td>20<br>minutes</td><td>System Alert log will be generated with Severity \"<em>High</em>\" as long as the waiting time is between this value and any larger number.</td></tr><tr><td><code>num_of_deferred_mails_low_svr_th</code></td><td><p>Controls how many e-mails should be determined by Postfix as Deferred before generating a System Alert log with Severity \"<em>Low</em>\" about deferred mails.</p><p>Example of a System Alert log with Severity \"<em>Low</em>\" when there are deferred mails:</p><ul><li><p>From R8x SmartLog:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Deferred_Alert1703270804.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Deferred_Alert1703270804.png\" alt=\"\" width=\"20%\"></a></li><li><p>From R77.x SmartView Tracker:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Deferred_Alert1703270804.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Deferred_Alert1703270804.png\" alt=\"\" width=\"20%\"></a></li></ul></td><td>1<br>e-mail</td><td><ul><li><p>System Alert log will be generated with Severity \"<em>Low</em>\" as the number of deferred e-mails is between this value and the value of next threshold parameter \"<code>num_of_deferred_mails_med_svr_th</code>\".</p></li><li><p>If the number of deferred e-mails decreases below the value of this parameter, then a Control log is generated (\"relax\" message).</p><p>Example of a log when there are no more deferred mails:</p><ul><li><p>From R8x SmartLog:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Deferred_Relax1703270802.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Deferred_Relax1703270802.png\" alt=\"\" width=\"20%\"></a></li><li><p>From R77.x SmartView Tracker:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Deferred_Relax1703270801.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Deferred_Relax1703270801.png\" alt=\"\" width=\"20%\"></a></li></ul></li></ul></td></tr><tr><td><code>num_of_deferred_mails_med_svr_th</code></td><td>Controls how many e-mails should be determined by Postfix as Deferred before generating a System Alert log with Severity \"<em>Medium</em>\" about deferred mails.</td><td>10<br>e-mails</td><td>System Alert log will be generated with Severity \"<em>Medium</em>\" as long as the number of deferred e-mails is between this value and the value of next threshold parameter \"<code>num_of_deferred_mails_hgh_svr_th</code>\".</td></tr><tr><td><code>num_of_deferred_mails_hgh_svr_th</code></td><td>Controls how many e-mails should be determined by Postfix as Deferred before generating a System Alert log with Severity \"<em>High</em>\" about deferred mails.</td><td>50<br>e-mails</td><td>System Alert log will be generated with Severity \"<em>High</em>\" as long as the number of deferred e-mails is between this value and any larger number.</td></tr><tr><td><code>num_of_bounced_mails_low_svr_th</code></td><td><p>Controls how many e-mails should be determined by Postfix as Bounced before generating a System Alert log with Severity \"<em>Low</em>\" about bounced mails.</p><p>Example of a System Alert log with Severity \"<em>Low</em>\" when there are bounced mails:</p><ul><li><p>From R8x SmartLog:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Bounce_Alert1703270759.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Bounce_Alert1703270759.png\" alt=\"\" width=\"20%\"></a></li><li><p>From R77.x SmartView Tracker:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Bounce_Alert1703270758.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Bounce_Alert1703270758.png\" alt=\"\" width=\"20%\"></a></li></ul></td><td>1<br>e-mail</td><td><ul><li><p>System Alert log will be generated with Severity \"<em>Low</em>\" as the number of bounced e-mails is between this value and the value of next threshold parameter \"<code>num_of_bounced_mails_med_svr_th</code>\".</p></li><li><p>If the number of bounced e-mails decreases below the value of this parameter, then a Control log is generated (\"relax\" message).</p><p>Example of a log when there are no more bounced mails:</p><ul><li><p>From R8x SmartLog:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Bounce_Relax1703270756.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R80_Bounce_Relax1703270756.png\" alt=\"\" width=\"20%\"></a></li><li><p>From R77.x SmartView Tracker:</p><a title=\"Click the image to see it in full size in a new tab/window\" href=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Bounce_Relax1703270755.png\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/R77_Bounce_Relax1703270755.png\" alt=\"\" width=\"20%\"></a></li></ul></li></ul></td></tr><tr><td><code>num_of_bounced_mails_med_svr_th</code></td><td>Controls how many e-mails should be determined by Postfix as Bounced before generating a System Alert log with Severity \"<em>Medium</em>\" about deferred mails.</td><td>10<br>e-mails</td><td>System Alert log will be generated with Severity \"<em>Medium</em>\" as long as the number of bounced e-mails is between this value and the value of next threshold parameter \"<code>num_of_bounced_mails_hgh_svr_th</code>\".</td></tr><tr><td><code>num_of_bounced_mails_hgh_svr_th</code></td><td>Controls how many e-mails should be determined by Postfix as Bounced before generating a System Alert log with Severity \"<em>High</em>\" about deferred mails.</td><td>50<br>e-mails</td><td>System Alert log will be generated with Severity \"<em>High</em>\" as long as the number of bounced e-mails is between this value and any larger number.</td></tr></tbody></table>\n\n**(7) Mail Transfer Agent (MTA) - CPview integration (Monitoring Threat-Emulation MTA related statistics)**\n\nThis feature reflects MTA internal statistics via the CPview utility.  \n\nUnder _CPVIEW.Software-blades.Threat-Emulation_, a new MTA tab has been added. This tab contains 2 sections:\n\n**1\\. Queues Section:**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/queues17062500131804012352.PNG)\n\n-   Active Queue - Number of emails currently waiting in MTA queue.\n-   Deferred Queue - Number of emails temporarily failed. Those emails need to be retried to be processed.\n-   Emaild Queue - Number of emails currently being processed by MTA.\n\n**2\\. Monitoring Section**\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk109699/monitoring17062500131804012354.PNG)\n\n-   Mails Received - Number of emails received by MTA\n-   Mails With TE Supported Attachments - Number of emails that contain at least one Threat-Emulation supported attachment\n-   Mails Processed - Number of emails that have completed MTA processing\n-   Mails Limits Exceeded - Number of emails that failed due to timeout or exceeded disk quota\n-   Mails Modified - Number of emails that contain attachments that were stripped by Threat-Emulation\n-   Mails Deferred - Number of emails temporarily failed\n-   Mails Blocked - Number of emails prevented\n-   Mails Skipped Due To Excluded Recipients - Number of emails excluded from scanning as all their recipients are in the excluded list\n-   Mails Skipped Due To Excluded Sender - Number of emails excluded from scanning as their sender is in the excluded list\n-   Mails With TE Failures - Number of emails that encountered TE failure during their processing\n-   Mails With MTA Failures - Number of emails that encountered MTA failure during their processing\n\nNote: All the counters listed display the amount of emails in the last x seconds, where x is the CPView refresh interval (two seconds by default). To change the CPView refresh interval, under CPview, press the \"r\" key and enter the desired interval in seconds.\n\n### (8) Troubleshooting\n\n-   **Postfix log file:**\n    \n    _/var/log/maillog_\n-   **How to monitor and manage Postfix queue:**\n    \n    Refer to relevant manual pages listed in the \"Related documentation\" section.\n    \n    <table><tbody><tr><td>Action</td><td>Command</td></tr><tr><td>Show current queue</td><td><em>[Expert@HostName:0]# /opt/postfix/usr/sbin/postqueue -c /opt/postfix/etc/postfix/ -p</em></td></tr><tr><td>Show one mail from queue:<br>(5632E28B0044 is an example<br>Queue ID from the current queue)</td><td><em>[Expert@HostName:0]# /opt/postfix/usr/sbin/postcat -c /opt/postfix/etc/postfix/ -q 5632E28B0044 | less</em></td></tr><tr><td>Attempt immediate delivery of queue content</td><td><em>[Expert@HostName:0]# /opt/postfix/usr/sbin/postqueue -c /opt/postfix/etc/postfix/ -f</em></td></tr><tr><td>Delete one message from queue:<br>(5632E28B0044 is an example<br>Queue ID from the current queue)</td><td><em>[Expert@HostName:0]# /opt/postfix/usr/sbin/postsuper -c /opt/postfix/etc/postfix/ -d 5632E28B0044</em></td></tr><tr><td>Delete all messages in queue</td><td><em>[Expert@HostName:0]# /opt/postfix/usr/sbin/postsuper -c /opt/postfix/etc/postfix/ -d ALL</em></td></tr><tr><td>Show postfix configuration</td><td><em>[Expert@HostName:0]# /opt/postfix/usr/sbin/postconf -c /opt/postfix/etc/postfix/</em></td></tr><tr><td>Get postfix version</td><td><em>[Expert@HostName:0]# /opt/postfix/usr/sbin/postconf -c /opt/postfix/etc/postfix/ | grep mail_version</em></td></tr><tr><td>Restart postfix</td><td><em>[Expert@HostName:0]# /opt/postfix/usr/sbin/postfix -c /opt/postfix/etc/postfix reload</em></td></tr></tbody></table>\n    \n-   **E-mail is stuck in Postfix queue:**\n    \n    Example of an e-mail being stuck in postfix queue:\n    \n    > ```\n    > [Expert@HostName:0]# <em>/opt/postfix/usr/sbin/postqueue -c /opt/postfix/etc/postfix/ -p</em><br>-Queue ID- --Size-- ----Arrival Time---- Sender/Recepient-------<br>28EC212002E 4528659 Mon Dec 28 16:37:29 sender.example@domain.example.com<br>(connect to 127.0.0.1[127.0.0.1]: Connection refused)<br>recepient.example@domain.example.com\n    > ```\n    \n    Possible reasons for an e-mail being stuck in the queue:\n    \n    <table><tbody><tr><td>Reason</td><td>Status in postfix queue</td></tr><tr><td>The e-mail was received by <em>in.emaild.mta</em> process,<br>but there was an error during the inspection of the e-mail.<br>As a result, the e-mail was categorized as deferred by postfix.</td><td><em><code>451 Temporary failure, please try again later</code></em></td></tr><tr><td>The e-mail was not delivered to the content-filter (<em>in.emaild.mta</em>).<br>This is usually a result of high load.</td><td><em><code>(delivery temporarily suspended: lost connection with 127.0.0.1[127.0.0.1] while sending end of data -- message may be sent more than once)<br>(mail transport unavailable)<br>(connect to 127.0.0.1[127.0.0.1]: Connection refused)</code></em></td></tr></tbody></table>\n    \n-   **Latency in e-mail deliveries:**\n    \n    Suggested action plan:\n    \n    1.  Locate the e-mail in postfix queue (according to recipient):\n        \n        _\\[Expert@HostName:0\\]# /opt/postfix/usr/sbin/postqueue -c /opt/postfix/etc/postfix/ -p_\n    2.  Monitor the postfix queue and try to find a reason for the delay from the postfix queue\n        \n        _\\[Expert@HostName:0\\]# /opt/postfix/usr/sbin/postcat -c /opt/postfix/etc/postfix/ -q <Relevant\\_Queue\\_ID>_\n    3.  Locate the e-mail in _in.emaild.mta_ process:\n        \n        1.  Start the relevant debugs:\n            \n            _\\[Expert@HostName:0\\]# fw debug in.emaild.mta on TDERROR\\_ALL\\_MAIL\\_SECURITY=5_  \n            _\\[Expert@HostName:0\\]# tecli debug set TE all TE\\_IS all TE\\_CLOUD all_\n        2.  Resend the problematic e-mail:\n            \n            _\\[Expert@HostName:0\\]# /opt/postfix/usr/sbin/postqueue -c /opt/postfix/etc/postfix/ -i <Relevant\\_Queue\\_ID>_\n        3.  Stop the debugs:\n            \n            _\\[Expert@HostName:0\\]# fw debug in.emaild.mta off_  \n            _\\[Expert@HostName:0\\]# tecli debug defaults_\n        4.  Analyze the debug output:\n            \n            -   _\\[Expert@HostName:0\\]# grep -n 'TEScanParal::AddRequest: email is to' $FWDIR/log/emaild.mta.elg\\*_\n                \n                Between all of the requests, locate the recipient name.  \n                If there is no request sent with the recipient name, then the e-mail did not contain attachments.  \n                This means that the delay is caused only because of the communication between postfix and _in.emaild.mta_ process.  \n                Stop following this e-mail.  \n                Check the CPU load on the Security Gateway (refer to \"CPU\" sections in [sk98348](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98348)).  \n                Collect throughput and number of users behind the MTA.  \n                Check the size of postfix queue.  \n                Collect the contents of the current postfix queue for later investigation.\n                \n            -   If there is a request sent with the recipient name, then go to the line number that matches the request that was sent to that recipient.\n                \n                At the line below you should see the following message:  \n                _TEScanParal::AddRequest: Added request for <Name\\_of\\_Attachment>, request ID is <Request\\_ID>_\n                \n                If this message does not appear, then the communication with Threat Emulation Daemon _ted_ was not initialized.  \n                Check that _ted_ process is up (\"_ps auxw | grep -w ted_\") and is responding (\"_tecli show_\").\n                \n                If _ted_ process is down, then:\n                \n                -   check if it crashed with core dump files (\"_ls -l /var/log/dump/usermode/ | grep ted_\")\n                -   collect _$FWDIR/log/ted.elg\\*_ files\n                -   collect _$FWDIR/log/fwd.elg\\*_ files\n                -   [CPinfo file](http://supportcontent.checkpoint.com/solutions?id=sk92739) from the Security Gateway\n                -   [CPinfo file](http://supportcontent.checkpoint.com/solutions?id=sk92739) from the Security Management Server\n                \n                If _ted_ process is up and responding, then:\n                \n                -   use the Appliance Sizing Tool to check that this appliance matches the current throughput and number of users:  \n                    go to [UserCenter](https://usercenter.checkpoint.com/) - go to \"_QUOTING TOOLS_\" menu at the top - click on \"_Appliance Sizing Tool_\"  \n                    (in addition, refer to [sk93598 - Threat Emulation Sizing Mode: how to measure the required inspections at an organization](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk93598))\n                -   collect Threat Emulation statistics (\"_tecli show statistics_\")\n                -   collect Threat Emulation throughput (\"_tecli show throughput_\")\n            -   Check of _ted_ process has responded with the verdict to the request - search for this line:  \n                _TEScanParal::ReplyToReq: Reply for request <Request\\_ID> is <verdict>_\n                \n                Run:  \n                _\\[Expert@HostName:0\\]# grep -n 'TEScanParal::ReplyToReq: Reply for request' $FWDIR/log/emaild.mta.elg\\*_\n                \n                If this message does not appear, then look for the attachment in Threat Emulation (proceed to the next step).\n                \n    4.  Locate the attachment in Threat Emulation\n        \n        From the _$FWDIR/log/in.emaild.mta.elg\\*_ log files you have the name of the attachment file.\n        \n        Search for this attachment in the _ted_ process debugs (collected in the previous step):  \n        _\\[Expert@HostName:0\\]# grep 'Handling new file \"<Name\\_of\\_Attachment>\"' $FWDIR/log/ted.elg\\*_\n        \n        At the beginning of the line, there is a UUID of the attachment in the format _{XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX}_.  \n        Follow the UUID through the _ted.elg_ files.  \n        If there is no apparent error, then collect the following information:\n        \n        -   UUID number of the involved attachment\n        -   $FWDIR/log/ted.elg\\*\n        -   Output of \"_tecli show downloads all_\" command\n        -   Output of \"_tecli advanced schema all_\" command\n        -   Output of \"_tecli advanced engine version_\" command\n        -   [CPinfo file](http://supportcontent.checkpoint.com/solutions?id=sk92739) from the Security Gateway\n        -   [CPinfo file](http://supportcontent.checkpoint.com/solutions?id=sk92739) from the Security Management Server\n-   **Analyze Postfix bottlenecks using the _cpqshape_ utility:**\n    \n    -   **Background:**\n        \n        Postfix built-it queue monitoring abilities are lacking, which makes it very hard to analyze Postfix bottlenecks.\n        \n        Check Point provides the improved Postfix \"[`qshape`](http://www.postfix.org/qshape.1.html)\" utility - `/opt/postfix/usr/sbin/cpqshape`.\n        \n        The \"`cpqshape`\" utility helps understand the Postfix queue message distribution in time and by sender / recipient domain.\n        \n        **Note:** The \"`cpqshape`\" utility (ID 02002951) is available only in the following Security Gateways:\n        \n        -   R77.30 with _Take\\_221_ and higher of [R77.30 Jumbo Hotfix Accumulator](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk106162)\n        -   R80.10 and higher\n    -   **Syntax:**\n        \n        ```\n        cpqshape [-s] [-p] [-m <em>min_subdomains</em>]<br>[-b <em>bucket_count</em>] [-t <em>bucket_time</em>]<br>[-l] [-w <em>terminal_width</em>]<br>[-N <em>batch_msg_count</em>] [-n <em>batch_top_domains</em>]<br>[-c <em>config_directory</em>] [<em>queue_name</em> ...]\n        ```\n        \n    -   **Documentation:**\n        \n        For more information about this utility, refer to:\n        \n        -   \"`qshape`\" [manual page](http://www.postfix.org/qshape.1.html)\n        -   [Postfix Bottleneck Analysis](http://www.postfix.org/QSHAPE_README.html) document\n\n-   Threat Prevention Administration Guide ([R77.X](http://supportcontent.checkpoint.com/documentation_download?ID=24834), [R80](http://downloads.checkpoint.com/dc/download.htm?ID=46525), [R80.10](http://downloads.checkpoint.com/dc/download.htm?ID=54828) / [R80.10](http://downloads.checkpoint.com/dc/download.htm?ID=54806))\n    \n-   [postqueue](http://www.postfix.org/postqueue.1.html) manual (Postfix queue control)\n    \n-   [postcat](http://www.postfix.org/postcat.1.html) manual (Postfix queue file contents)\n    \n-   [postsuper](http://www.postfix.org/postsuper.1.html) manual (Postfix superintendent)\n    \n-   [postconf](http://www.postfix.org/postconf.1.html) manual (Postfix configuration utility)\n    \n-   [postfix](http://www.postfix.org/postfix.1.html) manual (Postfix control program)\n    \n-   [qshape](http://www.postfix.org/qshape.1.html) manual (Prints Postfix queue distribution)\n    \n-   [All Postfix Manual Pages](http://www.postfix.org/postfix-manuals.html)\n    \n\n-   Configuration\n    \n    -   [sk108553 - Mail Transfer Agent (MTA) - FAQ](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk108553)\n    -   [sk93505 - How to change the default size of the /var/log/maillog file when using Mail Transfer Agent (MTA)](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk93505)\n    -   [sk110369 - How to configure load balancing / high availability based on the DNS configuration for Mail Transfer Agent (MTA)](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk110369)\n    -   [sk120415 - Mail Transfer Agent (MTA) - How to configure desired text in the e-mail attachment replacement file](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk120415)\n    -   [sk97638 - Check Point Processes and Daemons](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk97638)\n-   Troubleshooting\n    \n    -   [sk120260 - MTA Debugging and Performance Troubleshooting Toolkit](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk120260)\n    -   [sk108878 - E-mails are delayed for several hours when Threat Emulation blade and Mail Transfer Agent (MTA) are enabled](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk108878)\n    -   [sk109198 - E-mail client receives timeout error, e-mails do not reach their destinations, and SmartView Tracker shows duplicated Threat Emulation logs from a cluster](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk109198)\n    -   [sk102494 - Check Point gateway rejects malicious attachments in email instead of stripping attachment in MTA environment](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk102494)\n    -   [sk103752 - \"There are (N) files in the remote emulation queue that have failed to send for more than (X) minutes\" log in SmartView Tracker](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk103752)\n    -   [sk105164 - Threat Emulation issues caused by non-ASCII characters](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk105164)\n    -   [sk108073 - IP Reputation on Anti-Spam Blade does not work when MTA (Mail Transfer Agent) configured on Gateway](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk108073)\n    -   [sk98973 - Encrypted mail traffic (SMTP TLS) is bypassed](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98973)\n    -   [sk109339 - MTA used as outgoing mail relay](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk109339)\n    -   [sk105482 - Some spam e-mails pass through the Security Gateway even when the Anti-Spam blade is enabled](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk105482)\n    -   [sk108074 - SandBlast Parallel Extraction Hotfix](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk108074)\n    -   [sk93598 - Threat Emulation Sizing Mode: how to measure the required inspections at an organization](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk93598)\n    -   [sk115020 - \"<Name of Security Gateway> has MTA enabled, but it is not in the scope of any of the Threat Prevention policy rules\" error during the installation of Threat Prevention policy](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk115020)\n\n### (11) Revision history\n\n## Article Properties\n\nOriginatorZohar Meridor\n\nTechnical ResourceLior Jacobian\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2016-02-21\n\nLast Modified2024-10-27\n\nEditorLiron Rubin\n\nLast ApproverDaniel Epstein\n\n## Comments\n\n#### Internal only\n\n**This SK can NOT be deleted  - referenced in the Security Gateway Admin Guides.**\n\n**Important Note: Prior to using the tools mentioned in this article, make sure you thoroughly go over [sk156153 - Best Practice Guide for Debugging Check Point Products](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk156153).**\n\n**Note about cosmetic bug in SmartDashboard:**\n\nEven though Anti-Virus is not supported over MTA, the \"Mail Transfer Agent\" pane appears in Security Gateway object when you enable the Anti-Virus blade - CR01979764 was opened.\n\n___\n\n**E-mail thread with RnD:**\n\n```\n----Original Message----\nFrom: Almog Sasson \nSent: Wednesday, July 27, 2016 5:44 PM\nTo: Zohar Meridor; Sergei Shir; Ziv Zelikovsky\nSubject: RE: sk108553 - MTA - support of DLP blade\n\nHi,\n\n@Zohar - thanks you for the explanation over the phone.\n\nSergei, please edit the ATRG: MTA and remove DLP.\n\nWhat Zohar explained is, that when enabling DLP, it is automatically enabling \npostfix queue for outbound, but the MTA itself as a feature of mail relay \nto scan mails is not an option, so if DLP is enabled and then MTA is enabled, \nMTA will not function as it should for TE/TEX.\n\n----Original Message----\nFrom: Zohar Meridor \nSent: Wednesday, July 27, 2016 5:07 PM\nTo: Almog Sasson; Sergei Shir; Ziv Zelikovsky\nSubject: RE: sk108553 - MTA - support of DLP blade\n\nDLP uses postfix for outgoing mails.\n\nBut if you want to run outgoing DLP and incoming TE/TEX on MTA I don't think it'll work.\n\n----Original Message----\nFrom: Almog Sasson \nSent: Wednesday, July 27, 2016 3:32 PM\nTo: Sergei Shir; Ziv Zelikovsky; Zohar Meridor\nSubject: RE: sk108553 - MTA - support of DLP blade\n\nHi,\n\nNever said they told me it's not supported.\n\nJust common sense;\nDLP scans outgoing traffic\nMTA scans incoming traffic\n\nHow can this work?\n\n----Original Message----\nFrom: Sergei Shir \nSent: Wednesday, July 27, 2016 3:20 PM\nTo: Ziv Zelikovsky; Almog Sasson; Zohar Meridor\nSubject: RE: sk108553 - MTA - support of DLP blade\n\n(1)\n+Zohar\nDoes MTA support the DLP blade ?\n\n(2)\nAlmog,\nwho in RnD told you that DLP is not supported ?\n\nThanks\n```","language":"md","time":"14 days ago","created":"2025-05-06T22:56:10.866Z","annotations":[],"updated":"2025-05-06T22:59:05.916Z"},{"title":"Code Snippet: Introduction for Flow Diagrams and Description","id":"983a776d-339c-4fa9-a43a-125f276572c5","type":"TEXT","raw":"**Table of Contents**\n\n-   Introduction\n    \n-   Process Flow Diagrams and Description\n    \n-   Unified Policy Troubleshooting\n    \n-   Unified Policy Debugging\n    \n-   QUIC Protocol\n    \n-   Related Solutions\n    \n\n## Introduction\n\n**_The Need for Unified Policy_**\n\n-   Policy Granularity & Control – multiple blades can be configured within the same rule\n-   Simplicity - one Policy to Manage Everything\n\n**_The Check Point Unified Policy_** \n\nCheck Point's latest firewall innovation brings the industry's strongest access control to organizations of all sizes. You can easily create access policies which combine capabilities of blades such as traditional FireWall, Application Control, Content Awareness, Mobile Access and more.\n\nFor information about Unified Policy, refer to the \"Creating an Access Control Policy\" section in the [Next Generation Security Gateway R80.10 Guide](https://sc1.checkpoint.com/documents/R80.10/WebAdminGuides/EN/CP_R80.10_NexGenSecurityGateway_Guide/html_frameset.htm).\n\n**Note:** It is unsupported to have Application Control objects, or APPI, enabled in the first layer for pre-R80.x Security Gateways. If the customer has such Security Gateways, the APPI rules should be configured in a separate layer. In the separate layer, the application layer supports only services of type TCP/UDP. In addition, in the R77.20 Security Gateway, we support **only** two layers.\n\n## Process Flow Diagrams and Description\n\n**Unified Policy Inspection Diagram**\n\n**![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk120964/UP_Inspection_Diagram1710190408.png)  \n**\n\n**Classifiers**\n\nBlades (e.g: Application Control\\\\Content Awareness) contain Classifiers that deal with traffic classification. Rule matching is done with the classification output.\n\n\\*Blades may have multiple Classifiers.\n\nClassifiers attach tag/object IDs to traffic.\n\nClassifier notifies the Manager regarding matched objects (Application\\\\Files\\\\Zones\\\\etc). The matched object is called a CLOB (Classification Object). (CLOB is a compound of: Type, ID, additional info) (Examples of CLOB Types: Source Network, Destination Network and Service in FW1 Blade)\n\nAll Classifiers are implemented as CMI\\_LOADER applications.\n\nClassifier examples: Network (FireWall-1), Identity, Application Control, URL Filtering, Content Awareness\n\n**Connection/Transaction**\n\nSaves rulebase matching state and classification objects (CLOBs).\n\nA Transaction represents one request-response.\n\nA Transaction contains classification collections objects (Observers) for special flags handling.\n\nA Connection (Unified Policy connection) contains Transactions.\n\nA Unified Policy Connection is stored in the Connection table.\n\n**Observers**\n\nCLOBS are distributed to a Publisher-Observer system (via the Manager)\n\n-   The Transaction is a Publisher.\n-   The Observer is a unit collecting CLOBs for classification refinement (e.g: CLOB dependency).\n    \n    **For example:**\n    \n    **Application Observer** – collects APPs and URLF Categorization (Application CLOBs)\n    \n    **Content Observer** – collects File types and content CLOBs\n    \n-   Observers are registered to CLOB types (one-to-many).\n\n**Manager**\n\nMediator between other components\n\nResponsible for the whole rule base execution process.\n\nCreates connection/transactions, as required.\n\nSends logs.\n\n**Rulebase**\n\nColumn based match:\n\n-   First column (Usually destination) adds all rules matching its column to the possible rules list.\n-   Consecutive columns filter out all rules not matching their column from the possible rules list.\n-   When all columns have finished their matching, the first possible rule is the matched rule.\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk120964/Column_based_match1710190409.png)\n\nColumn match requires specific CLOB types (e.g: Application, Security Zone, Dynamic Object, file type, AccesRole, etc.)\n\n-   In case CLOB type is not available, column will return with “Need more data” state until relevant CLOB type is available.\n\nMatching Output:\n\n-   **Status:** Possible, Match, No Match \n-   CLOB types that are needed to complete the match (e.g: Application, Security Zone, Dynamic Object, file type, AccesRole, etc.)\n\n## Unified Policy Troubleshooting\n\n### Understanding Possible Match\n\n**What is possible/final match?**\n\nPossible match is the status in which the rule base needs more data in order to finish matching. This means a \"required for match\" clob was not reported yet.\n\nFinal match is the status in which the first \"possible rule for match\" is fully matched (only occurs when all \"required clobs for match\" of this rule are reported)\n\n**How do we identify a Possible Match in the debug?**\n\nYou can see in the SUMMARY section:\n\n_up\\_rulebase\\_execute\\_match: \\[SUMMARY ffffc20034753df8\\] POSSIBLE dir 0,_  \n_10.101.0.2:59150 -> 52.94.237.74:80, IPP 6;_  \n_up\\_rulebase\\_execute\\_match: \\[0\\] 'Network' (0): **POSSIBLE**;_\n\n**Why did you get \"Possible Match\"?**\n\nBefore the SUMMARY section, you can see something like this:\n\n_\"column Destination returned need more data. Clob type 20 is not ready yet\"_ \n\nIn order to know what clob type 20 is, you can check in the _clobs.conf_ file:\n\n_CLOB\\_TYPE\\_APPLICATION 1_  \n_CLOB\\_TYPE\\_SOURCE\\_NETWORK 2_  \n_CLOB\\_TYPE\\_DESTINATION\\_NETWORK 3_  \n_CLOB\\_TYPE\\_SERVICE 4_  \n_CLOB\\_TYPE\\_SOURCE\\_ACCESS\\_ROLE 7_  \n_CLOB\\_TYPE\\_DESTINATION\\_ACCESS\\_ROLE 8_  \n_CLOB\\_TYPE\\_RESOURCES\\_ID 9_  \n_CLOB\\_TYPE\\_SOURCE\\_SECURITY\\_ZONE 10_  \n_CLOB\\_TYPE\\_DESTINATION\\_SECURITY\\_ZONE 11_  \n_CLOB\\_TYPE\\_SOURCE\\_VPN 12_  \n_CLOB\\_TYPE\\_DESTINATION\\_VPN 13_  \n_CLOB\\_TYPE\\_CLIENT\\_AUTH\\_ID 14_  \n_CLOB\\_TYPE\\_LOGICAL\\_SERVER 15_  \n_CLOB\\_TYPE\\_XFF\\_SOURCE\\_ACCESS\\_ROLE 16_  \n_CLOB\\_TYPE\\_SOURCE\\_DYNOBJ 17_  \n_CLOB\\_TYPE\\_DESTINATION\\_DYNOBJ 18_  \n**_CLOB\\_TYPE\\_SOURCE\\_DOMAIN 19_**  \n**_CLOB\\_TYPE\\_DESTINATION\\_DOMAIN 20_**  \n_CLOB\\_TYPE\\_SOURCE\\_USER\\_AT\\_LOCATION 21_  \n_CLOB\\_TYPE\\_DESTINATION\\_USER\\_AT\\_LOCATION 22_  \n_CLOB\\_TYPE\\_SOURCE\\_USER\\_LIMITATION 23_  \n_CLOB\\_TYPE\\_DESTINATION\\_USER\\_LIMITATION 24_  \n_CLOB\\_TYPE\\_PROTOCOL 26_  \n_CLOB\\_TYPE\\_SERVICE\\_APPLICATION 27_  \n_CLOB\\_TYPE\\_MAB\\_PROTECTION\\_LEVEL 28_  \n_CLOB\\_TYPE\\_MAB\\_APPLICATION 29_  \n_CLOB\\_TYPE\\_SCADA\\_APPLICATION 30_  \n_CLOB\\_TYPE\\_SIP\\_MGCP\\_HIDE\\_NAT 31_  \n_CLOB\\_TYPE\\_CONTENT\\_FILE 40_  \n_CLOB\\_TYPE\\_FILE 41_  \n_CLOB\\_TYPE\\_CONTENT 42_  \n_CLOB\\_TYPE\\_DIRECTION 43_  \n_CLOB\\_TYPE\\_LAST 44_\n\n**In R81:  \n**  \n_CLOB\\_TYPE\\_APPLICATION 1_  \n_CLOB\\_TYPE\\_SOURCE\\_NETWORK 2_  \n_CLOB\\_TYPE\\_DESTINATION\\_NETWORK 3_  \n_CLOB\\_TYPE\\_SERVICE 4_  \n_CLOB\\_TYPE\\_SOURCE\\_ACCESS\\_ROLE 7_  \n_CLOB\\_TYPE\\_DESTINATION\\_ACCESS\\_ROLE 8_  \n_CLOB\\_TYPE\\_RESOURCES\\_ID 9_  \n_CLOB\\_TYPE\\_SOURCE\\_SECURITY\\_ZONE 10_  \n_CLOB\\_TYPE\\_DESTINATION\\_SECURITY\\_ZONE 11_  \n_CLOB\\_TYPE\\_SOURCE\\_VPN 12_  \n_CLOB\\_TYPE\\_DESTINATION\\_VPN 13_  \n_CLOB\\_TYPE\\_CLIENT\\_AUTH\\_ID 14_  \n_CLOB\\_TYPE\\_LOGICAL\\_SERVER 15_  \n_CLOB\\_TYPE\\_XFF\\_SOURCE\\_ACCESS\\_ROLE 16_  \n_CLOB\\_TYPE\\_SOURCE\\_DYNOBJ 17_  \n_CLOB\\_TYPE\\_DESTINATION\\_DYNOBJ 18_  \n_CLOB\\_TYPE\\_SOURCE\\_USER\\_AT\\_LOCATION 21_  \n_CLOB\\_TYPE\\_DESTINATION\\_USER\\_AT\\_LOCATION 22_  \n_CLOB\\_TYPE\\_SOURCE\\_USER\\_LIMITATION 23_  \n_CLOB\\_TYPE\\_DESTINATION\\_USER\\_LIMITATION 24_  \n_CLOB\\_TYPE\\_PROTOCOL 26_  \n_CLOB\\_TYPE\\_SERVICE\\_APPLICATION 27_  \n_CLOB\\_TYPE\\_MAB\\_PROTECTION\\_LEVEL 28_  \n_CLOB\\_TYPE\\_MAB\\_APPLICATION 29_  \n_CLOB\\_TYPE\\_SCADA\\_APPLICATION 30_  \n_CLOB\\_TYPE\\_SIP\\_MGCP\\_HIDE\\_NAT 31_  \n**_CLOB\\_TYPE\\_SOURCE\\_FQDN\\_DOMAIN 32_**  \n**_CLOB\\_TYPE\\_DESTINATION\\_FQDN\\_DOMAIN 33_**  \n**_CLOB\\_TYPE\\_ SOURCE\\_NON\\_FQDN\\_DOMAIN 34_**  \n**_CLOB\\_TYPE\\_DESTINATION\\_NON\\_FQDN\\_DOMAIN 35_**  \n_CLOB\\_TYPE\\_CONTENT\\_FILE 40_  \n_CLOB\\_TYPE\\_FILE 41_  \n_CLOB\\_TYPE\\_CONTENT 42_  \n_CLOB\\_TYPE\\_DIRECTION 43_  \n_CLOB\\_TYPE\\_LAST 44_\n\nAnother important source of information to use when exploring the \"required clobs for match\" is the UP tables:\n\nThere is a table called \"up\\_X\\_clob\\_type\\_scheme\" for each sub policy (layer), where X is the layer id. These tables map a rule number to its \"required for match\" clobs and its active clobs.\n\n**How do you know the sub policy (layer) id?**\n\nLet us look at our SUMMARY section:\n\n_up\\_rulebase\\_execute\\_match: \\[SUMMARY ffffc20034753df8\\] POSSIBLE dir 0, 10.101.0.2:59150 -> 52.94.237.74:80, IPP 6;_  \n_up\\_rulebase\\_execute\\_match: \\[0\\] 'Network' **(0)**: **POSSIBLE**;_\n\nThe marked number is the sub policy (layer) id. In our case it is \"0\" (called \"network\" layer).\n\nFinally, look for the table up\\_0\\_clob\\_type\\_scheme (using _fw tab –t up\\_0\\_clob\\_type\\_scheme_):\n\n_up\\_0\\_clob\\_type\\_scheme_  \n_9108 (id of the table)_\n\n<RULE : ACTIVE\\_MASK ,ACTIVE\\_MASK ,REQUIRED\\_4\\_MATCH ,REQUIRED\\_4\\_MATCH >\n\n<1 : 08000010 ,00000000 ,08000010 ,00000000 >\n\n**<3** : 0c100012 ,00000000 ,**0c100010** ,**00000000** >\n\n<**16777215** : 00000000 ,00000000 ,00000000 ,00000000 > \n\n-   16777215 - no match rule number\n-   16777214 - early drop optimization rule number \n\nLet us check what is required for a match for rule 3 (**<3** above) because rule 3 uses a missing clob, for example:\n\n**0c100010** - in binary **11**00000**1**000000000000000**1**0000\n\n(**Note:** The position of the active bits indicates which clob types are required.)\n\nThe \"required for match\" clob types for rule 3:\n\n4 - CLOB\\_TYPE\\_SERVICE\n\n20 - CLOB\\_TYPE\\_DESTINATION\\_DOMAIN\n\n26 - CLOB\\_TYPE\\_PROTOCOL\n\n27 - CLOB\\_TYPE\\_ SERVICE\\_APPLICATION\n\nIn our example, at this point, inadequate information about \"destination domain\" was received (as shown above), and it is required for rule 3. That is the reason you could not \"solve\" the destination column and ended up with \"Possible Match\".\n\n### Understanding Early drop optimization\n\n**What is early drop optimization?**\n\nDropping connection before there is a final rule match.\n\nIt happens when all \"possible rules for match\" are DROP or REJECT.\n\nSee explanation in [sk111643 - Early Drop - dropping connection before final rule match](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk111643)\n\n**How do we identify early drop optimization in the Logs?** \n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk120964/sk120964_Early_Drop_11805170537.png)\n\nDouble-clicking on the entry in the Access Rule Name column will open this:\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk120964/sk120964_Early_Drop_21805170539.png) \n\n**How do you identify early drop optimization in the debug?**\n\nup\\_sub\\_policy\\_post\\_columns\\_calc: all possible rules have DROP/REJECT action - dropping the connection;  \nup\\_rulebase\\_execute\\_match: \\[SUMMARY ffffc200213b8228\\]  \n**MATCH\\_ON\\_DROP\\_RULES** dir 0, 10.11.1.3:37559 -> 52.94.237.74:80, IPP 6;\n\n### Connection terminated before detection\n\n**What is it?**\n\nThis occurs when a connection ends (for some reason) before the rule base reaches a full match on a rule. Despite the termination, a matching process is done in order to determine what log (what matched rule) to show. See explanation in [sk113479 - Unified Rulebase - \"Connection terminated before detection\" in log Reason](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk113479)\n\n**Note:** If the matching seems incorrect, you can turn on a global flag (called \"up\\_log\\_reason\\_for\\_incomplete\\_match\") which will add this reason in the log (if indeed the problem is related to this issue).\n\n### Implied Rules\n\n**How to identify match on implied rule?**\n\nYou can see in the SUMMARY section in the debug:\n\n_up\\_rulebase\\_execute\\_match: \\[SUMMARY ffffc2003386e228\\] MATCH dir 1, 172.16.4.89:53042 -> 172.23.39.5:53, IPP 17;_  \n_up\\_rulebase\\_execute\\_match: **FIRST Implied Rules match 57**;_\n\n**How do you know what rule 57 is?**\n\nOn the gateway, open the file _$FWDIR/state/local/FW1/local.implied\\_rules_ and look for rule 57 by searching for \"rule\\_id (57)\". You will get:\n\n```\n:accept_outgoing (\n          :name (accept_outgoing)\n          :src (\n                : (GW)\n          )\n          :dst (\n                : (Any)\n          )\n          :service (\n                : (97aeb369-9aea-11d5-bd16-0090272ccb30)\n          )\n          :inspect_func_name (implied_rule_func_57)\n          :action (accept)\n          :install (Any)\n          <strong>:rule_id (57)</strong>\n          :optimize_drops_support_rule (false)\n          :position (first)\n          :src6 (\n                : (GW)\n          )\n          :dst6 (\n                : (Any)\n          )\n    )\n```\n\n```\n<strong>Each implied rule has this information block.</strong>\n```\n\n```\nThere are several implied rule layers. \"First\", \"Before Last\", \"Last\", \"Before Drop\"... \n```\n\n## Unified Policy Debugging \n\nTurn on basic debug (**General** section) and add more debug according to your policy and traffic.\n\n<table><tbody><tr><td>Description</td><td>Commands</td></tr><tr><td><p><strong>GENERAL</strong></p><p><strong>Light Mode</strong></p><p>Turn ON for any rulebase matching process</p></td><td><p><em>fw ctl debug 0</em><br><em>fw ctl debug -m UP + info module rulebase connection manager clob log sec_rb vpn address mab</em><br><em>fw ctl debug -m UPIS + info clob</em><br><em>fw ctl debug + drop conn</em><br><em>fw ctl debug -buf 32000</em><br><em>fw ctl kdebug -p time -f &gt; &lt;Output file name&gt;</em></p></td></tr><tr><td><p><strong>GENERAL</strong></p><p><strong>Full Mode</strong></p><p>Turn ON for detailed rulebase matching process</p><p><strong>heavy debugging</strong><em><br></em></p></td><td><p><em>fw ctl debug 0</em><br><em>fw ctl debug -m UP + all</em><br><em>fw ctl debug -m UPIS + info clob</em><br><em>fw ctl debug + drop log chain conn vm</em><br><em>fw ctl debug -buf 32000</em><br><em>fw ctl kdebug -f &gt; &lt;Output file name&gt;</em></p></td></tr><tr><td>Rules with <strong>Application</strong></td><td>Add below command lines to <strong>GENERAL</strong><p><em>fw ctl debug -m APPI + all</em><br><em>fw ctl debug -m cmi_loader + all</em><br><em>fw ctl debug + cmi</em><br><em>fw ctl set int cmi_dump_buffer 1</em></p></td></tr><tr><td>Rules with <strong>Data</strong></td><td>Add below command lines to <strong>GENERAL</strong><p><em>fw ctl debug -m dlpda + all</em><br><em>fw ctl debug -m FILEAPP + all</em><br><em>fw ctl debug -m cmi_loader + all</em><br><em>fw ctl debug + cmi</em><br><em>fw ctl set int cmi_dump_buffer 1</em></p></td></tr><tr><td>Rules with <strong>Access Role</strong></td><td>Add below command line to <strong>GENERAL</strong><p><em>fw ctl debug -m IDAPI + all</em></p></td></tr><tr><td><p>UserCheck actions (including Drop with Block message)</p><p>User Check has code in both usermode and driver. Usermode debug is saved to <em>$FWDIR/log/usrchkd.elg</em></p><p><strong>Do not forget to run&nbsp;<em>usrchk debug off</em> when done.</strong></p></td><td>Add below command line to <strong>GENERAL</strong><p><em>fw ctl debug -m UC + all</em></p><p><strong>Turn on usermode debug:</strong><br><em>usrchk debug set all all</em></p></td></tr><tr><td>HTTP traffic - deep packet inspection</td><td>Add below command line to <strong>GENERAL</strong><p><em>fw ctl debug -m WS + info pkt_dump module connection session policy spii address</em></p></td></tr><tr><td><p>TCP level debug - deep packet inspection</p><p><strong>very heavy debugging</strong></p></td><td>Add below command line to <strong>GENERAL</strong><p><em>fw ctl debug + tcpstr</em></p></td></tr><tr><td><p>Failure of Install Policy</p><p><strong>Do not forget to unset all TDERROR when done.</strong></p></td><td><strong>Turn on usermode debugging:</strong><br><em>export TDERROR_ALL_ALL=0</em><br><em>export TDERROR_ALL_fwapp=5</em><br><em>export TDERROR_ALL_upapp=5</em><br><em>export TDERROR_ALL_db=5</em><br><em>export TDERROR_ALL_mgr=5</em><br><em>export TDERROR_ALL_sna=5</em><br><em>export TDERROR_ALL_load=5</em><p><strong>Turn on kernel debugging:</strong><br><em>fw ctl debug 0</em><br><em>fw ctl debug -m UP + info rulebase policy module manager</em><br><em>fw ctl debug -m UPIS + all</em><br><em>fw ctl debug + filter cmi</em><br><em>fw ctl debug -buf 32000</em></p><p>f<em>w -d fetchlocal -d $FWDIR/state/__tmp/FW1/ &gt;&amp; $output_filename</em><br><em>fw ctl kdebug -f &gt;&gt; $output_filename</em></p><p><strong>To unset all TDERROR:</strong></p><p><em>unset TDERROR_ALL_fwapp</em></p><p>unset TDERROR_ALL_upapp</p><p>...</p><p><strong>To stop kernel debug</strong></p><p><em>Fw ctl debug 0&nbsp;<br></em></p></td></tr></tbody></table>\n\n## QUIC Protocol\n\n[QUIC Protocol](https://en.wikipedia.org/wiki/QUIC) (UDP, port 443) is a (still evolving) protocol invented by Google to provide security protection equivalent to TLS/SSL, along with reduced connection and transport latency. According to the latest information [published](https://blog.chromium.org/2015/04/a-quic-update-on-googles-experimental.html) by Google, half of Chrome’s requests to Google servers are served over QUIC Protocol. Application Control and URLF features like Safe Search, Translate, and Cache rely on traffic inspection to classify web traffic. When QUIC is used, we cannot inspect parts of the traffic, which may impact our ability to reliably classify content. If you see this in your organization, we currently recommend you block QUIC Protocol using Application Control.\n\nNote: Starting from R82 version, Check Point Security Gateways can inspect HTTP/3 traffic according to blades configurations. For more info, refer to the HTTPS Inspection section in the [Quantum Security Management Administration Guide](https://support.checkpoint.com/product/184) for your version.\n\n-   [sk115871 - Connection Persistence in Unified Policy](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk115871)\n-   [sk111643 - Early Drop - dropping connection before final rule match](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk111643)\n-   [sk113479 - Unified Rulebase - \"Connection terminated before detection\" in log Reason](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk113479)\n-   [sk115961 - Install policy on R80.10 Security Gateway fails with verification error messages](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk115961)\n-   [sk112576 - In Unified Policy, when using \"Any\" in Services & Applications column in Rule Base, not all applications appear in Mobile Access portal or Capsule Workspace](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk112576)","language":"md","time":"14 days ago","created":"2025-05-06T22:56:14.291Z","annotations":[],"updated":"2025-05-06T23:00:15.106Z"},{"title":"ProductContent Awareness","id":"60806686-cce8-495f-855e-a478e51d6747","type":"TEXT","raw":"ProductContent Awareness\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nLast Modified2024-10-27\n\n## Solution\n\n**Table of Contents**\n\n-   Introduction\n    \n-   Common Processes Flow\n    \n-   Policy Installation Flow\n    \n-   User Mode Flow\n    \n-   Debugging\n    \n    -   HTTP Process\n        \n    -   SMTP Process\n        \n    -   FTP Process\n        \n    -   User Mode\n        \n\n## Introduction\n\n**Content Awareness (CTNT)** is a new blade introduced in R80.10 as part of the new Unified Access Control Policy. Using Content Awareness blade as part of Firewall policy allows the administrator to enforce the Security Policy based on the content of the traffic by identifying files and its content. Content Awareness restricts the Data Types that users can upload or download.  \nContent Awareness can be used together with Application Control to enforce more interesting scenarios (e.g. identify which files are uploaded to DropBox).\n\n## Common Processes Flow\n\n![](https://sc1.checkpoint.com/sc//SolutionsStatics/NEW_SK_NOID1502370023504/CTNT-21708100606.png)\n\n1.  When packet arrives to the Security gateway, the relevant **parser** is parsing it and creates the relevant contexts (headers, body, etc.).\n2.  _**FileApp**_ parser creates File contexts when file is discovered (mail subject/body and HTTP posts are also counted as \"file\" for this manner).  \n    Basic FileApp contexts are:\n    -   File begin\n    -   File name\n    -   File type\n    -   Data decoded (the text of the file)\n    -   File size\n    -   File end\n3.  Content Awareness process **_dlpda_** collects the data from those contexts and decides if the file is matched by some Data Type.\n4.  When file is matched, the _dlpda_ process notifies the **Unified Rulebase (UP)** about this match and asks for rulebase execution.  \n    For each file, _dlpda_ can execute the rulebase twice:\n    \n    -   when file type is known to match the \"file type\" data types (e.g. \"Document File\")\n    -   at the end of the to match the \"content\" data types (e.g. \"PCI - Credit Card Numbers\").\n    \n      \n    Therefore it is preferable to place rules with \"file type\" data types before \"content\" data types rules, as it can improve performance - there will be no need to scan the file content if it match (or not matched) by its type.\n\n## Policy Installation Flow\n\n![](https://sc1.checkpoint.com/sc//SolutionsStatics/NEW_SK_NOID1502370023504/CTNT-11708100603.png)\n\nPolicy installation is handled by FW process.\n\nDuring policy installation, the CMI Loader collects signatures from multiple sources (e.g. IPS, CTNT, APPI, ...) and compiles them together into unified Pattern Matchers (PM) (one for each context - such as URL, Host header, etc.).\n\nThe CMI process calls for Content Awareness blade for install policy process:\n\n-   Read data types and other settings information retrieved from the Security Management server.\n-   Registered to FileApp contexts.\n-   Load all Data Types signatures and CPcodes into CMI.\n-   Get the latest list of supported file types (see [sk114640](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk114640) for supported file types).\n-   Download all policy information to the kernel.\n\nAfterwards, FileApp parser updates the File Signatures (file type identification method) to its latest version to support new file types.\n\n## User Mode Flow\n\n![](https://sc1.checkpoint.com/sc//SolutionsStatics/NEW_SK_NOID1502370023504/CTNT-31708100609.png)\n\n_**FileApp**_ is able to extract text from Microsoft Office 2007 and above files (_.docx, .pptx, .xlsx_, ...), _.zip/.gzip_ and text files.  \nFor other file types (such as _.pdf_), and other archives (such as _.rar_), FileApp sends the file to User Mode for extraction:\n\n1.  File is uploaded to **_dlpu_** process.\n2.  _dlpu_ process sends the file to **_cp\\_file\\_convert_** process for text extraction.\n3.  _dlpu_ is downloading the file to the _**kernel**_.\n4.  _**FileApp**_ sends the \"_Data Decoded_\" context.\n\n## Debugging\n\n**Note:** Kernel debug increases load on the Security Gateway's CPU. Schedule a maintenance window during a low traffic time. In cluster environment, this procedure must be performed on _all_ members of the cluster.\n\n-   ### HTTP Process\n    \n    To start debug, run:\n    \n    > ```\n    > fw ctl debug 0\n    > fw ctl debug -buf 32000 <br>fw ctl debug -m fw + advp cmi conn drop cptls log vm<br>fw ctl debug -m cmi_loader all<br>fw ctl debug -m WS + spii info session pkt_dump global policy module ssl_insp body connection<br>fw ctl debug -m cpcode + echo policy ioctl run persist init vm cplog csv io url kisspm<br>fw ctl debug -m UP all<br>fw ctl debug -m FILEAPP all<br>fw ctl debug -m dlpda all<br>fw ctl set int cmi_dump_buffer 1\n    > fw ctl kdebug -T -f &gt; /var/log/kernel_debug_output.txt\n    > ```\n    \n    To display packet content in HTTPS, add (before the last line \"`fw ctl kdebug -T -f`\"):\n    \n    > ```\n    > fw ctl set int https_inspection_show_decrypted_data_in_debug 1 \n    > fw ctl set int ssl_inspection_extra_debug 1\n    > ```\n    \n    To stop debug, run:\n    \n    > ```\n    > fw ctl debug 0<br>fw ctl set int cmi_dump_buffer 0<br>fw ctl set int https_inspection_show_decrypted_data_in_debug 0<br>fw ctl set int ssl_inspection_extra_debug 0\n    > ```\n    \n    Analyze the output file:\n    \n    > _/var/log/kernel\\_debug\\_output.txt_\n    \n-   ### SMTP Process\n    \n    To start debug, run:\n    \n    > ```\n    > fw ctl debug 0\n    > fw ctl debug -buf 32000\n    > fw ctl debug -m fw + cmi mail aspii tcpstr advp\n    > fw ctl debug -m cmi_loader + info module\n    > fw ctl debug -m UP all\n    > fw ctl debug -m FILEAPP all\n    > fw ctl debug -m dlpda all\n    > fw ctl set int cmi_dump_buffer 1\n    > fw ctl kdebug -T -f &gt; /var/log/kernel_debug_output.txt\n    > ```\n    \n    To stop debug, run:\n    \n    > ```\n    > fw ctl debug 0\n    > fw ctl set int cmi_dump_buffer 0\n    > ```\n    \n    Analyze the output file:\n    \n    > _/var/log/kernel\\_debug\\_output.txt_\n    \n-   ### FTP Process\n    \n    To start debug, run:\n    \n    > ```\n    > fw ctl debug 0\n    > fw ctl debug -buf 32000\n    > fw ctl debug -m fw + advp cmi conn vm log\n    > fw ctl debug -m cmi_loader + info module parsers_is\n    > fw ctl debug -m UP + all\n    > fw ctl debug -m FILEAPP all\n    > fw ctl debug -m cpcode all\n    > fw ctl debug -m dlpda all\n    > fw ctl set int cmi_dump_buffer 1\n    > fw ctl kdebug -T -f &gt; /var/log/kernel_debug_output.txt\n    > ```\n    \n    To stop debug, run:\n    \n    > ```\n    > fw ctl debug 0\n    > fw ctl set int cmi_dump_buffer 0\n    > ```\n    \n    Analyze the output file:\n    \n    > _/var/log/kernel\\_debug\\_output.txt_\n    \n-   ### User Mode\n    \n    To start debug, run:\n    \n    > ```\n    > fw_debug dlpu on TDERROR_ALL_SLOWPATH=5\n    > fw_debug scrub_cp_file_convertd on TDERROR_ALL_ALL=5\n    > ```\n    \n    To stop debug, run:\n    \n    > ```\n    > fw_debug dlpu off TDERROR_ALL_SLOWPATH=0\n    > fw_debug scrub_cp_file_convertd off TDERROR_ALL_ALL=0\n    > ```\n    \n    Analyze the output files:\n    \n    > _$FWDIR/log/dlpu.elg_  \n    > /var/log/jail/$FWDIR/log/scrub\\_cp\\_file\\_convertd.elg\n    \n\n## Article Properties\n\nOriginatorStella Shteinbuk\n\nTechnical ResourceIdan Sayag\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2017-08-10\n\nLast Modified2024-10-27\n\nEditorLiron Rubin\n\nLast ApproverDaniel Epstein\n\n## Comments\n\n#### Internal only","language":"md","time":"14 days ago","created":"2025-05-06T22:56:14.486Z","annotations":[],"updated":"2025-05-06T22:59:14.908Z"},{"title":"ProductIdentity Awareness Error Handling","id":"4b109ecd-f3e1-4dba-b97c-3026eb154e6d","type":"TEXT","raw":"ProductIdentity Awareness\n\nVersionR80.10 (EOS), R81.10, R81.20, R82\n\nOSWindows\n\nPlatformIntel/PC\n\nLast Modified2024-12-02\n\n## Solution\n\nThe following errors may be seen in the Event Viewer when Identity Collector (IDC) is installed:\n\n-   Faulting application name: _xxxx.exe_, version: _XX.X.X.X_, time stamp: _0x5a13fb56_\n\n  \n\n-   Faulting module name: _XXXXYYY.dll_, version: _XX.X.XXXXX.XXX_, time stamp: _0x4db13576_\n\n  \n\n-   Faulting module name: _XXXXXXXXX.dll_, version: _X.X.XXXX.XXXXX_, time stamp: _0x5a4b125e_\n\n  \n\nThis is caused by **cpidc.exe crash.**\n\nEvent Viewer Application Log examples: \n\nFaulting application name: cpidc.exe, version: 80.9.0.0, time stamp: 0x5a13fb56  \nFaulting module name: MSVCR100.dll, version: 10.0.30319.460, time stamp: 0x4db13576  \nException code: 0x40000015  \nFault offset: 0x0008cb95  \nFaulting process id: 0x184c  \nFaulting application start time: 0x01d3b0d173eaa1de  \nFaulting application path: C:\\\\Program Files (x86)\\\\CheckPoint\\\\Identity Collector\\\\cpidc.exe  \nFaulting module path: C:\\\\Windows\\\\SYSTEM32\\\\MSVCR100.dll  \nReport Id: f2976d7f-1cc7-11e8-80cb-005056ba24d9  \nFaulting package full name:  \nFaulting package-relative application ID:\n\nFaulting application name: cpidc.exe, version: 80.9.0.0, time stamp: 0x5a13fb56  \nFaulting module name: KERNELBASE.dll, version: 6.3.9600.18895, time stamp: 0x5a4b125e  \nException code: 0xe06d7363Fault offset: 0x00015608  \nFaulting process id: 0xa64  \nFaulting application start time: 0x01d3b0d089bf3514  \nFaulting application path: C:\\\\Program Files (x86)\\\\CheckPoint\\\\Identity Collector\\\\cpidc.exe  \nFaulting module path: C:\\\\Windows\\\\SYSTEM32\\\\KERNELBASE.dll  \nReport Id: 8d5616bd-1cc4-11e8-80cb-005056ba24d9  \nFaulting package full name:  \nFaulting package-relative application ID:\n\nCollect the following information for Investigation:\n\n1.  Output of MSINFO32:\n\n  \n\n\\> msinfo32 (File > Save (.nfo), File > Export (.txt)).\n\n1.  Export IDC configuration (IDC GIU > File > Export Configuration)\n\n  \n\n1.  Collect the following logs:\n\n  \nC:\\\\Program Files (x86)\\\\CheckPoint\\\\Identity Collector\\\\\\*\n\nC:\\\\windows\\\\temp\\\\ia\\_\\*\n\nC:\\\\windows\\\\temp\\\\IDCLog\\\\\\*\n\nC:\\\\Windows\\\\SysWOW64\\\\config\\\\systemprofile\\\\AppData\\\\Local\\\\CrashDumps\\\\cpidc.exe.\\*.dmp\n\nC:\\\\ProgramData\\\\Microsoft\\\\Windows\\\\WER\\\\ReportQueue\\\\AppCrash\\_cpidc.exe\\_\\*\n\n  \n\n1.  If necessary, we can increase the Max Files for Debug (default 10) and Max Debug File Size (default 10485760).\n\nHKEY\\_LOCAL\\_MACHINE\\\\SOFTWARE\\\\WOW6432Node\\\\CheckPoint\\\\IdentityCollector\\\\\n\nDebugMaxFiles - Decimal: 150\n\nDebugMaxSize - Decimal: 20485760 \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorStefan Drapeau\n\nTechnical ResourceJames Brunsting\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2018-03-18\n\nLast Modified2024-12-02\n\nEditorStefan Drapeau\n\nLast ApproverRyan Puckett","language":"md","time":"14 days ago","created":"2025-05-06T22:56:14.654Z","annotations":[],"updated":"2025-05-06T22:59:00.636Z"},{"title":"Multi-Domain Management Processes and Data Flow","id":"e212cebe-9727-4da0-b4be-6ea2b1a63a61","type":"TEXT","raw":"## Multi-Domain Management Processes and Data Flow\n\nThe **CPM process** was introduced in R80. It is a main process of the Management server, responsible for writing all information to the PostgreSQL and SOLR databases. Authentication requests are forwarded from CPM to FWM of Multi-Domain Management and Domain.\n\nCPM processes:\n\n-   **web\\_services** is a component within CPM process that serves GUI and remote client (like remote API) and responsible to transfer the request to the _dleserver_\n-   **DLE server (dleserver)** is a component within the CPM server that contains all the logic of the server to writing the info to the database and SOLR\n-   **object\\_store** is a component within the CPM server, responsible to write the information to SOLR search engine and to the PostgreSQL database\n-   **SOLR** is the Full Text Search engine that contains full clone of all data from PostgreSQL database\n-   **PostgreSQL DB (CPM Postgres)** is central database that contains all Multi-Domain and Domains objects including a field (column) for \"domainid\".\n\n### Data Flow\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95329/MDS-data_flow1708080214.png)\n\n1.  SmartConsole client connects to _CPM_ daemon on port 19009, while embedded SmartDashboard is still running in the background for legacy operation.\n2.  SmartConsole client connects to FWM process of Multi-Domain Security Management (MDS) using port 18190. Authentication request is forwarded from _CPM_ to _FWM_ of MDS. Note that the _CPMI_ process is still is use to talk with _FWM_ for legacy operations.\n3.  Connections are established on port 19009:\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95329/connections1708080234.png)\n    \n4.  _CPM_ process talks to _FWM_ daemon of Multi-Domain Domains and updates them about object creation, changes and legacy operations. Also CPM provides different services to _FWM_, like data storage (DB), queries, and more.\n\n## Connections between Multi-Domain processes\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95329/2.jpg)\n\n  \nThe MDS DB gets content from the Domain DB (servers) through connections between the MDS and the Domain Management Servers. For each Domain Management Server on the physical machine, an internal CPMI client within the fwm process is created.  \nThe CPMI client establishes a read-only connection to the fwm of its designated Domain Management Server. It reads the contents of several tables and passes the information up to the MDS DB.  \nOnce initial data is processed, the CPMI client registers for notification on changes in relevant Domain Management Server database tables. By doing so, we assure any changes made to objects in the Domain Management Server are known to the MDS, and updated in the MDS DB.\n\nIn a similar way, an internal CPMI client connects between fwm processes of different MDS servers that belong to a single Multi-Domain Management solution.\n\nWhen a change is saved to a Domain database, through a connected SmartConsole, it is immediately reported to the fwm of the hosting MDS. The other MDS's get a notification on the change immediately thereafter. Similarly they are notified of changes made by a SmartDomain Manager connected to a peer MDS.\n\nLooking inside a connection between a CPMI client component and an FWM, we observe the following steps:\n\n1.  **SIC authentication** - trust is established between the client and the server. If they are remote, encryption method is negotiated.\n2.  **Open Database** - remote database is opened for reading (in some cases for writing as well). The server is preparing itself to receive queries and updates from the client.\n3.  **Query Tables** - the client queries predefined tables from the server\n4.  **Register for Notification** - the client requests that the server generates a notification for changes in specified tables.\n\n## Databases Synchronization\n\nEvery session is private. Changes cannot be seen by other administrators until the changes are published. When all the modifications have been completed, the administrator publishes the session. Only then will the changes become public and visible to all other administrators. User can work on any peer, and all changes will be synchronized to all other peers on session publishing.\n\nThe Global Database shares the same synchronization scheme as the Domain database. The synchronization is done in an _active-standby_ scheme. One server is active, while the rest of the servers are standby.  \nR/W clients can only connect to the active server, therefore only the active server can modify the database.  \nR/O access to the standby servers is permitted.\n\nThe active/standby state of a server is dynamic and can be changed through the SmartConsole. It is allowed to change a server to active only after it was synchronized. It can be forced otherwise though.\n\n## Multi-Domain Management Data Structure\n\n<table id=\"limitationTable\"><tbody><tr><td>Directory</td><td>&nbsp;</td><td>Contents</td><td>Sub-Directories</td></tr><tr><td><strong>/opt&nbsp;</strong></td><td rowspan=\"2\">General Data&nbsp;</td><td><ul><li>Installation of all fixed files (binaries, libraries, etc.)</li><li>Directories for different installation packages&nbsp;</li><li>Soft-links to variable data installed in<br><em>/var</em> directory</li></ul></td><td><ul><li><em>CPEdgecmp-&lt;Version&gt;</em> - Edge Compatibility Package</li><li><em>CPmds-&lt;Version&gt;</em>&nbsp;- Multi-Domain Management Server</li><li><em>CPngcmp-&lt;Version&gt;</em>&nbsp;- VPN-1 NG Compatibility Package&nbsp;</li><li><span><em>CPshared</em> – “SVN Infrastructure” (mainly softlinks)</span></li><li><em>CPshrd-&lt;Version&gt;</em>&nbsp;- SVN Infrastructure</li><li><em>CPsuite-&lt;Version&gt;</em>&nbsp;- Main VPN-1 Package</li><li><em>CPvsxngxcmp-&lt;Version&gt;</em>&nbsp;- VPN-1 VSX Compatibility Package</li><li><em>CPInstLog</em> – Installation Logs</li></ul></td></tr><tr><td><strong>/var&nbsp;</strong></td><td><em>/var/opt/CPmds-&lt;Version&gt;</em>&nbsp;</td><td><ul><li><em>CPmds-&lt;Version&gt;/conf</em> – Global&nbsp;Database</li><li><em>CPmds-&lt;Version&gt;/conf/mdsdb</em> – MDS&nbsp;Database</li><li><em>CPmds-&lt;Version&gt;/log</em> – MDS level Audit logs, process debug logs</li><li><em>CPmds-&lt;Version&gt;/customers</em> – Domain Data</li><li><em>CPshrd-&lt;Version&gt;</em><ul><li><em>CPshrd-&lt;Version&gt;/conf</em> – licenses, CA certificate</li><li><em>CPshrd-&lt;Version&gt;/registry</em> – top-level Registry (settings)</li><li><em>CPshrd-&lt;Version&gt;/log</em> – <em>CPShared</em>-level process debug logs</li></ul></li></ul></td></tr><tr><td><strong><em>/var/opt/CPmds-&lt;Version&gt;</em></strong><br><strong><em>/customers/</em></strong><br><strong><em>&lt;server name&gt;&nbsp;</em></strong></td><td>Domain Data</td><td>Files related to specific&nbsp;Multi-Domain Domain&nbsp;</td><td><ul><li><em>CPEdgecmp-&lt;Version&gt;</em></li><li><em>CPngcmp-&lt;Version&gt;</em></li><li><em>CPshrd-&lt;Version&gt;</em><ul><li><em>CPshrd-&lt;Version&gt;/registry</em> – Domain Management Server-level Registry</li><li><em>CPshrd-&lt;Version&gt;/conf</em> –Domain Management Server-level licenses, CA certificate</li></ul></li><li><em>CPsuite-&lt;Version&gt;</em><ul><li><em>CPsuite-&lt;Version&gt;/fw1/conf/</em> – Domain Database</li><li><em>CPsuite-&lt;Version&gt;/fw1/log/</em> – Domain Logs</li></ul></li><li><em>CPvsxngxcmp-&lt;Version&gt;</em></li></ul></td></tr></tbody></table>\n\n**Location of Named Resources**\n\n<table><tbody><tr><td>&nbsp;</td><td>Domain Logs</td><td>MDS Logs&nbsp;</td></tr><tr><td rowspan=\"2\"><strong>Logs</strong></td><td><em>/var/opt/CPmds-&lt;Version&gt;/&lt;server name&gt;/&lt;Domain name&gt;/CPsuite-&lt;Version&gt;/fw1/log&nbsp;</em></td><td><em>$MDSDIR/log</em></td></tr><tr><td colspan=\"2\"><p>Installation/Upgrade logs:</p><ul><li>/opt/CPInstLog</li><li>$FWDIR/conf/upgrade_log.txt</li></ul></td></tr><tr><td><strong>CA certificates</strong></td><td><em>/var/opt/CPmds-&lt;Version&gt;/customers/&lt;server name&gt;/CPshrd-&lt;Version&gt;/conf</em></td><td><em>/var/opt/CPshrd-&lt;Version&gt;/conf&nbsp;</em></td></tr><tr><td><strong>CPM logs</strong>&nbsp;</td><td colspan=\"2\"><em>$MDS_TEMPLATE/log/cpm.elg, postgres.elg and solr.elg&nbsp;&nbsp;</em></td></tr></tbody></table>\n\n## Domain Management Server processes\n\n<table><tbody><tr><td>Process</td><td>Description</td><td>Instances</td></tr><tr><td><em>CPM</em></td><td>Main Management process (for all Domains)</td><td>One instance</td></tr><tr><td><em>FWM</em></td><td>Part of server for specific requests from SmartConsole</td><td>One per Domain</td></tr><tr><td><em>postgres</em></td><td>Domain Database&nbsp;&nbsp;</td><td>One instance&nbsp;</td></tr><tr><td><em>Solr</em></td><td>Logging database&nbsp;</td><td>One instance&nbsp;</td></tr><tr><td><em>FWD</em></td><td>Serving Log Server</td><td>One per Domain&nbsp;</td></tr><tr><td><em>CPD</em></td><td><ul><li>Policy fetching server</li><li>Local status AMON server</li></ul></td><td>One per Domain&nbsp;</td></tr><tr><td><em>CPCA</em></td><td>CA Daemon</td><td>One per Domain&nbsp;</td></tr><tr><td><em>CPLMD</em></td><td>Serving SmartView Tracker clients</td><td>One per Domain&nbsp;</td></tr><tr><td><em>CPSTAT_MONITOR</em></td><td>Threshold monitoring for SmartView Status</td><td>One per Domain&nbsp;</td></tr><tr><td><em>SMS</em></td><td>Serving VPN-1 Edge clients</td><td>One per Domain&nbsp;</td></tr></tbody></table>\n\n## Layers in Multi-Domain policies\n\nMulti-Domain environments in R80.10 use Layers to segregate different parts of the rulebase for different permission profiles. Inside a global policy layer, a placeholder for domain rules appears. It represents the place in which the domain rules will be applied upon global policy assignment. Global rules can be defined above and below the placeholder.\n\nUpon global policy assignment, all of the domain's policies are updated with the global rules. The placeholder from the global domain is seen as a \"parent rule for domain policy\". Its action is \"domain layer\", and it has a \"domain layer\" inside with all of the local domain rules. The domain administrator can select a different domain layer or choose not to have any domain layer.\n\nWhen the gateway evaluates the rules in the local policy, if there is no match for the global rules at the top of the rulebase, it starts to evaluate the rules from the domain layer. If there is still no match for those rules, the global rules that were created below the domain layer are evaluated.\n\n## Debugging\n\nWhen starting debug on a Domain Management Server process, first go to Domain Management Server context using the **_mdsenv_** command.\n\nExample:\n\nTo start fwd debug output in Management Server _my\\_mgt1,_ run:\n\n_\\# mdsenv my\\_mgt1_  \n_\\# fw debug fwd on TDERROR\\_ALL\\_ALL=3_\n\nEach line in the log file contains a header stating the Process name and ID, thread-ID, host name and a timestamp, followed by the actual debug message.\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk95329/3a1507150040.jpg)\n\n### FWM process debug\n\nIn the MDS context, the _fwm_ process is called with the \"_mds\"_ parameter.  \n**bash/sh debug syntax:**\n\n_\\# env TDERROR\\_ALL\\_ALL=3 fwm -d mds > mds.dbg 2>&1_\n\n**tcsh/csh/bcsh debug syntax:**\n\n_\\# env TDERROR\\_ALL\\_ALL=3 fwm -d mds >& mds.dbg_\n\n_**Note:**_ since the MDS code does not define topics, always use the _ALL_ topic and severity at least 3, when debugging the MDS process  \n \n\n### CPM process debug\n\n**Note**: CPM process prints a lot of information to its logs by default. Start debug only after investigating the logs and deciding it is really necessary. All CPM debug files exist only on the MDS level, each file is relevant for all Domains.\n\nThere are 3 main output files of CPM debug:\n\n1.  _cpm.elg_ - main debug output file of CPM server. By default it prints all logs from level error/warning/info.\n    \n    To enable logs in lower severity, you should choose specific class or a topic from _$MDS\\_TEMPLATE/conf/tdlog\\_topic.xml_  file. [Contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/) for assistance.\n    \n    Note: when enabling debug on CPM, the logs can be overridden quickly. By default we save 10 logs files of 20 MB each. To save more, refer to [sk129452](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk129452).\n    \n2.  _postgres.elg_ - logs of postgres database. By default it prints only error logs.\n    \n    To turn its logs on / off, use the scripts  \n    _$MDS\\_TEMPLATE/scripts/postgres\\_logs\\_on.sh_ and  \n    _$MDS\\_TEMPLATE/scripts/postgres\\_logs\\_off.sh_\n    \n3.  _solr.elg_ - logs of solr, Full Text Search engine.\n\nTo enable the CPM debug, run the script:\n\n**_$MDS\\_TEMPLATE/scripts/cpm\\_debug.sh -t <topic> -s <severity>_**\n\nThe topics can be selected from _$MDS\\_TEMPLATE/conf/tdlog\\_topic.xml_ file.\n\nExamples:\n\n-   Enable Validation topic logs (DEBUG severity by default): _$MDS\\_TEMPLATE/scripts/cpm\\_debug.sh -t validation_\n-   Enable Validation topic logs with INFO severity: _$MDS\\_TEMPLATE/scripts/cpm\\_debug.sh -t validation -s INFO_\n-   Enable Validation and HA topics: _$MDS\\_TEMPLATE/scripts/cpm\\_debug.sh -t validation ha_\n-   Remove from _tdlog.cpm_ topics with INFO severity: _$FWDIR/scripts/cpm\\_debug.sh -r_\n\n### Default Locations of debug log files\n\n<table><tbody><tr><td>Process Name</td><td>File location in Domain Management server context</td><td>File location in MDS context</td></tr><tr><td><p>mds / fwm</p></td><td><em>$FWDIR/log/fwm.elg</em></td><td><em>$MDS_TEMPLATE/log/mds.elg</em><br>AND <em>$MDSDIR/log/mds.log</em></td></tr><tr><td rowspan=\"3\">cpm</td><td rowspan=\"3\">-</td><td><em>$MDS_TEMPLATE/log/cpm.elg</em></td></tr><tr><td><em>$MDS_TEMPLATE/log/postgres.elg</em></td></tr><tr><td><em>$MDS_TEMPLATE/log/solr.elg</em></td></tr><tr><td>cpd</td><td><em>$CPDIR/log/cpd.elg</em></td><td><em>$CPDIR/log/cpd.elg</em></td></tr><tr><td>fwd</td><td><em>$FWDIR/log/fwd.elg</em></td><td><em>$MDS_TEMPLATE/log/fwd.elg</em></td></tr><tr><td>cpca</td><td><em>$FWDIR/log/cpca.elg</em></td><td><em>$MDS_TEMPLATE/log/cpca.elg</em></td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:14.827Z","annotations":[],"updated":"2025-05-06T22:59:40.711Z"},{"title":"Product Quantum Appliances, Quantum Maestro, Quantum Security Gateways","id":"ee08eebe-3dd9-4dea-bec2-305b54237bd5","type":"TEXT","raw":"ProductQuantum Appliances, Quantum Maestro, Quantum Security Gateways\n\nVersionR80.20SP (EOS), R80.30SP (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-03-25\n\n## Solution\n\nCollapse the Entire Article\n\n**Note**: Click **[here](https://support.checkpoint.com/product/520#aq=(%40source%3D%3D(%22Downloads%22)%20AND%20%40product_versions_pairs%3D%3D(%22Quantum%20Maestro%7CR81.20%22%2C%22Quantum%20Maestro%7CR82%22%2C%22Quantum%20Maestro%7CHardware%22%2C%22Quantum%20Maestro%7CR80.20SP%20(EoS)%22%2C%22Quantum%20Maestro%7CR80.30SP%20(EoS)%22%2C%22Quantum%20Maestro%7CR81%20(EOS)%22%2C%22Quantum%20Maestro%7CR81.10%22%2C%22Quantum%20Maestro%7CAll%22))%20OR%20(%40source_name%3D%3D(%22SecureKnowledge%22)%20AND%20%40landing_page_type%20%3D%20(%22howto%22%2C%22config%22)%20AND%20%40status%20%3D%20(%22Approved%22%2C%22Approved%20by%20TAC%22)%20AND%20(%40products%20%3D%3D%20(%22Quantum%20Maestro%22)))%20OR%20(%40source%3D%3D(%22Documentation%22)%20AND%20(%40product_versions_pairs%3D%3D(%22Quantum%20Maestro%7CR81.20%22%2C%22Quantum%20Maestro%7CR82%22%2C%22Quantum%20Maestro%7CHardware%22%2C%22Quantum%20Maestro%7CR80.20SP%20(EoS)%22%2C%22Quantum%20Maestro%7CR80.30SP%20(EoS)%22%2C%22Quantum%20Maestro%7CR81%20(EOS)%22%2C%22Quantum%20Maestro%7CR81.10%22%2C%22Quantum%20Maestro%7CAll%22))))** for Quantum Maestro documentation.\n\n##   \nQuantum Maestro Basics\n\n-   What is a Maestro Hyperscale Orchestrator (MHO)?  \n    \n    > An MHO is a scalable Network Security System that connects multiple Check Point Security Appliances into a unified system.\n    \n-   What is a Single Management Object (SMO)?  \n    \n    > An SMO is a single Security Gateway object in SmartConsole that represents a Security Group configured on Quantum Maestro Orchestrator. \n    \n-   What is a Security Gateway Module (SGM) and how many are supported?  \n    \n    > A Security Group is a group of SGMs represented by an SMO.\n    > \n    > SGMs in a security group share the same:\n    > \n    > -   Security policy\n    > -   Configuration\n    > -   Software versions and Hotfixes\n    > -   Routing information\n    > \n    > Traffic is shared between members of a Security Group according to their distribution mode settings.\n    > \n    > Currently, a maximum of 8 Security Groups are supported.\n    > \n    > A single-site Security Group supports a maximum of 14 appliances.\n    > \n    > A dual-site Security Group supports a maximum of 28 (14 per site) appliances.\n    > \n    > **Note**: In R81 and higher versions, the maximum number of Security Gateway Members (SGMs) for each site is 14 for single-site **and** dual-site deployments.\n    \n\n## Quantum Maestro Hardware\n\n-   Does Check Point use a branded solution or its own product?  \n    \n    > The Orchestrator, which executes the orchestration and distribution functions, runs Check Point code.\n    \n-   Does Maestro need specific interface cards for Check Point appliances on downlinks?  \n    \n-   In a dual Orchestrator deployment, can the SGM be connected to one Orchestrator only?  \n    \n    > No. One downlink to each orchestrator is required for the SGM to be Active. If the two Orchestrators are up and one downlink is down, the SGM will be placed in a Down state.\n    \n-   Does Maestro support MDPS and CoreXL Dynamic Split running together?  \n    \n    > No. It is not supported to run MDPS and CoreXL Dynamic Split together on the same Security Group.\n    \n-   Is it possible to share uplink interfaces between Security Groups?  \n    \n    > A bonded interface can be shared between multiple Security Groups. However, an LACP bond shared between multiple Security Groups decreases the segregation between these Security Groups.\n    > \n    > For example, if Security Group 3 and Security Group 4 share eth1-05 and eth2-05 as subordinates of an LACP bond, and for some reason Security Group 3 stops sending LACP packets to the external switch, then traffic in VLAN interface eth1-05.40 could be affected. Using shared bonds in other bond modes (for example: XOR) does not decrease the segregation\n    \n-   Is it possible to share appliances between Security Groups? Can an appliance be part of two Security Groups at the same time?  \n    \n    > An appliance can be moved between Security Groups, but it cannot participate in more than one Security Group at the same time.\n    \n-   How many Management ports are supported?  \n    \n    > MHO-140 supports up to four Management ports for each Orchestrator.\n    > \n    > MHO-170 supports two Management ports for each Orchestrator.\n    > \n    > MHO-175 supports one Management port for each Orchestrator.\n    > \n    > Management ports can be shared between Security Groups.\n    \n-   Which Check Point appliances are supported?  \n    \n-   Are there any differences between regular appliances and appliances with MHO SKUs?  \n    \n    > Appliances with MHO SKUs might be different from normal appliance SKUs (memory, NICs, etc). Please refer to the [Product Catalog](https://usercenter.checkpoint.com/usercenter/portal/media-type/html/role/usercenterUser/page/default.psml/js_pane/PricingToolsId%2CProductsCatalogId?https://store.checkpoint.com/PricingTool/cart.htm) for more details.\n    \n-   Is Open Server support planned?  \n    \n-   Is it possible to move customers' environments running Check Point clusters under MHO?  \n    \n    > Yes, this is a possible scenario. Check Point recommends that you contact [Professional Services](https://www.checkpoint.com/support-services/design-deploy-operate-optimize/) for the migration process.\n    \n-   How many Orchestrators are supported in a cluster?  \n    \n    > In single-site installation, two Orchestrators can can work together. In dual-site installation, either single or dual Orchestrators per site works, but there must be the same number on both sites. (2x1 or 2x2). Support for more than two sites is planned for a future release.\n    \n-   MHO supports 1m and 3m DAC cables. Are there any plans to add support for 5m and 10m cables?  \n    \n    > 5m and 10m cables can be certified based on business cases. \n    \n-   Does the breakout DAC require transceivers on either end?  \n    \n    > No transceivers are required.\n    \n-   Are there breakout cables for uplinks?  \n    \n    > Yes. CPAC-TR-40SPLIT-QSFP-3M or CPAC-TR-40SPLIT-QSFP-6M can be used with CPAC-TR-40SR-QSFP-300m transceiver.\n    \n-   Is it supported to use 3rd party DAC cables?  \n    \n    > Check Point does not support 3rd party DAC cables.\n    \n-   Which transceivers can be used on uplink ports?  \n    \n    > For a full list of transceivers, refer to [sk92755](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92755).\n    \n-   Does Check Point plan to phase out Scalable Platforms (44000/64000) appliances?  \n    \n    > Maestro serves as an extension of Scalable Platform capabilities to other Check Point Appliances and not as a replacement to the 44000/64000 line. Chassis-based solutions have specific use cases and will continue to evolve according to the roadmap.\n    \n-   How long are the included DAC cables?\n    \n    > We provide 2 cables: one is 1m long, the other is 3m long.\n    \n-   Are there any additional transceivers needed for connecting the Orchestrator to LAN/DMZ/Internet/etc?\n    \n    > Yes. For a list of supported transceivers, refer to [sk92755](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92755).\n    \n-   Is it supported to use fiber transceivers/cables for downlinks?\n    \n    > Yes:\n    > \n    > -   Up to 300m length Short Range with suitable 10Gbps/40Gbps transceivers, and up to 100m with 100Gbps transceivers (see [sk92755](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92755))\n    > -   UUp to 10km length Long Range with suitable 10Gbps/40Gbps/100Gbps transceivers (see [sk92755](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92755))\n    > \n    > These limitations are related to transceivers’ physical capabilities. Connection through patch panel is supported.\n    \n-   Is MHO-175 compatible with MHO170?\n\n## Quantum Maestro Software\n\n-   How does synchronization work? Is there an overhead with potentially 52 appliances in a MHO installation?  \n    \n    > MHO uses a special synchronization solution called HyperSync which provides high scale synchronization support without sacrificing Security Gateway performance.\n    \n-   Does Check Point support virtual MHOs running in Private or Public Clouds?  \n    \n-   Is it possible to monitor individual SGM load information?  \n    \n    > Yes, the same tools can be used as on our Scalable Platforms.\n    \n-   Will the MHO web frontend be built into SmartConsole?  \n    \n    > There are plans to make management of the Security Groups, SGMs and MHO ports even simpler. It's too early to discuss SmartConsole integration, although Check Point is interested in customers' requirements and use cases.\n    \n-   Is MHO available in SmartConsole?  \n    \n    > The individual Security Groups under MHO are available as SMOs in SmartConsole as Hardware Type Maestro. This makes the underlying architecture easier to manage in SmartConsole.\n    \n-   Which versions of Check Point's Security Management Server/Multi Domain Management can be used to manage Maestro?  \n    \n    > R80.10 and R80.20 systems can manage Maestro if Jumbo Hotfix is added. Systems running R80.30 and above can manage it even by default.\n    \n-   Does Check Point support 3rd party orchestration tools with MHO?  \n    \n    > MHO will have full Check Point API support when the Gaia Gateway API is available.\n    \n-   Is it supported to upgrade Security Groups separately? Can they run different software releases?  \n    \n    > Security Groups work independently from one another and therefore they can run on different software versions.\n    \n-   Is there any downtime introduced while upgrading SGMs in a Security Group with JHFs?  \n    \n    > SGMs can be upgraded individually or in groups without introducing downtime.\n    \n-   Is any downtime introduced while upgrading the Orchestrators?  \n    \n    > If the Orchestrators are in cluster, no downtime is introduced.\n    \n-   How does SIC work with MHO?  \n    \n    > Each Security Group has its own SMO. SIC is built up with the SMO and shared between SGMs in the same Security Group.\n    \n-   How does the Security Management count the Gateway licenses in MHO?  \n    \n    > 1 Security Group equals 1 Gateway license.\n    \n-   How is the MHO system licensed?  \n    \n    > There is no specific license needed on the MHO.\n    \n-   How is a Security Group or Multiple Security Groups (MSG) licensed?  \n    \n    > There is no specific license needed for Security Groups.\n    \n-   How are the SGMs licensed?  \n    \n    > The SGMs use the same licensing methodology as any other Check Point appliances. All features must be licensed per Gateway and the same type of licenses must be applied to all SGMs in a Security Group.\n    > \n    > Licenses must be created with local licensing method, and the Gateway portion must be the sync IP of the appliance matching the SKU (for example: appliance one sync IP is: 192.0.2.1\n    \n-   Is the LTE feature set supported?  \n    \n    > The CGNAT feature is supported with R80.20SP and R81SP. Other features of the LTE feature set will be added in the next releases.\n    \n-   Which release enables vSwitch support?\n-   Which release enables dual-site support?\n-   Which clustering modes are supported in dual-site?\n    \n    > Currently, the supported clustering modes in dual-site are SGW active-standby mode, VSX active-standby mode, and VSLS. These modes are per Security Group and can be different for each one. Example: Security Group 1 can be active on site A while the standby is on site B; Security Group 2 can be active on site B and standby on site A.\n    > \n    > Starting in version R82, the active-active clustering mode is a **limited availability** feature.\n    \n\n## Quantum Maestro Redundancy and Scaling\n\n-   Is interface bonding between MHO and downlink appliances available?  \n    \n    > There's an automatic bonding inside, so if you are connecting more than one cable, it will be linked into the bond automatically. No additional configuration is required, but make sure to refer to the documentation for information on how to share downlinks between Orchestrators.\n    \n-   Is interface bonding between MHO and uplink network systems available?  \n    \n    > Yes, this is the recommended configuration.\n    \n-   Is there a redundant sync between two MHOs?  \n    \n    > Supported with R80.20SP Jumbo Hotfix Accumulator Take 210 or higher (see MBS-7993 in [sk155832](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk155832)).\n    \n-   What throughput is needed between MHOs for sync?  \n    \n    > MHO-170 and MHO-175 require 40GB or 100GB DAC cables or transceivers. MHO-140 requires a 10GB DAC cable or transceivers.\n    \n-   Does Check Point support single MHO appliance installations?  \n    \n    > Yes, but it's recommended to have two MHOs to provide redundancy and avoid a single point of failure.\n    \n-   Is redundancy between different appliance models in a Security Group supported?  \n    \n    > Redundancy between different appliance models in a Security Group is supported starting in R81.10.  \n    > Refer to [sk162373](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk162373) for certified combinations of Security Appliance models in the same Security Group.\n    \n-   Does the MHO support Dynamic Scaling?  \n    \n    > Dynamic Scaling (Auto-Scaling) is supported starting with R81.20. With Auto- Scaling, the system adds/removes SGMs from a Security Group or moves SGMs between Security Groups dynamically when the load requires it and if the scaling rules permit it.\n    \n-   Does Maestro support CoreXL Dynamic Balancing?  \n    \n    > Yes, CoreXL Dynamic Balancing is supported starting in R81.20.\n    \n-   Does Maestro support Hyperflow?  \n    \n    > Yes, Hyperflow is supported starting in R81.20.\n    \n-   Is there any throughput degradation when adding multiple SGMs to a Security Group?  \n    \n    > Check Point reduced throughput degradation to 1% per added SGMs. For example, the overall throughput degradation is 10% for 10 SGMs in a Security Group. Check Point aims to reduce this even further in the future.\n    \n-   Is there a redundant sync between MHOs?  \n    \n    > -   Supported with R80.20SP Jumbo Hotfix Accumulator Take 210 or higher (see MBS-7993 in [sk155832](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk155832)).\n    \n-   Is Multi-Queue setup needed on SGMs?  \n    \n    > Multi-Queue is set up automatically. There is no need to modify the configuration.\n    \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorLaszlo Csosza\n\nTechnical ResourceAnatoly Masover\n\nAccess LevelGeneral\n\nStatusApproved by TAC\n\nDate Created2019-02-25\n\nLast Modified2025-03-25\n\nEditorLiron Rubin\n\nLast ApproverLiron Rubin\n\n## Comments\n\n#### Internal only\n\nThis SK applies to R82.10 as well","language":"md","time":"14 days ago","created":"2025-05-06T22:56:15.013Z","annotations":[],"updated":"2025-05-06T22:59:45.740Z"},{"title":"Merge Solutions into sk128652","id":"9df45506-71fa-44f3-8211-8f6458a829b5","type":"TEXT","raw":"The following solutions were merged into sk128652:  \nsk91600, sk95747, sk102446, sk105528, sk111402, sk114580, sk115712, sk116933, sk123233, sk114593, sk109341, sk110911\n\n**Important note: Prior to using the tools mentioned in this article, make sure you thoroughly go over [sk156153 - Best Practice Guide for Debugging Check Point Products](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk156153).**\n\n## Scenario 1\n\n**Originator:** Darryl Maurice\n\n**Technical Resource:** Craig Bentsen\n\n**SRs:**\n\n-   [28-520276171](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewservicerequestdetails=&js_peid=P-114a7bc3b09-10006&servicerequestid=28-520276171)\n-   [28-931477841](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewservicerequestdetails=&js_peid=P-114a7bc3b09-10006&servicerequestid=28-931477841)\n\n**Task:**  34039\n\n___\n\n## Scenario 2\n\n**Originator:** Ricardo Sznaidleder\n\n**Technical Resource:** \n\n**SR:** [28-783741651](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewservicerequestdetails=&js_peid=P-114a7bc3b09-10006&servicerequestid=28-783741651)\n\n___\n\n## Scenario 8\n\n**Originator:** Daniel Levy\n\n**Technical Resource:** Dolev Levi\n\n___\n\n## Scenario 9\n\n**Originator:** Orel Vanounou\n\n**Technical Resource:** Erez Fremder\n\n**SR:** [1-9974485071](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewservicerequestdetails=&js_peid=P-114a7bc3b09-10006&servicerequestid=1-9974485071)\n\n**CR:** [CR01490627](http://cqweb-il.checkpoint.com/cqweb/main?command=GenerateMainFrame&service=CQ&schema=7.1&contextid=CR&entityDefName=CRs&entityID=CR01490627)\n\n**Task:** 78762\n\n**Note to TAC Engineers:**\n\nPacket Capture taken from the client during replication shows that the TCP handshake with the RA Gateway was completed as expected although the client hello packet for SSL negotiation was sent two times without a corresponding Server Hello reply until the TCP connection was terminated by the RA Gateway with a FYN-ACK.\n\n**CR01490627** should be ported to resolve the issue.\n\n**Findings from SR:1-9974485071 (VSX)**\n\n########################################################################\n\nConnection information:\n\n########################################################################\n\nClient to VS5 public IP:\n\n61.88.194.149:51272 -> 159.12.192.34:443\n\n\\-------------------------------------------------------\n\nClient to VS5 funny IP:\n\n61.88.194.149:51272 -> 192.168.196.17:443\n\n########################################################################\n\nThe TCP handshake is completed with no issues:\n\n########################################################################\n\nThe first SYN:\n\n;14Feb2018 5:57:12.050851;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];fwconn\\_lookup: conn <dir 0, 61.88.194.149:51272 -> 159.12.192.34:443 IPP 6>;\n\n;14Feb2018 5:57:12.050853;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];fwconn\\_lookup: not found in connections table;\n\n\\-----\n\nThe SYN-ACK: (192.168.196.17 is VS5 funny IP):\n\n;14Feb2018 5:57:12.051152;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];fwconn\\_lookup: conn <dir 1, 192.168.196.17:443 -> 61.88.194.149:51272 IPP 6>;\n\n\\-----\n\nThe ACK:\n\n;14Feb2018 5:57:12.193292;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];fwconn\\_lookup: conn <dir 0, 61.88.194.149:51272 -> 159.12.192.34:443 IPP 6>;\n\n##################################################################################################################\n\nMDP (mux)info regarding the connection :\n\n##################################################################################################################\n\n;14Feb2018 5:57:12.193324;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];vm\\_mux\\_cpas\\_generic\\_event\\_handler: received CPAS\\_CONN\\_CONNECTED on CPAS\\_CLIENT\\_SIDE;\n\n.\n\n;14Feb2018 5:57:12.193346;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];client\\_conn : dir 0, 61.88.194.149:51272 -> 192.168.196.17:443 IPP 6;\n\n.\n\n;14Feb2018 5:57:12.351759;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];client\\_conn : dir 0, 61.88.194.149:51272 -> 192.168.196.17:443 IPP 6;\n\n.\n\n##################################################################################################################\n\nSSL parsing was initiated...\n\n##################################################################################################################\n\n;14Feb2018 5:57:12.351766;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];is\\_ssl: Looks like TLS;\n\n;14Feb2018 5:57:12.351768;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];vm\\_mux\\_cpas\\_generic\\_read\\_handler: SSL Detected!;\n\n##################################################################################################################\n\nFailed with the 0x1bb ID as it probably the first SYN in this connection and thus can't find it in the \"cptls\\_params\\_id\\_map\" kernel table?\n\n##################################################################################################################\n\n;14Feb2018 5:57:12.351770;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];get\\_cptls\\_params\\_id: entering with params 159.12.192.34 0x1bb;\n\n;14Feb2018 5:57:12.351773;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];get\\_cptls\\_params\\_id: 'ld\\_get' failed with params: 0x36403, 159.12.192.34, 0x1bb;\n\n##################################################################################################################\n\nThe default ID works OK \"succeeded with: 0xED274044;\" and the pasring process continue...\n\n##################################################################################################################\n\n;14Feb2018 5:57:12.351775;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];vm\\_mux\\_cpas\\_generic\\_read\\_handler: get\\_cptls\\_params\\_id failed, trying to get default id;\n\n;14Feb2018 5:57:12.351776;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];get\\_cptls\\_default\\_params\\_id: called;\n\n;14Feb2018 5:57:12.351778;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];get\\_cptls\\_default\\_params\\_id: succeeded with: 0xED274044;\n\n########################################################################\n\nThe kernel fails to deliver the Trap to the Daemon( function cptls\\_send\\_trap) - Daemon is VPND?, or another Daemon?\n\n########################################################################\n\n;26Feb2018 3:03:32.444667;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];fw\\_send\\_kmsg: log buffer for tsid 2 is full. len = 96;\n\n;26Feb2018 3:03:32.444669;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];fw\\_send\\_kmsg: log\\_first:0, log\\_last:163756, free space:91 ;\n\n;26Feb2018 3:03:42.351807;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];cptls\\_send\\_trap: fw\\_send\\_kmsg failed!;\n\n;26Feb2018 3:03:42.351808;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];fwtls\\_one\\_side: cptls\\_call\\_hs\\_new failed;\n\n########################################################################\n\nVS5 terminates the connection by sending FYN-ACK:\n\n########################################################################\n\n;14Feb2018 5:57:12.351930;\\[vs\\_5\\];\\[tid\\_0\\];\\[fw4\\_0\\];Before VM: <dir 1, 192.168.196.17:443 -> 61.88.194.149:51272 IPP 6> (len=40) TCP flags=0x11 (FIN-ACK), seq=4c9430e6, ack=d01ec5d, data end=4c9430e7 (ifn=2) (first seen) (looked up) ;\n\n....\n\n\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\n\nFindings from 24.2.18 - VPND: 14Feb2018 5:57:12\n\n\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\n\nCould not see any correspondent communication.\n\n___\n\nFollowing Check Point responses to the following CVE's :\n\nCVE-2015-2808 (Bar Mitzvah) [sk106478](http://supportcontent.checkpoint.com/solutions?id=sk106478)\n\nCVE-2016-2183 (Sweet32) [sk113114](http://supportcontent.checkpoint.com/solutions?id=sk113114)\n\nCustomer decided to disable RC4 and 3DES Cipher suites.\n\nSince then, only Windows clients can connect, while MAC users fails.\n\n___\n\n## Scenario 11\n\n**Originator:** Abraham Escobedo Recio\n\n**Technical Resource:** Brandon Pace \n\n**SR:** [5-1324765061](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewservicerequestdetails=&js_peid=P-114a7bc3b09-10006&servicerequestid=5-1324765061)\n\n___\n\n## Scenario 12\n\n**Originator:** Ryan Ukrainec\n\n**Technical Resource:** Romulo Osorio\n\n**SR:** [1-8145314931](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewservicerequestdetails=&js_peid=P-114a7bc3b09-10006&servicerequestid=1-8145314931)","language":"md","time":"14 days ago","created":"2025-05-06T22:56:15.211Z","annotations":[],"updated":"2025-05-06T23:03:15.142Z"},{"title":"Table with Table for Multiple Pages","id":"733f4149-6b1b-4ec8-b181-2390f1b0c694","type":"TEXT","raw":"<table><tbody><tr><td><h2><strong>Non-Supported Features</strong></h2><ul><li><p>General</p><ul><li><p>General</p></li><li><p>Gaia OS</p></li><li><p>Hardware</p></li><li><p>Licensing</p></li><li><p>Cluster</p></li></ul></li><li><p>Installation / Upgrade</p><ul><li><p>Upgrade</p></li></ul></li><li><p>Infrastructure</p><ul><li><p>VSX</p></li></ul></li><li><p>Networking</p><ul><li><p>Networking</p></li><li><p>IPv6</p></li></ul></li><li><p>Software Blades</p><ul><li><p>Firewall</p></li><li><p>VPN</p></li><li><p>Identity Awareness</p></li><li><p>Data Loss Prevention (DLP)</p></li><li><p>Monitoring / SmartView Monitor</p></li><li><p>QoS</p></li><li></li></ul></li></ul></td><td><h2><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</strong></h2></td><td><ul><li><p>General</p><ul><li><p>General</p></li><li><p>Gaia OS</p></li><li><p>Hardware</p></li><li><p>Management and Policy</p></li><li><p>Dual Site Deployment</p></li><li><p>VoIP</p></li></ul></li><li><p>Installation / Upgrade / Licensing</p><ul><li><p>Installation</p></li><li><p>Licensing</p></li></ul></li><li><p>Infrastructure</p><ul><li><p>Security Gateway</p></li><li><p>VSX</p></li><li><p>SecureXL</p></li><li><p>CoreXL</p></li><li><p>Cluster</p></li><li><p>Hyper-Threading</p></li></ul></li><li><p>Networking</p><ul><li><p>Networking</p></li><li><p>Dynamic Routing</p></li><li><p>IPv6</p></li></ul></li><li><p>Software Blades</p><ul><li><p>Firewall</p></li><li><p>VPN</p></li><li><p>Threat Prevention (Anti-Virus, Anti-Bot, Threat Emulation, Threat Extraction)</p></li><li><p>IPS</p></li><li><p>DLP</p></li><li><p>Identity Awareness</p></li><li><p>Logs</p></li><li><p>Application Control</p></li><li><p>Mobile Access</p></li></ul></li><li><p>Monitoring</p><ul><li><p>SNMP</p></li></ul></li></ul></td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:15.505Z","annotations":[],"updated":"2025-05-06T22:59:05.775Z"},{"title":"Product Quantum Security Gateways","id":"334ce0f9-9bac-4a8e-bed4-273aa81a1e07","type":"TEXT","raw":"ProductQuantum Security Gateways\n\nVersionR80.20SP (EOS), R80.30 (EOS), R80.30SP (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-02-26\n\n#### For internal users only\n\n## Solution\n\n### Background\n\nA TCP connection may terminate in two ways: (1) the normal TCP close sequence using a TCP-FIN handshake, and (2) an \"abort\", in which one or more TCP-RST segments are sent, and the connection state is immediately discarded. See [RFC 793](https://datatracker.ietf.org/doc/html/rfc793) and [RFC 9293](https://datatracker.ietf.org/doc/html/rfc9293).\n\nThe normal TCP close sequence delivers buffered data reliably in both directions. Because the two directions of a TCP connection are closed independently, it is possible for a connection to be \"half-closed\", i.e., closed in only one direction, and a host is permitted to continue sending data in the open direction on a half-closed connection.\n\nThe 'TCP Half-Closed' timer controls the time after which the Security Gateway closes a \"half-closed\" TCP session completely. The 'TCP Half-Closed' timer is triggered by the first TCP-FIN packet the Security Gateway receives for a session.\n\nThe 'TCP Time-Wait' timer is triggered by the second TCP-FIN packet or by a TCP-RST packet the Security Gateway receives for a session.\n\nThe procedure below provides the steps to change the 'TCP Half-Closed' timer value on the Security Gateway from the default value 3600 seconds (1 hour) to a lower value.\n\n###   \nSupported Security Gateway Versions\n\nThe procedure is supported only in these Security Gateway versions:\n\n###   \nProcedure\n\n**Part 1 - Configure the desired timer value:**\n\n1.  Back up the Security Management Server / Domain Management Server.\n    \n    Refer to:\n    \n    -   [sk108902 - Best Practices - Backup on Gaia OS](https://support.checkpoint.com/results/sk/sk108902)\n    -   [sk91400 - System Backup and Restore feature in Gaia](https://support.checkpoint.com/results/sk/sk91400)\n    -   [sk98153 - How to take a snapshot of Endpoint Security Management Server database](https://support.checkpoint.com/results/sk/sk98153)\n2.  Close **all** SmartConsole windows.\n    \n    Verify by running the \"_cpstat mg_\" command on the Security Management Server / in the context of _each_ Domain Management Server.\n    \n3.  Connect with [Database Tool (GuiDBedit Tool)](https://support.checkpoint.com/results/sk/sk13009) to the Security Management Server / Domain Management Server.\n    \n4.  In the upper left pane, go to _**Table**_ > _**Global Properties**_ > _**properties**_.\n    \n5.  In the upper right pane, select the _**firewall\\_properties**_.\n    \n6.  Press CTRL+F (or go to _**Search**_ menu > _**Find**_) > paste _**tcp\\_half\\_closed\\_timeout**_ > click _**Find Next**_.\n    \n7.  In the lower pane, right-click the field _**tcp\\_half\\_closed\\_timeout**_ > select _**Edit**_ > enter the desired number (of seconds) > click _**OK**_.\n    \n    **Best Practice** - Start with 60 seconds (1 minute). If a TCP FIN-ACK packet does not arrive within 60 seconds, we suggest investigating a networking issue.\n    \n    Note - The default value is 3600 seconds (1 hour).\n    \n    Example screenshot:\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk137672/tcp_half_closed_timeout_202402221426491.png)\n    \n8.  Save the changes: go to the _**File**_ menu > click _**Save All**_.\n    \n9.  Close the Database Tool (GuiDBedit Tool).\n    \n\n**Part 2 - Configure the kernel parameter:**\n\n1.  Connect to the command line on the Security Gateway / each Cluster Member.\n    \n2.  Log in to the Expert mode.\n    \n3.  Configure the value of the kernel parameter **fw\\_tcp\\_enforce\\_half\\_closed\\_timeout** to **1** (one):\n    \n    `fw ctl set -f int fw_tcp_enforce_half_closed_timeout 1`\n    \n    **Note** - This command configures the required value in the current session and permanently (survives reboot).\n    \n\n**Part 3 - Install policy:**\n\n1.  Connect with SmartConsole to the Security Management Server / Domain Management Server.\n    \n2.  Install the Security Policy onto the applicable Security Gateway / Cluster / VSX Virtual System object.\n    \n    **Note**: By default, when fw\\_tcp\\_enforce\\_half\\_closed\\_timeout=0, the 'TCP Half-Closed' timer value is determined by the Virtual Session Timeout configured for the service. This means you can reduce the Half-Closed timer by adjusting the Virtual Session Timeout of a specific service.\n    \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorDima Glebov\n\nTechnical ResourceYarden Avirav\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2018-10-04\n\nLast Modified2025-02-26\n\nEditorDima Glebov\n\nLast ApproverLuc Cormorand\n\n## Comments\n\n#### Internal only\n\n### Notes for Support Engineers\n\n(1) In one of the VSX cases, the kernel parameter started working only after a reboot (clearing Connections table alone did not help).\n\n(2) Clarification about the \"zombie\" connections if you configure the value of \"`tcp_half_closed_timeout`\" to 3600 seconds:\n\n1.  Connection is established\n2.  The Security Gateway records it in the Connections table (ID 8158)\n3.  One connection peer sends TCP FIN\n4.  For some reason, either the other connection peer is not replying with FIN-ACK , or the FIN-ACK packet does not arrive to the Security Gateway\n5.  The TCP connection is now in the Half-Closed state\n6.  The 'TCP Half-Closed' timer starts counting down from 3600 seconds (1 hour) - this is basically a \"zombie\" connection in the Connections table\n7.  After a while, the same source tries to open a new connection from the same source port to the same destination to the same port:\n    -   If Smart Connection Reuse is enabled - the TCP SYN packet is converted to TCP ACK, because the connection with the same tuple still exists in the Connections table\n    -   If Smart Connection Reuse is disabled - the TCP SYN packet is dropped with the message \"SYN packet on existing connection\"\n    -   Each time, the same source tries to open a new connection with the same tuple, the TTL for this \"zombie\" connection in the Connections table is reset to back to 3600 seconds - as a result, this \"zombie\" connection is never deleted from the Connections table","language":"md","time":"14 days ago","created":"2025-05-06T22:56:15.705Z","annotations":[],"updated":"2025-05-06T23:02:49.092Z"},{"title":"ProductQuantum Maestro VersionR80.20SP","id":"2f43fbd2-2d5a-470d-96aa-6ed0212c8d81","type":"TEXT","raw":"ProductQuantum Maestro\n\nVersionR80.20SP (EOS)\n\nOSGaia\n\nPlatform13000 (EOL), 15000, 23000, 5000, 6000\n\nLast Modified2023-01-03\n\n## Solution\n\n**Table of Contents:**\n\n-   Introductory Videos\n    \n-   Introduction\n    \n-   Downloads\n    \n-   Known Limitations\n    \n-   Documentation\n    \n-   Revision History\n    \n\n## Introductory and Instructional Videos\n\n#### Introducing Check Point Maestro | A Hyperscale Network Security Solution\n\n[https://www.youtube.com/watch?v=TR5IfFLUkho](https://www.youtube.com/watch?v=TR5IfFLUkho)\n\n#### Light Board Series: Maestro Sales Overview\n\n[https://www.youtube.com/watch?v=lftPDsao4MM](https://www.youtube.com/watch?v=lftPDsao4MM)\n\n#### LightBoard Series: Maestro Technical Deep Dive<iframe width=\"640\" height=\"360\" src=\"https://www.youtube.com/embed/ssGmQ8fVTQw?wmode=transparent\" frameborder=\"0\"></iframe>\n\n##   \nIntroduction\n\nCheck Point Maestro brings the scale, agility and elasticity of the cloud on-premises with efficient N+1 clustering based on Check Point's HyperSync technology, thus maximizing the capabilities of your existing Security Gateways. Create your own virtualized private-cloud premise by stacking together multiple Check Point Security Gateways. Group them according to security feature set, policy, or the assets they protect, and virtualize them further with virtual systems technology.\n\nWith the Maestro Hyperscale Orchestrator, businesses of all sizes can have cloud-level security on-premises. Add compute to meet your needs using Maestro Web UI or RESTful APIs, all while minimizing the risk of downtime and maximizing your cost efficiency.\n\n## Downloads\n\n## Known Limitations\n\nRefer to [sk148074](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk148074) for Check Point Maestro Known Limitations. \n\n## Documentation\n\n##   \nRevision History\n\n## Article Properties\n\nOriginatorLiron Rubin\n\nTechnical ResourceMatan Tenenboim\n\nAccess LevelGeneral\n\nStatusApproved\n\nDate Created2018-10-16\n\nLast Modified2023-01-03\n\nEditorLiron Rubin\n\nLast ApproverLiron Rubin","language":"md","time":"14 days ago","created":"2025-05-06T22:56:15.893Z","annotations":[],"updated":"2025-05-06T22:59:30.667Z"},{"title":"ProductQuantum Maestro","id":"f582d74f-24a7-4b7e-a34c-6d33adac850e","type":"TEXT","raw":"ProductQuantum Maestro\n\nVersionR80.20SP (EOS), R80.30SP (EOS), R81.10, R81.20\n\nOSGaia\n\nPlatform15000, 16000, 19000, 23000, 26000, 28000, 29000, 5000, 6000, 7000, 9000\n\nLast Modified2024-12-10\n\n## Symptoms\n\n-   A port exhaustion issue occurs when you use NAT with Maestro.\n    \n-   NAT-related traffic is dropped.\n    \n-   There are \"`allocate_port_impl: could not find a free port`\" log messages in the `$FWDIR/log/fwk.elg` file.\n    \n-   There are \"`fw_xlate_new_conn_from_template: fwx_apply_hide failed. packet will be dropped`\" log messages in the `$FWDIR/log/fwk.elg` file.\n    \n-   The output of kernel drop debug contains \"`fw_first_packet_xlation Reason: NAT rulematch failed`\" messages.\n    \n\n## Cause\n\nThe default traffic distribution configuration in Maestro Security Groups is:\n\n-   In R80.20SP - **Manual-General**\n-   In R80.30SP, R81 and higher - **Auto-Topology (Per-Port)**\n\nWhen using the \"Manual-General\" distribution mode, each Security Group Member cannot use the entire range of NAT ports.\n\n## Solution\n\nDo one of these in R80.20SP:\n\n-   Change the distribution configuration to **User** / **Network**:\n    \n    -   The client side should be defined as **User** and the server side as **Network.**\n    -   This way, each Security Group Member is able to use a full range of NAT ports.\n    -   For instructions, refer to the [R80.20SP Maestro Administration Guide](https://sc1.checkpoint.com/documents/R80.20SP/WebAdminGuides/EN/CP_R80.20SP_Maestro_AdminGuide/html_frameset.htm) > Chapter _Managing Security Groups_ > Section _Working with the Distribution Mode_.\n-   In the NAT Translated Source, use Network Ranges and Hide NAT, instead of a single IP address.\n    \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorAnatoly Masover\n\nTechnical ResourceDror Farkash\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2019-08-01\n\nLast Modified2024-12-10\n\nEditorAnatoly Masover\n\nLast ApproverLiron Rubin\n\n## Comments\n\n#### Internal only\n\nThe custom fixes (MBS-6201) mentioned below are integrated starting from:\n\n-   [R81.10 for Scalable Platforms](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk173363)\n-   [R80.30SP Jumbo Hotfix](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk165312&partition=Basic&product=Quantum) Take 49\n-   [R80.20SP Jumbo Hotfix](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk155832) Take 105\n\nFrom: Dror Farkash   \nSent: Wednesday, September 23, 2020 08:22  \nTo: Christian Hofmann ; MAESTRO@MICHAEL.CHECKPOINT.COM  \nSubject: RE: NAT port exhaustion - R80.30SP GA\n\nYes.\n\nYou will need to clean fwx\\_alloc and the connections table after disabling L4 distribution. \n\nFrom: Christian Hofmann   \nSent: Tuesday, 22 September 2020 20:18  \nTo: Dror Farkash ; MAESTRO@MICHAEL.CHECKPOINT.COM  \nSubject: RE: NAT port exhaustion - R80.30SP GA\n\nHi Dror \n\nThanks for sharing this. Would disabling L4 distribution also help to prevent this from happening?\n\nFrom: Maestro Hyperscale Security <MAESTRO@MICHAEL.CHECKPOINT.COM> On Behalf Of Dror Farkash  \nSent: Tuesday, September 22, 2020 18:43  \nTo: MAESTRO@MICHAEL.CHECKPOINT.COM  \nSubject: NAT port exhaustion - R80.30SP GA\n\nHi,\n\nWe are aware of an issue regarding NAT port exhaustion while L4 distribution is enable (default).\n\nThe fix is already integrated to the upcoming JHF. For now, I am publish two HF packages for each GA take.\n\nR80.30SP JHF Take 41:  \n\\\\\\\\galaxy\\\\ckp\\\\pkg\\\\fw1\\_wrapper\\\\R80\\_30SP\\_T41\\_NAT\\_PORT\\_EXHST\\_main\\\\B993000001\\_1\\\\linux50\\\\release.dynamic.ping\\\\fw1\\_wrapper\\_HOTFIX\\_R80\\_30SP\\_T41\\_NAT\\_PORT\\_EXHST\\_MAIN\\_GA\\_FULL.tgz\n\nR80.30SP JHF Take 47:  \n\\\\\\\\galaxy\\\\ckp\\\\pkg\\\\fw1\\_wrapper\\\\R80\\_30SP\\_JHF\\_t47\\_034\\_main\\\\latest\\_linux50\\\\release.dynamic.ping\\\\fw1\\_wrapper\\_HOTFIX\\_R80\\_30SP\\_JHF\\_T47\\_034\\_MAIN\\_GA\\_FULL.tgz","language":"md","time":"14 days ago","created":"2025-05-06T22:56:16.093Z","annotations":[],"updated":"2025-05-06T22:59:40.587Z"},{"title":"Activating Quantum Maestro Orchestrator in R81.10 and Higher","id":"8e8e0e43-3a82-4abf-8ecf-a2c0607dd465","type":"TEXT","raw":"ProductQuantum Maestro\n\nVersionR81.10, R81.20\n\nOSGaia\n\nPlatformMHO Maestro\n\nLast Modified2022-11-22\n\n## Solution\n\nTo enable the Uplink ports and the required daemons, you must manually activate your Quantum Maestro Orchestrator in these cases:\n\n-   If you performed a clean install of R81.10 or higher on a Quantum Maestro Orchestrator.\n    \n-   You restored a Quantum Maestro Orchestrator that runs R81.10 or higher to its factory defaults.\n    \n\n**Note** - This does not apply if you upgrade an existing Quantum Maestro Orchestrator from the R80.20SP version to the R81.10 (or higher) version.\n\n**Follow the applicable scenario:**\n\n-   If you did **not** configure Security Groups on the Quantum Maestro Orchestrator yet, then there is **no** configuration to import.  \n    You can activate the Orchestrator immediately in one of these ways:\n    \n    -   During the first login to the command line, enter \"`y`\" when asked to activate the Orchestrator.\n        \n    -   Run the \"`orchd activate`\" command in the Expert mode.\n        \n-   If there are configured Security Groups on the Quantum Maestro Orchestrator, and it is **necessary** to import the existing configuration, then do **not** activate the Orchestrator when you first log in to the command line.\n    \n    As an alternative, import the Orchestrator configuration according to the applicable procedure, and only then activate the Orchestrator with the \"`orchd activate`\" command in the Expert mode\n    \n\n**Related Articles:**\n\n-   [sk174202 - How to replace a Quantum Maestro Orchestrator](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk174202)\n\n## Article Properties\n\nOriginatorShai Shohat\n\nTechnical ResourceMatan Tenenboim\n\nAccess LevelGeneral\n\nStatusApproved\n\nDate Created2021-02-01\n\nLast Modified2022-11-22\n\nEditorLiron Rubin\n\nLast ApproverGil Frantsus\n\n## Comments\n\n#### Internal only\n\n**SK SHOULD NOT BE DELETED - REFERENCED IN THE SOURCE CODE (see TP-4204) AND MAESTRO DOCUMENTATION**","language":"md","time":"14 days ago","created":"2025-05-06T22:56:18.543Z","annotations":[],"updated":"2025-05-06T22:59:45.575Z"},{"title":"Product Quantum Maestro Version Hardware","id":"60ca0154-9d68-4690-b56e-71298c7d0f0a","type":"TEXT","raw":"ProductQuantum Maestro\n\nVersionHardware\n\nOSGaia\n\nLast Modified2025-04-25\n\n## Solution\n\n**Table of Contents:**\n\n-   Background\n    \n-   Mandatory Guidelines\n    \n-   Supported Line Cards\n    \n-   Single Orchestrator on a Maestro Site\n    \n-   Two Orchestrators on a Maestro Site\n    \n-   Recommended Connection of Downlinks\n    \n-   Related Documentation\n    \n\n###   \nBackground\n\nBy design of Maestro HyperScale Security, each Security Appliance connects to a Downlink port on each Maestro Orchestrator.\n\nThis article explains the guidelines and limitations related to the number of Downlink connections from Maestro Orchestrators to a Security Appliance.\n\n###   \nMandatory Guidelines\n\n1.  Maestro supports downlink connections to ports with the speed of 10 Gbps and higher on a Security Appliance.\n    \n2.  Maestro supports a maximum of **two** downlink connections from each Orchestrator to each Security Appliance (starting from the R80.20SP Jumbo Hotfix Accumulator).\n    \n3.  If you connect **two** downlinks from an Orchestrator to a Security Appliance, then:\n    \n    -   You can connect both downlinks to the same Expansion Line Card on the Security Appliance.\n        \n    -   If the Security Appliance has two or more Expansion Line Cards, you can connect each downlink to a different Expansion Line Card.\n        \n        We recommend this connection because it provides redundancy between Expansion Line Cards.\n        \n        Notes:\n        \n        -   It is not supported to connect downlinks to a 10 Gbps port **and** to a 25 / 40 / 100 Gbps port at the same time on the same Security Appliance.\n            \n        -   All Expansion Line Cards in use must have the same driver type as the card in the first slot.\n            \n        \n        Example for the Quantum Force 19100 model (as described for Maestro in Product Catalog as of 20 Jan 2025):\n        \n        <table><tbody><tr><td>Expansion Slot</td><td>Line Card</td><td>Line Card Port</td><td>Orchestrator on Site</td></tr><tr><td>#1</td><td>2 x 40/100 GbE</td><td>#1<br>(active)</td><td>#1</td></tr><tr><td>#1</td><td>2 x 40/100 GbE</td><td>#2<br>(active)</td><td>#2</td></tr><tr><td>#3</td><td>2 x 40/100 GbE</td><td>#1<br>(standby)</td><td>#1</td></tr><tr><td>#3</td><td>2 x 40/100 GbE</td><td>#2<br>(standby)</td><td>#2</td></tr></tbody></table>\n        \n4.  You **MUST** remove all unused Expansion Line Cards from the Security Appliance.\n    \n5.  We recommend that each Security Appliance in the same Security Group be connected to each Orchestrator with the same number of downlink connections, so that each Security Group Member receives and transmits with the same throughput.\n    \n    Although it is not necessary to connect each Security Appliance to the same Downlink ports on different Orchestrators (for example, Port 18), we recommend such a connection because it makes it easier to monitor and troubleshoot.\n    \n6.  Maestro does **not** support on-board 10 Gbps (SFP+) ports on the Quantum Force 9000 models.\n    \n7.  You must use only the certified transceivers for Check Point Appliances as described in [sk92755](https://support.checkpoint.com/results/sk/sk92755).\n    \n\n###   \nSupported Line Cards\n\nTo connect a Security Appliance to Quantum Maestro Orchestrators with DAC cables, you must install one of the supported Line Cards in the Security Appliance.\n\nSee [sk181433 - Supported Security Appliance Models and Line Cards for the Quantum Maestro Solution](https://support.checkpoint.com/results/sk/sk181433).\n\n###   \nSingle Orchestrator on a Maestro Site\n\n<table><tbody><tr><td><p>Line Card</p></td><td><p>R81 and<br>Higher Versions</p></td><td><p>R80.20SP with<br>Jumbo Hotfix Accumulator</p><p>R80.30SP with<br>Jumbo Hotfix Accumulator<br>Take 45 (or higher)</p></td><td><p>R80.20SP</p></td></tr><tr><td><p>Dual-Port</p><p>10 GbE Fiber SFP+</p></td><td><p>Port 1</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/11907171818.png\" alt=\"\"></p></td><td><p>Port 1</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/11907171818.png\" alt=\"\"></p></td><td><p>Port 1</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/11907171818.png\" alt=\"\"></p></td></tr><tr><td rowspan=\"3\"><p>Quad-Port</p><p>10 GbE Fiber SFP+</p></td><td><p>Port 1</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/21907171829.png\" alt=\"\"></p></td><td><p>Port 1</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/21907171829.png\" alt=\"\"></p></td><td><p>Port 1</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/21907171829.png\" alt=\"\"></p></td></tr><tr><td><p>Port 3</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/31907171829.png\" alt=\"\"></p></td><td><p>Port 3</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/31907171829.png\" alt=\"\"></p></td><td><p>Port 3</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/31907171829.png\" alt=\"\"></p></td></tr><tr><td><p>Port 1 and Port 3</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/41907171830.png\" alt=\"\"></p></td><td><p>Port 1 and Port 3</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/41907171830.png\" alt=\"\"></p></td><td><p>Not supported</p></td></tr><tr><td><p>Dual-Port</p><p>40 GbE Fiber QSFP+</p><p>or</p><p>100 GbE Fiber QSFP+</p></td><td><p>Port 1</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/51907171830.png\" alt=\"\"></p></td><td><p>Port 1</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/51907171830.png\" alt=\"\"></p></td><td><p>Port 1</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/51907171830.png\" alt=\"\"></p></td></tr></tbody></table>\n\n###   \nTwo Orchestrators on a Maestro Site\n\nLegend:\n\n<table><tbody><tr><td><p>Line Card</p></td><td><p>R81 and<br>Higher Versions</p></td><td><p>R80.20SP with<br>Jumbo Hotfix Accumulator</p><p>R80.30SP with<br>Jumbo Hotfix Accumulator<br>Take 45 (or higher)</p></td><td><p>R80.20SP</p></td></tr><tr><td><p>Dual-Port</p><p>10 GbE Fiber SFP+</p></td><td><p>Port 1 - MHO1<br>Port 2 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/61907171842.png\" alt=\"\"></p></td><td><p>Port 1 - MHO1<br>Port 2 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/61907171842.png\" alt=\"\"></p></td><td><p>Port 1 - MHO1<br>Port 2 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/61907171842.png\" alt=\"\"></p></td></tr><tr><td rowspan=\"3\"><p>Quad-Port</p><p>10 GbE Fiber SFP+</p></td><td><p>Port 1 - MHO1<br>Port 2 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/71907171842.png\" alt=\"\"></p></td><td><p>Port 1 - MHO1<br>Port 2 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/71907171842.png\" alt=\"\"></p></td><td><p>Port 1 - MHO1<br>Port 2 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/71907171842.png\" alt=\"\"></p></td></tr><tr><td><p>Port 3 - MHO1<br>Port 4 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/81907171842.png\" alt=\"\"></p></td><td><p>Port 3 - MHO1<br>Port 4 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/81907171842.png\" alt=\"\"></p></td><td><p>Port 3 - MHO1<br>Port 4 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/81907171842.png\" alt=\"\"></p></td></tr><tr><td><p>Port 1 - MHO1<br>Port 3 - MHO1<br>Port 2 - MHO2<br>Port 4 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/91907171843.png\" alt=\"\"></p></td><td><p>Port 1 - MHO1<br>Port 3 - MHO1<br>Port 2 - MHO2<br>Port 4 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/91907171843.png\" alt=\"\"></p></td><td><p>&nbsp;Not supported</p></td></tr><tr><td><p>Dual-Port</p><p>40 GbE Fiber QSFP+</p><p>or</p><p>100 GbE Fiber QSFP+</p></td><td><p>Port 1 - MHO1<br>Port 2 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/101907171843.png\" alt=\"\"></p></td><td><p>Port 1 - MHO1<br>Port 2 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/101907171843.png\" alt=\"\"></p></td><td><p>Port 1 - MHO1<br>Port 2 - MHO2</p><p><img src=\"https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1563411243225/101907171843.png\" alt=\"\"></p></td></tr></tbody></table>\n\n###   \nRecommended Connection of Downlinks\n\nLegend:\n\n-   \"MHO1\" - Orchestrator #1 on the Site.\n-   \"MHO2\" - Orchestrator #2 on the Site.\n-   \"optional\" - You connect these NIC ports for additional redundancy.\n\nThe information is provided for the default configuration (as described in the Check Point Product Catalog as of 20 Jan 2025).\n\nEnter the string to filter this table:\n\n<table id=\"Recommended_Table\"><tbody><tr><td>Maestro Security Appliance</td><td>Slot 1 and NIC</td><td>Slot 2 and NIC</td><td>Slot 3 and NIC</td><td>Slot 4 and NIC</td><td>Slot 5 and NIC</td><td>Slot 6 and NIC</td></tr><tr><td><p>9100</p><p><a href=\"https://catalog.checkpoint.com/product/qgqvbmbzgeydax3nmfsxg5dsn5pwq6lq=\" target=\"_blank\" rel=\"noopener\">CPAP-SG9100-PLUS-MHS-SNBT</a></p></td><td><p>8 x 1 GbE</p><p>(not<br>supported)</p></td><td><p>4 x 10/25 GbE</p><p>Port 1 to MHO1</p><p>Port 2 to MHO2</p><p>Port 3 to MHO1<br>(optional)</p><p>Port 4 to MHO2<br>(optional)</p></td><td><p>N / A</p></td><td><p>N / A</p></td><td><p>N / A</p></td><td><p>N / A</p></td></tr><tr><td><p>9200</p><p><a href=\"https://catalog.checkpoint.com/product/qgqvbmbzgiydax3nmfsxg5dsn5pwq6lq=\" target=\"_blank\" rel=\"noopener\">CPAP-SG9200-PLUS-MHS-SNBT</a></p></td><td><p>8 x 1 GbE</p><p>(not<br>supported)</p></td><td><p>4 x 10/25 GbE</p><p>Port 1 to MHO1</p><p>Port 2 to MHO2</p><p>Port 3 to MHO1<br>(optional)</p><p>Port 4 to MHO2<br>(optional)</p></td><td><p>N / A</p></td><td><p>N / A</p></td><td><p>N / A</p></td><td><p>N / A</p></td></tr><tr><td><p>9300</p><p><a href=\"https://catalog.checkpoint.com/product/qgqvbmbzgmydax3nmfsxg5dsn5pwq6lq=\" target=\"_blank\" rel=\"noopener\">CPAP-SG9300-PLUS-MHS-SNBT</a></p></td><td><p>8 x 1 GbE</p><p>(not<br>supported)</p></td><td><p>4 x 10/25 GbE</p><p>Port 1 to MHO1</p><p>Port 2 to MHO2</p><p>Port 3 to MHO1<br>(optional)</p><p>Port 4 to MHO2<br>(optional)</p></td><td><p>N / A</p></td><td><p>N / A</p></td><td><p>N / A</p></td><td><p>N / A</p></td></tr><tr><td><p>9400</p><p><a href=\"https://catalog.checkpoint.com/product/qgqvbmbzgqydax3nmfsxg5dsn5pwq6lq=\" target=\"_blank\" rel=\"noopener\">CPAP-SG9400-PLUS-MHS-SNBT</a></p></td><td><p>8 x 1 GbE</p><p>(not<br>supported)</p></td><td><p>4 x 1/10 GbE</p><p>(do not use)</p></td><td><p>4 x 10/25 GbE</p><p>Port 1 to MHO1</p><p>Port 2 to MHO2</p><p>Port 3 to MHO1<br>(optional)</p><p>Port 4 to MHO2<br>(optional)</p></td><td><p>N / A</p></td><td><p>N / A</p></td><td><p>N / A</p></td></tr><tr><td><p>9700</p><p><a href=\"https://catalog.checkpoint.com/product/qgqvbmbzg4ydax3nmfsxg5dsn5pwq6lq=\" target=\"_blank\" rel=\"noopener\">CPAP-SG9700-PLUS-MHS-SNBT</a></p></td><td><p>4 x 1 GbE</p><p>(not<br>supported)</p></td><td><p>4 x 1/10 GbE</p><p>(do not use)</p></td><td><p>4 x 10/25 GbE</p><p>Port 1 to MHO1</p><p>Port 2 to MHO2</p><p>Port 3 to MHO1<br>(optional)</p><p>Port 4 to MHO2<br>(optional)</p></td><td><p>Empty</p></td><td><p>N / A</p></td><td><p>N / A</p></td></tr><tr><td><p>9800</p><p><a href=\"https://catalog.checkpoint.com/product/qgqvbmbzhaydax3nmfsxg5dsn5pwq6lq=\" target=\"_blank\" rel=\"noopener\">CPAP-SG9800-PLUS-MHS-SNBT</a></p></td><td><p>4 x 1 GbE</p><p>(not<br>supported)</p></td><td><p>4 x 1/10 GbE</p><p>(do not use)</p></td><td><p>4 x 10/25 GbE</p><p>Port 1 to MHO1</p><p>Port 2 to MHO2</p><p>Port 3 to MHO1<br>(optional)</p><p>Port 4 to MHO2<br>(optional)</p></td><td><p>Empty</p></td><td><p>N / A</p></td><td><p>N / A</p></td></tr><tr><td><p>19100</p><p><a href=\"https://catalog.checkpoint.com/product/qgqvbmjrheytamc7nvqwk43uojxv62dzoa=\" target=\"_blank\" rel=\"noopener\">CPAP-SG19100-PLUS-MHS-SNBT</a></p></td><td><p>2 x 40/100 GbE<br>(active card)</p><p>Port 1 to MHO1</p><p>Port 2 to MHO2</p></td><td><p>Empty</p></td><td><p>2 x 40/100 GbE<br>(standby card)</p><p>Port 1 to MHO1<br>(optional)</p><p>Port 2 to MHO2<br>(optional)</p></td><td><p>Empty</p></td><td><p>N / A</p></td><td><p>N / A</p></td></tr><tr><td><p>19200</p><p><a href=\"https://catalog.checkpoint.com/product/qgqvbmjrhezdamc7nvqwk43uojxv62dzoa=\" target=\"_blank\" rel=\"noopener\">CPAP-SG19200-PLUS-MHS-SNBT</a></p></td><td><p>2 x 40/100 GbE<br>(active card)</p><p>Port 1 to MHO1</p><p>Port 2 to MHO2</p></td><td><p>Empty</p></td><td><p>2 x 40/100 GbE<br>(standby card)</p><p>Port 1 to MHO1<br>(optional)</p><p>Port 2 to MHO2<br>(optional)</p></td><td><p>Empty</p></td><td><p>N / A</p></td><td><p>N / A</p></td></tr><tr><td><p>29200</p><p><a href=\"https://catalog.checkpoint.com/product/qgqvbmjshezdamc7nvqwk43uojxv62dzoa=\" target=\"_blank\" rel=\"noopener\">CPAP-SG29200-PLUS-MHS-SNBT</a></p></td><td><p>2 x 40/100 GbE<br>(active card)</p><p>Port 1 to MHO1</p><p>Port 2 to MHO2</p></td><td><p>Empty</p></td><td><p>2 x 40/100 GbE<br>(standby card)</p><p>Port 1 to MHO1<br>(optional)</p><p>Port 2 to MHO2<br>(optional)</p></td><td><p>Empty</p></td><td><p>Empty</p></td><td><p>Empty</p></td></tr></tbody></table>\n\n###   \nRelated Documentation\n\n-   [sk96246 - Documentation For Check Point Appliances](https://support.checkpoint.com/results/sk/sk96246)\n    \n-   [Installing and Removing Expansion Line Cards](https://sc1.checkpoint.com/documents/Appliances/FRU_Line_Cards/Default.htm)\n    \n-   [Quantum Maestro Getting Started Guide](https://sc1.checkpoint.com/documents/Appliances/GSG_Maestro/EN/Default.htm)\n    \n-   [sk92755 - Compatibility of transceivers for Check Point appliances](https://support.checkpoint.com/results/sk/sk92755)\n    \n-   [sk181433 - Supported Security Appliance Models for Use with the Quantum Maestro Solution](https://support.checkpoint.com/results/sk/sk181433)\n    \n-   [sk162373 - Quantum Maestro supported combinations of mix-and-match appliances](https://support.checkpoint.com/results/sk/sk162373)\n    \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorAnatoly Masover\n\nTechnical ResourceNadia Hacham\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2019-07-21\n\nLast Modified2025-04-25\n\nEditorAnatoly Masover\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only\n\n**SK SHOULD NOT BE DELETED - referenced in documentation**\n\n**This statement comes from R&D and QA:**\n\nAll other Expansion Line Cards MUST be removed from Security Appliances.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:16.264Z","annotations":[],"updated":"2025-05-06T23:03:55.704Z"},{"title":"Table with HCP Tests and Validation","id":"57daa0fa-a73e-45b6-b717-f2aa3f57d1b5","type":"TEXT","raw":"<table><tbody><tr><td>ID</td><td>Description</td></tr><tr><td colspan=\"2\"><strong>Update 22 - Take 84 (21 Apr 2025)</strong></td></tr><tr><td>PMTR-109082</td><td>Enhancement: Added a new test to verify licenses across all Scalable Platform members.</td></tr><tr><td>HCP-1361</td><td>Enhancement: Added the option to upgrade HCP version on all the Security Gateways attached to the specific Security Management Server.</td></tr><tr><td>HCP-1109</td><td>Enhancement: Added a new test to detect SAML Portal issues described in <a href=\"https://support.checkpoint.com/results/sk/sk182128\" target=\"_blank\" rel=\"noopener\">sk182128</a>.</td></tr><tr><td>HCP-1291</td><td>HCP test reports an FTW failure even when the FTW process is completed successfully. This happens because of incorrect checking the <em>.wizard_started</em> file.</td></tr><tr><td>HCP-1285</td><td>The Memory test falsely reports high memory consumption of the JAVA process.</td></tr><tr><td>ODU-2483</td><td>Minor fixes and improvements.</td></tr><tr><td colspan=\"2\"><strong>Update 21 - Take 77 (05 Jan 2025)</strong></td></tr><tr><td>HCP-1137</td><td>Enhancement: Added a new test to verify successful execution of post-upgrade cleanup processes in the Security Group on a Scalable Platform.</td></tr><tr><td>ODU-2259</td><td>Minor fixes and improvements.</td></tr><tr><td colspan=\"2\"><strong>Update 20 - Take 76 (27 Oct 2024)</strong></td></tr><tr><td>HCP-1082</td><td>Enhancement: Increased the timeout threshold for background HCP processes in R82 to prevent false-positive errors while maintaining MHO's ability to handle concurrent REST requests.</td></tr><tr><td colspan=\"2\"><strong>Update 19 - Take 74 (15 Sep 2024)</strong></td></tr><tr><td>ODU-1979</td><td>Minor fixes and improvements.</td></tr><tr><td>HCP-1000</td><td>Enhancement: Improved the loading time of HCP tests in on a VSX Gateway.</td></tr><tr><td>HCP-982</td><td>After an upgrade on Gaia, the SSD test may fail during system checks on hardware, although it does not have an SSD.</td></tr><tr><td>HCP-369</td><td>The Cluster test false positively fails on a cluster with more than two members when they are in Backup state.</td></tr><tr><td colspan=\"2\"><strong>Update 18 - Take 73 (03 Jul 2024)</strong></td></tr><tr><td>HCP-1024</td><td>High CPU and memory usage may be caused by the Licensing test.</td></tr><tr><td>HCP-1025</td><td>Large output for the Shared Memory and Huge Pages test.</td></tr><tr><td>HCP-993</td><td>It may not be possible to run HCP from SmartConsole for Secondary Management and SmartEvent Server.</td></tr><tr><td>HCP-1005</td><td>The status for the Policy in Security Group test may be \"UNDEFINED\".</td></tr><tr><td>HCP-998</td><td>HCP reports connectivity issue for the Virtual Switch that cannot access the Internet according to its configuration.</td></tr><tr><td>HCP-983</td><td>The Software Version test fails as false positive on HOTFIX_OTLP_GA packages.&nbsp;</td></tr><tr><td colspan=\"2\"><strong>Update 17 - Take 70 (31 March 2024)</strong></td></tr><tr><td>HCP-894</td><td><strong>NEW:</strong> The HCP tests and the collection of reports to the Security Management Server are scheduled to occur automatically every 6 hours. This frequency can be modified by using the \"<em>cpd_sched_config</em>\" command in the <em>HcpPeriodicRun</em> task.</td></tr><tr><td>HCP-918</td><td>The Connectivity to UserCenter test fails with \"<em>IndexError: list index out of range</em>\".</td></tr><tr><td colspan=\"2\"><strong>Update 16 - Take 68 (29 February 2024)</strong></td></tr><tr><td>HCP-896</td><td><strong>NEW:</strong> Added IOC statistics test, which reports if there is an IOC issue.</td></tr><tr><td>HCP-891</td><td>The Jumbo Frames test fails with a false positive result after Jumbo Hotfix Accumulator installation.</td></tr><tr><td>HCP-900</td><td>The \"<em>hcp -r all</em>\" command fails with a traceback stack on SDWAN test.</td></tr><tr><td>HCP-883</td><td>HCP report may not be generated correctly if the object name has capital letters.</td></tr><tr><td>HCP-828</td><td>The Fragmentation Rate test fails with an exception on one of the Scalable Platforms members.</td></tr><tr><td colspan=\"2\"><strong>Update 15 - Take 67 (18 January 2024)</strong></td></tr><tr><td>HCP-870</td><td><strong>NEW:</strong> Added a new test which validates that graceful restart is enabled on all BGP peers.</td></tr><tr><td>HCP-808</td><td><strong>NEW:</strong> Added a new test which checks if DNS Passive Learning feature is active. If it is not active, the test provides the exact reason. Refer to <a href=\"https://support.checkpoint.com/results/sk/sk161612\" target=\"_blank\" rel=\"noopener\">sk161612</a>.</td></tr><tr><td>HCP-792</td><td><strong>NEW:</strong> Added a new Identity Awareness test, which identifies any disconnections that may occur between the PDP and PEP components.</td></tr><tr><td>HCP-823</td><td><strong>NEW:</strong> Added new SD-WAN tests:<p>SD-WAN - CPSDWAN and Steering Status:<br>This test checks whether cpsdwan and steering are enabled. If any of these services are not enabled, the test fails; otherwise, it succeeds.</p><p>SD-WAN - Services Running:<br>This test ensures that all SD-WAN services are currently running. If any service is not running, the test fails; otherwise, it succeeds.</p><p>SD-WAN - Fog Connection:<br>This test checks the connectivity between the Security Gateway and the fog through the SD-WAN Nano-Agent. The test fails if there is no connection; otherwise, it succeeds.</p><p>SD-WAN - ISP Redundancy Status:<br>This test determines whether ISP Redundancy is enabled. The test fails if ISP Redundancy is detected, and it succeeds otherwise.</p><p>SD-WAN - PBR Rules Configuration:<br>This test examines the configuration of Policy-Based Routing (PBR) rules. It passes with a warning if at least one PBR rule is configured; otherwise, it succeeds.</p><p>SD-WAN - Required Files Presence:<br>This test checks the existence of all required SD-WAN files. If any file is missing, the test fails; otherwise, it succeeds.</p><p>SD-WAN - Software Blades Enabled:<br>This test ensures that all Software Blades necessary for SD-WAN functionality are enabled. If any required Software Blade is disabled, the test fails; otherwise, it succeeds.</p></td></tr><tr><td>HCP-815</td><td><strong>NEW:</strong> Created a new test to monitor hide NAT port usage, specifically designed to detect instances of failure resulting from port exhaustion.</td></tr><tr><td>-</td><td>The \"hcp -r all\" command fails on Security Group Members (Maestro or Scalable Chassis). Refer to <a href=\"https://support.checkpoint.com/results/sk/sk181865\" target=\"_blank\" rel=\"noopener\">sk181865</a>.</td></tr><tr><td colspan=\"2\"><strong>Update 14 - Take 62 (15 October 2023)</strong></td></tr><tr><td>HCP-790</td><td><strong>NEW:</strong> Added a new HTTPS Inspection configuration test, which checks the validity of the outbound inspection certificate for a Security Gateway.</td></tr><tr><td>HCP-753</td><td><strong>NEW:</strong> Added a new Local Ports Usage test, which checks ephemeral port range exhaustion for connections from Security Gateway interface addresses.</td></tr><tr><td>HCP-744</td><td><strong>NEW:</strong> Added a new test to check the current status of Dynamic Dispatcher.</td></tr><tr><td>HCP-742</td><td><strong>NEW:</strong> Added a new SecureXL test, which checks the configuration of LightSpeed appliances.</td></tr><tr><td>HCP-769</td><td><strong>NEW:</strong> Added a new test to check the quantity of Global connection entries. It should be less than four times of Concurrent connections values.</td></tr><tr><td>HCP-645</td><td><strong>NEW:</strong> A new test was added to verify that the Security appliances are correctly connected to the Orchestrators:<br><ul><li>An orchestrator with an odd member ID should be plugged into an odd Security Appliance's NIC port.</li><li>An orchestrator with an even member ID should be plugged into an even Security Appliance's NIC port.</li></ul>For example:<br><em>ethsBP1-01 to Orchestrator X_1</em><br><em>ethsBP1-02 to Orchestrator X_2</em><br>If the Security Appliances are not plugged in correctly, the HCP will provide the user with instructions on how to do so.</td></tr><tr><td>HCP-641</td><td><strong>NEW:</strong> A new test was added to verify if the hardware can recognize the ASIC. If the Orchestrator goes beyond the temperature limit, it triggers an automatic shutdown of the electricity supply to the ASIC to safeguard it.<br>If this happens, the HCP will prompt the user to unplug and plug back the corresponding Orchestrators to restore the electricity flow to the ASIC.</td></tr><tr><td>HCP-779</td><td><strong>NEW:</strong> Added new IoT Protect tests for verification of IoT pre-requisites/onboarding, IoT discovery and IoT enforcement flows.</td></tr><tr><td colspan=\"2\"><strong>Update 13 - Take 61 (17 July 2023)</strong></td></tr><tr><td>HCP-670</td><td><strong>NEW:</strong> Added a new CoreXL Affinity test, it checks that affinity configuration does not link any fw instance to all CPUs.</td></tr><tr><td>HCP-731</td><td><strong>UPDATE:</strong><ul><li>On Scalable Platforms, HCP will now run on all members by default.</li><li>The \"<em>-L</em>\" flag is added to run on a local member only.</li></ul></td></tr><tr><td>HCP-689</td><td><strong>UPDATE:</strong> The Bond Health test is enhanced to cover the slaves actor \"<em>system mac address</em>\".</td></tr><tr><td>HCP-666</td><td><strong>UPDATE:</strong> Added the CPU <em>io/sys/usr</em> charts.</td></tr><tr><td>HCP-597</td><td><strong>UPDATE:</strong> Reduced the Performance section tests runtime.</td></tr><tr><td>HCP-633</td><td><strong>NEW:</strong> Added a new test, which checks the IFI process status.</td></tr><tr><td>HCP-729</td><td>On R80.20SP, during the CPView tests, HCP may get stuck.</td></tr><tr><td>HCP-720</td><td>The CoreXL test on VSX has a false positive failure.</td></tr><tr><td>HCP-598</td><td>WebUI may become unresponsive after running the User Space Processes Affinity Check test.</td></tr><tr><td>HCP-718</td><td>The multi-queue test is passed in User Space Mode (UPPAK), even if the traffic is not balanced among interfaces, although it should not.</td></tr><tr><td>HCP-710</td><td>When VMAC mode is used with an interface running the i40e driver and the \"<em>disable-source-pruning</em>\" flag on the interface is off, traffic may disappear and cause arp issues.</td></tr><tr><td>HCP-717</td><td>The Updatable Objects test fails with an exception when <em>dnd_loader_state.C</em> does not exist.</td></tr><tr><td>HCP-715</td><td>The MTU test fails with an exception if one SSM is detached from Scalable Chassis.</td></tr><tr><td>HCP-688</td><td>The Memory test fails with an exception when running it simultaneously in different remote sessions.</td></tr><tr><td>HCP-683</td><td>HCP fails to run with \"<em>-m all</em>\" flag when one of the Scalable Platform members is not in Active state.</td></tr><tr><td>HCP-676</td><td>The MTU test fails on Magg if MTU is less than 1500.</td></tr><tr><td>HCP-667</td><td>HCP fails on Scalable Platforms with an exception when running with the \"<em>-m</em>\" flag while some members are not active.</td></tr><tr><td>HCP-663</td><td>The <em>fwkern.conf</em> test reports inconsistency between kernel and config value for SIM parameters.</td></tr><tr><td>HCP-644</td><td>The Daemons test may not verify all the daemons.</td></tr><tr><td>HCP-643</td><td>The Static Affinity test may fail when there is more than one FWD process.</td></tr><tr><td>HCP-635</td><td>The VSX Database test may fail on VSW (Virtual Switch).</td></tr><tr><td>HCP-631</td><td>The SSD Smart Health test fails on NVMe SSD.</td></tr><tr><td>HCP-618</td><td>There is no connectivity between User Center and the Multi-Domain Security Server if proxy is configured in Clish.</td></tr><tr><td colspan=\"2\"><strong>Update 12 - Take 59 (1 March 2023)</strong></td></tr><tr><td>HCP-475</td><td><strong>NEW:</strong> It is now possible to schedule a cron job on Security Management Server, which sets HCP to run and collect the reports from all connected Security Gateways.<p>To do so, run in Gaia Clish on the Management Server:<br><em>\"add cron job HCP_night_run command 'bash -l /etc/hcp/source/cron/cron_hcp_collect_reports.sh' recurrence daily time HH:MM\"</em></p><p>To change job name and recurrence, use regular \"<em>set/show cron</em>\" commands.</p></td></tr><tr><td>HCP-570</td><td><strong>NEW:</strong> Added a test to verify the integrity of VSX configuration in Gaia database.</td></tr><tr><td>HCP-575</td><td><strong>NEW:</strong> Added the \"<em>hcp --run-on-remote &lt;gw_name/all&gt;</em>\" command which allows to run HCP on a remote Security Gateway from the Security Management Server shell.</td></tr><tr><td>HCP-130</td><td><strong>NEW:</strong> The License Verification tool is integrated into HCP. To enable the tool, follow the steps in <a href=\"https://support.checkpoint.com/results/sk/sk180447\" target=\"_blank\" rel=\"noopener\">sk180447</a>.</td></tr><tr><td>HCP-279</td><td><strong>UPDATE:</strong> The Bond Health test is enhanced with LACP state verification.</td></tr><tr><td>HCP-550</td><td><strong>UPDATE:</strong> Added the \"Timestamp\" column to the Pattern Match (PM) spikes table in the Pattern Matcher Impact Test.</td></tr><tr><td>HCP-615</td><td><strong>UPDATE:</strong><ul><li>Added the Syslog Timestamp test.</li><li>The \"Verify log messages\" timestamp is now compliant with the system time.</li></ul></td></tr><tr><td>HCP-627</td><td><strong>UPDATE:</strong> Added Hardware Compatibility notifications. Refer to <a href=\"https://support.checkpoint.com/results/sk/sk180572\" target=\"_blank\" rel=\"noopener\">sk180572</a>.</td></tr><tr><td>HCP-613</td><td>The Software Version test fails because of inconsistency of <em>HOTFIX_CHARON_HF</em> between Scalable Platforms members.</td></tr><tr><td>HCP-584</td><td>The Protections Impact test may cause the \"<em>RecursionError</em>\" exception.</td></tr><tr><td>HCP-604</td><td>The <em>httpd-ssl.conf.templ</em> file is corrupted after an upgrade.</td></tr><tr><td>HCP-622</td><td>HCP may be inconsistent and fail with an exception when running it on Scalable Platforms members with the \"<em>-m</em>\" flag.</td></tr><tr><td>HCP-587</td><td>HCP running on Security Management Server fails to get the last report from the Secondary Security Management Server or from the Log Server.</td></tr><tr><td>HCP-544</td><td>The Interface Errors test may fail with an exception.</td></tr><tr><td colspan=\"2\"><strong>Update 11 - Take 58 (18 Sep 2022)</strong></td></tr><tr><td>HCP-6</td><td><strong>NEW:</strong> Added a test that checks if tables reached their limits.</td></tr><tr><td>HCP-510</td><td><strong>NEW:</strong> Added the \"--domain\" option to collect reports for a single domain.</td></tr><tr><td>HCP-531</td><td><strong>NEW:</strong> Added the Feature compatibility - VSX test.</td></tr><tr><td>HCP-530</td><td><strong>NEW:</strong> Added the \"<em>snmp configuration</em>\" option for the Feature compatibility - VSX test.</td></tr><tr><td>HCP-517</td><td>Updated the Feature Compatibility test.</td></tr><tr><td>HCP-499</td><td>SmartConsole may not provide the HCP report for a cluster member object.</td></tr><tr><td>HCP-504</td><td>The URL Filtering test may fail with an exception.</td></tr><tr><td>HCP-500</td><td>The VSX Hardware Utilization test may fail with an exception.</td></tr><tr><td>HCP-502</td><td>Improved the SSD Health test.</td></tr><tr><td>HCP-511</td><td>The ICA test may fail false positive on a Multi-Domain Log Module (MLM).</td></tr><tr><td>HCP-518</td><td>The Distribution test may incorrectly pass if the \"<em>dxl stat</em>\" command failed.</td></tr><tr><td>HCP-522</td><td>The Templates Efficiency test may fail with an exception.</td></tr><tr><td>HCP-543</td><td>The MTU test may fail with an exception in an MDPS environment.</td></tr><tr><td colspan=\"2\"><strong>Update 10 - Take 57 (20 Jun 2022)</strong></td></tr><tr><td>HCP-66</td><td><strong>NEW:</strong> Added a test that checks whether the hardware is utilized efficiently.</td></tr><tr><td>HCP-264</td><td><strong>NEW:</strong> Added a test to verify the SSD SMART health.</td></tr><tr><td>HCP-72</td><td><strong>UPDATE:</strong> Added a section in the report which displays installed software versions.</td></tr><tr><td>HCP-460</td><td><strong>UPDATE:</strong> The Local Logging Monitor Test will now check for failures in the past.</td></tr><tr><td>HCP-462</td><td><strong>UPDATE:</strong><ul><li>Major improvement in test loading time on VSX systems.</li><li>Changed the \"<em>hcp -l</em>\" output table. It will now display all tests except the tests disabled in configuration.</li></ul></td></tr><tr><td>HCP-431</td><td>The \"<em>Failed creating HTML report</em>\" error is displayed after running HCP.</td></tr><tr><td>HCP-433</td><td>The output table of the Scalable Platforms Features Compatibility Test is broken.</td></tr><tr><td>HCP-440</td><td>Running the \"<em>hcp -v</em>\" command in the VS context does not show the HCP Take number.</td></tr><tr><td>HCP-441</td><td>Running the \"<em>hcp --show-last-full</em>\" command in the non-VS0 Virtual System context may fail with an error message.</td></tr><tr><td>HCP-442</td><td>The Software Provision Test incorrectly reports about missing AUTOUPDATER packages on some members.</td></tr><tr><td>HCP-443</td><td>The MSG VLAN Consistency Test may fail with an exception.</td></tr><tr><td>HCP-450</td><td>The MTU test may fail with an exception related to some bridge interfaces.</td></tr><tr><td>HCP-457</td><td>The HCP Section icon in the report is not updated correctly.</td></tr><tr><td>HCP-464</td><td>Virtual System interfaces may be missing in the topology tab of a generated report.</td></tr><tr><td>HCP-466</td><td>Some tests may be shown in the status \"Skipped\", when running the \"<em>hcp --show-last\"</em>\" command with the \"<em>only-failed</em>\" flag.</td></tr><tr><td>HCP-471</td><td>HCP SmartConsole Extension cannot fetch the VSX Cluster report.</td></tr><tr><td>HCP-458</td><td>HCP SmartConsole Extension cannot fetch the Log Server report.</td></tr><tr><td colspan=\"2\"><strong>Update 9 - Take 55 (30 May 2022)</strong></td></tr><tr><td>HCP-415</td><td><strong>UPDATE:</strong> Protections Impact test now collects real time PM statistics, and matches protections with the same LSS as the critical protections.</td></tr><tr><td>HCP-295</td><td>The Connection Distribution test may collect distribution statistics from a wrong source because of a CPView issue.</td></tr><tr><td>HCP-375</td><td>Arrows in the Topology tab may be missing.</td></tr><tr><td>HCP-404</td><td>WTS may not show any cluster state event.</td></tr><tr><td>HCP-423</td><td>MDPS is listed as an unsupported version.</td></tr><tr><td>HCP-426</td><td>The Static Affinity Test may fail with an exception.</td></tr><tr><td>HCP-427</td><td>The Memory Usage Test may show an abnormally large command.</td></tr><tr><td>HCP-428</td><td>Loading an HTML page with the Maestro Orchestrator report may fail.</td></tr><tr><td>HCP-453</td><td>The Dynamic Objects Database Test may be executed on the Maestro Hyperscale Orchestrator (MHO) and the Management Servers although it should not.</td></tr><tr><td colspan=\"2\"><strong>Update 8 - Take 52 (07 Mar 2022)</strong></td></tr><tr><td>HCP-332</td><td><strong>NEW:</strong> The \"<em>hcp -r all</em>\" report will now automatically include topology, WTS, and charts, no additional flags are needed.</td></tr><tr><td>HCP-374</td><td><strong>NEW:</strong> Added new flags to modify HCP default behavior.<br>Some tests or products can be disabled/enabled:<ul><li>--disable-test</li><li>--enable-test</li><li>--disable-test-file</li><li>--enable-test-file</li><li>--disable-product</li><li>--enable-product</li><li>--show-disabled-tests</li><li>--set-performance-impact</li></ul>Note: The \"performance-impact\" configuration will persist after running the command.</td></tr><tr><td>HCP-164</td><td><strong>NEW:</strong> Added a new test to check if any debug flags are enabled.</td></tr><tr><td>HCP-237</td><td><strong>NEW:</strong> Added an optional flag \"<em>--only-failed</em>\" for \"<em>--show-last-full</em>\" and \"<em>--show-last</em>\" to represent only tests with a status not equal to \"Passed\".</td></tr><tr><td>SWSCFG-132</td><td><b>NEW</b>: Added an HCP test to validate if interface errors are present. If any errors are detected, possible solutions will be provided based on the error type.</td></tr><tr><td>HCP-225</td><td><strong>UPDATE:</strong> The \"<em>hcp -l</em>\" command output is now displayed as a table.</td></tr><tr><td>HCP-378</td><td><strong>UPDATE:</strong> The \"<em>hcp -l</em>\" and \"<em>hcp -r</em>\" commands will now load the test faster.</td></tr><tr><td>HCP-87</td><td>There may be a wrong timestamp in the report.</td></tr><tr><td>HCP-167</td><td>Added verifications of <em>fwkern.conf</em> file according to <a href=\"https://support.checkpoint.com/results/sk/sk149412\" target=\"_blank\" rel=\"noopener\">sk149412</a>.</td></tr><tr><td>HCP-218</td><td>The user cannot open the HCP report of the Management Server from SmartConsole because of the wrong UID in the report file.</td></tr><tr><td>HCP-328</td><td>The FW Configuration File Sanity test may fail on valid parameters.</td></tr><tr><td>HCP-240</td><td>The \"<em>hcp --show-last-full</em>\" command takes several minutes to represent very large reports.</td></tr><tr><td>HCP-333</td><td>The WTS report is not generated correctly, a “<em>Failed to generate WTS report</em>\" message is displayed.</td></tr><tr><td>HCP-343</td><td>When running HCP with the -f flag, a JSON encode/decode error is shown.</td></tr><tr><td>HCP-345</td><td>The \"<em>hcp --ext-update-reports &lt;gw_name&gt;</em>\" command may fail with an exception.</td></tr><tr><td>HCP-368</td><td>The IDA Sharing Mechanism test may fail with an exception.</td></tr><tr><td>HCP-370</td><td>The \"<em>hcp --ext-update-reports all</em>\" command collects reports only from the first 50 Gateways.</td></tr><tr><td>HCP-373</td><td>The SecureXL Status test may fail with an exception.</td></tr><tr><td>HCP-377</td><td><em>Autoupdatercli</em> fails to install HCP on R80.20 Scalable Platforms.</td></tr><tr><td>HCP-380</td><td>The Core Dumps test may fail with an exception.</td></tr><tr><td colspan=\"2\"><strong>Update 7 - Take 49 (17 Jan 2022)</strong></td></tr><tr><td>HCP-260</td><td><strong>NEW:</strong> Added a test to validate Software Provision across Scalable Platforms cluster members.</td></tr><tr><td>HCP-291</td><td><strong>NEW:</strong> Added HCP version and Take number to the HCP report.</td></tr><tr><td>HCP-324</td><td><strong>NEW:</strong> Threat Prevention Heavy Connections test now shows 10 most loaded connections and connections load per instance.</td></tr><tr><td>HCP-325,<br>HCP-187</td><td><strong>NEW:</strong> Added 2 new tables to the Memory Usage test:<ul><li>user space consumption per virtual system</li><li>total consumption per process (aggregated by name)</li></ul></td></tr><tr><td>HCP-219</td><td><strong>NEW:</strong> Added a test to check if the ICA certificate expires in less than a year/already expired. Refer to <a href=\"https://support.checkpoint.com/results/sk/sk158096\" target=\"_blank\" rel=\"noopener\">sk158096</a>.</td></tr><tr><td>HCP-318</td><td><strong>UPDATE:</strong> The Processes Memory test was removed. It is now part of the Memory Usage test.</td></tr><tr><td>HCP-292</td><td>Transceiver EEPROM data may cause an exception in HCP test.</td></tr><tr><td>HCP-297</td><td>In some scenarios, in a Scalable Platforms VSX environment, HCP may show an exception on test with Global Result option enabled.</td></tr><tr><td>HCP-299</td><td>Cluster members may appear twice in the test result.</td></tr><tr><td>HCP-303</td><td>Some zombie processes may not be detected by HCP test.</td></tr><tr><td>HCP-307</td><td>The SIC test output appears twice in the test result.</td></tr><tr><td>HCP-308</td><td>The CPView test may fail with an exception.</td></tr><tr><td>HCP-314</td><td>The Topology graph may fail to generate on systems with numbers or a dot (.) in the name.</td></tr><tr><td>HCP-317</td><td>The Transceiver test may fail with an exception.</td></tr><tr><td>HCP-342</td><td>The IDA Tables Mismatch test may fail with an exception.</td></tr><tr><td colspan=\"2\"><strong>Update 6 - Take 48 (9 November 2021)</strong></td></tr><tr><td>HCP-210</td><td><strong>NEW:</strong> Added to the Dmesg Errors test to handle the \"<em>stalls on CPU</em>\" messages.</td></tr><tr><td>HCP-209</td><td><strong>NEW:</strong> Added the Bond Health test which validates that there are no slaves with different aggregator id under the same bond.</td></tr><tr><td>HCP-211</td><td><strong>NEW:</strong> Added ports link integrity test for Maestro Orchestrator.</td></tr><tr><td>HCP-160</td><td><strong>UPDATE:</strong> An error message will be displayed when trying to view report for the Security Management Server if the last report does not exist on the Security Gateway.</td></tr><tr><td>HCP-61</td><td>On VSX systems, the Topology graph of HCP report either does not display or shows incorrect information.</td></tr><tr><td>HCP-230</td><td>In some scenarios, the IDA Tables Limit test takes more than 5 seconds to run.</td></tr><tr><td>HCP-206</td><td>In some scenarios, the SecureXL Status test shows status [<em>EXCEPTION</em>].</td></tr><tr><td>HCP-224</td><td>In some scenarios, the SIC test may be skipped the Security Gateway connected to a Multi-Domain Management Server.</td></tr><tr><td>HCP-223</td><td>The \"<em>hcp --ext-update-reports all</em>\" command is not working properly on Multi-Domain Management environment.</td></tr><tr><td>HCP-208</td><td>The \"FW Configuration File Sanity\" report raises exception on some appliances like 16600t.</td></tr><tr><td>HCP-214</td><td>HCP \"Core Dumps\" may crash if there are broken headers in core dump archive.</td></tr><tr><td>HCP-207</td><td>The Feature Compatibility test may fail when \"<em>smo image auto-clone</em>\" is enabled.</td></tr><tr><td>HCP-205</td><td>In some scenarios, SmartConsole fails to open reports from the Management machine.</td></tr><tr><td colspan=\"2\"><strong>Update 5 - Take 46 (20 October 2021)</strong></td></tr><tr><td>HCP-151</td><td><strong>NEW:</strong> Added perf reports summary table to the CPU spikes performance test (listing top functions and processes during latest spikes).</td></tr><tr><td>HCP-158</td><td><strong>NEW:</strong> Added HCP test to verify the IPv4 forwarding flag on FireWall interfaces.</td></tr><tr><td>HCP-106</td><td><strong>NEW:</strong> Added HCP test to verify MTU values on FireWall interfaces.</td></tr><tr><td>HCP-30</td><td><strong>NEW:</strong> Added basic filters and date navigation to What's The Story.</td></tr><tr><td>HCP-153</td><td><strong>NEW:</strong><ul><li>Added hostname and date to the report file name</li><li>Added purge ability to delete old reports (archive are saved up to 10, and last reports the last one only).</li></ul></td></tr><tr><td>HCP-198</td><td><strong>NEW:</strong> Added new Threat Prevention Heavy Connections test.</td></tr><tr><td>HCP-192</td><td><strong>NEW:</strong>Added new Threat Prevention tests to automate and improve the investigation of Threat Prevention performance issues.</td></tr><tr><td>HCP-202</td><td><strong>NEW:</strong> Added the Threat Prevention protections impact test.</td></tr><tr><td>HCP-163</td><td><strong>NEW:</strong> Added 3 new tests to the HCP tool:<ol><li>\"IDA tables instances mismatch\" - To check the number of mismatches between Identity Awareness kernel tables instances.</li><li>\"IDA tables limit\" - For each Identity Awareness kernel table, to make sure the peak value is approaching the limit.</li><li>\"IDA tables mismatch\" - To check the number of mismatches between Identity Awareness kernel tables.</li></ol></td></tr><tr><td>HCP-193</td><td>In some scenarios, the connectivity to User Center may fail.</td></tr><tr><td>HCP-50</td><td>Improved the loading time of What's The Story events.</td></tr><tr><td>HCP-107</td><td>Local Logging test may fail even when remote logging setup is configured correctly.</td></tr><tr><td>HCP-166</td><td>The <em>hcp.elg</em> log file may show exceptions on some tests even if they did not run on the environment.</td></tr><tr><td>HCP-149</td><td>Typo in the Transceivers test.</td></tr><tr><td>HCP-38</td><td>When running HCP with custom VS \"-c\" flag, the VS number is displayed incorrectly in SmartConsole report.</td></tr><tr><td>HCP-162</td><td>HCP does not display a message when What's The Story does not contain events.</td></tr><tr><td>HCP-150</td><td>In some scenarios, the File Descriptors test fails with exception.</td></tr><tr><td>HCP-168</td><td>In some scenarios, after running HCP fails with error related to cpdiag stats.</td></tr><tr><td>HCP-188</td><td>Disabled WTS (What's The Story) and Topology when the specific test runs, unless specifically indicated that it should run WTS / Topology.</td></tr><tr><td colspan=\"2\"><strong>Update 3 - Take 44 (13 June 2021)</strong></td></tr><tr><td>HCP-24</td><td><strong>NEW:</strong> Added timestamp to HTML report.</td></tr><tr><td>HCP-16</td><td><strong>NEW:</strong>Added the Transceiver Verifier test that checks that transceivers attached to appliances interfaces are supported.</td></tr><tr><td>HCP-82</td><td><strong>NEW:</strong>Added a new CSV file to allow CPDiag to collect statistics for:<ul><li>Number of times the HCP ran in this environment</li><li>Passed tests</li><li>Failed tests</li><li>Tests score</li></ul></td></tr><tr><td>HCP-67</td><td><strong>NEW:</strong> Added a new test to examine the SIC status between Security Management and Security Gateway.</td></tr><tr><td>HCP-108</td><td><strong>NEW:</strong> Added event of SNMP send failure to Scalable Chassis modules to WTS (What's The Story).</td></tr><tr><td>HCP-93</td><td><strong>NEW:</strong> Added a new test that checks Gaia database performance.</td></tr><tr><td>HCP-70</td><td><strong>NEW:</strong>Added Support for HCP Extension on MDS</td></tr><tr><td>HCP-76</td><td><strong>UPDATE:</strong>Search functionality in the HTML report is now under WIP and disabled.</td></tr><tr><td>HCP-29</td><td><strong>UPDATE:</strong>Added the Threshold column to CPView.</td></tr><tr><td>HCP-26</td><td><strong>UPDATE:</strong>WTS (What's The Story) will be displayed the HTML report by default.</td></tr><tr><td>HCP-100</td><td><strong>UPDATE:</strong> Errors previously printed on the screen while tests are running will be printed to the <em>hcp.elg</em> file.</td></tr><tr><td>HCP-117</td><td><strong>UPDATE:</strong>HCP test will alert about custom applications with signatures that may cause performance impact.</td></tr><tr><td>HCP-48</td><td><strong>UPDATE:</strong> Help message is now displayed if the incorrect command syntax entered.</td></tr><tr><td>HCP-119</td><td><strong>UPDATE:</strong> The Local Logging test is now disabled.</td></tr><tr><td>HCP-128</td><td><strong>UPDATE:</strong> Added ability to run the <em>fwkern.conf</em> sanity test on each VS.</td></tr><tr><td>HCP-68</td><td>SecureXL status is missing in HCP test.</td></tr><tr><td>HCP-78</td><td>When running HCP with the wrong \"-c\" parameter, unnecessary blank HTML report is created.</td></tr><tr><td>HCP-64</td><td>The <em>gexec</em> command has a different default timeout value than <em>hcpexec</em>.</td></tr><tr><td>HCP-96</td><td>Added more information to compatibility check of Forward Error Correction (FEC) feature.</td></tr><tr><td>HCP-97</td><td>The local logging test fails when a backup server is configured.</td></tr><tr><td>HCP-98</td><td>The Distribution test does not run from the Scalable Chassis Monitor.</td></tr><tr><td>HCP-53</td><td>Added core dumps information to WTS (What's The Story).</td></tr><tr><td>HCP-43</td><td>Cannot move between VSs in ARP CACHE limit test.</td></tr><tr><td>HCP-47</td><td>Charts tab time shows incorrect time.</td></tr><tr><td>HCP-71</td><td>The SIM Configuration File Sanity test may fail to find the kernel parameter although it exists.</td></tr><tr><td>HCP-89</td><td>Long words in the HCP test reports may cause overflow to adjacent table columns.</td></tr><tr><td>HCP-79</td><td>Added cosmetics fix to MSG Vlans consistency test: replace between the result table titles and add new line at the end of each missing VLAN</td></tr><tr><td>HCP-77</td><td>The Kernel Crash test shows \"PASSED\" although there are existing cores dump files.</td></tr><tr><td>HCP-129</td><td>In some scenarios, the Static Affinity Test fails with exception.</td></tr><tr><td>HCP-131</td><td>Scalable Platform Clients with ZETCLIENT process is shown as terminated and the Check Point Processes test status displays \"ERROR\".</td></tr><tr><td colspan=\"2\"><strong>Update 2 - Take 29 (18 March 2021)</strong></td></tr><tr><td>HCP-18</td><td><strong>NEW:</strong> Added the Memory Usage (RAM) test, which analyzes the different memory sections and their current usage.</td></tr><tr><td>HCP-12</td><td><strong>NEW:</strong> Added a compatibility test of configured features in Scalable Platform environments (based on <a href=\"https://support.checkpoint.com/results/sk/sk148074\" target=\"_blank\" rel=\"noopener\">sk148074</a>).</td></tr><tr><td>HCP-15</td><td><strong>NEW:</strong>Added <em>--v / -version</em> argument to display the Take number / RPM build of HCP.</td></tr><tr><td>HCP-11</td><td><strong>NEW:</strong> Added ability to see a back trace of core dump files.</td></tr><tr><td>HCP-20</td><td><strong>NEW:</strong> Added a new test that verifies that the distribution configurations between local members and SSMs are consistent.</td></tr><tr><td>HCP-13</td><td><strong>NEW:</strong> Added a new test that confirms that logs are being written to a Log Server and not locally.</td></tr><tr><td>HCP-21</td><td><strong>NEW:</strong>Added the Bond test and Corexl Status on VSX performance tests.</td></tr><tr><td>HCP-1</td><td>Running HCP on remote members using the \"-m\" flag is not available in Maestro environments.</td></tr><tr><td>HCP-23</td><td>Tests that are supposed to run only in Scalable Platform run in all environments.</td></tr><tr><td>HCP-17</td><td>The FW kern sanity test may fail when using parameter from type \"uint\".</td></tr><tr><td colspan=\"2\"><strong>Update 1 - Take 24 (18 February 2021)</strong></td></tr><tr><td>ODU-81</td><td>Initial Release</td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:18.759Z","annotations":[],"updated":"2025-05-06T23:04:46.282Z"},{"title":"Dynamic FW Accelerator Table","id":"144f41ef-0820-4628-bea8-89bfc3049e9e","type":"TEXT","raw":"<table id=\"Unique_ID_CLITable\"><tbody><tr data-darkreader-inline-bgcolor=\"\"><td>Command</td><td>Description</td></tr><tr><td><p><code>fwaccel help</code></p></td><td><p>Prints the general help message with available parameters.</p><p><em>Output</em>:</p><pre>Usage: fwaccel [-i &lt;ppak_id&gt;] off | on | ver | stat | conns | dbg &lt;...&gt; | help\n\nOptions:\n   off                     - disable acceleration (for new connections and tunnels)\n   on                      - enable  acceleration (for new connections and tunnels)\n   load_balance &lt;command&gt;  - get/set AC load balancing (-h for usage info)\n   ver                     - show accelerator/FW version\n   stat [-a] [-t] [-v]     - show acceleration status\n   stats &lt;options&gt;         - print the acceleration statistics\n   conns &lt;options&gt;         - print the accelerator's connections table\n   templates &lt;options&gt;     - print the accelerator's templates table\n   identities &lt;options&gt;    - print the accelerator's identities table (Note: This flag is not supported in R81.10 and higher versions)\n   revoked_ips &lt;options&gt;   - print the accelerator's revoked IPs table\n   dbg &lt;options&gt;           - set debug flags\n   dos                     - Interface to DOS mitigation techniques in SecureXL.\n   synatk &lt;options&gt;        - configure/query SYN Defender\n   ranges &lt;options&gt;        - print the range content \n   tab -t table_name       - print an accelerator table\n   feature &lt;name&gt; {on|off} - enable or disable acceleration of a protocol/feature\n   help                    - this help message\n</pre></td></tr><tr><td><p><code>fwaccel ehelp</code></p></td><td><p>Prints the extended help message with available parameters.</p><p><em>Output</em>:</p><pre>Usage: fwaccel cfg &lt;...&gt;\n\nOptions:\n   cfg &lt;options&gt;          - configure acceleration parameters\n</pre></td></tr><tr><td><p><code>fwaccel &lt;<em>parameter</em>&gt; -h</code></p></td><td><p>Prints the specific help message for given &lt;<em>parameter</em>&gt;.</p></td></tr><tr><td><p><code>fwaccel on [-a] [-q]</code></p></td><td><p>Starts acceleration on-the-fly (if Performance Pack is installed).</p><ul><li>\"<code>-q</code>\" - Suppresses the output</li><li>\"<code>-a</code>\" - Start acceleration on all Virtual Systems</li></ul><p><strong>Important</strong> - In R80.10 and higher, it is not supported to disable SecureXL.</p><p>Returned strings:</p><ul><li><code>SecureXL device is enabled.</code></li><li><code>Failed to init SecureXL.</code></li><li><code>No license for SecureXL.</code></li><li><code>SecureXL is disabled by the firewall. Please try again later.</code></li><li><code>The installed SecureXL device is not compatible with the installed firewall (version mismatch).</code></li><li><code>SecureXL cannot be started while \"flows\" are active.</code></li><li><code>SecureXL is already started.</code></li><li><code>SecureXL will be started after a policy is loaded.</code></li><li><code>fwaccel: Failed to check FloodGate-1 status. Acceleration will not be started.</code></li><li><code>FW-1: SecureXL acceleration cannot be started while QoS is running in express mode.<br>Please disable FloodGate-1 express mode or SecureXL.</code></li><li><code>FW-1: SecureXL acceleration cannot be started while QoS is running with citrix printing rule.<br>Please remove the citrix printing rule to enable SecureXL.</code></li><li><code>FW-1: SecureXL acceleration cannot be started while QoS is running with UAS rule.<br>Please remove the UAS rule to enable SecureXL.</code></li><li><code>FW-1: SecureXL acceleration cannot be started while QoS is running.<br>Please remove the QoS blade to enable SecureXL.</code></li><li><code>Failed to enable SecureXL device</code></li><li><code>fwaccel_on: failed to set process context <em>&lt;VSID&gt;</em></code></li></ul></td></tr><tr><td><p><code>fwaccel off [-a] [-q]</code></p></td><td><p>Stops acceleration on-the-fly.</p><ul><li>\"<code>-q</code>\" - Suppresses the output</li><li>\"<code>-a</code>\" - Stop acceleration on all Virtual Systems</li></ul><p><strong>Important</strong> - In R80.10 and higher, it is not supported to disable SecureXL.</p><p>Returned strings:</p><ul><li><code>SecureXL device disabled</code></li><li><code>SecureXL device is not active</code></li><li><code>Failed to disable SecureXL device</code></li><li><code>fwaccel_on: failed to set process context <em>&lt;VSID&gt;</em></code></li></ul></td></tr><tr><td><p><code>fwaccel ver</code></p></td><td><p>Shows SecureXL FWAccel and FireWall version.</p><p><em>Example</em>:</p><pre>Firewall version: R80.20 - Build 004\nAcceleration Device: Performance Pack \nAccelerator Version 2.1\nFirewall API version: 3.0NG (19/11/2015)\nAccelerator API version: 3.0NG (19/11/2015)\n</pre></td></tr><tr><td><p><code>fwaccel stat [-a]</code></p></td><td><p>Shows the SecureXL status.</p><ul><li>\"<code>-a</code>\" - Show SecureXL status for all Virtual Systems</li></ul><p><em>Examples</em>:</p><blockquote><dl><dt>Gateway mode:</dt><dd><pre>Accelerator Status : on\nAccept Templates   : enabled\nDrop Templates     : disabled\nNAT Templates      : disabled by user\n</pre></dd><dt>VSX mode:</dt><dd><pre>Virtual Device ID: 0\nAccelerator Status : off\n\nVirtual Device ID: 1\nAccelerator Status : on\nAccept Templates   : enabled\nDrop Templates     : disabled\nNAT Templates      : disabled by user\n\nVirtual Device ID: 2\nAccelerator Status : on\nAccept Templates   : enabled\nDrop Templates     : disabled\nNAT Templates      : disabled by user\n\nVirtual Device ID: 4\nAccelerator Status : on\nAccept Templates   : enabled\nDrop Templates     : disabled\nNAT Templates      : disabled by user\n</pre></dd></dl></blockquote><p>R80.20 and higher:</p><pre>+-----------------------------------------------------------------------+\n|Id|Name     |Status     |Interfaces        |Features                    |\n+------------------------------------------------------------------------+\n|0 |SND      |enabled    |eth1,Mgmt         |Acceleration,Cryptography   |\n|  |         |           |                  |Crypto: Tunnel,UDPEncap,MD5,|\n|  |         |           |                  |SHA1,NULL,3DES,DES,AES-128, |\n|  |         |           |                  |AES-256,ESP,LinkSelection,  |\n|  |         |           |                  |DynamicVPN,NatTraversal,    |\n|  |         |           |                  |AES-XCBC,SHA256             |\n+------------------------------------------------------------------------+\n\nAccept Templates : enabled\nDrop Templates   : disabled\nNAT Templates    : enabled</pre><p>Returned strings:</p><ul><li><p>Accelerator Status:</p><ul><li><pre>Accelerator Status : on\n</pre></li><li><pre>Accelerator Status : off\n</pre></li><li><pre>Accelerator Status : disabled by Firewall\n</pre></li><li><pre>Accelerator Status : waiting for policy load\n</pre></li><li><pre>Accelerator Status : no license for SecureXL\n</pre></li></ul></li><li><p>Accept Templates:</p><ul><li><pre>Accept Templates   : enabled\n</pre></li><li><pre>Accept Templates   : not supported by the SecureXL device\n</pre></li><li><pre>Accept Templates   : disabled by user\n</pre></li><li><pre>Accept Templates   : disabled by Firewall\n</pre><p><em>Additional information</em>:</p><ul type=\"circle\"><li><p>In R80.10 and higher:</p><pre>Accept Templates   : disabled by Firewall\n                     Layer &lt;Name_of_Layer&gt; disables template offloads from rule #&lt;N&gt;\n                     Throughput acceleration still enabled.\n</pre></li><li><p>In R77.30 and lower:</p><pre>Accept Templates : disabled by Firewall\n                   disabled from rule #&lt;N&gt;\n</pre></li></ul></li></ul></li><li><p>Drop Templates (refer to <a href=\"https://support.checkpoint.com/results/sk/sk66402\" target=\"_blank\" rel=\"noopener\">sk66402</a>):</p><ul><li><pre>Drop Templates     : enabled\n</pre></li><li><pre>Drop Templates     : disabled\n</pre></li><li><pre>Drop Templates     : not supported by the SecureXL device\n</pre></li><li><pre>Drop Templates     : disabled by user\n</pre></li><li><pre>Drop Templates     : disabled by Firewall\n</pre><p><em>Additional information</em>:</p><ul type=\"circle\"><li><p>In R80.10 and higher:</p><pre>Drop Templates     : disabled by Firewall\n                     Layer &lt;Name_of_Layer&gt; disables template offloads from rule #&lt;N&gt;\n                     Throughput acceleration still enabled.\n</pre></li><li><p>In R77.30 and lower:</p><pre>Drop Templates     : disabled by Firewall\n                     disabled from rule #&lt;N&gt;\n</pre></li></ul></li></ul></li><li><p>NAT Templates (refer to <a href=\"https://support.checkpoint.com/results/sk/sk71200\" target=\"_blank\" rel=\"noopener\">sk71200</a>):</p><ul><li><pre>NAT Templates      : enabled\n</pre></li><li><pre>NAT Templates      : not supported by the SecureXL device\n</pre></li><li><pre>NAT Templates      : disabled by user\n</pre></li><li><pre>NAT Templates      : disabled by Firewall\n</pre><p><em>Additional information</em>:</p><ul type=\"circle\"><li><p>In R80.10 and higher:</p><pre>NAT Templates      : disabled by Firewall\n                     Layer &lt;Name_of_Layer&gt; disables template offloads from rule #&lt;N&gt;\n                     Throughput acceleration still enabled.\n</pre></li><li><p>In R77.30 and lower:</p><pre>NAT Templates      : disabled by Firewall\n                     disabled from rule #&lt;N&gt;\n</pre></li></ul></li></ul></li><li><p>NMR Templates (refer to <a href=\"https://support.checkpoint.com/results/sk/sk117755\" target=\"_blank\" rel=\"noopener\">sk117755</a>):</p><ul><li><pre>NMR Templates      : enabled\n</pre></li><li><pre>NMR Templates      : disabled\n</pre></li></ul></li><li><p>NMT Templates (refer to <a href=\"https://support.checkpoint.com/results/sk/sk117755\" target=\"_blank\" rel=\"noopener\">sk117755</a>):</p><ul><li><pre>NMT Templates      : enabled\n</pre></li><li><pre>NMT Templates      : disabled\n</pre></li></ul></li></ul></td></tr><tr><td><p><code>fwaccel stats &lt;<em>options</em>&gt;</code></p></td><td><p>Shows all acceleration statistics (output is divided into relevant sections).</p><p><em>Example</em>:</p><pre>Name                             Value         Name                          Value          \n----------------------------  ------------  ----------------------------  ------------\n\nAccelerated Path\n--------------------------------------------------------------------------------------\naccel packets                            0    accel bytes                              0\noutbound packets                         0    outbound bytes                           0\nconns created                            0    conns deleted                            0\nC total conns                            0    C TCP conns                              0\nC non TCP conns                          0    nat conns                                0\ndropped packets                          0    dropped bytes                            0\nfragments received                       0    fragments transmit                       0\nfragments dropped                        0    fragments expired                        0\nIP options stripped                      0    IP options restored                      0\nIP options dropped                       5    corrs created                            0\ncorrs deleted                            0    C corrections                            0\ncorrected packets                        0    corrected bytes                          0\n\nAccelerated VPN Path\n--------------------------------------------------------------------------------------\nC crypt conns                            0    enc bytes                                0\ndec bytes                                0    ESP enc pkts                             0\nESP enc err                              0    ESP dec pkts                             0\nESP dec err                              0    ESP other err                            0\nespudp enc pkts                          0    espudp enc err                           0\nespudp dec pkts                          0    espudp dec err                           0\nespudp other err                         0    \n\nMedium Streaming Path\n--------------------------------------------------------------------------------------\nCPASXL packets                           0    PSLXL packets                            0\nCPASXL async packets                     0    PSLXL async packets                      0\nCPASXL bytes                             0    PSLXL bytes                              0\nC CPASXL conns                           0    C PSLXL conns                            0\nCPASXL conns created                     0    PSLXL conns created                      0\nPXL FF conns                             0    PXL FF packets                           0\nPXL FF bytes                             0    PXL FF acks                              0\nPXL no conn drops                        0    \n\nInline Streaming Path\n--------------------------------------------------------------------------------------\nPSL Inline packets                       0    PSL Inline bytes                         0\nCPAS Inline packets                      0    CPAS Inline bytes                        0\n\nBuffer Path\n--------------------------------------------------------------------------------------\nBuffer path buffers                      0    Buffer path bytes                        0\n\nTLS PARSER\n--------------------------------------------------------------------------------------\nRECORD INFO                              0    \n\nTLS DECRYPT\n--------------------------------------------------------------------------------------\nTLS INSPECTION                           0    TLS HANDSHAKE                            0\nTLS RECORD LAYER                         0    TLS CRYPTO                               0\n\nHTTP DISP\n--------------------------------------------------------------------------------------\nACTIVATE WS MAIN                         0    EXEC NO HTTP CMI CONTEXT                 0\n\nWS LITE\n--------------------------------------------------------------------------------------\nWS TX COMPLETED                          0    WS FORWARD TO MAIN                       0\nWS NOTIFY TIMEOUT                        0    WS HANDLE EVENT                          0\nWS CHUNKED ERROR                         0    WS GZIP EVENT                            0\nWS ADD MAC HEADER                        0    WS IS STICKY ACTIVE                      0\nWS TIER1 JOB ERROR                       0    WS TIER1 HAS MATCHES                     0\nCML MATCHES                              0    TOTAL UPLOADED JOBS                      0\nTOTAL JOBS                               0    \n\nADVP\n--------------------------------------------------------------------------------------\nADVP FORW TO MAIN                        0    ADVP HOLD TIMEOUT                        0\n\nQoS Paths\n--------------------------------------------------------------------------------------\nQoS General Information:\n------------------------\nTotal QoS Conns                          0    QoS Classify Conns                       0\nQoS Classify flow                        0    Reclassify QoS policy                    0\n\nFireWall QoS Path:\n------------------\nEnqueued IN packets                      0    Enqueued OUT packets                     0\nDequeued IN packets                      0    Dequeued OUT packets                     0\nEnqueued IN bytes                        0    Enqueued OUT bytes                       0\nDequeued IN bytes                        0    Dequeued OUT bytes                       0\n\nAccelerated QoS Path:\n---------------------\nEnqueued IN packets                      0    Enqueued OUT packets                     0\nDequeued IN packets                      0    Dequeued OUT packets                     0\nEnqueued IN bytes                        0    Enqueued OUT bytes                       0\nDequeued IN bytes                        0    Dequeued OUT bytes                       0\n\nFirewall Path\n--------------------------------------------------------------------------------------\nF2F packets                         908718    F2F bytes                         94872934\nTCP violations                           0    F2V conn match pkts                      0\nF2V packets                              0    F2V bytes                                0\n\nGTP\n--------------------------------------------------------------------------------------\ngtp tunnels created                      0    gtp tunnels                              0\ngtp accel pkts                           0    gtp f2f pkts                             0\ngtp spoofed pkts                         0    gtp in gtp pkts                          0\ngtp signaling pkts                       0    gtp tcpopt pkts                          0\ngtp apn err pkts                         0    \n\nGeneral\n--------------------------------------------------------------------------------------\nmemory used                           1752    C tcp handshake conns                    0\nC tcp established conns                  0    C tcp closed conns                       0\nC tcp pxl handshake conns                0    C tcp pxl established conns              0\nC tcp pxl closed conns                   0    DNS DoR stats                            0\n\n(*) Statistics marked with C refer to current value, others refer to total value\n</pre></td></tr><tr><td><p><code>fwaccel stats -h</code></p></td><td><p>Shows the help message with available flags for '<code>stats</code>' parameter.</p><p><em>Output</em>:</p><pre>Usage: fwaccel stats &lt;options&gt;\n\nOptions:\n   -s                      - print only statistics summary\n   -d                      - drop from device statistics\n   -n                      - NAC statistics\n   -p                      - print SXL violations (f2f packets) statistics\n   -l                      - print statistics in legacy mode\n   -r                      - reset statistics\n   -m                      - print multicast traffic statistics\n   -q                      - notifications sent to the FW\n   -c                      - print cluster correction statistics\n   -x                      - print PXL statistics\n   -o                      - Reorder I/S\n   -t                      - Traffic distribution\n   -u                      - Callqueue\n   -k                      - PPAK Network per cpu\n   -h                      - this help message\n</pre></td></tr><tr><td><p><code>fwaccel stats -s</code></p></td><td><p>Shows the summary of all acceleration statistics.</p><p><em>Example</em>:</p><pre>Accelerated conns/Total conns : 0/0 (0%)\nAccelerated pkts/Total pkts   : 0/910096 (0%)\nF2Fed pkts/Total pkts         : 910096/910096 (100%)\nF2V pkts/Total pkts           : 0/910096 (0%)\nCPASXL pkts/Total pkts        : 0/910096 (0%)\nPSLXL pkts/Total pkts         : 0/910096 (0%)\nCPAS inline pkts/Total pkts   : 0/910096 (0%)\nPSL inline pkts/Total pkts    : 0/910096 (0%)\nQOS inbound pkts/Total pkts   : 0/910096 (0%)\nQOS outbound pkts/Total pkts  : 0/910096 (0%)\nCorrected pkts/Total pkts     : 0/910096 (0%)\n</pre></td></tr><tr><td><p><code>fwaccel stats -d</code></p></td><td><p>Shows the acceleration statistics for dropped packets.</p><p><em>Example</em>:</p><pre>Reason                Value              Reason                Value          \n--------------------  ---------------    --------------------  ---------------\nGeneral                             0    CPASXL Decision                     0\nPSLXL Decision                      0    Clear Packet on VPN                 0\nEncryption Failed                   0    Drop Template                       0\nDecryption Failed                   0    Interface Down                      0\nCluster Error                       0    XMT Error                           0\nAnti-Spoofing                       0    Local Spoofing                      0\nSanity Error                        0    Monitored Spoofed                   0\nQXL Decision                        0    C2S Violation                       0\nS2C Violation                       0    Loop Prevention                     0\nDOS Fragments                       0    DOS IP Options                      0\nDOS Blacklists                      0    DOS Penalty Box                     0\nDOS Rate Limiting                   0    Syn Attack                          0\nReorder                             0    Virt Defrag Timeout                 0\nInvalid Interface                   0    Null Routing info                   0\nUnable to get out ifn               0    Resource exhausted                  0\nConn not found                      0    Failed to del corr                  0\nCorr instead of conn                0    Del zombie conn fail                0\nFW UUID no match                    0    Offload mismatch                    0\nSIM init failed                     0    Null stream init info               0\nUnable to get CGNAT                 0    Null stream app info                0\nFailed get init info                0    SIM add stream failed               0\nCollid conn not found               0    Del collid conn fail                0\nAdd conn after collid               0    SEQ valid                           0\nEnqueue QoS failed                  0    AUX CI null                         0\nLink dead                           0    VPN packet too big                  0\nNAT64 failed                        0    NAT46 failed                        0\nPacket &gt; MTU                        0    NAC validation                      0\nTCP state violation                 0    Enforce packet                      0\nGTP check packet                    0    Bridge route error                  0\nRoute ifn changed                   0    IP forwarding                       0\nCopy MACS failed                    0    Fragments Drops                     0\nSend Notification                   0    Conn not found RST                  0\nForward to PPAK fail                0    Cluster forward fail                0\nF2F before encrypt                  0    Forward dst encrypt                 0\nCorrection I/S fail                 0    Do inbound F2F                      0\nPacket UDP failed                   0    F2F not allowed                     0\nDo routing                          0    Fanout won't F2F                    0\nSCTP validation fail                0    SCTP not data                       0\n</pre></td></tr><tr><td><p><code>fwaccel stats -n</code></p></td><td><p>Shows the acceleration statistics for Network Access Control (NAC).</p><p>Note: Refer to the <a href=\"https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation\" target=\"_blank\" rel=\"noopener\">Identity Awareness Administration Guide</a> for your version.</p><p><em>Example</em>:</p><pre>Name                  Value              Name                  Value          \n--------------------  ---------------    --------------------  ---------------\nNAC packets                         0    NAC bytes                           0\nNAC connections                     0  complience failure                  0\n</pre></td></tr><tr><td><p><code>fwaccel stats -p</code></p></td><td><p>Shows the acceleration statistics for SecureXL violations (F2F packets).</p><p>This is the list of violation counters and their descriptions:</p><ul><li><code>pkt has IP options</code> - Packets with IP options are always F2F</li><li><code>ICMP miss conn</code> - ICMP packets, for which no ICMP connection was found in SecureXL tables</li><li><code>TCP-SYN miss conn</code> - TCP-SYN packets, for which no TCP connection was found in SecureXL tables</li><li><code>TCP-other miss conn</code> - TCP packets (other than TCP-SYN), for which no TCP connection was found in SecureXL tables</li><li><code>UDP miss conn</code> - UDP packets, for which no UDP connection was found in SecureXL tables</li><li><code>other miss conn</code> - Other packets (non-TCP/non-UDP/non-ICMP), for which no connection was found in SecureXL tables</li><li><code>VPN returned F2F</code> - Post VPN encrypt / Post VPN decrypt decision was to F2F these packets</li><li><code>uni-directional viol</code> - These packets \"seen\" in opposite direction (as recorded in the kernel tables) to their corresponding connections that were offloaded by FireWall as uni-directional</li><li><code>possible spoof viol</code> - These packets failed Anti-Spoofing checks</li><li><code>TCP state viol</code> - These packets failed TCP state validation checks (includes Sequence validations)</li><li><code>out if not def/accl</code> - These packets passed through outgoing interface that is marked as non-accelerated (see <a href=\"https://support.checkpoint.com/results/sk/sk79880\" target=\"_blank\" rel=\"noopener\">sk79880</a>)</li><li><code>bridge, src=dst</code> - These packets passed the same interface (in Bridge mode, inbound / outbound interfaces are the same)</li><li><code>routing decision err</code> - ARP was not resolved for these packets</li><li><code>sanity checks failed</code> - VPN post-decryption sanity checks failed for these packets</li><li><code>temp conn expired</code> - These packets arrives on Temp connection, which has lived past TTL, or packet count</li><li><code>partial conn</code> - These were inbound packets matched to partial connections</li><li><code>PXL returned F2F</code> - These inbound packets were F2F based on PXL decision</li><li><code>cluster forward</code> - These packets were Forwarded to this cluster member over Sync interface from peer members (see \"Packet Forwarding\" in <a href=\"https://support.checkpoint.com/results/sk/sk93306\" target=\"_blank\" rel=\"noopener\">sk93306</a>)</li></ul><p><em>Example</em>:</p><pre>F2F packets:\n--------------\nViolation             Packets            Violation             Packets        \n--------------------  ---------------    --------------------  ---------------\npkt has IP options                  0    ICMP miss conn                      0\nTCP-SYN miss conn                  11    TCP-other miss conn             23567\nUDP miss conn                 3572453    other miss conn                     0\nVPN returned F2F                    0    uni-directional viol                0\npossible spoof viol                 0    TCP state viol                      0\nout if not def/accl                 0    bridge, src=dst                     0\nrouting decision err                0    sanity checks failed                0\nfwd to non-pivot                    0    broadcast/multicast                 0\ncluster message                     0    cluster forward                     0\nchain forwarding                    0    F2V conn match pkts                 0\ngeneral reason                      0    route changes                       0\n</pre></td></tr><tr><td><p><code>fwaccel stats -l</code></p></td><td><p>Shows all acceleration statistics in Legacy mode (output is <strong>not</strong> divided into sections).</p><p><em>Example</em>:</p><pre>    Name                          Value         Name                          Value          \n----------------------------  ------------  ----------------------------  ------------\n-                                       0    accel packets                           0\naccel bytes                             0    outbound packets                        0\noutbound bytes                          0    conns created                           0\nconns deleted                           0    C total conns                           0\nC TCP conns                             0    C non TCP conns                         0\nnat conns                               0    dropped packets                         0\ndropped bytes                           0    fragments received                      0\nfragments transmit                      0    fragments dropped                       0\nfragments expired                       0    IP options stripped                     0\nIP options restored                     0    IP options dropped                      5\ncorrs created                           0    corrs deleted                           0\nC corrections                           0    corrected packets                       0\ncorrected bytes                         0    C crypt conns                           0\nenc bytes                               0    dec bytes                               0\nESP enc pkts                            0    ESP enc err                             0\nESP dec pkts                            0    ESP dec err                             0\nESP other err                           0    espudp enc pkts                         0\nespudp enc err                          0    espudp dec pkts                         0\nespudp dec err                          0    espudp other err                        0\nacct update interval                 3600    CPASXL packets                          0\nPSLXL packets                           0    CPASXL async packets                    0\nPSLXL async packets                     0    CPASXL bytes                            0\nPSLXL bytes                             0    C CPASXL conns                          0\nC PSLXL conns                           0    CPASXL conns created                    0\nPSLXL conns created                     0    PXL FF conns                            0\nPXL FF packets                          0    PXL FF bytes                            0\nPXL FF acks                             0    PXL no conn drops                       0\nPSL Inline packets                      0    PSL Inline bytes                        0\nCPAS Inline packets                     0    CPAS Inline bytes                       0\nBuffer path buffers                     0    Buffer path bytes                       0\nRECORD INFO                             0    TLS INSPECTION                          0\nTLS HANDSHAKE                           0    TLS RECORD LAYER                        0\nTLS CRYPTO                              0    ACTIVATE WS MAIN                        0\nEXEC NO HTTP CMI CONTEXT                0    WS TX COMPLETED                         0\nWS FORWARD TO MAIN                      0    WS NOTIFY TIMEOUT                       0\nWS HANDLE EVENT                         0    WS CHUNKED ERROR                        0\nWS GZIP EVENT                           0    WS ADD MAC HEADER                       0\nWS IS STICKY ACTIVE                     0    WS TIER1 JOB ERROR                      0\nWS TIER1 HAS MATCHES                    0    CML MATCHES                             0\nTOTAL UPLOADED JOBS                     0    TOTAL JOBS                              0\nADVP FORW TO MAIN                       0    ADVP HOLD TIMEOUT                       0\nTotal QoS Conns                         0    QoS Classify Conns                      0\nQoS Classify flow                       0    Reclassify QoS policy                   0\nEnqueued IN packets                     0    Enqueued OUT packets                    0\nDequeued IN packets                     0    Dequeued OUT packets                    0\nEnqueued IN bytes                       0    Enqueued OUT bytes                      0\nDequeued IN bytes                       0    Dequeued OUT bytes                      0\nEnqueued IN packets                     0    Enqueued OUT packets                    0\nDequeued IN packets                     0    Dequeued OUT packets                    0\nEnqueued IN bytes                       0    Enqueued OUT bytes                      0\nDequeued IN bytes                       0    Dequeued OUT bytes                      0\nF2F packets                       1071330    F2F bytes                       125339139\nTCP violations                          0    F2V conn match pkts                     0\nF2V packets                             0    F2V bytes                               0\ngtp tunnels created                     0    gtp tunnels                             0\ngtp accel pkts                          0    gtp f2f pkts                            0\ngtp spoofed pkts                        0    gtp in gtp pkts                         0\ngtp signaling pkts                      0    gtp tcpopt pkts                         0\ngtp apn err pkts                        0    memory used                          1752\nC tcp handshake conns                   0    C tcp established conns                 0\nC tcp closed conns                      0    C tcp pxl handshake conns               0\nC tcp pxl established conns             0    C tcp pxl closed conns                  0\nDNS DoR stats                           0    \n\n(*) Statistics marked with C refer to current value, others refer to total value  \n\n</pre></td></tr><tr><td><p><code>fwaccel stats -m</code></p></td><td><p>Shows the acceleration statistics for multicast traffic.</p><p><em>Example</em>:</p><pre>Name                  Value              Name                  Value          \n--------------------  ---------------    --------------------  ---------------\nin packets                      20066    out packets                         0\nif restricted                       0    conns with down if                  0\nf2f packets                         0    f2f bytes                           0\ndropped packets                     0    dropped bytes                       0\naccel packets                       0    accel bytes                         0\nmcast conns                         3    \n</pre></td></tr><tr><td><p><code>fwaccel stats -q</code></p></td><td><p>Shows the notifications sent to the FireWall (in R80.10 and higher).</p><p><em>Example</em>:</p><pre>Notification           Packets           Notification           Packets\n---------------------  --------------    ---------------------  --------------\nntSAAboutToExpire                   0    ntSAExpired                         0\nntMSPIError                         0    ntNoInboundSA                       0\nntNoOutboundSA                      0    ntDataIntegrityFailed               0\nntPossibleReplay                    0    ntReplay                            0\nntNextProtocolError                 0    ntCPIError                          0\nntClearTextPacket                   0    ntFragmentation                     0\nntUpdateUdpEncTable                 0    ntSASync                            0\nntReplayOutOfWindow                 0    ntVPNTrafficReport                  0\nntConnDeleted                       0    ntConnUpdate                        0\nntPacketDropped                     0    ntSendLog                           0\nntRefreshGTPTunnel                  0    ntMcastDrop                         0\nntAccounting                        0    ntAsyncIndex                        0\nntACkReordering                     0    ntAccelAckInfo                      0\nntMonitorPacket                     0    ntPacketCapture                     0\nntCpasPacketCapture                 0    ntPSLGlueUpdateReject               0\nntSeqVerifyDrop                     0    ntPacketForwardBefore               0\nntICMPMessage                       0    ntQoSReclassifyPacket               0\nntQoSResumePacket                   0    ntVPNEncHaLinkFailure               0\nntVPNEncLsLinkFailure               0    ntVPNEncRouteChange                 0\nntVPNDecVerRouteChang               0    ntVPNDecRouteChange                 0\nntMuxSimToFw                        0    ntPSLEventLog                       0\nntSendCPHWDStats               894547    ntPacketTaggingViolat               0\nntDosNotify                         0    ntSynatkNotify                      0\nntSynatkStats                       0    ntQoSEventLog                       0\nntPrintGetParam                     0    ntMuxSendLog                        0\n</pre></td></tr><tr><td><p><code>fwaccel stats -r</code></p></td><td><p>Resets all counters for acceleration statistics.</p></td></tr><tr><td><p><code>fwaccel conns &lt;<em>options</em>&gt;</code></p></td><td><p>Shows the SecureXL Connections Table ('<code>cphwd_db</code>').</p><p>Note: Depending on the number of concurrent connections, might consume memory and CPU at very high level (e.g., see <a href=\"https://support.checkpoint.com/results/sk/sk118716\" target=\"_blank\" rel=\"noopener\">sk118716</a>).</p><p>Returned strings:</p><ul><li><code>The SecureXL connections table is empty</code></li><li><code>Failed to read the SecureXL connections table</code></li><li><code>There are <em>VALUE</em> connections in SecureXL connections table<br>...<br>Total number of connections: <em>VALUE</em></code></li></ul><p><em>Examples</em>:</p><ul><li><p>In versions R81 and higher:</p><pre>Source   SPort Destination DPort PR Flags           TCP state   C2S i/f S2C i/f Inst PPAK ID Policy ID  CPU Total Pkts  Total Bytes Last Seen  Duration   TTL/Timeout\n-------- ----- ----------- ----- -- --------------- ----------- ------- ------- ---- ------- ---------- --- ----------- ----------- ---------- ---------- -----------\n1.1.1.11 46214 2.2.2.11     5000  6 ................Established 2/3     3/2     0     0      921968612   0   15         1.07KB      5s         7s         3595/3600 \n2.2.2.11  5000 1.1.1.11    46214  6 ..........L.....Established 2/3     3/2     0     0      921968612   0   15         1.07KB      5s         7s         3595/3600 \n\nIdx Interface\n--- ---------\n0   lo\n1   eth0\n2   eth1\n3   eth2\n\nTotal number of connections: 1\nTotal number of links: 1 </pre><ul><li>New columns added to the '<em>fwaccel conns</em>' output:<ul><li><code>Last seen</code> - time passed since last packet on this connection</li><li><code>Duration</code> - time passed since the connection was created</li><li><code>Total Bytes</code> - total bytes passed on the connection since it was created</li><li><code>Total Pkts</code> - total packets passed on the connection since it was created</li></ul></li><li><code>TTL/Timeout</code> - now shows the real timeout (in versions R80.40 and lower, it shows the timeout of the entry on the connection table and not real session timeout)</li><li>Available in these versions:<ul><li><a href=\"https://support.checkpoint.com/results/sk/sk166715\" target=\"_blank\" rel=\"noopener\">Check Point R81</a> and higher</li><li><a href=\"https://support.checkpoint.com/results/sk/sk165456\" target=\"_blank\" rel=\"noopener\">Jumbo Hotfix Accumulator for R80.40</a> - Take 100 and higher</li><li><a href=\"https://support.checkpoint.com/results/sk/sk153152\" target=\"_blank\" rel=\"noopener\">Jumbo Hotfix Accumulator for R80.30</a> - Take 232&nbsp;and higher</li><li><a href=\"https://support.checkpoint.com/results/sk/sk137592\" target=\"_blank\" rel=\"noopener\">Jumbo Hotfix Accumulator for R80.20</a> - Take 190&nbsp;and higher</li></ul></li></ul></li><li><p>In versions R80.20 - R80.40:</p><pre>Source    SPort Destination DPort PR  Flags           TCP state    C2S i/f S2C i/f Inst PPAK ID Policy ID  CPU Held Pkts TTL/Timeout\n------    ----- ----------- ----- --- --------------- ------------ ------- ------- ---- ------- --------- ---- --------- -----------\n2.2.2.10  5000  1.1.1.10    48744  6  ...A..S..L..... Established    2/3    3/2     2     0     1193219296  0      0       510/512\n1.1.1.10 48744  2.2.2.10     5000  6  ...A..S........ Established    2/3    3/2     2     0     1193219296  0      0       510/512\n\nIdx Interface\n--- ---------\n0 lo\n1 eth0\n2 eth1\n3 eth2\n4 eth3\n\nTotal number of connections: 1\nTotal number of links: 1 </pre></li></ul></td></tr><tr><td><p><code>fwaccel conns -h</code></p></td><td><p>Shows the help message with available flags for '<code>conns</code>' parameter.</p><p><em>Output</em>:</p><pre>Usage: fwaccel conns &lt;options&gt;\n\nOptions:\n   -m &lt;max entries&gt;        - max number of entries to print\n   -f &lt;filter&gt;             - print only entries matching the filter\n   -s                      - print only number of connections\n   -h                      - this help message\n\nFilter (one or more of the below flags):\n   U/u                     - unidirectional/bidirectional\n   N/n                     - entries with/without NAT\n   A/a                     - accounted/not accounted\n   C/c                     - encrypted/not encrypted\n   S/s                     - pxl enabled/disabled\n   Q/q                     - qxl enabled/disabled\n   L/l                      - Link/not link\n   V/v                     - forward to VM - (Accelerated packets which are forwarded to the Firewall for inbound processing, and afterwards return back to SecureXL)\n</pre></td></tr><tr><td><p><code>fwaccel conns -s</code></p></td><td><p>Shows the summary of SecureXL Connections Table (number of connections).</p><p>Note: Depending on the number of concurrent connections, might consume memory at very high level.</p><p><em>Example</em>:</p><pre>There are 56 connections in SecureXL connections table\n</pre></td></tr><tr><td><p><code>fwaccel conns -m &lt;<em>max_entries</em>&gt;<em></em></code></p></td><td><p>Shows the SecureXL Connections Table limited to the number of <em>max_entries</em>.</p></td></tr><tr><td><p><code>fwaccel conns -f &lt;<em>filter</em>&gt;</code></p></td><td><p>Shows the SecureXL Connections Table entries based on &lt;<em>filter</em>&gt; (run '<code>fwaccel conns -h</code>').</p><p>The filtering flag is a single letter (either capital, or small).</p></td></tr><tr><td><p><code>fwaccel templates &lt;<em>options</em>&gt;</code></p></td><td><p>Shows the SecureXL Connections Templates ('<code>cphwd_tmpl</code>', id 8111).</p><p>Note: Depending on the number of current templates, might consume memory at very high level.</p><p>Returned strings:</p><ul><li><code>The SecureXL templates table is empty</code></li><li><code>Failed to read the SecureXL templates table</code></li><li><code>There are <em>VALUE</em> templates in SecureXL templates table<br>...<br>Total number of templates: <em>VALUE</em></code></li></ul></td></tr><tr><td><p><code>fwaccel templates -h</code></p></td><td><p>Shows the help message with available flags for '<code>templates</code>' parameter.</p><p><em>Output in R80.20 and higher:</em></p><pre>Usage: fwaccel templates &lt;options&gt;\n\nOptions:\n   -m &lt;max entries&gt;        - max number of entries to print\n   -s                      - print only the number of offloaded templates\n   -S                      - prints statistics\n   -d                      - prints drop templates\n   -h                      - this help message\n\nAccept templates flags (one or more of the below flags):\n   U                       - unidirectional\n   N                       - NAT\n   A                       - accounted\n   S                       - pxl enabled\n   Q                       - qxl enabled\n   I                       - NAC enabled\n   O                       - created for rule with/below dynamic object\n   D                       - created for rule with/below domain object\n   T                       - created for rule with/below time object\n   Z                       - created for rule with/below Sec Zone object\n   B                       - created for rule with/below IDA support object\n   R                       - created for rule with/below Traceroute object\n   P                       - created for a connection that may match on a service with src port\nDrop templates flags (one or more of the below flags):\n   D                       - drop template\n   L                       - log drop action\n</pre></td></tr><tr><td><p><code>fwaccel templates -s</code></p></td><td><p>Shows the summary of SecureXL Connections Templates (number of templates).</p><p>Note: Depending on the number of current templates, might consume memory at very high level.</p></td></tr><tr><td><p><code>fwaccel templates -d</code></p></td><td><p>Shows the Drop Templates table.</p></td></tr><tr><td><p><code>fwaccel templates -m &lt;<em>max_entries&gt;</em></code></p></td><td><p>Shows the SecureXL Connections Templates limited to the number of <em>max_entries</em>.</p></td></tr><tr><td><p><code>fwaccel identities &lt;<em>options</em>&gt;</code></p></td><td><p>Shows the SecureXL Identities Table ('<code>cphwd_dev_identity_table</code>').</p><p>Returned strings:</p><ul><li><code>The SecureXL identity table is empty</code></li><li><code>Failed to read the SecureXL identity table - no memory</code></li><li><code>There are <em>VALUE</em> identities in SecureXL identities table<br>...<br>Total number of identities: <em>VALUE</em></code></li></ul><p>Notes:</p><ul><li>Refer to the <a href=\"https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation\" target=\"_blank\" rel=\"noopener\">Identity Awareness Administration Guide</a> for your version</li><li>Command is not available for IPv6</li></ul></td></tr><tr><td><p><code>fwaccel identities -h</code></p></td><td><p>Shows the help message with available flags for '<code>identities</code>' parameter.</p><p><em>Output</em>:</p><pre>Usage: fwaccel identities &lt;options&gt;\n\nOptions:\n   -m &lt;max entries&gt;        - max number of entries to print\n   -s                      - print only number of connections\n   -h                      - this help message\n</pre></td></tr><tr><td><p><code>fwaccel identities -s</code></p></td><td><p>Shows the summary of SecureXL Identities Table (number of entries).</p></td></tr><tr><td><p><code>fwaccel identities -m &lt;<em>max_entries&gt;</em></code></p></td><td><p>Shows the SecureXL Identities Table limited to the number of <em>max_entries</em>.</p></td></tr><tr><td><p><code>fwaccel revoked_ips &lt;<em>options</em>&gt;</code></p></td><td><p>Shows the SecureXL Revoked IPs Table ('<code>cphwd_dev_revoked_ips_table</code>').</p><p>Returned strings:</p><ul><li><code>The SecureXL templates' revoked IPs table is empty</code></li><li><code>Failed to read the SecureXL templates' revoked IPs table - no memory</code></li><li><code>There are <em>VALUE</em> revoked IPs in SecureXL templates' revoked IPs table<br>...<br>Total number of templates' revoked IPs:: <em>VALUE</em></code></li></ul><p>Notes:</p><ul><li>Refer to the <a href=\"https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation\" target=\"_blank\" rel=\"noopener\">Identity Awareness Administration Guide</a> for your version</li><li>Command is not available for IPv6</li></ul></td></tr><tr><td><p><code>fwaccel revoked_ips -h</code></p></td><td><p>Shows the help message with available flags for '<code>revoked_ips</code>' parameter.</p><p><em>Output</em>:</p><pre>Usage: fwaccel revoked_ips -h\n\nOptions:\n   -m &lt;max entries&gt;        - max number of entries to print\n   -s                      - print only number of connections\n   -h                      - this help message\n</pre></td></tr><tr><td><p><code>fwaccel revoked_ips -s</code></p></td><td><p>Shows the summary of SecureXL Revoked IPs Table (number of entries).</p></td></tr><tr><td><p><code>fwaccel revoked_ips -m &lt;<em>max_entries&gt;</em></code></p></td><td><p>Shows the SecureXL Revoked IPs Table limited to the number of <em>max_entries</em>.</p></td></tr><tr><td><p><code>fwaccel dbg &lt;<em>options</em>&gt;</code></p></td><td><p>Controls the SecureXL debug (run '<code>fwaccel dbg -h</code>').</p><p>By default, the debug messages will be printed to <em>/var/log/messages</em> file.</p><p>Therefore, you must set the usual kernel debugging options using these commands (refer to the section \"<span targetid=\"Debug\">SecureXL Debug</span>\"):</p><p><code>[Expert@HostName:0]# fw ctl debug 0<br>[Expert@HostName:0]# fwaccel dbg resetall<br>[Expert@HostName:0]# fw ctl debug -buf 32000<br>[Expert@HostName:0]# fwaccel dbg -m <em>MODULE</em> + <em>FLAG1 FLAG2 ... FLAGn</em><br>[Expert@HostName:0]# fwaccel dbg list<br>[Expert@HostName:0]# fw ctl kdebug -T -f &gt; /var/log/debug.txt</code></p></td></tr><tr><td><p><code>fwaccel dbg -h</code></p></td><td><p>Shows the help message with available options, list of debug modules and their flags.</p><p><em>Output</em>:</p><pre>Usage: fwaccel dbg [-m &lt;...&gt;] [resetall | reset | list | all | +/- &lt;flags&gt;]\n   -m &lt;module&gt;             - module of debugging\n   -h                      - this help message\n   resetall                - reset all debug flags for all modules\n   reset                   - reset all debug flags for module\n   all                     - set all debug flags for module\n   list                    - list all debug flags for all modules\n   -f reset | \"&lt;5-tuple&gt;\"  - filter debug messages\n   + &lt;flags&gt;               - set the given debug flags\n   - &lt;flags&gt;               - unset the given debug flags\n\nList of available modules and flags:\n... ... ...\n</pre></td></tr><tr><td><p><code>fwaccel dbg list</code></p></td><td><p>Shows all currently enabled debug flags for all debug modules.</p></td></tr><tr><td><p><code>fwaccel dbg resetall</code></p></td><td><p>Resets all debug flags for all debug modules to their default (none).</p></td></tr><tr><td><p><code>fwaccel dbg -m <em>MODULE</em> reset</code></p></td><td><p>Resets all debug flags for the specified debug module to their default (none).</p></td></tr><tr><td><p><code>fwaccel dbg -m <em>MODULE</em> all</code></p></td><td><p>Enables all supported debug flags for the specified debug module.</p></td></tr><tr><td><p><code>fwaccel dbg -m <em>MODULE</em> + <em>FLAG1 FLAG2 ... FLAGn</em></code></p></td><td><p>Enables the specified debug flags for the specified debug module.</p></td></tr><tr><td><p><code>fwaccel dbg -m <em>MODULE</em> - <em>FLAG1 FLAG2 ... FLAGn</em></code></p></td><td><p>Disables the specified debug flags for the specified debug module.</p></td></tr><tr><td><p><code>fwaccel dbg -f <em>Source_IP</em>,<em>Source_Port</em>,<em>Dest_IP</em>,<em>Dest_Port</em>,<em>Proto</em></code></p></td><td><p>Configures the debugging filter - only the specified connection will be printed in the debug output.</p><p>Notes:</p><ul><li>Only one filter can be set at one time</li><li>You can use the asterisk \"*\" as a wildcard for IP Address / Port number / Protocol number</li></ul><p><em>Example for an SSH connection</em>:</p><code>[Expert@HostName:0]# fwaccel dbg -f 172.30.1.1,*,172.30.41.90,22,6</code></td></tr><tr><td><p><code>fwaccel dbg -f reset</code></p></td><td><p>Resets the debugging filter.</p></td></tr><tr><td><p><code>fwaccel cfg &lt;<em>options</em>&gt;</code></p></td><td><p>Configures the acceleration parameters (run '<code>fwaccel cfg</code>').</p></td></tr><tr><td><p><code>fwaccel cfg -h</code></p></td><td><p>Shows the help message with available configuration parameters.</p><p><em>Output</em>:</p><pre>Usage: fwaccel cfg &lt;options&gt;\n\nOptions:\n   -i &lt;on | off&gt;           - ignore api version mismatch\n   -t &lt;seconds&gt;            - api call timeout\n   -r &lt;number&gt;             - api call retries\n   -d &lt;number&gt;             - deletion retries\n   -e &lt;number&gt;             - general errors limit\n   -a &lt;ifn | name&gt; | reset - define unaccelerated interface\n   -p &lt;on | off&gt;           - offload templates if possible\n   -l &lt;number&gt;             - templates database limit (0 for default)\n   -m &lt;seconds&gt;            - templates timeout (0 for default)\n   -c &lt;number&gt;             - connections threshold to disable templates\n   -v &lt;seconds&gt;            - statistics request interval (0 to disable)\n   -s &lt;on | off&gt;           - enable/disable ClusterXL LS support\n   -w &lt;on | off&gt;           - enable/disable warnings for sequence verifier\n   -b &lt;on | off&gt;           - enable/disable drop templates matching\n   -h                      - this help message\n</pre></td></tr><tr><td><p><code>fwaccel cfg -i {on | off}</code></p></td><td><p>Configures SecureXL to ignore API version mismatch:</p><ul><li><code>fwaccel cfg -i on</code> = ignore API version mismatch</li><li><code>fwaccel cfg -i off</code> = do not ignore API version mismatch (default)</li></ul></td></tr><tr><td><p><code>fwaccel cfg -r &lt;<em>number</em>&gt;</code></p></td><td><p>Configures SecureXL API call retries.</p></td></tr><tr><td><p><code>fwaccel cfg -d &lt;<em>number</em>&gt;</code></p></td><td><p>Configures SecureXL deletion retries.</p></td></tr><tr><td><p><code>fwaccel cfg -e &lt;<em>number</em>&gt;</code></p></td><td><p>Configures SecureXL general errors limit.</p></td></tr><tr><td><p><code>fwaccel cfg -a &lt;if_number | <em>name</em>&gt;</code></p></td><td><p>Configures the specified interface as non-accelerated in one of these ways:</p><ul><li>By its number in the Check Point kernel (run the '<code>fw ctl iflist</code>' command)</li><li>By its name (run the '<code>ifconfig -a | grep HWaddr</code>' command)</li></ul></td></tr><tr><td><p><code>fwaccel cfg -p {on | off}</code></p></td><td><p>Configures SecureXL offload templates (if possible):</p><ul><li><code><em>fwaccel cfg -p on</em></code> = enable offloading of new templates (default)</li><li><code><em>fwaccel cfg -p off</em></code> = disable offloading of new templates</li></ul></td></tr><tr><td><p><code>fwaccel cfg -l &lt;<em>number</em>&gt;</code></p></td><td><p>Configures the SecureXL templates database limit (0 for default).</p></td></tr><tr><td><p><code>fwaccel cfg -m &lt;<em>seconds</em>&gt;</code></p></td><td><p>Configures the SecureXL templates timeout (0 for default).</p></td></tr><tr><td><p><code>fwaccel cfg -c &lt;<em>number</em>&gt;</code></p></td><td><p>Configures the SecureXL connections threshold to disable templates.</p></td></tr><tr><td><p><code>fwaccel cfg -v &lt;<em>seconds</em>&gt;</code></p></td><td><p>Configures the SecureXL statistics request interval (0 to disable).</p></td></tr><tr><td><p><code>fwaccel cfg -w {on | off}</code></p></td><td><p>Configures SecureXL support for warnings for IPS protection 'Sequence Verifier':</p><ul><li><code>fwaccel cfg -w on</code> = enable support for warnings</li><li><code>fwaccel cfg -w off</code> = disable support for warnings</li></ul></td></tr><tr><td><p><code>fwaccel cfg -b {on | off}</code></p></td><td><p>Configures the SecureXL Drop Templates matching (<a href=\"https://support.checkpoint.com/results/sk/sk66402\" target=\"_blank\" rel=\"noopener\">sk66402</a>):</p><ul><li><code>fwaccel cfg -b on</code> = enable SecureXL Drop Templates matching</li><li><code>fwaccel cfg -b off</code> = disable SecureXL Drop Templates matching</li></ul></td></tr><tr><td><p><code>fwaccel ranges</code></p></td><td><p>Shows the loaded SecureXL ranges.</p></td></tr><tr><td><p><code>fwaccel ranges -h</code></p></td><td><p>Prints the help message with available options for the '<code>ranges</code>' parameter.</p><p>Output:</p><pre>Usage: fwaccel ranges [-l|-a|-p id|-s id]\n\nOptions:\n   -l          - get the list of loaded ranges\n   -a          - print all loaded ranges (the default)\n   -p id       - print the given range\n   -s id       - print summary for the given range\n</pre></td></tr><tr><td><p><code>fwaccel ranges -l</code></p></td><td><p>Shows the list of loaded SecureXL ranges.</p><p><em>Example</em>:</p><pre>[Expert@R80.20:0]# fwaccel ranges -l\nSecureXL device 0:\n        0       Anti spoofing ranges eth0:\n        1       Anti spoofing ranges eth1:\n        2       Anti spoofing ranges eth2:\n        3       Anti spoofing ranges eth3:\n        4       Anti spoofing ranges eth4:\n</pre></td></tr><tr><td><p><code>fwaccel ranges -p &lt;<em>Range_ID</em>&gt;</code></p></td><td><p>Shows the specified loaded SecureXL range.</p><p><em>Example</em>:</p><pre>[Expert@R80.20:0]# fwaccel ranges -p 3\nSecureXL device 0:\n    Anti spoofing ranges eth3:\n        (0) 3.3.3.2 - 3.3.3.254\n</pre></td></tr><tr><td><p><code>fwaccel ranges -s &lt;<em>Range_ID</em>&gt;</code></p></td><td><p>Shows the summary for the specified loaded SecureXL range.</p><p><em>Example</em>:</p><pre>[Expert@R80.20:0]# fwaccel ranges -s 3\nSecureXL device 0:\n    List name \"Anti spoofing ranges eth3:\", ID 3, Number of ranges 1\n</pre></td></tr><tr><td><p><code>fwaccel ranges -a</code></p></td><td><p>Shows all loaded SecureXL ranges.</p><p><em>Example</em>:</p><pre>Anti spoofing ranges eth0:\n(0) 0.0.0.0 - 126.255.255.255\n(1) 128.0.0.0 - 172.29.255.255\n(2) 172.30.0.1 - 172.30.41.239\n(3) 172.30.41.241 - 172.30.255.254\n(4) 172.31.0.0 - 192.168.40.255\n(5) 192.168.42.0 - 223.255.255.255\n(6) 240.0.0.0 - 255.255.255.254\nAnti spoofing ranges eth1:\n(0) 192.168.41.1 - 192.168.41.239\n(1) 192.168.41.241 - 192.168.41.254\nRule base source ranges (ip):\n(0) 0.0.0.0 - 172.30.41.239\n(1) 172.30.41.240 - 172.30.41.240\n(2) 172.30.41.241 - 192.168.41.239\n(3) 192.168.41.240 - 192.168.41.240\n(4) 192.168.41.241 - 255.255.255.255\nRule base destination ranges (ip):\n(0) 0.0.0.0 - 172.30.41.239\n(1) 172.30.41.240 - 172.30.41.240\n(2) 172.30.41.241 - 192.168.41.239\n(3) 192.168.41.240 - 192.168.41.240\n(4) 192.168.41.241 - 255.255.255.255\nRule base dport ranges (port, proto):\n(0) 0, 0 - \n0, 0\n(1) 1, 0 - \n65535, 5\n(2) 0, 6 - \n65535, 6\n(3) 0, 7 - \n65535, 16\n(4) 0, 17 - \n65535, 17\n(5) 0, 18 - \n65535, 88\n(6) 0, 89 - \n65535, 89\n(7) 0, 90 - \n65535, 102\n(8) 0, 103 - \n65535, 103\n(9) 0, 104 - \n65535, 65535\n</pre></td></tr><tr><td><p><code>fwaccel tab -t &lt;<em>table_name</em>&gt;</code></p></td><td><p>Shows the contents of the specified SecureLX 'fwaccel' kernel table.</p></td></tr><tr><td><p><code>fwaccel tab -h</code></p></td><td><p>Shows the help message with available options for the '<code>tab</code>' parameter.</p><pre>Usage: fwaccel [-i &lt;ppak_id&gt;] tab [-f] [-s] [-m &lt;rows&gt;] -t table_name\n\nOptions:\n   -f                  - Formatted output (recommended)                     \n   -i &lt;ppak_id&gt;       - Only print table data for the given SecureXL device\n   -s                  - Print summary only\n   -m &lt;rows&gt;           - Maximum number of rows to print (default=1000)\n   -t &lt;table&gt;          - Table name (required)\n\nNote: Dynamic tables, such as the connections table can change while\nprinting.  This may cause some values to be missed or reported twice.\n\nValid table names are:\n        connections\n        inbound_SAs\n        outbound_SAs\n        vpn_link_selection\n        drop_templates\n        vpn_trusted_ifs\n        profile\n        mcast_drop_conns\n        invalid_replay_counter\n        ipsec_mtu_icmp\n        gtp_tunnels\n        gtp_apns\n        if_by_name\n        PMTU_table\n        frag_table\n        reset_table\n        dos_ip_blacklists\n        dos_pbox\n        dos_rate_matches\n        dos_rate_track_src\n        dos_rate_track_src_svc\n        dos_pbox_violating_ips\n        fg_conn_table\n</pre></td></tr><tr><td><p><code>fwaccel tab</code></p></td><td><p>Shows the contents of the SecureXL <code>\"connections\"</code> kernel table (as the <code>\"fwaccel conns\"</code> command).</p><p><em>Example</em>:</p><pre>[Expert@R80.20:0]# fwaccel tab -t connections\n-------- connections --------\nhtab_bl, id 0, size 983040, attributes: expire, no update, #vals 100 #slinks 100\n</pre><p><code>&lt;0202020a, 0101010a, 80ad0050, 00000006&gt; -&gt; &lt;a3565000, 50003547, 034fa356, 00000302, 02030203, 00000080, 08f50900, 00000111, 00000000, 00000000&gt; (00000000)<br>&lt;0101010a, 0202020a, 005080ad, 00000006; a3565000, 50003547, 034fa356, 00000302, 02030203, 00000080, 08f50900, 00000011, 00000000, 00000000, 00000000; 4/8&gt;<br>&lt;0202020a, 0101010a, 80ba0050, 00000006&gt; -&gt; &lt;a3565000, 50003547, 034fa356, 00000302, 02030203, 00000080, 08f50900, 00000111, 00000000, 00000000&gt; (00000000)<br>&lt;0101010a, 0202020a, 005080ba, 00000006; a3565000, 50003547, 034fa356, 00000302, 02030203, 00000080, 08f50900, 00000011, 00000000, 00000000, 00000000; 4/8&gt;<br>&lt;0202020a, 0101010a, 80930050, 00000006&gt; -&gt; &lt;a3565000, 50003547, 034fa356, 00000302, 02030203, 00000080, 08f50902, 00000111, 00000000, 00000000&gt; (00000000)<br>&lt;0101010a, 0202020a, 00508093, 00000006; a3565000, 50003547, 034fa356, 00000302, 02030203, 00000080, 08f50902, 00000011, 00000000, 00000000, 00000000; 4/8&gt;<br>&lt;0202020a, 0101010a, 80a00050, 00000006&gt; -&gt; &lt;a3565000, 50003547, 034fa356, 00000302, 02030203, 00000080, 08f50902, 00000111, 00000000, 00000000&gt; (00000000)<br>&lt;0101010a, 0202020a, 005080a0, 00000006; a3565000, 50003547, 034fa356, 00000302, 02030203, 00000080, 08f50902, 00000011, 00000000, 00000000, 00000000; 4/8&gt;<br>&lt;0202020a, 0101010a, 80860050, 00000006&gt; -&gt; &lt;a3565000, 50003547, 034fa356, 00000302, 02030203, 00000080, 08f50902, 00000111, 00000000, 00000000&gt; (00000000)<br>&lt;0101010a, 0202020a, 00508086, 00000006; a3565000, 50003547, 034fa356, 00000302, 02030203, 00000080, 08f50902, 00000011, 00000000, 00000000, 00000000; 4/8&gt;<br>&lt;0202020a, 0101010a, 806c0050, 00000006&gt; -&gt; &lt;a3565000, 50003547, 034fa356, 00000302, 02030203, 00000080, 08f50902, 00000111, 00000000, 00000000&gt; (00000000)<br>&lt;0101010a, 0202020a, 0050806c, 00000006; a3565000, 50003547, 034fa356, 00000302, 02030203, 00000080, 08f50902, 00000011, 00000000, 00000000, 00000000; 4/8&gt;</code></p></td></tr><tr><td><p><code>fwaccel tab -t &lt;<em>table_name</em>&gt; -s</code></p></td><td><p>Shows the summary of the specified SecureXL 'fwaccel' kernel table.</p></td></tr><tr><td><p><code>fwaccel feature</code></p></td><td><p>Controls the SecureXL 'fwaccel' module features.</p></td></tr><tr><td><p><code>fwaccel feature -h</code></p></td><td><p>Shows the help message with available options for the '<code>feature</code>' parameter.</p><p><em>Output</em>:</p><pre>Usage: fwaccel feature &lt;feature&gt; {on | off | get}\n\nAvailable features: sctp \n</pre></td></tr><tr><td><p><code>fwaccel feature &lt;<em>feature_name</em>&gt; {on | off}</code></p></td><td><p>Enables/Disables the specified SecureXL 'fwaccel' module feature (run the '<code>fwaccel stat</code>' command and refer to the <code>\"Accelerator Features\"</code> section).</p><p>Available features (list depends on the Security Gateway version):</p><ul><li><code>sctp</code> (R76 and higher - see <a href=\"https://support.checkpoint.com/results/sk/sk114957\" target=\"_blank\" rel=\"noopener\">sk114957</a>)</li></ul></td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:16.434Z","annotations":[],"updated":"2025-05-06T23:04:11.598Z"},{"title":"Troubleshoot traffic drops by PSL on Security Gateway","id":"622a633e-8153-4037-b017-e40b8059f1b2","type":"TEXT","raw":"---\ncreated: 2025-04-29T18:43:53 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk172266\nauthor: \n---\n\n# sk172266 - How to troubleshoot traffic drops by PSL on Security Gateway\n\n> ## Excerpt\n> Applies to: ClusterXL, ElasticXL, Quantum Maestro, Quantum Scalable Chassis, Quantum Security Gateways, VSNext, VSX (Traditional)\n\n---\nIf you see in the traffic logs from a Security Gateway that the Passive Streaming Library (PSL) dropped packets, it is usually for a good reason.\n\nTo understand why PSL dropped these packets and if it was for a good reason, do these verifications:\n\n|                                                                                                                                                                                                                  Symptoms                                                                                                                                                                                                                   |                                                            Apparent Cause                                                            |                                                                                                                                                                                                                                                                                                                     How to Verify the Cause                                                                                                                                                                                                                                                                                                                      |                                                                    Conclusion                                                                    |\n|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|\n| Drop log in SmartConsole:\n\n`Invalid checksum. Packet dropped. Please refer to sk172266.` |                    The Streaming Engine protection \"TCP Invalid Retransmission\" detected an invalid TCP checksum.                    | 1.  Capture the traffic at inbound.\n2.  Open the traffic capture in Wireshark.\n3.  Check if the traffic arriving at the Security Gateway is already corrupted. | -   Bad checksum found:  \n    PSL correctly dropped the packet.\n-   Bad checksum not found:  \n    Contact Check Point Support. |\n| Drop log in SmartConsole:\n\n`Invalid segment retransmission. Packet dropped. Please refer to sk172266.` |                  The Streaming Engine protection \"TCP Invalid Retransmission\" detected an incorrect retransmission.                  | 1.  Capture the traffic at inbound.\n2.  Open the traffic capture in Wireshark.\n3.  Verify if the traffic that arrives at the Security Gateway has incorrect retransmission. | -   Incorrect retransmission found:  \n    PSL correctly dropped the packet.\n-   Old retransmission not found:  \n    Contact Check Point Support. |\n| Drop log in SmartConsole:\n\n`Out of sequence TCP packet retransmission. Stripping all packet data. Please refer to sk172266.` | The Streaming Engine protection \"TCP Invalid Retransmission\" detected an old retransmission - the retransmission is out of sequence. | 1.  Capture the traffic at inbound.\n2.  Open the traffic capture in Wireshark.\n3.  Check if the sequence was old. | -   Old retransmission found:  \n    PSL correctly stripped the packet.\n-   Old retransmission not found:  \n    Contact Check Point Support. |\n| Debug message in `dmesg` or `$FWDIR/log/fwk.elg` file:\n\n`fwpslglue_newconn: trying to initialize connection out of state...` |                          Incomplete handshake - There was attempt to initialize the connection out-of-state                          | 1.  Capture the traffic at inbound.\n2.  Open the traffic capture in Wireshark.\n3.  Check if the TCP 3-way handshake completed successfully. | -   Incomplete handshake found:  \n    PSL correctly dropped the packet.\n-   Incomplete handshake not found:  \n    Contact Check Point Support. |\n| -   Drop log in SmartConsole:\n    \n    `TCP off-path sequence inference. Dropping packet with future Ack number. Please refer to sk172266.`\n    \n-   Drop log in SmartConsole:\n    \n    `TCP segment out of maximum allowed sequence. Packet dropped. Please refer to sk172266.`\n    \n-   Kernel debug \"`fw ctl debug -m PSL + seq`\" shows:\n    \n    `psl_check_window: received a future packet which is outside the maximum allowed dynamic window` |                        Out of window packet - a future packet which is outside of the maximum dynamic window.                        | 1.  Start the traffic capture at inbound.  \n    You must capture the complete connection, including the TCP handshake at the beginning of the connection.\n2.  Start this kernel debug: `fw ctl debug -m PSL + seq`\n3.  Replicate the issue.\n4.  Stop the kernel debug.\n5.  Stop the traffic capture.\n6.  Based on the kernel debug output, calculate the maximum dynamic window size (`max_seq - last_ack_seq`).\n7.  See in Wireshark what is the calculated window size.  \n    To see the window size:\n    1.  Find the relevant packet.\n    2.  Search for the calculated window size In the TCP section of the packet.\n8.  Make sure that it is outside the window. | -   Out of window packet found:  \n    PSL correctly dropped the packet.\n-   Out of window packet not found:  \n    Contact Check Point Support. |\n| -   Drop log in SmartConsole:\n    \n    `TCP off-path sequence inference. Dropping packet with old sequence number. Please refer to sk172266.`\n    \n-   Drop log in SmartConsole:\n    \n    `TCP off-path sequence inference. Dropping packet with old Ack number. Please refer to sk172266.` |                                     Old retransmission - the retransmission is out of sequence.                                      |                                                                                                                                                                                                                                                                                                                   Contact Check Point Support                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                  |\n| -   Drop log in SmartConsole:\n    \n    `TCP stream has reached its maximum allowed segments. Packet dropped. Please refer to sk172266.`\n    \n-   Kernel debug \"`fw ctl debug -m PSL + tcpstr`\" shows one of these:\n    \n    `psl_streaming_handle_packet: reached max future segments`\n    \n    `psl_streaming_handle_packet: connection maximum segments reached` |                       Too many packets - Exceeding the maximum future packets or the maximum allowed segments.                       | 1.  Capture the traffic at inbound.\n2.  Open the traffic capture in Wireshark.\n3.  Check if there are a lot of un-ACKed packets (the default maximum is 16386) or future packets (the default maximum is 4096). | -   Too many packets found:  \n    PSL correctly dropped the packet.\n-   Too many packets not found:  \n    Contact Check Point Support. |\n","language":"md","time":"14 days ago","created":"2025-05-06T22:56:18.903Z","annotations":[],"updated":"2025-05-06T22:59:50.724Z"},{"title":"ProductQuantum Maestro Version Hardware","id":"1077e0c8-5ea1-4e4c-9bc1-8518953618cf","type":"TEXT","raw":"ProductQuantum Maestro\n\nVersionHardware\n\nOSGaia\n\nPlatform15000, 16000, 19000, 23000, 26000, 28000, 29000, 5000, 6000, 7000, 9000, MLS LightSpeed, QLS LightSpeed\n\nLast Modified2025-04-25\n\n## Solution\n\n### Certified Combinations of Security Appliance Models in the Same Security Group\n\nFrom **R81.10**, Maestro supports different Security Appliance models in the same Security Group. This feature is called \"mix and match\" and provides a solution for Maestro customers who use discontinued Security Appliance (End of Sale) models. These customers can add newer supported Security Appliance models to the Security Group with the discontinued Security Appliance models.\n\n**For a list of supported Security Appliance Models for the Maestro solution, see [sk181433: Supported Security Appliance Models and Line Cards for the Quantum Maestro Solution](https://support.checkpoint.com/results/sk/sk181433).**\n\nOnly specific Security Appliance models are compatible in the same Security Group under production traffic. The supported combinations are based on some hardware specifications, such as the number of CPU cores, HyperThreading, and more.\n\n**Important Note for R81.10** **and higher** - You must disable SMO Image Cloning in the Security Group **before** you assign a Security Appliance model different from the Security Appliance models assigned to this Security Group (Known Limitation PMTR-71298).\n\nSee the [Quantum Maestro Administration Guide](https://support.checkpoint.com/product/520#f[commonsource]=C.%20Documentation) (R81.10 and higher) - Chapter _Configuring Security Groups_ > Section _Special Configuration Scenarios_ > Section _Configuring Weights for Security Group Members_.\n\nThe tables below show the supported combinations.\n\n**Quantum Maestro supports all other combinations for migration purposes**. For example, suppose you would like to replace a 6500 Security Appliance model with a 16200 Security Appliance model: In this scenario, you can include the two Security Appliance models in the same Security Group, allow it to clone the configuration to the 16200 Security Appliance model, remove the 6500 Security Appliance model, and continue to work with the 16200 Security Appliance model only. This migration procedure should include CXL / SND cores configuration and adjustment on new Security Appliances models, which requires downtime because of the reboot. As a result, you must do the migration during a maintenance window.\n\n<table><tbody><tr><td colspan=\"2\"><strong>Table Legend:</strong></td></tr><tr><td>Yes</td><td>Supported</td></tr><tr><td>[Empty Cell]</td><td>Not supported</td></tr></tbody></table>\n\n**Important Notes:**\n\n-   To connect to Quantum Maestro Orchestrators, you must use the same Line Card ports on all appliances in the same Security Group (on each Site).\n-   **In R81.20 and higher**, it is **not** supported to configure Auto-Scaling Settings if a Maestro Security Group contains different appliance models.\n\nClick Here to Collapse all\n\n-   Quantum Force 19000 / 29000 with other models  \n    \n    > Refer to [sk180520](https://support.checkpoint.com/results/sk/sk180520).\n    > \n    > **Important Note** - You must use the same Quantum Force appliance models in the same Maestro Security Group.\n    > \n    > <table><tbody><tr><td>&nbsp;</td><td>19100</td><td>19200</td><td>29100</td><td>29200</td></tr><tr><td><strong>16200</strong></td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>16600HS</strong></td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>19100</strong></td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>19200</strong></td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>28000</strong></td><td>&nbsp;</td><td>Yes <img src=\"https://sc1.checkpoint.com/sc/images/sk_images/yellow_warning.png\"><br><strong>(from R81.20 Jumbo</strong><br><strong>Hotfix Take 65)</strong></td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>28600HS</strong></td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>29100</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>29200</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td></tr></tbody></table>\n    \n-   Quantum Force 9000 with other models  \n    \n    > Refer to [sk181698](https://support.checkpoint.com/results/sk/sk181698).\n    > \n    > **Important Note** - You must use the same Quantum Force appliance models in the same Maestro Security Group.\n    > \n    > <table><tbody><tr><td>&nbsp;</td><td>9100</td><td>9200</td><td>9300</td><td>9400</td><td>9700</td><td>9800</td></tr><tr><td><strong>6200</strong></td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>6400</strong></td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>6600</strong></td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>6700</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>6900</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>7000</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td></tr><tr><td><strong>9100</strong></td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>9200</strong></td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>9300</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>9400</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>9700</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>9800</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td></tr><tr><td><strong>16600HS</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td></tr></tbody></table>\n    \n-   LightSpeed QLS and MLS series with other models  \n    \n    > Refer to [sk176466](https://support.checkpoint.com/results/sk/sk176466).\n    > \n    > **Important Note** - You must use the same LightSpeed appliance models in the same Maestro Security Group.\n    > \n    > <table><tbody><tr><td>&nbsp;</td><td>QLS250</td><td>QLS450</td><td>QLS650</td><td>QLS800</td><td>MLS200</td><td>MLS400</td></tr><tr><td><strong>QLS250</strong></td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>QLS450</strong></td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>QLS650</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>QLS800</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>MLS200</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>MLS400</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td></tr><tr><td><strong>QLS850</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table>\n    \n-   28000 series with other models  \n    \n    > Refer to [sk152733](https://support.checkpoint.com/results/sk/sk152733).\n    > \n    > **Important Note** - The default partitioning for 28600HS does **not** support core dump files. Refer to [sk175625](https://support.checkpoint.com/results/sk/sk175625).\n    > \n    > <table><tbody><tr><td>&nbsp;</td><td>28000</td><td>28600HS</td></tr><tr><td><strong>16200</strong></td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>16600HS</strong></td><td>&nbsp;</td><td>Yes</td></tr><tr><td><strong>19200</strong></td><td>Yes <img src=\"https://sc1.checkpoint.com/sc/images/sk_images/yellow_warning.png\"><br><strong>(from R81.20 Jumbo</strong><br><strong>Hotfix Take 65)</strong></td><td>Yes</td></tr><tr><td><strong>23900</strong></td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>26000</strong></td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>28000</strong></td><td>Yes</td><td>Yes<br>(<strong>from R81.20</strong>)</td></tr><tr><td><strong>28600HS</strong></td><td>Yes<br>(<strong>from R81.20</strong>)</td><td>Yes</td></tr></tbody></table>\n    \n-   26000 series with other models  \n    \n    > Refer to [sk152733](https://support.checkpoint.com/results/sk/sk152733).\n    > \n    > <table><tbody><tr><td>&nbsp;</td><td>26000</td></tr></tbody><tbody><tr><td><strong>23800</strong></td><td>Yes</td></tr><tr><td><strong>23900</strong></td><td>Yes</td></tr><tr><td><strong>28000</strong></td><td>Yes</td></tr><tr><td><strong>28600HS</strong></td><td>&nbsp;</td></tr></tbody></table>\n    \n-   23000 series with other models  \n    \n    > Refer to [sk107516](https://support.checkpoint.com/results/sk/sk107516).\n    > \n    > <table><tbody><tr><td>&nbsp;</td><td>23500</td><td>23800</td><td>23900</td></tr></tbody><tbody><tr><td><strong>16200</strong></td><td>Yes</td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>16600HS</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>26000</strong></td><td>&nbsp;</td><td>Yes</td><td>Yes</td></tr><tr><td><strong>28000</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td></tr><tr><td><strong>28600HS</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table>\n    \n-   16000 series with other models  \n    \n    > Refer to [sk152733](https://support.checkpoint.com/results/sk/sk152733).\n    > \n    > <table><tbody><tr><td>&nbsp;</td><td>16200</td><td>16600HS</td></tr><tr><td><strong>9800</strong></td><td>&nbsp;</td><td>Yes</td></tr><tr><td><strong>15600</strong></td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>16200</strong></td><td>Yes</td><td>Yes<br>(<strong>from R81.20</strong>)</td></tr><tr><td><strong>16600HS</strong></td><td>Yes<br>(<strong>from R81.20</strong>)</td><td>Yes</td></tr><tr><td><strong>19100</strong></td><td>Yes</td><td>Yes</td></tr><tr><td><strong>23500</strong></td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>23800</strong></td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>28000</strong></td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>28600HS</strong></td><td>&nbsp;</td><td>Yes</td></tr></tbody></table>\n    \n-   15000 series with other models  \n    \n    > Refer to [sk107516](https://support.checkpoint.com/results/sk/sk107516).\n    > \n    > <table><tbody><tr><td>&nbsp;</td><td>15400</td><td>15600</td></tr></tbody><tbody><tr><td><strong>6700</strong></td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>6900</strong></td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>7000</strong></td><td>&nbsp;</td><td>Yes</td></tr><tr><td><strong>16200</strong></td><td>&nbsp;</td><td>Yes</td></tr><tr><td><strong>16600HS</strong></td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table>\n    \n-   7000 series with other models  \n    \n    > Refer to [sk139932](https://support.checkpoint.com/results/sk/sk139932).\n    > \n    > <table><tbody><tr><td>&nbsp;</td><td>7000</td></tr><tr><td><strong>5900</strong></td><td>Yes</td></tr><tr><td><strong>6800</strong></td><td>Yes</td></tr><tr><td><strong>6900</strong></td><td>Yes</td></tr><tr><td><strong>7000</strong></td><td>Yes</td></tr><tr><td><strong>9800</strong></td><td>Yes</td></tr><tr><td><strong>15600</strong></td><td>Yes</td></tr></tbody></table>\n    \n-   6000 series with other models  \n    \n    > Refer to [sk139932](https://support.checkpoint.com/results/sk/sk139932).\n    > \n    > <table><tbody><tr><td>&nbsp;</td><td>6200</td><td>6400</td><td>6500</td><td>6600</td><td>6700</td><td>6800</td><td>6900</td><td>9100</td><td>9200</td><td>9300</td><td>9400</td><td>9700</td></tr><tr><td><strong>6200</strong></td><td>Yes</td><td>Yes</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>6400</strong></td><td>Yes</td><td>Yes</td><td>&nbsp;</td><td>Yes<br><strong>(from R81.20)</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>6500</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>6600</strong></td><td>Yes</td><td>Yes<br><strong>(from R81.20)</strong></td><td>Yes</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>6700</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>Yes</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td></tr><tr><td><strong>6800</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>6900</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td></tr><tr><td><strong>7000</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table>\n    \n-   5000 series with other models  \n    \n    > Refer to [sk110053](https://support.checkpoint.com/results/sk/sk110053).\n    > \n    > <table><tbody><tr><td>&nbsp;</td><td>5600</td><td>5800</td><td>5900</td></tr></tbody><tbody><tr><td><strong>6200</strong></td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>6400</strong></td><td>Yes</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><strong>6500</strong></td><td>&nbsp;</td><td>Yes</td><td>Yes</td></tr><tr><td><strong>6600</strong></td><td>&nbsp;</td><td>Yes</td><td>Yes</td></tr><tr><td><strong>6700</strong></td><td>&nbsp;</td><td>Yes</td><td>Yes</td></tr><tr><td><strong>6900</strong></td><td>&nbsp;</td><td>&nbsp;</td><td>Yes</td></tr></tbody></table>\n    \n\n### Related Solutions\n\n-   [sk148074 - Known Limitations for Scalable Platforms (Maestro Appliances and Chassis)](https://support.checkpoint.com/results/sk/sk148074)\n-   [sk181433 - Supported Security Appliance Models for Use with the Quantum Maestro Solution](https://support.checkpoint.com/results/sk/sk181433)\n-   [sk177624 - Check Point R81.20 for Scalable Platforms](https://support.checkpoint.com/results/sk/sk177624)\n-   [sk173363 - Check Point R81.10 for Scalable Platforms](https://support.checkpoint.com/results/sk/sk173363)\n-   [sk169954 - Check Point R81 for Scalable Platforms](https://support.checkpoint.com/results/sk/sk169954)\n-   [sk162552 - Check Point Maestro R80.30SP](https://support.checkpoint.com/results/sk/sk162552)\n-   [sk138233 - Check Point Maestro R80.20SP](https://support.checkpoint.com/results/sk/sk138233)\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorIlia Anokhin\n\nTechnical ResourceAnatoly Masover\n\nAccess LevelGeneral\n\nStatusApproved by TAC\n\nDate Created2019-09-11\n\nLast Modified2025-04-25\n\nEditorLiron Rubin\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only\n\n**SK SHOULD NOT BE DELETED - referenced in source code and in Maestro documentation**\n\n**For all models that are not listed in the tables above, an [RFE submission](https://www.checkpoint.com/rfe/login.htm) is required!**\n\n16600HS appliance is previously known as 16000THS appliance.\n\nRFE tickets for appliance models:\n\n<table><tbody><tr><td>Model</td><td>RFE</td></tr><tr><td>5600</td><td>FKE-119-30913</td></tr><tr><td>5800</td><td>UGD-899-71524</td></tr><tr><td>6200/6600/6900 Base/Plus</td><td>R80.30SP GA Replacement</td></tr><tr><td>13500</td><td>PRO-536-17945</td></tr><tr><td>13800</td><td>NCW-902-98258</td></tr><tr><td>15400</td><td>EXE-776-70806</td></tr><tr><td>15600</td><td>ZLJ-372-60835</td></tr><tr><td>23500</td><td>CHZ-869-91487</td></tr><tr><td>23900</td><td>VZD-465-92613</td></tr></tbody></table>\n\nAccording to Benny Shlesinger (former Head of Products), **6500/6800 bundles** are indeed shipped with dual-port 10G cards.\n\nFrom: Benny Shlesinger <bennyshl@checkpoint.com>  \nSent: Thursday, September 12, 2019 2:38 PM  \nTo: Ilia Anokhin <ianokhin@checkpoint.com>; Yaron Weiler <yaronw@checkpoint.com>  \nCc: Anatoly Masover <Anatoly@checkpoint.com>  \nSubject: RE: Maestro bundles 6500/6800\n\n-   We ship 6x00 turbo Maestro bundles with dual port 10G NICs\n-   We do not offer the dual port 10G NICs in catalog since the 2012 line of appliance is end-of-sale\n-   They do not appear in the accessory guide as these are not accessories we sell as a standalone accessory","language":"md","time":"14 days ago","created":"2025-05-06T22:56:16.599Z","annotations":[],"updated":"2025-05-06T23:04:17.364Z"},{"title":"Check Point Top Connections Tool for CoreXL and VSX","id":"b8e81d77-ffc3-44e9-824e-9bb2f41e3300","type":"TEXT","raw":"ProductQuantum Security Gateways, VSX (Traditional)\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nOSGaia\n\nLast Modified2024-03-13\n\n#### For internal users only\n\n## Solution\n\n> **Table of Contents:**\n> \n> -   Introduction\n>     \n> -   Environment\n>     \n> -   View\n>     \n> -   Syntax\n>     \n> \n> ## Introduction\n> \n> Top connections consume the most CPU time for each CoreXL Firewall instance.\n> \n> The **Top Connections** Tool unites all top connections from all CoreXL Firewall instances into one view. With the Top Connections Tool, you filter the information by applicable CPU Core / CoreXL Firewall Instance / CPU Load, or export the information to an output file.\n> \n> ## Environment\n> \n> The Top Connections Tool is integrated starting from:  \n> \n> -   [Check Point R81.10](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk170416)\n> -   [R81 Jumbo Hotfix Accumulator](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk170114) - Take 34\n> -   [R80.40 Jumbo Hotfix Accumulator](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk165456) - Take 119\n> \n> ## View\n> \n> The Top Connections Tool prints the information on the screen.\n> \n> Example:\n> \n> ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk172229/top_conns202103251315181.png)\n> \n> Where:\n> \n> <table><tbody><tr><td>Column</td><td>Description</td></tr><tr><td><code>conn</code></td><td>4-tuple of the connection - Source IP Address, Source Port, Destination IP Address, and Destination Port.</td></tr><tr><td><code>service</code></td><td>Service type - according to the destination port.</td></tr><tr><td><code>cpu util</code></td><td>CPU utilization in % - how much of CPU time the connection consumes.</td></tr><tr><td><code>fw</code></td><td>ID of the CoreXL Firewall instance that inspects the connection.</td></tr><tr><td><code>CPU</code></td><td>CPU core on which the CoreXL Firewall instance works.</td></tr></tbody></table>\n> \n> ##   \n> Syntax\n> \n> `top_conns [-c {<Number of CPU Core 1>,<Number of CPU Core 2>,...}] [-i {<Number of CoreXL Instance 1>,<Number of CoreXL Instance 2>,...}] [-t <CPU Load 0-100>] [-o /<Path>/<Name of Output File>]`\n> \n> Where:\n> \n> <table><tbody><tr><td>Parameter</td><td>Description</td></tr><tr><td>No parameters</td><td><p>Default mode.</p><p>The output shows all top connections from all CPU cores and all CoreXL Firewall instances.</p></td></tr><tr><td><code>-c {&lt;Number of CPU Core 1&gt;,&lt;Number of CPU Core&nbsp;2&gt;,...}</code></td><td><p>Specifies the CPU cores, from which to show the top connections.</p><p><strong>Note </strong>- This parameter does not apply to VSX mode.</p><p>To see the CPU cores and CoreXL Firewall instances, run:<br><code>fw ctl multik stat</code></p><p>Example:<br><code>top_conns -c 1,3</code></p></td></tr><tr><td><code>-i {&lt;Number of&nbsp;CoreXL&nbsp;Instance 1&gt;,&lt;Number of&nbsp;CoreXL&nbsp;Instance 2&gt;,...}</code></td><td><p>Specifies the CoreXL Firewall instances, from which to show the top connections.</p><p><strong>Note </strong>- This parameter does not apply to VSX mode.</p><p>To see the CoreXL Firewall instances and CPU cores, run:<br><code>fw ctl multik stat</code></p><p>Example:<br><code>top_conns -i 1,3</code></p></td></tr><tr><td><code>-t &lt;CPU Load 0-100&gt;</code></td><td><p>Specifies the CPU utilization threshold. The command shows only the top connections that consume the CPU cores above this threshold.</p><p>Example:<br><code>top_conns -t 20</code></p></td></tr><tr><td><code>-o /&lt;Path&gt;/&lt;Name of Output File&gt;</code></td><td><p>Specifies the path and the name of the output file, to which the command saves its output.</p><p>Example:<br><code>top_conns -o /var/log/top_connections.txt</code></p></td></tr></tbody></table>\n> \n> To refresh the output in real time, use the Linux [watch](https://linux.die.net/man/1/watch) command:  \n> `watch <options> top_conns <parameters>`\n> \n> Example:  \n> `watch -d -n 2 top_conns <parameters>`\n> \n> ## VSX Mode\n> \n> You can run the command on VSX Gateways, but two columns (for CPU and CoreXL instances) are truncated. Refer to the table above for parameters that do not apply to VSX mode.\n> \n> The `top_conns` command is a VSX context-specific command. You must first navigate to the applicable VS instance to see connections for that VSX context.\n> \n> Example:  \n> \\# vsenv  \n> ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk172229/tcp_conns-VSX0202301041714581.png)  \n> \\# vsenv 1  \n> ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk172229/tcp_conns-VSX202301041715202.png)\n> \n> ## Related Solutions\n> \n> -   [sk167553 - Performance Investigation Procedure - How To](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk167553)\n> -   [sk167903 - CPview Top Connections and Protocols tabs show no data](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk167903)\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorRubi Mizrachi\n\nTechnical ResourceAmit Shmuel\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2021-02-24\n\nLast Modified2024-03-13\n\nEditorRubi Mizrachi\n\nLast ApproverLiron Rubin\n\n## Comments\n\n#### Internal only\n\n**  \nThis issue will be fixed in upcoming Jumbos (PMTR-73504).  \n**","language":"md","time":"14 days ago","created":"2025-05-06T22:56:19.156Z","annotations":[],"updated":"2025-05-06T23:05:07.084Z"},{"title":"IPv6 Features and limitations for IPv6 in R81.20, R81","id":"adaa0c76-e18e-43c7-8b00-723904675710","type":"TEXT","raw":"---\ncreated: 2025-04-29T19:04:32 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk163313\nauthor: \n---\n\n# sk163313 - IPv6 features and limitations\n\n> ## Excerpt\n> Applies to: ClusterXL, Quantum Security Gateways, Quantum Security Management, VSX (Traditional)\n\n---\nThis article summarizes the supported features and the limitations for IPv6 in R81.20, R81.10, R81, R80.40 and earlier releases.\n\n|                                  Software Blade / Feature                                  |                                                                                                                    Notes                                                                                                                     |                                         Supported From                                          |\n|--------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------|\n|                                       Anti-Bot Blade                                       |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                      Anti-Virus Blade                                      |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                 Application Control Blade                                  |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                       Firewall Blade                                       |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                  Identity Awareness Blade                                  |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                               IPS Blade (not Geo Protection)                               |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                             IPsec VPN Blade - Site to Site VPN                             |                                                                                                              Gateway mode only                                                                                                               |                                             R80.30                                              |\n|                             IPsec VPN Blade - Site to Site VPN                             |                                                                                                                VSX mode only                                                                                                                 |                                               R81                                               |\n|                                       Logging Blade                                        |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                    Mobile Access Blade                                     | Supports IPv6 connection only from end-user computers to the Mobile Access Portal and Mobile Enterprise on a Mobile Access Gateway / Mobile Access Cluster  \nConnection from the Mobile Access Gateway to backend servers supports only IPv4 |                                             R80.30                                              |\n|                                   Threat Emulation Blade                                   |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                  Threat Extraction Blade                                   |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                         Threat Extraction for web-downloaded files                         |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.40                                              |\n|                                    URL Filtering Blade                                     |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                    QoS Filtering Blade                                     |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.10                                              |\n|                                          SecureXL                                          |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                           CoreXL                                           |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                               Multi-Domain Management Server                               | A Domain can manage a Security Gateway over pure IPv6.    \nNote: The Domain must have also an IPv4 address for internal Multi-Domain communication. |                                               R82                                               |\n|                                        Multi-Queue                                         |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                  Quantum Spark Appliances                                  |                                                                                                    Locally Managed and Centrally Managed                                                                                                     |                                            R80.20.00                                            |\n|                   Identity Agent v2 for Windows Terminal Server (MUH v2)                   |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R81.10                                              |\n|                              ClusterXL High Availability mode                              |                                                                                                              Gateway mode only                                                                                                               |                                             R80.30                                              |\n|                 ClusterXL - synchronization of all IPv6 status information                 |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                              Cluster - Full High Availability                              | Supported only with the Dual Stack (IPv4 and IPv6):\n\n-   Monitored Interfaces must have IPv4 addresses assigned\n-   Sync interfaces must have IPv4 addresses assigned |                                             R80.30                                              |\n|      Network Objects with both IPv4 and IPv6 addresses configured in the same object       |                                                                                                      Management Server and SmartConsole                                                                                                      |                                             R80.30                                              |\n|                         Gaia Netflow reporting of IPv6 connections                         |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                         Connection from Capsule Connect app on iOS                         |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                        SmartConsole                                        |                                                                   The operating system, on which SmartConsole is installed must be configured to work correctly with IPv6                                                                    |                                             R80.30                                              |\n|                       IPv6 and IPv4 objects in Access Control Policy                       |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                           Rate Limiting rules for DoS Mitigation                           |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                Dynamically updated defenses                                |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|        IPv6 address for LOM Card (iDRAC) on Smart-1 525, 625, 5050, 5150 appliances        |                                                                                                                                                                                                                                              | R80.40  \nR80.30 Jumbo Hotfix Accumulator Take 210  \nR80.20 Jumbo Hotfix Accumulator Take 160 |\n|                FTP Active and FTP Passive services in Access Control Policy                |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n| TCP and UDP services in Access Control Policy (for example, HTTP, SMTP, Telnet, and so on) |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                           DNSv6                                            |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                          Access Control Policy - 'ICMPv6' service                          |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                       Access Control Policy - 'Traceroute6' service                        |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                       Access Control Policy - IPv6 'Other' services                        |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                'fw6' commands for interacting with the IPv6 Firewall kernel                |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                       IPv6 fragments                                       |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                   IPv6 extension headers                                   |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                    IPv6-in-IPv4 tunnels                                    |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                           NAT66                                            |                                                                                                              Gateway mode only                                                                                                               |                                             R80.30                                              |\n|                                 NAT46 (Gaia kernel 2.6.18)                                 |                                                                                                          Gateway mode and VSX mode                                                                                                           | Gateway mode and VSX mode - R81.10\n\nGateway mode only - R80.30 |\n|                                 NAT64 (Gaia kernel 2.6.18)                                 |                                                                                                          Gateway mode and VSX mode                                                                                                           | Gateway mode only - R80.30\n\nGateway mode and VSX mode - R81.10 |\n|                                  NAT46 (Gaia kernel 3.10)                                  | Gateway mode and VSX mode  \nException: HTTPS Inspection is enabled | Gateway mode only - R80.40 Jumbo Hotfix Accumulator Take 83\n\nGateway mode and VSX mode - R81.10 |\n|                                  NAT64 (Gaia kernel 3.10)                                  | Gateway mode and VSX mode  \nException: HTTPS Inspection is enabled | Gateway mode only - R80.40 Jumbo Hotfix Accumulator Take 83\n\nGateway mode and VSX mode - R81.10 |\n|                                      HTTPS Inspection                                      | Gateway mode and VSX mode  \nFor specific limitations, see sk90840 |                                             R80.20                                              |\n|                                       SSL Inspection                                       |                                                                                                              Gateway mode only                                                                                                               |                                             R80.30                                              |\n|                               Inspection of HTTP/2 protocol                                |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.40                                              |\n|                     Security Gateways with a Dynamic IP Address (DAIP)                     |                                                                                                              Gateway mode only                                                                                                               |                                             R80.30                                              |\n|                                      Dynamic Objects                                       |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                   Groups with Exclusions                                   |                                                                                                      Management Server and SmartConsole                                                                                                      |                                             R80.30                                              |\n|         Dynamic Routing - BGP for IPv6, including IPv6 MD5 authentication for BGP          |                                                                                          Security Gateway mode, VSX mode, and Cluster configuration                                                                                          |                                             R80.30                                              |\n|                                   Dynamic Routing - BFD                                    |                                                                                          Security Gateway mode, VSX mode, and Cluster configuration                                                                                          |                                             R80.30                                              |\n|                             Dynamic Routing - Graceful Restart                             |                                                                                          Security Gateway mode, VSX mode, and Cluster configuration                                                                                          |                                             R80.30                                              |\n|                                  Dynamic Routing - VRRPv3                                  |                                                                                          Security Gateway mode, VSX mode, and Cluster configuration                                                                                          |                                             R80.30                                              |\n|                                  Dynamic Routing - OSPFv3                                  |                                                                                          Security Gateway mode, VSX mode, and Cluster configuration                                                                                          |                                             R80.30                                              |\n|                        Dynamic Routing - OSPFv3 Multiple Instances                         |                                                                                          Security Gateway mode, VSX mode, and Cluster configuration                                                                                          |                                             R80.30                                              |\n|                                  Dynamic Routing - RIPng                                   |                                                                                          Security Gateway mode, VSX mode, and Cluster configuration                                                                                          |                                             R80.30                                              |\n|                               Dynamic Routing - DHCPv6 Relay                               |                                                                                          Security Gateway mode, VSX mode, and Cluster configuration                                                                                          |                                             R80.30                                              |\n|                         Dynamic Routing - Inbound Route Filtering                          |                                                                                          Security Gateway mode, VSX mode, and Cluster configuration                                                                                          |                                             R80.30                                              |\n|                           Dynamic Routing - Route Redistribution                           |                                                                                          Security Gateway mode, VSX mode, and Cluster configuration                                                                                          |                                             R80.30                                              |\n|                                       DHCPv6 server                                        |                                                                                          Security Gateway mode, VSX mode, and Cluster configuration                                                                                          |                                               R82                                               |\n|                                       DHCPv6 client                                        |                                                                                               Security Gateway mode and Cluster configuration                                                                                                |                                               R82                                               |\n|                            DHCPv6 client for prefix-delegation                             |                                                                                               Security Gateway mode and Cluster configuration                                                                                                |                                               R82                                               |\n|                                 IPv6 PIM (SM and SSM only)                                 |                                                                                               Security Gateway mode and Cluster configuration                                                                                                |                                               R82                                               |\n|                        Multicast Listener Discovery (MLD) V1 and V2                        |                                                                                          Security Gateway mode, VSX mode, and Cluster configuration                                                                                          |                                               R82                                               |\n|                                     IPv6 Anti-Spoofing                                     |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                         IPS protection 'SYN Attack' (SynDefender)                          |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                     IPS protection 'Non-compliant DNS for UDP traffic'                     |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                  IPS protection 'DNS Domains Block List for UDP traffic'                   |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                         IPS protection 'ICMPv6 Maximum Ping Size'                          |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                    IPS protection 'ICMPv6 Small PMTU Bandwidth Attack'                     |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                    IPv6 STP Bridge Mode                                    |                                                                                                          Gateway mode and VSX mode                                                                                                           |                                             R80.30                                              |\n|                                    VSX Virtual Systems                                     |                                                                                                                VSX mode only                                                                                                                 |                                             R80.30                                              |\n|                                    VSX Virtual Routers                                     |                                                                                                                VSX mode only                                                                                                                 |                                               R81                                               |\n|                 VSX VSLS on Scalable Chassis 64000 / 61000 / 44000 / 41000                 |                                                                                                                VSX mode only                                                                                                                 |                                            R80.20SP                                             |\n|                             IPv6 addresses for RADIUS servers                              |                                                                                                                                                                                                                                              |                                             R80.30                                              |\n|                            VPN tunnel per host/subnet/universal                            |                                                                                                                                                                                                                                              |                                             R80.30>                                             |\n|                      Simplified VRRP configuration and Autodetection                       |                                                                                                                                                                                                                                              |                                             R80.20                                              |\n|                       Suspicious Activity Monitoring Protocol (SAMP)                       |                                                                                                                                                                                                                                              |                                             R80.30                                              |\n|    Secure Internal Communication (SIC) between a Management Server and Security Gateway    |                                                                                                                                                                                                                                              |                                             R81.20                                              |\n\n|                                                Software Blade / Feature                                                |\n|------------------------------------------------------------------------------------------------------------------------|\n|                                       Access Control rules with Resource objects                                       |\n|                                              Anti-Bot - Malware DNS Trap                                               |\n|                                          Anti-Bot - Suspicious Mail Activity                                           |\n|                                             Anti-Virus - Traditional mode                                              |\n|                                                     Boot Security                                                      |\n|                                    Check Point Malicious Activity Detection (CPMAD)                                    |\n|                                       ClusterXL in the Load Sharing Unicast mode                                       |\n|                                      ClusterXL in the Load Sharing Multicast mode                                      |\n|                                       Connection from Capsule Connect app on iOS                                       |\n|                   Conversion of a Security Gateway object with IPv6 enabled to a VSX Gateway object                    |\n|                                   CRL fetch from the Internal Certificate Authority                                    |\n| CRL validation in pure IPv6 environments (when IPv4 addresses are not configured on the Security Gateway's interfaces) |\n|                                                 Dynamic Routing - ECMP                                                 |\n|                                         Dynamic Routing - IP Broadcast Helper                                          |\n|                                           Dynamic Routing - PIM with VRRPv3                                            |\n|                                         Dynamic Routing - Policy-Based Routing                                         |\n|                                         Dynamic Routing - Source-Based Routing                                         |\n|                                        Gaia Netflow - IPv6 Netwflow Collectors                                         |\n|                                                      GRE Tunnels                                                       |\n|                                           IPS protection 'Sequence Verifier'                                           |\n|                                      IPv6 addresses for Gaia Management interface                                      |\n|                                                 IPv6 Prefix Delegation                                                 |\n|                                                  IPv6 P2P interfaces                                                   |\n|                                                     ISP Redundancy                                                     |\n|                                Legacy Authentication methods (Client/User/Session Auth)                                |\n|                     Logging - Log exporter object does not support a destination with IPv6 address                     |\n|                                  Logging - SmartView Tracker does not show IPv6 logs                                   |\n|                                               Mail Transfer Agent (MTA)                                                |\n|                                        Multi-Domain Security Management Server                                         |\n|          Multi-Version Cluster (MVC) - IPv6 traffic is not synchronized between members of different versions          |\n|                                        NAT cache (optimization for NAT policy)                                         |\n|                                                      OSE Devices                                                       |\n|                                  Network Prefix Translation (NPTv6) - related to NAT                                   |\n|                                 Security Servers - CVP, UFP, Authentication, and so on                                 |\n|                                           SmartDashboard - VPN Overview page                                           |\n|                                          SmartView Monitor - VPN Tunnel view                                           |\n|                                     Some OPSEC Protocols (LEA, ELA, CVP, UFP, SAM)                                     |\n|                                          Suspicious Activity Monitoring (SAM)                                          |\n|                             The \"`vsx_util change_mgmt_subnet`\" command does not support IPv6                              |\n|                                              URL Filtering - Legacy mode                                               |\n|                                                     User Authority                                                     |\n|                                           VPN - Directional VPN Enforcement                                            |\n|                                               VPN - IKE Aggressive Mode                                                |\n|                                         VPN - IKE Denial of Service protection                                         |\n|                            VPN - Migration from Traditional VPN mode to Simplified VPN mode                            |\n|                                           VPN - Multiple Entry Points (MEP)                                            |\n|                                                VPN - Permanent Tunnels                                                 |\n|                                                VPN - Remote Access VPN                                                 |\n|                                              VPN - Route-based VPN (VTI)                                               |\n|                    VPN - The configuration file `$FWDIR/conf/vpn_route.conf` on the Security Gateway                     |\n|                                                 VPN - Traditional Mode                                                 |\n|                                        VPN - Traditional mode Firewall Policies                                        |\n|                                      VPN - VPN - Route Injection Mechanism (RIM)                                       |\n|                                VPN - VPN Link Selection in the Security Gateway object                                 |\n|                                                    VPN - Wire Mode                                                     |\n\nIn context of the Management environment, there are two main limitations where IPv6 is not supported:\n\nAll tables contain real IPv6 addresses, and there is no difference between how Security Gateways inspect packets between IPv4 and IPv6.\n\nEnabling IPv6 support has some performance implications on both IPv6 and IPv4 traffic. More memory is needed for IPv6 versions of CoreXL and SecureXL, which reduces IPv4 concurrent connection capacity by approximately 30% (exact amount depends on available memory). IPv4 packet rate / throughput and connection rate should not be impacted.\n\nFor a given appliance, the IPv6 connection rate is approximately 40% lower than the corresponding number for IPv4. The concurrent connection rate for IPv6 is 50% lower than the IPv4 number. In both cases, this is due to the increased memory needed to process IPv6 traffic.\n","language":"md","time":"14 days ago","created":"2025-05-06T22:56:16.842Z","annotations":[],"updated":"2025-05-06T22:59:15.631Z"},{"title":"Maestro Setup - R81.20 new features","id":"5ae56506-bad9-451b-8859-2d3375f7d170","type":"TEXT","raw":"## License for Maestro setup - R81.20 new features\n\nProductQuantum Maestro\n\nVersionR81.20\n\nLast Modified2023-01-24\n\n## Solution\n\n## Introduction\n\nIn R81.20 and higher versions, you can use the Security Group Management IP as the IP for the license string.\n\nThis is important when there is no direct connection to the User Center Cloud.\n\nIn such scenarios, the automatic license download does not work, and a manual license installation is necessary.\n\nThis article explains how to install license strings on a Maestro setup.\n\n**Note** - R81.20 supports the license settings procedure (with the Sync IP) from versions below R81.20 (see [sk163323](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk163323)).\n\nThe new procedure is simpler and is recommended for R81.20 and higher versions.\n\n## Use a Security Group Management IP for the License\n\nAll Security Group Member (SGMs) in the Security Group have the same Management IP.\n\nProcedure:\n\n1.  Create license strings in the User Center.\n    \n    1.  Each SGM must have a different license. To create a license, enter the IPv4 and the appliance's Certificate Key (CK).\n        \n    2.  For the license IP, use the Security Group's Management IP. It is the same for all SGMs in the group.\n        \n    3.  For the appliance's CK, use the MAC address of the Management interface.\n        \n        Run this command in SSH to see the MAC address:\n        \n        `ifconfig Mgmt | grep HWaddr`\n        \n        **Note** - Each appliance requires its own MAC address.\n        \n2.  Attach the license strings to the Single Management Object (SMO) of the Security Group.\n    \n    1.  **Note** - As mentioned above, this procedure is applicable when the IP in the license strings is the Management IP of the Security Group.\n        \n    2.  Open SSH on the SMO of the Security Group. Use the `cplic put` command or the `g_cplic put` command to install the licenses.\n        \n        Refer to this article's \"_Using g\\_cplic put in Maestro environment_\" section for more information.\n        \n    3.  You can install the licenses on the SMO before or after you add other SGMs to the group. The license strings are kept in a \"license bank\" on the SMO.\n        \n    4.  When you add a new SGM with a CK that matches one of the installed licenses on this Security Group, the SGM receives the correct license immediately.\n        \n    5.  When you remove an SGM from the Security Group, the license bank continues to keep the SGM's licenses in the SMO.\n        \n\n## Remove the License of an SGM from the Security Group\n\n**Note**: This procedure is the same as in versions before R81.20.\n\n1.  Open SSH on the applicable SGM and run this command:\n    \n    `cplic print -x`\n    \n    **or**\n    \n    Run this command from the SMO:\n    \n    `g_cplic -b <member ID> print -x` (for example: `g_cplic -b 1_02 print -x`)\n    \n    The result of this command is a list of installed licenses on the specific SGM and its keys.\n    \n2.  Copy the signature key of the license to remove.\n    \n3.  Go to SSH to the SMO and run this command:\n    \n    `g_cplic del <the copied signature key>`\n    \n    For all versions, do this procedure from the SMO. You can edit \"license bank\" operations only from the SMO.\n    \n\n**Notes:**\n\n-   Error messages can appear about deleting licenses that do not exist.\n    \n    These come from other SGMs, but the procedure works on the applicable SGM.\n    \n-   This procedure removes the license string from the \"license bank\" on the SMO.\n    \n\n## Use the Security Group Management IP in Auto-Scale Mode\n\nSuppose you have a Maestro Hyperscale Orchestrator (MHO) that manages two Security Groups.\n\nThe MHO manages five SGMs: two in the two Security Groups, with the other three able to move from one Security Group to a different Security Group.\n\nThe Auto-Scale feature does this automatically.\n\nThe table below shows the licenses you must create in the User Center to make sure the insertion and removal of SGMs from the Security Group work correctly.\n\n<table><tbody><tr><td><strong>SGM</strong></td><td><strong>Security Group 1 - 10.20.30.31</strong></td><td><strong>Security Group 2 - 20.30.40.51</strong></td></tr><tr><td>SGM #1</td><td>Needs license</td><td>N/A</td></tr><tr><td>SGM #2</td><td>N/A</td><td>Needs license</td></tr><tr><td>SGM #3</td><td>Needs license</td><td>Needs license</td></tr><tr><td>SGM #4</td><td>Needs license</td><td>Needs license</td></tr><tr><td>SGM #5</td><td>Needs license</td><td>Needs license</td></tr></tbody></table>\n\n**Procedure**:\n\n1.  In the example above, there are four license strings with 10.20.30.31 as the Management IP of Security Group #1, and four license strings with the Management IP of Security Group #2 (20.30.40.51).\n    \n2.  In the CK field, you must use the MAC address of the Management Interface of the SGM.\n    \n    Run this command to get the CK (=MAC of the Management interface):\n    \n    `ifconfig Mgmt | grep HWaddr`\n    \n    In the above example, there is one license string for SGM1 and one license string for SGM2.\n    \n    For other SGMs that move from one Security Group to a different Security Group, you create two license strings: one with the Management IP of Security Group 1, and one with the Management IP of Security Group 2.\n    \n    Based on the above explanation, you can install the licenses on the SMO only after Security Group creation and before you attach other SGMs.\n    \n    Installed licenses stay in the \"license bank\" until a specific Auto-Scale attaches an SGM.\n    \n    When Auto-Scale removes an SGM from the Security Group, or you remove an SGM manually from the Security Group, the license is not removed from the \"license bank\" of that Security Group and remains there.\n    \n\n## The `g_cplic put` command in Maestro environments\n\nStarting from version R81.20, the Maestro commands `g_cplic put` and `g_cplic putlic` run only on the SMO.\n\nIf you run these commands on non-SMO SGMs in the Security Group, this message appears:\n\n_g\\_cplic put: this operation in Maestro env should run from the SMO_\n\nRun the commands on the SMO.\n\nTry to install the license locally on the SMO.\n\nThis immediately applies the distribution operation from the license bank on the SMO to all SGMs.\n\nThe `cplic put` or `cplic putlic` work as before.\n\n## Article Properties\n\nOriginatorLiron Rubin\n\nTechnical ResourceYedidya Shmerler\n\nAccess LevelAdvanced\n\nStatusApproved\n\nDate Created2022-12-29\n\nLast Modified2023-01-24\n\nEditorLiron Rubin\n\nLast ApproverLiron Rubin\n\n## Comments\n\n#### Internal only\n\n**Installing an Evaluation License**\n\nThe Evaluation license (\"eval\") is a license generated by the User Center with a specific expiration time.\n\nTAC and SEs use this license for customer demonstrations.\n\n The CK for the \"eval\" license is an auto-generated string similar to the appliance's MAC address. As a result, the CK does not match the customer appliances. \n\n Starting in R81.20, Maestro environment supports \"eval\" licenses: \n\n1.  For the IP it is valid to set the Sync IP of a specific appliance in the Security Group and to install it directly on this appliance. In such a scenario, the customer has to use the \"`cplic`\" command and follow the instructions for version R81.10 and below.\n2.  It is valid (and much simpler) to use for the license string the Management IP of the Security Group and to install it on the SMO. In such a scenario, a single license string is valid for all SGMs in the Security Group no matter the number.\n\nSteps: \n\na. Create an \"eval\" license.\n\nb. Check that expiration date is not **never**.\n\nc. Install it on the SMO with the \"`cplic put`\" command and stop for 5-6 minutes until the SMO distributes it to all members.\n\n**or**\n\nRun the \"`g_cplic put`\" command on the SMO for immediate distribution, as described above.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:22.131Z","annotations":[],"updated":"2025-05-06T23:02:58.901Z"},{"title":"Table with Multiple Packages","id":"edca7779-168d-44d9-a867-7f98c7a6910b","type":"TEXT","raw":"<table><tbody><tr><td>Date</td><td>Description</td></tr><tr><td>20 Mar 2025</td><td>Updated SmartConsole package to Build 663.</td></tr><tr><td>19 Feb 2025</td><td>Fast Deployment Package: Security Gateway, Security Management and Multi-Domain were updated to Take 98.</td></tr><tr><td>05 Jan 2025</td><td>Updated SmartConsole package to Build 661.</td></tr><tr><td>18 Dec 2024</td><td>Fast Deployment Package: Security Gateway, Security Management and Multi-Domain were updated to Take 92.</td></tr><tr><td>12 Nov 2024</td><td>Updated SmartConsole package to Build 660.</td></tr><tr><td>28 Oct 2024</td><td>Fast Deployment Package: Security Gateway, Security Management and Multi-Domain were updated to Take 89.</td></tr><tr><td>13 Oct 2024</td><td>Added link to Cloud Management Extension (CME) Administration Guide.</td></tr><tr><td>06 Oct 2024</td><td>Updated SmartConsole package to Build 659.</td></tr><tr><td>18 Sep 2024</td><td>Fast Deployment Package: Security Gateway, Security Management and Multi-Domain were updated to Take 84.</td></tr><tr><td>10 Sep 2024</td><td>Updated SmartConsole package to Build 658.</td></tr><tr><td>19 Aug 2024</td><td>Updated SmartConsole package to Build 656.</td></tr><tr><td>31 Jul 2024</td><td>Fast Deployment Package: Security Gateway, Security Management and Multi-Domain were updated to Take 76.</td></tr><tr><td>01 Jul 2024</td><td>Updated SmartConsole package to Build 655.</td></tr><tr><td>05 Jun 2024</td><td>Updated SmartConsole package to Build 654.</td></tr><tr><td>03 Jun 2024</td><td><ul><li>R81.20 Gaia images have been replaced with Take 634.</li><li>Fast Deployment Package: Security Gateway, Security Management and Multi-Domain were updated to Take 65.</li></ul></td></tr><tr><td>08 Apr 2024</td><td>Updated SmartConsole package to Build 653.</td></tr><tr><td>03 Apr 2024</td><td>Fast Deployment Package: Security Gateway, Security Management and Multi-Domain were updated to Take 53.</td></tr><tr><td>08 Jan 2024</td><td>Updated SmartConsole package to Build 651.</td></tr><tr><td>04 Dec 2023</td><td>Fast Deployment Package: Security Gateway, Security Management and Multi-Domain were updated to Take 41.</td></tr><tr><td>26 Nov 2023</td><td>Added SSL Network Extender (SNX) Administration Guide.</td></tr><tr><td>23 Oct 2023</td><td>Updated SmartConsole package to Build 649.</td></tr><tr><td>13 Sep 2023</td><td>Fast Deployment Package: Security Gateway, Security Management and Multi-Domain were updated to Take 26.</td></tr><tr><td>15 Aug 2023</td><td>Updated the section \"What's New\" &gt; sub-section \"Clustering\": added the list of Software Blades that are supported in the ClusterXL in the Active-Active mode.</td></tr><tr><td>14 Aug 2023</td><td>Updated SmartConsole package to Build 646.</td></tr><tr><td>30 Jul 2023</td><td>Updated SmartConsole package to Build 645.</td></tr><tr><td>24 Jul 2023</td><td>Fast Deployment Package: Security Gateway, Security Management and Multi-Domain were updated to Take 24.</td></tr><tr><td>01 Jun 2023</td><td>Updated SmartConsole package to Build 641.</td></tr><tr><td>30 Apr 2023</td><td>Fast Deployment Package: Security Gateway, Security Management and Multi-Domain were updated to Take 10.</td></tr><tr><td>27 Apr 2023</td><td>Downloads and Installation section redesign.</td></tr><tr><td>08 Mar 2023</td><td>Updated SmartConsole package to Build 640.</td></tr><tr><td>07 Mar 2023</td><td>Updated SmartConsole package to Build 4.</td></tr><tr><td>12 Jan 2023</td><td>Updated the installation image to Take 631.<br>The new Take contains a replacement for the self-updatable files.</td></tr><tr><td>24 Nov 2022</td><td>Added R81.20 Documentation Package.</td></tr><tr><td>21 Nov 2022</td><td>First release of this document.</td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:19.321Z","annotations":[],"updated":"2025-05-06T22:59:36.377Z"},{"title":"Internal Section for R&D (Dov Becker) Customers","id":"21d38c16-026b-4edf-8b51-1c09ebb2e7b1","type":"TEXT","raw":"This section is internal per a specific request from R&D (Dov Becker). Customers do not need to know about the I/S, only about the products that update with it.\n\n<table id=\"Unique_IDTable\"><tbody><tr data-darkreader-inline-bgcolor=\"\"><td>ID</td><td>Description</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 25 - Take 67- 990180350 (17 Jul 2024)</strong></td></tr><tr><td>DP-10841</td><td>Separate self-update packages from other offline repository packages to avoid deadlock during same bulk installation ( resolve &nbsp;deadlock issue in R81.20 immediately after clean install).</td></tr><tr><td>DP-11502</td><td>Stopping Darwin from installing packages during FTW unless it is explicitly forced.</td></tr><tr><td>DP-11292</td><td>More significant errors to report for failed downloads.</td></tr><tr><td>DP-11632</td><td>Save installation time for a package and show it in cli show command.</td></tr><tr><td>DP-11412</td><td>Add new cli command to provide significant info about installed components.</td></tr><tr><td>DP-10212&nbsp;</td><td>Changed main log file location to /opt/CPInstLog and add symbolic link instead.</td></tr><tr><td>DP-11594</td><td>Fixing installation mutex between AutoUpdater and CPUSE to hold during long time upgrades.</td></tr><tr><td>DP-11714</td><td>Added log uploader to collect log files in a case of unexpected error, and upload them by DAService .</td></tr><tr><td>-</td><td>System libs updated to jaguar main.</td></tr><tr><td>-</td><td>Added support for number of new components.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 24 - Take 65- 990180333 (2 Feb 2024)</strong></td></tr><tr><td>DP-11584&nbsp;</td><td>Disabled \"Autonomous Threat Prevention” aka simplified_threat_prevention component.</td></tr><tr><td>DP-11087</td><td>Added support separating products_config.xml to new component.</td></tr><tr><td>DP-10953</td><td>Added R82 Smart Console loging.</td></tr><tr><td>INFRA-970</td><td>Fixed insecure connection to Download Server - all connections are now done using https protocol.</td></tr><tr><td>PMTR-96232</td><td>Console flooded with messages after initial login bug.</td></tr><tr><td>DP-9532</td><td>In Auto updater CLI, improved the help output of “autouupdatercli”.</td></tr><tr><td>DP-9600</td><td>Improved cleanup of AutoUpdater repository.</td></tr><tr><td>INFRA-969</td><td>Removed sensitive information from debug logs.</td></tr><tr><td>DP-10318</td><td>Issue caused by intersection of two different persistence features.</td></tr><tr><td>DP-10922</td><td>Added new exit code for a sync install command to indicate installation failure.</td></tr><tr><td>-</td><td>Added support for number of new components.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 23 - Take 58- 990180289 (27 Dec 2022)</strong></td></tr><tr><td>DP-8943&nbsp;</td><td>Added support for dependency packages</td></tr><tr><td>DP-9478</td><td>improved installation speed at deployment installer, and adding configuration file to support disable of schedulers</td></tr><tr><td>DP-9144</td><td>fixed self revert (lifeline) issues</td></tr><tr><td>DP-9415&nbsp;</td><td>print script output in a case of script timeout</td></tr><tr><td>DP-10032</td><td>fixed map::at unhandled exception</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 22 - Take 55- 990180269 (28 Apr 2022)</strong></td></tr><tr><td>DP-8781</td><td>Added update component feature</td></tr><tr><td>DP-8684</td><td>Added persistency to messages Darwin receive&nbsp;</td></tr><tr><td>DP-8712</td><td>Prevent Darwin stop when build didn't change</td></tr><tr><td>DP-8807,<br>DP-8855</td><td>Integrated tracked installation feature to CPUSE Upgrade</td></tr><tr><td>DP-8990&nbsp;</td><td>Uninstall identifier bug fix</td></tr><tr><td>DP-8941</td><td>Configuration change of default enable/disable state bug fix</td></tr><tr><td>DP-8543</td><td>Added a non-security update configuration</td></tr><tr><td>PMTR-74277</td><td>Fixed issues found by SourceGuard Critical Detections</td></tr><tr><td>PMTR-80284</td><td>Fixed bug that cause AutoUpdater core dump while reading XML&nbsp;</td></tr><tr><td>PMTR-80333&nbsp;</td><td>Removed irrelevant log from /var/log/messages</td></tr><tr><td>DP-9047</td><td>Fixed easy log file for R81.20</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 21 - Take&nbsp;52- 990180252 (17 Jan 2022)</strong></td></tr><tr><td>DP-8548</td><td>Improved random waiting time before daily restart</td></tr><tr><td>DP-8428&nbsp;</td><td>SmartConsole logging to new version added</td></tr><tr><td>DP-8118</td><td>NEW: option for synchronic installation</td></tr><tr><td>DP-8040</td><td>Scheduler redesign</td></tr><tr><td>VSECPC-5256&nbsp;</td><td>Added support for multiple logs to SmartConsole&nbsp;</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 20 - Take&nbsp;49 - 990180246 (14 Nov 2021)</strong></td></tr><tr><td>DP-7787</td><td>Fixed CPDiag getting overridden issue</td></tr><tr><td>DP-7641&nbsp;</td><td>Fixed memory leak in scheduler</td></tr><tr><td>DP-8050&nbsp;</td><td>Fixed exception if SC logging failed</td></tr><tr><td>DP-8338</td><td>Restart every day at random time</td></tr><tr><td>ODU-215</td><td>Write log to/var/log/messages after installation</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 18 - Take&nbsp;44 - 990180231 (14 Jun 2021)</strong></td></tr><tr><td>PMTR-65191</td><td>Fixed bug in zero packages installation</td></tr><tr><td>DP-7199&nbsp;</td><td>Added new feature: maintenance window</td></tr><tr><td>DP-6821</td><td>Added new feature: remove old packages</td></tr><tr><td>DP-6585</td><td>Added new feature: parameters send to Darwin scripts</td></tr><tr><td>DP-7664</td><td>Changed cpis version fixing memory leak</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 17 - Take 41 - 990180229 (5 May 2021)</strong></td></tr><tr><td>DP-7660</td><td>Added AutoUpdater restart to avoid crashes</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 16 - Take 39 - 990180214 (25 Jan 2021)</strong></td></tr><tr><td>DP-6861</td><td>Added support for the new PDT version.</td></tr><tr><td>DP-6691</td><td>Changed revert version logged to cpdiag</td></tr><tr><td>DP-6698</td><td>Allow print Build Number to log</td></tr><tr><td>PMTR-62317,<br>DP-6977</td><td>Missing product after upgrade (the installation was after 3h)</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 15 - Take 36 - 990180206 (24 Nov 2020)</strong></td></tr><tr><td>DP-6761</td><td>fixing bug of flooding /tmp folder, and cleanup added</td></tr><tr><td>DP-6647</td><td>fixing installation source in registry after revert</td></tr><tr><td>DP-6443</td><td>SmartConsole logging is added to all versions</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 14 - Take&nbsp;34 - 990180184 (25 Aug 2020)</strong></td></tr><tr><td>DP-5972</td><td>AutoUpdater will differentiate blocking a package with online flow only.</td></tr><tr><td>DP-6034</td><td>DDR will run before pre-installation scripts.</td></tr><tr><td>DP-6213</td><td>In some scenarios, MaaS metadata import fails.</td></tr><tr><td>DP-6004</td><td>EndPoint update change permissions of files in fw1</td></tr><tr><td>DP-5996</td><td>Wrong log after running revert twice in a row.&nbsp;</td></tr><tr><td>DP-5997,<br>DP-5995</td><td>Running revert twice in a row results in reverting only one version back.</td></tr><tr><td>DP-6237</td><td>Imrpoved offline repository first time installation on Stand-alone environment.</td></tr><tr><td>DP-6033</td><td>AutoUpdater should not allow downloads of packages without metadata.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 13 - Take&nbsp;33 - 990180171 (1 Jul 2020)</strong></td></tr><tr><td>DP-5330</td><td>Added recovery mechanism for emergency self-update.</td></tr><tr><td>DP-5421</td><td>Added ability to display the AutoUpdater logs in R80.40 SmartLog.</td></tr><tr><td>DP-5807</td><td>Added Deployment Installer error codes.</td></tr><tr><td>TEX-1819</td><td>Engine revert may not work properly.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 12.5 - Take&nbsp;32 - 990180170 (21 Jun 2020)</strong></td></tr><tr><td>DP-5998</td><td>Stability fix for Infinity Threat Prevention Management.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 12 - Take&nbsp;28 - 990180162 (20 May 2020)</strong></td></tr><tr><td>DP-5850</td><td>Statistic file becomes corrupted once it is moved</td></tr><tr><td>DP-5668</td><td>Support packages being installed upon FTW completion</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 11 - Take&nbsp;26 - 990180154 (30 Apr 2020)</strong></td></tr><tr><td>CGIS-343</td><td>Added CloudGuard CME to configuration.</td></tr><tr><td>DP-5678</td><td>Added CLI verifying AutoUpdater is ready to receive requests.</td></tr><tr><td>DP-5668</td><td>Added support for installing packages as part of the Recommended Take image.</td></tr><tr><td>DP-5702</td><td>Added branch name to statistics.</td></tr><tr><td>TPM-2247</td><td>Added dc_content component to configurations.</td></tr><tr><td>DP-5715</td><td>Added general_updates component to configuration.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 10 - Take&nbsp;25 - 990180147 (19 Mar 2020)</strong></td></tr><tr><td>DP-5524</td><td>Allow to disable schedules when component is either being installed or downloaded.</td></tr><tr><td>DP-5545</td><td>MaaS-tunnel will not be re-installed via AutoUpdater after Uninstall &amp; Reinstall of Jumbo Hotfix.</td></tr><tr><td>CPDIAG-1680</td><td>Core File Uploader integration to AutoUpdater.</td></tr><tr><td>DP-5587</td><td>Check non-const DDR scripts on download.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 9 - Take&nbsp;24 - 990180144 (08 Mar 2020)</strong></td></tr><tr><td>TPM-2119</td><td>Changes in <em>products_config.xml</em> file for Infinity Threat Prevention Management.</td></tr><tr><td>MBS-9332</td><td>Changes in <em>products_config.xml file</em> for Scalable Platforms.</td></tr><tr><td>PMTR-50590</td><td>Verify scripts end successfully.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 8 - Take&nbsp;23 - 990180138 (22 Feb 2020)&nbsp;</strong></td></tr><tr><td>DP-5272</td><td>Mutex in installation code will be in one place</td></tr><tr><td>MBS-9332</td><td>Added Scalable Platforms to AutoUpdater configuration.</td></tr><tr><td>DP-5286</td><td>Prevent requests that want to ignore CPUSE mutex from being stuck behind other requests.</td></tr><tr><td>UDM-221</td><td>Added SBM connector to AutoUpdater configuration.</td></tr><tr><td>CPDIAG-1662</td><td>Added CPMID to AutoUpdater configuration.</td></tr><tr><td>DP-5375</td><td>Added CDT to AutoUpdater configuration.</td></tr><tr><td>DP-5409</td><td>MaaS is enabled by default</td></tr><tr><td>DP-5437</td><td>Bring back AutoUpdater going up in boot sequence</td></tr><tr><td>DP-5447</td><td>Make MaaS versioned in AutoUpdater configuration.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 7 - Take&nbsp;19 - 990180129 (05 Jan 2020)&nbsp;</strong></td></tr><tr><td>DP-5212</td><td>In some scenarios, AutoUpdater may not start when cpinfo Build 43 is installed.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 6 - Take&nbsp;17 -&nbsp; 990180124 (18 Dec 2019)&nbsp;</strong></td></tr><tr><td>DP-5176</td><td>If AutoUpdater is killed forcefully during an installation, the <em>DepInstaller</em> process remains stuck indefinitely.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 5 - Take&nbsp;16 - 990180119 (11 Dec 2019)&nbsp;</strong></td></tr><tr><td>DP-5152</td><td>When performing upgrade, then revert and then upgrade again, AutoUpdater identifies packages as installed.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 4 - Take&nbsp;15 - 990180118&nbsp; (05 Dec 2019)</strong></td></tr><tr><td>DP-5120</td><td><ul><li>In a rare scenario during self-update, AutoUpdater may crash</li><li><strong>UPDATE:</strong> changed the registration to CPWD with all capital letters.</li></ul></td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 3 - Take&nbsp;13 - 990180111 (19 Nov 2019)</strong></td></tr><tr><td>DP-5017</td><td>Blink installation failure causes high CPU usage on machine.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 2 Take&nbsp;10 - 990180110 (28 Oct 2019)</strong></td></tr><tr><td>PMTR-43759</td><td>In a rare scenario, AutoUpdater may crash.</td></tr><tr><td>DP-4983</td><td><strong>UPDATE:</strong> MaaS tunnel is disabled by default.</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Update 1 - Build 990180105 (30 Jul 2019)</strong></td></tr><tr><td>-</td><td>Initial build of AutoUpdater delivered to all R80.x Jumbo Hotfixes and to R80.40,</td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:16.976Z","annotations":[],"updated":"2025-05-06T22:59:15.214Z"},{"title":"Troubleshooting Email Stuck in Deferred Queue Due to Insufficient Resources","id":"7928e425-5b2c-437c-a05a-8b0cca27380e","type":"TEXT","raw":"ProductAnti-Spam, Anti-Virus, Threat Emulation, Threat Extraction\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nOSGaia\n\nLast Modified2022-11-23\n\n## Symptoms\n\n-   Emails are accumulating in the MTA \"deferred\" queue.\n-   Postfix queue shows many emails with this message:  \n    `[Expert@HostName:0]# /opt/postfix/usr/sbin/postqueue -c /opt/postfix/etc/postfix/ -p  4HfWQQ6gfZzD5c9 79716 Wed Oct 27 10:31:21 bounce@domain.com (host 10.1.1.30[10.1.1.30] said: 452 4.3.1 Insufficient system resources (SystemMemory) (in reply to end of DATA command)) user@domain2.com  `\n\n## Cause\n\nNext Hop IP, which is usually an email server, sent this error: \"`452 4.3.1 Insufficient system resources (SystemMemory)`\".\n\n## Solution\n\nNot a Check Point issue. Investigate the issue on the email server.\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorAnthony Nguyen\n\nTechnical ResourceAbraham Escobedo Recio\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2021-12-09\n\nLast Modified2022-11-23\n\nEditorAnthony Nguyen\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only\n\nrelevant for R81.20 as well","language":"md","time":"14 days ago","created":"2025-05-06T22:56:22.301Z","annotations":[],"updated":"2025-05-06T23:02:38.787Z"},{"title":"Configuration and LSP Group Configuration for Downlink/Uplink","id":"b6170c9b-2446-4cc1-b8ff-81fcf3c0e557","type":"TEXT","raw":"> **Table of Contents:**\n> \n> -   Introduction\n>     \n> -   Solution\n>     \n> -   Configuration\n>     \n> -   API\n>     \n> -   History\n>     \n> -   Known Limitations\n>     \n> \n> ## Introduction\n> \n> Check Point has a daemon that listens to events of ports (downlink/uplink), but there is no way to configure a group of ports that operate as one port. This means that if one of the ports in the group is down, the others must be down, as well, because the ports can only work when all are up (due to the given network topology). If a minimum of one port is down, but the others are up, outages could occur even with the existence of redundancy.\n> \n> LSP (Link State Propagation) solves this issue.\n> \n> For example:\n> \n>  ![](https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1616076809007/LSPSK202103181626551.jpg)\n> \n> If traffic flows from client to server, the flow is:  \n> client -> ‘MHO-1 eth1’ -> ‘eth2 MHO-1’ to server\n> \n> If ‘eth2 MHO1’ goes down, an outage occurs because we did know from the onset that ‘eth2 MHO-1’ is down.\n> \n> The same issue applies if you use the ‘eth1 MHO-2’ interface and the ‘eth2 MHO-2’ is down.\n> \n> With LSP, you can configure a group containing these two ports (‘eth1 MHO-1’ and ‘eth2 MHO-1’) that behave as one port. If one goes down, so does the other, and then the client goes through the ports of MHO-2.\n> \n> ##   \n> Solution\n> \n> The solution is to configure an LSP group that will be monitored and treated as one port.\n> \n> **This feature is integrated into [Jumbo Hotfix Accumulator for R80.20SP Take 313](https://supportcenter.us.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk155832).**  \n> \n> If one of the ports in the group goes down, then all ports in the group will be moved to down so that the switches will not forward traffic for those ports. This eliminates/limits the outage.\n> \n> The challenge is to move the ports back up only when we know that all ports in the LSP group are up and working.\n> \n> There are two important pieces of information about the ports:\n> \n> 1.  Ports admin state\n>     -   up/down :: configured by s/w\n> 2.  Ports operation state  \n>     -   up/down :: based on connectivity/auto-negotiation\n> \n> ##   \n> Configuration\n> \n> The first step is to configure the LSP group(s).\n> \n> These groups are saved in a configuration JSON file. The file only includes the ports in each LSP group.\n> \n> You can modify the file/configuration on the fly with ‘clish’ only.\n> \n> ##   \n> API\n> \n> All LSP commands are under '`set/add/show/delete maestro lsp`'.  \n> \n> -   `set maestro lsp group <GROUP-ID> ports <ports>` \n>     -   Adds a new group with the given ports.  If the group already exists, it overwrites the group.\n> \n> -   s`et maestro lsp state <state - on/off>`  \n>     -   Enables/Disables LSP\n> -   `set maestro lsp apply`\n>     -   Applies LSP modifications\n> -   `set maestro lsp revert`\n>     -   Reverts LSP modifications\n> -   `add maestro lsp group <GROUP-ID> port <ports>`\n>     -   Adds port(s) to an existing group.  \n>         You can add multiple ports by separating them with ‘,’.\n> \n> -   `delete maestro lsp group <GROUP-ID> port <ports>`\n>     -   Removes port(s) from an existing group.  \n>         You can add multiple ports by separating them with ‘,’.\n> \n> -   `delete maestro lsp group <GROUP-ID>`\n>     -   Removes the entire group and ports from the configuration.\n> \n> -   `show maestro lsp configuration all`\n>     -   Shows the configuration of each group and the state.   \n>         If any modifications to the configuration were not applied, they appear in another section.\n> \n> -   `show maestro lsp configuration group <GROUP-ID>`\n>     -   Shows the ports in the specified group.  \n>         If the group has been modified but not yet applied, it shows both configurations.\n> \n> -   `show maestro lsp status`\n>     -    Shows the monitoring status of the applied configuration from the daemon.\n> \n> -   `show maestro lsp history <number of events to show>`\n>     -   Shows the recent 'X' events.  \n>         X = <number of events to show>\n> \n> ## History\n> \n> The History mechanism shows important recent events that occurred in the daemon on the ports. The events are written into _/var/log/lsp\\_history.log_\n> \n> The clish command `show maestro lsp history <number of events to show>` takes the contents of the history log file and orders them in a table.\n> \n> The table consists of 5 columns:\n> \n> -   Time: When the event happened\n> -   Port: The port on which the event has been received\n> -   Event: The event that occurred\n> -   Group: The affected group\n> -   Group Status: The reflection of the event on the group state\n> \n>   \n> \n> <table><tbody><tr><td><strong>Event (as seen on the CLI)</strong></td><td><strong>Meaning</strong></td></tr><tr><td>Down</td><td>Event down was received on the port.</td></tr><tr><td>admin-down</td><td>Port was moved to admin-down. The LSP mechanism forces some ports to go to down (admin-down) in order to manage the groups accordingly.</td></tr><tr><td>recovered down-&gt;up</td><td>Event up was received on port.</td></tr><tr><td>moved to admin-down, preparing for group recovery</td><td>After getting an up event on port, we move it to admin-down, preparing to perform group recovery. We do this in order to minimize the gap between group ports.</td></tr><tr><td>moved to admin-up</td><td>Moved port to admin up. This occurs post preparation for group recovery.</td></tr><tr><td>has recovered after &lt;Time in seconds&gt;</td><td>Port operation state has gone up after X seconds.</td></tr><tr><td>found down in initializing</td><td>Upon configuration loading, we reassess port statuses (initializing LSP). This event states that we have found the port in operation state down.</td></tr><tr><td>admin-down in initializing</td><td>Port has been moved to admin-down because of the event mentioned above.</td></tr><tr><td>Configuration change event received</td><td>LSP configuration might be changed on this specific group.</td></tr><tr><td>Resetting ports monitoring</td><td>Reassessment of the port statuses (initializing LSP) started (not per port event).&nbsp;</td></tr></tbody></table>\n> \n>   \n> \n> ## Known Limitations\n> \n> -   LSP is on the Orchestrator side only.\n> -   Configuration is not propagated to all Maestro Hyperscale Orchestrators (MHOs). Do any LSP modifications manually.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:19.518Z","annotations":[],"updated":"2025-05-06T23:00:19.192Z"},{"title":"Check Point Maestro Orchestrator Interface Splitter Configuration Not Saved After Reboot","id":"78218184-c273-4951-ad6c-e3947d049fbf","type":"TEXT","raw":"ProductQuantum Maestro\n\nVersionR80.20SP (EOS), R81.10, R81.20\n\nOSGaia\n\nLast Modified2023-07-19\n\n#### For internal users only\n\n## Symptoms\n\n-   Interface splitter configuration is not saved after you reboot the Maestro Orchestrator.\n    \n-   The \"`# cat /etc/maestro.json | grep qsfp_auto_config`\" command returns \"on\":  \n    `qsfp_auto_config\" : \"on\"`\n-   The \"`# tor_util get_qsfp_auto_config`\" command shows \"on\".\n    \n\n## Solution\n\nThis problem was fixed. The fix is included starting from:\n\n-   [Check Point R81.20](https://support.checkpoint.com/results/sk/sk173903)\n-   [Jumbo Hotfix Accumulator for R81.10](https://sc1.checkpoint.com/documents/Jumbo_HFA/R81.10/Default.htm) starting from Take 38\n-   [Jumbo Hotfix Accumulator for R80.20SP](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk155832#List%20of%20resolved%20issues%20per%20Take) starting from Take 327\n\nIf you do not wish to upgrade, disable QSFP auto-config:\n\n1.  Connect to the Maestro Orchestrator.\n2.  Enter the Expert mode.\n3.  Disable QSFP auto-config:\n    \n    `# tor_util set_qsfp_auto_config off`\n    \n4.  Restart services on the Maestro Orchestrator:\n    \n    `# orchd restart`\n    \n\n**CAUTION**: **This restarts all services on the Maestro Orchestrator.**\n\n**Depending on your configuration, the restart could cause service disruption.**\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorBoris Ostrovsky\n\nTechnical ResourceAnatoly Masover\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2020-09-15\n\nLast Modified2023-07-19\n\nEditorBoris Ostrovsky\n\nLast ApproverLiron Rubin\n\n## Comments\n\n#### Internal only\n\nIt is also allowed to manually modify /etc/maestro.json, but using tor\\_util is preferred.\n\nIn `/etc/maestro.json`, change the `qsfp_auto_config` setting to off:    \n`\"qsfp_auto_config\" : \"off\"`\n\nThen perform `orchd restart`.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:17.223Z","annotations":[],"updated":"2025-05-06T22:59:56.383Z"},{"title":"Check Point Firewall Logs Show Destination Port -1 and Protocol -1","id":"b1335d64-fb08-47ee-8023-bf618acea89c","type":"TEXT","raw":"ProductIPS\n\nVersionR77.20 (EOS), R77.30 (EOS), R80 (EOS), R80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nPlatformAll\n\nLast Modified2023-01-23\n\n## Symptoms\n\n-   Logs for a host port scan show \"`destination port: -1`\" and \"`protocol: -1`\".\n\n## Solution\n\nNo fix is required. This behavior is by design.\n\nThe value `-1` means \"any\" or \"all\" protocols and ports.\n\n**Best Practices  \n**\n\n-   Investigate the cause of the logs. Review the firewall logs and identifying the source IP addresses of the connections.\n-   Fine-tune firewall settings to block or limit any traffic that is determined to be malicious.\n-   Monitor your network for any unusual or suspicious traffic..\n-   Make sure there are no false positives for port scanning..  \n    For example, if a network device is configured to send certain types of traffic to a specific port, it can appear as if that host is scanning for open ports.  \n    Additionally, if a network device is configured to forward traffic to multiple ports, it can also appear as if a host is scanning for open ports.  \n    These issues can be caused by misconfigurations, errors, or outdated network configurations.\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorEden Bobovnik\n\nTechnical ResourceKyle Danielson\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2023-01-18\n\nLast Modified2023-01-23\n\nEditorEden Bobovnik\n\nLast ApproverRobert Henderson\n\n## Comments\n\n#### Internal only\n\nThis is by design in the code.\n\nGenerally in the context of network security and traffic analysis, -1 is commonly used to refer to \"any\" or \"all\" protocols and ports.  \nIt is used to indicate that a large amount of traffic is being dropped for multiple protocols and ports.  \nIn many cases, such as in firewall logs and intrusion detection systems, -1 is used as a placeholder for \"any\" or \"all\" protocols and ports when the specific protocol or port is not known or not relevant to the log.  \nThe use of -1 in this context is a common convention in the field of network security, and is generally known among network administrators and security professionals.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:22.439Z","annotations":[],"updated":"2025-05-06T23:02:44.561Z"},{"title":"Check for HCP Version and Validation","id":"77dbd5c6-0a2b-418e-a4f9-b15a03d1fbf6","type":"TEXT","raw":"---\ncreated: 2025-04-29T12:52:30 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk171436\nauthor: \n---\n\n# sk171436 - HealthCheck Point (HCP) Release Updates\n\n> ## Excerpt\n> Applies to: Multi-Domain Security Management, Quantum Maestro, Quantum Scalable Chassis, Quantum Security Gateways, Quantum Security Management, VSX (Traditional)\n\n---\n|                   ID                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|----------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|   **Update 22 - Take 84 (21 Apr 2025)**    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **Update 22 - Take 84 (21 Apr 2025)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|              PMTR-109082               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Enhancement: Added a new test to verify licenses across all Scalable Platform members.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|                HCP-1361                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Enhancement: Added the option to upgrade HCP version on all the Security Gateways attached to the specific Security Management Server.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                HCP-1109                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Enhancement: Added a new test to detect SAML Portal issues described in sk182128.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                HCP-1291                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     HCP test reports an FTW failure even when the FTW process is completed successfully. This happens because of incorrect checking the _.wizard\\_started_ file.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-1285                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            The Memory test falsely reports high memory consumption of the JAVA process.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                ODU-2483                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Minor fixes and improvements.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|   **Update 21 - Take 77 (05 Jan 2025)**    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **Update 21 - Take 77 (05 Jan 2025)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                HCP-1137                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Enhancement: Added a new test to verify successful execution of post-upgrade cleanup processes in the Security Group on a Scalable Platform.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                ODU-2259                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Minor fixes and improvements.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|   **Update 20 - Take 76 (27 Oct 2024)**    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **Update 20 - Take 76 (27 Oct 2024)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                HCP-1082                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Enhancement: Increased the timeout threshold for background HCP processes in R82 to prevent false-positive errors while maintaining MHO's ability to handle concurrent REST requests.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|   **Update 19 - Take 74 (15 Sep 2024)**    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **Update 19 - Take 74 (15 Sep 2024)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                ODU-1979                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Minor fixes and improvements.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|                HCP-1000                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Enhancement: Improved the loading time of HCP tests in on a VSX Gateway.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-982                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         After an upgrade on Gaia, the SSD test may fail during system checks on hardware, although it does not have an SSD.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n|                HCP-369                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           The Cluster test false positively fails on a cluster with more than two members when they are in Backup state.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|   **Update 18 - Take 73 (03 Jul 2024)**    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **Update 18 - Take 73 (03 Jul 2024)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                HCP-1024                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   High CPU and memory usage may be caused by the Licensing test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|                HCP-1025                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Large output for the Shared Memory and Huge Pages test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                HCP-993                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 It may not be possible to run HCP from SmartConsole for Secondary Management and SmartEvent Server.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                HCP-1005                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                The status for the Policy in Security Group test may be \"UNDEFINED\".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                HCP-998                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        HCP reports connectivity issue for the Virtual Switch that cannot access the Internet according to its configuration.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|                HCP-983                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            The Software Version test fails as false positive on HOTFIX\\_OTLP\\_GA packages.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|  **Update 17 - Take 70 (31 March 2024)**   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 **Update 17 - Take 70 (31 March 2024)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                HCP-894                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              **NEW:** The HCP tests and the collection of reports to the Security Management Server are scheduled to occur automatically every 6 hours. This frequency can be modified by using the \"_cpd\\_sched\\_config_\" command in the _HcpPeriodicRun_ task.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n|                HCP-918                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        The Connectivity to UserCenter test fails with \"_IndexError: list index out of range_\".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n| **Update 16 - Take 68 (29 February 2024)** |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               **Update 16 - Take 68 (29 February 2024)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                HCP-896                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               **NEW:** Added IOC statistics test, which reports if there is an IOC issue.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-891                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                The Jumbo Frames test fails with a false positive result after Jumbo Hotfix Accumulator installation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                HCP-900                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                The \"_hcp -r all_\" command fails with a traceback stack on SDWAN test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                HCP-883                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          HCP report may not be generated correctly if the object name has capital letters.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                HCP-828                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    The Fragmentation Rate test fails with an exception on one of the Scalable Platforms members.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n| **Update 15 - Take 67 (18 January 2024)**  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                **Update 15 - Take 67 (18 January 2024)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                HCP-870                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      **NEW:** Added a new test which validates that graceful restart is enabled on all BGP peers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                HCP-808                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      **NEW:** Added a new test which checks if DNS Passive Learning feature is active. If it is not active, the test provides the exact reason. Refer to sk161612.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-792                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **NEW:** Added a new Identity Awareness test, which identifies any disconnections that may occur between the PDP and PEP components.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n|                HCP-823                 | **NEW:** Added new SD-WAN tests:\n\nSD-WAN - CPSDWAN and Steering Status:  \nThis test checks whether cpsdwan and steering are enabled. If any of these services are not enabled, the test fails; otherwise, it succeeds.\n\nSD-WAN - Services Running:  \nThis test ensures that all SD-WAN services are currently running. If any service is not running, the test fails; otherwise, it succeeds.\n\nSD-WAN - Fog Connection:  \nThis test checks the connectivity between the Security Gateway and the fog through the SD-WAN Nano-Agent. The test fails if there is no connection; otherwise, it succeeds.\n\nSD-WAN - ISP Redundancy Status:  \nThis test determines whether ISP Redundancy is enabled. The test fails if ISP Redundancy is detected, and it succeeds otherwise.\n\nSD-WAN - PBR Rules Configuration:  \nThis test examines the configuration of Policy-Based Routing (PBR) rules. It passes with a warning if at least one PBR rule is configured; otherwise, it succeeds.\n\nSD-WAN - Required Files Presence:  \nThis test checks the existence of all required SD-WAN files. If any file is missing, the test fails; otherwise, it succeeds.\n\nSD-WAN - Software Blades Enabled:  \nThis test ensures that all Software Blades necessary for SD-WAN functionality are enabled. If any required Software Blade is disabled, the test fails; otherwise, it succeeds. |\n|                HCP-815                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            **NEW:** Created a new test to monitor hide NAT port usage, specifically designed to detect instances of failure resulting from port exhaustion.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                   \\-                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             The \"hcp -r all\" command fails on Security Group Members (Maestro or Scalable Chassis). Refer to sk181865.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n| **Update 14 - Take 62 (15 October 2023)**  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                **Update 14 - Take 62 (15 October 2023)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                HCP-790                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           **NEW:** Added a new HTTPS Inspection configuration test, which checks the validity of the outbound inspection certificate for a Security Gateway.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|                HCP-753                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          **NEW:** Added a new Local Ports Usage test, which checks ephemeral port range exhaustion for connections from Security Gateway interface addresses.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                HCP-744                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              **NEW:** Added a new test to check the current status of Dynamic Dispatcher.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-742                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      **NEW:** Added a new SecureXL test, which checks the configuration of LightSpeed appliances.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                HCP-769                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            **NEW:** Added a new test to check the quantity of Global connection entries. It should be less than four times of Concurrent connections values.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|                HCP-645                 | **NEW:** A new test was added to verify that the Security appliances are correctly connected to the Orchestrators:  \n\n-   An orchestrator with an odd member ID should be plugged into an odd Security Appliance's NIC port.\n-   An orchestrator with an even member ID should be plugged into an even Security Appliance's NIC port.\n\nFor example:  \n_ethsBP1-01 to Orchestrator X\\_1_  \n_ethsBP1-02 to Orchestrator X\\_2_  \nIf the Security Appliances are not plugged in correctly, the HCP will provide the user with instructions on how to do so. |\n|                HCP-641                 | **NEW:** A new test was added to verify if the hardware can recognize the ASIC. If the Orchestrator goes beyond the temperature limit, it triggers an automatic shutdown of the electricity supply to the ASIC to safeguard it.  \nIf this happens, the HCP will prompt the user to unplug and plug back the corresponding Orchestrators to restore the electricity flow to the ASIC. |\n|                HCP-779                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    **NEW:** Added new IoT Protect tests for verification of IoT pre-requisites/onboarding, IoT discovery and IoT enforcement flows.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|   **Update 13 - Take 61 (17 July 2023)**   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 **Update 13 - Take 61 (17 July 2023)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                HCP-670                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       **NEW:** Added a new CoreXL Affinity test, it checks that affinity configuration does not link any fw instance to all CPUs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                HCP-731                 | **UPDATE:**\n\n-   On Scalable Platforms, HCP will now run on all members by default.\n-   The \"_\\-L_\" flag is added to run on a local member only. |\n|                HCP-689                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      **UPDATE:** The Bond Health test is enhanced to cover the slaves actor \"_system mac address_\".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                HCP-666                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              **UPDATE:** Added the CPU _io/sys/usr_ charts.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-597                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       **UPDATE:** Reduced the Performance section tests runtime.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|                HCP-633                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     **NEW:** Added a new test, which checks the IFI process status.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                HCP-729                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      On R80.20SP, during the CPView tests, HCP may get stuck.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                HCP-720                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        The CoreXL test on VSX has a false positive failure.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n|                HCP-598                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      WebUI may become unresponsive after running the User Space Processes Affinity Check test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-718                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              The multi-queue test is passed in User Space Mode (UPPAK), even if the traffic is not balanced among interfaces, although it should not.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-710                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             When VMAC mode is used with an interface running the i40e driver and the \"_disable-source-pruning_\" flag on the interface is off, traffic may disappear and cause arp issues.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                HCP-717                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     The Updatable Objects test fails with an exception when _dnd\\_loader\\_state.C_ does not exist.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-715                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         The MTU test fails with an exception if one SSM is detached from Scalable Chassis.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                HCP-688                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                The Memory test fails with an exception when running it simultaneously in different remote sessions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                HCP-683                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               HCP fails to run with \"_\\-m all_\" flag when one of the Scalable Platform members is not in Active state.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                HCP-676                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        The MTU test fails on Magg if MTU is less than 1500.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n|                HCP-667                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        HCP fails on Scalable Platforms with an exception when running with the \"_\\-m_\" flag while some members are not active.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|                HCP-663                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   The _fwkern.conf_ test reports inconsistency between kernel and config value for SIM parameters.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|                HCP-644                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          The Daemons test may not verify all the daemons.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                HCP-643                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             The Static Affinity test may fail when there is more than one FWD process.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n|                HCP-635                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       The VSX Database test may fail on VSW (Virtual Switch).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                HCP-631                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            The SSD Smart Health test fails on NVMe SSD.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                HCP-618                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         There is no connectivity between User Center and the Multi-Domain Security Server if proxy is configured in Clish.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|   **Update 12 - Take 59 (1 March 2023)**   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 **Update 12 - Take 59 (1 March 2023)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                HCP-475                 | **NEW:** It is now possible to schedule a cron job on Security Management Server, which sets HCP to run and collect the reports from all connected Security Gateways.\n\nTo do so, run in Gaia Clish on the Management Server:  \n_\"add cron job HCP\\_night\\_run command 'bash -l /etc/hcp/source/cron/cron\\_hcp\\_collect\\_reports.sh' recurrence daily time HH:MM\"_\n\nTo change job name and recurrence, use regular \"_set/show cron_\" commands. |\n|                HCP-570                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          **NEW:** Added a test to verify the integrity of VSX configuration in Gaia database.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                HCP-575                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     **NEW:** Added the \"_hcp --run-on-remote <gw\\_name/all>_\" command which allows to run HCP on a remote Security Gateway from the Security Management Server shell.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                HCP-130                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            **NEW:** The License Verification tool is integrated into HCP. To enable the tool, follow the steps in sk180447.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                HCP-279                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               **UPDATE:** The Bond Health test is enhanced with LACP state verification.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                HCP-550                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           **UPDATE:** Added the \"Timestamp\" column to the Pattern Match (PM) spikes table in the Pattern Matcher Impact Test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                HCP-615                 | **UPDATE:**\n\n-   Added the Syslog Timestamp test.\n-   The \"Verify log messages\" timestamp is now compliant with the system time. |\n|                HCP-627                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               **UPDATE:** Added Hardware Compatibility notifications. Refer to sk180572.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                HCP-613                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          The Software Version test fails because of inconsistency of _HOTFIX\\_CHARON\\_HF_ between Scalable Platforms members.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                HCP-584                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                The Protections Impact test may cause the \"_RecursionError_\" exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                HCP-604                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    The _httpd-ssl.conf.templ_ file is corrupted after an upgrade.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                HCP-622                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        HCP may be inconsistent and fail with an exception when running it on Scalable Platforms members with the \"_\\-m_\" flag.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|                HCP-587                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            HCP running on Security Management Server fails to get the last report from the Secondary Security Management Server or from the Log Server.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                HCP-544                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        The Interface Errors test may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|   **Update 11 - Take 58 (18 Sep 2022)**    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **Update 11 - Take 58 (18 Sep 2022)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                 HCP-6                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    **NEW:** Added a test that checks if tables reached their limits.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|                HCP-510                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              **NEW:** Added the \"--domain\" option to collect reports for a single domain.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-531                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          **NEW:** Added the Feature compatibility - VSX test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                HCP-530                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        **NEW:** Added the \"_snmp configuration_\" option for the Feature compatibility - VSX test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n|                HCP-517                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Updated the Feature Compatibility test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-499                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              SmartConsole may not provide the HCP report for a cluster member object.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-504                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         The URL Filtering test may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                HCP-500                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    The VSX Hardware Utilization test may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|                HCP-502                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Improved the SSD Health test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|                HCP-511                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              The ICA test may fail false positive on a Multi-Domain Log Module (MLM).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-518                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            The Distribution test may incorrectly pass if the \"_dxl stat_\" command failed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                HCP-522                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      The Templates Efficiency test may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-543                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   The MTU test may fail with an exception in an MDPS environment.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n|   **Update 10 - Take 57 (20 Jun 2022)**    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **Update 10 - Take 57 (20 Jun 2022)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                 HCP-66                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             **NEW:** Added a test that checks whether the hardware is utilized efficiently.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                HCP-264                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          **NEW:** Added a test to verify the SSD SMART health.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                 HCP-72                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          **UPDATE:** Added a section in the report which displays installed software versions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                HCP-460                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           **UPDATE:** The Local Logging Monitor Test will now check for failures in the past.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                HCP-462                 | **UPDATE:**\n\n-   Major improvement in test loading time on VSX systems.\n-   Changed the \"_hcp -l_\" output table. It will now display all tests except the tests disabled in configuration. |\n|                HCP-431                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               The \"_Failed creating HTML report_\" error is displayed after running HCP.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-433                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          The output table of the Scalable Platforms Features Compatibility Test is broken.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                HCP-440                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Running the \"_hcp -v_\" command in the VS context does not show the HCP Take number.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                HCP-441                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Running the \"_hcp --show-last-full_\" command in the non-VS0 Virtual System context may fail with an error message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                HCP-442                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 The Software Provision Test incorrectly reports about missing AUTOUPDATER packages on some members.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                HCP-443                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      The MSG VLAN Consistency Test may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-450                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             The MTU test may fail with an exception related to some bridge interfaces.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n|                HCP-457                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    The HCP Section icon in the report is not updated correctly.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                HCP-464                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Virtual System interfaces may be missing in the topology tab of a generated report.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n|                HCP-466                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Some tests may be shown in the status \"Skipped\", when running the \"_hcp --show-last\"_\" command with the \"_only-failed_\" flag.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-471                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   HCP SmartConsole Extension cannot fetch the VSX Cluster report.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n|                HCP-458                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   HCP SmartConsole Extension cannot fetch the Log Server report.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|    **Update 9 - Take 55 (30 May 2022)**    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **Update 9 - Take 55 (30 May 2022)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n|                HCP-415                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            **UPDATE:** Protections Impact test now collects real time PM statistics, and matches protections with the same LSS as the critical protections.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                HCP-295                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         The Connection Distribution test may collect distribution statistics from a wrong source because of a CPView issue.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n|                HCP-375                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Arrows in the Topology tab may be missing.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n|                HCP-404                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              WTS may not show any cluster state event.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n|                HCP-423                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              MDPS is listed as an unsupported version.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n|                HCP-426                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        The Static Affinity Test may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n|                HCP-427                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     The Memory Usage Test may show an abnormally large command.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                HCP-428                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Loading an HTML page with the Maestro Orchestrator report may fail.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                HCP-453                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          The Dynamic Objects Database Test may be executed on the Maestro Hyperscale Orchestrator (MHO) and the Management Servers although it should not.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|    **Update 8 - Take 52 (07 Mar 2022)**    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **Update 8 - Take 52 (07 Mar 2022)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n|                HCP-332                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       **NEW:** The \"_hcp -r all_\" report will now automatically include topology, WTS, and charts, no additional flags are needed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|                HCP-374                 | **NEW:** Added new flags to modify HCP default behavior.  \nSome tests or products can be disabled/enabled:\n\n-   \\--disable-test\n-   \\--enable-test\n-   \\--disable-test-file\n-   \\--enable-test-file\n-   \\--disable-product\n-   \\--enable-product\n-   \\--show-disabled-tests\n-   \\--set-performance-impact\n\nNote: The \"performance-impact\" configuration will persist after running the command. |\n|                HCP-164                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   **NEW:** Added a new test to check if any debug flags are enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|                HCP-237                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        **NEW:** Added an optional flag \"_\\--only-failed_\" for \"_\\--show-last-full_\" and \"_\\--show-last_\" to represent only tests with a status not equal to \"Passed\".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n|               SWSCFG-132               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    **NEW**: Added an HCP test to validate if interface errors are present. If any errors are detected, possible solutions will be provided based on the error type.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                HCP-225                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **UPDATE:** The \"_hcp -l_\" command output is now displayed as a table.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n|                HCP-378                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              **UPDATE:** The \"_hcp -l_\" and \"_hcp -r_\" commands will now load the test faster.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n|                 HCP-87                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            There may be a wrong timestamp in the report.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|                HCP-167                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Added verifications of _fwkern.conf_ file according to sk149412.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|                HCP-218                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     The user cannot open the HCP report of the Management Server from SmartConsole because of the wrong UID in the report file.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                HCP-328                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 The FW Configuration File Sanity test may fail on valid parameters.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                HCP-240                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      The \"_hcp --show-last-full_\" command takes several minutes to represent very large reports.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-333                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 The WTS report is not generated correctly, a “_Failed to generate WTS report_\" message is displayed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                HCP-343                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               When running HCP with the -f flag, a JSON encode/decode error is shown.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-345                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            The \"_hcp --ext-update-reports <gw\\_name>_\" command may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|                HCP-368                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     The IDA Sharing Mechanism test may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-370                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    The \"_hcp --ext-update-reports all_\" command collects reports only from the first 50 Gateways.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                HCP-373                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        The SecureXL Status test may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n|                HCP-377                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  _Autoupdatercli_ fails to install HCP on R80.20 Scalable Platforms.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                HCP-380                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           The Core Dumps test may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|    **Update 7 - Take 49 (17 Jan 2022)**    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **Update 7 - Take 49 (17 Jan 2022)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n|                HCP-260                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     **NEW:** Added a test to validate Software Provision across Scalable Platforms cluster members.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                HCP-291                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      **NEW:** Added HCP version and Take number to the HCP report.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-324                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        **NEW:** Threat Prevention Heavy Connections test now shows 10 most loaded connections and connections load per instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n| HCP-325,  \nHCP-187 | **NEW:** Added 2 new tables to the Memory Usage test:\n\n-   user space consumption per virtual system\n-   total consumption per process (aggregated by name) |\n|                HCP-219                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          **NEW:** Added a test to check if the ICA certificate expires in less than a year/already expired. Refer to sk158096.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                HCP-318                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       **UPDATE:** The Processes Memory test was removed. It is now part of the Memory Usage test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                HCP-292                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Transceiver EEPROM data may cause an exception in HCP test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                HCP-297                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  In some scenarios, in a Scalable Platforms VSX environment, HCP may show an exception on test with Global Result option enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n|                HCP-299                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Cluster members may appear twice in the test result.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n|                HCP-303                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Some zombie processes may not be detected by HCP test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|                HCP-307                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        The SIC test output appears twice in the test result.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|                HCP-308                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             The CPView test may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                HCP-314                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      The Topology graph may fail to generate on systems with numbers or a dot (.) in the name.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-317                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          The Transceiver test may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                HCP-342                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      The IDA Tables Mismatch test may fail with an exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|  **Update 6 - Take 48 (9 November 2021)**  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                **Update 6 - Take 48 (9 November 2021)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                HCP-210                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             **NEW:** Added to the Dmesg Errors test to handle the \"_stalls on CPU_\" messages.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                HCP-209                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     **NEW:** Added the Bond Health test which validates that there are no slaves with different aggregator id under the same bond.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-211                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   **NEW:** Added ports link integrity test for Maestro Orchestrator.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|                HCP-160                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 **UPDATE:** An error message will be displayed when trying to view report for the Security Management Server if the last report does not exist on the Security Gateway.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                 HCP-61                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              On VSX systems, the Topology graph of HCP report either does not display or shows incorrect information.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-230                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           In some scenarios, the IDA Tables Limit test takes more than 5 seconds to run.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|                HCP-206                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               In some scenarios, the SecureXL Status test shows status \\[_EXCEPTION_\\].                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                HCP-224                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         In some scenarios, the SIC test may be skipped the Security Gateway connected to a Multi-Domain Management Server.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                HCP-223                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             The \"_hcp --ext-update-reports all_\" command is not working properly on Multi-Domain Management environment.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n|                HCP-208                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     The \"FW Configuration File Sanity\" report raises exception on some appliances like 16600t.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-214                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            HCP \"Core Dumps\" may crash if there are broken headers in core dump archive.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                HCP-207                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           The Feature Compatibility test may fail when \"_smo image auto-clone_\" is enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                HCP-205                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         In some scenarios, SmartConsole fails to open reports from the Management machine.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|  **Update 5 - Take 46 (20 October 2021)**  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                **Update 5 - Take 46 (20 October 2021)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                HCP-151                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                **NEW:** Added perf reports summary table to the CPU spikes performance test (listing top functions and processes during latest spikes).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                HCP-158                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           **NEW:** Added HCP test to verify the IPv4 forwarding flag on FireWall interfaces.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|                HCP-106                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **NEW:** Added HCP test to verify MTU values on FireWall interfaces.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n|                 HCP-30                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **NEW:** Added basic filters and date navigation to What's The Story.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                HCP-153                 | **NEW:**\n\n-   Added hostname and date to the report file name\n-   Added purge ability to delete old reports (archive are saved up to 10, and last reports the last one only). |\n|                HCP-198                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      **NEW:** Added new Threat Prevention Heavy Connections test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                HCP-192                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      **NEW:**Added new Threat Prevention tests to automate and improve the investigation of Threat Prevention performance issues.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                HCP-202                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      **NEW:** Added the Threat Prevention protections impact test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                HCP-163                 | **NEW:** Added 3 new tests to the HCP tool:\n\n1.  \"IDA tables instances mismatch\" - To check the number of mismatches between Identity Awareness kernel tables instances.\n2.  \"IDA tables limit\" - For each Identity Awareness kernel table, to make sure the peak value is approaching the limit.\n3.  \"IDA tables mismatch\" - To check the number of mismatches between Identity Awareness kernel tables. |\n|                HCP-193                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    In some scenarios, the connectivity to User Center may fail.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                 HCP-50                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Improved the loading time of What's The Story events.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|                HCP-107                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Local Logging test may fail even when remote logging setup is configured correctly.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |\n|                HCP-166                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 The _hcp.elg_ log file may show exceptions on some tests even if they did not run on the environment.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                HCP-149                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Typo in the Transceivers test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |\n|                 HCP-38                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              When running HCP with custom VS \"-c\" flag, the VS number is displayed incorrectly in SmartConsole report.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n|                HCP-162                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            HCP does not display a message when What's The Story does not contain events.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|                HCP-150                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 In some scenarios, the File Descriptors test fails with exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                HCP-168                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           In some scenarios, after running HCP fails with error related to cpdiag stats.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|                HCP-188                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Disabled WTS (What's The Story) and Topology when the specific test runs, unless specifically indicated that it should run WTS / Topology.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n|   **Update 3 - Take 44 (13 June 2021)**    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **Update 3 - Take 44 (13 June 2021)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                 HCP-24                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                **NEW:** Added timestamp to HTML report.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                 HCP-16                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       **NEW:**Added the Transceiver Verifier test that checks that transceivers attached to appliances interfaces are supported.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |\n|                 HCP-82                 | **NEW:**Added a new CSV file to allow CPDiag to collect statistics for:\n\n-   Number of times the HCP ran in this environment\n-   Passed tests\n-   Failed tests\n-   Tests score |\n|                 HCP-67                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **NEW:** Added a new test to examine the SIC status between Security Management and Security Gateway.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                HCP-108                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    **NEW:** Added event of SNMP send failure to Scalable Chassis modules to WTS (What's The Story).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                 HCP-93                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    **NEW:** Added a new test that checks Gaia database performance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                 HCP-70                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             **NEW:**Added Support for HCP Extension on MDS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n|                 HCP-76                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            **UPDATE:**Search functionality in the HTML report is now under WIP and disabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|                 HCP-29                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            **UPDATE:**Added the Threshold column to CPView.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                 HCP-26                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             **UPDATE:**WTS (What's The Story) will be displayed the HTML report by default.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                HCP-100                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            **UPDATE:** Errors previously printed on the screen while tests are running will be printed to the _hcp.elg_ file.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                HCP-117                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               **UPDATE:**HCP test will alert about custom applications with signatures that may cause performance impact.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                 HCP-48                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           **UPDATE:** Help message is now displayed if the incorrect command syntax entered.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|                HCP-119                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           **UPDATE:** The Local Logging test is now disabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                HCP-128                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                **UPDATE:** Added ability to run the _fwkern.conf_ sanity test on each VS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                 HCP-68                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               SecureXL status is missing in HCP test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|                 HCP-78                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      When running HCP with the wrong \"-c\" parameter, unnecessary blank HTML report is created.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                 HCP-64                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                The _gexec_ command has a different default timeout value than _hcpexec_.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                 HCP-96                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Added more information to compatibility check of Forward Error Correction (FEC) feature.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                 HCP-97                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  The local logging test fails when a backup server is configured.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n|                 HCP-98                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                The Distribution test does not run from the Scalable Chassis Monitor.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                 HCP-53                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Added core dumps information to WTS (What's The Story).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                 HCP-43                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Cannot move between VSs in ARP CACHE limit test.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                 HCP-47                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Charts tab time shows incorrect time.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                 HCP-71                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  The SIM Configuration File Sanity test may fail to find the kernel parameter although it exists.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n|                 HCP-89                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Long words in the HCP test reports may cause overflow to adjacent table columns.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n|                 HCP-79                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             Added cosmetics fix to MSG Vlans consistency test: replace between the result table titles and add new line at the end of each missing VLAN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |\n|                 HCP-77                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         The Kernel Crash test shows \"PASSED\" although there are existing cores dump files.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                HCP-129                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  In some scenarios, the Static Affinity Test fails with exception.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                HCP-131                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Scalable Platform Clients with ZETCLIENT process is shown as terminated and the Check Point Processes test status displays \"ERROR\".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|   **Update 2 - Take 29 (18 March 2021)**   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 **Update 2 - Take 29 (18 March 2021)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |\n|                 HCP-18                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            **NEW:** Added the Memory Usage (RAM) test, which analyzes the different memory sections and their current usage.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|                 HCP-12                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            **NEW:** Added a compatibility test of configured features in Scalable Platform environments (based on sk148074).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |\n|                 HCP-15                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          **NEW:**Added _\\--v / -version_ argument to display the Take number / RPM build of HCP.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                 HCP-11                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     **NEW:** Added ability to see a back trace of core dump files.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |\n|                 HCP-20                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       **NEW:** Added a new test that verifies that the distribution configurations between local members and SSMs are consistent.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |\n|                 HCP-13                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  **NEW:** Added a new test that confirms that logs are being written to a Log Server and not locally.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |\n|                 HCP-21                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 **NEW:**Added the Bond test and Corexl Status on VSX performance tests.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |\n|                 HCP-1                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Running HCP on remote members using the \"-m\" flag is not available in Maestro environments.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |\n|                 HCP-23                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Tests that are supposed to run only in Scalable Platform run in all environments.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|                 HCP-17                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               The FW kern sanity test may fail when using parameter from type \"uint\".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n| **Update 1 - Take 24 (18 February 2021)**  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                **Update 1 - Take 24 (18 February 2021)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |\n|                 ODU-81                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Initial Release                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |\n","language":"md","time":"14 days ago","created":"2025-05-06T22:56:19.745Z","annotations":[],"updated":"2025-05-06T23:00:01.486Z"},{"title":"ProductQuantum Security Gateways","id":"bd591972-292c-43c1-aac1-b48ea658b1dd","type":"TEXT","raw":"ProductQuantum Security Gateways\n\nVersionR80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-02-20\n\n## Solution\n\n**Table of Contents:**\n\n-   Introduction\n    \n-   Motivation\n    \n-   Security Gateways and the USFW state\n    \n-   Best Practices\n    \n-   Changing the CoreXL Firewall Mode\n    \n-   Known Limitations\n    \n-   Firewall USFW / KSFW modes and SecureXL KPPAK / UPPAK modes\n    \n\n### Introduction\n\nUser Space Firewall (USFW) is the infrastructure in which Check Point Firewall instances run in user space mode.\n\n**Note** - In VSX Gateways, USFW is the only Firewall mode available.\n\n### Motivation\n\n-   Improved memory utilization on Security Gateways with many CPU cores.\n-   Improved debugging tools and newly supported features.\n\n### Security Gateways and the USFW state\n\n> **Notes:**\n> \n> 1.  Check Point appliance models that do not appear in the table above, support USFW, but it is disabled by default (CoreXL Firewall instances run in the Kernel Space).\n> 2.  Starting in R81.20, CloudGuard Network Security Gateways have USFW enabled by default.\n> 3.  The FWD process is isolated and affined to a dedicated CPU core, when running in USFW on an appliance with at least 20 CPU cores.  \n>     In other cases (KSFW, or less than 20 CPU cores), the FWD process is affined to all CPU cores.\n> 4.  On Check Point 23500 appliances, USFW was enabled by default in R80.30 3.10. It is supported, but is disabled by default in later versions.\n\n### Best Practices\n\n> Use the factors listed below to select the best CoreXL Firewall mode for your Security Gateway - User Space (USFW) or Kernel Space (KSFW):\n> \n> <table><tbody><tr><td>Factor</td><td>Testing command</td><td>Recommended<br>Firewall<br>mode</td></tr><tr><td>80% or more of the traffic undergoes the Fast / Accelerated path</td><td><code>fwaccel stats -s</code></td><td>KSFW</td></tr><tr><td>70% or more of the traffic undergoes the Firewall / Slow path</td><td><code>fwaccel stats -s</code></td><td>KSFW</td></tr><tr><td>30% or more of the traffic undergoes the PXL / Medium path</td><td><code>fwaccel stats -s</code></td><td><strong>USFW</strong></td></tr><tr><td>Security Gateway is configured with more CoreXL SND instances than CoreXL Firewall instances,<br>or when CoreXL SND instances are the bottleneck</td><td><code>fw ctl affinity -l -r</code></td><td>KSFW</td></tr><tr><td>Security Gateway is configured with more than 38 CoreXL Firewall instances</td><td><code>fw ctl affinity -l -r</code></td><td><strong>USFW</strong></td></tr></tbody></table>\n> \n> For information about traffic paths, refer to [sk153832 - ATRG: SecureXL for R80.20 and higher](https://support.checkpoint.com/results/sk/sk153832#TOC02) > section \"SecureXL Definitions\".\n\n### Changing the CoreXL Firewall Mode\n\n> -   To change the Firewall mode in versions R81.10 and higher:\n>     \n> -   To change the Firewall mode in versions R81, R80.40, and R80.30, [contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/).\n>     \n\n### Known Limitations\n\n> <table><tbody><tr><td>Known Limitations</td><td>Description</td><td>Affected versions</td><td>Mitigation</td></tr><tr><td>Large Scale VPN (LSV)</td><td>Large Scale VPN suffers from latency that results in disconnections of VPN clients</td><td>R80.40<br>and<br>R80.30 3.10</td><td>For R80.40:<br>Use the latest R80.40 Jumbo Hotfix<br>If the issue persists, <a href=\"https://www.checkpoint.com/support-services/contact-support/\" target=\"_blank\" rel=\"noopener\">contact Check Point Support</a><p>For R80.30 3.10:<br><a href=\"https://www.checkpoint.com/support-services/contact-support/\" target=\"_blank\" rel=\"noopener\">Contact Check Point Support</a></p></td></tr><tr><td><p>Cannot change the Firewall mode from USFW to KSFW on a Security Gateways:</p><ul><li>With fewer than 40 CPU cores</li><li>With HyperThreading enabled</li></ul></td><td>A crash occurs during boot after you changed the Firewall mode from USFW to KSFW and rebooted, while the HyperThreading is enabled</td><td>R80.30 3.10</td><td>Disable Hyper Threading before changing the mode from USFW to KSFW</td></tr><tr><td><p>Cannot change the Firewall mode from USFW to KSFW on Security Gateways:</p><ul><li>With more than 40 CPU cores</li><li>With HyperThreading disabled</li></ul></td><td>A crash occurs during boot after you changed the Firewall mode from USFW to KSFW and rebooted, while the HyperThreading is disabled</td><td>R80.40<br>and<br>R80.30 3.10</td><td>Changing the Firewall mode is not supported in this scenario</td></tr><tr><td><p>CloudGuard Network Security Gateways do not support USFW in versions R81 and lower.</p></td><td></td><td>R81<br>and<br>R80.40<br>and<br>R80.30&nbsp;3.10</td><td>USFW is not supported in this scenario</td></tr></tbody></table>\n\n### Firewall USFW / KSFW modes and SecureXL KPPAK / UPPAK modes\n\n> For information about SecureXL KPPAK / UPPAK modes, refer to [sk153832 - ATRG: SecureXL for R80.20 and higher](https://support.checkpoint.com/results/sk/sk153832#TOC05) > section \"SecureXL Modes - KPPAK and UPPAK\".\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorYuval Jacob\n\nTechnical ResourceShai Shabat\n\nAccess LevelGeneral\n\nStatusApproved by TAC\n\nDate Created2020-05-24\n\nLast Modified2025-02-20\n\nEditorSergei Shir\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only\n\nThis SK applies to R82.10 as well\n\n### This SK should NOT be removed - referenced in documentation R81.10 and higher and in source code\n\n### Switching between Firewall modes in R81.00 and lower versions\n\n> Customers must not change the Firewall mode from USFW to KSFW without a good reason.\n> \n> If a large part of the traffic is F2F, and it causes degradation in USFW, you must understand the reasons for F2F. Contact R&D (Shai Shabat, Anan Kays).\n\n**To get the current Firewall mode, run these commands in the Expert mode:**\n\n> <table><tbody><tr><td>Procedure</td><td>Instructions</td></tr><tr><td>Recommended</td><td><p>Run these commands in the Expert mode:</p><ol><li><em>cpprod_util FwIsUsermode</em></li><li><em>cpprod_util FwIsUsfwMachine</em></li></ol><p>Possible output:</p><ul><li>0 - KSFW</li><li>1 - USFW</li></ul></td></tr><tr><td>Optional</td><td><p>Run this command in the Expert mode:</p><p><em>ps aux | grep -E \"PID|fwk\"</em></p><p>If the output shows both the \"<em>fwk_forker</em>\" <strong>and</strong> \"<em>fwk_wd</em>\" processes, then the Security Gateway runs in the USFW mode.</p><p>Example:</p><blockquote><pre>[Expert@GW:0]# ps aux | grep -E \"PID|fwk\"\n> USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\n> admin     5617  0.0  0.0   2652   572 pts/2    R+   18:07   0:00 grep --color=auto -E PID|fwk\n> admin    10304  0.0  2.2 204216 177468 ?       SLs  Dec02   0:00 <span>fwk_forker</span>\n> admin    10313  0.0  0.1  46592  9200 ?        Ss   Dec02   0:28 <span>fwk_wd</span> -i 3 -i6 0\n> admin    10321  0.6  7.3 1789464 582708 ?      S&lt;Ll Dec02  21:36 fwk\n> [Expert@GW:0]#\n> </pre></blockquote></td></tr></tbody></table>\n\n**To configure the KSFW mode, run these commands in the Expert mode:**\n\n> **Important** - In Maestro, KSFW is supported only in R81 and higher versions.\n> \n> 1.  _cpprod\\_util FwSetOverrideMode 1_\n> 2.  _cpprod\\_util FwSetUsermode 0_\n> 3.  _cpprod\\_util FwSetUsfwMachine 0_\n> 4.  _reboot_\n\n**To configure the USFW mode, run these commands in the Expert mode:**\n\n> 1.  _cpprod\\_util FwSetOverrideMode 1_\n> 2.  _cpprod\\_util FwSetUsermode 1_\n> 3.  _cpprod\\_util FwSetUsfwMachine 1_\n> 4.  _reboot_\n\n**23000 Support Question:**  \n**Why does 23000 default show USFW is disabled?**\n\nPer R&D (Shai), In general, before we move all appliances to USFW by default, we worked in a method that – USFW will be enabled only for new appliances (aka, lines that were released after USFW was GA).\n\n23500 is not part of that, it was released before that, as such, it was supposed to run in KMFW.\n\nIn R80.30 there was a bug that prevented this machine to load in kernel mode (static memory was too high and caused the OS to failed loading all instances).\n\nAs USFW does not suffer from this bug, we released it in USFW.\n\nIn R80.40, the memory issue was fixed and machine was able to load in kernel mode, as our method was to keep old machines in kernel mode, we moved it back to kernel mode.\n\nHope that was clear – bottom line, there was no issue in USFW, that was just a way to mitigate a problem we had for that machine","language":"md","time":"14 days ago","created":"2025-05-06T22:56:17.489Z","annotations":[],"updated":"2025-05-06T23:00:01.196Z"},{"title":"R82: Check Point's major software release for Quantum products, CloudGuard Network Security","id":"3b73e275-3b3c-4c50-92ca-98007174695b","type":"TEXT","raw":"**R82** is Check Point's major software release for Quantum products and CloudGuard Network Security. It introduces 50 innovative capabilities to strengthen threat prevention, greatly streamline operations and provisioning, and troubleshoot network connections with integrated diagnostics tools.\n\nThis release provides access to new AI-powered threat prevention engines that strengthen defense against zero-day phishing, brand spoofing, malware, and more. R82 also adds DNS protection against NXNS, offers DNS configuration granularity, and supports DNS-over-HTTPS Inspection.\n\nCheck Point offers the industry's first complete protection for HTTP/3 over QUIC. R82 also enables effortless and automated HTTPS Inspection deployment with granular controls and exceptional performance.\n\nCheck Point's VSX has a new versatile mode (VSNext) that unifies management features and APIs across Virtual Systems and physical Security Gateways. Furthermore, cluster management is greatly simplified with a new page in Gaia Portal and a new mode (ElasticXL) that enables Security Gateway clustering without the need for physical Orchestrators.\n\nIn addition, R82 introduces a new version of Check Point's operating system with superior networking and routing capabilities. For automation, users and DevOps teams can now execute API calls directly to security gateways through a new dynamic policy layer. For future-proofing, R82 enables NIST-approved Kyber (ML-KEM) encryption to protect today’s VPN traffic against future quantum computing-based hacking.\n\nThese are just some of the powerful new capabilities in R82.\n\n     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk181127/ThreatPrevention202409191357592.png)    Threat Prevention\n\n> ### AI-based prevention engines\n> \n> Check Point's new AI security engines represent a shift in how we utilize data, transitioning from mostly a single indicator perspective to a multi-dimensional approach.\n> \n> -   [**ThreatCloud Graph**](https://blog.checkpoint.com/security/introducing-threatcloud-graph-a-multi-dimensional-perspective-on-cyber-security/) - Leverages ThreatCloud AI knowledge base to form relationship graph, identifying attacks patterns to prevent zero-day threats.\n> -   **Kronos** - Inspects behavior over time with AI and signal processing algorithms to detect malicious activity, preventing zero-day C2, phishing campaigns and other threats.\n> -   [**Deep Brand Clustering**](https://blog.checkpoint.com/security/deepbrand-clustering-an-evolution-in-brand-spoofing-prevention/) - Prevents zero-day brand phishing campaigns with a patent-pending unsupervised deep learning engine. This engine cluster websites into local and global brands and determine whether it’s an attack.\n> -   **Dynamic classification of uncategorized websites** \\- An AI-based engine for dynamic classification of websites, accurately categorizing URLs to block previously uncategorized dangerous or inappropriate websites.\n> \n> ### Improved DNS Security Capabilities\n> \n> This release provides new and enhanced DNS security capabilities with the addition of:\n> \n> -   **Advanced DNS protection against Non-Existent Domain (NXNS) Attack**.\n> -   **Support for DNS over HTTPS (DoH) protocol**.\n> -   **[Configuration Granularity](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ThreatPrevention_AdminGuide/Default.htm#cshid=ID001)** \\- Advanced DNS Security settings in the Threat Prevention profile. \n> -   **Detailed DNS Security statistics** - Now available in the SmartView Dashboard.\n> \n> ### Automatic Security Services Configuration\n> \n> Zero Phishing, Anti-Virus, Anti-Bot and IPS Software Blades are now more accessible, providing a simpler and easier user experience.\n> \n> -   Zero Phishing Software Blade - Introducing a new [**Automatic mode**](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ThreatPrevention_AdminGuide/Default.htm#cshid=ID003) that significantly simplifies the configuration process, providing a seamless experience. With the Automatic mode, the Software Blade configuration is now effortless: simply enable the Software Blade and you are ready to go. \n> -   The Anti-Virus and Anti-Bot Software Blades are now [activated by default](https://support.checkpoint.com/results/sk/sk182106) in newly created Security Gateway and Cluster objects. See sk182106. \n> -   It is now possible to [automatically load and update](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ThreatPrevention_AdminGuide/Default.htm#cshid=ID005) SNORT rules file as Custom Intelligence Feed and enforce them as new IPS protections. \n> \n> ### Web Security\n> \n> -   Added support of HTTP/3 protocol over QUIC transport (UDP) for Network Security, Threat Prevention, and Sandboxing.\n> \n> ### HTTPS Inspection\n> \n> This release [sets a new standard](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SecurityManagement_AdminGuide/Default.htm#cshid=ID004) with breakthrough performance, unmatched simplicity, and effortless deployment of HTTPS Inspection. Now, you can significantly increase your security without sacrificing speed or user experience. Embrace cutting-edge technology that transforms HTTPS Inspection into a seamless, innovative solution, ensuring your systems stay secure and your users stay satisfied.\n> \n> -   **Enhanced HTTPS Inspection UI** - HTTPS Inspection is fully managed in SmartConsole.\n>     -   **Enhanced HTTPS Inspection policy** - A dedicated policy for inbound inspection, including certificate management views for both inbound and outbound policies and enhanced default outbound policy.\n>     -   **Trusted CA package** - A new view to manage Trusted certificates and see the status of the trusted CA package.\n>     -   **HTTPS Inspection Advanced settings** - A new view to configure advanced settings, including R82 new features.\n> -   **Client Side Fail mode** - This new feature automatically detects failures in inspected TLS connections caused by client-side issues, such as certificate-pinned applications. When a failure is detected, the connection is flagged to be bypassed in future attempts, and Artificial intelligence (AI) learns from these failures to identify similar connections.\n>     -   **Endpoint Detection** - Identifies endpoints without deployed outbound CA certificate.\n> -   **Learning mode**:\n>     -   **Gradual & Smart deployment** - Activated during the deployment of HTTPS Inspection, inspecting a minor percentage of traffic over two weeks.\n>     -   **Network Learning** - Gathers insights into network behavior and detects potential connectivity issues for Artificial intelligence consideration.\n>     -   **Performance Prediction** - Estimates the impact on performance when HTTPS Inspection is fully implemented.\n> -   **Bypass Under Load** - Bypasses TLS connections when the Security Gateway experiences high CPU load.\n> -   **HTTPS Inspection monitoring** - Introducing the HTTPS Inspection statistics view in SmartView, including bypass/inspect statistics.\n\n___\n\n     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk170416/security_gateway_and_gaia202106131341411.png)    Quantum Security Gateway\n\n> ### New Clustering Technology\n> \n> -   [**ElasticXL**](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ScalablePlatforms_AdminGuide/Default.htm#cshid=ID001) - a new clustering technology delivering simplified operations with a Single Management Object and automatic sync of configuration and software between all cluster members.\n> \n> ### Dynamic Policy Layer\n> \n> -   [Fully automated, API-controlled policy layer](https://support.checkpoint.com/results/sk/sk182252) that allows dynamic policy changes to be implemented directly on the Security Gateway in seconds without involving Security Management or installing Security Policy.\n> \n> ### Identity Awareness\n> \n> -   Quantum Gateways can now use [multiple external Identity Providers](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_IdentityAwareness_AdminGuide/Default.htm#cshid=ID001) defined in the Check Point Infinity Portal, providing a cross product unified identity management.\n> -   Improved resiliency in case of connectivity loss to the PDP by adding [new Identity Cache Mode for Identity Sharing protocols](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_IdentityAwareness_AdminGuide/Default.htm#cshid=ID002).\n> \n> ### IPsec VPN\n> \n> -   Added support for ML-KEM (Kyber768) as required by the FIPS 203 standard to address [Post-Quantum Cryptography](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SitetoSiteVPN_AdminGuide/Default.htm#cshid=ID001) (PQC).\n> -   [Automatically detect configuration changes](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SitetoSiteVPN_AdminGuide/Default.htm#cshid=ID002) in AWS, Azure, and GCP public clouds and adjust the VPN settings ensuring connection stability.\n> -   Introducing the [Advanced VPN Monitoring tool](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SitetoSiteVPN_AdminGuide/Default.htm#cshid=ID003) that shows information on each VPN Tunnel and tracks its health and performance.\n> -   [Enhanced Link Selection](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SitetoSiteVPN_AdminGuide/Default.htm#cshid=ID004):\n>     -   Interoperability:\n>         -   Uses public IP addresses as tunnel identifiers to establish separate tunnels for each link.\n>         -   Uses Dead Peer Detection (DPD) as the link probing protocol instead of the proprietary \"Reliable Data Protocol\" (RDP).\n>     -   Redundancy:\n>         -   Allows redundancy of VPN tunnels including third-party and native cloud VPN peers.\n>     -   Granularity:\n>         -   Ability to configure the Security Gateway to use different VPN interfaces in different VPN communities.  \n> \n> ### Remote Access VPN\n> \n> -   Security Gateway now [supports the IKEv2 protocol](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_RemoteAccessVPN_AdminGuide/Default.htm#cshid=ID002) for connections from Remote Access VPN Clients (E88.40 and higher).\n> \n> ### Mobile Access\n> \n> -   Mobile Access Policy and Capsule Workspace configurations are [now available](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_MobileAccess_AdminGuide/Default.htm#cshid=ID001) in SmartConsole. \n> -   [SAML authentication support](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_RemoteAccessVPN_AdminGuide/Default.htm#cshid=ID001) for Mobile Access clients that allows seamless integration with third-party Identity Providers. \n> -   New Management API calls for Capsule Workspace configuration. See the [Check Point Management API Reference](https://sc1.checkpoint.com/documents/latest/APIs/index.html) > section \"Mobile Access\".\n> \n> ### Dynamic Routing\n> \n> Added support for new Dynamic Routing capabilities:\n> \n> -   BGP Extended Communities (RFC 4360). \n> -   BGP Conditional Route Advertisement and Injection. \n> -   Routing Table Monitor for Event Triggers. \n> -   IPv4 and IPv6 Router Discovery on cluster members. \n> -   Router Preference and Route Information option. \n> -   Route age information. \n> -   IPv4 PIM-SSM with non-default prefixes.\n> -   IPv4 PIM with BFD. \n> -   IPv4 PIM neighbor filtering. \n> -   IPv4 PIM RPT to SPT switchover control. \n> -   IPv6 Protocol Independent Multicast (PIM) and Multicast Listener Discovery (MLD).\n> \n> Added support for new Dynamic Routing API calls:\n> \n> -   REST API calls for BGP, PIM, Multicast Listener Discovery (MLD).\n> -   REST API calls for Route Redistribution, Inbound Route Filters, and NAT Pools.\n> -   REST API calls for IGMP.\n> \n> Also see the [Check Point Gaia API Reference](https://sc1.checkpoint.com/documents/latest/GaiaAPIs/index.html) v1.8 (and higher) > section \"Networking\".\n> \n> ###   \n> Performance and Infrastructure\n> \n> -   [HyperFlow](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_PerformanceTuning_AdminGuide/Default.htm#cshid=ID001) acceleration of elephant flows for the SMB/CIFS protocol. \n> -   HyperFlow acceleration of elephant flows for the QUIC protocol. \n> -   Quantum Security Gateway log rate output capacity increased by up to 100% through a new multi-process architecture.\n> \n> ### Quantum Maestro, Scalable Chassis, and ElasticXL\n> \n> This release features improvements in managing and monitoring Scalable Platform clusters, which include:\n> \n> -   Support for REST API: \n>     -   New API calls on Quantum Maestro Orchestrator to configure and monitor Maestro Security Groups, Gateways, Sites, and Ports.  \n>         See the complete list of available API calls in the [Check Point Gaia API Reference](https://sc1.checkpoint.com/documents/latest/GaiaAPIs/index.html) v1.8 and higher > section \"Maestro\".\n>     -   Support for Gaia REST APIs on Scalable Platform Members.\n> -   Support for Gaia [First Time Configuration Wizard](https://sc1.checkpoint.com/documents/Appliances/GSG_Maestro/EN/Default.htm#cshid=ID056) on Quantum Maestro Orchestrators with ability to configure the Maestro Site settings. \n> -   Support for authentication to [secure the synchronization connections](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ScalablePlatforms_AdminGuide/Default.htm#cshid=ID002) between Quantum Maestro Orchestrators.\n> -   Support for [SNMP Queries on each Scalable Platform Member](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ScalablePlatforms_AdminGuide/Default.htm#cshid=ID004).\n> -   Support for [LLDP on Uplink, Sync, and Management ports of Quantum Maestro Orchestrators](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID163).\n> -   New page [\"Ports\"](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ScalablePlatforms_AdminGuide/Default.htm#cshid=ID005) in Gaia Portal on Quantum Maestro Orchestrator. This page shows a summary and interactive view of port configuration, runs diagnostics on ports, and blinks a port LED for identification. \n> -   New page \"Cluster Management\" in Gaia Portal on ElasticXL / Security Group. This page shows the state and performance of Scalable Platform Members.\n> -   [\"insights\"](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ScalablePlatforms_AdminGuide/Default.htm#cshid=ID003) - New CLI tool to monitor the entire Scalable Platform cluster in both Expert mode and Gaia gClish.\n> -   New Gaia gClish commands \"`show cluster`\" and \"`set cluster`\".\n> -   Improved boot time and decreased number of reboots of Scalable Platform Members when there is a change in the Gaia OS configuration in a Scalable Platform.\n> -   Improved upgrade simplicity:  \n>     -   This release introduces automatic updates for the CPUSE Deployment Agent on Scalable Platforms. Manual deployment is no longer required.\n>     -   Upgrade to R82 and higher no longer requires the `sp_upgrade` script and can be easily monitored with Scalable Platforms monitoring tools.\n> -   Additional snapshot mechanism to take small Gaia OS snapshots (lightshots).\n> \n> ### VSX\n> \n> Check Point VSX is enhanced with a new mode (**[VSNext](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_VSX_AdminGuide/Default.htm#cshid=ID001)**), allowing simpler configuration, easier provisioning, and a similar experience to a physical Security Gateway.\n> \n> The benefits of the new VSX mode are:\n> \n> -   Unified management experience between Check Point physical Security Gateways and Virtual Gateways, including the capability to manage each Virtual Gateway from a different Management Server.\n> -   Improves VSX provisioning performance and provisioning experience - creating, modifying, and deleting Virtual Gateways and Virtual Switches in Gaia Portal, Gaia Clish, or with Gaia REST API.\n> -   Management feature and API parity between Virtual Gateways (VGW) and physical Security Gateways.\n> -   Managing different Virtual Gateways with different Security Management Servers, in addition to different Domain Management Servers on the same Multi-Domain Security Management Server\n> \n> ### Tools and Utilities\n> \n> -   New tool [**\"connview\"**](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_CLI_ReferenceGuide/Default.htm#cshid=ID001) - a new consolidated troubleshooting tool for viewing connections information on the Security Gateway that works in the User Space Firewall (USFW).\n> -   New tool **[\"up\\_execute\"](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_CLI_ReferenceGuide/Default.htm#cshid=ID002)** that performs virtual Access Control / NAT Rule Base execution. Given inputs based on logs or connections, the execution provides detailed information such as matched rules and classification information.\n\n___\n\n     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk181127/GaiaOS202409191358213.png)    Gaia Operating System\n\n> Note - This section applies to Security Gateways, Management Servers, and Log Servers.\n> \n> This release boosts Gaia OS with a new OS kernel and multiple new configuration options for better security, enhanced networking and a simpler experience.\n> \n> The new capabilities are:\n> \n> -   Enhance Gaia OS with:\n>     -   Support for [Link Layer Discovery Protocol (LLDP)](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID076) in the VSX mode.\n>     -   DHCPv6 server, DHCPv6 client, and DHCPv6 client for prefix-delegation in [Gaia Portal](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID044) and [Gaia Clish](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID043). \n>     -   [Ability to configure the order](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID010) of the \"AAA\" authentication (TACACS, RADIUS, Local authentication) in Gaia Portal and Gaia Clish.\n>     -   [DNS Proxy forwarding domains](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID161), which allows configuring specific DNS servers per DNS suffix.\n> -   New Gaia OS configuration items:\n>     -   [Two-Factor Authentication](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID162) for Gaia OS login using time-based authenticator apps (Google Authenticator and Microsoft Authenticator). \n>     -   NTP pools and a larger number of NTP servers in [Gaia Portal](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID147) and [Gaia Clish](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID146). \n>     -   [NFSv4 configuration](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID049).\n>     -   [Keyboard layout](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID045).\n>     -   TLS configuration for a remote Syslog server in [Gaia Portal](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID135) and [Gaia Clish](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID134). \n> -   Support for storing a [Gaia OS backup](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm#cshid=ID012) in Amazon S3 and Microsoft Azure and restoring it from there. \n\n___\n\n     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk170416/security_management202106131354392.png)    Quantum Security Management\n\n> ### Security Management Server Enhancements\n> \n> -   The LDAP Account Unit object [now uses the LDAP server name and CA certificate](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SecurityManagement_AdminGuide/Default.htm#cshid=ID003) for LDAP trust. The trust is automatically renewed if an administrator renews or replaces the LDAP server certificate. As a result, Check Point servers keep their connectivity to the LDAP server.\n> -   Support for Management API to run the \"`vsx_provisioning_tool`\" operations to configure VSX Gateway and VSX Cluster objects. See the [Check Point Management API Reference](https://sc1.checkpoint.com/documents/latest/APIs/index.html) \\> section \"VSX\" > command \"vsx-provisioning-tool\".\n> -   Support for Management API to configure the \"Data Type\" objects for the Data Loss Prevention and Content Awareness Software Blades. See the [Check Point Management API Reference](https://sc1.checkpoint.com/documents/latest/APIs/index.html) \\> section \"Data Types\".\n> -   Security Gateways [can now be managed](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SecurityManagement_AdminGuide/Default.htm#cshid=ID308) by a Security Management Server hosted behind a public cloud or third-party NAT device.\n> -   Support to manage up to 500 Security Gateways / Cluster Members, allowing concurrent policy installation on all managed Security Gateways / Cluster Members. \n> -   Support for SAML login in SmartConsole when Gaia Portal on the Management Server runs on a different port than the default port 443. See [sk182032](https://support.checkpoint.com/results/sk/sk182032).\n> -   Ability to verify an Access Control policy that contains unpublished changes.\n> -   The \"Access Rule Name\" and \"Access Rule Number\" fields will now prioritize information from administrator-defined rules [by excluding](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_LoggingAndMonitoring_AdminGuide/Default.htm#cshid=ID001) Accept rules from the pre-defined Playblocks and IoT Access Policy layers.\n> \n> ### SmartConsole\n> \n> -   Added the ability for the system account to install SmartConsole.\n> -   Enhancements in the SmartConsole > \"Gateways & Servers\" view:\n>     -   You can now [see and manage](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SecurityManagement_AdminGuide/Default.htm#cshid=ID314) the Recommended Jumbo Hotfix Accumulators and Recommended Software Updates for Security Gateway / Cluster objects and Check Point Host objects. \n>     -   [HealthCheck Point (HCP)](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SecurityManagement_AdminGuide/Default.htm#cshid=ID315) tests are now integrated. You can see them as part of the Security Gateway's status. The feature is disabled by default.\n> \n> ### Web SmartConsole\n> \n> -   These new [Web SmartConsole](https://support.checkpoint.com/results/sk/sk170314) capabilities are available for this release:\n>     -   Threat Prevention Rule Base\n>     -   HTTPS Inspection Rule Base\n>     -   NAT Rule Base\n>     -   Rule Base search\n> \n> ### Central Deployment of Hotfixes and Version Upgrades in SmartConsole\n> \n> Central Software Deployment through SmartConsole was enhanced and now supports:\n> \n> -   Uninstall of [Jumbo Hotfix Accumulators](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SecurityManagement_AdminGuide/Default.htm#cshid=ID016).\n> -   Installation of packages on ClusterXL High Availability mode in the [\"Switch to higher priority Cluster Member\" configuration](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SecurityManagement_AdminGuide/Default.htm#cshid=ID016) (\"Primary Up\").\n> -   Installation of packages on [Secondary Management Servers](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SecurityManagement_AdminGuide/Default.htm#cshid=ID016).\n> -   Installation of packages on [Dedicated Log Servers](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SecurityManagement_AdminGuide/Default.htm#cshid=ID016).\n> -   Installation of packages on [Dedicated SmartEvent Servers](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SecurityManagement_AdminGuide/Default.htm#cshid=ID016).\n> -   Installation of packages from [Standalone Servers](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SecurityManagement_AdminGuide/Default.htm#cshid=ID016).\n> -   [Package Repository per Domain](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_SecurityManagement_AdminGuide/Default.htm#cshid=ID016) on a Multi-Domain Security Management Server.\n> \n> ### SmartProvisioning\n> \n> -   Star VPN Community now supports Quantum Maestro Security Groups, VSX Gateways, and VSX Clusters as Center Gateways (Corporate Office Gateway). \n> \n> ### Multi-Domain Security Management Server\n> \n> -   Ability to clone an existing Domain on the same Multi-Domain Security Management Server. See [sk180631](https://support.checkpoint.com/results/sk/sk180631).\n> -   Improved upgrade time of large Multi-Domain Security Management Server environments by up to 50%.\n> -   [New support for IPv6 configuration](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Multi-DomainSecurityManagement_AdminGuide/Default.htm#cshid=ID001) (only with Management API \"`set mds`\") on a Multi-Domain Security Management Server that allows Domains to communicate with the managed Security Gateways over IPv6. \n> -   Automatic refresh of modified Global objects in SmartConsole that is connected to a non-Global Domain when a superuser assigns a Global Policy to a Domain Management Server. See [sk182307](https://support.checkpoint.com/results/sk/sk182307).\n> -   Ability to select the Access Control, Threat Prevention, or both policies in a Policy Preset object.\n> \n> ### Compliance\n> \n> -   Added Gaia OS Best Practice support for Quantum Maestro - presenting a consolidated Best Practices status for each Security Group Member and Orchestrators.\n> -   Added Gaia OS Best Practice support for Quantum Spark Appliances (only for applicable Gaia OS Best Practices).\n> -   Added Gaia OS Best Practice support for Log Servers.\n> -    Added new regulations: \n>     -   Center for Internet Security Benchmarks\n>     -   Cyber Essentials v3.1\n>     -   Cybersecurity Maturity Model Certification\n>     -   Essential Eight & Strategies to Mitigate Cyber Security Incidents\n>     -   IEC 62443-2-1 201\n>     -   ISO 27001:2022\n>     -   Israeli Cyber Defense Methodology 2.0\n>     -   Network and Information Systems Directive 2\n>     -   PCI DSS 4.0\n>     -   TISAX 5.1\n\n___\n\n     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk170416/cloudGuard_iaas202106131355093.png)    CloudGuard Network Security\n\n> ### CloudGuard Controller\n> \n> -   CloudGuard Controller [now supports](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_CloudGuard_Controller_AdminGuide/Default.htm#cshid=ID022) Identity Awareness PDP (Identity Sharing).\n> -   CloudGuard Controller [now supports](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_CloudGuard_Controller_AdminGuide/Default.htm#cshid=ID023) VMware NSX-T Global Manager to allow integration with VMware NSX-T v4.1. \n> -   CloudGuard Controller for VMware NSX-T now uses Policy Mode APIs to import objects from an NSX-T Manager.\n> -   Multi-Domain Security Management Server [now supports](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_CloudGuard_Controller_AdminGuide/Default.htm#cshid=ID004) Data Center objects and Data Center Query objects in the Global Policy.\n\n___\n\n     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk170416/endpoint_security202106131355244.png)    Harmony Endpoint Web Management\n\n> -   [**Client optimization for Windows servers**](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_HarmonyEndpointWebManagement_AdminGuide/Default.htm#cshid=ID001) - Harmony Endpoint now allows you to easily optimize the Endpoint Security clients for Windows servers, such as Exchange servers, Active Directory servers, Database servers, and so on, by manually assigning Windows server roles.\n> -   **[Run Diagnostics](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_HarmonyEndpointWebManagement_AdminGuide/Default.htm#cshid=ID003)** \\- Using the Push Operation, an administrator can run a diagnostic check on endpoint clients.   \n>     The reports show the total CPU and RAM usage for the last 12 hours, including the CPU usage by processes. Based on the report data, Harmony Endpoint may offer suggested exclusions to optimize the endpoint performance. You can easily add an exclusion as part of \"Global Exclusion\" or \"Exclusion per Rule\". \n> -   [**Exclusions Enhancements:**](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_HarmonyEndpointWebManagement_AdminGuide/Default.htm#cshid=ID004) \n>     -   **Exclusion description** - You can now add comments to new or existing exclusions.\n>     -   **Global Exclusion** - You can now easily add global exclusion that applies to all rules.\n> -   **Application Control for macOS** - Control which applications can run or use networking.\n> -   [**New Asset Management view:**](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_HarmonyEndpointWebManagement_AdminGuide/Default.htm#cshid=ID005)\n>     -   **Filters** - A brand new look and functionality for filters that enhances operation and productivity, while using the Asset Management view.\n>     -   **Asset Management Table** - Bigger asset management table to see all relevant data easily.\n>     -   **Columns reorder** - New Column reorder option to customize the asset management table based on their specific needs by changing columns location.\n> -   **Linux Offline Package** - Supports upload and export package for Linux OS clients.\n> -   Support for **Harmony Endpoint Management API** on an on-premises Endpoint Security Management Server.  \n>     The API is disabled by default for on-premises deployments. See the [Harmony Endpoint Management API](https://app.swaggerhub.com/apis/Check-Point/web-mgmt-external-api-production) documentation.\n\n___","language":"md","time":"14 days ago","created":"2025-05-06T22:56:22.597Z","annotations":[],"updated":"2025-05-06T23:05:27.391Z"},{"title":"Connection Tracker: Performance and Reproducing Connection Information","id":"e145dcb7-1038-4c47-942a-c4c7c556aa4e","type":"TEXT","raw":"## How to use the Connection Tracker\n\nProductQuantum Security Gateways\n\nVersionR80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10\n\nOSGaia\n\nLast Modified2022-09-22\n\n## Solution\n\n**Table of Contents**\n\n-   Overview\n    \n-   How it Works\n    \n-   Viewing Collected Data\n    \n-   Activating and Deactivating Connection Tracker\n    \n-   Installation of TIV\n    \n-   Advanced Settings\n    \n\n## Overview\n\nConnection Tracker (CT) is used for logging meaningful information related to internal flows execution. It can help investigating connectivity and latency issues without the need to reproduce them.\n\nDue to huge amount of traffic processed by the Security Gateway, in a case of system misbehavior like delay in connection processing, it’s not easy to locate the exact reason causing it.\n\nConnection Tracker identifies on the fly all potential anomalies and persists minimal amount of relevant information that can help to identify, reproduce and resolve system misbehavior issue without impacting overall system performance.\n\nThe collected information can help you to:\n\n-   identify scenarios that cause system misbehavior\n-   investigate connectivity/latency issue \n-   useful for flow comparison\n-   identify multi layer complexity issues\n-   reproduce the scenarios\n-   resolve the source issues\n\nNotes:\n\n1.  CT is available only on a kernel that runs on the user space.\n2.  CT operates on the level of connection and therefore cannot be applied to the cases when packet flow is terminated before reaching the level of connection creation.\n\n## How it Works\n\nCT is working in background, upon connection termination CT analyses collected information (logged tracking points) and takes one of the following steps:\n\nif all logged data is considered as normal, the connection record is is not stored.  \nif logged data contains indications of an abnormal behavior (errors, latency, etc), the connection record is stored.\n\nIn addition, Connection Tracker supports persisting all records answering user defined filter. The user defined filter requires manual activation/deactivation and may impact the performance.\n\n## Viewing Collected Data\n\nThe log files are located under $FWDIR/log/.  \nIn a VSX environment, the files are located under $FWDIR/log/CTX/CTX0000<VS\\_ID>, for each VS.\n\ntracker.log - the log file to which the Security Gateway currently writes logs\n\nYou can open log files in two ways:\n\n-   with the TIV tool\n-   directly from the Security Gateway. For this, run $FWDIR/Python/bin/python3.7 $FWDIR/scripts/tracker\\_parser.py <LOG-FILE>\n\nThe connection data collected by the Connection Tracker is outputted in the compressed format. It can be viewed using the TAC Info Viewer tool (TIV).\n\n**To use TIV:**\n\n1.  Open TIV. \n2.  Drag and drop _trackerN.log_ into the TIV window. \n3.  See the decompressed and translated report.\n\nThis is how the TIV for a tracker log file looks like.  \n  ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk174043/CT202107181451561.png)  \n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk174043/CT202107181455561.png)\n\nIn this CT record we can see collected data during the connection life cycle.\n\nThe first section is the header, which include general information on the connection -\n\n-   Source IP\n-   Destination IP\n-   Starts timestamp(TS)\n-   End TS\n-   Num Points - the number of the collected points on the connection, \n-   Flags - filter flags triggered the record\n-   Irregular Point Index - the collected point that marked as irregular (ERROR/WARNNING)\n-   Protocol\n-   Resource\n\nThe second section is details on each tracking point. In this record we can see a connectivity issue in the highlighted line caused by certificate issue. Each product associated to point ID, in this case we can see that the error is in HTTPSi product.\n\n## Activating or Deactivating Connection Tracker\n\nStarting from version R81.10, the Connection Tracker is enabled by default. For R81, R80.40 and R80.30 Gogo the Connection Tracker is enabled by default starting:\n\nR81 Jumbo Hotfix Take 42  \nR80.40 Jumbo Hotfix Take 150  \nR80.30 Jumbo Hotfix Take 241\n\nIn previous versions, you have to activate the CT manually. \n\n**To activate or deactivate the CT:**\n\n1.  Connect to the Security Gateway.\n2.  Edit _$FWDIR/modules/fwkern.conf_  or create the file if it does not exist.\n3.  Add the following line: \n    -   _fwconn\\_tracker\\_enable\\_app\\_opaque=0/1_  \n        where **0** \\- deactivated, **1** \\- activated\n4.  Reboot.\n\nFor a VSX Security Gateway, CT is activated/deactivated by a different parameter (see **Configuration Parameters** below).\n\n##   \nInstallation of TIV \\[TACInfo Viewer\\]\n\n1.  Download the TAC Tools Manager from [https://tactools.ad.checkpoint.com/home](https://tactools.ad.checkpoint.com/home).\n2.  Install the latest version.\n    1.  Open the TAC Tools Manager.\n    2.  Click the **Install in TIV** icon.\n3.  If needed, update the _tracker\\_repository.json_:\n    1.  Open the TAC Tools Manager.\n    2.  Click the sandwich menu button (next to the Open button) for TIV icon.\n    3.  Select **Go to Folder**; the JSON file is under _config\\\\tracker\\_repository.json_. If the JSON file is not up-to-date, you can see the points with “undefined” description in TIV.\n\n##   \nAdvanced Settings\n\n**Setting User-Defined Filter:**  \nTo record to the file specific connections tracking, enable specific filters and set kernel parameters.\n\nExample:  \nEnable specific connection tracking:  \n_fw ctl set str fwconn\\_tracker\\_filter\\_src\\_addr\\_ip 1.1.1.1_  \n_fw ctl set str fwconn\\_tracker\\_filter\\_dst\\_addr\\_ip 20.20.20.20_  \n_fw ctl set int fwconn\\_tracker\\_filter\\_enable  1_\n\nDisable tracking:  \n_fw ctl set int fwconn\\_tracker\\_filter\\_enable  0_\n\n|                **Name**                |           **Type**           | **Set via** | **Requires reboot** |                                                                          **Description**                                                                          |   **Default**   |\n|------------------------------------|--------------------------|---------|-----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|\n| fwconn\\_tracker\\_filter\\_src\\_addr\\_ip | String (IP - host order) | _fw ctl_  |       No        | Write/Persist connections matching the source IP.  \nIf not set, all source IPs are treated as matching criteria. | empty (all) |\n| fwconn\\_tracker\\_filter\\_dst\\_addr\\_ip | String (IP - host order) | _fw ctl_  |       No        | Write/Persist connections matching the source IP.  \nIf not set, all source IPs are treated as matching criteria. | empty (all) |\n|    fwconn\\_tracker\\_filter\\_sport    |         Integer          | _fw ctl_  |       No        | Write/Persist connections matching the source IP.  \nIf not set, all source IPs are treated as matching criteria. |   0 (all)   |\n|    fwconn\\_tracker\\_filter\\_dport    |         Integer          | _fw ctl_  |       No        | Write/Persist connections matching the source IP.  \nIf not set, all source IPs are treated as matching criteria. |   0 (all)   |\n|    fwconn\\_tracker\\_filter\\_proto    |         Integer          | _fw ctl_  |       No        | Write/Persist connections matching the IP protocol.  \nProtocols are coded according to IANA.  \nIf not set, all source ports are treated as matching criteria. |   0 (all)   |\n|    fwconn\\_tracker\\_udf\\_max\\_time     |         Integer          | _fw ctl_  |       No        |                                                       Write connections that lifetime are bigger than X                                                       |    1200     |\n|   fwconn\\_tracker\\_filter\\_enable    |      Integer  (0/1)      | _fw ctl_  |       No        |                                                                   Enable/Disable the filter                                                                   | 0 (disable) |\n\n**Notes:  \n**\n\n1.  Filters will only affect connections that were established after the filters were set.\n2.  Filters for IP/port/protocol (first 5 rows)  - value 0 means \"Any\", but if all of them are 0, then it means that the filter is not active.\n\n**Configuration Parameters:**\n\n|                **Feature**                |                 **Name**                  |     **Type**      |           **Set via**            | **Requires reboot** |                                                    **Description**                                                    |      **Default**      |\n|---------------------------------------|---------------------------------------|---------------|------------------------------|-----------------|-------------------------------------------------------------------------------------------------------------------|-------------------|\n| Activation/Deactivation (not for VSX) |   fwconn\\_tracker\\_enable\\_app\\_opaque    | Integer (0/1) |         _fwkern.conf_          |       Yes       |                                 Activates/Deactivate the entire feature (not VSX)                                 |   1 (Activated)   |\n|    Activation/Deactivation for VSX    | fwconn\\_tracker\\_enable\\_app\\_opaque\\_vsx | Integer (0/1) |         _fwkern.conf_          |       Yes       |                              Activates/Deactivate the entire feature in VSX Machine                               |  0 (Deactivated)  |\n|         Temporary suspending          |       fwconn\\_tracker\\_suspended        | Integer (0/1) | _fw ctl_  \n_(fw –vs <vsid> ctl)_ |       No        | Temporary suspends/resumes the tracking feature in runtime. Applicable only if feature is configured as activated | 0 (Not suspended) |\n|            Sample logging             |   fwconn\\_tracker\\_test\\_random\\_param    |    Integer    | _fw ctl_  \n_(fw –vs <vsid> ctl)_ |       No        | Defines a random range for unconditional connection logging.  \nSetting to 1 means all connections are logged. |       10000       |\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorStela Anavi\n\nTechnical ResourceSteve Gutfreund\n\nAccess LevelInternal\n\nStatusApproved by TAC\n\nDate Created2021-06-16\n\nLast Modified2022-09-22\n\nEditorStela Anavi\n\nLast ApproverRoy Zhuang\n\n## Comments\n\n#### Internal only\n\n### Fetching log files from CPInfo\n\nStarting from build 914000229, CPInfo automatically collects the Connection Tracker log files and embeds them into the CPInfo output in UUE format.  \nIn order to open a file, copy the contents from CPInfo output into a file with UUE extension and extract it using WinZip. After this step you will have a log file (which can be opened using TIV as explained above) or a zip file (which can be extracted and then opened using TIV).\n\n### Note\n\nThis sk access level was changed from Advanced to Internal on June 20, 2021, because this sk contains an Internal tool. Approved by Nachum Moshe:\n\n___\n\nFrom: Nachum Moshe   \nSent: Tuesday, June 22, 2021 10:21 AM  \nTo: Inna Dozortsev <innad@checkpoint.com>; Stella Anavi <stelaa@checkpoint.com>  \nCc: Steve Gutfreund <steveg@checkpoint.com>  \nSubject: RE: New Solution: sk174043 was created by Stela Anavi. Title: Connection Tracker\n\nThis SK should be Internal.                \n\n___","language":"md","time":"14 days ago","created":"2025-05-06T22:56:20.646Z","annotations":[],"updated":"2025-05-06T23:03:10.169Z"},{"title":"Check Point VSX TCPdump Doesn't Show ICMP Traffic Between Virtual Systems","id":"dfa3b0b6-affd-46b8-b162-ecd215918a4a","type":"TEXT","raw":"ProductVSX (Traditional)\n\nVersionR80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-01-21\n\n## Symptoms\n\n-   Output of the TCPdump tool on the Virtual Switch's Wrp interfaces does not show ICMP traffic in this scenario:\n    \n    1.  Virtual System \"A\" is connected to a Virtual Switch\n    2.  Virtual System \"B\" is connected to the same Virtual Switch\n    3.  ICMP traffic passes through Virtual System \"A\", through this Virtual Switch, to the Virtual System \"B\"\n    \n    Example topology:\n    \n    \\--- \\[VS \"A\"\\] (wrpj1) -- (wrp1) \\[VSW\\] (wrp2) -- (wrpj2) \\[VS \"B\"\\] ---\n    \n-   Output of the FW Monitor shows ICMP requests on the Virtual Switch's Wrp interface.\n    \n\n## Cause\n\nThis behavior is by design. There is a feature called Warp-jump which allows SecureXL to accelerate traffic between Virtual Systems. As a result, the TCPdump tool does not \"see\" these packets.\n\n## Solution\n\nAvailable options:\n\n-   Use the \"fw monitor\" command.\n-   Use the \"tcpdump\" on the Virtual System interfaces.\n-   Use the \"tcpdump\" on the physical interface, to which the Virtual Switch is connected.\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorAlexey Rozdobudko\n\nTechnical ResourceDrake Bouwhuis\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2020-06-28\n\nLast Modified2025-01-21\n\nEditorAlexey Rozdobudko\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only\n\nThis SK applies to R82.10 as well\n\nThe SK created only for this specific scenario, which can happen during traffic investigation.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:17.861Z","annotations":[],"updated":"2025-05-06T22:59:26.919Z"},{"title":"ProductQuantum Maestro","id":"671bb567-54f9-48d8-8d43-835e42a3cf7b","type":"TEXT","raw":"ProductQuantum Maestro\n\nVersionR81 (EOS), R81.10, R81.20\n\nLast Modified2025-01-22\n\n#### For internal users only\n\n## Symptoms\n\n-   The WebUI of the Maestro Orchestrator displays the names of some Security Group Members in a Maestro Security Group as \"NA\" instead of the name of the appliance model.\n    \n      \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk182333/appliance_name202405251404031.jpg)\n\n## Cause\n\nThe **`original_name`** field is missing from the `**/etc/appliance_config.xml**` file on the problematic Security Group Members. This issue might occur after you install a Jumbo Hotfix Accumulator.\n\nBelow is an example comparing the good and bad `appliance_config.xml` files for a 6800 appliance.\n\n`[Expert@HOSTNAME:0]# diff appliance_config.xml_good appliance_config.xml_bad`\n\n`1,3c1,3`\n\n`< <model manufacturer=\"CheckPoint\" type=\"QM-30-00\">`\n\n`<               **<name>Check Point Maestro</name>**`\n\n`<               **<series>Maestro</series>**`\n\n`---`\n\n`>       <model manufacturer=\"CheckPoint\" type=\"QL-25-00\">`\n\n`>               **<name>Check Point 6800</name>**`\n\n`>               **<series>6000 Appliances</series>**`\n\n`580c580`\n\n`<       **<smo/><original_name>Check Point 6800</original_name></model>**`\n\n`---`\n\n`>       </model>`\n\n## Solution\n\nDo these instructions to fix the problematic field in the `**/etc/appliance_config.xml**` file of the applicable Security Group Members.\n\n1.  Connect to the command line on the Security Group.\n2.  Log in to the Expert mode and go to the Security Group Member with the incorrect display name:\n    \n    `[Expert@HostName-ch0x-0x:0]# member <Member_ID>`\n    \n3.  Back up the current file:\n    \n    `[Expert@HostName-ch0x-0x:0]# cp -v /etc/appliance-config.xml{,_BKP}`\n    \n4.  Examine the current values of the applicable fields.\n    \n    `[Expert@HostName-ch0x-0x:0]# xmlt -g /model/name -f /etc/appliance_config.xml`  \n    `Check Point 6800`\n    \n    `[Expert@HostName-ch0x-0x:0]# xmlt -g /model/series -f /etc/appliance_config.xml`  \n    `6000 Appliances`\n    \n    `[Expert@HostName-ch0x-0x:0]# xmlt -g /model/original_name -f /etc/appliance_config.xml`  \n    `Path doesn't exist or value is empty`\n    \n5.  Update the applicable fields manually:\n\n1.  If the Security Group with the problematic Security Group Member includes a Security Group Member with a good `appliance_config.xml` file, and the appliance models are the same, then copy the file to overwrite the file on the problematic Security Group member.\n    \n    `[Expert@HostName-ch0x-0x:0]# scp -p admin@1_1:/etc/appliance_config.xml /etc/appliance_config.xml`\n    \n2.  If the WebUI of the Maestro Orchestrator displays all Security Group Members as `NA`, then update the applicable fields manually:\n\n1.  Update **`name`**:\n    \n    `[Expert@HostName-ch0x-0x:0]# xmlt -u /model/name -v \"Check Point Maestro\" -f /etc/appliance_config.xml`\n    \n2.  Update **`series`**:\n    \n    `[Expert@HostName-ch0x-0x:0]# xmlt -u /model/series -v \"Maestro\" -f /etc/appliance_config.xml`\n    \n3.  Add the missing fields `**smo**` and `**original_name**`:  \n    **Note:** Change the value \"`Check Point 6800`\" to the actual appliance model.\n    \n    `[Expert@HostName-ch0x-0x:0]# xmlt -i /model -n smo -f /etc/appliance_config.xml`\n    \n    `[Expert@HostName-ch0x-0x:0]# xmlt -i /model -n original_name -v \"Check Point 6800\" -f /etc/appliance_config.xml`\n    \n    The end of the file should look like this:\n    \n    `[Expert@HostName-ch0x-0x:0]# grep original_name /etc/appliance_config.xml`  \n           `<smo/><original_name>Check Point 6800</original_name></model>`  \n    `[Expert@HostName-ch0x-0x:0]#`\n    \n\n7.  Make sure the applicable fields are correct:\n    \n    `[Expert@HostName-ch0x-0x:0]# xmlt -g /model/name -f /etc/appliance_config.xml`  \n    `Check Point Maestro`\n    \n    `[Expert@HostName-ch0x-0x:0]# xmlt -g /model/series -f /etc/appliance_config.xml`  \n    `Maestro`\n    \n    `[Expert@HostName-ch0x-0x:0]# xmlt -g /model/original_name -f /etc/appliance_config.xml`  \n    `Check Point 6800`\n    \n8.  Restart the `smartd` service:\n    \n    `[Expert@HostName-ch0x-0x:0]# service smartd stop`\n    \n    `[Expert@HostName-ch0x-0x:0]# service smartd start`\n    \n9.  Log in the WebUI of the Maestro Orchestrator and refresh the **Orchestrator** page. \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorWei Zhang\n\nTechnical ResourceNadia Hacham\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2024-06-20\n\nLast Modified2025-01-22\n\nEditorWei Zhang\n\nLast ApproverLiron Rubin\n\n## Comments\n\n#### Internal only","language":"md","time":"14 days ago","created":"2025-05-06T22:56:24.914Z","annotations":[],"updated":"2025-05-06T23:04:01.233Z"},{"title":"Check Point R82 Security Management and Gateway Common Criteria EAL4+ Certification","id":"4cdd0e7d-b9c5-408e-929b-f588e8903e52","type":"TEXT","raw":"ProductQuantum Maestro, Quantum Security Gateways, Quantum Security Management\n\nVersionR82\n\nOSGaia\n\nLast Modified2025-04-21\n\n## Solution\n\n### Introduction\n\nCheck Point has successfully gained a Common Criteria EAL4+ AVA\\_VAN.4 certification for R82 Security Management, Security Gateway, and Maestro Orchestrator.\n\nThe certification was performed under the authority of the German certification scheme. The Certificate, Certification Report, and Security Target are available below, and are officially published on the [BSI web site](https://www.bsi.bund.de/EN/Themen/Unternehmen-und-Organisationen/Standards-und-Zertifizierung/Zertifizierung-und-Anerkennung/zertifizierung-und-anerkennung_node.html) and the [Common Criteria Portal](https://www.commoncriteriaportal.org/index.cfm) (at the top, click \"Certified Products\" > in the \"Filter by\" section, in the leftmost vendor field, select \"Check Point Software Technologies Ltd.\").\n\n###   \nDocumentation\n\nThe Target of Evaluation (TOE) is fully described in the Security Target, and includes claims for:\n\n-   Firewall.\n-   IPS Blade Pattern Matcher.\n-   REST API.\n-   Supported non-TOE appliances include:\n    -   Quantum Security Gateway.\n    -   Security Management Server on a Smart-1 appliance.\n    -   Maestro Hyperscale Orchestrator.The full list of supported appliances is provided in the Security Target document.\n\n  \n\n###   \nDownloads\n\nThe Common Criteria release can be downloaded here:\n\n**Important Limitations**: To obtain the evaluated configuration, the administrator is required to configure the TOE according to instructions provided in the Installation and Configuration Guide. After completion, non-TOE functionality will be disabled. This configuration does not support standard jumbo hotfixes. Flaw remediation will be provided through Customer Support via opening a support request.\n\n###   \nRevision History\n\n## Article Properties\n\nOriginatorGilad Tavasi\n\nTechnical ResourceMalcolm Levy\n\nAccess LevelGeneral\n\nStatusApproved\n\nDate Created2023-07-04\n\nLast Modified2025-04-21\n\nEditorGilad Tavasi\n\nLast ApproverSergei Shir","language":"md","time":"14 days ago","created":"2025-05-06T22:56:23.201Z","annotations":[],"updated":"2025-05-06T23:03:46.891Z"},{"title":"iDRAC/LOM Verification and Troubleshooting on Check Point Smart-1 Appliances","id":"fc9373c3-52f7-42e1-8a9a-fe609d31e4e2","type":"TEXT","raw":"ProductQuantum Smart-1\n\nVersionR80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nOSGaia\n\nPlatformSmart-1\n\nLast Modified2023-04-20\n\n## Solution\n\nThis table provides some verification tests and troubleshooting for iDRAC/LOM.\n\nTable key:\n\n-   Test - The verification test to do.\n-   Command - The command to run for the test.\n-   Expected Output - The expected output/behavior in a normal system.\n-   Next Step - What to do in case of a result other than the expected output/behavior.\n\n**Important Note**: Do **not** change the iDRAC interface. \n\n<table><tbody><tr><td>Test</td><td>Items</td><td>Description</td></tr><tr><td rowspan=\"3\">Make sure that the admin user password generated</td><td>Command</td><td>N/A</td></tr><tr><td>Expected Output</td><td>N/A</td></tr><tr><td>Next Step</td><td><code>cpidrac --generate_admin_password</code><br><strong>Note</strong>: The admin user is for system use only because of the non-operator User Role.</td></tr><tr><td rowspan=\"3\">Check the default status of the iDRAC NIC (enabled or disabled)</td><td>Command</td><td><code>cpidrac --get_external_nic_state</code></td></tr><tr><td>Expected Output</td><td><pre>External NIC status:enabled</pre></td></tr><tr><td>Next Step</td><td><code>cpidrac --set_external_nic_state=enable</code></td></tr><tr><td rowspan=\"3\">Check that the eth-idrc0 interface is up and running in the ifconfig output and has the correct ip and mask</td><td>Command</td><td><code>ifconfig eth-idrc0</code></td></tr><tr><td>Expected Output</td><td><pre>eth-idrc0 &nbsp; Link encap:Ethernet &nbsp;HWaddr 6C:2B:59:7C:A4:12<br>            inet addr:169.254.0.2 &nbsp;Bcast:169.254.0.255 &nbsp;Mask:255.255.255.0<br>            UP BROADCAST RUNNING MULTICAST &nbsp;MTU:1500 &nbsp;Metric:1</pre></td></tr><tr><td>Next Step</td><td>Run these commands:<br><code>ifconfig eth-idrc0 169.254.0.2 netmask 255.255.255.0</code><br><code>ifup eth-idrc0</code></td></tr><tr><td rowspan=\"3\">Check bindings of the iDRAC interface<p>Important: Do <strong>not </strong>change the iDRAC interface.</p></td><td>Command</td><td><code>cat /config/active | grep -i idrc</code></td></tr><tr><td>Expected Output</td><td><pre>interface:eth-idrc0 t<br>interface:eth-idrc0:ipaddr:169.254.0.2:mask 24<br>interface:eth-idrc0:state on</pre></td></tr><tr><td>Next Step</td><td>Run these commands:<br><code>dbset interface:eth-idrc0:ipaddr:169.254.0.2:mask 24</code><br><code>dbset interface:eth-idrc0:state on</code><br><code>dbset :save</code></td></tr><tr><td rowspan=\"3\">Check ping to the internal iDRAC address</td><td>Command</td><td><code>ping 169.254.0.1</code></td></tr><tr><td>Expected Output</td><td><pre>PING 169.254.0.1 (169.254.0.1) 56(84) bytes of data.<br>64 bytes from 169.254.0.1: icmp_seq=1 ttl=64 time=0.214 ms<br>64 bytes from 169.254.0.1: icmp_seq=2 ttl=64 time=0.167 ms</pre></td></tr><tr><td>Next Step</td><td>Run these commands:<br><code>dbset interface:eth-idrc0:ipaddr:169.254.0.2:mask 24</code><br><code>dbset interface:eth-idrc0:state on</code><br><code>dbset :save</code></td></tr><tr><td rowspan=\"3\">Make sure that \"169.254.0.0/24\" is allowed to access your machine</td><td>Command</td><td><code>clish -c \"show allowed-client all\"</code></td></tr><tr><td>Expected Output</td><td><pre>Host &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp;169.254.0.2<br>OR<br>Network &nbsp; &nbsp;&nbsp; &nbsp; 169.254.0.0 &nbsp; &nbsp; &nbsp; 24<br>OR<br>Host &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;Any</pre></td></tr><tr><td>Next Step</td><td><code>clish -c \"add allowed-client network ipv4-address 169.254.0.0 mask-length 24\"</code></td></tr><tr><td rowspan=\"3\">Check lominfo output</td><td>Command</td><td><code>lominfo</code></td></tr><tr><td>Expected Output</td><td><pre>Firmware Revision : 4.40<br>IP Address : 192.168.1.5<br>IPv6 Status : Enabled<br>IPv6 Address : 3900:172::2/64</pre></td></tr><tr><td>Next Step</td><td><code>service ipmi restart</code></td></tr><tr><td rowspan=\"3\">Check that there are no errors in this file \"/var/log/cp_idrac.log\"</td><td>Command</td><td>N/A</td></tr><tr><td>Expected Output</td><td>N/A</td></tr><tr><td>Next Step</td><td>N/A</td></tr><tr><td rowspan=\"3\">Check ssh to the iDRAC interface</td><td>Command</td><td><code>ssh 169.254.0.1</code></td></tr><tr><td>Expected Output</td><td><pre>Prompt to type password:<br>Password:</pre></td></tr><tr><td>Next Step</td><td>Check <em>\".ssh/known_hosts\"</em> file content, there should be an entry for this IP. You can try to remove the entry and try the ssh again.</td></tr><tr><td rowspan=\"3\">Check that ipmi is up and running</td><td>Command</td><td><code>service ipmi status</code></td></tr><tr><td>Expected Output</td><td><pre>ipmi_msghandler module loaded.<br>ipmi_si module loaded.<br>ipmi_devintf module loaded.<br>/dev/ipmi0 exists.</pre></td></tr><tr><td>Next Step</td><td><code>service ipmi restart</code></td></tr></tbody></table>\n\n  \nIf the issue persists, or is not listed in the table above, [contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/) for assistance.\n\n## Article Properties\n\nOriginatorAmeer Asli\n\nTechnical ResourceMajd Sharkia\n\nAccess LevelGeneral\n\nStatusApproved\n\nDate Created2021-12-16\n\nLast Modified2023-04-20\n\nEditorAmeer Asli\n\nLast ApproverLiron Rubin","language":"md","time":"14 days ago","created":"2025-05-06T22:56:20.705Z","annotations":[],"updated":"2025-05-06T23:00:14.941Z"},{"title":"ProductQuantum Security Gateways","id":"e349603e-99b5-43f8-88d4-4434776ac6a9","type":"TEXT","raw":"ProductQuantum Security Gateways\n\nVersionR80.10 (EOS), R80.20 (EOS), R80.30 (EOS), R80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nLast Modified2024-12-18\n\n## Solution\n\nClick Here to Collapse the Entire Article\n\n## Scenario\n\nTo accurately diagnose and resolve network performance issues, it is crucial to establish a clear understanding of the environment's expected behavior. This article provides a structured approach to troubleshooting, starting with an environment check to baseline expected performance, followed by a basic health check to identify any immediate concerns. Detailed investigation flows and performance metrics are then used to pinpoint specific areas of stress within the system, and guide you through the steps necessary to identify and address the root cause of latency, packet loss, and other performance bottlenecks.   \n**Note:** IPv4 and IPv6 traffic are not combined in all metrics nor are both reported with one command.  Please pay attention to which commands or reports only reflect IPv4 data by default. If customer uses dual stack, then run specific IPv6 commands if all IPv4 metrics look acceptable.\n\n## 1\\. Setup & Environment check\n\n> To try to locate the problem we first need to understand the expected behavior. Therefore, the first thing to do when we approach any environment is to establish its baseline: What is the expected behavior?\n> \n> #### Sizing the environment:\n> \n> -   Hardware (e.g., 5000, 16000)\n> -   Policy and security blades (e.g., NGTP, IPS, HTTPS)\n> -   Blend of traffic (e.g., DNS, IPSEC, HTTPS, IPv4 or IPv6)\n> -   Version (e.g., R80.10, R81.20)\n> -   Kernel version (e.g., 2.6.18, 3.10)\n> -   Firewall version (e.g., kernel/user space)\n> -   CoreXL Instances (IPv4 and/or IPv6) \n> -   Configuration (e.g., Cluster, SA, ...)\n> \n> #### Expected throughput:\n> \n> Sizing the machine by hardware, version, firewall version, policy and blend - [Appliance Sizing Tool](https://usercenter.checkpoint.com/usercenter/portal/media-type/html/role/usercenterUser/page/default.psml/js_pane/PricingToolsId,AST)\n> \n> **Note**: This is only available for users with PartnerMap access. \n> \n> #### Change in traffic:\n> \n> We do the following to view the machine's throughput history and check if the customer had a recent significant increase in traffic/connections:\n> \n> -   cpview\\_history (1 month prior if enabled):\n>     -   `cpview (-t) -> Network (Traffic rate/Concurrent connections)`\n>     -   `Note: many windows in cpview_history only report IPv4 data.`\n> -   cpdiag (1 year prior if enabled):\n>     -   Internal diagnostics server (BeeDrill)\n>     -   Check traffic in cpdiag under tables:\n>         -   'cpview\\_fw\\_network\\_stats\\_traffic\\_rate'\n>         -   'cpview\\_fw\\_network\\_stats\\_concurrent\\_conns'\n> \n> #### Expected packet handling flows:\n> \n> Expected flows by policy and blend\n> \n> Examples:\n> \n> -   Firewall Only & VPN blades → Accelerated Path/SecureXL\n> -   APCL/URL Filtering →  PSLXL\n> -   QoS →  QoS inbound/outbound\n> -   IPS →  All over (depending on Basic/Optimized/Strict profile for IPS)\n> -   Threat Prevention (not including IPS) →  PSLXL, CPASXL\n> -   Mobile Access VPN → F2F\n> -   HTTPS Inspection →  CPASXL + Process space load from wstlsd/pkxld daemons\n> \n> How to?  \n> \n> -   Check activated blades using the '`enabled_blades`' command\n> -   Check traffic distribution in section (refer to section 4.3.1 below: \"Traffic distribution & Acceleration)\n> -   CoreXL assignments:  `cpconfig -> corexl -> view settings` then `fw ctl multik stat` and `fw6 ctl multik stat` to determine which cores are assigned to IPv4 vs IPv6.\n\n## 2\\. Basic Health Check\n\n> Once we establish a good understanding of the customer environment's expected performance, we do a basic health check.  \n> \n> #### Network health and frame loss:\n> \n> -   Check frame loss by pinging through the Firewall:\n>     -   `Gaia/Linux: ping -s 1400 129.82.102.32`\n>     -   `Windows: ping -l 1400 129.82.102.32`\n> -   Check interface stability, Look for a nonzero \"carrier\" value:\n>     -   `ifconfig -a`\n> -   Check sync network health, which can cause high Firewall instance load:\n>     -   `cphaprob syncstat`\n>     -   KPI: >1% packets lost/re-transmitted\n> -   Netstat test:\n>     -   `netstat -ni | grep -v \"\\.\"`\n>     -   Check:\n>         -   RX-DRP: This should be < 0.1%. Anything above that usually indicates an overloaded SND or a need for Multi-Q.   \n>             **Note**: Refer to [sk166424](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk166424) for more information regarding reasons for RX-DRP. \n>         -   RX-ERR and RX-OVR:  Further troubleshot with ethtool -S (interface name)\n>         -   RX-OVR (if different number from RX-DRP) should be near zero and not actively incrementing\n>         -   Overloaded interface needs a bond. If RX-OVR is the same as RX-DRP, it just means RX-DRP.\n>         -   RX-ERR: This should be near zero and not actively incrementing, physical network problem. \n>         -   Fiber interfaces with errors can be investigated further:\n>             -   Kernel 3.10: using  ethtool -m (interfacename)\n>             -   Kernel 2.6.18: using mii-diag -g (interfacename)\n>     -   SW drops (refer to section 4.8 below)\n> \n> #### System stability:\n> \n> -   Cluster failures:\n>     -   `cphaprob state`\n>     -   Is the cluster stable?  When was the last failover? What is the cluster;s operating mode?\n> -   Hardware issues (fans, temperature, voltage):\n>     -   `cpstat -f sensors os`\n>     -   Checks: Are any failed fans causing CPU down-clocking and slowness? Are there voltage or temperature problems?\n> -   Memory, Connection, Fragments:\n>     -   fw ctl pstat\n>     -   fw6 ctl pstat\n\n## 3\\. Investigation Flows\n\n> #### 3.1. Latency\n> \n> Client experiences slowness, some or all CPUs are stressed. How to continue?\n> \n> Check:\n> \n> 1.  System is stressed all over (all the time for various traffic patterns)\n> 2.  System is stressed for specific traffic patterns\n> \n> #### **What if no core is stressed?**\n> \n> Check drops (refer to section 4.8. below)\n> \n> #### 3.1.1. System is stressed all over\n> \n> Find bottleneck (refer to section 4.1.1. below)\n> \n> **3.1.1.1. Firewall instances are highly utilized**\n> \n> **  \n> All cores**\n> \n> 1.  1.  Locate top process (refer to section 4.1.2. below)\n>         1.  Firewall thread (packet handling), check:\n>             1.  Low acceleration ratio (refer to section 4.3.1. below)\n>             2.  Templates efficiency (accept/drop) + Check highest policy hit rate (view section 4.7.1. below)\n>             3.  High fragmentation rate (refer to section 4.3.2. below)\n>             4.  Are we handling heavy connections? Check top connections/protocols (refer to section 4.2.1. below)\n>             5.  Drops and queues utilization (refer to setion 4.5.1. below)\n>             6.  Is IPS active? Check IPS protections (refer to section 4.7.2. below)\n>             7.  Is AV \\\\ AB active? Refer to section 4.7.3. below.\n>         2.  US daemon\n>             1.  Find the offender daemon and contact owner\n>             2.  Some daemons keep log files that may indicate a problem (for example: fwd.elg, cpd.elg)\n>             3.  If URL Filtering is enabled, refer to section 4.7.4. (**URL Filtering** -  **Common Problems and their Solutions** - **RAD daemon consumes more than 500% CPU**). \n> \n> **Some cores**\n> \n> 1.  1.  Locate top process\n>         1.  Firewall thread (packet handling), check:\n>             1.  Is there an imbalanced load distribution between cores? (refer to section 4.3.1. below)\n>             2.  Are we handling heavy connections? (refer to section 4.2.1. below)\n>             3.  Templates efficiency (refer to section 4.7.1. below)\n>         2.  US daemon\n>             1.  Find the offender daemon and contact owner\n>                 1.  Some daemons keep log files which might indicate a problem (for example: fwd.elg, cpd.elg)\n>             2.  Check I/O wait (refer to section 4.1.6. below)\n>             3.  Investigate CPU spikes (refer to section 4.1.7. below)\n> \n> **3.1.1.2. SNDs are highly utilized**\n> \n> **  \n> All cores**\n> \n> 1.  1.  Check SecureXL for drops (refer to section 4.4.1. below)\n>     2.  Check CPAQ for notification failures (refer to section 4.6.1. below)\n>     3.  Activate debugs (should consider performance impact)\n> \n> **Some cores**\n> \n> 1.  1.  Check if traffic distribution between cores is balanced (check TPUT and connections) (refer to section 4.1.4. below)\n>     2.  Is Multi-Queue on? Check for problems (refer to section 4.1.5. below)\n>     3.  Are we handling heavy connections? (refer to section 4.2.1. below)\n>     4.  Activate debugs (performance impact)\n>     5.  Check I/O wait (refer to section 4.1.6. below)\n>     6.  Investigate CPU spikes (refer to section 4.1.7. below)\n> \n> #### 3.1.2. System is stressed for specific traffic patterns\n> \n> 1.  Specific zones\n>     1.  Templates efficiency (accept/drop) + Check highest policy hit rate (refer to section 4.7.1. below)\n> 2.  Specific connection (http, file download, etc.)\n>     1.  Firewall instances are highly utilized\n>         -   Are we handling heavy connections? (refer to section 4.2.1. below)\n>     2.  SNDs highly utilized\n>         -   High PPS?\n>         -   Are we handling heavy connections? (refer to section 4.2.1. below)\n>     3.  Site-to-site VPN slowness\n>         -   Encryption algorithm for VPNs (AES instead of 3DES)\n>         -   SHA-384 not implemented in SecureXL/sim and will cause traffic to go F2F (relevant to R80.10 and R80.20)\n>         -   Use the _tracepath_ command to detect low MTUs and frag/DF IPSec performance issues\n>         -   If using R77.30 or previous versions, no multi-core IPSec is possible, just a high load in a Firewall Instance\n\n## 4\\. How To\n\n> ### 4.1. CPU\n> \n> #### 4.1.1. High CPU utilization - Bottleneck\n> \n> Show / Hide this section\n> \n> Description\n> \n> -   Our CPU cores are divided into two groups: SND and Firewall instances. Each group handles different tasks. \n> -   When one or both groups is/are stressed, the machine cannot function properly.\n> -   Each group can get highly stressed for different reasons.\n> -   It is important to identify which group is the bottleneck in order to track the source of the problem. For more information, refer to [sk98348](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98348), section 4-1). \n> \n> Tasks Distribution\n> \n> <table><tbody><tr><td>Task</td><td>R80.10-</td><td>R80.20+</td></tr><tr><td>Soft IRQ processing</td><td>SND</td><td>SND</td></tr><tr><td>Multi-Queue</td><td>SND</td><td>SND</td></tr><tr><td>TPUT acceleration &amp; Path determination</td><td>SND</td><td>Firewall</td></tr><tr><td>Accept templates matching (new connection) &amp; offload to SecureXL</td><td>SND</td><td>Firewall</td></tr><tr><td>Nat templates matching (new connection) &amp; offload to SecureXL</td><td>SND</td><td>Firewall</td></tr><tr><td>SecureXL/Acceleration path packet handling</td><td>SND</td><td>SND</td></tr><tr><td>Dynamic dispatcher</td><td>SND</td><td>SND</td></tr><tr><td>Fragmentation - IP fragments always sent F2F</td><td>SND</td><td>N/A</td></tr><tr><td>Fragmentation - Virtual reassembly of IP fragments (non-accelerated)</td><td>Firewall</td><td>Firewall</td></tr><tr><td>Fragmentation - Virtual reassembly of IP fragments (accelerated)</td><td>Firewall</td><td>SND</td></tr><tr><td>QoS - Traffic handling (non-accelerated)</td><td>Firewall</td><td>Firewall</td></tr><tr><td>QoS - Traffic handling (accelerated)</td><td>Firewall</td><td>SND</td></tr><tr><td>Rule base matching (non-accelerated)</td><td>Firewall</td><td>Firewall</td></tr><tr><td>Rule base matching (accelerated)</td><td>N/A</td><td>SND</td></tr><tr><td>PXL path packets handling</td><td>Firewall</td><td>Firewall</td></tr><tr><td>F2F path (+CPAS)</td><td>Firewall</td><td>Firewall</td></tr><tr><td>PSLXL, path</td><td>Firewall</td><td>Firewall</td></tr><tr><td>CPASXL paths</td><td>N/A</td><td>Firewall</td></tr><tr><td>Priority queue (when enabled)</td><td>Firewall</td><td>Firewall</td></tr></tbody></table>\n> \n> \\*\\*\\*\\* reference: --------------------\n> \n> Find Bottleneck:\n> \n> -   R80.40+  \n>     -   cpview (**CPU** -> **Overview**)  \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-8_15-47-31202006221740281.png)\n>     -   Top-Protocols, Top-Connections only report IPv4 data.\n> -   R80.30\n> \n> #### 4.1.2. Top CPU consumer\n> \n> Show / Hide this section\n> \n> Description\n> \n> -   Our CPUs run different tasks simultaneously.\n> -   It is important to identify the tasks which are stressing our cores in order to identify the problem.\n> -   Our Firewall instances are running US processes in addition to handling traffic. \n>     -   'fwk' is working hard → stress on traffic handling\n>     -   US daemons are working hard → stress on a US daemon (scheduled, constant)\n> \n> Find top consumer\n> \n> -   `top + (shift + h) # Default time interval is 1sec (can be change using top + d`)\n> -   Find highest consumers\n>     -   Firewall instance is at top in example.\n>         -   USFirewall → process fwk#\\_#\n>         -   Kernel Firewall → process fw\\_worker\\_#\n>         -   fwk0\\_0 FW worker process  \n>             fwk0\\_dev\\_0 - multi-threaded worker process  \n>             fwk\\[x\\]\\_dev\\_0 -  fwk worker for VSX where \\[x\\] is the VS ID.\n>             \n>             fwk or fw\\_full - Can exceed 100% CPU utilization because it represents the combined usage of all threads.\n>             \n>         -   Other daemon may also cause high CPU\n> -   Notes\n>     -   Switching to cmd representation in top (`top +c)` can also sometimes help identify offenders. \n>         -   Top does not indicate if 'fwk\" instances are IPv4 or IPv6.\n>             -   compare `top +c`, `top +H` and `top +1` to check for both.\n>         -   “fw\\_full” is often “fwd”, but can also be other things. \n>     -   Some kernel threads may also be relevant. \n>         -   Example: \\[snd\\], \\[softirqd\\] may be relevant to SNDs. \n> \n> ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-9_15-2-59202006221650541.png)\n> \n> #### 4.1.3. Load distribution - Instances\n> \n> Show / Hide this section\n> \n> Description\n> \n> -   Our traffic is distributed between all Firewall instances. \n> -   Each connection is assigned to one instance and is handled solely on it. If some cores are showing high utilization, we check how the traffic is distributed among them.\n> -   Check that traffic is distributed on the Firewall instances\n> -   KPI\n>     -   The “heaviest” instance (high CPU %) is handling many connections. (ie: how many rows all share the same \"Inst\" number?)\n>     -   The load is significantly imbalanced among the cores. \n> \n> Check that traffic is distributed on the Firewall instances\n> \n> #### 4.1.4. Load distribution - SNDs\n> \n> Show / Hide this section\n> \n> Description\n> \n> -   SecureXL is our acceleration and dispatching mechanism (refer to [sk32578](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk32578)). Accelerated connections are handled on our SND cores. \n> -   If some SND cores are more utilized than others, we should check the distribution of traffic among them. \n> -   Check traffic distribution\n>     -   KPI\n>         -   Load is significantly imbalanced between the cores\n>     -    R80.20+\n>         -   cpview (Advanced → SecureXL → Network-per-CPU)  \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/cpview1202006221656443.png)\n>     -   R80.10-\n> \n> #### 4.1.5. Multi-Queue\n> \n> Show / Hide this section\n> \n> Description\n> \n> -   Multi-Queue is an acceleration feature that lets the user configure more than one traffic queue for each network interface card, which allows the use of more CPU cores for acceleration. \n> -   For more information, refer to [sk98348](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98348), section 2-4. \n> -   If some SND cores are more utilized than others, we should check the Multi-Queue distribution. \n> \n> Check if Multi-Queue is enabled:\n> \n> -   Kernel 3.10\n>     -   Enabled by default\n> -   Kernel 2.6.18\n>     -   Use the command '_cpmq get_' to check if it is enabled. \n> \n> Check if interfaces are balanced:\n> \n> -   Check that irqs, rx and tx are balanced\n> -   Multi-Queue stats - Interfaces affinity + hash\n>     -   Old versions\n>         -   `cpmq get -v`  \n>             ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/cpmq202006221702247.png)\n>     -   New versions \n> \n> #### 4.1.6. I/O wait\n> \n> Show / Hide this section\n> \n> Description:\n> \n> -   If you see a high I/O wait, use the I/O monitor to get the specific actions for which the CPU is waiting.\n> -   During the wait, utilization will rise over 40%, and we will check iostat/iotop for the top I/O actions. \n> \n> Check I/O stats:\n> \n> -   linux 2.6.18  \n>     -   `iostat -x`\n>         \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-21_10-18-44202006221706011.png)\n>         \n> -   linux 3.10\n>     -   `iotop`\n>         \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/iotop202107141718051.png)\n>         \n> \n> #### 4.1.7. CPU Spikes\n> \n> Show / Hide this section\n> \n> Description:\n> \n> -   Spiked CPUs might be a cause for latency, drops, or a good indication of heavy connections, heavy inspection etc.\n> -   Spike Detective logs only show IPv4 connection spikes. \n> -   To check  if CPU spike is relevant to PM, see section 4.7.6. \n> \n> Detecting spikes:\n> \n> -   kernel 2.6.18\n>     -   Run `top +c 0.2` (higher sampling frequency) and check for spiked cores and processes.\n> -   kernel 3.10 (R80.40 jumbo and R81+)\n>     -   Check 'spike detective' logs if we encounter spikes on the system:\n>         \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/spike202006221707183.png)\n>         \n>     -   If a spike was found, view the profiling information saved on the spike (perf trace):\n>         \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/perf202006221707314.png)\n>         \n> \n> ###   \n> 4.2. Heavy connections\n> \n> #### 4.2.1. Top connection and Heavy connections\n> \n> Show / Hide this section\n> \n> Description:\n> \n> -   If only some CPUs are stressed, they might be handling heavy connections.\n> -   We classify heavy connections as “Elephant” if they fulfill the following conditions:\n>     -   Specific instance CPU is over 60\n>     -   Suspected connection lasts more than 10s.\n>     -   Suspected connection utilizes more than 50% of the total instance work. In other words, connection CPU utilization must be > 30%. \n> \n> Top connections/protocols (not necessarily “Elephant”):\n> \n> -   If a specific instance is stressed, we can check the current top connections and protocols running on it. \n> -   This might help us identify problematic traffic profiles.\n> -   Run: `cpview (CPU -> Top-Protocols/CPU -> Top-Protocols)`\n> \n> Heavy connections detector (\"Elephant\")\n> \n> ###   \n> 4.3. Traffic handling\n> \n> #### 4.3.1. Traffic distribution and Acceleration\n> \n> Show / Hide this section\n> \n> Description:\n> \n> -   Upon arrival, each connection is handled on one of 3 paths:\n>     -   Slow path (connections are handled in the Firewall)\n>     -   Medium path (connections are mainly accelerated but some traffic is sent to the Firewall for consultation)\n>     -   Fast path/Accelerated (Connection are handled in PPAK and do not pass the Firewall)\n> -   Passing through the Firewall is “expansive” in terms of performance. Therefore, slow and medium paths are less optimal from the performance aspect. \n> \n> ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-8_17-56-122020062217133011.png)  \n> Check acceleration ratio:\n> \n> -   `fwaccel stats –s`\n> -   `fwaccel6 stats -s`  \n>     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/paths2020062217160713.png)\n> -   Legend:\n>     -   'Accelerated conns/pckts' - Fast path\n>     -   F2F/F2V - Slow path\n>     -   CPASXL/PSLXL/CPAS/PSL - Medium path\n> -    KPI:\n>     -   Low accelerated (fast path) %\n>     -   High F2F/F2V (slow path) %\n> \n> Check accelerated connections:\n> \n> -   `fwaccel conns`\n> -   `fwaccel6 conns   `![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-8_18-0-442020062217181714.png)\n> -   Connection distribution:\n>     -   Fast path – In the table\n>     -   Medium path – In the table + S (streaming)\n>     -   Slow path – Not in the table\n>     -   KPI\n>         -   Empty table or few connections\n> \n> Skipping:\n> \n> -   `fwaccel stats`\n> -   `fwaccel6 stats   `![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-9_18-46-92020062217184815.png)\n> -   On by default\n> -   We should examine skipping statistics with regards to the customer's Software blades and the actual blend.\n>     -   For example: NGFW + CPEnt should result in a high FF rate.\n> \n> #### 4.3.2. Fragmentation\n> \n> Show / Hide this section\n> \n> Description:\n> \n> -   Pre-R80.20, packets that were fragmented were forwarded to the Firewall and handled in the slow path (performance impact). \n> -   Post R80.20, PPAK can perform virtual assembly (which is better, performance wise) but still creates latency. \n> -   The customer may not be able to rectify if the fragments are coming from a network it cannot control (Internet/External interface). \n> -   We should pay attention to high fragmentation rates when investigating performance issues.\n> \n> How to sample:\n> \n> -   `cpview (Advanced -> Network -> Overview -> Others)`![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-8_18-7-112020062217212017.png)\n> -   KPI: Fragmentation rate < 10K\n> -   We can also use the 'tcpdump' command to track fragments coming into the Firewall:\n>     -   `tcpdump -eni any '((ip[6:2] > 0) and (not ip[6] = 64))'`\n>     -   `tcpdump -eni any \"ip[6:2] & 0x1fff!=0\"`\n> \n> ###   \n> 4.4. SecureXL\n> \n> #### 4.4.1. SecureXL stats\n> \n> Show / Hide this section\n> \n> Description:\n> \n> -   SecureXL is our acceleration and dispatching mechanism.\n> -   Packets handled by SecureXL are handled by the SND cores (PPAK) and will usually not go through Firewall inspection.\n>     -   Exceptions are the medium path connections in which PPAK consults the Firewall (in this case both the SND and Firewall cores perform some work).\n> -   When our SNDs are stressed, we should check the SecureXL and interface statistics for problems.\n> -   For more information see [sk32578](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk32578). \n> \n> Drop reasons statistics:\n> \n> -   SecureXL drops:\n>     -   `cpview (Network -> Traffic)`\n>     -   `cpview (Advanced -> SecureXL -> Drops)`\n>     -   `cpview (Advanced -> SecureXL -> Advanced  -> Drop reasons)`\n>     -   `fwaccel stats –d   `![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-8_21-18-352020062217303811.png)\n>     -   KPI:\n>         -   drops > 0\n> \n> Reorder I/S statistics:\n> \n> -   `cpview (Advanced -> SecureXL -> Reorder-IS)   `![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-8_21-18-522020062217310512.png)\n> -   KPI:\n>     -   Max queued pktd’ values are high\n>     -   Queues reached the limit’ > 0\n> \n> Interface queues:\n> \n> -   Another important thing to check are the interfaces queues (drops/errors).\n> -   `cpview (Network -> Interfaces -> traffic)   `![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-8_21-19-192020062217312013.png)\n> -   KPI:\n>     -   drop/error > 0\n> \n> ###   \n> 4.5. CoreXL\n> \n> #### 4.5.1. Drops and Utilization:\n> \n> Show / Hide this section\n> \n> Description:\n> \n> -   CoreXL replicates the Firewall multiple times where each instance runs independently on one processing core. This enables the instances to handle traffic concurrently\n> -   We can check the CoreXL statistics to locate problems with the Firewall instances (utilization, drops, errors, etc.)\n> -   For more information ([sk98348](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98348)→ (3-4) Best practices - CoreXL)\n> \n> CoreXL - Queue utilization\n> \n> -   `cpview (Advanced → CoreXL → Overview → Queues)`\n> -   KPI\n>     -   High utilization (%)\n> \n> CoreXL – Queue Failures\n> \n> -   `cpview (Advanced → CoreXL → Overview → Queues)`\n> -   KPI\n>     -   Enqueue fail > 0\n> \n> ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-8_21-11-7202006221726172.png)\n> \n> ###   \n> 4.6. CPAQ\n> \n> #### 4.6.1. CPAQ failures\n> \n> Show / Hide this section\n> \n> Description\n> \n> -   CPAQ is an asynchronous messaging infrastructure between our different components\n>     -   Firewall and PPAK (both ways)\n>     -   PPAK and dispatcher (both ways)\n> -   Many CPAQ errors may indicate that the traffic causes extensive and usually faulty messages between PPAK and the Firewall, or between the PPAKs. \n> \n> Check for CPAQ errors in cpview:\n> \n> -   `cpview (Advance → CPAQ (all sub-tabs))`\n> -   KPI\n>     -   failures > 0\n> \n> ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-8_21-14-55202006221726413.png)\n> \n> ###   \n> 4.7. Policy\n> \n> #### 4.7.1. Templates\n> \n> Show / Hide this section\n> \n> Description\n> \n> -   Templates enable the enforcement of policy rules (accept/drop) on new connections without passing through the Firewall.\n> -   They open per instance and stay in effect for 90 seconds.\n> -   When they are not utilized, we might see a negative impact on performance.\n> \n> Templates optimization\n> \n> -   R80-\n>     -   Optimize the policy table by placing high hit count rules on top:  \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-8_18-17-52202006221727214.png)\n> -   R80.10+\n>     -   Since R80.10, the rule search was changed to column base search. Therefore, the old optimization is not longer as crucial as it was in the older versions\n> \n> Check templates utilization\n> \n> -   Check that accept and drop templates are utilized.\n> -   KPI\n>     -   Low utilization pct\n> -   Check status\n>     -   `fwaccel stat   `![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-8_18-22-44202006221727405.png)\n> -   Check utilization\n> \n> SecureXL Penalty box\n> \n> -   Off by default\n> -   The SecureXL penalty box is a mechanism that performs an early drop of packets that arrive from suspected sources (versions R75.40VS+). \n> -   The optimization allows the Security Gateway to cope better under high load, possibly caused by a DoS/DDoS attack\n>     -   If traffic from a specific IP performs frequent rule-base violations the IP is put in a \"penalty box\" and any packet that arrives from this IP is dropped at an early stage.\n> -   For more information, refer to [sk74520](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk74520). \n> -   R80.10-\n>     -   Contents of /proc/ppk/erdos:  \n>         ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk167553/image2020-6-9_15-12-52202006221729018.png)\n> -   R80.20+\n> \n> #### 4.7.2. IPS Blade\n> \n> Show / Hide this section\n> \n> Description:\n> \n> -   There are different IPS protections with different confidence levels and performance impacts.\n> -   The default Optimize Profile for IPS contains the best setup in terms of performance and reliability of the detection rate.\n> -   Deviation from the Optimize Profile can cause a performance impact on the environment and false positive detection.\n> -   Also, we should watch out for IPS bypass under a load which will keep IPS disabled on busy systems.\n> \n>  Investigation options\n> \n> -   To analyze if performance impact is relevant to protection, see section 4.7.7.\n> -   Use Flofiler to identify working Firewall components and check which component has impact.\n> \n> #### 4.7.3. Anti-Bot and Anti-Virus \n> \n> Show / Hide this section\n> \n> > Description:  \n> > \n> > -   There are different Anti-Virus / Anti-Bot protections with different confidence levels and performance impacts.\n> > -   The default **Optimize Profile** for Anti-Virus / Anti-Bot contains the best setup in terms of performance and reliability of detection rate.\n> > -   Deviation from the **Optimize Profile** can cause a performance impact on the environment and false positive detection.\n> > \n> > Investigation Options:  \n> > \n> > -   To analyze if performance impact is relevant to AB protection see section 4.7.7\n> > -   Until R81, AB Protection appears in the report as **Threat Prevention Protection - ID NUM**.\n> > -   [Contact Support](https://www.checkpoint.com/support-services/contact-support/) to understand which protection affects performance. \n> > \n> > If there is a change in the **Optimize Profile**, check if these features affect AV\\\\AB performance:  \n> \n> #### 4.7.4. URL Filtering \n> \n> Show / Hide this section\n> \n> > **Introduction**:  \n> > \n> > -   The RAD daemon contains a self-diagnostic system which automatically generates a log at _$FWDIR/log/rad\\_events/Error_ and _$FWDIR/log/rad\\_events/Timeout_ directories, The self-diagnostic system sends a log notification when such a log is generated.\n> > -   A typical log has the following format:  \n> >     -   A log header with the following items:\n> >         -   Flow ID = flow\\_<rad pid>\\_<request number>\n> >         -   Flow Termination Status:<Success / Failed>\n> >         -   Flow Started <time stamp>\n> >         -   Flow Ended <time stamp>\n> >         -   **Flow Total Runtime**:<total request handling time in seconds>\n> >         -   **Flow Steps** section which lists the steps RAD daemon performed while handling this specific request and how much time each step took. Normally there are 3 steps:\n> >             -   **Generic Trap Flow**: RAD received a request from the firewall kernel and starts to process items.\n> >             -   **Cloud Access**: RAD is sending the request to Check Point cloud.\n> >             -   **Handling Response**: RAD is processing the response that it got from Check Point cloud. \n> > -   **Flow Items** section: This section contains specific information relevant to this flow. Important flow items listed are:\n> >     -   Service=<blade that issued the request to RAD (could be malware, categorization, anti-virus etc...)>\n> >     -   Resource=<which url has been accessed that generates this request to rad>\n> >     -   FlowError=<last error in this flow>\n> > -   After the **Flow Items**, there is a debug messages section that contains the last 1024 debug messages relevant to this RAD daemon request.\n> > -   Categorization timeout log in SmartConsole: This may cause slowness if the categorization option is configured to “Hold” instead of “Background” in the HTTPS Inspection policy. A proper configuration of a DNS server, routing rules, NAT rules, proxy server, etc. on the Gateway may be required.\n> > \n> > **Basic Health Check**:\n> > \n> > When URLF blade is enabled, you can monitor the blade's operation with cpview.\n> > \n> > 1\\. Run: `rad_admin  stats on urlf`\n> > \n> > 2\\. Run: Cpview\n> > \n> > 3\\. Go to the RAD section in **Advanced** > **RAD**. \n> > \n> > The “Sent To Site” counter shows how many requests are sent to Check Point cloud for categorization\n> > \n> > The “Hit Count” counter shows how many requests are found in the local cache.\n> > \n> > When the URL Filtering Blade works correctly, one of these counters should progress.\n> > \n> > The “Active Flows” counter shows how many requests are processed by the URL Filtering Blade at this moment.\n> > \n> > The value should increase and then decrease to “1” during normal operation.\n> > \n> > **Common Problems and their Solutions**:\n> > \n> > 1\\. \"`Halting RAD requests handling - RAD reached maximum allowed concurrent requests`\" message appears in SmartConsole\n> > \n> > **Cause**: This error occurs when there is a bottleneck in RAD. To determine where the bottleneck is, look at the **Flow steps** section of the log and find which step takes up much time.\n> > \n> > **Solution**: If it is the **Cloud Access** step, then check connectivity to cws.checkpoint.com. Otherwise, consult with CFG. \n> > \n> >   \n> > 2\\. The **Handling Response** step fails and a \"`CRadXmlUrlf::listen: [ERROR] response expired: seconds difference:` \" error appears in the debug messages section of the log.\n> > \n> > **Solution**: Make sure the machine has a correct time zone and time setting.\n> > \n> >    \n> > 3\\. RAD daemon consumes more than 500% CPU.  \n> > \n> > > **Solution**: Most of the time, this is due to the Anti-Malware blade's response handling.\n> > > \n> > > To verify that this is the case run the following:\n> > > \n> > > `` #top -H -p `pidof rad` ``\n> > > \n> > > Now look at the read threads. If the threads that consume most of the CPU are named `rad_resp_slow`, it is necessary to increase the Anti-Malware kernel cache to improve RAD performance. This change in the kernel cache is integrated starting from:\n> > > \n> > > -   [Check Point R81.10](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk170416)\n> > > -   [Jumbo Hotfix Accumulator for R81](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk170114) starting from Take 34\n> > > -   [Jumbo Hotfix Accumulator for R80.40](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=skXXX) starting from Take 119\n> > > -   [Jumbo Hotfix Accumulator for R80.30](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=skXXX) starting from Take 237\n> \n> #### 4.7.5. HTTPS Inspection \n> \n> Show / Hide this section\n> \n> > -   WSTLSD Daemon   \n> >     -   _wstlsd_ is a multi-process daemon which is part of the TLS engine of HTTPS Inspection. Instability of this daemon can cause slowness in browsing and connectivity issues.\n> >     -   Basic Debugging  \n> >         -   Monitor the _wstlsd_ daemon and verify that it does not crash or restart often.\n> >         -   Check whether any errors appear in _$FWDIR/log/wstlsd.elg_\n> > -   SmartConsole Logs \n> >     -   Check if any “CRL Timeout” errors appear in the log. If they do, verify that the Gateway has internet access. A proper configuration of a DNS server, routing rules, NAT rules, proxy server, etc. on the Gateway may be required.\n> \n> #### 4.7.6. Pattern Matcher Impact  \n> \n> Show / Hide this section\n> \n> > **Investigation for versions before R81.10:** \n> > \n> > To verify if the CPU spike is applicable to PM, use Perf Top to check if the top function is higher (greater than 30%).\n> > \n> > -   If the function is applicable to Tier 1: Go to  the section **Protections Impact – Tier 1**\n> > -   If the function is applicable to Tier 2:  Go to the section **Protections Impact – Tier 2**\n> > -   If it is not applicable to PM: contact CFG.\n> > \n> > **Tier 1 functions:**\n> > \n> > -   kiss\\_thin\\_nfa\\_exec\n> > -   kiss\\_thin\\_nfa\\_exec\\_wrapper\\_1\n> > -   kiss\\_thin\\_nfa\\_exec\\_one\\_buf\\_parallel\\_ex\n> > -   kiss\\_thin\\_nfa\\_exec\\_one\\_buf\\_parallel\\_xlate\n> > -   kiss\\_dfa\\_exec\\_one\\_buf\n> > \n> > **Tier 2 functions:**\n> > \n> > -   pcre\\_dfa\\_exec\n> > -   kiss\\_pcre\\_exec\\_ex\n> > -   kiss\\_kw\\_pcre\\_re\\_execute\n> > -   kiss\\_dfa\\_exec\\_one\\_buf\n> > -   internal\\_dfa\\_exec\n> > \n> > **Investigation Procedure for version R81.10 and above:**    \n> > Refer to to [sk171436 - HealthCheck Point (HCP) Release Updates](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk171436&partition=Basic&product=Quantum%20).\n> > \n> > -   Enable the applicable HCP component.\n> > -   Run this command to enable the Threat Prevention blade:      \n> >     `hcp  --enable-product “Threat Prevention”`\n> > -   Run the “`hcp -r al`l” command. \n> > -   After you execute the HCP report, write down the location of the report.\n> > -   To view the report, move the report to your local drive and open it locally **OR** install the SmartConsole Extension according to the SK section “SmartConsole Extension Installation”. \n> > -   In the Report, go to “Threat Prevention” section and then select “Protections”. There you see the following: \n> >     -   Connection distribution\n> >     -   Heavy Connections\n> >     -   Pattern Matcher Impact (check the data here)\n> >     -   Protections Impact\n> > \n> > If the function is applicable to Tier 1: Go to  the section Protections Impact – Tier 1  \n> > If the function is applicable to Tier 2:  Go to the section Protections Impact – Tier 2  \n> > If it is not applicable to PM: contact CFG. \n> \n> #### 4.7.7. Protections Impact\n> \n> Show / Hide this section\n> \n> > This section is relevant only if you did the procedures in sections 4.3.1 or 4.7.6 focuses on protection\n> > \n> > Investigation for versions before R81.10:  \n> > \n> > To analyze the protection impact, you must run PM stat 3-4 times during the issue and compare the critical protection result Test (duration 60 seconds) the results you get from the Analyzer tool ([sk110737)](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk110737). \n> > \n> > -   Refer to [sk43733: How to measure CPU time consumed by PM](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk43733)\n> > \n> >   \n> > **Tier 1 protection analysis:**\n> > \n> > Manual steps:\n> > \n> > -   Open **tier1\\_patterns\\_output\\_file.csv** \n> > -   Sort the **Match** column from the largest to the smallest.\n> > -   The top protection can have an effect on PM. [Contact Support](https://www.checkpoint.com/support-services/contact-support/) for more information.\n> > -   If the **PM Name** is `fwk_regexp_inspect_prepare` [Contact Support](https://www.checkpoint.com/support-services/contact-support/) to understand which protection affects performance.\n> > -   **Note**: From R81.10, the HCP tool includes a protection impact test. Use it to analyze performance issues (refer to [sk171436](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk171436)).\n> > \n> > **Investigation for version R81.10 and above:** \n> > \n> > -   Open the health check from the report generated from the HCP in Section 4.7.6.\n> > -   In the Report, go to the “Threat Prevention” section and then “Protections”.\n> > -   Go to the Protection Impact section. In this section you can see the “Findings” and which protection impacts the performance level.\n> \n> ###   \n> 4.8. Frame loss\n> \n> #### 4.8.1. Software drops\n> \n> Show / Hide this section\n> \n> Description:\n> \n> -   A good indication of problems is software drops. If we encounter latency issues but our CPUs are not stressed, we should check the drops statistics.\n> \n> Drop reasons statistics:\n> \n> -   SecureXL drops\n>     -   `cpview (Network -> Traffic)`\n>     -   `cpview (Advanced -> SecureXL -> Drops )`\n>     -   `cpview (Advanced ->SecureXL -> Advanced -> Drop reasons) / fwaccel stats –d`\n> \n> Debug drops:\n> \n> -   `fw ctl zdebug + drop`\n> \n> dmesg:\n> \n> -   Soft lockups\n> -   Errors\n\n##   \n5\\. Appendix\n\n> ### 5.1. Related Solutions\n> \n> -   [sk98348: Best practice – Security Gateway Performance](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk98348) \n> -   [sk182223: Security Gateways with a large number of CPU cores allocated to CoreXL SND may experience performance issues when the \"fwaccel dos deny\" feature is configured](https://support.checkpoint.com/results/sk/sk182223) \n> -   [sk176908: fwk0\\_dev\\_0 consumes high CPU](https://support.checkpoint.com/results/sk/sk176908) \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorSapir Natan\n\nTechnical ResourceAmit Shmuel\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2020-06-23\n\nLast Modified2024-12-18\n\nEditorLiron Rubin\n\nLast ApproverLiron Rubin\n\n## Comments\n\n#### Internal only\n\n****Add R81.20 after release of version  \n****\n\n___\n\n**This section is still awaiting review. Do not share it with customers.** \n\n## HTTPS Inspection\n\n> If the customer experiences slow connectivity to https sites once the feature is enabled, check the following:\n> \n> 1\\. **SmartConsole Logs**: Pay attention to the following logs in SmartConsole:  \n> \n> -   **CRL Timeout**: If it exists, verify that your Gateway has a proper proxy configured so it can access the CRL/OCSP during negotiation. \n> -   **URL Categorization Time-Out**: This can cause slowness if it is configured to hold the connection until the categorization is complete. As in the above bullet (CRL Timeout), make sure the proxy is configured on your Gateway.\n> \n> 2\\. **Crashes**: On the Gateway’s terminal, run the command below several times and check if the process ID keeps changing. There may be multiple instances of the process, but none of them should change its process ID. This may indicate that _wstlsd_ is crashing, generating a\n\n___\n\nPMTR-66261 is the increase of the Anti-Malware kernel cache to improve RAD performance.\n\n___\n\n**Tier 1 protection analysis:  \n**Refer to [sk174804 - Critical Performance Protections - Flow analysis](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk174804)   \nRefer to [sk177825 - Disable protections and applications based on LSS value](https://supportcenter.us.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk177825)\n\n___\n\n**Tier 2 protection analysis:** \n\n-   How to analyze PM stat (**Internal use only**): See [PM Statistics - Analyzing and debugging.](https://wiki.checkpoint.com/confluence/pages/viewpage.action?spaceKey=CPPublic&title=PM+Statistics+-+Analyzing+and+debugging#PMStatistics-Analyzinganddebugging-AnalyzingPMstatisticsusingourtool*NEW)\n-   Critical Performance Protections Flow analysis (**Internal use only**)-  Refer to [sk174804](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk174804) \n-   Tier 2 protection analysis: Use the IPS Analyzer Tool. See [sk110737: IPS Analyzer Tool - How to analyze IPS and/or PM (pattern matcher) performance efficiently](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk110737)","language":"md","time":"14 days ago","created":"2025-05-06T22:56:18.041Z","annotations":[],"updated":"2025-05-06T23:04:54.447Z"},{"title":"Check Point CME Upgrade Failure Troubleshooting","id":"a710c693-a9b3-4797-b198-49ae7f68e7da","type":"TEXT","raw":"ProductMulti-Domain Security Management, Quantum Security Management\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nLast Modified2024-02-19\n\n#### For internal users only\n\n## Symptoms\n\n-   You receive a `\"step Install Hotfix Action verification failed\"` error when running CME upgrade with installation script on Management HA environment, and the upgrade fails.\n    \n-   A CME upgrade with the Offline package procedure based on [sk157492](https://support.checkpoint.com/results/sk/sk157492) fails.\n    \n-   Review of the log in _/opt/CPInstLog/AutoUpdateLogs/CME_ shows installation fails with this message:  \n    `Error: Action Install Bundle Action aborted: step Install Hotfix Action verification failed`\n    \n-   Happens for CME package online or for offline installation.\n\n## Cause\n\nA RPM installation fails, causing the CME installation to fail.\n\nIssue only relevant for machines running with last Deployment installer take 26. \n\n## Solution\n\nTo verify the component version on the machine, run the following command in Expert mode:\n\n`# cpvinfo /opt/CPDepInst/latest/bin/da_installer`\n\nThe issue will be resolved in next Deployment installer take release. \n\n**To upgrade the CME, use the following workaround:**\n\nRevert the CME installation and install the new CME package manually. \n\n1.  To revert the current CME package run:\n    \n    `# autoupdatercli revert-completely CME`\n    \n2.  Install the new package manually or run “`autoupdatercli stop`” to restart the autoupdate process and run the installation again. For details refer to [sk157492.](https://support.checkpoint.com/results/sk/sk157492) \n    \n\n**Note:** You can safely revert the CME. It does not delete the current configuration.\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorEva Karasik\n\nTechnical ResourceMaria Terentiev\n\nAccess LevelGeneral\n\nStatusApproved by TAC\n\nDate Created2024-01-28\n\nLast Modified2024-02-19\n\nEditorEva Karasik\n\nLast ApproverGil Frantsus\n\n## Comments\n\n#### Internal only","language":"md","time":"14 days ago","created":"2025-05-06T22:56:25.085Z","annotations":[],"updated":"2025-05-06T23:04:07.151Z"},{"title":"Troubleshooting Step Table","id":"089385e8-f1e8-42b5-8381-4fbf3cc487ad","type":"TEXT","raw":"<table id=\"TroubleshootingStepsTable\"><tbody><tr><td>Output of 'mlxlink'</td><td>Possible Root Cause</td><td>Next Step</td></tr><tr><td><p>The \"<strong>Troubleshooting Info</strong>\" section shows:</p><p><code>Status Opcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: 14<br>Group Opcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: PHY FW<br>Recommendation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Peer is sending remote faults.</code></p><p>and</p><p>The \"<strong>Operational Info</strong>\" section shows:</p><p><code>State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Physical LinkUp<br>Physical state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: LinkUp</code></p></td><td><p>Faulty transceiver(s) or faulty cable</p></td><td><p>Replace the transceiver(s) and the cable</p></td></tr><tr><td><p>The \"<strong>Troubleshooting Info</strong>\" section shows:</p><p><code>Status Opcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: 36<br>Group Opcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: PHY FW<br>Recommendation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Force Mode no partner detected.</code></p><p>and</p><p>The \"<strong>Operational Info</strong>\" section shows:</p><p><code>State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Polling<br>Physical state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ETH_AN_FSM_ABILITY_DETECT</code></p></td><td><p>Mismatch between the port speeds on the Orchestrator and on the Switch / Security Appliance NIC</p></td><td><p>Configure the same port speed both sides - Orchestrator and Switch / Security Appliance NIC</p></td></tr><tr><td><p>The \"<strong>Troubleshooting Info</strong>\" section shows:</p><p><code>Status Opcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: 1<br>Group Opcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: PHY FW<br>Recommendation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: The port is closed by command. Please check that the interface is enabled.</code></p><p>and</p><p>The \"<strong>Operational Info</strong>\" section shows:</p><p><code>State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Disable<br>Physical state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ETH_AN_FSM_ENABLE</code></p></td><td><p>The administrative state of the corresponding port on the Orchestrator is \"down\"</p></td><td><p>Change the administrative state of the corresponding port to \"up\" - see <a href=\"https://support.checkpoint.com/results/sk/sk182023\" target=\"_blank\" rel=\"noopener\">sk182023</a></p></td></tr><tr><td><p>The \"<strong>Troubleshooting Info</strong>\" section shows:</p><p><code>Status Opcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: 39<br>Group Opcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: PHY FW<br>Recommendation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Auto-negotiation no hcd agreed.</code></p><p>and</p><p>The \"<strong>Operational Info</strong>\" section shows:</p><p><code>State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Polling<br>Physical state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ETH_AN_FSM_XMIT_DISABLE</code></p></td><td><p>Mismatch between the port speeds on the Orchestrator and on the Security Appliance NIC (for example, the Security Appliance NIC is configured for 40 Gbps, while the Orchestrator port is configured for 100 Gbps)</p></td><td><p>Configure the same port speed both sides - Orchestrator and Security Appliance NIC</p></td></tr><tr></tr><tr><td><p>The \"<strong>Troubleshooting Info</strong>\" section shows:</p><p><code>Status Opcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: 0<br>Group Opcode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: N/A<br>Recommendation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: No issue was observed.</code></p><p>and</p><p>The \"<strong>Operational Info</strong>\" section shows:</p><p><code>State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Polling<br>Physical state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ETH_AN_FSM_NEXT_PAGE_WAIT<br>Auto Negotiation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ON</code></p></td><td><div><p>A peer device does not respond to an auto-negotiation handshake.<br>Example:<br>An Orchestrator is connected to a Cisco switch with a DAC cable. The Cisco switch port does not respond to link negotiation.</p></div></td><td><p>Disable auto-negotiation on the peer device's port.<br>If issue persists, disable auto-negotiation on the Orchestrator port as well.</p></td></tr><tr><td><p>The \"<strong>Troubleshooting Info</strong>\" section shows:</p><p><code>Recommendation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: The module/cable requires more power than the system can supply.</code></p></td><td><p>On Maestro Orchestrator MHO-170, a transceiver that requires more than 3.5W is inserted into this port</p></td><td><p>Known Limitation PMTR-89360 - on Maestro Orchestrator MHO-170, you can insert the transceiver CPAC-TR-100ERL4 only in ports 1, 2, 31, and 32 - only these ports support modules that require more than 3.5W and up to 5W (power class 7)</p></td></tr><tr><td>Output of 'cplink'</td><td>Possible Root Cause</td><td>Next Step</td></tr><tr><td><p>The \"<strong>Troubleshooting Info</strong>\" section shows:</p><p><code>Recommendation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Peer is sending remote faults.</code></p><p>and</p><p>The \"<strong>Operational Info</strong>\" section shows:</p><p><code>State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Physical LinkUp<br>Physical state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: LinkUp</code></p></td><td><p>Faulty transceiver(s) or faulty cable</p></td><td><p>Replace the transceiver(s) and the cable</p></td></tr><tr><td><p>The \"<strong>Troubleshooting Info</strong>\" section shows:</p><p><code>Recommendation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Force Mode no partner detected.</code></p><p>and</p><p>The \"<strong>Operational Info</strong>\" section shows:</p><p><code>State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Polling</code></p></td><td><p>Mismatch between the port speeds on the Orchestrator and on the Switch / Security Appliance NIC</p></td><td><p>Configure the same port speed both sides - Orchestrator and Switch / Security Appliance NIC</p></td></tr><tr><td><p>The \"<strong>Troubleshooting Info</strong>\" section shows:</p><p><code>Recommendation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: The port is closed by command. Please check that the interface is enabled.</code></p><p>and</p><p>The \"<strong>Operational Info</strong>\" section shows:</p><p><code>State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Disable</code></p></td><td><p>The administrative state of the corresponding port on the Orchestrator is \"down\"</p></td><td><p>Change the administrative state of the corresponding port to \"up\" - see <a href=\"https://support.checkpoint.com/results/sk/sk182023\" target=\"_blank\" rel=\"noopener\">sk182023</a></p></td></tr><tr><td><p>The \"<strong>Troubleshooting Info</strong>\" section shows:</p><p><code>Recommendation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Auto-negotiation no hcd agreed.</code></p><p>and</p><p>The \"<strong>Operational Info</strong>\" section shows:</p><p><code>State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Polling<br>Physical state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ETH_AN_FSM_XMIT_DISABLE</code></p></td><td><p>Mismatch between the port speeds on the Orchestrator and on the Security Appliance NIC (for example, the Security Appliance NIC is configured for 40 Gbps, while the Orchestrator port is configured for 100 Gbps)</p></td><td><p>Configure the same port speed both sides - Orchestrator and Security Appliance NIC</p></td></tr><tr><td><p>The \"<strong>Troubleshooting Info</strong>\" section shows:</p><p><code>Recommendation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: No issue was observed.</code></p><p>and</p><p>The \"<strong>Operational Info</strong>\" section shows:</p><p><code>State&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: Polling<br>Physical state&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ETH_AN_FSM_NEXT_PAGE_WAIT<br>Auto Negotiation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ON</code></p></td><td><div><p>A peer device does not respond to an auto-negotiation handshake.<br>Example:<br>An Orchestrator is connected to a Cisco switch with a DAC cable. The Cisco switch port does not respond to link negotiation.</p></div></td><td><p>Disable auto-negotiation on the peer device's port.<br>If issue persists, disable auto-negotiation on the Orchestrator port as well.</p></td></tr><tr><td><p>The \"<strong>Troubleshooting Info</strong>\" section shows:</p><p><code>Recommendation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: The module/cable requires more power than the system can supply.</code></p></td><td><p>On Maestro Orchestrator MHO-170, a transceiver that requires more than 3.5W is inserted into this port</p></td><td><p>Known Limitation PMTR-89360 - on Maestro Orchestrator MHO-170, you can insert the transceiver CPAC-TR-100ERL4 only in ports 1, 2, 31, and 32 - only these ports support modules that require more than 3.5W and up to 5W (power class 7)</p></td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:23.375Z","annotations":[],"updated":"2025-05-06T23:03:10.336Z"},{"title":"RMA: Failed Orchestrator and Quantum Maestro","id":"1dfc4361-ef24-419a-8455-55d41394d014","type":"TEXT","raw":"**Table of Contents:**\n\n-   Important Notes\n    \n-   Procedure for Orchestrators R82 - Failed Orchestrator is still accessible\n    \n-   Procedure for Orchestrators R82 - Failed Orchestrator is not accessible\n    \n-   Procedure for Orchestrators R81.20, R81.20 Jumbo Hotfix (all Takes), or R81.10 Jumbo Hotfix Take 61 (and higher)\n    \n-   Procedure for Orchestrators R81.10, or R81.10 Jumbo Hotfix Take 55 (and lower)\n    \n-   Procedure for Orchestrators R80.20SP - Failed Orchestrator is still accessible\n    \n-   Procedure for Orchestrators R80.20SP Jumbo Hotfix Take 309 (and lower) - Failed Orchestrator is not accessible\n    \n-   Revision History\n    \n\nFollow the steps below to replace (RMA) a failed Quantum Maestro Orchestrator.\n\n### Important Notes\n\n-   We recommend to schedule a maintenance window.\n-   In a Dual Site deployment, do the RMA procedure on the Site that is the Standby Site at the time of replacement. If the Orchestrator fails on Site # 1 and this Site was active, you must failover to Site # 2 and make it Active, with Site # 1 as the Standby. Then continue with the RMA procedure.\n\nThe procedure below uses these Orchestrator IDs:\n\n-   ID of the Orchestrator that continues to work - 1\\_1\n-   ID of the Orchestrator that failed - 1\\_2\n\n### Procedure for Orchestrators that run the R82 version - when the failed Orchestrator is still accessible\n\nShow / Hide this section\n\n**Important Note - It is not supported to import a backup file from another working Orchestrator. This procedure requires a backup file from the failed Orchestrator.**\n\n1.  On the failed Orchestrator, stop the Orchestrator service:\n    \n    1.  Connect to the command line on the failed Orchestrator.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Stop the service:\n        \n2.  If previously you configured the authentication between Orchestrators, then on each working Orchestrator you must revoke the authentication with the failed Orchestrator.\n    \n    See the [R82 Scalable Platforms Administration Guide](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ScalablePlatforms_AdminGuide/Default.htm#cshid=ID002) > Chapter \"**Working with Quantum Maestro**\" > Section \"**Authentication between Maestro Orchestrators**\".\n    \n    You can revoke the authentication in Gaia Portal (recommended) or in CLI (Gaia Clish, or Expert mode).\n    \n3.  On the failed Orchestrator, create the Gaia backup (it contains the Maestro configuration):\n    \n    **Critical Note** - On the replacement Orchestrator, you must import this Gaia backup file that contains the most recent Security Group configuration.\n    \n    You can create this Gaia backup in Gaia Portal (recommended) or in Gaia Clish.\n    \n    -   To create this Gaia backup in Gaia Portal:\n        \n        1.  With a web browser, connect to the failed Orchestrator:\n            \n            `https://<IPv4 Address of \"MGMT\" Port>`\n            \n            Log in with the username \"`admin`\" and the corresponding password.\n            \n        2.  Go to **Maintenance** > **System Backup**.\n            \n        3.  Click **Backup** > select **This appliance**.\n            \n        4.  Click **Export** to download this Gaia backup file to your computer.\n            \n    -   To create this Gaia backup in Gaia Clish:\n        \n        1.  Connect to the command line on the failed Orchestrator.\n            \n        2.  Log in to Gaia Clish.\n            \n        3.  Create a local Gaia backup:\n            \n        4.  Copy the Gaia backup file from the failed Orchestrator:\n            \n            1.  Connect with WinSCP to the failed Orchestrator.\n                \n                **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n                \n            2.  Go to this path:\n                \n                `/var/log/CPbackup/backups/`\n                \n            3.  Download the Gaia backup file to your computer.\n                \n4.  On the failed Orchestrator, write down the port numbers, to which the **Uplink** cables, the **Downlink** cables, and the **Sync** cables are connected.\n    \n5.  On the failed Orchestrator, disconnect all network cables and the power cables.\n    \n6.  Remove the failed Orchestrator from the rack.\n    \n7.  Install the replacement Orchestrator **of the same model** in the rack.\n    \n    **Important Note** - Do **not** connect the power or network cables yet. You do it gradually later.\n    \n8.  On the replacement Orchestrator, connect only these cables:\n    \n    See the [Quantum Maestro Getting Started Guide](https://sc1.checkpoint.com/documents/Appliances/GSG_Maestro/EN/Default.htm).\n    \n    1.  Connect a network cable from your computer to the Orchestrator's \"**MGMT**\" port.\n        \n    2.  Connect the console cable from your computer to the Orchestrator's **Console** port.\n        \n        In your console client application, configure these settings:\n        \n        -   Baud Rate - 9600\n        -   Data bits - 8\n        -   Stop bits - 1\n        -   Parity - None\n        -   Flow Control - None\n    3.  Connect the power cables to the Orchestrator's Power Supply Units.\n        \n9.  On the replacement Orchestrator, in the **console** session, log in to Gaia Clish.\n    \n    **Important Note** - Do **not** perform the First Time Configuration Wizard yet.\n    \n10.  On the replacement Orchestrator, configure the Orchestrator's \"**MGMT**\" port:\n    \n    1.  Configure the IPv4 address and Mask Length:\n        \n        `set interface Mgmt1 ipv4-address <IPv4 Address of \"MGMT\" Port> mask-length <Mask>`\n        \n    2.  Enable the \"MGMT\" port:\n        \n        `set interface Mgmt1 state on`\n        \n    3.  Configure the default gateway:\n        \n        `set static-route default nexthop gateway address <IPv4 Address of Default Gateway> on`\n        \n    4.  Save the changes:\n        \n    \n    For information about these Gaia Clish commands, see the [R82 Gaia Administration Guide](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm).\n    \n11.  On the replacement Orchestrator, connect these cables to ports with the same numbers as they were connected on the failed Orchestrator:\n    \n    -   The **Downlink** cables\n        \n    -   The **Sync** cables\n        \n    \n    **Important Note** - Make sure you connected the cables to the correct ports.\n    \n12.  On the replacement Orchestrator, run the First Time Configuration Wizard:\n    \n    **Important Note** - Do **not** import the backup file from the failed Orchestrator. You must do it later.\n    \n    1.  With a web browser, connect to the replacement Orchestrator:\n        \n        `https://<IPv4 Address of \"MGMT\" Port>`\n        \n        Log in with the username \"`admin`\" and the default password \"`admin`\".\n        \n    2.  On the second page **Deployment Options**, select **Join an existing Maestro environment**.\n        \n    3.  Follow the rest of the wizard pages.\n        \n    4.  Wait for the Orchestrator to reboot.\n        \n13.  On the replacement Orchestrator, install the same Take of the **R82 Jumbo Hotfix Accumulator** as installed on **working** Orchestrators (in our example, \"1\\_1\").\n    \n    1.  Copy the Jumbo Hotfix Accumulator package to the replacement Orchestrator:\n        \n        1.  Connect with WinSCP to the IPv4 address of the \"MGMT\" port on the replacement Orchestrator.\n            \n            **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n            \n        2.  Go to some path. For example:\n            \n        3.  Upload the Jumbo Hotfix Accumulator package from your computer.\n            \n    2.  Connect with an SSH client to the IPv4 address of the \"MGMT\" port.\n        \n    3.  Log in to Gaia Clish.\n        \n    4.  Obtain the lock over the Gaia configuration database:\n        \n    5.  Import the CPUSE package from the hard disk:\n        \n        Note: When the import completes, this package is deleted from the original location.\n        \n        `installer import local <Full_Path>/<Package_File_Name>`\n        \n    6.  Show the imported packages:\n        \n        `show installer packages imported`\n        \n    7.  Verify the package - see whether this package can be installed without conflicts:\n        \n        `installer verify`_\\[press Space key\\]\\[press Tab key\\]_\n        \n        `installer verify <Package_Number>`\n        \n    8.  Install the package:\n        \n        `installer install <Package_Number>`\n        \n    9.  Wait for the Orchestrator to reboot.\n        \n14.  On the replacement Orchestrator, import the Gaia backup file from the failed Orchestrator.\n    \n    You can import this Gaia backup in Gaia Portal (recommended) or in Gaia Clish.\n    \n    -   To import this Gaia backup in Gaia Portal:\n        \n        1.  With a web browser, connect to the replacement Orchestrator:\n            \n            `https://<IPv4 Address of \"MGMT\" Port>`\n            \n            Log in with the username \"`admin`\" and the new password you configured in the First Time Configuration Wizard.\n            \n        2.  Go to **Maintenance** > **System Backup**.\n            \n        3.  Click **Import** > select the Gaia backup file on your computer.\n            \n        4.  In Gaia Portal, click the imported Gaia backup file.\n            \n        5.  Click **Restore**.\n            \n        6.  Wait for the Orchestrator to reboot.\n            \n    -   To import this Gaia backup in Gaia Clish:\n        \n        1.  Copy the Gaia backup file from your computer to the replacement Orchestrator:\n            \n            1.  Connect with WinSCP to the replacement Orchestrator.\n                \n                **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n                \n            2.  Go to this path:\n                \n                `/var/log/CPbackup/backups/`\n                \n            3.  Upload the Gaia backup file from your computer.\n                \n        2.  Connect to the command line on the replacement Orchestrator.\n            \n        3.  Log in to Gaia Clish.\n            \n        4.  Restore the local Gaia backup:\n            \n            `set backup restore <Name of Backup File from Failed Orchestrator>`\n            \n        5.  Wait for the Orchestrator to reboot.\n            \n15.  If previously you configured the authentication between Orchestrators, you must configure it again (between all working Orchestrators) to trust the replacement Orchestrator.\n    \n    See the [R82 Scalable Platforms Administration Guide](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ScalablePlatforms_AdminGuide/Default.htm#cshid=ID002) > Chapter \"**Working with Quantum Maestro**\" > Section \"**Authentication between Maestro Orchestrators**\".\n    \n    You can configure the authentication in Gaia Portal (recommended) or in CLI (Gaia Clish, or Expert mode).\n    \n16.  On all Orchestrators, make sure the traffic can pass between Orchestrators:\n    \n    -   In a Single Site deployment:\n        \n        On a working Orchestrator (in our example, \"1\\_1\"), send several pings to the replacement Orchestrator (in our example, \"1\\_2\"):\n        \n    -   In a Dual Site deployment:\n        \n        On the replacement Orchestrator (in our example, \"1\\_2\"), send several pings to **each** working Orchestrator:\n        \n        <table><tbody><tr><td><p><code>ping -c 5 1_1</code></p></td></tr><tr><td><p><code>ping -c 5 2_1</code></p></td></tr><tr><td><p><code>ping -c 5 2_2</code></p></td></tr></tbody></table>\n        \n17.  Make sure the Security Group Members can pass traffic to each other:\n    \n    1.  Connect to the command line on the Security Group.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Identify the Security Group Member that runs as SMO:\n        \n    4.  If the SMO task runs on another Security Group Member than the Security Group Member to which you are connected, then go to the context of that SMO Security Group Member:\n        \n        `member <ID of Site>_<ID of Security Group Member>`\n        \n        Example: `member 1_2`\n        \n    5.  Examine the cluster state of the Security Group Members.\n        \n        The output must show the state of **each** Security Group Member as \"`ACTIVE`\".\n        \n    6.  Send several pings between Security Group Members:\n        \n        1.  Connect to one of the Security Group Members  \n            (in our example, we connect to the first one - \"1\\_1\"):\n            \n        2.  On this Security Group Member, send several pings to any other Security Group Member  \n            (in our example, we send several pings to the second one - \"1\\_2\" / \"2\\_2\"):\n            \n            -   In a Single Site deployment:\n                \n            -   In a Dual Site deployment:\n                \n                <table><tbody><tr><td><p><code>ping -c 5 1_2</code></p></td></tr><tr><td><p><code>ping -c 5 2_2</code></p></td></tr></tbody></table>\n                \n18.  On the replacement Orchestrator, connect the **Uplink** cables to the ports with the same numbers as they were connected on the failed Orchestrator.\n    \n19.  On each Security Group, make sure all the required links have the status \"`UP`\":\n    \n    1.  Connect to the command line on the Security Group.\n        \n    2.  Log in.\n        \n    3.  If your default shell is the Expert mode, then go to Gaia gClish:\n        \n    4.  Examine the state of links:\n        \n        `show cluster info interfaces`\n        \n\n### Procedure for Orchestrators that run the R82 version - when the failed Orchestrator is not accessible\n\nShow / Hide this section\n\n1.  On a working Orchestrator, export the configuration files for the failed Orchestrator:\n    \n    1.  Connect to the command line on the working Orchestrator - the peer Orchestrator on the same Site.\n        \n    2.  Log in to Gaia Clish.\n        \n    3.  Export the configuration files for the failed Orchestrator:\n        \n        `set maestro export remote orchestrator id <ID of the Failed Orchestrator> configuration archive-name <Name of Output Archive File> path <Full Path to Directory>`\n        \n        Example:\n        \n        `set maestro export remote orchestrator id 1_2 configuration archive-name Export_Of_Config_for_Failed_Orch_1_2 path /var/log/`\n        \n        The output file is: `/var/log/Export_Of_Config_for_Failed_Orch_1_2.tgz`\n        \n2.  Copy the archive with the exported configuration files from the working Orchestrator:\n    \n    1.  Connect with WinSCP to this working Orchestrator.\n        \n        **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n        \n    2.  Go to the path you used during the export:\n        \n        `<Full Path on Working Orchestrator>`\n        \n        In our example, go to: `/var/log/`\n        \n    3.  Download the archive file to your computer.\n        \n        In our example, download this file: `Export_Of_Config_for_Failed_Orch_1_2.tgz`\n        \n3.  On the failed Orchestrator, stop the Orchestrator service:\n    \n    1.  Connect to the command line on the failed Orchestrator.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Stop the service:\n        \n4.  If previously you configured the authentication between Orchestrators, then on each working Orchestrator you must revoke the authentication with the failed Orchestrator.\n    \n    See the [R82 Scalable Platforms Administration Guide](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ScalablePlatforms_AdminGuide/Default.htm#cshid=ID002) > Chapter \"**Working with Quantum Maestro**\" > Section \"**Authentication between Maestro Orchestrators**\".\n    \n    You can revoke the authentication in Gaia Portal (recommended) or in CLI (Gaia Clish, or Expert mode).\n    \n5.  On the failed Orchestrator, write down the port numbers, to which the **Uplink** cables, the **Downlink** cables, and the **Sync** cables are connected.\n    \n6.  On the failed Orchestrator, disconnect all network cables and the power cables.\n    \n7.  Remove the failed Orchestrator from the rack.\n    \n8.  Install the replacement Orchestrator **of the same model** in the rack.\n    \n    **Important Note** - Do **not** connect the power or network cables yet. You do it gradually later.\n    \n9.  On the replacement Orchestrator, connect only these cables:\n    \n    See the [Quantum Maestro Getting Started Guide](https://sc1.checkpoint.com/documents/Appliances/GSG_Maestro/EN/Default.htm).\n    \n    1.  Connect a network cable from your computer to the Orchestrator's \"**MGMT**\" port.\n        \n    2.  Connect the console cable from your computer to the Orchestrator's **Console** port.\n        \n        In your console client application, configure these settings:\n        \n        -   Baud Rate - 9600\n        -   Data bits - 8\n        -   Stop bits - 1\n        -   Parity - None\n        -   Flow Control - None\n    3.  Connect the power cables to the Orchestrator's Power Supply Units.\n        \n10.  On the replacement Orchestrator, in the **console** session, log in to Gaia Clish.\n    \n    **Important Note** - Do **not** perform the First Time Configuration Wizard yet.\n    \n11.  On the replacement Orchestrator, configure the Orchestrator's \"**MGMT**\" port:\n    \n    1.  Configure the IPv4 address and Mask Length:\n        \n        `set interface Mgmt1 ipv4-address <IPv4 Address of \"MGMT\" Port> mask-length <Mask>`\n        \n    2.  Enable the \"MGMT\" port:\n        \n        `set interface Mgmt1 state on`\n        \n    3.  Configure the default gateway:\n        \n        `set static-route default nexthop gateway address <IPv4 Address of Default Gateway> on`\n        \n    4.  Save the changes:\n        \n    \n    For information about these Gaia Clish commands, see the [R82 Gaia Administration Guide](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_Gaia_AdminGuide/Default.htm).\n    \n12.  On the replacement Orchestrator, run the First Time Configuration Wizard:\n    \n    **Important Note** - Do **not** import the backup file from the failed Orchestrator. You must do it later.\n    \n    1.  With a web browser, connect to the replacement Orchestrator:\n        \n        `https://<IPv4 Address of \"MGMT\" Port>`\n        \n        Log in with the username \"`admin`\" and the default password \"`admin`\".\n        \n    2.  On the second page **Deployment Options**, select **Join an existing Maestro environment**.\n        \n    3.  Follow the rest of the wizard pages.\n        \n    4.  Wait for the Orchestrator to reboot.\n        \n13.  On the replacement Orchestrator, install the same Take of the **R82 Jumbo Hotfix Accumulator** as installed on **working** Orchestrators (in our example, \"1\\_1\").\n    \n    1.  Copy the Jumbo Hotfix Accumulator package to the replacement Orchestrator:\n        \n        1.  Connect with WinSCP to the IPv4 address of the \"MGMT\" port on the replacement Orchestrator.\n            \n            **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n            \n        2.  Go to some path. For example:\n            \n        3.  Upload the Jumbo Hotfix Accumulator package from your computer.\n            \n    2.  Connect with an SSH client to the IPv4 address of the \"MGMT\" port.\n        \n    3.  Log in to Gaia Clish.\n        \n    4.  Obtain the lock over the Gaia configuration database:\n        \n    5.  Import the CPUSE package from the hard disk:\n        \n        Note: When import completes, this package is deleted from the original location.\n        \n        `installer import local <Full_Path>/<Package_File_Name>`\n        \n    6.  Show the imported packages:\n        \n        `show installer packages imported`\n        \n    7.  Verify the package - see whether this package can be installed without conflicts:\n        \n        `installer verify`_\\[press Space key\\]\\[press Tab key\\]_\n        \n        `installer verify <Package_Number>`\n        \n    8.  Install the package:\n        \n        `installer install <Package_Number>`\n        \n    9.  Wait for the Orchestrator to reboot.\n        \n14.  On the replacement Orchestrator, import the configuration files you exported earlier from a working Orchestrator:\n    \n    1.  Copy the archive file from your computer to the replacement Orchestrator:\n        \n        1.  Connect with WinSCP to the replacement Orchestrator.\n            \n            **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n            \n        2.  Go to some path. For example:\n            \n        3.  Upload the archive file with the configuration files from your computer.\n            \n            In our example, upload this file: `Export_Of_Config_for_Failed_Orch_1_2.tgz`\n            \n    2.  Connect to the command line on the replacement Orchestrator.\n        \n    3.  Log in to Gaia Clish.\n        \n    4.  Import the configuration files:\n        \n        `set maestro import configuration archive-name <Name of Output Archive File> path <Full Path to Directory>`\n        \n        In our example, run:\n        \n        `set maestro import configuration archive-name Export_Of_Config_for_Failed_Orch_1_2.tgz path /var/log/`\n        \n15.  On all Orchestrators, make sure the configuration files are the same:\n    \n    1.  Connect to the command line on **each** Orchestrator.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Calculate the MD5 checksum for the Orchestrator configuration:\n        \n        `jsont -f /etc/sgdb.json -P | egrep -v \"topology_timestamp|session_id|active_sgms|all_sgm\" | md5sum`\n        \n    \n    The MD5 checksums must be the same on all Orchestrators.\n    \n    If the MD5 checksums are different:\n    \n    1.  Copy the `/etc/sgdb.json` file from the working Orchestrator (in our example, \"1\\_1\") to the replacement Orchestrator (in our example, \"1\\_2\") to the `/etc/` directory.\n        \n        Available copy options:\n        \n        -   Copy the file directly between Orchestrators.\n            \n            In the Expert mode on the working Orchestrator, run:\n            \n            `scp /etc/sgdb.json admin@<IP_Address_of_MGMT_Port_on_Replacement_Orchestrator>:/etc/`\n            \n            Example:\n            \n            `scp /etc/sgdb.json admin@192.168.3.57:/etc/`\n            \n        -   Use WinSCP and your computer as an intermediate place.\n            \n    2.  Calculate the MD5 checksum for the Orchestrator configuration again:\n        \n        `jsont -f /etc/sgdb.json -P | egrep -v \"topology_timestamp|session_id|active_sgms|all_sgm\" | md5sum`\n        \n16.  On the replacement Orchestrator, connect these cables to ports with the same numbers as they were connected on the failed Orchestrator:\n    \n    -   The **Downlink** cables\n        \n    -   The **Sync** cables\n        \n    \n    **Important Note** - Make sure you connected the cables to the correct ports.\n    \n17.  On the replacement Orchestrator, start the Orchestrator service:\n    \n    1.  Log in to the Expert mode.\n        \n    2.  Check the Orchestrator service status:\n        \n    3.  If the Orchestrator is **not** active, then start the Orchestrator service:\n        \n18.  If previously you configured the authentication between Orchestrators, you must configure it again (between all working Orchestrators) to trust the replacement Orchestrator.\n    \n    See the [R82 Scalable Platforms Administration Guide](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ScalablePlatforms_AdminGuide/Default.htm#cshid=ID002) > Chapter \"**Working with Quantum Maestro**\" > Section \"**Authentication between Maestro Orchestrators**\".\n    \n    You can configure the authentication in Gaia Portal (recommended) or in CLI (Gaia Clish, or Expert mode).\n    \n19.  On all Orchestrators, make sure the traffic can pass between Orchestrators:\n    \n    -   In a Single Site deployment:\n        \n        On a working Orchestrator (in our example, \"1\\_1\"), send several pings to the replacement Orchestrator (in our example, \"1\\_2\"):\n        \n    -   In a Dual Site deployment:\n        \n        On the replacement Orchestrator (in our example, \"1\\_2\"), send several pings to **each** working Orchestrator:\n        \n        <table><tbody><tr><td><p><code>ping -c 5 1_1</code></p></td></tr><tr><td><p><code>ping -c 5 2_1</code></p></td></tr><tr><td><p><code>ping -c 5 2_2</code></p></td></tr></tbody></table>\n        \n20.  Make sure the Security Group Members can pass traffic to each other:\n    \n    1.  Connect to the command line on the Security Group.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Identify the Security Group Member that runs as SMO:\n        \n    4.  If the SMO task runs on another Security Group Member than the Security Group Member to which you are connected, then go to the context of that SMO Security Group Member:\n        \n        `member <ID of Site>_<ID of Security Group Member>`\n        \n        Example: `member 1_2`\n        \n    5.  Examine the cluster state of the Security Group Members.\n        \n        The output must show the state of **each** Security Group Member as \"`ACTIVE`\".\n        \n    6.  Send several pings between Security Group Members:\n        \n        1.  Connect to one of the Security Group Members  \n            (in our example, we connect to the first one - \"1\\_1\"):\n            \n        2.  On this Security Group Member, send several pings to any other Security Group Member  \n            (in our example, we send several pings to the second one - \"1\\_2\" / \"2\\_2\"):\n            \n            -   In a Single Site deployment:\n                \n            -   In a Dual Site deployment:\n                \n                <table><tbody><tr><td><p><code>ping -c 5 1_2</code></p></td></tr><tr><td><p><code>ping -c 5 2_2</code></p></td></tr></tbody></table>\n                \n21.  On the replacement Orchestrator, connect the **Uplink** cables to the ports with the same numbers as they were connected on the failed Orchestrator.\n    \n22.  On each Security Group, make sure all the required links have the status \"`UP`\":\n    \n    1.  Connect to the command line on the Security Group.\n        \n    2.  Log in.\n        \n    3.  If your default shell is the Expert mode, then go to Gaia gClish:\n        \n    4.  Examine the state of links:\n        \n        `show cluster info interfaces`\n        \n\n### Procedure for Orchestrators that run the version R81.20, R81.20 Jumbo Hotfix (all Takes), or R81.10 Jumbo Hotfix Take 61 (and higher)\n\nShow / Hide this section\n\nThis procedure applies only to Orchestrators that run one of these versions:\n\n-   R81.20 without the R81.20 Jumbo Hotfix Accumulator\n-   R81.20 with the R81.20 Jumbo Hotfix Accumulator, any Take\n-   R81.10 with the R81.10 Jumbo Hotfix Accumulator, Take 61 and higher\n\nProcedure:\n\n1.  On the working Orchestrator, create the Gaia backup (it contains the Maestro configuration):\n    \n    You can create this Gaia backup in Gaia Portal (recommended) or in Gaia Clish.\n    \n    -   To create this Gaia backup in Gaia Portal:\n        \n        1.  With a web browser, connect to the working Orchestrator:\n            \n            `https://<IPv4 Address of \"MGMT\" Port>`\n            \n            Log in with the username \"`admin`\" and the corresponding password.\n            \n        2.  Go to **Maintenance** > **System Backup**.\n            \n        3.  Click **Backup** > select **This appliance**.\n            \n        4.  Click **Export** to download this Gaia backup file to your computer.\n            \n    -   To create this Gaia backup in Gaia Clish:\n        \n        1.  Connect to the command line on the working Orchestrator.\n            \n        2.  Log in to Gaia Clish.\n            \n        3.  Create a local Gaia backup:\n            \n        4.  Copy the Gaia backup file from the working Orchestrator:\n            \n            1.  Connect with WinSCP to this working Orchestrator.\n                \n                **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n                \n            2.  Go to this path:\n                \n                `/var/log/CPbackup/backups/`\n                \n            3.  Download the Gaia backup file to your computer.\n                \n2.  On the failed Orchestrator, stop the Orchestrator service:\n    \n    1.  Connect to the command line on the failed Orchestrator.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Stop the service:\n        \n3.  On the failed Orchestrator, write down the port numbers, to which the Uplink cable, the Downlink cables, and the Sync cables are connected.\n    \n4.  On the failed Orchestrator, disconnect all cables.\n    \n5.  Remove the failed Orchestrator from the rack.\n    \n6.  Install the replacement Orchestrator **of the same model** in the rack.\n    \n    Do **not** connect the power or network cables yet. You do it gradually later.\n    \n7.  On the replacement Orchestrator, connect only these cables:\n    \n    See the [Quantum Maestro Getting Started Guide](https://sc1.checkpoint.com/documents/Appliances/GSG_Maestro/EN/Default.htm).\n    \n    1.  Connect a network cable from your computer to the Orchestrator's \"**MGMT**\" port.\n        \n    2.  Connect the console cable from your computer to the Orchestrator's **Console** port.\n        \n        In your console client, configure these settings:\n        \n        -   Baud Rate - 9600\n        -   Data bits - 8\n        -   Stop bits - 1\n        -   Parity - None\n        -   Flow Control - None\n    3.  Connect the power cables to the Orchestrator's Power Supply Units.\n        \n8.  On the replacement Orchestrator, in the **console** session, log in to Gaia Clish.\n    \n    **Important Note** - Choose **not** to activate the Orchestrator.\n    \n    If you activated the Orchestrator, then:\n    \n    1.  Go to the Expert mode: `expert`\n    2.  Stop the Orchestrator service: `orchd stop`\n    3.  Exit the Expert mode: `exit`\n    \n9.  On the replacement Orchestrator, configure the Orchestrator's \"MGMT\" port:\n    \n    1.  Configure the IPv4 address and Mask Length:\n        \n        `set interface Mgmt1 ipv4-address <IPv4 Address of \"MGMT\" Port> mask-length <Mask>`\n        \n    2.  Enable the \"MGMT\" port:\n        \n        `set interface Mgmt1 state on`\n        \n    3.  Configure the default gateway:\n        \n        `set static-route default nexthop gateway address <IPv4 Address of Default Gateway> on`\n        \n    4.  Save the changes:\n        \n    \n    For information about these Gaia Clish commands, see the [R81.20 Gaia Administration Guide](https://sc1.checkpoint.com/documents/R81.20/WebAdminGuides/EN/CP_R81.20_Gaia_AdminGuide/Default.htm).\n    \n10.  On the replacement Orchestrator, configure the required Gaia settings:\n    \n    1.  Connect with an SSH client to the IPv4 address of the \"MGMT\" port.\n        \n    2.  Log in to Gaia Clish.\n        \n    3.  Configure the same date and time settings as configured on all other working Orchestrators (in our example, \"1\\_1\").\n        \n        **Note** - The date and time settings must be the same on all Orchestrators.\n        \n        <table><tbody><tr><td><p><code>set timezone &lt;Area&gt; / &lt;Region&gt;</code></p></td></tr><tr><td><p><code>set date &lt;Date&gt;</code></p></td></tr><tr><td><p><code>set time &lt;HH:MM:SS&gt;</code></p></td></tr></tbody></table>\n        \n    4.  Configure the hostname:\n        \n    5.  Change the default password for the '`admin`' user:\n        \n    6.  Save the changes:\n        \n    \n    For information about these Gaia Clish commands, see the [R81.20 Gaia Administration Guide](https://sc1.checkpoint.com/documents/R81.20/WebAdminGuides/EN/CP_R81.20_Gaia_AdminGuide/Default.htm).\n    \n11.  On the replacement Orchestrator, install the same Take of the [R81.20 Jumbo Hotfix Accumulator](https://sc1.checkpoint.com/documents/Jumbo_HFA/R81.20/Default.htm) / [R81.10 Jumbo Hotfix Accumulator](https://sc1.checkpoint.com/documents/Jumbo_HFA/R81.10/Default.htm) as installed on the working Orchestrator (in our example, \"1\\_1\").\n    \n    1.  Copy the Jumbo Hotfix Accumulator package to the replacement Orchestrator:\n        \n        1.  Connect with WinSCP to the IPv4 address of the \"MGMT\" port on the replacement Orchestrator.\n            \n            **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n            \n        2.  Go to some path. For example:\n            \n        3.  Upload the Jumbo Hotfix Accumulator package from your computer.\n            \n    2.  Connect with an SSH client to the IPv4 address of the \"MGMT\" port.\n        \n    3.  Log in to Gaia Clish.\n        \n    4.  Obtain the lock over the Gaia configuration database:\n        \n    5.  Import the CPUSE package from the hard disk:\n        \n        Note: When the import completes, this package is deleted from the original location.\n        \n        `installer import local <Full_Path>/<Package_File_Name>`\n        \n    6.  Show the imported packages:\n        \n        `show installer packages imported`\n        \n    7.  Verify the package - see whether this package can be installed without conflicts:\n        \n        `installer verify`_\\[press Space key\\]\\[press Tab key\\]_\n        \n        `installer verify <Package_Number>`\n        \n    8.  Install the package:\n        \n        `installer install <Package_Number>`\n        \n    9.  Wait for the Orchestrator to reboot.\n        \n12.  On the replacement Orchestrator, import the Gaia backup file from the working Orchestrator.\n    \n    You can import this Gaia backup in Gaia Portal (recommended) or in Gaia Clish.\n    \n    -   To import this Gaia backup in Gaia Portal:\n        \n        1.  With a web browser, connect to the replacement Orchestrator:\n            \n            `https://<IPv4 Address of \"MGMT\" Port>`\n            \n            Log in with the username \"`admin`\" and the new password you configured.\n            \n        2.  Go to **Maintenance** > **System Backup**.\n            \n        3.  Click **Import** > select the Gaia backup file on your computer.\n            \n        4.  In Gaia Portal, click the imported Gaia backup file.\n            \n        5.  Click **Restore**.\n            \n        6.  Wait for the Orchestrator to reboot.\n            \n    -   To import this Gaia backup in Gaia Clish:\n        \n        1.  Copy the Gaia backup file from your computer to the replacement Orchestrator:\n            \n            1.  Connect with WinSCP to the replacement Orchestrator.\n                \n                **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n                \n            2.  Go to this path:\n                \n                `/var/log/CPbackup/backups/`\n                \n            3.  Upload the Gaia backup file from your computer.\n                \n        2.  Connect to the command line on the replacement Orchestrator.\n            \n        3.  Log in to Gaia Clish.\n            \n        4.  Restore the local Gaia backup:\n            \n            `set backup restore <Name of Backup File from Working Orchestrator>`\n            \n        5.  Wait for the Orchestrator to reboot.\n            \n13.  On all Orchestrators, make sure the configuration files are the same:\n    \n    1.  Connect to the command line on **each** Orchestrator.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Calculate the MD5 checksum for the Orchestrator configuration:\n        \n        `jsont -f /etc/sgdb.json -P | egrep -v \"topology_timestamp|session_id|active_sgms|all_sgm\" | md5sum`\n        \n    \n    The MD5 checksums must be the same on all Orchestrators.\n    \n    If the MD5 checksums are different:\n    \n    1.  Copy the `/etc/sgdb.json` file from the working Orchestrator (in our example, \"1\\_1\") to the replacement Orchestrator (in our example, \"1\\_2\") to the `/etc/` directory.\n        \n        Available copy options:\n        \n        -   Copy the file directly between Orchestrators.\n            \n            In the Expert mode on the working Orchestrator, run:\n            \n            `scp /etc/sgdb.json admin@<IP_Address_of_MGMT_Port_on_Replacement_Orchestrator>:/etc/`\n            \n            Example:\n            \n            `scp /etc/sgdb.json admin@192.168.3.57:/etc/`\n            \n        -   Use WinSCP and your computer as an intermediate place.\n            \n    2.  Calculate the MD5 checksum for the Orchestrator configuration again:\n        \n        `jsont -f /etc/sgdb.json -P | egrep -v \"topology_timestamp|session_id|active_sgms|all_sgm\" | md5sum`\n        \n14.  On the replacement Orchestrator, connect these cables to ports with the same numbers as they were connected on the failed Orchestrator:\n    \n    -   The **Downlink** cables\n        \n    -   The **Sync** cables\n        \n    \n    **Important Note** - Make sure you connected the cables to the correct ports.\n    \n15.  On the replacement Orchestrator, start the Orchestrator service:\n    \n    1.  Log in to the Expert mode.\n        \n    2.  Disable the Link State Propagation (LSP):\n        \n        `jsont -f /etc/smodb.json -s /orch_lsp_state -v off`\n        \n    3.  Check the Orchestrator service status:\n        \n    4.  If the Orchestrator is not active, then activate it (it will start the Orchestrator service):\n        \n        (**Otherwise**, start the Orchestrator service: `orchd start`)\n        \n    5.  Enable the Link State Propagation (LSP):\n        \n        `jsont -f /etc/smodb.json -s /orch_lsp_state -v on`\n        \n    6.  Restart the Orchestrator port monitoring daemon with these commands:\n        \n        <table><tbody><tr><td><p><code>tellpm process:ssm_lsp</code></p></td></tr><tr><td><p><code>tellpm process:ssm_lsp t</code></p></td></tr></tbody></table>\n        \n    \n    **Note** - It may take a few seconds for the Orchestrator to discover the connected Security Appliances for the first time. In the Expert mode, run the \"`watch -d -n 1 orch_stat -l`\" command and wait until the \"`Status`\" columns shows \"`UP`\" for all \"`LAGs(Bonds)`\".\n    \n16.  On all Orchestrators, make sure the traffic can pass between Orchestrators:\n    \n    -   In a Single Site deployment:\n        \n        On the working Orchestrator (in our example, \"1\\_1\"), send several pings to the replacement Orchestrator (in our example, \"1\\_2\"):\n        \n    -   In a Dual Site deployment:\n        \n        On the replacement Orchestrator (in our example, \"1\\_2\"), send several pings to each working Orchestrator:\n        \n        <table><tbody><tr><td><p><code>ping -c 5 1_1</code></p></td></tr><tr><td><p><code>ping -c 5 2_1</code></p></td></tr><tr><td><p><code>ping -c 5 2_2</code></p></td></tr></tbody></table>\n        \n17.  Make sure the Security Group Members can pass traffic to each other:\n    \n    1.  Connect to the command line on the Security Group.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Identify the Security Group Member that runs as SMO:\n        \n    4.  Examine the cluster state of the Security Group Members.\n        \n        On the SMO Security Group Member, run:\n        \n        The output must show that the state of all Security Group Members is \"`ACTIVE`\".\n        \n    5.  Send several pings between Security Group Members:\n        \n        1.  Connect to one of the Security Group Members  \n            (in our example, we connect to the first one - \"1\\_1\"):\n            \n        2.  On this Security Group Member, send several pings to any other Security Group Member  \n            (in our example, we send several pings to the second one - \"1\\_2\" / \"2\\_2\"):\n            \n            -   In a Single Site deployment:\n                \n            -   In a Dual Site deployment:\n                \n                <table><tbody><tr><td><p><code>ping -c 5 1_2</code></p></td></tr><tr><td><p><code>ping -c 5 2_2</code></p></td></tr></tbody></table>\n                \n18.  On the replacement Orchestrator, connect the **Uplink** cables to ports with the same numbers as they were connected on the failed Orchestrator.\n    \n19.  On each Security Group, make sure all links are up on the Security Group:\n    \n    1.  Connect to the command line on the Security Group.\n        \n    2.  Examine the state of links:\n        \n\n### Procedure for Orchestrators that run the version R81.10, or R81.10 Jumbo Hotfix Take 55 (and lower)\n\nShow / Hide this section\n\nThis procedure applies only to Orchestrators that run one of these versions:\n\n-   R81.10 without the R81.10 Jumbo Hotfix Accumulator\n-   R81.10 with the R81.10 Jumbo Hotfix Accumulator, Take 55 and lower\n\nProcedure:\n\n1.  On the working Orchestrator, export the configuration files for the failed Orchestrator:\n    \n    1.  Connect to the command line on the Orchestrator that **continues to work**.\n        \n    2.  Log in to Gaia Clish.\n        \n    3.  Export the configuration files for the Orchestrator that **failed**:\n        \n        `set maestro export remote orchestrator id <ID of the Failed Orchestrator> configuration archive-name <Name of Output Archive File> path <Full Path on Working Orchestrator>`\n        \n        Example:\n        \n        `set maestro export remote orchestrator id 1_2 configuration archive-name Export_from_failed_Orch_1_2 path /var/log/`\n        \n2.  On the working Orchestrator, copy the archive with the exported configuration files to your computer.\n    \n    Connect with WinSCP to this working Orchestrator.\n    \n    **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n    \n3.  On the failed Orchestrator, stop the Orchestrator service:\n    \n    1.  Connect to the command line on the failed Orchestrator.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Stop the service:\n        \n4.  On the failed Orchestrator, write down the port numbers, to which the Uplink cable, the Downlink cables, and the Sync cables are connected.\n    \n5.  On the failed Orchestrator, disconnect all cables.\n    \n6.  Remove the failed Orchestrator from the rack.\n    \n7.  Install the replacement Orchestrator **of the same model** in the rack.\n    \n    Do **not** connect the power or network cables yet. You do it gradually later.\n    \n8.  On the replacement Orchestrator, connect only these cables:\n    \n    See the [Quantum Maestro Getting Started Guide](https://sc1.checkpoint.com/documents/Appliances/GSG_Maestro/EN/Default.htm).\n    \n    1.  Connect a network cable from your computer to the Orchestrator's \"**MGMT**\" port.\n        \n    2.  Connect the console cable from your computer to the Orchestrator's **Console** port.\n        \n        In your console client, configure these settings:\n        \n        -   Baud Rate - 9600\n        -   Data bits - 8\n        -   Stop bits - 1\n        -   Parity - None\n        -   Flow Control - None\n    3.  Connect the power cables to the Orchestrator's Power Supply Units.\n        \n9.  On the replacement Orchestrator, in the **console** session, log in to Gaia Clish.\n    \n    **Important Note** - Choose **not** to activate the Orchestrator.\n    \n    If you activated the Orchestrator, then:\n    \n    1.  Go to the Expert mode: `expert`\n    2.  Stop the Orchestrator service: `orchd stop`\n    3.  Exit the Expert mode: `exit`\n    \n10.  On the replacement Orchestrator, configure the Orchestrator's \"MGMT\" port:\n    \n    1.  Configure the IPv4 address and Mask Length:\n        \n        `set interface Mgmt1 ipv4-address <IPv4 Address of \"MGMT\" Port> mask-length <Mask>`\n        \n    2.  Enable the \"MGMT\" port:\n        \n        `set interface Mgmt1 state on`\n        \n    3.  Configure the default gateway:\n        \n        `set static-route default nexthop gateway address <IPv4 Address of Default Gateway> on`\n        \n    4.  Save the changes:\n        \n    \n    For information about these Gaia Clish commands, see the [R81.10 Gaia Administration Guide](https://sc1.checkpoint.com/documents/R81.10/WebAdminGuides/EN/CP_R81.10_Gaia_AdminGuide/Default.htm).\n    \n11.  On the replacement Orchestrator, configure the required Gaia settings:\n    \n    1.  Connect with an SSH client to the IPv4 address of the \"MGMT\" port.\n        \n    2.  Log in to Gaia Clish.\n        \n    3.  Configure the same date and time settings as configured on all other working Orchestrators (in our example, \"1\\_1\").\n        \n        **Note** - The date and time settings must be the same on all Orchestrators.\n        \n        <table><tbody><tr><td><p><code>set timezone &lt;Area&gt; / &lt;Region&gt;</code></p></td></tr><tr><td><p><code>set date &lt;Date&gt;</code></p></td></tr><tr><td><p><code>set time &lt;HH:MM:SS&gt;</code></p></td></tr></tbody></table>\n        \n    4.  Configure the hostname:\n        \n    5.  Change the default password for the '`admin`' user:\n        \n    6.  Save the changes:\n        \n    \n    For information about these Gaia Clish commands, see the [R81.10 Gaia Administration Guide](https://sc1.checkpoint.com/documents/R81.10/WebAdminGuides/EN/CP_R81.10_Gaia_AdminGuide/Default.htm).\n    \n12.  On the replacement Orchestrator, install the same Take of the [R81.10 Jumbo Hotfix Accumulator](https://sc1.checkpoint.com/documents/Jumbo_HFA/R81.10/Default.htm) as installed on the working Orchestrator (in our example, \"1\\_1\").\n    \n    1.  Copy the Jumbo Hotfix Accumulator package to the replacement Orchestrator:\n        \n        1.  Connect with WinSCP to the IPv4 address of the \"MGMT\" port on the replacement Orchestrator.\n            \n            **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n            \n        2.  Go to some path. For example:\n            \n        3.  Upload the Jumbo Hotfix Accumulator package from your computer.\n            \n    2.  Connect with an SSH client to the IPv4 address of the \"MGMT\" port.\n        \n    3.  Log in to Gaia Clish.\n        \n    4.  Obtain the lock over the Gaia configuration database:\n        \n    5.  Import the CPUSE package from the hard disk:\n        \n        Note: When the import completes, this package is deleted from the original location.\n        \n        `installer import local <Full_Path>/<Package_File_Name>`\n        \n    6.  Show the imported packages:\n        \n        `show installer packages imported`\n        \n    7.  Verify the package - see whether this package can be installed without conflicts:\n        \n        `installer verify`_\\[press Space key\\]\\[press Tab key\\]_\n        \n        `installer verify <Package_Number>`\n        \n    8.  Install the package:\n        \n        `installer install <Package_Number>`\n        \n    9.  Wait for the Orchestrator to reboot.\n        \n13.  On the replacement Orchestrator, copy the archive with the exported configuration files from your computer to the replacement Orchestrator to some directory (for example, `/var/log/`).\n    \n    Connect with WinSCP to the replacement Orchestrator.\n    \n    **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n    \n14.  On the replacement Orchestrator, import the configuration files you collected earlier:\n    \n    1.  Connect to the command line on the replacement Orchestrator.\n        \n    2.  Log in to Gaia Clish.\n        \n    3.  Import the configuration files:\n        \n        `set maestro import configuration archive-name <Name of Output Archive File> path <Full Local Path>`\n        \n        Example:\n        \n        `set maestro import configuration archive-name Export_from_failed_Orch_1_2.tgz path /var/log/`\n        \n15.  On all Orchestrators, make sure the configuration files are the same:\n    \n    1.  Connect to the command line on **each** Orchestrator.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Calculate the MD5 checksum for the Orchestrator configuration:\n        \n        `jsont -f /etc/sgdb.json -P | egrep -v \"topology_timestamp|session_id|active_sgms|all_sgm\" | md5sum`\n        \n    \n    The MD5 checksums must be the same on all Orchestrators.\n    \n    If the MD5 checksums are different:\n    \n    1.  Copy the `/etc/sgdb.json` file from the working Orchestrator (in our example, \"1\\_1\") to the replacement Orchestrator (in our example, \"1\\_2\") to the `/etc/` directory.\n        \n        Available copy options:\n        \n        -   Copy the file directly between Orchestrators.\n            \n            In the Expert mode on the working Orchestrator, run:\n            \n            `scp /etc/sgdb.json admin@<IP_Address_of_MGMT_Port_on_Replacement_Orchestrator>:/etc/`\n            \n            Example:\n            \n            `scp /etc/sgdb.json admin@192.168.3.57:/etc/`\n            \n        -   Use WinSCP and your computer as an intermediate place.\n            \n    2.  Calculate the MD5 checksum for the Orchestrator configuration again:\n        \n        `jsont -f /etc/sgdb.json -P | egrep -v \"topology_timestamp|session_id|active_sgms|all_sgm\" | md5sum`\n        \n16.  On the replacement Orchestrator, connect these cables to ports with the same numbers as they were connected on the failed Orchestrator:\n    \n    -   The **Downlink** cables\n        \n    -   The **Sync** cables\n        \n    \n    **Important Note** - Make sure you connected the cables to the correct ports.\n    \n17.  On the replacement Orchestrator, start the Orchestrator service:\n    \n    1.  Log in to the Expert mode.\n        \n    2.  Disable the Link State Propagation (LSP):\n        \n        `jsont -f /etc/smodb.json -s /orch_lsp_state -v off`\n        \n    3.  Check the Orchestrator service status:\n        \n    4.  If the Orchestrator is not active, then activate it (it will start the Orchestrator service):\n        \n        (**Otherwise**, start the Orchestrator service: `orchd start`)\n        \n    5.  Enable the Link State Propagation (LSP):\n        \n        `jsont -f /etc/smodb.json -s /orch_lsp_state -v on`\n        \n    6.  Restart the Orchestrator port monitoring daemon with these commands:\n        \n        <table><tbody><tr><td><p><code>tellpm process:ssm_pmd</code></p></td></tr><tr><td><p><code>tellpm process:ssm_pmd t</code></p></td></tr></tbody></table>\n        \n    \n    **Note** - It may take a few seconds for the Orchestrator to discover the connected Security Appliances for the first time. In the Expert mode, run the \"`watch -d -n 1 orch_stat -l`\" command and wait until the \"`Status`\" columns shows \"`UP`\" for all \"`LAGs(Bonds)`\".\n    \n18.  On all Orchestrators, make sure the traffic can pass between Orchestrators:\n    \n    -   In a Single Site deployment:\n        \n        On the working Orchestrator (in our example, \"1\\_1\"), send several pings to the replacement Orchestrator (in our example, \"1\\_2\"):\n        \n    -   In a Dual Site deployment:\n        \n        On the replacement Orchestrator (in our example, \"1\\_2\"), send several pings to each working Orchestrator:\n        \n        <table><tbody><tr><td><p><code>ping -c 5 1_1</code></p></td></tr><tr><td><p><code>ping -c 5 2_1</code></p></td></tr><tr><td><p><code>ping -c 5 2_2</code></p></td></tr></tbody></table>\n        \n19.  Make sure the Security Group Members can pass traffic to each other:\n    \n    1.  Connect to the command line on the Security Group.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Identify the Security Group Member that runs as SMO:\n        \n    4.  Examine the cluster state of the Security Group Members.\n        \n        On the SMO Security Group Member, run:\n        \n        The output must show that the state of all Security Group Members is \"`ACTIVE`\".\n        \n    5.  Send several pings between Security Group Members:\n        \n        1.  Connect to one of the Security Group Members  \n            (in our example, we connect to the first one - \"1\\_1\"):\n            \n        2.  On this Security Group Member, send several pings to any other Security Group Member  \n            (in our example, we send several pings to the second one - \"1\\_2\" / \"2\\_2\"):\n            \n            -   In a Single Site deployment:\n                \n            -   In a Dual Site deployment:\n                \n                <table><tbody><tr><td><p><code>ping -c 5 1_2</code></p></td></tr><tr><td><p><code>ping -c 5 2_2</code></p></td></tr></tbody></table>\n                \n20.  On the replacement Orchestrator, connect the **Uplink** cables to ports with the same numbers as they were connected on the failed Orchestrator.\n    \n21.  On each Security Group, make sure all links are up on the Security Group:\n    \n    1.  Connect to the command line on the Security Group.\n        \n    2.  Examine the state of links:\n        \n\n### Procedure for Orchestrators that run the R80.20SP version - when the failed Orchestrator is still accessible\n\nShow / Hide this section\n\n1.  Export the configuration files of the failed Orchestrator:\n    \n    -   If the Orchestrators run R80.20SP with the Jumbo Hotfix Accumulator Take 310 and higher:\n        \n        **Note** - Starting from R80.20SP Jumbo Hotfix Accumulator Take 310, each Orchestrator keeps the configuration of the peer Orchestrator as a local backup.\n        \n        1.  Connect to the command line on the Orchestrator that **continues to work**.\n            \n        2.  Log in to Gaia Clish.\n            \n        3.  Export the configuration files of the Orchestrator that **failed**:\n            \n            `set maestro export remote orchestrator id <ID of the Failed Orchestrator> configuration archive-name <Name of Output Archive File> path <Full Path on Working Orchestrator>`\n            \n            Example:\n            \n            `set maestro export remote orchestrator id 1_2 configuration archive-name Export_from_failed_Orch_1_2 path /var/log/`\n            \n    -   If the Orchestrators run R80.20SP with the Jumbo Hotfix Accumulator Take 309 and lower:\n        \n        1.  Connect to the command line on the Orchestrator that **failed**.\n            \n        2.  Log in to the Expert mode.\n            \n        3.  Export the configuration files of the Orchestrator that **failed**:\n            \n            `tar -czf <Full Path on Failed Orchestrator>/<Name of Output Archive File>.tgz -C /etc maestro.json sgdb.json smodb.json maestro_full.json`\n            \n            Example:\n            \n            `tar -czf /var/log/Export_from_failed_Orch_1_2.tgz -C /etc maestro.json sgdb.json smodb.json maestro_full.json`\n            \n2.  On the failed Orchestrator, copy the archive with the exported configuration files to your computer.\n    \n    Connect with WinSCP to the failed Orchestrator.\n    \n    **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n    \n3.  On the failed Orchestrator, stop the Orchestrator service:\n    \n    1.  Connect to the command line on the failed Orchestrator.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Stop the service:\n        \n4.  On the failed Orchestrator, write down the port numbers, to which the Uplink cable, the Downlink cables, and the Sync cables are connected.\n    \n5.  On the failed Orchestrator, disconnect all cables.\n    \n6.  Remove the failed Orchestrator from the rack.\n    \n7.  Install the replacement Orchestrator **of the same model** in the rack.\n    \n    Do **not** connect the power or network cables yet. You do it gradually later.\n    \n8.  On the replacement Orchestrator, connect only these cables:\n    \n    See the [Quantum Maestro Getting Started Guide](https://sc1.checkpoint.com/documents/Appliances/GSG_Maestro/EN/Default.htm).\n    \n    1.  Connect a network cable from your computer to the Orchestrator's \"**MGMT**\" port.\n        \n    2.  Connect the console cable from your computer to the Orchestrator's **Console** port.\n        \n        In your console client, configure these settings:\n        \n        -   Baud Rate - 9600\n        -   Data bits - 8\n        -   Stop bits - 1\n        -   Parity - None\n        -   Flow Control - None\n    3.  Connect the power cables to the Orchestrator's Power Supply Units.\n        \n9.  On the replacement Orchestrator, in the **console** session, log in to Gaia Clish.\n    \n10.  On the replacement Orchestrator, configure the Orchestrator's \"MGMT\" port:\n    \n    1.  Configure the IPv4 address and Mask Length:\n        \n        `set interface Mgmt1 ipv4-address <IPv4 Address of \"MGMT\" Port> mask-length <Mask>`\n        \n    2.  Enable the \"MGMT\" port:\n        \n        `set interface Mgmt1 state on`\n        \n    3.  Configure the default gateway:\n        \n        `set static-route default nexthop gateway address <IPv4 Address of Default Gateway> on`\n        \n    4.  Save the changes:\n        \n    \n    For information about these Gaia Clish commands, see the [R80.20SP Maestro Gaia Administration Guide](https://sc1.checkpoint.com/documents/R80.20SP/WebAdminGuides/EN/CP_R80.20SP_Maestro_Gaia_AdminGuide/html_frameset.htm).\n    \n11.  On the replacement Orchestrator, configure the required Gaia settings:\n    \n    1.  Connect with an SSH client to the IPv4 address of the \"MGMT\" port.\n        \n    2.  Log in to Gaia Clish.\n        \n    3.  Configure the same date and time settings as configured on all other working Orchestrators (in our example, \"1\\_1\").\n        \n        **Note** - The date and time settings must be the same on all Orchestrators.\n        \n        <table><tbody><tr><td><p><code>set timezone &lt;Area&gt; / &lt;Region&gt;</code></p></td></tr><tr><td><p><code>set date &lt;Date&gt;</code></p></td></tr><tr><td><p><code>set time &lt;HH:MM:SS&gt;</code></p></td></tr></tbody></table>\n        \n    4.  Configure the hostname:\n        \n    5.  Change the default password for the '`admin`' user:\n        \n    6.  Save the changes:\n        \n    \n    For information about these Gaia Clish commands, see the [R80.20SP Maestro Gaia Administration Guide](https://sc1.checkpoint.com/documents/R80.20SP/WebAdminGuides/EN/CP_R80.20SP_Maestro_Gaia_AdminGuide/html_frameset.htm).\n    \n12.  On the replacement Orchestrator, install the same Take of the [R80.20SP Jumbo Hotfix Accumulator](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk155832) as installed on the working Orchestrator (in our example, \"1\\_1\").\n    \n    1.  Copy the Jumbo Hotfix Accumulator package to the replacement Orchestrator:\n        \n        1.  Connect with WinSCP to the IPv4 address of the \"MGMT\" port on the replacement Orchestrator.\n            \n            **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n            \n        2.  Go to some path. For example:\n            \n        3.  Upload the Jumbo Hotfix Accumulator package from your computer.\n            \n    2.  Connect with an SSH client to the IPv4 address of the \"MGMT\" port.\n        \n    3.  Log in to Gaia Clish.\n        \n    4.  Obtain the lock over the Gaia configuration database:\n        \n    5.  Import the CPUSE package from the hard disk:\n        \n        Note: When the import completes, this package is deleted from the original location.\n        \n        `installer import local <Full_Path>/<Package_File_Name>`\n        \n    6.  Show the imported packages:\n        \n        `show installer packages imported`\n        \n    7.  Verify the package - see whether this package can be installed without conflicts:\n        \n        `installer verify`_\\[press Space key\\]\\[press Tab key\\]_\n        \n        `installer verify <Package_Number>`\n        \n    8.  Install the package:\n        \n        `installer install <Package_Number>`\n        \n    9.  Wait for the Orchestrator to reboot.\n        \n13.  On the replacement Orchestrator, stop the Orchestrator service:\n    \n    1.  Connect to the command line the replacement Orchestrator through the \"MGMT\" port (over SSH).\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Stop the Orchestrator service:\n        \n    4.  Stop the LLDP service:\n        \n14.  On the replacement Orchestrator - copy the archive with the exported configuration files from your computer to the replacement Orchestrator to some directory (for example, `/var/log/`).\n    \n    Connect with WinSCP to the replacement Orchestrator.\n    \n    **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n    \n15.  On the replacement Orchestrator, import the configuration files you collected earlier:\n    \n    -   If the Orchestrator runs R80.20SP with the Jumbo Hotfix Accumulator Take 310 and higher:\n        \n        1.  Connect to the command line on the replacement Orchestrator.\n            \n        2.  Log in to Gaia Clish.\n            \n        3.  Import the configuration files:\n            \n            `set maestro import configuration archive-name <Name of Output Archive File> path <Full Local Path>`\n            \n            Example:\n            \n            `set maestro import configuration archive-name Export_from_failed_Orch_1_2.tgz path /var/log/`\n            \n    -   If the Orchestrator runs R80.20SP with the Jumbo Hotfix Accumulator Take 309 and lower:\n        \n        1.  Connect to the command line on the replacement Orchestrator.\n            \n        2.  Log in to the Expert mode.\n            \n        3.  Unpack the configuration files to the `/etc/` directory:\n            \n            `tar -xzf <Full Local Path>/<Name of Output Archive File>.tgz -C /etc`\n            \n            Example:\n            \n            `tar -xzf /var/log/Export_from_failed_Orch_1_2.tgz -C /etc`\n            \n16.  On all Orchestrators, make sure the configuration files are the same:\n    \n    1.  Connect to the command line on **each** Orchestrator.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Calculate the MD5 checksum for the Orchestrator configuration:\n        \n        `jsont -f /etc/sgdb.json -P | egrep -v \"topology_timestamp|session_id|active_sgms|all_sgm\" | md5sum`\n        \n    \n    The MD5 checksums must be the same on all Orchestrators.\n    \n    If the MD5 checksums are different:\n    \n    1.  Copy the `/etc/sgdb.json` file from the working Orchestrator (in our example, \"1\\_1\") to the replacement Orchestrator (in our example, \"1\\_2\") to the `/etc/` directory.\n        \n        Available copy options:\n        \n        -   Copy the file directly between Orchestrators.\n            \n            In the Expert mode on the working Orchestrator, run:\n            \n            `scp /etc/sgdb.json admin@<IP_Address_of_MGMT_Port_on_Replacement_Orchestrator>:/etc/`\n            \n            Example:\n            \n            `scp /etc/sgdb.json admin@192.168.3.57:/etc/`\n            \n        -   Use WinSCP and your computer as an intermediate place.\n            \n    2.  Calculate the MD5 checksum for the Orchestrator configuration again:\n        \n        `jsont -f /etc/sgdb.json -P | egrep -v \"topology_timestamp|session_id|active_sgms|all_sgm\" | md5sum`\n        \n17.  On the replacement Orchestrator, connect these cables to ports with the same numbers as they were connected on the failed Orchestrator:\n    \n    -   The **Downlink** cables\n        \n    -   The **Sync** cables\n        \n    \n    **Important Note** - Make sure you connected the cables to the correct ports.\n    \n18.  On the replacement Orchestrator, start the Orchestrator service:\n    \n    1.  Connect to the command line on each Orchestrator.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Disable the Link State Propagation (LSP):\n        \n        `jsont -f /etc/smodb.json -s /orch_lsp_state -v off`\n        \n    4.  Start the Orchestrator service:\n        \n    5.  Enable the Link State Propagation (LSP):\n        \n        `jsont -f /etc/smodb.json -s /orch_lsp_state -v on`\n        \n    6.  Restart the Orchestrator service (this also starts the LLDP service):\n        \n19.  On all Orchestrators, make sure the traffic can pass traffic between Orchestrators:\n    \n    -   In a Single Site deployment:\n        \n        On the working Orchestrator (in our example, \"1\\_1\"), send several pings to the replacement Orchestrator (in our example, \"1\\_2\"):\n        \n    -   In a Dual Site deployment:\n        \n        On the replacement Orchestrator (in our example, \"1\\_2\"), send several pings to each working Orchestrator:\n        \n        <table><tbody><tr><td><p><code>ping -c 5 1_1</code></p></td></tr><tr><td><p><code>ping -c 5 2_1</code></p></td></tr><tr><td><p><code>ping -c 5 2_2</code></p></td></tr></tbody></table>\n        \n20.  Make sure the Security Group Members can pass traffic to each other:\n    \n    1.  Connect to the command line on the Security Group.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Identify the Security Group Member that runs as SMO:\n        \n    4.  Examine the cluster state of the Security Group Members.\n        \n        On the SMO Security Group Member, run:\n        \n        The output must show that the state of all Security Group Members is \"`ACTIVE`\".\n        \n    5.  Send several pings between Security Group Members:\n        \n        1.  Connect to one of the Security Group Members  \n            (in our example, we connect to the first one - \"1\\_1\"):\n            \n        2.  On this Security Group Member, send several pings to any other Security Group Member  \n            (in our example, we send several pings to the second one - \"1\\_2\" / \"2\\_2\"):\n            \n            -   In a Single Site deployment:\n                \n            -   In a Dual Site deployment:\n                \n                <table><tbody><tr><td><p><code>ping -c 5 1_2</code></p></td></tr><tr><td><p><code>ping -c 5 2_2</code></p></td></tr></tbody></table>\n                \n21.  On the replacement Orchestrator, connect the **Uplink** cables to ports with the same numbers as they were connected on the failed Orchestrator.\n    \n22.  On each Security Group, make sure all links are up on the Security Group:\n    \n    1.  Connect to the command line on the Security Group.\n        \n    2.  Examine the state of links:\n        \n\n### Procedure for Orchestrators that run the R80.20SP version with the Jumbo Hotfix Accumulator Take 309 and lower - when the failed Orchestrator is not accessible anymore, or after restoring an Orchestrator to factory defaults\n\nShow / Hide this section\n\n**Important** - Follow the procedure below if the failed Orchestrator is not accessible, or if its configuration is empty (for example, after restoring an Orchestrator to factory defaults).\n\n1.  On the working Orchestrator, export the required configuration files:\n    \n    1.  Connect with WinSCP to this working Orchestrator.\n        \n        **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n        \n    2.  Copy these files from the working Orchestrator to your computer:\n        \n        -   `/etc/maestro_remote.json`\n            \n        -   `/etc/maestro_full.json`\n            \n        -   `/etc/sgdb.json`\n            \n        -   `/etc/smodb.json`\n            \n2.  On the failed Orchestrator, write down the port numbers, to which the Uplink cable, the Downlink cables, and the Sync cables are connected.\n    \n3.  Remove the failed Orchestrator from the rack.\n    \n4.  Install the replacement Orchestrator **of the same model** in the rack.\n    \n    Do **not** connect the power or network cables yet. You do it gradually later.\n    \n5.  On the replacement Orchestrator, connect only these cables:\n    \n    See the [Quantum Maestro Getting Started Guide](https://sc1.checkpoint.com/documents/Appliances/GSG_Maestro/EN/Default.htm).\n    \n    1.  Connect a network cable from your computer to the Orchestrator's \"**MGMT**\" port.\n        \n    2.  Connect the console cable from your computer to the Orchestrator's **Console** port.\n        \n        In your console client, configure these settings:\n        \n        -   Baud Rate - 9600\n        -   Data bits - 8\n        -   Stop bits - 1\n        -   Parity - None\n        -   Flow Control - None\n    3.  Connect the power cables to the Orchestrator's Power Supply Units.\n        \n6.  On the replacement Orchestrator, in the **console** session, log in to Gaia Clish.\n    \n7.  On the replacement Orchestrator, configure the Orchestrator's \"MGMT\" port:\n    \n    1.  Configure the IPv4 address and Mask Length:\n        \n        `set interface Mgmt1 ipv4-address <IPv4 Address of \"MGMT\" Port> mask-length <Mask>`\n        \n    2.  Enable the \"MGMT\" port:\n        \n        `set interface Mgmt1 state on`\n        \n    3.  Configure the default gateway:\n        \n        `set static-route default nexthop gateway address <IPv4 Address of Default Gateway> on`\n        \n    4.  Save the changes:\n        \n    \n    For information about these Gaia Clish commands, see the [R80.20SP Maestro Gaia Administration Guide](https://sc1.checkpoint.com/documents/R80.20SP/WebAdminGuides/EN/CP_R80.20SP_Maestro_Gaia_AdminGuide/html_frameset.htm).\n    \n8.  On the replacement Orchestrator, configure the required Gaia settings:\n    \n    1.  Connect with an SSH client to the IPv4 address of the \"MGMT\" port.\n        \n    2.  Log in to Gaia Clish.\n        \n    3.  Configure the same date and time settings as configured on all other working Orchestrators (in our example, \"1\\_1\").\n        \n        **Note** - The date and time settings must be the same on all Orchestrators.\n        \n        <table><tbody><tr><td><p><code>set timezone &lt;Area&gt; / &lt;Region&gt;</code></p></td></tr><tr><td><p><code>set date &lt;Date&gt;</code></p></td></tr><tr><td><p><code>set time &lt;HH:MM:SS&gt;</code></p></td></tr></tbody></table>\n        \n    4.  Configure the hostname:\n        \n    5.  Change the default password for the '`admin`' user:\n        \n    6.  Save the changes:\n        \n    \n    For information about these Gaia Clish commands, see the [R80.20SP Maestro Gaia Administration Guide](https://sc1.checkpoint.com/documents/R80.20SP/WebAdminGuides/EN/CP_R80.20SP_Maestro_Gaia_AdminGuide/html_frameset.htm).\n    \n9.  On the replacement Orchestrator, install the same Take of the [R80.20SP Jumbo Hotfix Accumulator](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk155832) as installed on the working Orchestrator (in our example, \"1\\_1\").\n    \n    1.  Copy the Jumbo Hotfix Accumulator package to the replacement Orchestrator:\n        \n        1.  Connect with WinSCP to the IPv4 address of the \"MGMT\" port on the replacement Orchestrator.\n            \n            **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n            \n        2.  Go to some path. For example:\n            \n        3.  Upload the Jumbo Hotfix Accumulator package from your computer.\n            \n    2.  Connect with an SSH client to the IPv4 address of the \"MGMT\" port.\n        \n    3.  Log in to Gaia Clish.\n        \n    4.  Obtain the lock over the Gaia configuration database:\n        \n    5.  Import the CPUSE package from the hard disk:\n        \n        Note: When the import completes, this package is deleted from the original location.\n        \n        `installer import local <Full_Path>/<Package_File_Name>`\n        \n    6.  Show the imported packages:\n        \n        `show installer packages imported`\n        \n    7.  Verify the package - see whether this package can be installed without conflicts:\n        \n        `installer verify`_\\[press Space key\\]\\[press Tab key\\]_\n        \n        `installer verify <Package_Number>`\n        \n    8.  Install the package:\n        \n        `installer install <Package_Number>`\n        \n    9.  Wait for the Orchestrator to reboot.\n        \n10.  On the replacement Orchestrator, stop the Orchestrator service:\n    \n    1.  Connect with an SSH client to the IPv4 address of the \"MGMT\" port.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Stop the Orchestrator service:\n        \n    4.  Stop the LLDP service:\n        \n11.  On the replacement Orchestrator, copy the required configuration files from your computer:\n    \n    1.  Connect with WinSCP to the replacement Orchestrator.\n        \n        **Important Note** - Refer to [sk42178](https://support.checkpoint.com/results/sk/sk42178) to make sure this SCP connection works.\n        \n    2.  Copy these files from your computer to the replacement Orchestrator to the **/etc/** directory:\n        \n        -   `maestro_remote.json`\n            \n        -   `maestro_full.json`\n            \n        -   `sgdb.json`\n            \n        -   `smodb.json`\n            \n12.  On the replacement Orchestrator, edit the configuration files (in the Expert mode):\n    \n    1.  Rename the `/etc/maestro_remote.json` file:\n        \n        `mv -v /etc/maestro_remote.json /etc/maestro.json`\n        \n    2.  In the file `/etc/smodb.json`, configure the ID of the failed Orchestrator in the \"`member_id`\" parameter:\n        \n        1.  Examine the current value of the \"`member_id`\" parameter:\n            \n            `grep member_id /etc/smodb.json`\n            \n        2.  Edit the file:\n            \n        3.  Change the value of the \"`member_id`\" parameter to the ID of the failed Orchestrator.\n            \n            In our example, the required value is \"2\":\n            \n        4.  Save the changes in the file and exit Vi editor.\n            \n13.  On all Orchestrators, make sure the configuration files are the same:\n    \n    1.  Connect to the command line on **each** Orchestrator.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Calculate the MD5 checksum for the Orchestrator configuration:\n        \n        `jsont -f /etc/sgdb.json -P | egrep -v \"topology_timestamp|session_id|active_sgms|all_sgm\" | md5sum`\n        \n    \n    The MD5 checksums must be the same on all Orchestrators.\n    \n    If the MD5 checksums are different:\n    \n    1.  Copy the `/etc/sgdb.json` file from the working Orchestrator (in our example, \"1\\_1\") to the replacement Orchestrator (in our example, \"1\\_2\") to the `/etc/` directory.\n        \n        Available copy options:\n        \n        -   Copy the file directly between Orchestrators.\n            \n            In the Expert mode on the working Orchestrator, run:\n            \n            `scp /etc/sgdb.json admin@<IP_Address_of_MGMT_Port_on_Replacement_Orchestrator>:/etc/`\n            \n            Example:\n            \n            `scp /etc/sgdb.json admin@192.168.3.57:/etc/`\n            \n        -   Use WinSCP and your computer as an intermediate place.\n            \n    2.  Calculate the MD5 checksum for the Orchestrator configuration again:\n        \n        `jsont -f /etc/sgdb.json -P | egrep -v \"topology_timestamp|session_id|active_sgms|all_sgm\" | md5sum`\n        \n14.  On the replacement Orchestrator, connect these cables to ports with the same numbers as they were connected on the failed Orchestrator:\n    \n    -   The **Downlink** cables\n        \n    -   The **Sync** cables\n        \n    \n    **Important Note** - Make sure you connected the cables to the correct ports.\n    \n15.  On the replacement Orchestrator, start the Orchestrator service:\n    \n    1.  Connect to the command line.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Disable the Link State Propagation (LSP):\n        \n        `jsont -f /etc/smodb.json -s /orch_lsp_state -v off`\n        \n    4.  Start the Orchestrator service:\n        \n    5.  Enable the Link State Propagation (LSP):\n        \n        `jsont -f /etc/smodb.json -s /orch_lsp_state -v on`\n        \n    6.  Restart the Orchestrator service (this also starts the LLDP service):\n        \n16.  On all Orchestrators, make sure the traffic can pass between Orchestrators:\n    \n    -   In a Single Site deployment:\n        \n        On the working Orchestrator (in our example, \"1\\_1\"), send several pings to the replacement Orchestrator (in our example, \"1\\_2\"):\n        \n    -   In a Dual Site deployment:\n        \n        On the replacement Orchestrator (in our example, \"1\\_2\"), send several pings to each working Orchestrator:\n        \n        <table><tbody><tr><td><p><code>ping -c 5 1_1</code></p></td></tr><tr><td><p><code>ping -c 5 2_1</code></p></td></tr><tr><td><p><code>ping -c 5 2_2</code></p></td></tr></tbody></table>\n        \n17.  Make sure the Security Group Members can pass traffic to each other:\n    \n    1.  Connect to the command line on the Security Group.\n        \n    2.  Log in to the Expert mode.\n        \n    3.  Identify the Security Group Member that runs as SMO:\n        \n    4.  Examine the cluster state of the Security Group Members.\n        \n        On the SMO Security Group Member, run:\n        \n        The output must show that the state of all Security Group Members is \"`ACTIVE`\".\n        \n    5.  Send several pings between Security Group Members:\n        \n        1.  Connect to one of the Security Group Members  \n            (in our example, we connect to the first one - \"1\\_1\"):\n            \n        2.  On this Security Group Member, send several pings to any other Security Group Member  \n            (in our example, we send several pings to the second one - \"1\\_2\" / \"2\\_2\"):\n            \n            -   In a Single Site deployment:\n                \n            -   In a Dual Site deployment:\n                \n                <table><tbody><tr><td><p><code>ping -c 5 1_2</code></p></td></tr><tr><td><p><code>ping -c 5 2_2</code></p></td></tr></tbody></table>\n                \n18.  On the replacement Orchestrator, connect the **Uplink** cables to ports with the same numbers as they were connected on the failed Orchestrator.\n    \n19.  On each Security Group, make sure all links are up on the Security Group:\n    \n    1.  Connect to the command line on the Security Group.\n        \n    2.  Examine the state of links:\n        \n\n### Revision History\n\nShow / Hide this section\n\n<table><tbody><tr><td>Date</td><td>Change</td></tr><tr><td>04 Nov 2024</td><td><ul><li>Improved the procedure for Orchestrators that run the version R81.20, R81.20 Jumbo Hotfix (all Takes), or R81.10 Jumbo Hotfix Take 61 (and higher)</li><li>Improved formatting</li></ul></td></tr><tr><td>03 Nov 2024</td><td><ul><li>Added the procedure for Orchestrators R82 - Failed Orchestrator is still accessible</li><li>Added the procedure for Orchestrators R82 - Failed Orchestrator is not accessible</li><li>Improved formatting</li></ul></td></tr><tr><td>01 Nov 2024</td><td>Added the procedure for Orchestrators that run the version R81.20, R81.20 Jumbo Hotfix (all Takes), or R81.10 Jumbo Hotfix Take 61 (and higher)</td></tr><tr><td>15 May 2022</td><td>Corrected the Baud rate values - removed \"115200\"</td></tr><tr><td>21 March 2022</td><td><ul><li>Improved the procedures</li><li>Added the procedure for Orchestrators that run the R80.20SP version - when a failed Orchestrator is not accessible anymore, or after restoring an Orchestrator to factory defaults</li></ul></td></tr><tr><td>14 March 2022</td><td>Improved the terms used in procedures</td></tr><tr><td>10 Aug 2021</td><td>Added the procedure for Orchestrators that run the R81.10 version</td></tr><tr><td>28 June 2021</td><td>Created this article for Orchestrators that run the R80.20SP version</td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:21.041Z","annotations":[],"updated":"2025-05-06T23:05:17.678Z"},{"title":"ProductQuantum Security Gateways: LOM and IPMI","id":"3b7d10bc-7e1a-452c-a565-a1bbfeddc41b","type":"TEXT","raw":"ProductQuantum Security Gateways\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nOSGaia\n\nPlatform23000, 26000, 28000, 5000, 6000, 7000, 9000\n\nLast Modified2024-08-19\n\n#### For internal users only\n\n## Solution\n\nThis article shows how to troubleshoot these issues:\n\n-   How to check LOM status and start or stop the IPMI service\n-   How to check the LOM version or Type\n-   How to configure LOM IP and LAN settings\n-   How to reset LOM Admin Password\n-   How to reset the LOM to factory defaults\n-   How to troubleshoot various LOM commands\n-   The `show lom` command returns one of these errors:\n    \n    `> show lom   CLINFR0329 Invalid command:'show lom'.`  \n    `> show lom`  \n    `LomErr 03 Get LOM information failed`  \n    `> show lom   LOM is not installed`\n    \n\n-   When using WebUI to login to LOM you get \"Session Expired\" error.\n-   Restoring the appliance to factory default does not resolve the issue.\n\n**Background  \n**Before we jump to solutions lets review how the LOM and IPMI interoperate.  \n\nIntelligent Platform Management Interface (IPMI) is a open standard for configuring monitoring hardware.  ‘ipmitool’ is the primary command line utility to configure ipmi hardware such as Lights Out Management (LOM).  Check Point has some GAIA scripts which run from CLISH or Expert mode to interface with ipmitool.  Any of the methods can be used to configure the LOM hardware.\n\nThe Gateway appliance runs a ‘ipmi’ service under GAIA and the LOM card runs a ‘ipmi’ service on it’s operating system.  The LOM card plugs into a connector on the motherboard and the two 'ipmi' services communicate with each other over the ‘LPC’ bus.  Starting the Gaia ‘ipmi’ service with command  “service ipmi start” is only required if the GAIA or clish commands are needed to configure the LOM or if the LOM is not responding with LOM info\n\nThe IPMI service is not required to be running on the Gateway appliance to allow your browser to connect to the LOM IP (https://<lom\\_IP>. If the Gateway device is not allowing you to start IPMI service, then you will not be able to login or configure LOM via the ipmitool utility or the clish>show lom or >set lom commands. \n\nThe instructions below explain how to use the GAIA scripts to start service or try to manually start the 3 IPMI drivers. Or if nothing works, RMA the LOM.\n\nNOTE:  Most Check Point Gateway Appliances use LOM's based on Java.  Smart1 Management appliances typically use LOM's based on HTML-5.  The information in this SK is specifically for the LOM Java-based cards.  (it may be slightly different for HTML-5 based LOM.)  \n\n### How to check LOM status and start or stop the IPMI service\n\nVerify IPMI drivers are running. Use Start or Stop flags to change status.  \n`# service ipmi status   # service ipmi start   # service ipmi stop`\n\n### How to check the LOM version or Type\n\nIf you see your LOM version is lower than the version in [sk88064](https://support.checkpoint.com/results/sk/sk88064 \"LOM Card Firmware version map\") please update the LOM firmware before troubleshooting other errors.\n\n#### Using Expert Mode CLI:\n\n`[Expert@gw]# lominfo`  \n`Firmware Revision : 0.25`  \n`IP Address : 172.25.48.137`\n\nOr \n\n`[Expert@gw]# ipmitool mc info`  \n`Device ID                 : 32`  \n`Device Revision           : 1`  \n`Firmware Revision         : 0.25`  \n`IPMI Version              : 2.0`  \n`Manufacturer ID           : 0`  \n`Manufacturer Name         : Unknown`  \n`Product ID                : 43707 (0xaabb)`  \n`Product Name              : Unknown (0xAABB)`  \n`Device Available          : yes`  \n`Provides Device SDRs      : no`  \n`Additional Device Support :`  \n    `Sensor Device`  \n    `SDR Repository Device`  \n    `SEL Device`  \n    `FRU Inventory Device`  \n    `IPMB Event Receiver`  \n    `IPMB Event Generator`  \n    `Chassis Device`  \n`Aux Firmware Rev Info     :`  \n    `0x47`  \n    `0x5b`  \n    `0xab`  \n    `0x00`\n\n#### Using Clish:\n\n`> show asset lom-info`  \n`LOM Status: Installed`  \n`LOM Firmware Revision: 0.25`\n\n`> show lom`  \n`ip-address - Show LOM IP address`  \n`sel        - Show LOM System event logs`  \n`sensors    - Show LOM Sensors information`  \n`type       - Show LOM card type, \"JAVA based LOM\" or \"HTML5 based LOM\"`  \n`version    - Show LOM firmware version`\n\n`> show lom`  \n`Firmware Revision : 5.18`  \n`IP Address : 172.25.48.137`\n\n`> show lom type`  \n`Card: AST2300`  \n`JAVA based LOM`\n\n### How to configure LOM IP and LAN settings\n\n#### Using Expert Mode CLI:\n\nCheck current LAN settings.  \n`# ipmitool lan print 8`  \nConfigure a new IP, netmask and gateway on LOM.  \n`# lomipset 172.25.48.137 255.255.255.0 172.25.48.254`\n\n#### Using Clish:\n\nCheck current LAN settings `show lom ip-address`  \nConfigure a new IP, netmask and gateway on LOM.  \n`> set lom ip-address 172.25.48.137 subnet-mask 255.255.255.0 gateway 172.25.48.254   Setting LOM interface network connection, please wait...`\n\n  \n\n### How to reset LOM Admin Password\n\nIf you see a login prompt but do not know the password then the \"LOM Admin Guide - Logging In to the LOM WebUI\" says the default LOM userid/password is admin/admin. If you fail to login with Admin/Admin that means someone has previously logged in and was forced to change the password.  If you don’t know the password, proceed with reset steps here.  \n\nYou need to first reset the \"admin\" user password using the ipmitool command.  Please follow the requirements in step 7 of the LOM Admin Guide otherwise you will get this error \"Set User Password command failed (user 2): Invalid data field in request\" when you set the new password  \n•  The password requirements:\n\n-      8 - 16 characters long\n-      Does not include the username\n-      No spaces\n-      Must contain characters from three of these four categories:\n\n-      English uppercase characters (A through Z)\n-      English lowercase characters (a through z)\n-      Digits 0 through 9\n-      Non-alphanumeric characters: ~ ! @ # $ % ^ & \\*\n\nSteps:1.  List all LOM users\n2.  Reset password for LOM \"admin\" user. \n\n-   `# ipmitool user list 2`\n-   `# ipmitool user set password <ID_for_admin>`\n\nExample:  \n`# ipmitool user list 2`  \n`ID  Name             Enabled Callin  Link Auth  IPMI Msg   Channel Priv Limit`  \n`1                    true    false   false      true       ADMINISTRATOR`  \n`2   admin            true    false   false      true       ADMINISTRATOR`\n\nReset password for LOM user “admin” which is ID 2:  \n`# ipmitool user set password 2`  \n`Password for user 2:`  \n`Password for user 2:`\n\nNow you can proceed to open the LOM WebUI and login as admin with the new password you just set.\n\n### How to reset the LOM to factory defaults\n\nThe LOM will lose all configuration and the default userid and password will be \"admin\" and \"admin\".   See sk127573.  \n`# ipmitool raw 0x2e 0x02`\n\n  \n\n### How to troubleshoot various LOM commands\n\nTo troubleshoot the \"show lom\" errors, Session Expired or if restoring factory default does not resolve the issue, follow these steps.   \n**Note:**  These commands are frequently a solution when a previous session is hung from connecting to LOM via WEB and see \"Session Expired\" error, you can try one of the following for reset:\n\n#### Instructions\n\n1.  Identify the current state of the LOM:  \n    `# ipmitool lan print <Number_of_Channel>`\n2.  To check the relevant Channel's number, refer to [sk92986: How to check and set an IP address of a LOM card on a Check Point appliance](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92986). \n\n-   example: `# ipmitool lan print 8`\n\n4.  Interact with IPMI service from the GAIA OS level. Try to restart the service:  \n    -   `# service ipmi status`\n    -   `# service ipmi stop`\n    -   `# service ipmi start`\n5.  Are 'ipmi' services running?   \n    `ps -aux |grep ipmi`  \n    If not, then try running the 3 modprobe commands and see if one of those creates an error.  \n    `# modprobe ipmi_msghandler   # modprobe ipmi_devintf   # modprobe ipmi_si`\n6.  If ipmi services are running and you can not get a reply from the ipmi commands that may indicate your LOM is hung.  The only way to restart the hung LOM is to power cycle the Appliance, wait 5 minutes, then turn appliance on.\n7.  If ipmi services are running and you now see repsonses from the ipmi commands you can try to reboot the LOM from the cli.\n\n-   `> show lom Firmware Revision : 5.18 IP Address : 172.25.48.137`  \n    -   `# ipmitool mc reset cold`\n\n9.  If ipmi services will not start we can try several options:\n\n-   Follow sk167074 and run `# echo 'options ipmi_si type=\"kcs\" ports=\"0xca8\" regspacings=\"4\"' >> /etc/modprobe.conf # service ipmi start`\n-   Disconnect electricity from the machine in order to power down the LOM.\n    \n    **Note:** It is possible that you may be able to interact with LOM via WEB, but still be unable to see the LOM's IP address with the following command:\n    \n    -   `> show lom`\n    \n    `CLINFR0329 Invalid command:'show lom'.`\n    \n      \n    If this occurs, run these commands to manually load the necessary drivers, and try again:  \n    \n    -   `# modprobe ipmi_msghandler`\n    -   `# modprobe ipmi_devintf`\n    -   `# modprobe ipmi_si`\n    \n      \n    If the driver fails to load, the reason may be a frozen or faulty LOM. These errors appear in _/var/log/messages_:\n    -   `Could not open device at /dev.ipmi or /dev/ipmi/0: No such file or directory` \n-   If ipmi services are running and you do see a login banner on the LOM WebUI but you can not login. You have a couple options:\n    -   Use the \"ipmitool user\" command to reset password by finding the ID for the admin user, resetting the password.  Prompts will ask for new password 2 times. See \"How To\" section above.\n    -   Follow sk127573 and reset LOM to factory defaults. The LOM will lose all configuration and the default userid and password will be \"admin\" and \"admin\".  \n        `# ipmitool raw 0x2e 0x02`\n-   If the steps above do not resolve the issue, you last resort is to request an RMA for the LOM Board. [Contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/) to open an RMA request. For more information about Check Point's RMA policy click [here](https://www.checkpoint.com/support-services/rma-return-process/).\n    \n    ### References\n    \n-   GitHub - ipmitool/ipmitool: An open-source tool for controlling IPMI-enabled systems\n-   [sk92986](https://support.checkpoint.com/results/sk/sk92986) -How to check and set an IP address of a LOM card on a Check Point appliance\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorElad Ben-David\n\nTechnical ResourceYacov Simhony\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2020-12-09\n\nLast Modified2024-08-19\n\nEditorElad Ben-David\n\nLast ApproverLuis Cancino","language":"md","time":"14 days ago","created":"2025-05-06T22:56:18.283Z","annotations":[],"updated":"2025-05-06T23:03:19.274Z"},{"title":"Troubleshooting Check Point Management Server Migration Issues","id":"827c03b3-8c86-4342-abf8-b1519a0431a3","type":"TEXT","raw":"ProductMulti-Domain Security Management, Quantum Security Management\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-01-16\n\n## Solution\n\nTo investigate the `migrate_server import` command failure on the Management Server, follow these steps:\n\n### Part 1 - Open a Service Request with Check Point Support\n\n> [Contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/)\n\n### Part 2 - Collect the required files from the source Management Server\n\n1.  The CPinfo file ([sk92739](https://support.checkpoint.com/results/sk/sk92739)):  \n    `cpinfo -z -d -D -S -o /var/log/source_mgmt_server_cpinfo [-c <Domain_Name>]`\n2.  The exported management database.\n3.  Output of the CPM Doctor script (Check Point Support will provide this script to you).\n\n### Part 3 - Collect the required files from the target Management Server\n\n1.  The CPinfo file ([sk92739](https://support.checkpoint.com/results/sk/sk92739)):  \n    `cpinfo -z -d -D -S -o /var/log/target_mgmt_server_cpinfo [-c <Domain_Name>]`\n2.  Log files:\n    \n    -   `$MDS_FWDIR/log/upgrade_summary.elg`\n    -   `$MDS_FWDIR/log/upgrade_client.elg`\n    -   `$MDS_FWDIR/log/upgrade_log.*`\n    -   `$MDS_FWDIR/log/cpm.elg*`\n    -   `$CPDIR/log/migrate*.elg`\n    \n    You can collect all these log files with this command in the Expert mode:  \n    \n    `tar cvfz /var/log/target_mgmt_server_log_files.tgz $MDS_FWDIR/log/upgrade_summary.elg* $MDS_FWDIR/log/upgrade_client.elg* $MDS_FWDIR/log/upgrade_log.* $MDS_FWDIR/log/cpm.elg* $CPDIR/log/migrate*.elg`\n    \n    And get this file:  \n    `/var/log/target_mgmt_server_log_files.tgz`\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorYarin Cohen\n\nTechnical ResourceTal Parag\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2024-06-24\n\nLast Modified2025-01-16\n\nEditorYarin Cohen\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only\n\nThis SK applies to R82.10 as well\n\nProvide the latest CPM Doctor script from this INTERNAL article:\n\n/var/log/upgrade-export.<time stamp>.tgz  \n/var/log/upgrade-import.<time stamp>.tgz\n\nScript for collecting the files \"[migrate\\_import\\_collect.sh](https://support.checkpoint.com/results/download/133753)\":\n\n$MDS\\_FWDIR/log/upgrade\\_summary.elg  \n$MDS\\_FWDIR/log/upgrade\\_client.elg  \n$MDS\\_FWDIR/log/upgrade\\_log.\\*  \n$MDS\\_FWDIR/log/cpm.elg\\*  \n$CPDIR/log/migrate\\*.elg","language":"md","time":"14 days ago","created":"2025-05-06T22:56:25.566Z","annotations":[],"updated":"2025-05-06T23:04:50.316Z"},{"title":"Troubleshooting Check Point Scalable Platform Pull Registry Failures","id":"ffd1bb30-62ec-440a-9520-ae7301dfdaa9","type":"TEXT","raw":"ProductQuantum Maestro, Quantum Scalable Chassis\n\nVersionR80.20SP (EOS), R80.30SP (EOS), R81 (EOS), R81.10, R81.20, R82\n\nLast Modified2025-04-20\n\n#### For internal users only\n\n## Symptoms\n\n-   Pull registry fails during a configuration pull on a Scalable Platform environment.\n    \n    **Note**: You recently updated the licenses, or this is a new implementation.\n    \n-   There is a pull\\_config pnote on some Security Group Members.\n    \n-   The `$FWDIR/log/blade_config` file contains a \"`Pull registry failed`\" log.\n    \n\n## Cause\n\nThe \"registry pull\" can fail because of these three files:\n\n-   `/var/log/merge_license_file.log`\n-   `$CPDIR/conf/cp.license`\n-   `$CPDIR/conf/cp.license.smo`\n\nThese three files are responsible for the license's integrity across the Scalable Platform environment.\n\n## Solution\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorNiran Koren\n\nTechnical ResourceAlon Cohen\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2023-07-13\n\nLast Modified2025-04-20\n\nEditorNiran Koren\n\nLast ApproverKatya Horwitz\n\n## Comments\n\n#### Internal only\n\n/var/log/merge\\_license\\_file.log:\n\n2022-12-03 04:24:23,683 DEBUG 210: \\_\\_init\\_\\_(): source\\_file: /opt/CPshrd-R81.10/conf/cp.license, local\\_file: /opt/CPshrd-R81.10/conf/cp.license.smo, dest\\_file: /opt/CPshrd-R81.10/tmp/cp.license.smo.tmp  \n2022-12-03 04:24:23,683 ERROR 117: load\\_lic\\_file(): **Wrong number of lines: 4 in file: /opt/CPshrd-R81.10/conf/cp.license. Not a multiple of 3.**  \n2022-12-03 04:24:23,683 DEBUG 103: print\\_summary(): There was failure while merge of license files","language":"md","time":"14 days ago","created":"2025-05-06T22:56:23.545Z","annotations":[],"updated":"2025-05-06T23:02:53.518Z"},{"title":"CloudGuard Network for Azure - High Availability Mode","id":"971aa7b2-5d4f-4902-a661-6f270005ad05","type":"TEXT","raw":"## ATRG: CloudGuard Network for Azure - High Availability (HA)\n\nProductCloudGuard Network for Azure\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nPlatformAzure\n\nLast Modified2024-10-27\n\n## Solution\n\n**Table of Contents**\n\n-   Introduction\n    \n-   Important Information\n    \n-   FAQ\n    \n-   Errors and Troubleshooting\n    \n    -   General\n        \n    -   Tester\n        \n    -   Failover\n        \n    -   Traffic\n        \n-   Contact Check Point Support\n    \n\n**  \nNote:** To stay up-to-date refer to [CloudGuard for Azure latest updates](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk132192)\n\nClick Here to Collapse the Entire Sections\n\n## Introduction\n\nThe CloudGuard Network cloud security solution delivers advanced Threat Protection to private or public cloud infrastructures. It controls and manages the security in both the physical and virtual environments with one unified management solution.\n\nA cluster is a group of Virtual Machines that work together in a High Availability Mode. One Cluster Member is the Active, and the second Cluster Member is the Standby. The cluster fails over from the Active Cluster Member to the Standby Cluster Member when necessary.\n\n-   Cluster Members communicate with each other using unicast IP addresses.\n-   For inbound, outbound, and East-West traffic, Cluster Members rely on Azure Load Balancers to represent their external and internal Virtual IP addresses. Load Balancers only forward traffic to the Active Cluster Member.\n-   For VPN traffic, Cluster Members use API calls to Azure to communicate the failover from the Active Cluster Member. The Standby Cluster Member then promotes itself to Active. During cluster failover, the Standby Cluster Member associates the Active Cluster Member's private and public cluster IP addresses with its external interface.\n\n**To get additional information about the solution, refer to:**\n\n-   [CloudGuard Network for Azure HA Admin Guide](https://sc1.checkpoint.com/documents/IaaS/WebAdminGuides/EN/CP_CloudGuard_Network_for_Azure_HA_Cluster/Default.htm)\n-   [CloudGuard Network for Public Cloud - Frequently Asked Questions](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk174006)\n-   [CloudGuard Network for Public Cloud - Important Resources](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk173705)\n-   [CloudGuard Network for Public Cloud - Performance Data Sheets](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk171052)\n\n##   \nImportant Information\n\n  \n\n<table><tbody><tr><td><strong>SK</strong></td><td><strong>Description</strong></td><td><strong>Versions</strong></td><td><strong>Fix</strong></td></tr><tr><td><a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk171553\" target=\"_blank\" rel=\"noopener\">sk171553</a></td><td>Default policy is loaded on Azure Gateways after a policy install or after a crash on the Gateway</td><td>R81<br>R80.40<br>R80.30<br>R80.20<br>R80.10</td><td>Images with build higher than 800.<p><strong>Jumbo Hotfix</strong><br>R81 Take 25<br>R80.40 Take 114<br>R80.30 Take 235<br>R80.20 Take 39</p></td></tr><tr><td><a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk164838\" target=\"_blank\" rel=\"noopener\">sk164838</a></td><td>Corrupted memory and/or user-mode code dumps on Azure Gateways and OCI</td><td>R80.30</td><td>Images with build higher than 614.</td></tr><tr><td><a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk169417\" target=\"_blank\" rel=\"noopener\">sk169417</a></td><td>User space core dumps on Security Gateways that use the AES-GCM encryption algorithm</td><td>R80.40<br>R80.30</td><td>Images with build higher than 800.<p><strong>Jumbo Hotfix</strong><br>R80.40 Take 87<br>R80.30 Take 227</p></td></tr><tr><td><a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk170660\" target=\"_blank\" rel=\"noopener\">sk170660</a></td><td>Important certificate update to CloudGuard Controller, Cloud Management Extension (CME), and Azure HA Security Gateways</td><td>R80.40<br>R80.30<br>R80.20<br>R80.10</td><td>Images with build higher than 710.<p><strong>Jumbo Hotfix</strong><br>R80.40 Take 89<br>R80.30 Take 226<br>R80.20 Take 188<br>R80.10 Take 287</p></td></tr><tr><td><a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk164838\" target=\"_blank\" rel=\"noopener\">sk164838</a></td><td>Corrupted memory and/or user-mode code dumps on Azure Gateways and OCI for D2v2</td><td>R80.30</td><td>Images with build higher than 614.</td></tr><tr><td><a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk165055\" target=\"_blank\" rel=\"noopener\">sk165055</a></td><td>High CPU on waagent on Azure Gateway</td><td>R80.30</td><td>Images with build higher than 590.</td></tr><tr><td><a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk166674\" target=\"_blank\" rel=\"noopener\">sk166674</a></td><td>Azure Gateway freezes / crashes during Azure server maintenance</td><td>R80.40<br>R80.30</td><td>Images with build higher than 614.<p><strong>Jumbo Hotfix</strong><br>R80.40 Take 38<br>R80.30 Take 195</p></td></tr><tr><td><a href=\"https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&amp;solutionid=sk173631\" target=\"_blank\" rel=\"noopener\">sk173631</a></td><td>\"<em>hv_utils: Shutdown request received - graceful shutdown initiated</em>\" error in message file</td><td>All versions</td><td>Open a ticket to Azure</td></tr></tbody></table>\n\n##   \nFrequently Asked Questions\n\nClick Here to Display the Entire FAQ Section\n\n-   How can I know that my cluster is well configured?  \n    \n    1.  Make sure that the tester (`$FWDIR/scripts/azure_ha_test.py`)passes and there are no errors in `$FWDIR/log/azure_had.log` on each member.\n    2.  Ensure that the cluster members use a Jumbo Hotfix that contains fixes of the relevant limitation mentioned above.\n    3.  Make sure that the daemon in charge of communicating with Azure runs on each cluster member by running: `cpwd_admin getpid -name AZURE_HAD` and ensuring the output is different from 0.\n    \n-   What is the expected failover time?  \n    \n    <table><tbody><tr><td><strong>Use case</strong></td><td><strong>Expected failover time</strong></td><td><strong>Comments</strong></td></tr><tr><td>Site-to-site VPN</td><td>Less than 2 minutes.</td><td>Depends on the Azure API.</td></tr><tr><td>Inbound inspection through the External Load Balancer</td><td>Less than 15 seconds.</td><td>Depends on the Load Balancer health probe.</td></tr><tr><td>Outbound inspection</td><td>Less than 2 minutes.</td><td>Depends on the Load Balancer health probe and Azure API.</td></tr><tr><td>East-West inspection through the Internal Load Balancer</td><td>Less than 15 seconds.</td><td>Depends on the Load Balancer health probe.</td></tr></tbody></table>\n    \n-   Is the solution stateful?  \n    \n    > There are two possible scenarios for the solution:\n    > \n    > 1.  **Using Azure load balancers**  \n    >     While the HA solution supports stateful failover, the failover will not be stateful when the connection passes through an Azure load balancer. When a connection initiates through a load balancer, the load balancer always forwards the connection to the same instance regardless of the health probe or the instance status. Hence, the load balancer sends the existing connection to the same instance even when a failover occurs. Once the connection times out and is reinitiated, it will connect via the new Active member.  \n    >     \n    > 2.  **Using the HA Virtual IP (VIP)**  \n    >     The failover is stateful.\n    \n-   Can I terminate my VPN connection by the load balancer?\n    \n    No, Azure load balancers do not support IPSec.\n    \n-   What do the API calls for HA exactly do?\n    \n    During failover, the only API calls are from the Cluster Member that gets promoted to Active to attach the cluster private and public IP addresses to itself.\n    \n-   Can I use another public IP than the one deployed by the solution?  \n    \n    Yes.\n    \n    On each Cluster Member, edit the configuration file located at `$FWDIR/conf/azure-ha.json`. In `\"clusterNetworkInterfaces\" -> \"eth0\"`, replace the public IP name with the original cluster VIP resource id. Then run `**$FWDIR/scripts/azure_ha_cli.py reconf**`\n    \n    **Note**: Refer to [CloudGuard Network HA admin guide](https://sc1.checkpoint.com/documents/IaaS/WebAdminGuides/EN/CP_CloudGuard_IaaS_HighAvailability_for_Azure/Default.htm) in the \"Upgrading a Check Point CloudGuard IaaS High Availability Solution to a Newer Version\" section for more information.\n    \n\n## Errors and Troubleshooting\n\n-   General\n    \n-   Tester\n    \n-   Failover\n    \n-   Traffic\n    \n\nClick Here to Display the Entire Troubleshoot Section\n\n## General Errors\n\n-   Install policy fails on the cluster members with \"_Installation failed. Reason: TCP connectivity failure ( port = 18191 )( IP = 40.88.211.66 )\\[ error no. 10 \\]._\" error  \n    \n    > **Cause**: There are some possible reasons:\n    > \n    > 1.  The cluster member's VM's are turned off.\n    > 2.  There is no NSG on the cluster VNET allowing the connectivity over SIC port between the Management and the cluster members.\n    > 3.  The cluster members were deployed in an existing VNET, and the frontend Network Security Group (NSG) is missing.\n    > \n    >   \n    > **How to resolve**:  \n    > \n    > 1.  Ensure that the VMs are turned on.\n    > 2.  Ensure that there are [Network Security Groups](https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview) on the cluster's VNET allowing connectivity over SIC port.\n    > 3.  Add a Network Security Group (NSG) as documented in the [HA Admin Guide](https://sc1.checkpoint.com/documents/IaaS/WebAdminGuides/EN/CP_CloudGuard_IaaS_HighAvailability_for_Azure/Content/Topics-Azure-HA/Workflow-for-Setting-Up-a-High-Availability-Cluster-in-Azure.htm?Highlight=NSG).\n    \n-   The cluster members don't use their configuration `$FWDIR/conf/azure-ha.json`  \n    \n    > **Cause**: The configuration file hasn't been loaded into the solution.\n    > \n    > **How to resolve**:  \n    > Load the configuration file by running `**$FWDIR/scripts/azure_ha_cli.py reconf**`.\n    \n-   Install policy on the cluster members displays \"_Anti-Spoofing is not configured for some interfaces and gateways._\" warning  \n    \n    > **Cause**: The warning is because of the Anti Spoofing is disabled from the topology.\n    > \n    > **How to resolve**: No action should be taken. This is a correct configuration.\n    \n-   Deploying the solution into an existing VNET fails due to an IP conflict  \n    \n    > **Cause**: It fails due to Azure ARM limitations.\n    > \n    > **How to resolve**:  \n    > Follow [sk170472](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk170472).\n    \n\n## Troubleshooting Tester Errors\n\n-   The tester fails with the \"_You do not seem to have a valid cluster configuration_\" error  \n    \n-   The tester fails with the \"_Attempting to write - \\[Forbidden\\] Error: HTTP/1.1 403 Forbidden_\" error  \n    \n    > **Cause**: The cluster members do not have Contributor permissions for their VNET or/and their NICs or/and the Cluster IP address or/and the Network Security Group.\n    \n    >   \n    > **How to resolve**:  \n    > \n    > 1.  Navigate to the cluster's VNET resource group or/and the cluster's resource group (in case of Network Security Group from a different resource Group - navigate to the NSG resource).\n    > 2.  Assign the following [Azure's permissions](https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/howto-assign-access-portal) for each cluster’s managed identity created by the deployment\n    > \n    > 1.  1.  1.  Contributor to the cluster managed identity named  **`<CLUSTER_NAME1>`**\n    >         2.  Contributor to the cluster managed identity named  **`<CLUSTER_NAME2>`**\n    > \n    > 4.  Wait few minutes for the changes to take place (up to one hour).\n    \n    > **Note**: If you use the old cluster solution, you need to perform the steps above for all the VNET's peered to the cluster VNET.\n    \n    > To check if you use the old cluster solution, run `**cat /etc/cloud-version | grep template_name**` and the output should be `**cluster**`.\n    \n-   The tester fails on the Standby member with an empty error  \n    \n    > **Cause**: Outbound traffic initiated by the Standby member passes through the Active member.\n    \n    >   \n    > **How to resolve**:  \n    > Install the latest Jumbo Hotfix on the cluster members.  \n    > **Note**: There is no impact on the cluster performance as only the Active member performs API call.\n    \n-   The tester fails with the \"_Unable to connect to login.windows.net:443_\" error  \n    \n    > **Cause**: There is no outbound connectivity to Azure.\n    > \n    > **How to resolve**:\n    > \n    > 1.  Ensure dns settings are correct:  \n    >     The command `**nslookup management.azure.com**` should return the output:  \n    >     `**Server: X.X.X.X   Address: X.X.X.X#53**`.  \n    >     If the command does not return a similar output, configure your DNS accordingly.  \n    >     It is recommended to have the Primary or Secondary DNS set to the Azure default, as mentioned in [sk122274](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk122274).\n    > 2.  Resolve Azure connectivity:  \n    >     The command `**curl_cli --verbose https://management.azure.com?api-version=1.3 --cacert $CPDIR/conf/ca-bundle-public-cloud.crt**` should return the following output: `**Connected to management.azure.com (X.X.X.X) port 443**`.  \n    >     If the command doesn't return a similar output, set Azure connectivity.\n    \n-   The tester fails for newly created R80.30 HA members with the \"_HTTP/1.1 400 Bad Request_\" error  \n    \n    > **Cause**: There is the expected behavior up to one hour.\n    > \n    > **How to resolve**: Follow [sk164316](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk164316).\n    \n-   The tester fails with API version error  \n    \n    > **Cause**: A missing parameter in azure-ha.json file is causing the cluster to behave in a legacy mode requiring to update UDRs to successfully complete a failover.\n    > \n    > **How to resolve**: Follow [sk176463.](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk176463)\n    \n\n## Troubleshooting Failover Issues\n\n-   Azure HA log file shows the \"_rest.TimeoutException: b'curl: (28) Operation timed out after 20000 milliseconds with 0 bytes received\\\\n_\" error  \n    \n    > **Cause**: Azure API server did not respond to the active member's API requests in 20 seconds.\n    > \n    > **How to resolve**:\n    > \n    > 1.  There are no functionality impact if the log is not shown repetitively.\n    > 2.  If the log appears repetitively, ensure there are no connectivity issue to Azure. Run `**curl_cli --verbose https://management.azure.com?api-version=1.3 --cacert $CPDIR/conf/ca-bundle-public-cloud.crt**` and part of the output should be `**Connected to management.azure.com (X.X.X.X) port 443**`. If the output is `**Failed to connect to management.azure.com port 443: Connection timed out**`, fix Azure's connectivity.\n    \n-   Azure HA log file shows the \"_HTTP status code 429 Too many requests\"_\" error  \n    \n-   Azure HA log file shows the \"_Couldn't resolve host 'management.azure.com'_\" error.  \n    \n    > **Cause**: There is no outbound connectivity to Azure.\n    \n    >   \n    > **How to resolve**:  \n    > \n    > 1.  Ensure DNS settings are correct:  \n    >     The command `**nslookup management.azure.com**` should return the output:  \n    >     `**Server: X.X.X.X   Address: X.X.X.X#53**`.  \n    >     If the command does not return a similar output, configure your DNS accordingly.  \n    >     It is recommended to have the Primary or Secondary DNS set to the Azure default, as mentioned in [sk122274](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk122274).\n    > 2.  Resolve Azure connectivity:  \n    >     The command `**curl_cli --verbose https://management.azure.com?api-version=1.3 --cacert $CPDIR/conf/ca-bundle-public-cloud.crt**` should return the following output: `**Connected to management.azure.com (X.X.X.X) port 443**`.  \n    >     If the command does not return a similar output, set Azure connectivity.\n    > \n    >   \n    > **Note**: There is no impact on the cluster performance as only the Active member performs API calls.\n    \n-   VIPs did not attached to the newly active member and Azure HA log file shows this error _{\"error\":{\"code\":\"InvalidRequestFormat\",\"message\":\"Cannot parse the request.\",\"details\":\\[  \n    {\"code\":\"DuplicateResourceName\",\"message\":\"Resource /subscriptions//resourceGroups//providers/Microsoft.Network/networkInterfaces/ has two child resources with the same name (Capital-VIP).\"}_  \n    \n    > **Cause**: The VIP name under the NIC IP -configuration in azure portal contains capital letters\n    > \n    > **How to resolve**:\n    > \n    > • Rename VIP name to contain only lower case letters\n    > \n    > • Modify the `azure_had.py` on the machine:\n    > \n    > 1.  Locate the HA script under `$FWDIR/scripts/azure_had.py`\n    > 2.  Find the `get_cluster_ip_index` function\n    > 3.  Change the following line:\n    >     \n    >     ```\n    >     if ipc[NAME].lower() == name:\n    >     ```\n    >     \n    >     to:\n    >     \n    >     ```\n    >     if ipc[NAME].lower() == name.lower():\n    >     ```\n    >     \n    > 4.  Run `$FWDIR/scripts/azure_ha_cli.py restart` to load the changes\n    \n\n## Troubleshooting Traffic Issues\n\n-   Hide NAT and static NAT (to the public IP address) are applied to the Standby Gateway  \n    \n    >   \n    > **Hide NAT behind VNET**:  \n    > \n    > -   **Cause**:  \n    >     It fails because when selecting Hide NAT on the VNET, the Standby member requests are hidden behind the cluster IP (VIP) on eth0. The Active member owns this, so Azure will drop the packet since it is not the proper device sending this request.\n    > -   **How to resolve**  \n    >     Disable NAT to resolve this. Add a No-NAT rule originating from each Gateway for HTTP, HTTPS, and DNS.\n    \n    >   \n    > **Static NAT to public IP**:  \n    > \n    > -   **Cause**:  \n    >     It fails because Azure owns the Public IP, and it is not expecting the public IP to come from the firewalls.\n    > -   **How to resolve**  \n    >     Disabling this NAT rule resolve the problem.\n    \n-   The gateways don't respond to Azure health probes requests  \n    \n    > **Cause**: There are several possible reasons:\n    > \n    > 1.  The load balancer health probes requests are not received by the cluster members.\n    > 2.  The active member does not handle the health probes as expected.\n    > \n    >   \n    > **How to resolve**:  \n    > \n    > 1.  Ensure that health probe using port 8117 are configured in the solution's load balancers. See the [Azure health probe official documentation](https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-custom-probe-overview) for more information.\n    > 2.  Follow [sk171584](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk171584).\n    \n-   The Standby cluster member cannot access the Internet  \n    \n    > **Cause**: The Standby cluster member is hidden behind the VIP when it should leave through the member IP address.  \n    > **  \n    > How to resolve**: Follow [sk175108](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk175108).  \n    > **Note**: There is no impact on the cluster performance as only the Active member performs API calls.\n    \n\n## Contacting Check Point Support\n\nIf you still encounter issues although the section above, contact your local Check Point Support and attach the following files to the case to speed-up the process:\n\n-   `/etc/cloud-version`\n-   `$FWDIR/conf/azure-ha.json`\n-   `$FWDIR/log/azure_had.elg*`\n-   `/var/log/cloud_config.log`\n-   `$FWDIR/boot/modules/fwkern.conf`\n-   `curl_cli --verbose https://management.azure.com --cacert $CPDIR/conf/ca-bundle-public-cloud.crt > /home/admin/azure-connectivity.txt`\n-   `$FWDIR/scripts/azure_ha_test.py > /home/admin/ha-tester-output.txt`\n-   `cphaprob state > /home/admin/cphaprob-stat.txt`\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorAriel Tobiana\n\nTechnical ResourceNatanel Mor\n\nAccess LevelGeneral\n\nStatusApproved by TAC\n\nDate Created2021-09-01\n\nLast Modified2024-10-27\n\nEditorGil Frantsus\n\nLast ApproverDaniel Epstein\n\n## Comments\n\n#### Internal only\n\nUsed in code (azure\\_had\\_test.py) - do not delete.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:21.175Z","annotations":[],"updated":"2025-05-06T23:05:22.214Z"},{"title":"Check Point API: Identify Modified Objects in Last 24 Hours","id":"732a2eec-dc25-48ea-9372-7ae51580179f","type":"TEXT","raw":"ProductMulti-Domain Security Management, Quantum Security Management\n\nVersionR81.10, R81.20, R82\n\nLast Modified2024-12-22\n\n## Solution\n\nThis solution explains how to use API commands to identify objects that were modified in the last 24 hours.\n\n**Use Case - Security Audit and Change Management**\n\nConsider a security team that needs to review all host object changes made in their Check Point environment during the last 24 hours.\n\nThis is useful for:\n\n-   Compliance requirements (for example, tracking configuration changes for audit purposes and verifying authorized modifications).\n    \n-   Security operations (for example, detecting unauthorized changes and investigating potential security incidents).\n    \n-   Change management (for example, verifying that implemented changes match approved requests and tracking administrator activities).\n    \n\n**Procedure**\n\nMethod 1: Two-Step Process\n\n1.  Get the POSIX timestamp for 24 hours ago with this command:\n    \n    ``[Expert@Mgmt:0]# echo $(( (`date +%s`-24*60*60)*1000 ))``\n2.  Use the timestamp with the management API command:\n    \n    `[Expert@Mgmt:0]# mgmt_cli show hosts details-level full -f json -r true | jq '.objects[] | select(.[\"meta-info\"][\"last-modify-time\"].posix>\"OUTPUT of the ECHO command\")`\n\nMethod 2: Single Command\n\nExecute both operations in one command:\n\n``[Expert@Mgmt:0]# mgmt_cli show hosts details-level full -f json -r true | jq  '.objects[] | select(.[\"meta-info\"][\"last-modify-time\"].posix>($DT|tonumber))' --arg DT $(( (`date +%s`-24*60*60)*1000 ))``\n\n**Output Example**\n\n`{`  \n  `\"uid\": \"888def5e-c995-4629-88f9-6d68c544ebbb\",`  \n  `\"name\": \"T1\",`  \n  `\"type\": \"host\",`  \n  `\"domain\": {`  \n    `\"uid\": \"41e821a0-3720-11e3-aa6e-0800200c9fde\",`  \n    `\"name\": \"SMC User\",`  \n    `\"domain-type\": \"domain\"`  \n  `},`  \n  `\"ipv4-address\": \"1.1.1.1\",`  \n  `\"interfaces\": [],`  \n  `\"nat-settings\": {`  \n    `\"auto-rule\": false`  \n  `},`  \n  `\"comments\": \"\",`  \n  `\"color\": \"sea green\",`  \n  `\"icon\": \"Objects/host\",`  \n  `\"tags\": [],`  \n  `\"meta-info\": {`  \n    `\"lock\": \"unlocked\",`  \n    `\"validation-state\": \"ok\",`  \n    `\"last-modify-time\": {`  \n      `\"posix\": 1733411999542,`  \n      `\"iso-8601\": \"2024-12-05T10:19-0500\"`  \n    `},`  \n    `\"last-modifier\": \"admin\",`  \n    `\"creation-time\": {`  \n      `\"posix\": 1733240544208,`  \n      `\"iso-8601\": \"2024-12-03T10:42-0500\"`  \n    `},`  \n    `\"creator\": \"admin\"`  \n  `},`  \n  `\"read-only\": false,`  \n  `\"available-actions\": {`  \n    `\"edit\": \"true\",`  \n    `\"delete\": \"true\",`  \n    `\"clone\": \"true\"`  \n  `}`  \n`}`\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorParth Patel\n\nTechnical ResourceYefim Skvirsky\n\nAccess LevelExpert\n\nStatusApproved by TAC\n\nDate Created2024-12-16\n\nLast Modified2024-12-22\n\nEditorParth Patel\n\nLast ApproverNatalia Zhdanova","language":"md","time":"14 days ago","created":"2025-05-06T22:56:25.733Z","annotations":[],"updated":"2025-05-06T23:03:52.339Z"},{"title":"Troubleshooting Intermittent Threat Emulation Cloud Connection Errors on Check Point Cluster Standby Member","id":"e6c5d5a0-0fb9-4a23-b0e8-0165840be982","type":"TEXT","raw":"---\ncreated: 2025-04-29T19:02:58 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk183398\nauthor: \n---\n\n# sk183398 - \"Threat Emulation - Communication Error: Could Not Connect to Cloud\" Intermittent Alert on Standby Cluster Member\n\n> ## Excerpt\n> Applies to: ClusterXL, Threat Emulation\n\n---\nProductClusterXL, Threat Emulation\n\nVersionR81.20\n\nOSGaia\n\nLast Modified2025-04-29\n\n#### For internal users only\n\n## Symptoms\n\n-   \"_Threat Emulation - Communication Error: Could Not Connect to Cloud_\" intermittent alerts appearing on the cluster standby member.\n    \n-   The alert resolves itself without manual intervention.\n    \n-   When the Security Gateways are rebooted and cluster roles swap, the issue appears on the new standby member.\n    \n-   The active cluster member operates normally without any Threat Emulation communication errors.\n    \n\n## Cause\n\nThis issue occurs because the standby cluster member does not handle outbound connections to the Threat Emulation cloud services correctly. By default, the standby member routes traffic through the active member, but due to asymmetric routing, some reply packets from the Threat Emulation cloud are sent directly to the standby member. This creates asymmetric connections. Although the firewall kernel can handle these connections, some features, like Threat Emulation, may not function correctly in this state.\n\nIn one case, packet captures showed that the active member used its physical IP address instead of the VIP (Virtual IP). As a result, the cloud service sent reply packets directly to the standby member's physical IP address, bypassing the active member.\n\n## Solution\n\nModify the cluster configuration to allow the standby member to handle outbound traffic independently. Run these commands to change the kernel parameters on both cluster members:  \n`fw ctl set -f int fwha_silent_standby_mode 0`  \n`fw ctl set -f int fwha_cluster_hide_active_only 0`  \nThe \"-f\" flag ensures these changes persist across reboots, so no additional configuration file changes are needed.\n\nThese changes configure the standby member to handle its own outbound connections rather than routing through the active member, eliminating the asymmetric routing issue that was causing the Threat Emulation communication errors.\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorEden Bobovnik\n\nTechnical ResourceBashar Shabaita\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2025-04-28\n\nLast Modified2025-04-29\n\nEditorEden Bobovnik\n\nLast ApproverRonit Segal\n\n## Comments\n\n#### Internal only\n\nThis issue is primarily related to connection handling in the cluster and how Threat Emulation communicates with the cloud. By default, the standby member tries to communicate via the active member, but when asymmetric routing occurs, the TLS session can fail with decrypt errors (alert code 21).\n\nThe solution modifies the cluster's behavior by:\n\nDisabling silent standby mode (fwha\\_silent\\_standby\\_mode=0), which allows the standby member to communicate directly.  \nSetting fwha\\_cluster\\_hide\\_active\\_only=0, which controls how VIPs are handled.  \nTroubleshooting for similar issues should include:\n\nChecking for NO-NAT rules that might be affecting traffic to Threat Emulation servers  \nPacket captures on both cluster members' interfaces (external and sync)  \nKernel debug logs with cluster and forward flags enabled  \nVerification of TLS connectivity from the standby member  \nThis solution is specific to scenarios where asymmetric routing causes TLS session failures with cloud services, particularly when connection reuse is attempted.\n","language":"md","time":"14 days ago","created":"2025-05-06T22:56:23.694Z","annotations":[],"updated":"2025-05-06T23:03:26.264Z"},{"title":"ProductQuantum Security Gateways, VSX (Traditional)","id":"74988a5e-37c2-4c8e-9262-940535897dfa","type":"TEXT","raw":"ProductQuantum Security Gateways, VSX (Traditional)\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nLast Modified2022-12-20\n\n## Symptoms\n\n-   After users run the `#top`, the _fwkX\\_dev\\_0_ process consumes high CPU. Example output:\n    \n    ```\n     PID USER      PR  NI    VIRT    RES    SHR S  <b>%CPU</b> %MEM     TIME+ COMMAND\n    <p>19437 admin      0 -20 18.402g 0.015t 538544 S <b>309.9</b>  1.0   8626:21 fwk0_dev_0</p>\n    ```\n    \n\n## Cause\n\nBy design, in User Space firewall, there is not a separate process for each _fw\\_worker._ Instead, there is a multi-threaded process: _fwk\\[X\\]\\_dev\\_0_. \\[X\\] represents the number of the firewall instance. Examples: _fwk0\\_dev\\_0_, _fwk\\_1\\_dev\\_0_\n\nThe _fwk\\[X\\]\\_dev\\_0_ process shows all _fwk\\_workers_ below each instance.\n\nIn user space firewall instances (non-VSX) there is one _fwk0\\_dev\\_0_ process.\n\nIn a VSX environment, each Virtual System has its own _fwk\\[X\\]\\_dev\\_0_ process. For example, in a VSX environment _fwk0\\_dev\\_0_ belongs to VS0 and _fwk1\\_dev\\_0_ belongs to VS1_._\n\nThe CPU usage value for a fwk\\[X\\]\\_dev\\_0 process can be much higher than 100% CPU usage. This is because fwk\\[X\\]\\_dev\\_0 shows the combined CPU usage for all of the _fwk\\_workers_ processes for a given firewall instance.\n\n## Solution\n\nTo see the real CPU usage for each _fwk\\_worker_ process do one of these:\n\n-   Run the command `#top -H`\n-   Run the command `#top`  and then press \"Shift + h\"\n\n**Output of `top` command:**\n\n**![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk176908/fwkdev_sk202112151017071.png)**\n\n **Output of `top -H` command:**\n\n**![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk176908/fwkdev_sk_2202112151018382.png)**\n\n  \nIf one of the _fwk\\_worker_ processes shows high CPU usage, investigate it further to find the cause of the issue.\n\nFor more information regarding high CPU investigation, see [sk167553](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk167553&partition=Expert&product=Quantum).\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorElad Ben-David\n\nTechnical ResourceAlon Cohen\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2021-12-14\n\nLast Modified2022-12-20\n\nEditorElad Ben-David\n\nLast ApproverPriti Jain\n\n## Comments\n\n#### Internal only\n\nPer Elad Ben-David, this sk is written to help customers understand command outputs properly. It is not written in response to any behavior changes or issues in the field. Thus:\n\n-   There is no specific SR for this issue.\n-   There is no specific JIRA task for this issue.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:21.438Z","annotations":[],"updated":"2025-05-06T23:03:36.684Z"},{"title":"Code Snippet: ProductElasticXL, Quantum Maestro, Remote Access VPN","id":"b31e2655-d7bc-4a0a-bba4-2b804a10e4c6","type":"TEXT","raw":"ProductElasticXL, Quantum Maestro, Remote Access VPN, VSNext, VSX (Traditional)\n\nVersionR82\n\nOSGaia\n\nLast Modified2025-04-20\n\n#### For internal users only\n\n## Symptoms\n\n-   Remote Access VPN client fails to connect, or disconnects and reconnects to the VPN Virtual System when it connects through another Virtual System on a Scalable Platform in the Traditional VSX mode.\n    \n    (Remote Access VPN client) -- (Virtual System) -- (Virtual Switch) -- (VPN Virtual System) — (Internal Network)\n    \n-   Remote Access VPN client fails to connect, or disconnects and reconnects to the VPN Virtual Gateway when it connects through another Virtual Gateway on a Scalable Platform in the VSNext mode.\n    \n    (Remote Access VPN client) -- (Virtual Gateway) -- (Virtual Switch) -- (VPN Virtual Gateway) — (Internal Network)\n    \n-   In SmartConsole / SmartView, the security logs from the intermediate Virtual System / Virtual Gateway show that its Clean Up rule drops the encrypted responses the VPN Virtual System / VPN Virtual Gateway sends to the Remote Access Client.\n    \n-   Kernel debug (`fw ctl zdebug -m fw + drop`) on the intermediate Virtual System / Virtual Gateway confirms that its policy drops the encrypted responses the VPN Virtual System / VPN Virtual Gateway sends to the Remote Access Client.\n    \n\n## Cause\n\nIn a specific topology, where the IPsec traffic flows through an intermediate Virtual System / Virtual Gateway, the security policy on that intermediate Virtual System / Virtual Gateway may drop IKE (UDP port 4500) or encrypted packets, because by the current design the intermediate Virtual System / Virtual Gateway does not synchronize the encrypted connection to all Security Group Members. It only synchronizes with the Security Group Members that have the connection entry of the IPsec tunnel.\n\n## Solution\n\nThis problem was fixed. The fix is included in:\n\n-   [Jumbo Hotfix Accumulator for R82](https://sc1.checkpoint.com/documents/Jumbo_HFA/R82/Default.htm) starting from Take 14\n\nIf you choose not to upgrade, Check Point can supply a **Hotfix**. [Contact Check Point Support](https://www.checkpoint.com/support-services/.contact-support/) to get a Hotfix for this issue.  \nA Support Engineer will make sure the Hotfix is compatible with your environment before providing the Hotfix.  \nFor faster resolution and verification, please collect [CPinfo files](http://supportcontent.checkpoint.com/solutions?id=sk92739) from the Security Management Server and Security Gateways involved in the case.\n\n**Hotfix installation instructions:**  \nRefer to [sk168597 - How to install a Hotfix](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk168597).\n\n#### Workflow\n\n1.  Install the Hotfix on the Security Group.\n    \n    Refer to [sk168597 - How to install a Hotfix](https://support.checkpoint.com/results/sk/sk168597).\n    \n2.  Configure the IDs of the intermediate Virtual Systems / Virtual Gateways as values of the kernel parameter \"`vses_sync_passing_vpn_conns`\".\n    \n    The kernel parameter accepts comma-separated integers from 0 to 512 - the IDs of intermediate Virtual System / Virtual Gateways.\n    \n    Each listed intermediate Virtual System / Virtual Gateway will synchronize all IPsec connections (identified as ESP protocol or UDP-encapsulated ESP) to all Security Group Members.\n    \n    To configure this kernel parameter on a Scalable Platform Security Group, run in Gaia gClish:\n    \n    `fw ctl set -f str vses_sync_passing_vpn_conns 'VSID1,VSID2,...,VSIDn'`\n    \n    Example for VS1 and VS3:\n    \n    `fw ctl set -f str vses_sync_passing_vpn_conns '1,3'`\n    \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorSergei Shir\n\nTechnical ResourceLeonid Orlov\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2025-01-21\n\nLast Modified2025-04-20\n\nEditorSergei Shir\n\nLast ApproverKatya Horwitz\n\n## Comments\n\n#### Internal only\n\nRelevant fixes = PMTR-109317 + PMTR-111502","language":"md","time":"14 days ago","created":"2025-05-06T22:56:25.930Z","annotations":[],"updated":"2025-05-06T23:05:21.951Z"},{"title":"Maestro Appliances for Use with Security Group","id":"ae2febd0-84af-46e9-9131-2ddbb05f5df5","type":"TEXT","raw":"Below is a list of appliances officially approved for use with the Maestro solution.\n\n**Important** - To connect to Quantum Maestro Orchestrators, you must use the same Line Card ports on all appliances in the same Security Group (on each Maestro Site). See [sk158652](https://support.checkpoint.com/results/sk/sk158652).\n\n<table id=\"ModelsTable\"><tbody><tr><td>Model</td><td>Supported Versions</td><td>Supported Cards</td><td>Special Notes</td></tr><tr><td><p><strong>Quantum<br>Force<br>19000<br>and<br>29000</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk180520\" target=\"_blank\" rel=\"noopener\">sk180520</a></li></ul></td><td><ul><li>CPAC-2-40/100F-D<br>(2-Port Single-Width 40/100G QSFP28 Card)</li><li>CPAC-4-10/25F-D</li><li>CPAC-8-1/10F-D</li></ul></td><td></td></tr><tr><td><p><strong>LightSpeed<br>QLS and MLS</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk176466\" target=\"_blank\" rel=\"noopener\">sk176466</a></li></ul></td><td><ul><li>CPAC-2-40/100F-C<br>(2-Port Dual-Width 10/25/40/100G QSFP28+ Card)</li></ul></td><td><ul><li>To connect to Quantum Maestro Orchestrators, you must use <strong>only</strong> the 100G Ports.</li><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li></ul></td></tr><tr><td><p><strong>28600HS</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li></ul></td><td><ul><li>Not applicable</li></ul></td><td><p>28600HS appliance has two fixed 40G/100G downlink ports.</p><p>Refer to the <a href=\"https://www.checkpoint.com/downloads/products/28000-security-gateway-datasheet.pdf\" target=\"_blank\" rel=\"noopener\">appliance datasheet</a> for details.</p></td></tr><tr><td><p><strong>28000</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-C<span>*</span></li><li>CPAC-4-10F-C</li><li>CPAC-2-40F-C</li><li>CPAC-2-100/25F</li><li>CPAC-2-40/100F-C (<a href=\"https://support.checkpoint.com/results/sk/sk181064\" target=\"_blank\" rel=\"noopener\">sk181064</a>)</li></ul></td><td><p>Base and Plus models.</p><p>For CPAC-2-100/25F:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li><li>The minimum required card firmware version is 12.22.1002<br>To get the card firmware version, run this single long command in the Expert mode on the Security Appliance:<br><code>for NIC in $(ifconfig | grep ethsBP | awk '{print $1}') ; do echo $NIC: ; ethtool -i $NIC | grep firmware ; done</code></li></ul><p>For CPAC-2-40/100F-C:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li></ul></td></tr><tr><td><p><strong>26000</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-C<span>*</span></li><li>CPAC-4-10F-C</li><li>CPAC-2-40F-C</li><li>CPAC-2-100/25F</li><li>CPAC-2-40/100F-C (<a href=\"https://support.checkpoint.com/results/sk/sk181064\" target=\"_blank\" rel=\"noopener\">sk181064</a>)</li></ul></td><td><p>Base, Plus, and Turbo models.</p><p>For CPAC-2-100/25F:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li><li>The minimum required card firmware version is 12.22.1002<br>To get the card firmware version, run this single long command in the Expert mode on the Security Appliance:<br><code>for NIC in $(ifconfig | grep ethsBP | awk '{print $1}') ; do echo $NIC: ; ethtool -i $NIC | grep firmware ; done</code></li></ul><p>For CPAC-2-40/100F-C:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li></ul></td></tr><tr><td><p><strong>23900</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-B<span>*</span></li><li>CPAC-4-10F-B</li><li>CPAC-2-40F-B</li><li>CPAC-2-100/25F</li></ul></td><td><p>For CPAC-4-10F-B:</p><ul><li>Output of the \"<code>lspci -v</code>\" command must show:<br><code>Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection</code></li></ul><p>For CPAC-2-40F-B and for CPAC-2-100/25F:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li><li>The minimum required card firmware version is 12.22.1002<br>To get the card firmware version, run this single long command in the Expert mode on the Security Appliance:<br><code>for NIC in $(ifconfig | grep ethsBP | awk '{print $1}') ; do echo $NIC: ; ethtool -i $NIC | grep firmware ; done</code></li></ul></td></tr><tr><td><p><strong>23800</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-B<span>*</span></li><li>CPAC-4-10F-B</li><li>CPAC-2-40F-B</li><li>CPAC-2-100/25F</li></ul></td><td><p>For CPAC-4-10F-B:</p><ul><li>Output of the \"<code>lspci -v</code>\" command must show:<br><code>Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection</code></li></ul><p>For CPAC-2-40F-B and for CPAC-2-100/25F:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li><li>The minimum required card firmware version is 12.22.1002<br>To get the card firmware version, run this single long command in the Expert mode on the Security Appliance:<br><code>for NIC in $(ifconfig | grep ethsBP | awk '{print $1}') ; do echo $NIC: ; ethtool -i $NIC | grep firmware ; done</code></li></ul></td></tr><tr><td><p><strong>23500</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-B<span>*</span></li><li>CPAC-4-10F-B</li><li>CPAC-2-40F-B</li><li>CPAC-2-100/25F</li></ul></td><td><p>For CPAC-4-10F-B:</p><ul><li>Output of the \"<code>lspci -v</code>\" command must show:<br><code>Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection</code></li></ul><p>For CPAC-2-40F-B and for CPAC-2-100/25F:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li><li>The minimum required card firmware version is 12.22.1002<br>To get the card firmware version, run this single long command in the Expert mode on the Security Appliance:<br><code>for NIC in $(ifconfig | grep ethsBP | awk '{print $1}') ; do echo $NIC: ; ethtool -i $NIC | grep firmware ; done</code></li></ul></td></tr><tr><td><p><strong>16600HS</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>Not applicable</li></ul></td><td><p>16600HS appliance has two fixed 40G/100G downlink ports.</p><p>Refer to the <a href=\"https://www.checkpoint.com/downloads/products/16000-security-gateway-datasheet.pdf\" target=\"_blank\" rel=\"noopener\">appliance datasheet</a> for details.</p></td></tr><tr><td><p><strong>16200</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-C<span>*</span></li><li>CPAC-4-10F-C</li><li>CPAC-2-40F-C</li><li>CPAC-2-100/25F</li><li>CPAC-2-40/100F-C (<a href=\"https://support.checkpoint.com/results/sk/sk181064\" target=\"_blank\" rel=\"noopener\">sk181064</a>)</li></ul></td><td><p>Base and Plus models.</p><p>For CPAC-2-100/25F:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li><li>The minimum required card firmware version is 12.22.1002<br>To get the card firmware version, run this single long command in the Expert mode on the Security Appliance:<br><code>for NIC in $(ifconfig | grep ethsBP | awk '{print $1}') ; do echo $NIC: ; ethtool -i $NIC | grep firmware ; done</code></li></ul><p>For CPAC-2-40/100F-C:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li></ul></td></tr><tr><td><p><strong>16000</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-C<span>*</span></li><li>CPAC-4-10F-C</li><li>CPAC-2-40F-C</li><li>CPAC-2-100/25F</li><li>CPAC-2-40/100F-C (<a href=\"https://support.checkpoint.com/results/sk/sk181064\" target=\"_blank\" rel=\"noopener\">sk181064</a>)</li></ul></td><td><p>Base, Plus, and Turbo models.</p><p>For CPAC-2-100/25F:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li><li>The minimum required card firmware version is 12.22.1002<br>To get the card firmware version, run this single long command in the Expert mode on the Security Appliance:<br><code>for NIC in $(ifconfig | grep ethsBP | awk '{print $1}') ; do echo $NIC: ; ethtool -i $NIC | grep firmware ; done</code></li></ul><p>For CPAC-2-40/100F-C:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li></ul></td></tr><tr><td><p><strong>15600</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-B<span>*</span></li><li>CPAC-4-10F-B</li><li>CPAC-2-40F-B</li><li>CPAC-2-100/25F</li></ul></td><td><p>For CPAC-4-10F-B:</p><ul><li>Output of the \"<code>lspci -v</code>\" command must show:<br><code>Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection</code></li></ul><p>For CPAC-2-40F-B and for CPAC-2-100/25F:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li><li>The minimum required card firmware version is 12.22.1002<br>To get the card firmware version, run this single long command in the Expert mode on the Security Appliance:<br><code>for NIC in $(ifconfig | grep ethsBP | awk '{print $1}') ; do echo $NIC: ; ethtool -i $NIC | grep firmware ; done</code></li></ul></td></tr><tr><td><p><strong>15400</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-B<span>*</span></li><li>CPAC-4-10F-B</li><li>CPAC-2-40F-B</li><li>CPAC-2-100/25F</li></ul></td><td><p>For CPAC-4-10F-B:</p><ul><li>Output of the \"<code>lspci -v</code>\" command must show:<br><code>Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection</code></li></ul><p>For CPAC-2-40F-B and for CPAC-2-100/25F:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li><li>The minimum required card firmware version is 12.22.1002<br>To get the card firmware version, run this single long command in the Expert mode on the Security Appliance:<br><code>for NIC in $(ifconfig | grep ethsBP | awk '{print $1}') ; do echo $NIC: ; ethtool -i $NIC | grep firmware ; done</code></li></ul></td></tr><tr><td><p><strong>13800</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li></ul></td><td><ul><li>CPAC-2-10F<span>*</span></li><li>CPAC-4-10F</li></ul></td><td></td></tr><tr><td><p><strong>13500</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li></ul></td><td><ul><li>CPAC-2-10F<span>*</span></li><li>CPAC-4-10F</li></ul></td><td></td></tr><tr><td><p><strong>9400</strong></p><p><strong>9700</strong></p><p><strong>9800</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li></ul></td><td><ul><li>CPAC-2-40/100F-D<br>(2-Port Single-Width 40/100G QSFP28 Card)</li><li>CPAC-4-10/25F-D</li><li>CPAC-8-1/10F-D</li></ul></td><td><p>Base and Plus models.</p><p>To connect to Quantum Maestro Orchestrators, you must use only the supported Line Cards (on-board interfaces are not supported).</p></td></tr><tr><td><p><strong>9100</strong></p><p><strong>9200</strong></p><p><strong>9300</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li></ul></td><td><ul><li>CPAC-4-10/25F-D</li><li>CPAC-8-1/10F-D</li></ul></td><td><p>Base and Plus models.</p><p>To connect to Quantum Maestro Orchestrators, you must use only the supported Line Cards (on-board interfaces are not supported).</p></td></tr><tr><td><p><strong>7000</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-C<span>*</span></li><li>CPAC-4-10F-C</li><li>CPAC-2-40F-C</li><li>CPAC-2-40/100F-C (<a href=\"https://support.checkpoint.com/results/sk/sk181064\" target=\"_blank\" rel=\"noopener\">sk139932</a>)</li></ul></td><td><p>Base and Plus models.</p><p>For CPAC-2-40/100F-C:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li></ul></td></tr><tr><td><p><strong>6900</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-C<span>*</span></li><li>CPAC-4-10F-C</li><li>CPAC-2-40F-C</li><li>CPAC-2-40/100F-C (<a href=\"https://support.checkpoint.com/results/sk/sk181064\" target=\"_blank\" rel=\"noopener\">sk181064</a>)</li></ul></td><td><p>Base and Plus models.</p><p>For CPAC-2-40/100F-C:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li></ul></td></tr><tr><td><p><strong>6800</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-C<span>*</span></li><li>CPAC-4-10F-6500/6800-C</li><li>CPAC-2-40F-C</li></ul></td><td><p>Base, Plus, and Turbo models.</p><p>For CPAC-4-10F-6500/6800-C:</p><ul><li>Output of the \"<code>lspci -v</code>\" command must show:<br><code>Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection</code></li></ul></td></tr><tr><td><p><strong>6700</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-C<span>*</span></li><li>CPAC-4-10F-C</li><li>CPAC-2-40F-C</li></ul></td><td><p>Base and Plus models.</p></td></tr><tr><td><p><strong>6600</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-C<span>*</span></li><li>CPAC-4-10F-C</li></ul></td><td><p>Base and Plus models.</p></td></tr><tr><td><p><strong>6500</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-C<span>*</span></li><li>CPAC-4-10F-6500/6800-C</li></ul></td><td><p>Base, Plus, and Turbo models.</p><p>For CPAC-4-10F-6500/6800-C:</p><ul><li>Output of the \"<code>lspci -v</code>\" command must show:<br><code>Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection</code></li></ul></td></tr><tr><td><p><strong>6400</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-C<span>*</span></li><li>CPAC-4-10F-C</li></ul></td><td><p>Base and Plus models.</p></td></tr><tr><td><p><strong>6200</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-C<span>*</span></li><li>CPAC-4-10F-C</li></ul></td><td><p>Base and Plus models.</p></td></tr><tr><td><p><strong>5900</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-B<span>*</span></li><li>CPAC-4-10F-B</li><li>CPAC-2-40F-B</li></ul></td><td><p>For CPAC-4-10F-B:</p><ul><li>Output of the \"<code>lspci -v</code>\" command must show:<br><code>Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection</code></li></ul><p>For CPAC-2-40F-B:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li><li>The minimum required card firmware version is 12.22.1002<br>To get the card firmware version, run this single long command in the Expert mode on the Security Appliance:<br><code>for NIC in $(ifconfig | grep ethsBP | awk '{print $1}') ; do echo $NIC: ; ethtool -i $NIC | grep firmware ; done</code></li></ul></td></tr><tr><td><p><strong>5800</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-B<span>*</span></li><li>CPAC-4-10F-B</li><li>CPAC-2-40F-B</li></ul></td><td><p>For CPAC-4-10F-B:</p><ul><li>Output of the \"<code>lspci -v</code>\" command must show:<br><code>Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection</code></li></ul><p>For CPAC-2-40F-B:</p><ul><li>You cannot use this Line Card with a splitter cable to split a port on a Security Appliance.</li><li>The minimum required card firmware version is 12.22.1002<br>To get the card firmware version, run this single long command in the Expert mode on the Security Appliance:<br><code>for NIC in $(ifconfig | grep ethsBP | awk '{print $1}') ; do echo $NIC: ; ethtool -i $NIC | grep firmware ; done</code></li></ul></td></tr><tr><td><p><strong>5600</strong></p></td><td><ul><li><a href=\"https://support.checkpoint.com/results/sk/sk181127\" target=\"_blank\" rel=\"noopener\">R82</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk177624\" target=\"_blank\" rel=\"noopener\">R81.20</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk173363\" target=\"_blank\" rel=\"noopener\">R81.10</a></li><li><a href=\"https://support.checkpoint.com/results/sk/sk169954\" target=\"_blank\" rel=\"noopener\">R81</a></li></ul></td><td><ul><li>CPAC-2-10F-B<span>*</span></li><li>CPAC-4-10F-B</li></ul></td><td><p>For CPAC-4-10F-B:</p><ul><li>Output of the \"<code>lspci -v</code>\" command must show:<br><code>Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection</code></li></ul></td></tr></tbody></table>","language":"md","time":"14 days ago","created":"2025-05-06T22:56:23.863Z","annotations":[],"updated":"2025-05-06T23:05:31.658Z"},{"title":"ProductMulti-Domain Security Management, Quantum Security Management","id":"ff44549c-51d7-4660-a403-b3fb0a969fd5","type":"TEXT","raw":"ProductMulti-Domain Security Management, Quantum Security Management\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-01-21\n\n## Solution\n\nThis article lists various logs files that contain the relevant information to troubleshoot Central Deployment of packages in SmartConsole (this feature is available from R80.40).\n\nEnter the string to filter this table:\n\n<table id=\"Unique_IDTable\"><tbody><tr><td>Component</td><td>Location of Log Files</td><td>Path to Log Files</td></tr><tr><td><p>SmartConsole</p></td><td><p>SmartConsole Client computer</p></td><td><ul><li><p><em>%LocalAppData%\\Check Point\\&lt;<strong>VERSION</strong>&gt;\\SmartConsole\\SmartConsole.log.*</em></p></li><li><p><em>C:\\Program Files (x86)\\CheckPoint\\SmartConsole\\&lt;<strong>VERSION</strong>&gt;\\Output\\</em></p></li></ul></td></tr><tr><td><p>Management Server</p></td><td><p>Management Server</p></td><td><ul><li><p><em>$FWDIR/log/cpm.elg</em></p></li><li><p><em>$FWDIR/log/api.elg</em></p></li><li><p><em>$FWDIR/cpextensions/log/cpextensions.elg</em></p></li></ul></td></tr><tr><td><p>Repository Manager</p></td><td><p>Management Server</p></td><td><ul><li><p><em>/opt/CPInstLog/RepManLog/RepositoryManager.log</em></p></li><li><p><em>/opt/CPInstLog/RepManLog/java_repository_manager.log</em></p></li></ul></td></tr><tr><td><p>Deployment Controller</p></td><td><p>Management Server</p></td><td><ul><li><p><em>$DEPCONDIR/state/&lt;<strong>Task-UID</strong>&gt;/request.json</em></p></li><li><p><em>$DEPCONDIR/state/&lt;<strong>Task-UID</strong>&gt;/progress.json</em></p></li><li><p><em>$DEPCONDIR/state/&lt;<strong>Task-UID</strong>&gt;/DeploymentController.log</em></p><p>(This is a symbolic link to <em>/opt/CPInstLog/DepConLog/DeploymentController_&lt;<strong>PID</strong>&gt;.log</em>)</p></li></ul><p>Note - To get the Task UID, run this command on the Management Server:<br><code>mgmt_cli -r true show tasks</code></p></td></tr><tr><td><p>Deployment Agent</p></td><td><p>Security Gateway / Cluster Member</p></td><td><ul><li><p><em>/opt/CPInstLog/DeploymentAgent.log</em></p></li></ul></td></tr></tbody></table>\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorKyle Warren\n\nTechnical ResourceMathieu Hachez\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2022-11-14\n\nLast Modified2025-01-21\n\nEditorKyle Warren\n\nLast ApproverStella Shteinbuk\n\n## Comments\n\n#### Internal only","language":"md","time":"14 days ago","created":"2025-05-06T22:56:21.604Z","annotations":[],"updated":"2025-05-06T23:00:07.875Z"},{"title":"Troubleshooting Security Gateway Probing Issues in HTTPS Inspection","id":"ccc41f8a-10a8-4659-9dc3-115d53fbe897","type":"TEXT","raw":"The Security Gateway was unable to perform the probe. This is usually because the TLS handshake was not successful. In most cases, this is either an issue of the server site not responding with the proper response or a connectivity issue from the Security Gateway to the server.\n\n**What is probing?**  \nProbing is a mechanism that the Firewall uses to collect more information on the connection before making a decision in the HTTPS Inspection policy.\n\nThe Firewall initiates a TLS connection with the destination server (TCP + TLS handshake).  \nIf this connection fails or not completed, the Firewall generates the error \"The probe was unable to establish a TCP connection\".\n\n**When probing is expected?**  \nIn case the https inspection Rule Base includes a Custom application site or Categories, the Firewall requires additional information before it can continue with the Rule Base matching.\n\nThe Security Gateway initiates the probe regardless of the action (bypass or inspect).\n\n**Example  \n**  \n![](https://sc1.checkpoint.com/sc/SolutionsStatics/NEW_SK_NOID1741696209506/probing202503111503131.png)\n\n1st rule: Traffic from any source to Webex Services (an updatable object) destination. No Category / Custom application site is selected. Action is Bypass  \n2nd rule: Traffic from a specific source IP address to a specific destination IP address. No Category / Custom application site is selected. Action is Inspect.  \n3rd rule: Traffic from a specific source IP address to the Internet (any external IP per topology). The Security Gateway must match the \"test\" custom application site as well. Action is Inspect.  \n4th rule: Traffic from any source IP address to the Internet. No Category / Custom application site is selected. Action is Bypass\n\nClient1 tries to reach `https://example.com`  \nRule 1 is not a possible match, because `example.com` is not a match for the destination column.  \nRule 2 is not a possible match, because `example.com` is not a match for the destination column.  \nRule 3 is a possible match, because the IP address of `example.com` is an external IP address and we match the source column (Client1).\n\nHowever, we still cannot guarantee that rule 3 is a match because we do not know if it matches the \"test\" Custom Application site.\n\nTo confirm that the destination matches the custom application site, the Security Gateway initiates a **probe**.\n\nBased on the result, the Security Gateway matches the connection to rule 3 or continues to the rest of the Rule Base.\n\n**Note - probing occurs once.**  \nIf there is another rule below rule 3 that matches the source and destination columns and includes a Custom Application Site / Category, the Security Gateway **will not** initiate another probe, because it already performed a probe.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:26.130Z","annotations":[],"updated":"2025-05-06T23:04:24.316Z"},{"title":"ProductIdentity Awareness, Quantum Maestro","id":"8cd0137b-4917-4455-8fa3-4634718dc395","type":"TEXT","raw":"ProductIdentity Awareness, Quantum Maestro\n\nVersionR81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-04-27\n\n## Solution\n\n**Table of Contents:**\n\n-   (1) Introduction\n    \n-   (2) Identity Sharing with Maestro Security Groups\n    \n-   (3) Identity Sources for Maestro Security Groups\n    \n-   (4) Integrating Maestro Security Groups with Cloud-based Identity Providers\n    \n-   (5) Identity Sharing between Maestro Security Groups that are managed by different Management Servers\n    \n-   (6) Documentation\n    \n\nClick Here to Collapse the Entire Article\n\nThis article provides best practices for designing an Identity Awareness architecture in the context of the Maestro security solution.\n\nThe explanations and diagrams in this article are focused on Maestro Security Groups running in the Gateway mode (non-VSX), but equally apply to the VSX mode.\n\n##   \n(1) Introduction\n\nShow / Hide this section\n\nThe main challenge with running Identity Awareness on Maestro Security Groups is to handle different identity updates related to the same user/machine that can be distributed between different Security Group Members.\n\nIdentity Awareness solution on a Maestro Security Group needs to ensure that all updates related to the same identity are handled by the same Security Group Member, which then synchronizes the Identity Awareness database to all other Security Group Members.\n\nThis article describes how this is achieved.\n\nStarting from R81.10 for Scalable Platforms, there is a new mechanism that forwards specific inbound connections to the SMO Security Group Member. With the \"`asg_excp_conf`\" command, you can configure the source, destination, and port of traffic that a Security Group must exclude from load balancing and distribute to all Security Group Members.\n\n-   For versions R82 and higher, refer to the [Scalable Platforms Administration Guide](https://support.checkpoint.com/product/520#f-commonsource=C.%20Documentation) for your version.\n-   For versions R80.20SP - R81.20, refer to the [Quantum Maestro Administration Guide](https://support.checkpoint.com/product/520#f-commonsource=C.%20Documentation) for your version.\n\nSyntax in the Expert mode on the Security Group:\n\n`asg_excp_conf clear`\n\n`asg_excp_conf del <ID>`\n\n`asg_excp_conf get`\n\n`asg_excp_conf set <Type> <Source IP Address> <Source Port> <Destination IP Address> <Destination Port>`\n\n**Notes:**\n\n-   This command supports only IPv4 connections.\n    \n-   This command does **not** support outgoing local connections that the Security Group initiates.\n    \n-   In the VSNext / Traditional VSX mode, you must run this command in the context of the applicable Virtual Gateway / Legacy Virtual System.\n    \n-   This command supports a maximum of 15 exceptions (in the Traditional VSX mode, this limit is global for all Traditional Virtual Systems).\n    \n-   These exceptions are saved in the `$FWDIR/tmp/tmp_exception_entries.txt` file (IPv4 addresses are converted to a special format).\n    \n-   Support for the new mechanism for forwarding specific inbound connections to the Maestro SMO Security Group Member is integrated in these versions (MBS-14560):\n    \n    -   R81.20 and higher\n    -   [R81.10 Jumbo Hotfix Accumulator](https://sc1.checkpoint.com/documents/Jumbo_HFA/R81.10/Default.htm) - Take 38 and higher\n    -   [R81 Jumbo Hotfix Accumulator](https://sc1.checkpoint.com/documents/Jumbo_HFA/R81/Default.htm) - Take 60 and higher\n    -   [R80.30SP Jumbo Hotfix Accumulator](https://support.checkpoint.com/results/sk/sk165312) - Take 101 and higher\n    -   [R80.20SP Jumbo Hotfix Accumulator](https://support.checkpoint.com/results/sk/sk155832) - Take 327 and higher\n-   The regular Maestro scaling mechanism does not apply when you forward specific incoming connections to the Maestro SMO Security Group Member.\n    \n    For additional information about Identity Awareness Scale Guidelines, refer to:\n    \n    -   [sk170765 - Identity Awareness Scalable Design - Identity Agent](https://support.checkpoint.com/results/sk/sk170765).\n    -   [sk179544 - Identity-Based Access Control and Threat Prevention - Design Guidelines - Identity Collector](https://support.checkpoint.com/results/sk/sk179544).\n\n**Terminology**\n\nThe reader should be familiar with basic concepts of identity-based Access Control and Threat Prevention. In particular, be familiar with the concepts of Identity Sharing and the Identity Broker (refer to the relevant sections in the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) for your version).\n\n-   **Identity Sources** are connected to the Identity Awareness instance PDP (Policy Decision Point).\n    \n    Refer to the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) for your version > Chapter \"Introduction to Identity Awareness\" > Section \"Identity Sources\".\n    \n-   **Identity Sharing** in its default \"Smart-Pull\" mode is based on TCP connections between PDP (Policy Decision Point) and PEP (Policy Enforcement Point) instances.\n    \n    The PDP connects to the PEP on the TCP port 15105.\n    \n    The PEP connects to the PDP on the TCP port 28581.\n    \n    Identity Sharing in the \"Push\" mode uses only the connection from the PDP to the PEP. All identities known on the PDP are shared with the PEP.\n    \n    These TCP connections are bound to the IP address configured for the Security Gateway object and require that both PDP and PEP instances be managed by the same Management Server.\n    \n    The network routing structure may require that a dedicated IP address is assigned to an interface of the Security Gateway that is used for these connections. For details, see [sk60701 - How to configure an alternate IP Address for Identity Awareness communication channel](https://support.checkpoint.com/results/sk/sk60701).\n    \n    Refer to the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) for your version > Chapter \"Identity Awareness Environment\" > Section \"Identity Sharing\".\n    \n-   The **Identity Broker** allows publishing of Identity Sessions to subscriber instances.\n    \n    The Identity Broker allows sharing of identities between Security Gateways that are managed by different Management Server.\n    \n    Refer to the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) for your version > Chapter \"Identity Awareness Environment\" > Section \"Identity Broker\".\n    \n\n##   \n(2) Identity Sharing with Maestro Security Groups\n\nShow / Hide this section\n\nThe technical concept described above, and the Maestro Security Group distribution modes support these TCP connections:\n\n-   from PDP to PEP on the TCP port 15105\n    \n-   from PEP to PDP on the TCP port 28581\n    \n\n**The traffic distribution prevents ID Sharing working as expected on Maestro Security Groups that run the versions R81 or lower.**\n\n**Starting from R81.10 and [R81 Jumbo Hotfix Accumulator](https://sc1.checkpoint.com/documents/Jumbo_HFA/R81/Default.htm) Take 42 (MBS-11293), the inbound Identity Sharing connections are forwarded to the SMO Security Group Member by default.**\n\nIn the diagram below, the incoming Identity Sharing connections marked as 1, 2, and 3 are forwarded to the SMO Security Group Member using the described mechanism.\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide4_202406121614534.png)\n\n##   \n(3) Identity Sources for Maestro Security Groups\n\nShow / Hide this section\n\nIdentity Awareness solution on a Maestro Security Group needs to ensure that all updates related to the same identity are handled by the same Security Group Member, which then synchronizes the Identity Awareness database to all other Security Group Members.\n\nThis section is focused on the identity acquisition part of the flow, elaborating the required configuration for different Identity Sources.\n\nFor information about Identity Sources, refer to:\n\n-   [Identity Awareness Clients Administration Guide](https://sc1.checkpoint.com/documents/Identity_Awareness_Clients_Admin_Guide/Default.htm)\n    \n-   Refer to the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) for your version > Chapter \"Introduction to Identity Awareness\" > Section \"Identity Sources\"\n    \n\nIdentity Sources:\n\n-   ### Browser-Based Authentication with Captive Portal\n    \n    > Refer to the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) for your version > Chapter \"Introduction to Identity Awareness\" > Section \"Identity Sources\" > Browser-Based Authentication.\n    > \n    > Maestro Security Groups do **not** support the Identity Awareness Captive Portal when the Layer 4 distribution is enabled (in [sk148074](https://support.checkpoint.com/results/sk/sk148074), see the Known Limitation MBS-14460) and refer to the [Quantum Maestro Administration Guide](https://support.checkpoint.com/product/520#f-commonsource=C.%20Documentation) for your version.\n    > \n    > These are the available options to overcome this limitation:\n    > \n    > -   Disable the L4 distribution mode – Browser-Based Authentication connections are distributed among Security Group Members based on source and destination IPs. Note that \"Automatic Logout\" feature is not supported in this case.\n    >     \n    > -   Because each Browser-Based authentication connection to the Maestro Security Group arrives from a different source IP address, we can configure the Security Group to forward all incoming traffic at the TCP port 443 to the SMO Security Group Member by running this command in the Expert mode on the Security Group:\n    >     \n    >     `asg_excp_conf set 9 0 0 <IP address of the Maestro Security Group> 443`\n    >     \n    >     **Note - This potentially can affect the performance of other connections that use this destination IP address and the destination port.**\n    >     \n    > -   Run the PDP instance on a dedicated Security Gateway that is not part of the Maestro Security Group and share the ID session on the PEP instance that runs on the Maestro Security Group (see the section \"(2) Identity Sharing with Maestro Security Groups\").\n    >     \n    \n-   ### Identity Agent for a User Endpoint computer / Identity Agent for a Terminal Server\n    \n    > Refer to:\n    > \n    > -   [Identity Awareness Clients Administration Guide](https://sc1.checkpoint.com/documents/Identity_Awareness_Clients_Admin_Guide/Content/Topics/Identity-Agent-for-Endpoint-Computer.htm) > Chapter \"Identity Agent for a User Endpoint Computer\"\n    >     \n    > -   [Identity Awareness Clients Administration Guide](https://sc1.checkpoint.com/documents/Identity_Awareness_Clients_Admin_Guide/Content/Topics/Identity-Agent-for-Terminal-Server.htm) > Chapter \"Identity Agent for a Terminal Server\"\n    >     \n    > -   [sk170765 - Identity Awareness Scalable Design - Identity Agent](https://support.checkpoint.com/results/sk/sk170765)\n    >     \n    > \n    > These are the available options if it is necessary to learn the identities from Identity Agents:\n    > \n    > -   Identity Agents are connected to the PDP (Policy Decision Point) instance that runs on a dedicated Identity Awareness Gateway that is not part of the Maestro Security Group.\n    >     \n    >     Identities are shared from the dedicated PDP Identity Awareness Gateway to the Maestro Security Group.\n    >     \n    >     Customers may decide to deploy the PDP instances using CloudGuard Network Security Gateways installed on hypervisor solutions (such as VMWare), or use Virtual Systems on a Check Point VSX Gateway. For redundancy purposes, we recommend deploying clustered Security Gateways.\n    >     \n    >     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide3_202406121614363.png)\n    >     \n    > -   Connect the Identity Agents to the Maestro Security Group and manually use the forward mechanism to forward all incoming traffic at the TCP port 443 to the SMO Security Group Member by running this command in the Expert mode on the Security Group:\n    >     \n    >     `asg_excp_conf set 9 0 0 <IP address of the Maestro Security Group> 443`\n    >     \n    >     Note - Because each Identity Agent connection arrives to a Maestro Security Group from a different source IP address, the only way to exclude these connections is by excluding all traffic to the Security Group on port 443. **This potentially can affect the performance of other connections that use this destination IP address and the destination port.**\n    >     \n    >     In the diagram below, the Identity Agent forwards the login to a dedicated PDP instance that runs on the SMO Security Group Member. The PDP runs group membership queries, creates the Identity Session, and shares the Identity Session with the PEP instance (for sharing the Identity with remote PEP instances, see the section \"(2) Identity Sharing with Maestro Security Groups\").\n    >     \n    >     ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide6_202406121615146.png)\n    >     \n    \n-   ### Identity Collector\n    \n    > Refer to:\n    > \n    > -   [Identity Awareness Clients Administration Guide](https://sc1.checkpoint.com/documents/Identity_Awareness_Clients_Admin_Guide/Content/Topics/Identity-Collector.htm) > Chapter \"Identity Collector\"\n    >     \n    > -   [sk179544 - Identity-Based Access Control and Threat Prevention - Design Guidelines - Identity Collector](https://support.checkpoint.com/results/sk/sk179544)\n    >     \n    > \n    > Starting from R81.10 and [R81 Jumbo Hotfix Accumulator](https://sc1.checkpoint.com/documents/Jumbo_HFA/R81/Default.htm) Take 42 (MBS-11293), when Identity Collector is enabled as an Identity Source in the Maestro Security Group object in SmartConsole, the incoming connections from the Identity Collector to the Maestro Security Group are forwarded to the SMO Security Group Member by default (no manual configuration is required).\n    > \n    > In the diagram below Identity Collector learns login events from the Active Directory. Identity Collector forwards these events to a dedicated PDP instance on the SMO Security Group Member. The PDP runs group membership queries, create the Identity Session, and shares the Identity Session with the PEP instance (for sharing the Identity Session with remote PEP instances, see the section \"(2) Identity Sharing with Maestro Security Groups\").\n    > \n    > ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide5_202406121615035.png)\n    \n-   ### RADIUS Accounting\n    \n    > Refer to the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) for your version > Chapter \"Introduction to Identity Awareness\" > Section \"Identity Sources\" > RADIUS Accounting.\n    > \n    > Forwarded the connection from the RADIUS Accounting clients to the Maestro Security Group to the SMO Security Group Member by running this command in the Expert mode on the Security Group:\n    > \n    > `asg_excp_conf set 12 <IP address of the Authorized RADIUS Accounting client> 0 <IP address of the Maestro Security Group> <RADIUS server port (default = 1813)>`\n    \n-   ### Identity Web API\n    \n    > Refer to the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) for your version > Chapter \"Introduction to Identity Awareness\" > Section \"Identity Sources\" > Identity Web API.\n    > \n    > Forward the connection from the Web API clients to the Maestro Security Group to the SMO Security Group Member by running this command in the Expert mode on the Security Group:\n    > \n    > `asg_excp_conf set 12 <IP address of the Authorized Web API client> 0 <IP address of the Maestro Security Group> 443`\n    \n-   ### Remote Access VPN Agents\n    \n    > Refer to the [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation) for your version > Chapter \"Introduction to Identity Awareness\" > Section \"Identity Sources\" > Remote Access.\n    > \n    > If Remote Access VPN agent is the only Identity Source configured, its connections are distributed between the different Security Group Members of the Security Group (no manual configuration is required).\n    > \n    > If other Identity Sources are also configured, then forward the connection from the Remote Access VPN clients to the Maestro Security Group to the SMO Security Group Member by running this command in the Expert mode on the Security Group:\n    > \n    > `asg_excp_conf set 9 0 0 <IP address of the Maestro Security Group> 4500`\n    > \n    > When Remote Access VPN clients work in Visitor Mode, each connection from a Remote Access VPN client to the Maestro Security Group arrives from a different source IP address. The only way to exclude these connections is by excluding all traffic that arrives at the Security Group at the TCP port 443 by running this command in the Expert mode on the Security Group:\n    > \n    > `asg_excp_conf set 9 0 0 <IP address of the Maestro Security Group> 443`\n    > \n    > **Note - This potentially can affect the performance of other connections that use this destination IP address and the destination port.**\n    > \n    > The diagram below demonstrates a scenario where Remote Access VPN agents are the only identity source that connects to a Security Group. This identity source authenticates the user/machine using certificates. The ID session related to the Office Mode IP address is propagated to these PEP instances:\n    > \n    > -   Local PEP\n    > -   Remote PEP that runs on a different Security Group on the same Site (Security Group 1.2)\n    > -   Remote PEP that runs on a Security Group on a remote Site (Security Group 2.1)\n    > -   Remote PEP that runs on a Cluster that is not part of the Maestro Security Group (HA Cluster)\n    > \n    > ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide1_202406121614111.png)\n    \n\n##   \n(4) Integrating Maestro Security Groups with Cloud-based Identity Providers\n\nShow / Hide this section\n\nMaestro Security Groups support Browser-Based Authentication (Identity Awareness Captive Portal) for authenticating with Cloud-hosted Identity Providers, such as Microsoft Azure Active Directory only in the versions R81.20 and higher (in [sk148074](https://support.checkpoint.com/results/sk/sk148074), see the Known Limitations MBS-14238 and IDA-2339).\n\nThese are the available options to overcome these limitations in the versions R81.10 and lower:\n\n-   Run the PDP instance on a dedicated Security Gateway R81.10 (or higher) that is not part of the Maestro Security Group.\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide2_202406121614232.png)\n    \n-   Configure the Maestro Security Group to forward all incoming traffic at the TCP port 443 to the SMO Security Group Member by running this command in the Expert mode on the Security Group:\n    \n    `asg_excp_conf set 9 0 0 <IP address of the Maestro Security Group> 443`\n    \n    **Note - This potentially can affect the performance of other connections that use this destination IP address and the destination port.**\n    \n    ![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide7_202406121615297.png)\n    \n\n##   \n(5) Identity Sharing between Maestro Security Groups that are managed by different Management Servers\n\nShow / Hide this section\n\nIdentity Sharing from PDP to PEP is based on a SIC certificate. Therefore, Identity Sharing works between Security Gateways managed by the same Security Management Server / Domain Management Server.\n\nThe concept of **Identity Broker** solves the challenge of sharing Identity Sessions between Security Gateways managed by different Management Servers.\n\n-   ### Connections from Identity Broker Publishers to the Identity Broker Subscriber on a Maestro Security Group\n    \n    > Identity Awareness solution on a Maestro Security Group needs to ensure that all updates related to the same identity are handled by the same Security Group Member, which then synchronizes the Identity Awareness database to all other Security Group Members.\n    > \n    > Forward the connection from Identity Broker Publishers to the Identity Broker Subscriber on a Maestro Security Group to the SMO Security Group Member by running this command in the Expert mode on the Security Group:\n    > \n    > `asg_excp_conf set 12 <IP address of the Identity Broker Publisher> 0 <IP address of the Maestro Security Group> 433`\n    \n-   ### Connections from Identity Broker Publisher on a Maestro Security Group to its Identity Broker Subscribers\n    \n    > The connection from an Identity Broker Publisher on a Maestro Security Group to its Identity Broker Subscribers is opened from the SMO Security Group Member.\n    > \n    > If the identity acquisition is done on a non-SMO Security Group Member, then the identity cannot be propagated to the relevant Identity Broker Subscribers.\n    > \n    > Therefore, you must follow the above guidelines to ensure the identity sessions are only learned by the SMO Security Group Member.\n    \n\n##   \n(6) Documentation\n\nShow / Hide this section\n\n-   [Quantum Maestro Administration Guide](https://support.checkpoint.com/product/520#f-commonsource=C.%20Documentation)\n    \n-   [Identity Awareness Administration Guide](https://support.checkpoint.com/product/436#f-commonsource=C.%20Documentation)\n    \n-   [Identity Awareness Clients Administration Guide](https://sc1.checkpoint.com/documents/Identity_Awareness_Clients_Admin_Guide/Default.htm)\n    \n-   [VSX Administration Guide](https://support.checkpoint.com/product/359#f-commonsource=C.%20Documentation)\n    \n-   [Security Management Administration Guide](https://support.checkpoint.com/product/184#f-commonsource=C.%20Documentation)\n    \n-   [Multi-Domain Security Management Administration Guide](https://support.checkpoint.com/product/166#f-commonsource=C.%20Documentation)\n    \n-   [sk170765 - Identity Awareness Scalable Design - Identity Agent](https://support.checkpoint.com/results/sk/sk170765)\n    \n-   [sk179544 - Identity-Based Access Control and Threat Prevention - Design Guidelines - Identity Collector](https://support.checkpoint.com/results/sk/sk179544)\n    \n-   [sk60701 - How to configure an alternate IP Address for Identity Awareness communication channel](https://support.checkpoint.com/results/sk/sk60701)\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorPeter Elmer\n\nTechnical ResourceNetanel Cohen\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2021-09-29\n\nLast Modified2025-04-27\n\nEditorPeter Elmer\n\nLast ApproverRobert Henderson\n\n## Comments\n\n#### Internal only\n\n**SK SHOULD NOT BE DELETED - referenced in Maestro Admin Guides**\n\n___\n\n**The Knowledge Management Group locked this article because of a complex HTML code.  \nIf a change is required, then make sure you are logged in to Support Center and submit your feedback at the bottom of this article.**\n\n___\n\nThe content of this SK was developed in a close dialog with Maestro R&D (Dror Farkash), Identity Awareness R&D (Netanel Cohen), and QA (Haya Amrani).\n\n___\n\nThis SK applies to R82.10 as well\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide1_202406121614111.png)\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide2_202406121614232.png)\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide3_202406121614363.png)\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide4_202406121614534.png)\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide5_202406121615035.png)\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide6_202406121615146.png)\n\n![](https://sc1.checkpoint.com/sc/SolutionsStatics/sk175587/Slide7_202406121615297.png)","language":"md","time":"14 days ago","created":"2025-05-06T22:56:21.761Z","annotations":[],"updated":"2025-05-06T23:05:22.083Z"},{"title":"ProductQuantum Security Gateways","id":"95a8f1cb-9d53-4665-bba0-d7379df9946e","type":"TEXT","raw":"ProductQuantum Security Gateways\n\nVersionR81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nPlatformThreat Emulation\n\nLast Modified2024-10-27\n\n## Solution\n\nTo calculate file emulation duration using the `ted.elg` file, do these steps:\n\n1.   Go to the `$FWDIR/log/` directory and find the `ted.elg` file.\n2.  Make sure the default debug flags are on before you start tracking. This lets you monitor files correctly. To check the debug status, enter:\n    \n    `[Expert@Example-VSX:1]# tecli debug stat`\n    \n    `Current debug status is: ON`  \n    `The following topics are currently set:`  \n    `topic severity`  \n    `=====================`  \n    `+ TE surprise`  \n    `+ TE_IS_TRACE all`  \n    `+ TE_SM surprise`  \n    `+ TE_TRACE  important`\n    \n    If the default debug flags are not on, enable them:\n    \n    `[Expert@Example-VSX:1]# tecli debug defaults`  \n    `Debugging topics have been reset to defaults and turned on`\n    \n    `[Expert@Example-VSX:1]# tecli debug stat`  \n    `Current debug status is: ON`  \n    `The following topics are currently set:`  \n    `topic severity`  \n    `=====================`  \n    `+ TE surprise`  \n    `+ TE_IS_TRACE all`  \n    `+ TE_SM surprise`  \n    `+ TE_TRACE  important`\n    \n3.  To calculate duration, find the start time in the log. Look for the `Handling new file` line with the `TE_TRACE ID`.\n    \n     Example:\n    \n    `[10 Aug 14:28:20] [TE_TRACE]: {ABC12378-2290-ABV4A-B6BE-12345678} Handling new file \"test123.pdf\", Path: /opt/CPsuite-R81.20/fw1/CTX/CTX00001/tmp/te/dlpu_tmp_files_4-5/{}, rule_number = 7, rule name = TE , investigation_path = PATH_TE`\n    \n    In this example, the `TE_TRACE ID` is `ABC12378-2290-ABV4A-B6BE-12345678`. This log provides details about the file's introduction to the emulation process.\n    \n4.  Find the end time in the log. Look for the `Done with file` line with the same `TE_TRACE ID`.\n    \n    Example:\n    \n    `[10 Aug 14:29:33] [TE_TRACE]: {ABC12378-2290-ABV4A-B6BE-12345678} Done with file; Reporting back action: accept; Confidence: 0; InvestigationPath: PATH_TE`\n    \n    The `Done with file` part of the log shows the final time of the file's journey.\n    \n5.  Calculate the time that passed from the `Handling new file` log to the `Done with file` log. This is the emulation duration. In our example, it took 73 seconds.\n\n**Important Notes:**\n\n-   `ted.elg` rotation files may contain data from the last few days or just the last few hours, depending on network activity.\n    \n-   You cannot track past activities by enabling debug flags after these activities took place.\n    \n-   A Request for Enhancement (RFE) is in progress to improve the emulation duration feature. Contact your local office for updates.\n    \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorEden Bobovnik\n\nTechnical ResourceYehezkel Horowitz\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2023-08-11\n\nLast Modified2024-10-27\n\nEditorEden Bobovnik\n\nLast ApproverNatalia Zhdanova\n\n## Comments\n\n#### Internal only\n\nThere are ways to make custom scripts and other custom automation ways to utilize the above information to monitor specific file's emulation time with 3rd party tools. \n\nThere is currently no dedicated feature for tracking specific file emulation times, but users can utilize the existing log files (such as `ted.elg`) to monitor this information.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:24.013Z","annotations":[],"updated":"2025-05-06T23:03:04.936Z"},{"title":"Upgrade and Remove Notification from SGMs","id":"b672a285-7fbf-4d3e-8956-db5cfdfb6a7b","type":"TEXT","raw":"From: Julia Peneva <jpeneva@checkpoint.com>   \nSent: Friday, 24 May 2024 19:13  \nTo: Ramanpreet Mann <ramann@checkpoint.com>; Raed Iskandar <riskanda@checkpoint.com>; Sergei Shir <sergeis@checkpoint.com>  \nCc: Josh Lavergne <jlavergn@checkpoint.com>  \nSubject: Re: sk182078\n\nThe reason for the warning has to do with the log files mentioned in the SK:  \n/var/log/sp\\_upgrade.log  \n$FWDIR/log/blades\\_config.elg  \n/var/log/messages\n\nIf those three do not continue to show any update for 5 minutes at least, then it is safe to do the procedure, since it means the upgrade process has deemed that it has \"finished\".  \nIf you do the procedure too early (ie. those files start updating and showing that the process is still ongoing), then it will disrupt the upgrade.  \nIf nothing has happened for 5-10 minutes, then you are free to start the procedure, since it means the upgrade is complete, just not cleaned up properly.\n\n___\n\n**This procedure is placed in the Internal Section because it has the potential to disrupt the upgrade process, if the symptoms are not properly read and followed.**\n\nIf it is running the correct install, then these are your next steps:\n\n(1) Connect to the command line on the Security Group\n\n(2) Log in to the Expert mode\n\n(3) Make sure the upgrade script completed its tasks:\n\n**sp\\_upgrade --cleanup**\n\nOutput should show \"success\"\n\n(4) Unregister the problematic Pnote \"downgrade\":\n\n**cphaconf set\\_pnote -d downgrade unregister**\n\n(5) Remove the notification from all SGMs, so that is survives a reboot:\n\n**g\\_rm \"/etc/.scalable\\_platform\\_during\\_inplace\\_downgrade\"**  \n\nMake sure the file was removed:\n\n**g\\_all -a ls -la /etc/.scalable\\_platform\\_during\\_inplace\\_downgrade**\n\n(6) Reboot all SGMs\n\n___\n\n**If the file \"/etc/.scalable\\_platform\\_during\\_inplace\\_downgrade\" returns after a reboot despite the above steps being followed, then open an investigation task with CFG !!!**\n\nAs a temporary workaround:\n\n(1) On every Security Group Member on each Site, unregister the Pnote \"downgrade\" permanently to ensure that the Security Group Members can quickly rejoin after a reboot:\n\n**cphaconf set\\_pnote -d downgrade unregister -p**\n\n[https://sc1.checkpoint.com/documents/R81.20/WebAdminGuides/EN/CP\\_R81.20\\_CLI\\_ReferenceGuide/Content/Topics-CLIG/CXLG/Unregistering-Critical-Device.htm](https://sc1.checkpoint.com/documents/R81.20/WebAdminGuides/EN/CP_R81.20_CLI_ReferenceGuide/Content/Topics-CLIG/CXLG/Unregistering-Critical-Device.htm)\n\n(2) Before a future upgrade, on every Security Group Member on each Site, register the Pnote \"downgrade\":\n\n**cphaconf set\\_pnote -d downgrade register**","language":"md","time":"14 days ago","created":"2025-05-06T22:56:26.269Z","annotations":[],"updated":"2025-05-06T23:04:29.823Z"},{"title":"Zero Phishing in User Space","id":"b8ec143e-beb6-4bc2-978a-3a43a1fa3614","type":"TEXT","raw":"ProductZero Phishing\n\nVersionR81.20, R82\n\nOSGaia\n\nLast Modified2025-04-14\n\n## Solution\n\n**Table of Contents:**\n\n-   Zero Phishing Workflow\n    \n-   Zero Phishing in User Space\n    \n-   Zero Phishing Debug Procedure\n    \n-   Zero Phishing Cache Operations\n    \n-   Automatic Configuration of Zero Phishing\n    \n-   Related Solutions\n    \n\n###   \nZero Phishing Workflow\n\nThere are two major engines in Zero Phishing - **Phishing Prevention** and **In-Browser Phishing Prevention**:\n\n###   \nZero Phishing in User Space\n\n<table><tbody><tr><td>Daemon</td><td>Section</td><td>Description</td></tr><tr><td rowspan=\"6\"><p><em><strong>zphd</strong></em></p></td><td><p>Description</p></td><td><p>Main Zero Phishing daemon on the Security Gateway:</p><ol><li>Gets answers from the Check Point cloud</li><li>Determines the final counter-action taken when encountering a phishing site based on the Security Policy</li><li>Sends logs</li></ol></td></tr><tr><td><p>Path</p></td><td><p><em>$FWDIR/bin/zphd</em></p></td></tr><tr><td><p>Log file</p></td><td><p><em>$FWDIR/log/zphd.elg</em></p></td></tr><tr><td><p>To Stop</p></td><td><p><em>cpstop</em></p></td></tr><tr><td><p>To Start</p></td><td><p><em>cpstart</em></p></td></tr><tr><td><p>Debug</p></td><td><ol><li><p>Start the ZPHD debug:</p><p><em>zph debug on</em></p><p><em>zph debug set all all</em></p></li><li><p>Make sure the ZPHD debug is enabled:</p><p><em>zph debug stat</em></p></li><li><p>Replicate the issue.</p></li><li><p>Stop the ZPHD debug:</p><p><em>zph debug off</em></p><p><em>zph debug reset</em></p></li><li><p>Make sure the ZPHD debug is disabled:</p><p><em>zph debug stat</em></p></li><li><p>Analyze:</p><p><em>$FWDIR/log/zphd.elg*</em></p></li></ol></td></tr><tr><td rowspan=\"6\"><p><em><strong>usercheckportal_php</strong></em></p></td><td><p>Description</p></td><td><p>UserCheck Web Portal</p></td></tr><tr><td><p>Log file</p></td><td><em>/opt/CPUserCheckPortal/log/zph</em></td></tr><tr><td><p>Configuration files</p></td><td><p><em>/opt/CPUserCheckPortal/phpincs/conf/proxy.ini</em></p><p><em>/opt/CPUserCheckPortal/conf/httpd.conf</em></p><p><em>/opt/CPUserCheckPortal/phpincs/conf/L10N/portal_en.php</em></p></td></tr><tr><td><p>To Stop</p></td><td><p><em>cpstop</em></p></td></tr><tr><td><p>To Start</p></td><td><p><em>cpstart</em></p></td></tr><tr><td><p>Debug</p></td><td><ol><li><p>Start the UserCheck Web Portal debug:</p><ol><li><p>Run:</p><p><em>/opt/CPUserCheckPortal/scripts/logs_conf_server</em></p></li><li><p>Select option \"1\"</p></li></ol></li><li><p>Replicate the issue.</p></li><li><p>Stop the UserCheck Web Portal debug:</p><ol><li>Run:<br><em>/opt/CPUserCheckPortal/scripts/logs_conf_server</em></li><li><p>Select option \"2\"</p></li></ol></li><li><p>Analyze:</p><p><em>/opt/CPUserCheckPortal/log/PortalLog.log</em></p></li></ol></td></tr></tbody></table>\n\n###   \nZero Phishing Debug Procedure\n\n1.  Connect to the command line on the Security Gateway / each Cluster Member.\n    \n2.  Log in to the Expert mode.\n    \n3.  Add a mark to the log files:\n    \n    _\\[Expert@HostName:0\\]# echo \"==debug\\_start==\" >> $FWDIR/log/zphd.elg_\n4.  Set the ZPHD debug options:\n    \n    _\\[Expert@HostName:0\\]# zph debug set all all_\n5.  Enable the debug of the ZPHD process:\n    \n    _\\[Expert@HostName:0\\]# zph debug on_\n6.  Check the debug status of the ZPHD process:\n    \n    _\\[Expert@HostName:0\\]# zph debug stat_\n7.  Replicate the issue.\n    \n    Make sure the issue was replicated - save all the applicable outputs, take all the applicable screenshots.\n8.  Disable the debug of the ZPHD process:\n    \n    _\\[Expert@HostName:0\\]# zph debug off_\n9.  Reset the ZPHD debug options to their defaults:\n    \n    _\\[Expert@HostName:0\\]# zph debug reset_\n10.  Check the debug status of the ZPHD process:\n    \n    _\\[Expert@HostName:0\\]# zph debug stat_\n11.  Add a mark to the log files:\n    \n    _\\[Expert@HostName:0\\]# echo \"==debug\\_stop==\" >> $FWDIR/log/zphd.elg_\n12.  Collect these files from the Security Gateway / each Cluster Member:\n    \n    -   _$FWDIR/log/zphd.elg\\*_\n    -   _/opt/CPUserCheckPortal/log/zph/\\*_\n    -   All the applicable outputs\n    -   All the applicable screenshots\n\n###   \nZero Phishing Cache Operations\n\n<table><tbody><tr><td>Action</td><td>Instructions</td></tr><tr><td>Reset the cache</td><td><ol><li><p>Disable the cache:</p><p><em>fw ctl set int nemo_app_cache_enable 0</em></p></li><li><p>Enable the cache:</p><p><em>fw ctl set int nemo_app_cache_enable 1</em></p></li></ol></td></tr><tr><td>Print the contents of the benign table</td><td><p><em>fw ctl set int nemo_app_benign_table_print 1</em></p></td></tr><tr><td>Delete the contents of the benign table</td><td><p><em>fw ctl set int nemo_app_cache_delete_benign_table 1</em></p></td></tr><tr><td>Print the contents of the phishing table</td><td><p><em>fw ctl set int nemo_app_phishing_table_print 1</em></p></td></tr><tr><td>Delete the contents of the phishing table</td><td><p><em>fw ctl set int nemo_app_cache_delete_phishing_table 1</em></p></td></tr></tbody></table>\n\n###   \nAutomatic Configuration of Zero Phishing\n\nFor automatic configuration of Zero Phishing, see the [R82 Threat Prevention Administration Guide](https://sc1.checkpoint.com/documents/R82/WebAdminGuides/EN/CP_R82_ThreatPrevention_AdminGuide/Default.htm#cshid=ID002).\n\n-   [sk177023 - Warning or Error message appears for Zero Phishing blade in Device & Information panel in SmartConsole](https://support.checkpoint.com/results/sk/sk177023)\n-   [sk177764 - Define fail mode for Unclassified sites in Inbrowser solution](https://support.checkpoint.com/results/sk/sk177764)\n-   [sk179726 - Zero Phishing Bypass list](https://support.checkpoint.com/results/sk/sk179726)\n-   [sk178769 - Zero Phishing In-Browser protection is not working for HTTP sites](https://support.checkpoint.com/results/sk/sk178769)\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorTzach Cohen\n\nTechnical ResourceYair Danieli\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2022-02-23\n\nLast Modified2025-04-14\n\nEditorTzach Cohen\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only\n\nThis SK applies to R82.10 as well","language":"md","time":"14 days ago","created":"2025-05-06T22:56:21.950Z","annotations":[],"updated":"2025-05-06T23:04:41.060Z"},{"title":"ProductQuantum Maestro, Quantum Smart-1 Cloud Support","id":"f0574833-a4d5-4db9-9a41-8736caa3c156","type":"TEXT","raw":"ProductQuantum Maestro, Quantum Smart-1 Cloud\n\nVersionR81.10, R81.20\n\nOSGaia\n\nLast Modified2024-04-16\n\n## Solution\n\nThis article describes Smart-1 Cloud support for Maestro Security Groups.\n\n**Notes:**\n\n-   This procedure supports only Maestro Security Groups that run the versions R81.10 and higher.\n    \n\n###   \nLimitations\n\n-   Smart-1 Cloud does not support Maestro Security Groups in the VSX mode.\n    \n-   Smart-1 Cloud does not support Maestro Security Groups with a dynamically assigned IP address (DAIP).\n    \n\n###   \nPrerequisites for Maestro Security Groups\n\n> **Prerequisites for R81.20  \n> **The following content will be included in a near future JHF , in the meantime – follow these instructions:\n> \n> Show / Hide this section\n> \n> 1.  Install this package on the Security Group:\n>     \n>     [R81.20 Jumbo Hotfix Accumulator](https://sc1.checkpoint.com/documents/Jumbo_HFA/R81.20/Default.htm) Take **43 and above**.\n>     \n>     Follow the installation instructions in [R81.20 Maestro Administration Guide](https://sc1.checkpoint.com/documents/R81.20/WebAdminGuides/EN/CP_R81.20_Maestro_AdminGuide/Default.htm) > chapter \"_Installing and Uninstalling a Hotfix_\" > section \"_Installing and Uninstalling a Hotfix on Security Group Members_\".\n>     \n> 2.  Install this package on the Security Group:\n>     \n>     [Check\\_Point\\_R80\\_40\\_maas\\_tunnel\\_AutoUpdate\\_Bundle\\_T59\\_AutoUpdate.tar](https://support.checkpoint.com/results/download/129881)\n>     \n>     Follow the installation instructions in [sk166056 - Smart-1 Cloud Release Updates](https://support.checkpoint.com/results/sk/sk166056).\n>     \n> 3.  Make sure the Security Group's software level supports the connection to Smart-1 Cloud:\n>     \n>     1.  Connect to the command line on the the Security Group.\n>         \n>     2.  Run this command:\n>         \n>         -   In the Expert mode :\n>             \n>             `g_maas status`\n>             \n>         \n>         If the output shows \"_g\\_maas: command not found_\" or \"_maas: unrecognized option_\", then [contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/) for assistance.\n>         \n>         For faster resolution, collect the [CPinfo](https://support.checkpoint.com/results/sk/sk92739) file from the Security Group.\n>         \n> \n> **Prerequisites for R81.10** The following content will be included in a near future JHF , in the meantime – follow these instructions:\n> \n> Show / Hide this section\n> \n> 1.  Install this package on the Security Group:\n>     \n>     [R81.10 Jumbo Hotfix Accumulator](https://sc1.checkpoint.com/documents/Jumbo_HFA/R81.10/Default.htm) **Take 131 and above.**\n>     \n>     Follow the installation instructions in [R81.10 Maestro Administration Guide](https://sc1.checkpoint.com/documents/R81.10/WebAdminGuides/EN/CP_R81.10_Maestro_AdminGuide/Default.htm) > chapter \"_Installing and Uninstalling a Hotfix_\" > section \"_Installing and Uninstalling a Hotfix on Security Group Members_\".\n>     \n> 2.  Install this package on the Security Group:\n>     \n>     [Check\\_Point\\_R80\\_40\\_maas\\_tunnel\\_AutoUpdate\\_Bundle\\_T59\\_AutoUpdate.tar](https://support.checkpoint.com/results/download/129881)\n>     \n>     Follow the installation instructions in [sk166056 - Smart-1 Cloud Release Updates](https://support.checkpoint.com/results/sk/sk166056).\n>     \n> 3.  Make sure the Security Group's software level supports the connection to Smart-1 Cloud:\n>     \n>     1.  Connect to the command line on the the Security Group.\n>         \n>     2.  Run this command:\n>         \n>         -   In the Expert mode :\n>             \n>             `g_maas status`\n>             \n>         \n>         If the output shows \"_g\\_maas: command not found_\" or \"_maas: unrecognized option_\", then [contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/) for assistance.\n>         \n>         For faster resolution, collect the [CPinfo](https://support.checkpoint.com/results/sk/sk92739) file from the Security Group.\n>         \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorDmitrie Shaiman\n\nTechnical ResourceSarel Foyerlicht\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2023-09-19\n\nLast Modified2024-04-16\n\nEditorGil Frantsus\n\nLast ApproverDmitrie Shaiman\n\n## Comments\n\n#### Internal only\n\n**SK SHOULD NOT BE DELETED - referenced in Smart-1 Cloud**","language":"md","time":"14 days ago","created":"2025-05-06T22:56:24.171Z","annotations":[],"updated":"2025-05-06T23:05:31.525Z"},{"title":"Troubleshooting Cisco ISE Integration Issues with Check Point Identity Awareness","id":"2faac49a-f0bc-488a-9e19-2afc480c32d0","type":"TEXT","raw":"ProductIdentity Awareness\n\nVersionR81.10, R81.20, R82\n\nLast Modified2025-02-04\n\n#### For internal users only\n\n## Symptoms\n\n-   Cisco Identity Services Engine (ISE) users cannot access resources located behind an Identity Awareeness Gateway.\n-   The Identity Awareness Gateway does not match the Cisco ISE users to access control rules defined with identity tags.\n-   On the Identity Awareness Policy Decision Point (PDP) Security Gateway, the parameter `pdp idc groups_consolidation status` is disabled.\n\n## Cause\n\nWhen the `# pdp idc groups_consolidation status` parameter is disabled, the expected behavior is for the Security Gateway to create the $_FWDIR/conf/pdp\\_overriding\\_attrs.C_ file and **not** to fetch Active Directory (AD) groups for the Cisco ISE Users. However, the Security Gateway does not create the file and it does try to fetch the AD groups. The AD lookup fails, and as a result the Security Gateway does not match the Cisco ISE users to rules.\n\n## Solution\n\n###   \nScenario 1: If you do **not** want to fetch AD groups for the Cisco ISE users\n\nManually create the _$FWDIR/conf/pdp\\_overriding\\_attrs.C_ file on the Security Gateway. After you create the file, the Security Gateway does not try to fetch AD groups for the Cisco ISE users. This resolves the issue.\n\n**Solution for a Policy Decision Point (PDP) Security Gateway/Cluster**\n\n1.  In the CLI, enter the Expert Mode.\n2.  Run:  \n    `# pdp idc groups_consolidation disable`\n3.  Run:  \n    `# fw kill pdpd`\n\n**Solution for a Policy Decision Point (PDP) Maestro**\n\n1.  In the CLI, enter the Expert Mode.\n2.  Run:  \n    `# g_all pdp idc groups_consolidation disable` \n3.  Run:  \n    `# g_fw kill pdpd`\n\n###   \nScenario 2: If you want to fetch AD groups for the Cisco ISE users:\n\nEnable the `# pdp idc groups_consolidation status` parameter. Then, investigate why the Security Gateway fails to fetch AD groups for the Cisco ISE users.\n\n**Procedure for a Policy Decision Point (PDP) Security Gateway/Cluster  \n**\n\n1.  In the CLI, enter the Expert Mode.\n2.  Run:  \n    `# pdp idc groups_consolidation enable`\n3.  Investigate the issue. There may be an issue on the AD Server, on the Security Gateway, or in the connection between them.\n\n  \n**Procedure for a Policy Decision Point Maestro Gateway  \n**\n\n1.  In the CLI, enter the Expert Mode.\n2.  Run:  \n    `# g_all pdp idc groups_consolidation enable`\n3.  Investigate the issue. There may be an issue on the AD Server, on the Maestro Gateway, or in the connection between them.\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorMotty Kleiner\n\nTechnical ResourcePini Kenig\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2025-02-02\n\nLast Modified2025-02-04\n\nEditorMotty Kleiner\n\nLast ApproverRyan Puckett","language":"md","time":"14 days ago","created":"2025-05-06T22:56:26.429Z","annotations":[],"updated":"2025-05-06T23:03:55.579Z"},{"title":"ProductOther Version R81","id":"1025f81f-1fff-4de8-b477-168768f1a5c9","type":"TEXT","raw":"ProductOther\n\nVersionR81 (EOS), R81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-04-28\n\n## Solution\n\n**Introduction | Manual Installation | Availability | List of Resolved Issues | Revision History** \n\n##   \nIntroduction\n\nThe OpenTelemetry Agent is a new method to generate and report metrics on Check Point devices, as part of the Skyline OpenTelemetry flow, additional to CPView.  \nFor more information, see [sk178566](https://support.checkpoint.com/results/sk/sk178566).\n\n##   \nManual Installation (Offline)\n\nThe OpenTelemetry Agent is installed automatically on all relevant Check Point devices, if you allowed the Automatic Update downloads as described in [sk94508](https://support.checkpoint.com/results/sk/sk94508).\n\nIf you do not allow Automatic Updates, you can install the OpenTelemetry Agent manually as described below.\n\n### Prerequisites:\n\nInstall the latest Take of [AutoUpdater](https://support.checkpoint.com/results/sk/sk165653).\n\n### Instructions:\n\n1.  Download the offline package to your computer. See the \"Availability\" section.\n    \n2.  Copy the offline package from your computer to your Check Point device to some directory (for example, _/var/log/_).\n    \n3.  Connect to the command line on your Check Point device.\n    \n4.  Log in to the Expert mode.\n    \n5.  Go to the directory with the offline package.\n    \n6.  Install the offline package:\n    \n    -   On a Security Gateway / each Cluster Member / Management Server / Log Server:\n        \n        `autoupdatercli install <Name of Offline Package>.tar`\n        \n    -   On a Scalable Platform Security Group (Maestro / Chassis):\n        \n        `g_all autoupdatercli install <Name of Offline Package>.tar`\n        \n\n**Note**: The installation does not require **`cpstop; cpstart`** or a reboot. Once installed, no further action is required, the update will be applied immediately.\n\n##   \nAvailability\n\n> <table><tbody><tr data-darkreader-inline-bgcolor=\"\"><td>Update #</td><td>Release Date</td><td>Download Package</td></tr><tr><td>Take 97</td><td>27 Apr 2025</td><td><a href=\"https://support.checkpoint.com/results/download/137304\" target=\"_blank\" rel=\"noopener\"><img src=\"https://sc1.checkpoint.com/sc/images/download-m.png\" alt=\"\"></a> (TAR)</td></tr></tbody></table>\n> \n> To see the current installed Take, run this command in the Expert mode:\n> \n> `cpinfo -y all 2>/dev/null | grep CPOTLPAGENT_AUTOUPDATE`\n\n##   \nTroubleshooting\n\nThe OpenTelemetry Agent log file is `/opt/CPOtlpAgent/otlp_agent.log`\n\nTo simulate the export of the metrics:\n\n1.  Enable the debug mode:\n    \n    `/opt/CPotelcol/sklnctl export --debug /<path_to>/<output_file>.json`\n    \n    Example:\n    \n    `/opt/CPotelcol/sklnctl export --debug /var/log/otlp_export_debug.json`\n    \n2.  Restart the OpenTelemetry Collector:\n    \n    `/opt/CPotelcol/CPotelcolCli.sh stop ; /opt/CPotelcol/CPotelcolCli.sh start`\n    \n3.  Restart the OpenTelemetry Agent:\n    \n    `/opt/CPotlpAgent/CPotlpagentCli.sh stop ; /opt/CPotlpAgent/CPotlpagentCli.sh start`\n    \n4.  Search for your metric name in the output file:\n    \n    `cat /<path_to>/<output_file>.json | jq . | grep \"<metric_name>\"`\n    \n    Example:\n    \n    `cat /var/log/otlp_export_debug.json | jq . | grep \"hardware.sensors.temperature\"`\n    \n5.  Disable the debug mode:\n    \n    `/opt/CPotelcol/sklnctl export --debug-stop`\n    \n6.  Restart the OpenTelemetry Collector:\n    \n    `/opt/CPotelcol/CPotelcolCli.sh stop ; /opt/CPotelcol/CPotelcolCli.sh start`\n    \n7.  Restart the OpenTelemetry Agent:\n    \n    `/opt/CPotlpAgent/CPotlpagentCli.sh stop ; /opt/CPotlpAgent/CPotlpagentCli.sh start`\n    \n\n##   \nList of Resolved Issues and New Features per Update\n\n<table data-darkreader-inline-border-top=\"\" data-darkreader-inline-border-right=\"\" data-darkreader-inline-border-bottom=\"\" data-darkreader-inline-border-left=\"\"><tbody><tr data-darkreader-inline-bgcolor=\"\"><td>ID</td><td>Description</td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Take 97 (27 April 2025)</strong></td></tr><tr><td>ODU-2563&nbsp;</td><td><ul><li>Added ARP records count collector.</li><li>Fixes and improvements to multiple metrics and collectors.</li><li>AIOPs fixes and improvements.</li><li>Performance improvements, adopting a new open source.</li><li>Added data to packages and Jumbo collector as metrics.&nbsp;</li></ul></td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Take 63 (9 December 2024)</strong></td></tr><tr><td>ODU-2211&nbsp;</td><td><ul><li>Added the Management API Statistics feature.</li><li>Introduced a template script to support custom script development.</li><li>The Custom Scripts feature is now Generally Available.</li><li>Refined the custom script output format requirements.</li><li>Some processes migrated from&nbsp;<em>tellpm</em>&nbsp;to CPWatchDog.</li><li>Minor Fixes.</li></ul></td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Take 50 (8 October 2024)</strong></td></tr><tr><td>ODU-2075&nbsp;</td><td><ul><li>Minor fixes and improvements.</li></ul></td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Take 49 (18 September 2024)</strong></td></tr><tr><td>ODU-2067&nbsp;</td><td><ul><li>Minor fixes and improvements.</li></ul></td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Take 41 (10 September 2024)</strong></td></tr><tr><td>ODU-2003</td><td><ul><li>Added MGMT API Statistics.</li><li>Added the Custom Scripts feature.</li><li>Added AIOPS related content.&nbsp;</li><li>Template script is now used with custom scripts.</li><li>The format of custom script output is changed.</li><li>Fixes and corrections.</li></ul></td></tr><tr data-darkreader-inline-bgcolor=\"\"><td colspan=\"2\"><strong>Take 26 (11 November 2023)</strong></td></tr><tr><td>ODU-1368</td><td>First Release of the document.</td></tr></tbody></table>\n\n##   \nRevision History\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorYehonatan Cohen\n\nTechnical ResourceElad Chomsky\n\nAccess LevelGeneral\n\nStatusApproved by TAC\n\nDate Created2023-11-05\n\nLast Modified2025-04-28\n\nEditorKatya Horwitz\n\nLast ApproverKatya Horwitz\n\n## Comments\n\n#### Internal only\n\n### This SK belongs to Darwin Project\n\n**SK SHOULD NOT BE DELETED - referenced in source code and HCP Tool**","language":"md","time":"14 days ago","created":"2025-05-06T22:56:24.337Z","annotations":[],"updated":"2025-05-06T23:04:58.003Z"},{"title":"Check Point Maestro VSX Unexpected Failover Troubleshooting","id":"77261d8e-ee65-4c2c-a0e5-be55622b6668","type":"TEXT","raw":"ProductQuantum Maestro, VSX (Traditional)\n\nVersionR81 (EOS), R81.10, R81.20\n\nOSGaia\n\nPlatform26000, MHO Maestro\n\nLast Modified2025-04-21\n\n#### For internal users only\n\n## Symptoms\n\n-   In rare scenarios, a Maestro Security Group running in VSX mode fails over unexpectedly.\n    \n-   The `/var/log/messages` file contains these kernel crash back traces:\n    \n    ```\n    kernel:  &lt;IRQ&gt;  [&lt;ffffffff8178fde0&gt;] dump_stack+0x1e/0x20\n    ```\n    \n-   There are RX/TX errors / drops on the BPEth interfaces:\n    \n    ```\n    Interface BPEth0 have issues with: RX-DRP: 552943 \n    Interface BPEth1 have issues with: RX-DRP: 728245 \n    Interface ethsBP1-01 have issues with: RX-DRP: 50227 \n    Interface ethsBP1-02 have issues with: RX-DRP: 107328 \n    ```\n    \n-   The `dmesg` logs contain interface link errors:\n    \n    ```\n    i40e 0000:65:00.3 ethsBP1-04: tx_timeout: VSI_seid: 399, Q 6, NTC: 0x270, HWB: 0x270, NTU: 0x259,<br> TAIL: 0x259, INT: 0x1\n    i40e 0000:65:00.3 ethsBP1-04: tx_timeout recovery level 1, hung_queue 6\n    BPEth1: link status down for interface ethsBP1-04, disabling it in 200 ms\n    BPEth1: link status down for interface ethsBP1-04, disabling it in 200 ms\n    BPEth1: link status down for interface ethsBP1-04, disabling it in 200 ms\n    ```\n    \n\n## Cause\n\nA kernel crash triggered the failover. The crash occurred due to a transmission timeout (tx\\_timeout) when the affected interface was already down. This condition caused repeated link failures and unstable interface behavior, leading to the failover of the Maestro Security Group.\n\n## Solution\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorCyril Silverstov\n\nTechnical ResourcePavel Stegnii\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2025-04-20\n\nLast Modified2025-04-21\n\nEditorCyril Silverstov\n\nLast ApproverLiron Rubin","language":"md","time":"14 days ago","created":"2025-05-06T22:56:26.660Z","annotations":[],"updated":"2025-05-06T23:04:11.424Z"},{"title":"Troubleshooting Missing IPv6 Addresses in Check Point Get Topology","id":"5a68ef68-f4b6-407f-8d51-fa2e5ce4ca76","type":"TEXT","raw":"ProductMulti-Domain Security Management, Quantum Security Management\n\nVersionR80.40 (EOS), R81 (EOS), R81.10, R81.20\n\nLast Modified2024-02-12\n\n## Symptoms\n\n-   IPv6 addresses are missing after running **Get Topology**.\n\n## Cause\n\nThe **Get Topology** operation filters out network interfaces whose IPv6 addresses begin with \"fe80\". This is because IPv6 addresses with the prefix \"fe80\" are non-routable, meaning they can only be used for communication within the local network.\n\n## Solution\n\nThe interfaces configuration on the Security Gateway should be reviewed.  \nOn the Security Gateway, run:  \n\ncpstat fw -f interfaces\n\n**Important -** IPv6 addresses that begin with \"fe80\" do not show in SmartConsole for network interfaces.\n\nEnsure that any additional IPv6 addresses are visible. If they do not show, execute the operation using the [get-interfaces Management API .](https://sc1.checkpoint.com/documents/latest/APIs/#cli/get-interfaces~v1.9%20)\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorNatan Chamilevski\n\nTechnical ResourceShlomi Levi\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2024-02-12\n\nLast Modified2024-02-12\n\nEditorNatan Chamilevski\n\nLast ApproverDaniel Epstein\n\n## Comments\n\n#### Internal only\n\nPlease make sure to check the interfaces configuration on the Gateway prior to any investigation on the Management.\n\nFor troubleshooting get topology further on the Management side, please use:  \nhttps://wiki.checkpoint.com/confluence/display/TSTAC/Networks+And+Interfaces+Architecture+And+Troubleshooting","language":"md","time":"14 days ago","created":"2025-05-06T22:56:24.470Z","annotations":[],"updated":"2025-05-06T23:04:17.212Z"},{"title":"Check Point Firewall DHCP Drop Issue and Hotfix Solution","id":"86d65ff7-9303-4f73-92a8-832b2817a07a","type":"TEXT","raw":"ProductQuantum Maestro\n\nVersionR81.20\n\nOSGaia\n\nLast Modified2025-04-29\n\n#### For internal users only\n\n## Symptoms\n\n-   The firewall is receiving the broadcast DHCP traffic, but it is not processing it.\n\n## Cause\n\nDHCP Discover packets are being incorrectly dropped because of the Flush and ACK (FnA) mechanism.\n\n## Solution\n\n[Contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/) to get a Hotfix for this issue.\n\nA Support Engineer will make sure the Hotfix is compatible with your environment before providing it.  \nFor faster resolution and verification, collect these files:\n\n1.  [CPinfo](https://support.checkpoint.com/results/sk/sk92739) file from the Management Server involved in the case.\n2.  [CPinfo](https://support.checkpoint.com/results/sk/sk92739) file from the Security Gateway / each Cluster Member involved in the case.\n\n**Hotfix installation instructions:**  \nRefer to [sk168597 - How to install a Hotfix](https://support.checkpoint.com/results/sk/sk168597).\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorSnir Bernaz\n\nTechnical ResourceAli Abd El Halim\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2025-04-28\n\nLast Modified2025-04-29\n\nEditorSnir Bernaz\n\nLast ApproverUday Kumar Alwari\n\n## Comments\n\n#### Internal only\n\nIt can be seen when running a kernel debug with the following flags:\n\nfwaccel dbg -m default + offload routing conn  \nfwaccel dbg -m pkt + corr routing drop  \nfw ctl debug -m fw + conn drop route packet sync  \nfw ctl debug -m cluster + correction ccp\n\n-   fwldbcast\\_flush\\_chain\\_with\\_callback: FnA on chain (inbound) xxxxx: dir 1, 0.0.0.0:68 -> 255.255.255.255:67 IPP 17 ;\n-   fwldbcast\\_drop\\_resume\\_connection\\_traffic: FnA Retransmissions for chain xxxxx will be dropped;\n-   fwconn\\_drop\\_connection\\_traffic: connection traffic will be dropped;","language":"md","time":"14 days ago","created":"2025-05-06T22:56:26.883Z","annotations":[],"updated":"2025-05-06T23:05:02.436Z"},{"title":"ProductQuantum Scalable Chassis, Quantum Security Gateways","id":"83acb1d0-aa8a-45e5-a368-ab49666c959b","type":"TEXT","raw":"ProductQuantum Scalable Chassis, Quantum Security Gateways, VSX (Traditional)\n\nVersionR81.20\n\nLast Modified2023-12-17\n\n## Symptoms\n\n-   When you configure more than 127 OSPF interfaces in version R81.20, this message appears:\n    \n    \"`Can only configure a maximum of 127 OSPF interfaces`\"\n    \n\n## Solution\n\nNo fix is required. This behavior is by design.\n\nIn R81.20, to maintain a stable environment, the maximum number of OSPF interfaces is 127.\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorOmer Ifergan\n\nTechnical ResourceSundeep Mudgal\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2023-12-14\n\nLast Modified2023-12-17\n\nEditorOmer Ifergan\n\nLast ApproverLiron Rubin\n\n## Comments\n\n#### Internal only\n\nHi All,\n\nHope you are doing well. \n\nI am reaching out regarding PMTR-76051.\n\nI have a customer who is moving from clusterXL R80.30 to Maestro VSX R81.20 and encounters this message when trying to configure the 128 one:\n\nCan only configure a maximum of 127 OSPF interfaces.\n\nIs this a final statement or I should open an investigation task to figure out how we can use more than 127 OSPF interfaces?\n\nIf this is a limitation, what should customers do in such situation?\n\n ========================================  \nYes. Customers can use VSX, buy more boxes, segment their network etc. We cannot guarantee general stability of then network with more than 127 interfaces. Even Cisco’s best practices guide says that you shouldn’t have more than 60 OSPF neighbors:\n\n Designing Scalable OSPF Design > Designing Cisco Network Service Architectures (ARCH): Developing an Optimum Design for Layer 3 (CCDP) | Cisco Press\n\n -Sundeep","language":"md","time":"14 days ago","created":"2025-05-06T22:56:24.598Z","annotations":[],"updated":"2025-05-06T23:03:32.566Z"},{"title":"Check Point Maestro Security Group Contract Renewal Issue","id":"68c1ab75-eae1-422c-8693-d814e88d8b25","type":"TEXT","raw":"ProductQuantum Maestro\n\nVersionR81.20\n\nLast Modified2025-04-24\n\n#### For internal users only\n\n## Symptoms\n\n-   During contracts renewal, non-SMO Security Group Members in a Maestro Security Group do not receive the updated contract automatically.\n    \n\n## Cause\n\nThe Management Server maintains a database that stores all Certificate Keys (CKs) of managed appliances. It uses this database to check for contract updates from the User Center.\n\nIn a Maestro environment, this database includes only the SMO's MAC-address CK. As a result, non-SMO Security Group Members do not receive the updated contract automatically.\n\n## Solution\n\n[Contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/) to get a Hotfix for this issue.\n\nA Support Engineer will make sure the Hotfix is compatible with your environment before providing it.  \nFor faster resolution and verification, collect these files:\n\n1.  [CPinfo](https://support.checkpoint.com/results/sk/sk92739) file from the Management Server involved in the case.\n2.  [CPinfo](https://support.checkpoint.com/results/sk/sk92739) file from the Security Gateway / each Cluster Member involved in the case.\n\nFollow these steps to manually update the contract on non-SMO Security Group Members:\n\n1.  Pull the new contract from the User Center. According to UC rules, the pulled file contains the contract data for the whole account. If the Security Group is built from appliances belonging to several different accounts, the same procedure should be followed for each account.\n2.  Copy the contract file to the SMO (any folder =<CONTRACT\\_FILE\\_PATH>)\n3.  Install the contract data file on the SMO with the command \"cplic contract put <CONTRACT\\_FILE\\_PATH>.\" The cp.contract file is accumulative so the $CPDIR/conf/cp.contract will contain the merge of all the calls for \"cplic contract put <CONTRACT\\_FILE\\_PATH>\".\n4.  Backup the merged file # cp  $CPDIR/conf/cp.contract  $CPDIR/conf/cp.contract.bkp\n5.  Use the command # asg\\_cp2blades $CPDIR/conf/cp.contract.bkp\n6.  On non-SMO blade run # cplic contract put $CPDIR/conf/cp.contract.bkp\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorCyril Silverstov\n\nTechnical ResourceAnatoly Masover\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2025-04-21\n\nLast Modified2025-04-24\n\nEditorCyril Silverstov\n\nLast ApproverCyril Silverstov\n\n## Comments\n\n#### Internal only\n\nTo see the actual paths to hotfixes, see the corresponding Bug and/or Task in JIRA.\n\n___\n\nTo verify the issue, we still need the following log files:\n\n**CMA**\n\n `xmllint --format $CPDIR/database/EntMgt_DB.xml >> /home/admin/EntMgr_DB.xml.txt`\n\nMaestro\n\n`g_all ls -la $CPDIR/conf/cp.contract`\n\n **A JHF must be installed on both MDS and Maestro.**","language":"md","time":"14 days ago","created":"2025-05-06T22:56:27.066Z","annotations":[],"updated":"2025-05-06T23:04:54.252Z"},{"title":"Troubleshooting Configuration Mismatches in Check Point Maestro Environments","id":"8dd4da7f-08b0-4b63-b8ab-05a737ec3419","type":"TEXT","raw":"ProductQuantum Maestro\n\nVersionR81.20\n\nLast Modified2025-04-07\n\n## Symptoms\n\n-   Configuration PNOTE in a Maestro environment.\n    \n-   Reboot takes a long time.\n    \n-   The _/var/log/configuration\\_reboot\\_reason.log_ file shows a mismatch in the _/config/active_ file.\n    \n\n## Cause\n\nThe _/config/active_ configuration file is mismatched with other Security Group Members (SGMs), causing the remaining SGMs to stay in the DOWN status until you address the issue. It is not possible to resolve the mismatch through the image auto-clone feature for the SGMs.\n\n## Solution\n\nProcedure:\n\n1.  Examine the _/var/log/configuration\\_reboot\\_reason.log_ file to identify the misconfiguration.\n2.  If there are valid reasons for the mismatches, resolve the discrepancies.\n3.  If there are no valid reasons for the mismatch, make the necessary alterations on the **Single Management Object (SMO)**.\n4.  To remove the excessive configurations in the _/config/active_ file, use the `dbset` command (refer to the example below) .\n5.   Use the `cpha_blade_config pull_config` command on the SGMs with the configuration PNOTE to resolve the issue fully.\n    \n    **Example**:\n    \n    If the mismatches include:\n    \n\n-   -   interface:eth2-Sync t\n    -   interface:eth2-Sync:state on\n    -   interface:eth2-CIN t\n    -   interface:eth2-CIN:state on\n    -   interface:BPEth1 t\n    -   interface:BPEth1:state on\n\nThen use these commands to remove them from the _/config/active_ file:\n\n-   -   `#dbset interface:eth2-Sync`\n    -   `#dbset interface:eth2-CIN`\n    -   `#dbset interface:BPEth1`\n    -   `#dbset :save`\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorNiran Koren\n\nTechnical ResourceAlon Cohen\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2024-01-15\n\nLast Modified2025-04-07\n\nEditorNiran Koren\n\nLast ApproverJohn Schuerger","language":"md","time":"14 days ago","created":"2025-05-06T22:56:24.780Z","annotations":[],"updated":"2025-05-06T23:03:41.626Z"},{"title":"Troubleshooting QSFP Mode Changes on Check Point Maestro Orchestrator","id":"989f3500-a050-417b-a0e8-b445d45d3736","type":"TEXT","raw":"ProductQuantum Maestro\n\nVersionR80.20SP (EOS), R81.10, R81.20\n\nOSGaia\n\nPlatformMHO Maestro\n\nLast Modified2025-04-03\n\n## Symptoms\n\n-   Problematic scenario on the Maestro Orchestrator:\n    \n    1.  Connect to the command line on the Maestro Orchestrator.\n    2.  Log in.\n    3.  If the default shell is Gaia Clish, go to the Expert mode:  \n        `expert`\n    4.  Run this command to see data about ports:  \n        `orch_stat -p`\n    5.  Go from the Expert mode to Gaia Clish:  \n        -   If the default shell is Gaia Clish: `exit`\n        -   If the default shell is the Expert mode: `clish`\n    6.  Change the QSFP mode of a port:  \n        `set maestro port <Port_ID> qsfp-mode <Mode>`  \n        Example:  \n        `set maestro port 1/3/1 qsfp-mode 100G`\n    7.  Insert the adapter and transceiver in the corresponding Maestro Orchestrator port.\n    8.  Change the QSFP mode again (to a different mode):  \n        `set maestro port <Port_ID> qsfp-mode <Mode>`  \n        Example:  \n        `set maestro port 1/3/1 qsfp-mode 4x10G`\n-   Possible experiences during this issue on the Maestro Orchestrator:\n    \n    -   Gaia Clish commands may not respond\n    -   The Expert mode command \"`orch_stat`\"\n    -   The HCP text \"`Orchestrators SX API`\" may fail\n    -   The configuration file \"`maestro.json`\" may become corrupted\n\n## Cause\n\nIncompatibility between specific adapters and QSFP transceivers inserted in Maestro Orchestrator ports.\n\n## Solution\n\n### Available Option #1 (recommended) - Upgrade to R82\n\n> Upgrade the Maestro Orchestrator to [R82](https://support.checkpoint.com/results/sk/sk181127) that contains the required fix for this issue.\n\n### Available Option #2 - Fix the corruption in the configuration file\n\nIf it is not possible to upgrade Maestro Orchestrator at this time, then follow the steps below.\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorTal Sarah Rose Neville\n\nTechnical ResourceIdan Alperin\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2025-03-26\n\nLast Modified2025-04-03\n\nEditorTal Sarah Rose Neville\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only\n\nThis issue is due to a BUG in the NVIDIA code - it was resolved in R82.00.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:27.252Z","annotations":[],"updated":"2025-05-06T23:04:46.107Z"},{"title":"Using Check Point HCP-X Add-on for Early Access to Diagnostic Tests","id":"d7be91bf-bce2-42de-a403-8b93a628e1c4","type":"TEXT","raw":"---\ncreated: 2025-04-29T13:07:20 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk183223\nauthor: \n---\n\n# Support, Support Requests, Training, Documentation, and Knowledge base for Check Point products and services\n\n> ## Excerpt\n> ProductMulti-Domain Security Management, Quantum Maestro, Quantum Security Gateways, Quantum Security Management, VSX (Traditional)\n\n---\n## HealthCheck Point Add-on (HCP-X)\n\nProductMulti-Domain Security Management, Quantum Maestro, Quantum Security Gateways, Quantum Security Management, VSX (Traditional)\n\nVersionR81.10, R81.20, R82\n\nLast Modified2025-04-22\n\n## Solution\n\n**What is HCP-X**  \nHCP-X add-on provides a testing environment for new HealthCheck Point (HCP) tests before they are officially released. This add-on allows early access to tests that are still in development but will eventually be included in standard HCP releases.\n\nHCP-X benefits are:\n\n-   **Early Access to New Tests** – Access and evaluate upcoming diagnostic tests before they are added to the main HCP release.\n-   **Faster Issue Resolution** – Identify and address critical problems quickly.\n-   **Regular Updates** – Receive weekly test updates, ensuring you always have access to the most recent improvements.\n\n### Initial Setup\n\nIf you did not use HCP-X before, prepare your environment with the following steps:\n\n### Standard Installation\n\nRun this command to fetch and install the latest RPM:  \n`# curl_cli --cacert $CPDIR/conf/ca-bundle.crt -o /tmp/hcp-1-tac-latest.rpm https://sc1.checkpoint.com/HCP/hcp-1-tac-latest.rpm && rpm -i /tmp/hcp-1-tac-latest.rpm --nodeps --force`\n\n###   \nScalable Platform/Maestro Installation\n\nRun this command to fetch and install the latest RPM:  \n`# curl_cli --cacert $CPDIR/conf/ca-bundle.crt -o /tmp/hcp-1-tac-latest.rpm https://sc1.checkpoint.com/HCP/hcp-1-tac-latest.rpm && asg_cp2blades hcp-1-tac-latest.rpm && g_all rpm -i /tmp/hcp-1-tac-latest.rpm --nodeps --force`\n\n### **  \nRunning HCP-X Tests  \n**\n\nTo execute HCP-X tests, add the `--tac` flag to your HCP command. The system will:\n\n1.  Check the cloud for the latest HCP-X test file.\n2.  Automatically retrieve and execute it if available.\n3.  Fall back to local HCP RPM files if necessary.\n\nYou can track in the logs whether tests are pulled from the cloud or local RPM files.\n\n###   \nCommon commands\n\n`$ hcp --tac -r all`                              # Run all applicable HCP tests including the HCP-X tests  \n`$ hcp --tac -r 'TAC'`                          # Run only the HCP-X tests (after collecting the HCP statistics)\n\n[sk171436 - HealthCheck Point (HCP) Release Updates](https://support.checkpoint.com/results/sk/sk171436)\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorYonatan Astrachan\n\nTechnical ResourceRuthy Toda\n\nAccess LevelInternal\n\nStatusApproved by TAC\n\nDate Created2025-04-18\n\nLast Modified2025-04-22\n\nEditorYonatan Astrachan\n\nLast ApproverKatya Horwitz\n\n## Comments\n\n#### Internal only\n\nValid also for **R82.10**.\n\nShould be published for customers after review.\n\n**Important Note**: When using HCP-X, HCP on the customer’s machine will continue to be part of the main \"Darwin\" package and will receive updates via auto-updates.\n","language":"md","time":"14 days ago","created":"2025-05-06T22:56:27.463Z","annotations":[],"updated":"2025-05-06T23:05:12.996Z"},{"title":"Transferring Security Logs to R81.20","id":"67f1678d-b8eb-4867-8080-ee3b48621a1f","type":"TEXT","raw":"---\ncreated: 2025-04-29T19:03:52 (UTC -05:00)\ntags: []\nsource: https://support.checkpoint.com/results/sk/sk183389\nauthor: \n---\n\n# sk183389 - How to migrate logs between Management Servers during hardware replacement or Advanced Upgrade\n\n> ## Excerpt\n> Applies to: Multi-Domain Security Management, Quantum Security Management\n\n---\nProductMulti-Domain Security Management, Quantum Security Management\n\nVersionR81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-04-29\n\n## Solution\n\nThis article describes the method of transferring Security logs from one Management Server / Log Server to another in these cases:\n\n-   You need to migrate the current Management Server / Log Server database to another hardware, running the same software version.\n-   You need to perform an Advanced Upgrade (export the current database and import it into a higher software version, on the same or different hardware).  \n    **Important Note** - In this case, **you must** use the Upgrade Tools package for the target software version from [sk135172 - Upgrade Tools package](https://support.checkpoint.com/results/sk/sk135172).\n\nThe procedures below apply to these server types:\n\n-   Security Management Servers\n-   Multi-Domain Security Management Server\n-   Multi-Domain Log Servers\n\n###   \nOption 1 (Best Practice) - Export the logs and their log indexes together with the Management Database\n\nWhen performing the export of the Management Server database, we recommend to include the logs and their log indexes in the export file. You can specify for how many last days to include the logs and their log indexes.\n\n**Note** - For the complete CLI syntax of the \"`migrate_server`\" command, refer to the [Command Line Interface (CLI) Reference Guide](https://support.checkpoint.com/product/184#f-commonsource=C.%20Documentation) for your version > Chapter \"Security Management Server Commands\" > Section \"migrate\\_server\".\n\nExample workflow for the R81.20 version:\n\n1.  On the source server, export the Management Server database with logs and their log indexes:\n    \n    `[Expert@MGMT:0]# $FWDIR/scripts/migrate_server export -v R81.20 -x 30 /var/log/ExportedDatabase.tgz`\n    \n2.  On the target server, import the Management Server database with logs and their log indexes:\n    \n    `[Expert@MGMT:0]# $FWDIR/scripts/migrate_server import -v R81.20 -x /var/log/ExportedDatabase.tgz`\n    \n3.  On the target server, follow [sk111766](https://support.checkpoint.com/results/sk/sk111766) to re-index the imported logs.\n    \n\n###   \nOption 2 - Export the logs (without the log indexes) together with the Management Database\n\nWhen performing the export of the Management Server database, you can include only the logs in the export file, if there is not enough disk space to collect the log indexes as well. You can specify for how many last days to include the logs.\n\n**Note** - For the complete CLI syntax of the \"`migrate_server`\" command, refer to the [Command Line Interface (CLI) Reference Guide](https://support.checkpoint.com/product/184#f-commonsource=C.%20Documentation) for your version > Chapter \"Security Management Server Commands\" > Section \"migrate\\_server\".\n\nExample workflow for the R81.20 version:\n\n1.  On the source server, export the Management Server database with logs (without their log indexes):\n    \n    `[Expert@MGMT:0]# $FWDIR/scripts/migrate_server export -v R81.20 -l 30 /var/log/ExportedDatabase.tgz`\n    \n2.  On the target server, import the Management Server database with logs (without their log indexes):\n    \n    `[Expert@MGMT:0]# $FWDIR/scripts/migrate_server import -v R81.20 -l /var/log/ExportedDatabase.tgz`\n    \n3.  On the target server, follow [sk111766](https://support.checkpoint.com/results/sk/sk111766) to re-index the imported logs.\n    \n\n###   \nOption 3 - Transfer the logs and their log indexes after migrating the Management Database\n\nYou can transfer the logs and their log indexes after you migrated only the Management Database.\n\nThis article provides a shell script to migrate the logs from the source server to the target server.\n\nOn a Multi-Domain Security Management Server / Multi-Domain Log Server, the script transfers the files for each Domain Management Server / Domain Log Server.  \n**  \nPrerequisites**\n\n1.  You must have SSH access to both the source server and the target server.\n2.  The source server must have SSH access to the target server.\n3.  The Management Database must already be imported on the target server.\n\n**Procedure**\n\n1.  Download [this shell script](https://support.checkpoint.com/results/download/137441) to your computer.\n    \n2.  Copy the shell script from your computer to the source server to some directory (for example, `/var/log/`).\n    \n3.  Connect to the command line on the source server.\n    \n4.  Log in.\n    \n5.  If your default shell is Gaia Clish, then go to the Expert mode:\n    \n    `expert`\n    \n6.  Assign the 'execute' permission to the shell script (in our example, it is located in `/var/log/`):\n    \n    `chmod -v u+x /var/log/`\n    \n    `chmod -v u+x transfer_logs.sh`\n    \n7.  Run the shell script with the applicable parameters:\n    \n    **Important Note** - This script stops all Check Point services.\n    \n    Syntax:\n    \n    `./transfer_logs.sh -h`\n    \n    `./transfer_logs.sh -target <UserName>@<TargetServer> -v <Version> [-days {all | <Number of Days>}] [-sdate <Start Date YYYY-MM-DD>] [-dest <Path to Directory>] [-audit] [-index] [-index_dir <Path to Directory>]`\n    \n    Parameters:\n    \n    |             Parameter             |   Type    |                                                                                                                                                          Description                                                                                                                                                           |\n    |-----------------------------------|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n    |                `-h`                 | Optional  |                                                                                                                                                    Shows the built-in help.                                                                                                                                                    |\n    | `-target <UserName>@<TargetServer>` | Mandatory | Specifies the credentials for the SSH connection to the target server.\n    \n    -   `<UserName>`  \n        Specifies the username.  \n        This must be a user, whose default shell is `/bin/bash`.\n    -   `<TargetServer>`  \n        Specifies the target server.  \n        This must be an IP address, or a hostname that the source server can resolve. |\n    |           `-v <Version>`            | Mandatory |                                                                                                                                      Specifies the software version of the target server.                                                                                                                                      |\n    |  `-days {all | <Number of Days>}`   | Optional  | Specifies for how many last days to include the logs and their log indexes:\n    \n    -   `all`  \n        Includes all logs and their log indexes.\n    -   `<Number of Days>`  \n        Includes logs and their log indexes only for the specified last number of days.\n    \n    If you do not use the parameter \"`-days`\", then the default is the last 14 days. |\n    |  `-sdate <Start Date YYYY-MM-DD>`   | Optional  |                                                                                                    Specifies the start date (in the format YYY-MM-DD), from which to include the logs and their log indexes (until today).                                                                                                     |\n    |     `-dest <Path to Directory>`     | Optional  |                                                                                                                               Specifies the destination directory for logs on the target server.                                                                                                                               |\n    |              `-audit`               | Optional  |                                                                                                                                            Specifies to include Audit logs as well.                                                                                                                                            |\n    |             `-indexes`              | Optional  | Specifies the include log indexes as well.\n    \n    This parameter \"`-indexes`\" is mandatory if you use the parameter \"`-indexes_dir`\". |\n    | `-indexes_dir <Path to Directory>`  | Optional  |                                                                                                                           Specifies the destination directory for log indexes on the target server.                                                                                                                            |\n    \n    Examples for the target server 192.168.1.100 and the version R81.20:\n    \n    -   Transfer logs, including audit logs, from the last 7 days:\n        \n        `./transfer_logs.sh -target user@192.168.1.100 -v R81.20 -days 7 -audit`\n        \n    -   Transfer all logs, including audit logs and log indexes:\n        \n        `./transfer_logs.sh -target user@192.168.1.100 -v R81.20 -days all -audit -indexes`\n        \n    -   Transfer logs from the last 14 days to the specified directory:\n        \n        `./transfer_logs.sh -target user@192.168.1.100 -dest /var/log/remote_logs`\n        \n    -   Transfer logs, audit logs, and log indexes, from the last 14 days, starting from 20 Apr 2025:\n        \n        `./transfer_logs.sh -target user@192.168.1.100 -v R81.20 -indexes -audit -sdate 2025-04-20`\n        \n8.  Start all Check Point services:\n    \n    -   On a Security Management Server:\n        \n        `cpstart`\n        \n    -   On a Multi-Domain Security Management Server / Multi-Domain Log Server:\n        \n        `mdsstart`\n        \n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorNatan Chamilevski\n\nTechnical ResourceMahmod Sbehat\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2025-04-25\n\nLast Modified2025-04-29\n\nEditorNatan Chamilevski\n\nLast ApproverSergei Shir\n","language":"md","time":"14 days ago","created":"2025-05-06T22:56:27.647Z","annotations":[],"updated":"2025-05-06T23:05:27.260Z"},{"title":"ProductSmartEvent/Eventia Analyzer","id":"425151c1-a39a-4876-b7c2-a6191ca2c3d5","type":"TEXT","raw":"ProductSmartEvent / Eventia Analyzer\n\nVersionR81.10, R81.20, R82\n\nOSGaia\n\nLast Modified2025-04-23\n\n## Solution\n\n**Example Use Cases**You may need to export logs in this cases:\n\n1.  Audit requirements:  \n    Your organization may need to retrieve historical log data for compliance audits or security investigations that cover past time periods.\n2.  Forensic analysis:  \n    Security teams often need to analyze historical logs when investigating security incidents that occurred in the past.\n3.  Data migration:  \n    When moving to a new Security Information and Event Management (SIEM) system or log analytics platform.\n\n**Note: This procedure re-exports all logs within the specified time frame. Processing time may take from several hours to several days for environments with large log volumes.** \n\nTo re-export logs, do these steps:\n\n1.  Open the `targetConfiguration.xml` file for your Log Exporter instance.\n2.  Locate the `<source>` section to view the defined properties.\n3.  Edit the value in the `<log_files>` tag to specify the number of days for log export.\n4.  Save the file.\n5.  Apply the changes with this command:  \n    `cp_log_export reexport name <instance name> --apply-now`\n\nConfiguration example:\n\n```\n&nbsp; &lt;source&gt;<br><br>&nbsp; &nbsp; &lt;log_files&gt;<strong>350</strong>&lt;/log_files&gt;&lt;!-- on-line[default] | read logs from [number] days back (recommended) | specific file name --&gt;<br><br>&nbsp; &nbsp; &lt;log_types&gt;&lt;/log_types&gt;&lt;!--all[default]|log|audit/--&gt;<br><br>&nbsp; &nbsp; &lt;folder&gt;&lt;/folder&gt;&lt;!--$FWDIR/log[default]|specific path--&gt;<br><br>&nbsp; &nbsp; &lt;read_mode&gt;semi-unified&lt;/read_mode&gt;&lt;!--raw|semi-unified[default]/--&gt;<br><br>&nbsp; &lt;/source&gt;\n```\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorTamir Balva\n\nTechnical ResourceMenahem Pitchon\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2025-04-21\n\nLast Modified2025-04-23\n\nEditorTamir Balva\n\nLast ApproverNatalia Zhdanova\n\n## Comments\n\n#### Internal only\n\nValid also for 82.10.  \n\\---  \nFrom: Meital Natanson <meitalna@checkpoint.com>  \nSent: Monday 20th Jan 2025 20:55\n\nTo: Shira Shabat <shirashab@checkpoint.com>; Menahem Pitchon <menip@checkpoint.com>; Batel Falach <batelf@checkpoint.com>; Mahmod Sbehat <mahmods@checkpoint.com>; Tamir Balva <tamirbal@checkpoint.com>; Abed Khet <abedkhet@checkpoint.com>\n\nCc: Yazan Kirresh <yazank@checkpoint.com>; Eviatar Abutbul <eviatara@checkpoint.com>\n\nSubject: RE: Log Exporter limitation\n\nThere is no limit on days to index back in the code.\n\nCustomer should be aware that indexing back many days / years, will take a lot of time, consume resources and can impact on his env. stability and functionality, so obviously not recommended.\n\nBut no hard limit.","language":"md","time":"14 days ago","created":"2025-05-06T22:56:27.830Z","annotations":[],"updated":"2025-05-06T23:04:35.801Z"},{"title":"ProductQuantum Maestro VersionR81.20","id":"08f7eb7d-3300-445e-92a0-0d5cd06619ff","type":"TEXT","raw":"ProductQuantum Maestro\n\nVersionR81.20\n\nOSGaia\n\nLast Modified2025-04-25\n\n#### For internal users only\n\n## Symptoms\n\n-   TCP and UDP traffic over VLAN IDs greater than 2048 does not pass through the Maestro Security Group when SecureXL works in the UPPAK mode\n    \n-   ICMP traffic passes as expected over the same VLAN IDs.\n    \n-   Security Group does not generate any \"Drop\" logs.\n    \n-   Traffic capture of TCP and UDP packets shows incomplete communication.\n    \n\n## Cause\n\nThis issue occurs only in Maestro Security Groups - in both the Gateway mode and VSX mode.\n\nTCP and UDP traffic goes through SecureXL (that is enabled by default). In a Maestro Security Group, due to an issue in handling VLAN traffic, accelerated traffic cannot pass through the Security Group in this scenario:\n\n1.  The affected interfaces are configured with VLAN IDs greater than 2048.\n2.  SecureXL works in the UPPAK mode.\n\nICMP traffic is not affected because it goes through the Slow Path (F2F) and bypasses SecureXL.\n\n## Solution\n\n[Contact Check Point Support](https://www.checkpoint.com/support-services/contact-support/) to get a Hotfix for this issue.\n\nA Support Engineer will make sure the Hotfix is compatible with your environment before providing it.  \nFor faster resolution and verification, collect these files:\n\n1.  [CPinfo](https://support.checkpoint.com/results/sk/sk92739) file from the Management Server involved in the case.\n2.  [CPinfo](https://support.checkpoint.com/results/sk/sk92739) file from the Maestro Security Group involved in the case.\n\n**Hotfix installation instructions:**  \nRefer to [sk168597 - How to install a Hotfix](https://support.checkpoint.com/results/sk/sk168597).\n\n#### NOTE\n\nThis solution has been verified for the specific scenario, described by the combination of Product, Version and Symptoms. It may not work in other scenarios.\n\n## Article Properties\n\nOriginatorToniram Barman\n\nTechnical ResourceJoseph Adam\n\nAccess LevelAdvanced\n\nStatusApproved by TAC\n\nDate Created2025-04-09\n\nLast Modified2025-04-25\n\nEditorToniram Barman\n\nLast ApproverSergei Shir\n\n## Comments\n\n#### Internal only\n\nFrom: Matthew Legrow <mlegrow@checkpoint.com>   \nSent: Wednesday, April 9, 2025 6:29 PM  \nTo: Sergei Shir <sergeis@checkpoint.com>; Joseph Adam <jadam@checkpoint.com>  \nCc: Kalyan (Srinivas)Tata <stata@checkpoint.com>; Omri Buzhish <omribu@checkpoint.com>; Nadia Haham <nadiah@checkpoint.com>  \nSubject: RE: PRHF-39212 - TCP and UDP traffic over VLAN IDs greater than 2024 does not pass through a Maestro Security Group\n\nHi Sergei,\n\nR81.10 is not affected.  \nAll other versions (R82, R82.10) are not yet available to customers, so they will be patched for this issue before they are released.  \nThe only problematic version is R81.20 T89 and higher.\n\nFrom: Sergei Shir   \nSent: Wednesday, April 9, 2025 5:13 PM  \nTo: Joseph Adam <jadam@checkpoint.com>; Matthew Legrow <mlegrow@checkpoint.com>  \nCc: Kalyan (Srinivas)Tata <stata@checkpoint.com>; Omri Buzhish <omribu@checkpoint.com>; Nadia Haham <nadiah@checkpoint.com>  \nSubject: PRHF-39212 - TCP and UDP traffic over VLAN IDs greater than 2024 does not pass through a Maestro Security Group\n\nHi Joseph and Matthew\n\nWho can answer this question about PRHF-39212 ?\n\nAre these the affected versions   \n(listed in sk179432 for UPPAK support in Maestro)  \nthat will NOT pass traffic over VLAN IDs > 2024 ?\n\nR81.20 Jumbo Hotfix Accumulator - Take 89 and higher  \nR81.10 Jumbo Hotfix Accumulator - Take 150 and higher","language":"md","time":"14 days ago","created":"2025-05-06T22:56:28.009Z","annotations":[],"updated":"2025-05-07T00:26:09.953Z"}],"gptContexts":[],"gptFolderNames":[],"enrichedCode":{}}